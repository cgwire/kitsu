{"version":3,"file":"EntitySearch-bb5fcfb5.js","sources":["../../src/components/widgets/EntityPreview.vue","../../src/components/pages/EntitySearch.vue"],"sourcesContent":["<template>\n<a\n  class=\"preview-wrapper preview-picture\"\n  target=\"_blank\"\n  :style=\"{\n    width: emptyWidth + 'px',\n    'min-width': emptyWidth + 'px',\n    height: emptyHeight + 'px'\n  }\"\n  @click=\"onClicked\"\n>\n  <img\n    class=\"thumbnail-picture\"\n    :style=\"{\n      width: 'auto',\n      'max-height': emptyHeight + 'px'\n    }\"\n    :width=\"width || ''\"\n    v-lazy=\"thumbnailPath\"\n    :key=\"thumbnailKey\"\n  />\n</a>\n</template>\n\n<script>\nexport default {\n  name: 'entity-preview',\n\n  props: {\n    entity: {\n      default: () => {},\n      type: Object\n    },\n    square: {\n      default: false,\n      type: Boolean\n    },\n    width: {\n      default: null,\n      type: Number\n    },\n    height: {\n      default: null,\n      type: Number\n    },\n    maxWidth: {\n      default: null,\n      type: Number\n    },\n    maxHeight: {\n      default: null,\n      type: Number\n    },\n    emptyHeight: {\n      default: 30,\n      type: Number\n    },\n    emptyWidth: {\n      default: 50,\n      type: Number\n    },\n    previewFileId: {\n      default: null,\n      type: String\n    }\n  },\n\n  computed: {\n    originalPath() {\n      const previewFileId = this.previewFileId || this.entity.preview_file_id\n      return '/api/pictures/originals/preview-files/' + previewFileId + '.png'\n    },\n\n    isPreview() {\n      const previewFileId = this.previewFileId || this.entity.preview_file_id\n      return previewFileId && previewFileId.length > 0\n    },\n\n    imgStyle() {\n      const style = {}\n      const height = this.maxHeight || this.emptyHeight\n      const width = this.maxWidth || this.emptyWidth\n      style['max-height'] = height\n      style['min-height'] = height\n      style.height = height\n      style['max-width'] = width\n      style['min-width'] = width\n      style.width = width\n      return style\n    },\n\n    thumbnailPath() {\n      const previewFileId = this.previewFileId || this.entity.preview_file_id\n      return (\n        '/api/pictures/previews/preview-files/' + previewFileId + '.png'\n      )\n    },\n\n    thumbnailKey() {\n      const previewFileId = this.previewFileId || this.entity.preview_file_id\n      return `preview-${previewFileId}`\n    }\n  },\n\n  methods: {\n    onClicked() {\n      if (this.noPreview) return\n      const previewFileId = this.previewFileId || this.entity.preview_file_id\n      this.$store.commit('SHOW_PREVIEW_FILE', previewFileId)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  table .thumbnail-picture.thumbnail-empty {\n    background: $dark-grey-lighter;\n    border-color: $dark-grey-light;\n  }\n}\n\na {\n  background: $black;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\nimg {\n  display: block;\n  border: 0;\n  border-radius: 0;\n}\n\nspan.thumbnail-empty {\n  background: $white-grey;\n  display: block;\n  margin: 0;\n}\n\n.thumbnail-picture.square {\n  width: 100px;\n  height: 100px;\n}\n\ntable .thumbnail-picture.thumbnail-empty {\n  background: $white-grey;\n  border: 1px solid $light-grey;\n  margin: 0px;\n}\n\ntable .thumbnail-wrapper {\n}\n\ntable .thumbnail-picture {\n  background-color: black;\n  border: 0;\n  margin: 0px;\n  padding: 0px;\n}\n\n.thumbnail-wrapper {\n  padding: 0px;\n  border: 0;\n  border-radius: 4px;\n  display: inline-block;\n}\n</style>\n","<template>\n  <div class=\"columns fixed-page\">\n    <div class=\"column main-column\">\n      <div class=\"global-search-field\">\n        <span class=\"search-icon\">\n          <search-icon width=\"20\" />\n        </span>\n        <input\n          ref=\"global-search-field\"\n          class=\"input\"\n          placeholder=\"Search for an entity in the database...\"\n          @keyup.enter=\"onElementSelected\"\n          v-model=\"searchQuery\"\n        />\n      </div>\n      <div\n        class=\"search-results\"\n      >\n        <div class=\"result-line has-text-centered\" v-if=\"searchQuery.length < 3\">\n          {{ $t('main.search.type') }}\n        </div>\n        <div\n          class=\"search-loader\"\n          :style=\"{\n            'min-height': nbResults * 60 + 'px'\n          }\"\n          v-else-if=\"isLoading\"\n        >\n          <div><spinner /></div>\n        </div>\n        <div class=\"result-list\" v-else-if=\"nbResults > 0\">\n          <div\n            :key=\"asset.id\"\n            :class=\"{\n              'result-line': true,\n              'selected-result': selectedIndex === index\n            }\"\n            v-for=\"(asset, index) in assets\"\n          >\n              <div class=\"flexcolumn result\">\n                <div class=\"\">\n                  <entity-preview\n                    style=\"margin-top: 5px\"\n                    :empty-height=\"200\"\n                    :empty-width=\"300\"\n                    :height=\"200\"\n                    :width=\"300\"\n                    :entity=\"asset\"\n                  />\n                </div>\n                <router-link\n                  class=\"result-name\"\n                  :id=\"'result-link-' + index\"\n                  :to=\"entityPath(asset)\"\n                >\n                  <div class=\"\">\n                    <div class=\"production-name\">\n                      {{ asset.project_name }}\n                    </div>\n                    <div class=\"asset-type-name\">\n                      {{ asset.asset_type_name }} / {{ asset.name }}\n                    </div>\n                  </div>\n                </router-link>\n              </div>\n          </div>\n        </div>\n\n        <div class=\"result-line\" v-else>\n          {{ $t('main.search.no_result') }}\n        </div>\n      </div>\n\n      </div>\n\n      <div\n        class=\"column side-column is-hidden-mobile hide-small-screen\"\n        v-if=\"currentTask\"\n      >\n        <task-info :task=\"currentTask\" :is-loading=\"loading.currentTask\" />\n      </div>\n  </div>\n</template>\n\n<script>\n/*\n * Page to allow wide search on every entities stored in the open projects.\n */\nimport { mapGetters, mapActions } from 'vuex'\nimport { getEntityPath, getPersonPath } from '@/lib/path'\nimport peopleStore from '@/store/modules/people'\n\nimport { SearchIcon } from 'vue-feather-icons'\n\nimport EntityPreview from '@/components/widgets/EntityPreview'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar'\nimport PeopleName from '@/components/widgets/PeopleName'\nimport Spinner from '@/components/widgets/Spinner'\nimport TaskInfo from '@/components/sides/TaskInfo'\n\nexport default {\n  name: 'entity-search',\n  mixins: [],\n\n  components: {\n    EntityPreview,\n    PeopleAvatar,\n    PeopleName,\n    SearchIcon,\n    Spinner\n  },\n\n  data() {\n    return {\n      assets: [],\n      currentTask: null,\n      isLoading: false,\n      selectedIndex: 0,\n      searchQuery: ''\n    }\n  },\n\n  props: {},\n\n  mounted() {\n    window.addEventListener('keydown', event => {\n      if (event.ctrlKey && event.altKey && event.keyCode === 70) {\n        if (this.$refs['global-search-field']) {\n          this.$refs['global-search-field'].focus()\n        }\n      } else if (event.keyCode === 40) {\n        this.selectNext()\n      } else if (event.keyCode === 38) {\n        this.selectPrevious()\n      }\n    })\n\n    this.searchField.focus()\n  },\n\n  computed: {\n    ...mapGetters(['currentEpisode', 'currentProduction', 'productionMap']),\n\n    searchField () {\n      return this.$refs['global-search-field']\n    },\n\n    entityPath() {\n      const section = 'asset'\n      return entity => {\n        const project = this.productionMap.get(entity.project_id)\n        const isTVShow = project.production_type === 'tvshow'\n        let episodeId = null\n        if (isTVShow) episodeId = entity.episode_id || 'main'\n        return getEntityPath(entity.id, entity.project_id, section, episodeId)\n      }\n    },\n\n    personPath() {\n      return person => {\n        return getPersonPath(person.id)\n      }\n    },\n\n    nbResults() {\n      const length = this.assets.length\n      return length\n    }\n  },\n\n  methods: {\n    ...mapActions(['searchData']),\n\n    selectPrevious() {\n      this.selectedIndex--\n      if (this.selectedIndex < 0) {\n        this.selectedIndex = this.nbResults - 1\n      }\n    },\n\n    selectNext() {\n      this.selectedIndex++\n      if (this.selectedIndex >= this.nbResults) {\n        this.selectedIndex = 0\n      }\n    },\n\n    onElementSelected() {\n      document.getElementById('result-link-' + this.selectedIndex).click()\n      this.searchQuery = ''\n    }\n  },\n\n  watch: {\n    searchQuery() {\n      if (this.searchQuery.length > 2) {\n        this.isLoading = true\n        this.searchData({ query: this.searchQuery, limit: 10 })\n          .then(results => {\n            this.isLoading = false\n            this.assets = results.assets\n          })\n          .catch(console.error)\n      } else {\n        this.assets = []\n      }\n    }\n  },\n\n  metaInfo() {\n    return {\n      title: `${this.$t('search.title')} - Kitsu`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.fixed-page {\n  padding-top: 60px;\n}\n\n.result-list {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  column-gap: 20px;\n  row-gap: 20px;\n  max-width: 1240px;\n  margin: auto;\n}\n\n.search-results {\n  margin-top: 3em;\n}\n\n.global-search-field {\n  max-width: 800px;\n  margin: auto;\n  padding-top: 40px;\n  position: relative;\n  width: 100%;\n\n  &.global-search-field-open {\n    border-bottom-left-radius: 0px;\n    border-bottom-right-radius: 0px;\n  }\n\n  input {\n    font-size: 1.3em;\n    border-radius: 10px;\n    padding-left: 40px;\n  }\n\n  .search-icon {\n    position: absolute;\n    color: $grey;\n    z-index: 4;\n    top: 55px;\n    left: 10px;\n  }\n}\n\n.result {\n  height: 280px;\n}\n\n.result {\n  background: $white-grey-light;\n  border-radius: 1em;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n\n  .result-name {\n    color: $mid-grey;\n    font-weight: bold;\n    padding: 0.3em 1em;\n  }\n}\n\n.thumbnail-wrapper {\n  margin: 0;\n}\n</style>\n"],"names":["_sfc_main","previewFileId","style","height","width","EntityPreview","PeopleAvatar","PeopleName","SearchIcon","Spinner","event","mapGetters","section","entity","isTVShow","episodeId","getEntityPath","person","getPersonPath","mapActions","results"],"mappings":"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"}