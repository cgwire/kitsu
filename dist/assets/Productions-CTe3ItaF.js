import{_ as E,bE as M,bz as T,bA as V,a2 as O,r as p,o as d,g as h,w as L,c as m,d as e,n as w,h as b,t as i,M as B,b as S,ay as F,aA as C,q as I,I as $,k as j,f as u,F as k,e as g,i as D,B as U,a as A}from"./index-DF-DoQlt.js";import{U as N}from"./upload-DCzG59RP.js";import{T as R}from"./trash-DWKk5Pv9.js";import{C as q}from"./ComboboxStyled-BlKJF8gk.js";import{F as H}from"./FileUpload-GCzHM4-i.js";import{M as z}from"./ModalFooter-Chk0SGv-.js";import{T as Y}from"./TextField-BKWlN2Ov.js";import{H as G}from"./HardDeleteModal-BLE4oONO.js";import{P as K}from"./ProductionNameCell-CCof2ez9.js";import{f as W}from"./format-D3oTyBU9.js";import{T as J}from"./TaskTypeName-C0px4urt.js";import{R as Q}from"./RowActionsCell-DR7b8Q1u.js";import{T as X}from"./TableInfo-D6xnVb4C.js";import{P as Z}from"./PageTitle-CtScP8aV.js";import"./Combobox-A6pnhVs3.js";import"./refresh-cw-CYYYI9XK.js";const x={name:"button-link",components:{DownloadIcon:O,EditIcon:V,PlusIcon:T,RotateCcwIcon:M,TrashIcon:R,UploadIcon:N},props:{text:{type:String},title:{type:String},path:{required:!0,type:[String,Object]},icon:{type:String},isResponsive:{default:!1,type:Boolean}}},tt={key:0,class:"icon is-small"};function ot(t,o,s,P,a,n){const _=p("plus-icon"),l=p("download-icon"),f=p("upload-icon"),y=p("edit-icon"),r=p("trash-icon"),c=p("rotate-ccw-icon"),v=p("router-link");return d(),h(v,{class:"button",title:s.title,to:s.path},{default:L(()=>[s.icon?.startsWith("fa")?(d(),m("span",tt,[e("i",{class:w(`fa ${s.icon}`)},null,2)])):s.icon==="plus"?(d(),h(_,{key:1,class:"icon is-small"})):s.icon==="download"?(d(),h(l,{key:2,class:"icon is-small"})):s.icon==="upload"?(d(),h(f,{key:3,class:"icon is-small"})):s.icon==="edit"?(d(),h(y,{key:4,class:"icon is-small"})):s.icon==="delete"?(d(),h(r,{key:5,class:"icon is-small"})):s.icon==="restore"?(d(),h(c,{key:6,class:"icon is-small"})):b("",!0),s.text?(d(),m("span",{key:7,class:w({"is-hidden-touch":s.isResponsive})},i(s.text),3)):b("",!0)]),_:1},8,["title","to"])}const et=E(x,[["render",ot]]),st={name:"edit-production-modal",mixins:[B],components:{ComboboxStyled:q,FileUpload:H,ModalFooter:z,TextField:Y},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},productionToEdit:{type:Object,required:!0}},emits:["cancel","confirm","fileselected"],data(){return{form:{},formData:null,productionStyleOptions:C,productionTypeOptions:F}},computed:{...S(["productionStatusOptions"])},methods:{runConfirmation(){this.$emit("confirm",this.form)},onFileSelected(t){this.formData=t,this.$emit("fileselected",t)},resetForm(){this.form={name:this.productionToEdit.name,code:this.productionToEdit.code,project_status_id:this.productionToEdit.project_status_id,production_type:this.productionToEdit.production_type||"short",production_style:this.productionToEdit.production_style||"2d3d",fps:this.productionToEdit.fps,ratio:this.productionToEdit.ratio,resolution:this.productionToEdit.resolution}}},watch:{productionToEdit:{immediate:!0,handler(){this.resetForm()}}}},it={class:"modal-content"},nt={class:"box"},at={class:"title"},lt={class:"label"};function rt(t,o,s,P,a,n){const _=p("text-field"),l=p("combobox-styled"),f=p("file-upload"),y=p("modal-footer"),r=I("focus");return d(),m("div",{class:w(["modal",{"is-active":s.active}])},[e("div",{class:"modal-background",onClick:o[0]||(o[0]=c=>t.$emit("cancel"))}),e("div",it,[e("div",nt,[e("h1",at,i(t.$t("productions.edit_title"))+" "+i(s.productionToEdit.name),1),e("form",{onSubmit:o[9]||(o[9]=$(()=>{},["prevent"]))},[j(u(_,{label:t.$t("productions.fields.name"),onEnter:n.runConfirmation,modelValue:a.form.name,"onUpdate:modelValue":o[1]||(o[1]=c=>a.form.name=c)},null,8,["label","onEnter","modelValue"]),[[r]]),u(_,{label:t.$t("productions.fields.code"),onEnter:n.runConfirmation,modelValue:a.form.code,"onUpdate:modelValue":o[2]||(o[2]=c=>a.form.code=c)},null,8,["label","onEnter","modelValue"]),u(l,{class:"field",label:t.$t("productions.fields.status"),"locale-key-prefix":"productions.status.",options:t.productionStatusOptions,modelValue:a.form.project_status_id,"onUpdate:modelValue":o[3]||(o[3]=c=>a.form.project_status_id=c)},null,8,["label","options","modelValue"]),u(l,{class:"field",label:t.$t("productions.fields.type"),"locale-key-prefix":"productions.type.",options:a.productionTypeOptions,modelValue:a.form.production_type,"onUpdate:modelValue":o[4]||(o[4]=c=>a.form.production_type=c)},null,8,["label","options","modelValue"]),u(l,{class:"field",label:t.$t("productions.fields.style"),"locale-key-prefix":"productions.style.",options:a.productionStyleOptions,modelValue:a.form.production_style,"onUpdate:modelValue":o[5]||(o[5]=c=>a.form.production_style=c)},null,8,["label","options","modelValue"]),u(_,{label:t.$t("productions.fields.fps"),type:"number",max:60,step:.001,onEnter:n.runConfirmation,modelValue:a.form.fps,"onUpdate:modelValue":o[6]||(o[6]=c=>a.form.fps=c)},null,8,["label","onEnter","modelValue"]),u(_,{label:t.$t("productions.fields.ratio"),onEnter:n.runConfirmation,modelValue:a.form.ratio,"onUpdate:modelValue":o[7]||(o[7]=c=>a.form.ratio=c)},null,8,["label","onEnter","modelValue"]),u(_,{label:t.$t("productions.fields.resolution"),onEnter:n.runConfirmation,modelValue:a.form.resolution,"onUpdate:modelValue":o[8]||(o[8]=c=>a.form.resolution=c)},null,8,["label","onEnter","modelValue"]),e("div",null,[e("label",lt,i(t.$t("productions.picture")),1),u(f,{label:t.$t("main.csv.upload_file"),accept:".png,.jpg,.jpeg",onFileselected:n.onFileSelected},null,8,["label","onFileselected"])])],32),u(y,{"error-text":t.$t("productions.edit_error"),"is-error":s.isError,"is-loading":s.isLoading,onConfirm:n.runConfirmation,onCancel:o[10]||(o[10]=c=>t.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const dt=E(st,[["render",rt],["__scopeId","data-v-4a475e00"]]),ct={name:"production-stats",mixins:[W],components:{TaskTypeName:J},props:{stats:{type:Object,default:()=>{}}},data(){return{expanded:!1}},computed:{...S(["taskStatusMap","taskTypeMap"]),expandable(){return this.stats.task_types?.length>0},statusIds(){return Object.keys(this.statsByStatus).sort((t,o)=>this.taskStatusMap.get(t).priority<this.taskStatusMap.get(o).priority)},taskTypes(){const t={Asset:1,Shot:2,Sequence:3,Episode:4,Edit:5,Concept:6};return Object.keys(this.taskTypeStatsMap).map(o=>this.taskTypeMap.get(o)).sort((o,s)=>o.for_entity!==s.for_entity?t[o.for_entity]>t[s.for_entity]:o.priority>s.priority)},taskTypeStatsMap(){const t={};return this.stats.task_types?.forEach(o=>{t[o.task_type_id]||(t[o.task_type_id]={task_type_id:o.task_type_id,amount:0,amount_done:0,total_duration:0,total_estimation:0,task_statuses:[]}),t[o.task_type_id].amount+=o.amount,t[o.task_type_id].amount_done+=o.amount_done,t[o.task_type_id].total_duration+=o.total_duration,t[o.task_type_id].total_estimation+=o.total_estimation,t[o.task_type_id].task_statuses.push(o)}),t},statsByStatus(){const t={};return this.stats.task_types?.forEach(o=>{t[o.task_status_id]||(t[o.task_status_id]=0),t[o.task_status_id]+=o.amount}),t}},methods:{expandStats(){this.expandable&&(this.expanded=!this.expanded)},sortStatuses(t){return t.sort((o,s)=>this.taskStatusMap.get(o.task_status_id).priority<this.taskStatusMap.get(s.task_status_id).priority)}}},ut={class:"nb-tasks"},pt={class:"tag"},mt={class:"tag"},_t={class:"color-wrapper"},ft=["title"],ht={key:0,class:"task-type-stats"},yt={class:"task-type-wrapper flexrow-item"},kt={class:"task-type-wrapper flexrow-item"},bt={class:"task-type-wrapper flexrow-item"},gt={class:"color-wrapper flexrow-item"},Et=["title"];function Pt(t,o,s,P,a,n){const _=p("task-type-name");return d(),m("div",{class:w(["project-stats",{expandable:n.expandable}]),onClick:o[0]||(o[0]=(...l)=>n.expandStats&&n.expandStats(...l))},[e("div",ut,[e("span",pt,i(s.stats.amount_done||0)+" "+i(t.$t("tasks.done"))+" / "+i(s.stats.amount||0)+" "+i(t.$t("tasks.tasks")),1),e("span",mt,i(t.formatDuration(s.stats.total_duration))+" "+i(t.isDurationInHours?t.$tc("main.hours_spent",t.formatDuration(s.stats.total_duration,!1)):t.$tc("main.days_spent",t.formatDuration(s.stats.total_duration,!1)))+" / "+i(t.formatDuration(s.stats.total_estimation))+" "+i(t.isDurationInHours?t.$tc("main.hours_estimated",t.formatDuration(s.stats.total_estimation,!1)):t.$tc("main.days_estimated",t.formatDuration(s.stats.total_estimation,!1))),1)]),e("div",_t,[(d(!0),m(k,null,g(n.statusIds,l=>(d(),m("div",{class:"stat",style:D({backgroundColor:t.taskStatusMap.get(l).color,width:`${n.statsByStatus[l]/s.stats.amount*100}%`}),key:l,title:`${t.taskStatusMap.get(l).name} - ${n.statsByStatus[l]} tasks`},null,12,ft))),128))]),a.expanded?(d(),m("div",ht,[(d(!0),m(k,null,g(n.taskTypes,l=>(d(),m("div",{class:"flexrow task-type-stat",key:l.id},[e("div",yt,[u(_,{class:"flexrow-item task-type-name","task-type":l},null,8,["task-type"])]),e("div",kt,i(n.taskTypeStatsMap[l.id].amount_done)+" / "+i(n.taskTypeStatsMap[l.id].amount)+" "+i(t.$t("tasks.tasks")),1),e("div",bt,i(t.formatDuration(n.taskTypeStatsMap[l.id].total_duration))+" / "+i(t.formatDuration(n.taskTypeStatsMap[l.id].total_estimation))+" "+i(t.isDurationInHours?t.$tc("main.hours",t.formatDuration(n.taskTypeStatsMap[l.id].total_estimation,!1)):t.$tc("main.days",t.formatDuration(n.taskTypeStatsMap[l.id].total_estimation,!1))),1),e("div",gt,[(d(!0),m(k,null,g(n.sortStatuses(n.taskTypeStatsMap[l.id].task_statuses),f=>(d(),m("div",{class:"stat",style:D({backgroundColor:t.taskStatusMap.get(f.task_status_id).color,width:`${f.amount/n.taskTypeStatsMap[l.id].amount*100}%`}),key:l.id+f.task_status_id,title:`${t.taskStatusMap.get(f.task_status_id).name} - ${f.amount} tasks`},null,12,Et))),128))])]))),128))])):b("",!0)],2)}const wt=E(ct,[["render",Pt],["__scopeId","data-v-d37aacbe"]]),St={name:"production-list",props:{entries:{type:Array,default:()=>[]},productionStats:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{ProductionNameCell:K,ProductionStats:wt,RowActionsCell:Q,TableInfo:X},emits:["delete-clicked","edit-clicked"],computed:{...S(["openProductions","lastProductionScreen"]),closedProductions(){return this.entries.filter(t=>t.project_status_name==="Closed")},productionStatsMap(){return this.productionStats}},methods:{getStatusLocale(t){return{Active:"productions.status.open",Open:"productions.status.open",Closed:"productions.status.closed"}[t]},getProductionStyleLabel(t){return C.find(o=>o.value===t)?.label}}},vt={class:"data-list"},Dt={class:"datatable-wrapper"},Ct={class:"datatable multi-section"},Mt={class:"datatable-head"},Tt={scope:"col",class:"name datatable-row-header"},Vt={scope:"col",class:"code"},Ot={scope:"col",class:"type"},Lt={scope:"col",class:"style"},Bt={scope:"col",class:"fps"},Ft={scope:"col",class:"ratio"},It={scope:"col",class:"resolution"},$t={class:"datatable-body"},jt={class:"datatable-type-header"},Ut={scope:"rowgroup",colspan:"6"},At={class:"datatable-row-header"},Nt={class:"datatable-row"},Rt={class:"name datatable-row-header",scope:"row"},qt={class:"code"},Ht={class:"type"},zt={class:"style"},Yt={class:"fps"},Gt={class:"ratio"},Kt={class:"resolution"},Wt={key:0,class:"datatable-row"},Jt={colspan:7,class:"datatable-row-stats"},Qt={key:0},Xt={class:"datatable-type-header"},Zt={scope:"rowgroup",colspan:"6"},xt={class:"datatable-row-header"},to={class:"name datatable-row-header",scope:"row"},oo={class:"code"},eo={class:"type"},so={class:"style"},io={class:"fps"},no={class:"ratio"},ao={class:"resolution"},lo={class:"has-text-centered nb-productions"};function ro(t,o,s,P,a,n){const _=p("production-name-cell"),l=p("row-actions-cell"),f=p("production-stats"),y=p("table-info");return d(),m("div",vt,[e("div",Dt,[e("table",Ct,[e("thead",Mt,[e("tr",null,[e("th",Tt,i(t.$t("productions.fields.name")),1),e("th",Vt,i(t.$t("productions.fields.code")),1),e("th",Ot,i(t.$t("productions.fields.type")),1),e("th",Lt,i(t.$t("productions.fields.style")),1),e("th",Bt,i(t.$t("productions.fields.fps")),1),e("th",Ft,i(t.$t("productions.fields.ratio")),1),e("th",It,i(t.$t("productions.fields.resolution")),1),o[0]||(o[0]=e("th",{scope:"col",class:"actions"},null,-1))])]),e("tbody",$t,[e("tr",jt,[e("th",Ut,[e("span",At,i(t.$t("productions.status.open")),1)])]),(d(!0),m(k,null,g(t.openProductions,r=>(d(),m(k,{key:r.id},[e("tr",Nt,[e("th",Rt,[u(_,{"with-avatar":!0,entry:r,"last-production-screen":t.lastProductionScreen},null,8,["entry","last-production-screen"])]),e("td",qt,i(r.code),1),e("td",Ht,i(t.$t(`productions.type.${r.production_type||"short"}`)),1),e("td",zt,i(t.$t(`productions.style.${n.getProductionStyleLabel(r.production_style)||"2d3d"}`)),1),e("td",Yt,i(r.fps),1),e("td",Gt,i(r.ratio),1),e("td",Kt,i(r.resolution),1),u(l,{onEditClicked:c=>t.$emit("edit-clicked",r),"hide-delete":!0},null,8,["onEditClicked"])]),Object.keys(s.productionStats).length>0?(d(),m("tr",Wt,[e("td",Jt,[u(f,{stats:n.productionStatsMap[r.id]||{}},null,8,["stats"])]),o[1]||(o[1]=e("td",{class:"actions"},null,-1))])):b("",!0)],64))),128))]),n.closedProductions.length>0?(d(),m("tbody",Qt,[e("tr",Xt,[e("th",Zt,[e("span",xt,i(t.$t("productions.status.closed")),1)])]),(d(!0),m(k,null,g(n.closedProductions,r=>(d(),m("tr",{class:"datatable-row",key:r.id},[e("th",to,[u(_,{"with-avatar":!0,entry:r,"last-production-screen":t.lastProductionScreen,"is-link":!1},null,8,["entry","last-production-screen"])]),e("td",oo,i(r.code),1),e("td",eo,i(t.$t(`productions.type.${r.production_type||"short"}`)),1),e("td",so,i(t.$t(`productions.style.${n.getProductionStyleLabel(r.production_style)||"2d3d"}`)),1),e("td",io,i(r.fps),1),e("td",no,i(r.ratio),1),e("td",ao,i(r.resolution),1),u(l,{onEditClicked:c=>t.$emit("edit-clicked",r),onDeleteClicked:c=>t.$emit("delete-clicked",r)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):b("",!0)])]),u(y,{"is-loading":s.isLoading,"is-error":s.isError},null,8,["is-loading","is-error"]),e("p",lo,i(s.entries.length)+" "+i(t.$tc("productions.number",s.entries.length)),1)])}const co=E(St,[["render",ro],["__scopeId","data-v-4b46a65d"]]),uo={name:"productions",components:{ButtonLink:et,ButtonSimple:U,HardDeleteModal:G,EditProductionModal:dt,PageTitle:Z,ProductionList:co},data(){return{errors:{del:!1,edit:!1},loading:{del:!1,edit:!1,stats:!1},modals:{isEditDisplayed:!1,isDeleteDisplayed:!1},productionStats:{},productionToDelete:null,productionToEdit:null}},computed:{...S(["isProductionsLoading","isProductionsLoadingError","productionAvatarFormData","productions"]),currentLockText(){return this.productionToDelete?.name||""}},async created(){await this.loadProductions()},methods:{...A(["deleteProduction","editProduction","loadProductions","loadProductionStats","storeProductionPicture","uploadProductionAvatar"]),async confirmEditProduction(t){this.loading.edit=!0,this.errors.edit=!1;try{this.productionAvatarFormData&&await this.uploadProductionAvatar(this.productionToEdit.id),await this.editProduction({...t,id:this.productionToEdit.id}),this.modals.isEditDisplayed=!1}catch(o){console.error(o),this.errors.edit=!0}this.loading.edit=!1},confirmDeleteProduction(){this.loading.del=!0,this.errors.del=!1,this.deleteProduction(this.productionToDelete).then(()=>{this.modals.isDeleteDisplayed=!1,this.loading.del=!1}).catch(t=>{console.error(t),this.errors.del=!0,this.loading.del=!1})},deleteText(){const t=this.productionToDelete;return t?this.$t("productions.delete_text",{name:t.name}):""},onEditClicked(t){this.storeProductionPicture(null),this.productionToEdit=t,this.modals.isEditDisplayed=!0},onDeleteClicked(t){this.productionToDelete=t,this.modals.isDeleteDisplayed=!0},onProductionPictureSelected(t){this.storeProductionPicture(t)},async reloadStats(){this.loading.stats=!0,this.productionStats=await this.loadProductionStats(),this.loading.stats=!1}},head(){return{title:`${this.$t("productions.title")} - Kitsu`}}},po={class:"productions page fixed-page"},mo={class:"flexrow page-header"};function _o(t,o,s,P,a,n){const _=p("page-title"),l=p("button-simple"),f=p("button-link"),y=p("production-list"),r=p("edit-production-modal"),c=p("hard-delete-modal");return d(),m("div",po,[e("div",mo,[u(_,{class:"filler",text:t.$t("productions.title")},null,8,["text"]),u(l,{class:"flexrow-item",text:t.$t("productions.load_stats"),"is-loading":a.loading.stats,onClick:n.reloadStats},null,8,["text","is-loading","onClick"]),u(f,{class:"flexrow-item",text:t.$t("productions.new_production"),icon:"plus",path:{name:"new-production"}},null,8,["text"])]),u(y,{entries:t.productions,"production-stats":a.productionStats,"is-loading":t.isProductionsLoading,"is-error":t.isProductionsLoadingError,onDeleteClicked:n.onDeleteClicked,onEditClicked:n.onEditClicked},null,8,["entries","production-stats","is-loading","is-error","onDeleteClicked","onEditClicked"]),a.modals.isEditDisplayed?(d(),h(r,{key:0,active:"","is-loading":a.loading.edit,"is-error":a.errors.edit,"production-to-edit":a.productionToEdit,onCancel:o[0]||(o[0]=v=>a.modals.isEditDisplayed=!1),onFileselected:n.onProductionPictureSelected,onConfirm:n.confirmEditProduction},null,8,["is-loading","is-error","production-to-edit","onFileselected","onConfirm"])):b("",!0),u(c,{active:a.modals.isDeleteDisplayed,"is-loading":a.loading.del,"is-error":a.errors.del,text:n.deleteText(),"error-text":t.$t("productions.delete_error"),"lock-text":n.currentLockText,onCancel:o[1]||(o[1]=v=>a.modals.isDeleteDisplayed=!1),onConfirm:n.confirmDeleteProduction},null,8,["active","is-loading","is-error","text","error-text","lock-text","onConfirm"])])}const Oo=E(uo,[["render",_o]]);export{Oo as default};
//# sourceMappingURL=Productions-CTe3ItaF.js.map
