import{_ as g,ad as C,ae as E,ag as k,aS as T,ai as y,r as d,j as w,c as m,o as c,e as o,f as a,t as u,aj as S,l as D,k as x,d as p,n as $,T as V,a5 as L,F as B,g as F,G as N,m as A,a as M,aa as I,ab as j,ac as q}from"./index-De49fdW1.js";import{L as R}from"./ListPageHeader-D26WmplG.js";import{R as U}from"./RouteTabs-BwB4gFvp.js";const z={name:"edit-studios-modal",mixins:[y],components:{ColorField:T,ComboboxBoolean:k,ModalFooter:E,TextField:C},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},studioToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){return this.studioToEdit?.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},studioToEdit(){this.isEditing?this.form={id:this.studioToEdit.id,name:this.studioToEdit.name,color:this.studioToEdit.color,archived:String(this.studioToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}},G={class:"modal-content"},H={class:"box"},K={key:0,class:"title"},O={key:1,class:"title"};function P(e,t,l,h,i,s){const f=d("text-field"),_=d("color-field"),n=d("combobox-boolean"),b=d("modal-footer"),v=w("focus");return c(),m("div",{class:$(["modal",{"is-active":l.active}])},[o("div",{class:"modal-background",onClick:t[0]||(t[0]=r=>e.$emit("cancel"))}),o("div",G,[o("div",H,[s.isEditing?(c(),m("h1",K,u(e.$t("studios.edit_title"))+" "+u(l.studioToEdit.name),1)):(c(),m("h1",O,u(e.$t("studios.new_studios")),1)),o("form",{onSubmit:t[4]||(t[4]=S(()=>{},["prevent"]))},[D(a(f,{ref:"nameField",label:e.$t("studios.fields.name"),maxlength:30,modelValue:i.form.name,"onUpdate:modelValue":t[1]||(t[1]=r=>i.form.name=r)},null,8,["label","modelValue"]),[[v]]),a(_,{label:e.$t("studios.fields.color"),modelValue:i.form.color,"onUpdate:modelValue":t[2]||(t[2]=r=>i.form.color=r)},null,8,["label","modelValue"]),s.isEditing?(c(),x(n,{key:0,label:e.$t("main.archived"),onEnter:s.runConfirmation,modelValue:i.form.archived,"onUpdate:modelValue":t[3]||(t[3]=r=>i.form.archived=r)},null,8,["label","onEnter","modelValue"])):p("",!0)],32),a(b,{"error-text":e.$t("studios.create_error"),"is-error":l.isError,"is-loading":l.isLoading,onConfirm:s.runConfirmation,onCancel:t[5]||(t[5]=r=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const J=g(z,[["render",P],["__scopeId","data-v-b9c444e1"]]),Q={name:"studio-list",props:["entries","isLoading","isError"],components:{RowActionsCell:L,TableInfo:V},emits:["delete-clicked","edit-clicked"]},W={class:"data-list"},X={class:"datatable-wrapper"},Y={class:"datatable"},Z={class:"datatable-head"},ee={scope:"col",class:"name"},te={scope:"col"},ie={key:0,class:"datatable-body"},oe={class:"name"},se={class:"color"},le={class:"has-text-centered nb-asset-types"};function de(e,t,l,h,i,s){const f=d("row-actions-cell"),_=d("table-info");return c(),m("div",W,[o("div",X,[o("table",Y,[o("thead",Z,[o("tr",null,[o("th",ee,u(e.$t("studios.fields.name")),1),o("th",te,u(e.$t("studios.fields.color")),1),t[0]||(t[0]=o("th",{scope:"col",class:"actions"},null,-1))])]),l.entries.length>0?(c(),m("tbody",ie,[(c(!0),m(B,null,F(l.entries,n=>(c(),m("tr",{class:"datatable-row",key:n.id},[o("td",oe,u(n.name),1),o("td",se,[o("div",null,[o("span",{style:N({background:n.color})},null,4)])]),a(f,{onEditClicked:b=>e.$emit("edit-clicked",n),onDeleteClicked:b=>e.$emit("delete-clicked",n)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):p("",!0)])]),a(_,{"is-loading":l.isLoading,"is-error":l.isError},null,8,["is-loading","is-error"]),o("p",le,u(l.entries.length)+" "+u(e.$tc("studios.number",l.entries.length)),1)])}const ae=g(Q,[["render",de],["__scopeId","data-v-33df9267"]]),ne={name:"studios",components:{DeleteModal:I,EditStudiosModal:J,ListPageHeader:R,RouteTabs:U,StudioList:ae},data(){return{activeTab:"active",studioToEdit:null,studioToDelete:null,errors:{studios:!1,edit:!1,del:!1},loading:{studios:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.studios=!0,this.errors.studios=!1;try{await this.loadStudios()}catch(e){console.error(e),this.errors.studios=!0}this.loading.studios=!1},computed:{...M(["studios","archivedStudios"]),isActiveTab(){return this.activeTab==="active"},studioList(){return this.isActiveTab?this.studios:this.archivedStudios},deleteText(){return this.studioToDelete?this.$t("studios.delete_text",{name:this.studioToDelete.name}):""}},methods:{...A(["deleteStudio","editStudio","loadStudios","newStudio"]),onExportClicked(){const e=j.slugify(this.$t("studios.title")),l=[[this.$t("main.type"),this.$t("studios.fields.name"),this.$t("studios.fields.color")]].concat(this.studios.map(h=>[h.type,h.name,h.color]));q.buildCsvFile(e,l)},onNewClicked(){this.studioToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(e){this.studioToEdit=e,this.modals.edit=!0},async confirmEditStudio(e){this.loading.edit=!0,this.errors.edit=!1,e.id=this.studioToEdit?.id;try{e.id?await this.editStudio(e):await this.newStudio(e),this.modals.edit=!1}catch(t){console.error(t),this.errors.edit=!0}this.loading.edit=!1},onDeleteClicked(e){this.studioToDelete=e,this.modals.del=!0},async confirmDeleteStudio(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteStudio(this.studioToDelete),this.modals.del=!1}catch(e){console.error(e),this.errors.del=!0}this.loading.del=!1}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("studios.title")} - Kitsu`}}},re={class:"studios page fixed-page"};function ce(e,t,l,h,i,s){const f=d("list-page-header"),_=d("route-tabs"),n=d("studio-list"),b=d("edit-studios-modal"),v=d("delete-modal");return c(),m("div",re,[a(f,{title:e.$t("studios.title"),"new-entry-label":e.$t("studios.new_studios"),"is-exportable":s.isActiveTab,onExportClicked:s.onExportClicked,onNewClicked:s.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),a(_,{class:"mt2","active-tab":i.activeTab,tabs:i.tabs},null,8,["active-tab","tabs"]),a(n,{class:"studio-list",entries:s.studioList,"is-loading":i.loading.studios,"is-error":i.errors.studios,onEditClicked:s.onEditClicked,onDeleteClicked:s.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),a(b,{active:i.modals.edit,"is-loading":i.loading.edit,"is-error":i.errors.edit,"studio-to-edit":i.studioToEdit,onCancel:t[0]||(t[0]=r=>i.modals.edit=!1),onConfirm:s.confirmEditStudio},null,8,["active","is-loading","is-error","studio-to-edit","onConfirm"]),a(v,{active:i.modals.del,"is-loading":i.loading.del,"is-error":i.errors.del,text:s.deleteText,"error-text":e.$t("studios.delete_error"),onCancel:t[1]||(t[1]=r=>i.modals.del=!1),onConfirm:s.confirmDeleteStudio},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const fe=g(ne,[["render",ce],["__scopeId","data-v-67febb31"]]);export{fe as default};
//# sourceMappingURL=Studios-CwT4nA1e.js.map
