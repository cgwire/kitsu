const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-Nv80_3_l.js","assets/index-Dw-uod2x.js","assets/index-D-y_Vfk9.css","assets/FileSaver.min-B211Idvn.js"])))=>i.map(i=>d[i]);
import{br as Te,bd as le,a0 as oe,Q as H,u as ge,bg as ke,o as c,g as M,w as Ve,d as h,I as te,h as S,f,_ as we,aB as xe,S as Ee,U as Ce,R as Me,C as Pe,W as Ie,B as Ye,r as T,c as _,t as x,F as O,e as Q,i as re,H as Ae,as as v,b5 as de,ao as Oe,bw as Be,bA as $,aF as J,bH as Ue,m as z,aG as ee,p as Le,bT as ue,bU as Re,a as Fe,s as ze,A as qe,aY as ce,G as je,l as he,X as me,bz as Ne,b as Qe}from"./index-Dw-uod2x.js";import{f as Ge}from"./format-fMWuo47O.js";import{C as We}from"./Checkbox-in6UcoC-.js";import{C as ye}from"./Combobox-Z_ENhFXj.js";import{C as He}from"./ComboboxNumber-CFsoz7te.js";import{C as Je}from"./ComboboxTaskType-DmSe2PuZ.js";import{C as Xe}from"./ConfirmModal-DnlSFX-8.js";import{D as Ze}from"./DateField-BoSZf4Hb.js";import{B as Ke}from"./BaseModal-CUMx-WEe.js";import{C as $e}from"./ComboboxBoolean-DeubScUy.js";import{M as et}from"./ModalFooter-Dmgqo0ae.js";import{T as _e}from"./TextField-EpYNDuEI.js";import{H as tt}from"./HardDeleteModal-BWVmHjcR.js";import{S as st}from"./Schedule-BRfI1kcB.js";import{T as nt}from"./trash-gURpboxh.js";import{L as it}from"./list-restart-DRAivSf6.js";import{G as at}from"./grip-vertical-Ds04I29U.js";import"./TaskTypeName-CzX-aVdj.js";import"./dom-tO7tlkHV.js";import"./DepartmentName-kmEXEkam.js";import"./list-chevrons-up-down-CP19ULh5.js";import"./briefcase-RN42S3yy.js";const lt={__name:"EditScheduleVersionModal",props:{isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},scheduleVersionToEdit:{type:Object,required:!0},version:{type:String,required:!0},versionOptions:{type:Array,required:!0}},emits:["cancel","confirm"],setup(e,{emit:s}){const a=e,o=s,{t}=Te(),n=le({id:null,name:"",locked:"false",version:a.version||""}),d=le({name:!1}),b=oe(null),V=oe(null),g=H(()=>!!a.scheduleVersionToEdit?.id),p=H(()=>!!n.name&&!d.name),D=H(()=>g.value?t("schedule.edit_version"):t("schedule.create_version")),C=H(()=>[{label:t("schedule.fields.new"),value:"new",separator:!0},{label:`${t("schedule.versions.from")} ${t("schedule.versions.reference")}`,value:"ref",separator:!0},...a.versionOptions.filter(u=>!u.canceled).sort(ge.firstBy("created_at")).map(u=>({label:`${t("schedule.versions.from")} ${u.name}`,value:u.id}))]);function w(u){if(d.name=!1,!u||a.scheduleVersionToEdit.name===u)return;a.versionOptions.map(m=>m.name).includes(u)&&(d.name=!0)}function l(){if(!p.value)return;const u={id:a.scheduleVersionToEdit.id??null,name:n.name,locked:n.locked==="true",version:n.version};o("confirm",u)}return ke(()=>{n.id=a.scheduleVersionToEdit.id||null,n.name=a.scheduleVersionToEdit.name||"",n.locked=a.scheduleVersionToEdit.locked?"true":"false",n.version=a.version||"new",g.value?V.value?.focus():b.value?.focus()}),(u,y)=>(c(),M(Ke,{active:"",title:D.value,onCancel:y[5]||(y[5]=m=>u.$emit("cancel"))},{default:Ve(()=>[h("form",{onSubmit:y[3]||(y[3]=te(()=>{},["prevent"]))},[g.value?S("",!0):(c(),M(ye,{key:0,ref_key:"versionCombobox",ref:b,label:u.$t("schedule.fields.create_from_version"),options:C.value,modelValue:n.version,"onUpdate:modelValue":y[0]||(y[0]=m=>n.version=m)},null,8,["label","options","modelValue"])),f(_e,{ref_key:"nameField",ref:V,label:u.$t("schedule.fields.name"),"error-text":u.$t("schedule.edit_version_exist"),errored:d.name,maxlength:20,onEnter:l,"onUpdate:modelValue":[w,y[1]||(y[1]=m=>n.name=m)],modelValue:n.name,modelModifiers:{trim:!0}},null,8,["label","error-text","errored","modelValue"]),g.value?(c(),M($e,{key:1,label:u.$t("schedule.fields.locked"),modelValue:n.locked,"onUpdate:modelValue":y[2]||(y[2]=m=>n.locked=m)},null,8,["label","modelValue"])):S("",!0)],32),f(et,{"error-text":u.$t("schedule.edit_version_error"),"is-error":e.isError,"is-loading":e.isLoading,"is-disabled":!p.value,onConfirm:l,onCancel:y[4]||(y[4]=m=>u.$emit("cancel"))},null,8,["error-text","is-error","is-loading","is-disabled"])]),_:1},8,["title"]))}},pe="prev",X="ref",fe=1,ot={name:"production-schedule",mixins:[Ge],components:{ButtonSimple:Ye,Checkbox:We,ChevronDownIcon:Ie,ChevronRightIcon:Pe,Combobox:ye,ComboboxNumber:He,ComboboxTaskType:Je,ConfirmModal:Xe,DateField:Ze,EditScheduleVersionModal:lt,GripVerticalIcon:at,HardDeleteModal:tt,ListRestartIcon:it,PeopleAvatar:Me,PeopleName:Ce,Schedule:st,Spinner:Ee,TrashIcon:nt,TextField:_e,XIcon:xe},data(){return{assignments:{assigned:!1,entityTypes:null,excludes:[],forcedDailyQuota:null,loading:!1,saving:!1,startDate:null,endDate:null,task:{},type:null,unassign:!1},availableTaskTypes:[],daysOffByPerson:{},draggedEntities:[],endDate:z().add(6,"months").endOf("day"),entityType:null,isSidePanelOpen:!1,scheduleItems:[],startDate:z().startOf("day"),selectedStartDate:null,selectedEndDate:null,selectedTaskType:null,zoomLevel:fe,zoomOptions:[{label:this.$t("main.week"),value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],mode:pe,modeOptions:[{label:this.$t("schedule.mode_prev"),value:"prev"},{label:this.$t("schedule.mode_real"),value:"real"}],scheduleVersionToEdit:{},version:X,loading:{schedule:!1,editScheduleVersion:!1,applyScheduleVersion:!1,expandSchedule:!1,exportSchedule:!1},errors:{schedule:!1,editScheduleVersion:!1,deleteScheduleVersion:!1,applyScheduleVersion:!1},modals:{editScheduleVersion:!1,deleteScheduleVersion:!1,applyScheduleVersion:!1}}},mounted(){this.reset()},computed:{...Qe(["currentEpisode","currentProduction","isCurrentUserManager","isCurrentUserSupervisor","isTVShow","organisation","personMap","productionAssetTypes","scheduleVersions","user"]),estimatedDailyQuota(){const e=me(this.assignments.startDate),s=me(this.assignments.endDate),a=Ne(e,s),o=this.draggedEntities.reduce((n,d)=>n+(d.children?.length??0),0),t=this.availablePersons.length;return a&&t?o/a/t:0},assetMap(){return he.cache.assetMap},assets(){return he.cache.assets},assetTypeMap(){return je.cache.assetTypeMap},availablePersons(){const e=this.taskTypeMap.get(this.selectedTaskType.task_type_id);return this.team.filter(s=>!this.assignments.excludes.includes(s.id)&&s.role!=="client"&&(["admin","manager"].includes(s.role)||!s.departments.length||s.departments.includes(e?.department_id)))},currentVersion(){return this.scheduleVersions.find(e=>e.id===this.version)},hasDraggedEntities(){return this.draggedEntities.some(e=>e.children.length)},isLockedSchedule(){return this.mode==="real"||this.currentVersion?.locked||!this.isCurrentUserManager},shotMap(){return ce.cache.shotMap},shots(){return ce.cache.shots},taskTypeMap(){return qe.cache.taskTypeMap},team(){return ze(this.currentProduction.team.map(e=>this.personMap.get(e)).filter(e=>e&&!e.is_bot))},isVersioned(){return this.mode==="prev"&&this.version!=="ref"},versionOptions(){const e=this.scheduleVersions.filter(o=>!o.canceled).sort(ge.firstBy("created_at")).map(o=>({label:o.locked?`${o.name} (${this.$t("schedule.versions.locked")})`:o.name,value:o.id})),s=this.scheduleVersions.find(o=>o.id===this.currentProduction.from_schedule_version_id);return[{label:s?`${this.$t("schedule.versions.reference")} (${this.$t("schedule.versions.from")} ${s.name})`:this.$t("schedule.versions.reference"),value:X,separator:!0},...e]},availableEntityTypes(){const e=new Set;return this.scheduleItems.forEach(s=>{const a=this.taskTypeMap.get(s.task_type_id);a?.for_entity&&e.add(a.for_entity)}),Array.from(e).sort()},entityTypeOptions(){const e=[{label:this.$t("main.all"),value:null}];return this.availableEntityTypes.forEach(s=>{e.push({label:s,value:s})}),e},filteredScheduleItems(){return this.entityType?this.scheduleItems.filter(e=>{const s=this.taskTypeMap.get(e.task_type_id);return s&&s.for_entity===this.entityType}):this.scheduleItems}},methods:{...Fe(["applyScheduleVersionToProduction","assignSelectedTasks","createScheduleVersion","createScheduleVersionedTask","deleteScheduleVersion","editProduction","loadAssets","loadAssetTypeScheduleItems","loadEpisodeScheduleItems","loadProductionDaysOff","loadScheduleItems","loadScheduleVersions","loadSequenceScheduleItems","loadShots","loadTasks","loadTasksFromScheduleVersion","saveScheduleItem","unassignPersonFromTask","unassignSelectedTasks","updateScheduleVersion","updateScheduleVersionedTask","updateTask"]),updateRoute({mode:e,type:s,version:a,zoom:o}){const t={...this.$route.query};e!==void 0&&(t.mode=e||void 0),s!==void 0&&(t.type=s||void 0),a!==void 0&&(t.version=a||void 0),o!==void 0&&(t.zoom=String(o)),JSON.stringify(t)!==JSON.stringify(this.$route.query)&&this.$router.push({query:t})},async loadData(){return this.loading.schedule=!0,this.availableTaskTypes=[],await this.loadScheduleVersions(this.currentProduction),this.loadScheduleItems(this.currentProduction).then(e=>{const s=v(this.selectedStartDate),a=v(this.selectedEndDate);e=e.map(o=>{const t=this.taskTypeMap.get(o.task_type_id);let n,d;o.start_date?n=v(o.start_date):n=z(),n.isSameOrAfter(a)&&(n=a.clone().add(-1,"days")),n.isBefore(s)&&(n=s.clone()),o.end_date?d=v(o.end_date):d=n.clone().add(1,"days"),d.isSameOrAfter(a)&&(d=a.clone());const b=ue(t.id,this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,t.for_entity);return{...o,color:t.color,for_entity:t.for_entity,name:`${t.for_entity} / ${t.name}`,priority:t.priority,startDate:n,endDate:d,editable:this.isInDepartment(t)&&!this.isLockedSchedule,expanded:!1,loading:!1,route:t.for_entity==="Shot"&&this.isTVShow?null:b,children:[]}}),this.scheduleItems=Re(e,this.currentProduction,this.taskTypeMap),this.availableTaskTypes=this.scheduleItems.map(o=>({...this.taskTypeMap.get(o.task_type_id),name:o.name}))}).finally(()=>{this.loading.schedule=!1})},async reset(){this.closeSidePanel(),this.currentProduction.start_date&&(this.startDate=v(this.currentProduction.start_date)),this.currentProduction.end_date&&(this.endDate=v(this.currentProduction.end_date)),this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate(),await this.loadData();const e=this.$route.query.mode,s=this.$route.query.type,a=this.$route.query.version,o=Number(this.$route.query.zoom);this.mode=this.modeOptions.map(t=>t.value).includes(e)?e:pe,this.entityType=this.entityTypeOptions.map(t=>t.value).includes(s)?s:null,this.version=this.versionOptions.map(t=>t.value).includes(a)?a:X,this.zoomLevel=this.zoomOptions.map(t=>t.value).includes(o)?o:fe},convertScheduleItems(e,s){return s.map(a=>{let o;a.start_date?o=v(a.start_date):o=z(),o.isBefore(this.startDate)&&(o=this.startDate.clone()),o.isAfter(this.endDate)&&(o=this.endDate.clone());let t;a.end_date?t=v(a.end_date):t=o.clone().add(1,"days"),t.isBefore(o)&&(t=o.clone().add(1,"days")),t.isAfter(this.endDate)&&(t=this.endDate.clone());const n={...a,startDate:o,endDate:t,expanded:!1,loading:!1,editable:this.isInDepartment(this.taskTypeMap.get(a.task_type_id))&&!this.isLockedSchedule,children:[],parentElement:e};return this.isTVShow&&(n.route=ue(a.task_type_id,this.currentProduction.id,a.object_id,e.for_entity)),n})},async expandTaskTypeElement(e,s=null,a=!1,o=!0){if(e.expanded=a||!e.expanded,e.expanded){try{e.loading=!0,this.selectedTaskType=this.isTVShow?null:e,this.assignments.loading=o,e.children=[],e.people={},e.entitiesByType={};const t=this.isTVShow?["Asset","Shot"].includes(e.for_entity)?this.loadEpisodeScheduleItems:this.loadSequenceScheduleItems:e.for_entity==="Shot"?this.loadSequenceScheduleItems:e.for_entity==="Sequence"?this.loadSequenceScheduleItems:this.loadAssetTypeScheduleItems,n={production:this.currentProduction,taskType:this.taskTypeMap.get(e.task_type_id)},d=await t(n);let b=this.convertScheduleItems(e,d);const V=new Map(b.map(g=>[g.object_id,g]));if(this.isTVShow)e.children=b;else{e.for_entity==="Asset"&&await this.loadAssets({withShared:!1,withTasks:!1}),e.for_entity==="Shot"&&await this.loadShots();let g=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:e.task_type_id,relations:"true"});if(this.isVersioned){const l=this.taskTypeMap.get(e.task_type_id),u=await this.loadTasksFromScheduleVersion({version:{id:this.version},taskType:l}),y=new Map(u.map(m=>[m.task_id,m]));g=g.map(m=>{const r=y.get(m.id);return r?.start_date?{...m,versionedTaskId:r.id,start_date:r.start_date,due_date:r.due_date,estimation:r.estimation,assignees:r.assignees}:null}).filter(Boolean)}this.daysOffByPerson=await this.loadProductionDaysOff({startDate:this.startDate.format("YYYY-MM-DD"),endDate:this.endDate.format("YYYY-MM-DD")}).catch(()=>({}));const p={},D={};g.forEach(l=>{l.start_date&&(e.for_entity==="Asset"?(l.entity=this.assetMap.get(l.entity_id),l.entity_type_id=l.entity.asset_type_id):e.for_entity==="Shot"?(l.entity=this.shotMap.get(l.entity_id),l.entity_type_id=l.entity.sequence_id):l.entity_type_id=e.for_entity,!l.entity?.canceled&&(p[l.entity_type_id]||(p[l.entity_type_id]={}),l.assignees.length||(l.assignees=["unassigned"]),l.assignees.forEach(u=>{const y=V.get(l.entity_type_id);let m;if(this.mode==="real"){if(!l.real_start_date)return;m=v(l.real_start_date)}else m=v(l.start_date);if(m.isAfter(this.endDate))return;m.isBefore(y.startDate)&&(y.startDate=m.clone()),l.startDate=m;let r;if(this.mode==="real"?r=l.done_date?v(l.done_date):z.tz():l.due_date?r=v(l.due_date):l.end_date?r=v(l.end_date):l.estimation&&(r=J(l.startDate,Math.ceil(ee(this.organisation,l.estimation))-1,this.daysOffByPerson[u])),!r||r.isBefore(m)){const E=m.isoWeekday()===5?3:1;r=m.clone().add(E,"days")}if(!r.isSameOrAfter(m)){const E=m.isoWeekday()===5?3:1;r=m.clone().add(E,"days")}r.isBefore(this.startDate)||(r.isAfter(y.endDate)&&(y.endDate=r.clone()),l.endDate=r,p[l.entity_type_id][u]||(p[l.entity_type_id][u]=[],D[u]=u!=="unassigned"?{...this.personMap.get(u),daysOff:this.daysOffByPerson[u]}:{id:u,avatar:!1,color:"#888",full_name:this.$t("main.unassigned")}),l.editable=!this.isLockedSchedule,l.unresizable=!1,l.parentElement=y,p[l.entity_type_id][u].push(l))})))}),e.for_entity==="Asset"&&(b=b.filter(l=>{const u=this.assetTypeMap.get(l.object_id);return u&&(!u.task_types.length||u.task_types.includes(e.task_type_id))}));const C=([l],[u])=>l==="unassigned"?1:u==="unassigned"?-1:D[l].full_name.localeCompare(D[u].full_name),w=(l,u)=>l.entity?.name.localeCompare(u.entity?.name,void 0,{numeric:!0});b.forEach(l=>{const u=p[l.object_id]||{},y=new Map(Object.entries(u).sort(C).map(([m,r])=>[m,r.sort(w)]));l.children=y}),e.children=Le(b),e.people=D,e.entitiesByType=Object.fromEntries(Object.entries(p).map(([l,u])=>[l,Object.entries(u).flatMap(([y,m])=>y!=="unassigned"?m.map(r=>r.entity_id):void 0).filter(Boolean)]))}}catch(t){console.error(t),e.children=[],e.people=[]}finally{e.loading=!1}s&&s(e),this.selectTaskTypeElement(e,null,o)}},filteredAssignments(e){return this.assignments.assigned?e:e.filter(s=>!s.assigned)},saveTaskChanged(e){return this.isVersioned?this.updateScheduleVersionedTask({id:e.versionedTaskId,estimation:e.estimation,startDate:e.startDate.format("YYYY-MM-DD"),dueDate:e.endDate.format("YYYY-MM-DD"),assignees:e.assignees}):this.updateTask({taskId:e.id,data:{estimation:e.estimation,start_date:e.startDate.format("YYYY-MM-DD"),due_date:e.endDate.format("YYYY-MM-DD")}})},async onScheduleItemChanged(e){if(e.type==="Task"){const s=e.assignees.flatMap(a=>this.daysOffByPerson[a]).filter(Boolean);e.startDate=J(e.startDate,0,s),e.endDate=J(e.startDate,Math.ceil(ee(this.organisation,e.estimation))-1,s),e.startDate.isBefore(e.parentElement.startDate)&&(e.parentElement.startDate=e.startDate.clone(),this.updateScheduleItem(e.parentElement),e.parentElement.startDate.isBefore(e.parentElement.parentElement.startDate)&&(e.parentElement.parentElement.startDate=e.parentElement.startDate.clone(),this.updateScheduleItem(e.parentElement.parentElement))),e.endDate.isAfter(e.parentElement.endDate)&&(e.parentElement.endDate=e.endDate.clone(),this.updateScheduleItem(e.parentElement),e.parentElement.endDate.isAfter(e.parentElement.parentElement.endDate)&&(e.parentElement.parentElement.endDate=e.parentElement.endDate.clone(),this.updateScheduleItem(e.parentElement.parentElement))),await this.saveTaskChanged(e);return}if(e.startDate&&e.endDate&&e.parentElement)e.parentElement.startDate=this.getMinDate(e.parentElement),e.parentElement.endDate=this.getMaxDate(e.parentElement),this.isVersioned||this.saveScheduleItem(e.parentElement);else if(!e.parentElement){const s=this.getMinDate(e),a=this.getMaxDate(e);e.startDate.isAfter(s)&&(e.startDate=s),e.endDate.isBefore(a)&&(e.endDate=a)}await this.updateScheduleItem(e)},async updateScheduleItem(e){const s=this.scheduleItems.find(a=>a===e);s&&(s.startDate=e.startDate,s.start_date=e.startDate.format("YYYY-MM-DD"),s.endDate=e.endDate,s.end_date=e.endDate.format("YYYY-MM-DD")),this.isVersioned||await this.saveScheduleItem(e)},getMinDate(e){let s=this.endDate.clone();return e.children.forEach(a=>{a.startDate&&a.startDate.isBefore(s)&&(s=a.startDate)}),s.clone()},getMaxDate(e){let s=this.startDate.clone();return e.children.forEach(a=>{a.endDate&&a.endDate.isAfter(s)&&(s=a.endDate)}),s.clone()},isInDepartment(e){return this.isCurrentUserManager?!0:this.isCurrentUserSupervisor?this.user.departments.length===0?!0:e.department_id&&this.user.departments.includes(e.department_id):!1},scrollScheduleToToday(){this.$refs.schedule?.scrollToToday()},resetSidePanel(){this.assignments={...this.assignments,entityTypes:null,excludes:[],forcedDailyQuota:null,loading:!1,saving:!1,startDate:null,endDate:null,task:{},type:null,unassign:!1}},toggleSidePanel(){this.isSidePanelOpen&&this.assignments.type==="task"&&(this.assignments.type=null,this.isSidePanelOpen=!1),this.isSidePanelOpen=!this.isSidePanelOpen,this.isSidePanelOpen&&this.assignments.type!=="task"&&!this.assignments.entityTypes&&this.selectedTaskType&&this.selectTaskTypeElement(this.selectedTaskType)},selectParentElement(e){e.expanded?this.selectTaskTypeElement(e):this.expandTaskTypeElement(e,()=>{this.$refs.schedule?.refreshItemPositions(e)})},onSelectTaskType(e){this.selectedTaskType=this.scheduleItems.find(s=>s.task_type_id===e),this.expandTaskTypeElement(this.selectedTaskType,()=>{this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)},!0,!1)},async selectTaskTypeElement(e,s=void 0,a=!0){if(this.isTVShow)return;this.selectedTaskType=e,a&&this.resetSidePanel(),this.assignments.loading=!0;const o=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:this.selectedTaskType.task_type_id,relations:"true"});if(e.for_entity==="Asset")await this.loadAssets({withShared:!1,withTasks:!1}),this.assignments.entityTypes=this.productionAssetTypes.filter(t=>!t.task_types.length||t.task_types.includes(e.task_type_id)).map(t=>({id:t.id,name:t.name,for_entity:e.for_entity,expanded:t.id===s?.object_id,entity_type_id:t.id,children:this.assets.filter(n=>n.asset_type_id===t.id&&!n.canceled&&!n.shared&&o.some(d=>d.entity_id===n.id)).map(n=>({...n,assigned:e.entitiesByType[t.id]?.includes(n.id)}))}));else if(e.for_entity==="Shot"){await this.loadShots();const t=this.shots.filter(n=>o.some(d=>d.entity_id===n.id)).reduce((n,d)=>(n[d.parent_id]||(n[d.parent_id]=[]),d.assigned=e.entitiesByType[d.parent_id]?.includes(d.id),n[d.parent_id].push(d),n),{});this.assignments.entityTypes=Object.keys(t).map(n=>{const d=t[n];return{id:n,name:d[0].sequence_name,for_entity:e.for_entity,expanded:n===s?.object_id,children:d}})}this.assignments.loading=!1},selectTaskElement(e,s,a,o){if(o.length!==1){this.closeSidePanel();return}this.resetSidePanel(),this.isSidePanelOpen=!0,this.selectedTaskType=e,this.draggedEntities=[{...s,children:[{...a.entity}]}],this.assignments.type="task";const t=e.start_date,n=v(t).isAfter(e.end_date)?t:e.end_date;this.assignments.startDate=t,this.assignments.endDate=n,this.assignments.task={...a,estimation:ee(this.organisation,a.estimation),startDate:a.startDate.format("YYYY-MM-DD"),endDate:a.endDate.format("YYYY-MM-DD")},this.assignments.excludes=this.team.filter(d=>!a.assignees.includes(d.id)).map(d=>d.id),this.assignments.unassign=!0},closeSidePanel(){this.isSidePanelOpen=!1,this.resetSidePanel()},onAssignmentItemSelected(e){const s=z().utc().toDate();this.assignments.type="entity",this.assignments.startDate=e.start_date||s,this.assignments.endDate=e.end_date||s,e.children=this.filteredAssignments(e.children),this.draggedEntities=[e]},onAssignmentItemDragStart(e,s,a){e.stopPropagation(),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData(`task-type-${a.task_type_id}`,!0),e.dataTransfer.setData("taskTypeId",a.task_type_id),e.dataTransfer.setData("entityId",s.id),s.children=this.filteredAssignments(s.children),this.draggedEntities=[s]},onScheduleItemDropped(e,s){this.assignments.type="entity";const a=e.start_date||s.start_date,o=v(a).isAfter(s.end_date)?a:s.end_date;this.assignments.startDate=a,this.assignments.endDate=o},removeFromAssignments(e){this.assignments.excludes.push(e.id)},submitAssignments(){this.assignments.type==="entity"?this.saveAssignments():this.assignments.type==="task"&&this.saveTask()},async saveAssignments(){this.assignments.saving=!0;const e=await this.loadTasks({project_id:this.currentProduction.id,task_type_id:this.selectedTaskType.task_type_id,relations:"true"}),a=1/(this.assignments.forcedDailyQuota??this.estimatedDailyQuota);for(const o of this.draggedEntities){const t=v(this.assignments.startDate),n=v(this.assignments.endDate);let d=0,b=0,V=t.clone();for(const g of o.children){const p=e.find(l=>l.entity_id===g.id);if(!p)continue;let D;this.isVersioned&&(D=(await this.loadTasksFromScheduleVersion({version:{id:this.version},taskType:{id:p.task_type_id}})).find(u=>u.task_id===p.id)??{taskId:p.id,version:this.version,assignees:[]},p.versionedTaskId=D.id),this.assignments.unassign&&(this.isVersioned?D.assignees=[]:await this.unassignSelectedTasks({taskIds:[p.id]})),d++;let C=V,w=null;for(;b<this.availablePersons.length;){const l=this.availablePersons[b];C=J(C,0,this.daysOffByPerson[l.id]);const{due_date:u}=Ue(this.organisation,t,w,d*a,this.daysOffByPerson[l.id]);if(w=v(u),w.isAfter(n))b++,d=1,C=t.clone(),w=null;else{this.isVersioned?(D.startDate=C.format("YYYY-MM-DD"),D.dueDate=w.format("YYYY-MM-DD"),D.estimation=$(this.organisation,a),D.assignees.push(l.id),D.id?await this.updateScheduleVersionedTask(D):await this.createScheduleVersionedTask(D)):await Promise.all([this.assignSelectedTasks({personId:l.id,taskIds:[p.id]}),this.updateTask({taskId:p.id,data:{estimation:$(this.organisation,a),start_date:C.format("YYYY-MM-DD"),due_date:w.format("YYYY-MM-DD")}})]),d*a%1!==0?V=w.clone():V=w.clone().add(1,"days");break}}}this.expandTaskTypeElement(this.selectedTaskType,()=>{this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)},!0,!1)}this.assignments.saving=!1},async saveTask(){this.assignments.saving=!0;try{const e={...this.assignments.task,startDate:v(this.assignments.task.startDate),endDate:v(this.assignments.task.endDate),estimation:$(this.organisation,this.assignments.task.estimation),assignees:this.availablePersons.map(s=>s.id)};await this.onScheduleItemChanged(e),this.isVersioned||(await this.unassignSelectedTasks({taskIds:[e.id]}),await Promise.all(e.assignees.map(s=>this.assignSelectedTasks({personId:s,taskIds:[e.id]})))),this.assignments.task.startDate=e.startDate.format("YYYY-MM-DD"),this.assignments.task.endDate=e.endDate.format("YYYY-MM-DD"),this.expandTaskTypeElement(this.selectedTaskType,()=>{this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)},!0,!1)}catch(e){console.error(e)}finally{this.assignments.saving=!1}},async onScheduleExpandAll(){this.loading.expandSchedule||(this.loading.expandSchedule=!0,this.expandAll?this.collapseAllScheduleItems():await this.expandAllScheduleItems(),this.expandAll=!this.expandAll,this.loading.expandSchedule=!1)},async onScheduleItemAssigned(e,s){if(e.assignees.push(s),e.parentElement.children.get(s).push(e),this.isVersioned)return this.updateScheduleVersionedTask({id:e.versionedTaskId,assignees:e.assignees});await this.assignSelectedTasks({personId:s,taskIds:[e.id]})},async onScheduleItemUnassigned(e,s){e.assignees=e.assignees.filter(o=>o!==s);const a=e.parentElement.children.get(s);if(a.splice(a.indexOf(e),1),this.isVersioned)return this.updateScheduleVersionedTask({id:e.versionedTaskId,assignees:e.assignees});await this.unassignPersonFromTask({person:{id:s},task:e})},onZoomLevelChanged(e){this.updateRoute({zoom:e})},onEntityTypeChanged(e){this.updateRoute({type:e})},onModeChanged(e){this.updateRoute({mode:e}),this.closeSidePanel(),this.refreshSchedule()},onVersionChanged(e){this.updateRoute({version:e}),this.closeSidePanel(),this.refreshSchedule()},refreshSchedule(){this.scheduleItems.forEach(e=>{e.expanded&&this.expandTaskTypeElement(e,()=>{this.$refs.schedule?.refreshItemPositions(e)},!0,!1)})},openEditScheduleVersion(e={}){this.scheduleVersionToEdit=e,this.modals.editScheduleVersion=!0},openDeleteScheduleVersion(e){this.scheduleVersionToEdit=this.scheduleVersions.find(({id:s})=>s===e),this.modals.deleteScheduleVersion=!0},async editVersion(e){if(this.modals.editScheduleVersion=!1,e.id)await this.updateScheduleVersion(e);else{const s=await this.createScheduleVersion({production:this.currentProduction,version:e});this.version=s.id,this.onVersionChanged(this.version)}this.scheduleVersionToEdit={}},async deleteVersion(e){this.modals.deleteScheduleVersion=!1,await this.deleteScheduleVersion(e),this.version===e.id&&(this.version=X,this.onVersionChanged(this.version)),this.scheduleVersionToEdit={}},async applyToProduction(){this.loading.applyScheduleVersion=!0,this.errors.applyScheduleVersion=!1;try{await this.applyScheduleVersionToProduction(this.version),this.modals.applyScheduleVersion=!1}catch(e){console.error(e),this.errors.applyScheduleVersion=!0}finally{this.loading.applyScheduleVersion=!1}await this.loadScheduleVersions(this.currentProduction)},async expandAllScheduleItems(){for(const e of this.scheduleItems)e.expanded||await this.expandTaskTypeElement(e,()=>{this.$refs.schedule?.refreshItemPositions(e)},!0,!1)},collapseAllScheduleItems(){this.scheduleItems.forEach(e=>{e.expanded=!1})},async exportSchedule(e=!0){this.loading.exportSchedule=!0;try{e&&await this.expandAllScheduleItems();const s=this.$refs.schedule?.exportData(),a=(await de(async()=>{const{default:r}=await import("./exceljs.min-Nv80_3_l.js").then(E=>E.e);return{default:r}},__vite__mapDeps([0,1,2]))).default,o=new a.Workbook,t=o.addWorksheet(this.$t("schedule.title")),n=["","Task Type","Entity","Assignee","Description"],d=s.header.map(r=>r.format("YYYY-MM-DD")),b=t.addRow([...n,...d]);b.font={bold:!0},b.eachCell(r=>{r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFDDDDDD"}},r.border={bottom:{style:"thin"}}});const V=n.length+1;let g=2,p=null;s.hierarchy.forEach(r=>{p=g;const E=t.addRow([null,r.name]);E.getCell(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:r.color.slice(1)}},E.getCell(2).alignment={vertical:"top"},E.getCell(2).note=`${r.name}
${r.start_date} - ${r.end_date}`,E.height=30;const q=d.indexOf(r.start_date),B=d.indexOf(r.end_date),P=r.color.slice(1),U=Oe.lightenColor(r.color,.2).hex().slice(1);for(let i=q;i>-1&&i<=B;i++){const k=E.getCell(5+i);k.fill={type:"pattern",pattern:"solid",fgColor:{argb:P}}}p++;let A=p,I=null;r.children.forEach(i=>{I=A;const k=t.addRow([null,null,i.name,""]);k.getCell(3).alignment={vertical:"top"},k.getCell(3).note=`${i.name}
${i.start_date} - ${i.end_date}`;const G=d.indexOf(i.start_date),De=d.indexOf(i.end_date);for(let L=G;L>-1&&L<=De;L++){const R=k.getCell(V+L);R.fill={type:"pattern",pattern:"solid",fgColor:{argb:U}}}p++,I++;let Z=I,j=null;i.children.forEach((L,R)=>{j=Z;const se=R!=="unassigned",ve=se?this.personMap.get(R):{id:R,avatar:!1,color:"#888",full_name:this.$t("main.unassigned")},K=t.addRow([null,null,null,ve.full_name,se?this.$t("days_off.title"):null]);K.getCell(4).alignment={vertical:"top"},K.getCell(5).alignment={vertical:"middle"},Be(this.daysOffByPerson[R]).forEach(Y=>{const N=d.findIndex(F=>F===Y.date);if(N!==-1){const F=K.getCell(V+N);F.note=`${this.$t("days_off.title")}
${Y.description}`,F.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFAAAAAA"}}}}),p++,I++,j++,L.forEach(Y=>{const N=this.mode==="real"?this.formatDuration(Y.duration):this.formatDuration(Y.estimation),F=t.addRow([null,null,null,null,`${Y.entity.name} (${N}md)`]),ne=Y.startDate.format("YYYY-MM-DD"),ie=Y.endDate.format("YYYY-MM-DD"),Se=d.indexOf(ne),be=d.indexOf(ie);for(let W=Se;W>-1&&W<=be;W++){const ae=F.getCell(V+W);ae.note=`${Y.entity.name}
${ne} - ${ie}
${N} ${this.$t("schedule.md")}`,ae.fill={type:"pattern",pattern:"solid",fgColor:{argb:P}}}p++,I++,j++}),t.mergeCells(Z,4,j-1,4),Z=j}),t.mergeCells(A,3,I-1,3),A=I}),t.mergeCells(g,1,p-1,1),t.mergeCells(g,2,p-1,2),t.getRow(p-1).border={bottom:{style:"medium",color:{argb:P}}},g=p}),t.getColumn(1).width=5;for(let r=0;r<d.length;r++)t.getColumn(n.length+1+r).width=10;const D=(r,E=10,q=100)=>{const B=t.getColumn(r);let P=E;B.eachCell({includeEmpty:!1},U=>{const A=U.value?U.value.toString():"";A.length>P&&(P=A.length)}),B.width=Math.min(P,q)};D(2),D(3),D(4),D(5);const C=await o.xlsx.writeBuffer(),w=`Kitsu - ${this.currentProduction.name} - ${this.$t("schedule.title")}`,l=this.modeOptions.find(({value:r})=>r===this.mode)?.label,u=this.versionOptions.find(({value:r})=>r===this.version)?.label,y=this.isVersioned?`${l} - ${u}`:l;(await de(()=>import("./FileSaver.min-B211Idvn.js").then(r=>r.F),__vite__mapDeps([3,1,2]))).saveAs(new Blob([C]),`${w} (${y}).xlsx`)}catch(s){console.error(s),alert(this.$t("schedule.export_error"))}finally{this.loading.exportSchedule=!1}}},watch:{selectedStartDate(){this.startDate=v(this.selectedStartDate);const e=this.startDate.format("YYYY-MM-DD");this.currentProduction.start_date&&this.currentProduction.start_date!==e&&this.editProduction({...this.currentProduction,start_date:e})},selectedEndDate(){this.endDate=v(this.selectedEndDate);const e=this.endDate.format("YYYY-MM-DD");this.currentProduction.end_date&&this.currentProduction.end_date!==e&&this.editProduction({...this.currentProduction,end_date:e})},currentProduction(e){e&&this.reset()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("schedule.title")} - Kitsu`}}},rt={class:"columns fixed-page"},dt={class:"column main-column"},ut={class:"flexrow project-dates"},ct={class:"flexrow-item"},ht={class:"flexrow-item"},mt={key:1,class:"flexrow-item ml1"},pt={class:"label"},ft={class:"flexrow"},gt={class:"flexrow",style:{"margin-top":"23px"}},yt={key:0,class:"column side-column"},_t={class:"side"},Dt={class:"mt1"},vt={class:"details"},St={key:0,class:"mt2"},bt={key:1,class:"assignments parent mt1"},Tt=["onDragstart","onClick"],kt={class:"name"},Vt=["onClick"],wt={key:0,class:"assignments children"},xt=["onDragstart","onClick"],Et={class:"name"},Ct={key:2,class:"assignments mt1"},Mt={class:"flexrow"},Pt={class:"flexrow-item"},It={class:"flexrow-item"},Yt={key:0},At={key:1,class:"dragged-items"},Ot={class:"assignees"},Bt=["title"],Ut={key:0},Lt={class:"has-text-centered"},Rt={key:1},Ft={class:"assignee"},zt={class:"person"},qt={key:1,class:"flexrow mt2"},jt={class:"mr05"},Nt={key:2,class:"mt2"},Qt={key:3,class:"flexrow mt2"},Gt={class:"flexrow-item"},Wt={class:"flexrow-item"},Ht={key:4,class:"flexrow mt2"},Jt={class:"mt2 has-text-right"},Xt=["disabled","text"];function Zt(e,s,a,o,t,n){const d=T("date-field"),b=T("combobox-number"),V=T("combobox"),g=T("button-simple"),p=T("schedule"),D=T("x-icon"),C=T("combobox-task-type"),w=T("spinner"),l=T("grip-vertical-icon"),u=T("chevron-right-icon"),y=T("chevron-down-icon"),m=T("list-restart-icon"),r=T("people-avatar"),E=T("people-name"),q=T("checkbox"),B=T("text-field"),P=T("trash-icon"),U=T("edit-schedule-version-modal"),A=T("hard-delete-modal"),I=T("confirm-modal");return c(),_(O,null,[h("div",rt,[h("div",dt,[h("div",ut,[h("div",ct,[f(d,{"can-delete":!1,label:e.$t("main.start_date"),utc:"",modelValue:t.selectedStartDate,"onUpdate:modelValue":s[0]||(s[0]=i=>t.selectedStartDate=i)},null,8,["label","modelValue"])]),h("div",ht,[f(d,{"can-delete":!1,label:e.$t("main.end_date"),utc:"",modelValue:t.selectedEndDate,"onUpdate:modelValue":s[1]||(s[1]=i=>t.selectedEndDate=i)},null,8,["label","modelValue"])]),f(b,{class:"flexrow-item zoom-level nowrap",label:e.$t("schedule.zoom_level"),options:t.zoomOptions,modelValue:t.zoomLevel,"onUpdate:modelValue":[s[2]||(s[2]=i=>t.zoomLevel=i),n.onZoomLevelChanged]},null,8,["label","options","modelValue","onUpdate:modelValue"]),n.availableEntityTypes.length>1?(c(),M(V,{key:0,class:"flexrow-item",label:e.$t("main.entities"),modelValue:t.entityType,"onUpdate:modelValue":[s[3]||(s[3]=i=>t.entityType=i),n.onEntityTypeChanged],options:n.entityTypeOptions},null,8,["label","modelValue","options","onUpdate:modelValue"])):S("",!0),f(V,{class:"flexrow-item ml1",label:e.$t("schedule.mode"),modelValue:t.mode,"onUpdate:modelValue":[s[4]||(s[4]=i=>t.mode=i),n.onModeChanged],options:t.modeOptions},null,8,["label","modelValue","options","onUpdate:modelValue"]),t.mode==="prev"?(c(),_("div",mt,[h("label",pt,x(e.$t("schedule.version")),1),h("div",ft,[f(V,{class:"flexrow-item",modelValue:t.version,"onUpdate:modelValue":[s[5]||(s[5]=i=>t.version=i),n.onVersionChanged],options:n.versionOptions},null,8,["modelValue","options","onUpdate:modelValue"]),f(g,{class:"ml05",icon:"calendar-plus",title:e.$t("schedule.new_version"),onClick:s[6]||(s[6]=i=>n.openEditScheduleVersion())},null,8,["title"]),f(g,{class:"ml05",disabled:t.version==="ref",icon:"pencil",title:e.$t("schedule.edit_version"),onClick:s[7]||(s[7]=i=>n.openEditScheduleVersion(n.currentVersion))},null,8,["disabled","title"]),f(g,{class:"ml05",disabled:t.version==="ref",icon:"trash",title:e.$t("schedule.delete_version"),onClick:s[8]||(s[8]=i=>n.openDeleteScheduleVersion(t.version))},null,8,["disabled","title"])])])):S("",!0),s[31]||(s[31]=h("div",{class:"filler"},null,-1)),h("div",gt,[f(g,{class:"flexrow-item",disabled:t.loading.exportSchedule||t.loading.expandSchedule,icon:"export","is-loading":t.loading.exportSchedule,title:e.$t("schedule.export"),onClick:s[9]||(s[9]=i=>n.exportSchedule())},null,8,["disabled","is-loading","title"]),!e.isTVShow&&t.mode==="prev"?(c(),M(g,{key:0,class:"flexrow-item",disabled:t.version==="ref",icon:"save",text:e.$t("schedule.apply_to_prod"),onClick:s[10]||(s[10]=i=>t.modals.applyScheduleVersion=!0)},null,8,["disabled","text"])):S("",!0),f(g,{class:"flexrow-item",icon:"clock",text:e.$t("schedule.today"),onClick:n.scrollScheduleToToday},null,8,["text","onClick"]),e.isTVShow?S("",!0):(c(),M(g,{key:1,active:t.isSidePanelOpen&&t.assignments.type!=="task",class:"flexrow-item",disabled:n.isLockedSchedule,icon:"list",text:e.$t("menu.assign_tasks"),onClick:n.toggleSidePanel},null,8,["active","disabled","text","onClick"]))])]),f(p,{ref:"schedule","start-date":t.startDate,"end-date":t.endDate,hierarchy:n.filteredScheduleItems,"zoom-level":t.zoomLevel,"is-loading":t.loading.schedule,"is-error":t.errors.schedule,"is-estimation-linked":"","hide-man-days":"",multiline:e.isTVShow,reassignable:!n.isLockedSchedule,"show-expand-all":"",subchildren:!e.isTVShow,type:t.mode,onExpandAll:n.onScheduleExpandAll,onItemAssign:n.onScheduleItemAssigned,onItemChanged:n.onScheduleItemChanged,onItemDrop:n.onScheduleItemDropped,onItemSelected:n.selectTaskTypeElement,onItemUnassign:n.onScheduleItemUnassigned,onRootElementExpanded:n.expandTaskTypeElement,onRootElementSelected:n.selectParentElement,onTaskSelected:n.selectTaskElement,onTaskUnselected:s[11]||(s[11]=i=>n.closeSidePanel())},null,8,["start-date","end-date","hierarchy","zoom-level","is-loading","is-error","multiline","reassignable","subchildren","type","onExpandAll","onItemAssign","onItemChanged","onItemDrop","onItemSelected","onItemUnassign","onRootElementExpanded","onRootElementSelected","onTaskSelected"])]),t.isSidePanelOpen&&!n.isLockedSchedule&&!e.isTVShow?(c(),_("div",yt,[h("div",_t,[h("a",{class:"close-button",onClick:s[12]||(s[12]=(...i)=>n.toggleSidePanel&&n.toggleSidePanel(...i))},[f(D,{class:"align-middle",size:16})]),h("h2",Dt,x(t.assignments.type==="task"?e.$t("schedule.edit_task"):e.$t("menu.assign_tasks")),1),h("div",vt,[f(C,{class:"mb05","add-placeholder":"",placeholder:e.$t("schedule.select_task_type"),label:e.$t("news.task_type"),"task-type-list":t.availableTaskTypes,"model-value":t.selectedTaskType?.task_type_id,"onUpdate:modelValue":n.onSelectTaskType},null,8,["placeholder","label","task-type-list","model-value","onUpdate:modelValue"]),!t.assignments.loading&&t.assignments.entityTypes?.length&&!t.assignments.type?(c(),M(g,{key:0,class:"mt2 mb05",icon:"user-check","is-on":t.assignments.assigned,title:e.$t("schedule.show_assigned"),onClick:s[13]||(s[13]=i=>t.assignments.assigned=!t.assignments.assigned)},null,8,["is-on","title"])):S("",!0)]),t.assignments.loading?(c(),_("div",St,[f(w,{class:"mauto",size:20})])):t.assignments.type?(c(),_("div",Ct,[h("form",{class:"mt1",onSubmit:s[25]||(s[25]=te(i=>n.submitAssignments(),["prevent"]))},[h("div",Mt,[h("div",Pt,[f(d,{"can-delete":!1,disabled:t.assignments.type!=="entity",label:e.$t("main.start_date"),utc:"",modelValue:t.assignments.startDate,"onUpdate:modelValue":s[14]||(s[14]=i=>t.assignments.startDate=i)},null,8,["disabled","label","modelValue"])]),h("div",It,[f(d,{"can-delete":!1,disabled:t.assignments.type!=="entity",label:e.$t("main.end_date"),utc:"",modelValue:t.assignments.endDate,"onUpdate:modelValue":s[15]||(s[15]=i=>t.assignments.endDate=i)},null,8,["disabled","label","modelValue"])])]),(c(!0),_(O,null,Q(t.draggedEntities,i=>(c(),_("div",{key:i.id},[h("div",{class:"dragged-type",style:re({background:t.selectedTaskType.color})},x(i.name),5),i.children.length?(c(),_("ul",At,[(c(!0),_(O,null,Q(i.children,k=>(c(),_("li",{class:"dragged-item",key:k.id,style:re({background:`color-mix(in srgb, ${t.selectedTaskType.color} 40%, transparent)`,"border-left":`4px solid ${t.selectedTaskType.color}`})},x(i.name)+" / "+x(k.name),5))),128))])):(c(),_("div",Yt,x(e.$t("schedule.no_entity")),1)),s[32]||(s[32]=h("hr",null,null,-1))]))),128)),h("table",Ot,[h("thead",null,[h("tr",null,[h("td",null,[Ae(x(e.$t("schedule.assign"))+" ",1),t.assignments.excludes.length?(c(),_("a",{key:0,class:"reset-assignees",title:e.$t("schedule.reset_list"),onClick:s[16]||(s[16]=i=>t.assignments.excludes=[])},[f(m,{class:"align-middle",size:18,"stroke-width":1.5})],8,Bt)):S("",!0)])])]),n.availablePersons.length?(c(),_("tbody",Rt,[(c(!0),_(O,null,Q(n.availablePersons,i=>(c(),_("tr",{key:i.id},[h("td",Ft,[h("div",zt,[f(r,{"is-link":!1,"font-size":14,person:i,size:28},null,8,["person"]),f(E,{person:i},null,8,["person"])]),f(g,{class:"is-small",icon:"minus",title:e.$t("main.avatar.unassign",{personName:i.name}),type:"button",onClick:k=>n.removeFromAssignments(i)},null,8,["title","onClick"])])]))),128))])):(c(),_("tbody",Ut,[h("tr",null,[h("td",Lt,x(e.$t("schedule.no_assignee")),1)])]))]),t.assignments.type==="entity"?(c(),M(q,{key:0,class:"pa05",disabled:!n.availablePersons.length,label:e.$t("schedule.force_unassign"),toggle:!0,modelValue:t.assignments.unassign,"onUpdate:modelValue":s[17]||(s[17]=i=>t.assignments.unassign=i)},null,8,["disabled","label","modelValue"])):S("",!0),t.assignments.type==="entity"?(c(),_("div",qt,[h("label",jt,x(e.$t("schedule.forced_daily_quotas")),1),f(B,{class:"mb0 daily-quotas","input-class":" is-small",step:.01,type:"number",modelValue:t.assignments.forcedDailyQuota,"onUpdate:modelValue":s[18]||(s[18]=i=>t.assignments.forcedDailyQuota=i)},null,8,["modelValue"]),t.assignments.forcedDailyQuota?(c(),_("a",{key:0,class:"reset-quotas ml05",onClick:s[19]||(s[19]=i=>t.assignments.forcedDailyQuota=null)},[f(P,{class:"align-middle",size:14})])):S("",!0)])):S("",!0),t.assignments.type==="entity"?(c(),_("div",Nt,x(e.$t("schedule.estimated_daily_quotas"))+" "+x(n.estimatedDailyQuota.toFixed(2)),1)):S("",!0),t.assignments.type==="task"?(c(),_("div",Qt,[h("div",Gt,[f(d,{"can-delete":!1,label:e.$t("main.start_date"),utc:"","with-margin":!1,modelValue:t.assignments.task.startDate,"onUpdate:modelValue":s[20]||(s[20]=i=>t.assignments.task.startDate=i)},null,8,["label","modelValue"])]),h("div",Wt,[f(d,{"can-delete":!1,disabled:"",label:e.$t("main.end_date"),utc:"","with-margin":!1,modelValue:t.assignments.task.endDate,"onUpdate:modelValue":s[21]||(s[21]=i=>t.assignments.task.endDate=i)},null,8,["label","modelValue"])])])):S("",!0),t.assignments.type==="task"?(c(),_("div",Ht,[f(B,{class:"mb0 estimation mr05","input-class":" thin",label:e.$t("main.estimation"),step:.01,placeholder:"0.00",type:"number","unit-label":e.$t("schedule.md"),modelValue:t.assignments.task.estimation,"onUpdate:modelValue":s[22]||(s[22]=i=>t.assignments.task.estimation=i)},null,8,["label","unit-label","modelValue"])])):S("",!0),h("div",Jt,[t.assignments.type==="entity"?(c(),_(O,{key:0},[f(g,{disabled:!n.hasDraggedEntities||!n.availablePersons.length,"is-loading":t.assignments.saving,"is-primary":"",text:e.$t("main.apply"),type:"submit"},null,8,["disabled","is-loading","text"]),h("button",{class:"button is-link ml05",disabled:t.assignments.saving,text:e.$t("main.back"),type:"button",onClick:s[23]||(s[23]=i=>t.assignments.type=null)},x(e.$t("main.back")),9,Xt)],64)):S("",!0),t.assignments.type==="task"?(c(),_(O,{key:1},[f(g,{disabled:!t.assignments.task.estimation,"is-loading":t.assignments.saving,"is-primary":"",text:e.$t("main.apply"),type:"submit"},null,8,["disabled","is-loading","text"]),h("button",{class:"button is-link ml05",onClick:s[24]||(s[24]=i=>n.closeSidePanel())},x(e.$t("main.cancel")),1)],64)):S("",!0)])],32)])):(c(),_("ul",bt,[(c(!0),_(O,null,Q(t.assignments.entityTypes,i=>(c(),_("li",{key:i.id},[h("div",{class:"assignment-item",draggable:"true",onDragstart:k=>n.onAssignmentItemDragStart(k,i,t.selectedTaskType),onClick:k=>n.onAssignmentItemSelected(i)},[f(l,{class:"icon"}),h("span",kt,x(i.name)+" ("+x(n.filteredAssignments(i.children).length)+") ",1),h("span",{class:"expand",onClick:te(k=>i.expanded=!i.expanded,["stop"])},[i.expanded?(c(),M(y,{key:1})):(c(),M(u,{key:0}))],8,Vt)],40,Tt),i.expanded?(c(),_("ul",wt,[(c(!0),_(O,null,Q(n.filteredAssignments(i.children),k=>(c(),_("li",{key:k.id},[h("div",{class:"assignment-item",draggable:"true",onDragstart:G=>n.onAssignmentItemDragStart(G,{...i,children:[k]},t.selectedTaskType),onClick:G=>n.onAssignmentItemSelected({...i,children:[k]})},[f(l,{class:"icon"}),h("span",Et,x(k.name),1)],40,xt)]))),128))])):S("",!0)]))),128))]))])])):S("",!0)]),t.modals.editScheduleVersion?(c(),M(U,{key:0,"schedule-version-to-edit":t.scheduleVersionToEdit,version:t.version,"version-options":e.scheduleVersions,"is-loading":t.loading.editScheduleVersion,"is-error":t.errors.editScheduleVersion,onCancel:s[26]||(s[26]=i=>t.modals.editScheduleVersion=!1),onConfirm:n.editVersion},null,8,["schedule-version-to-edit","version","version-options","is-loading","is-error","onConfirm"])):S("",!0),t.modals.deleteScheduleVersion?(c(),M(A,{key:1,active:"","error-text":e.$t("schedule.delete_version_error"),"is-loading":t.loading.delete,"is-error":t.errors.deleteScheduleVersion,"lock-text":t.scheduleVersionToEdit?.name,text:e.$t("schedule.delete_version_message",{name:t.scheduleVersionToEdit?.name}),onCancel:s[27]||(s[27]=i=>t.modals.deleteScheduleVersion=!1),onConfirm:s[28]||(s[28]=i=>n.deleteVersion(t.scheduleVersionToEdit))},null,8,["error-text","is-loading","is-error","lock-text","text"])):S("",!0),t.modals.applyScheduleVersion?(c(),M(I,{key:2,active:"",text:e.$t("schedule.apply_to_prod_confirm"),"error-text":e.$t("schedule.apply_to_prod_error"),"is-loading":t.loading.applyScheduleVersion,"is-error":t.errors.applyScheduleVersion,onCancel:s[29]||(s[29]=i=>t.modals.applyScheduleVersion=!1),onConfirm:s[30]||(s[30]=i=>n.applyToProduction())},null,8,["text","error-text","is-loading","is-error"])):S("",!0)],64)}const Ss=we(ot,[["render",Zt],["__scopeId","data-v-ff99fb55"]]);export{pe as DEFAULT_MODE,X as DEFAULT_VERSION,fe as DEFAULT_ZOOM,Ss as default};
//# sourceMappingURL=ProductionSchedule-BnpkbaL_.js.map
