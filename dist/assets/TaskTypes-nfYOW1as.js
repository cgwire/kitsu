import{a4 as I,ad as S,a5 as P,cT as N,al as $,aH as q,a6 as U,a8 as A,a7 as F,m as w,_ as V,r as d,k as O,o as h,c as C,e as t,t as n,a9 as B,n as J,f as a,l as g,d as T,p as M,ch as L,as as H,a1 as R,T as j,y as K,cU as v,w as c,aa as z,b as G,cj as Y,ab as Q,ac as W}from"./index-a83mlrHR.js";import{L as X}from"./ListPageHeader-CsF9tYEP.js";import{R as Z}from"./RouteTabs-D3uFztjH.js";import{B as x}from"./BooleanCell-DTDPNyBj.js";const ee={name:"edit-task-type-modal",mixins:[I],components:{BooleanField:S,ComboboxBoolean:P,ComboboxSimple:N,ComboboxDepartment:$,ColorField:q,ModalFooter:U,TextField:A,TextareaField:F},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},taskTypeToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],watch:{taskTypeToEdit(){this.taskTypeToEdit&&(this.form={name:this.taskTypeToEdit.name,short_name:this.taskTypeToEdit.short_name,description:this.taskTypeToEdit.description,color:this.taskTypeToEdit.color,for_entity:this.taskTypeToEdit.for_entity||"Asset",allow_timelog:String(this.taskTypeToEdit.allow_timelog===!0),department_id:this.taskTypeToEdit.department_id,archived:String(this.taskTypeToEdit.archived===!0)})}},data(){return{form:{name:"",short_name:"",description:"",color:"$grey",for_entity:"Asset",allow_timelog:"false",department_id:null,archived:"false"},dedicatedToOptions:[{label:this.$t("assets.title"),value:"Asset"},{label:this.$t("shots.title"),value:"Shot"},{label:this.$t("edits.title"),value:"Edit"},{label:this.$t("sequences.title"),value:"Sequence"},{label:this.$t("episodes.title"),value:"Episode"}]}},computed:{...w(["taskTypes","taskTypeStatusOptions","departments"]),isEditing(){return this.taskTypeToEdit&&this.taskTypeToEdit.id}},methods:{newPriority(e){return this.taskTypes.filter(o=>o.for_entity===e).length+1},confirmClicked(){this.isEditing||(this.form.priority=this.newPriority(this.form.for_entity)),this.$emit("confirm",this.form)}}},te={class:"modal-content"},se={class:"box"},oe={key:0,class:"title"},ie={key:1,class:"title"};function le(e,o,r,p,i,l){const u=d("text-field"),y=d("boolean-field"),k=d("textarea-field"),f=d("combobox-simple"),b=d("combobox-department"),E=d("color-field"),s=d("combobox-boolean"),_=d("modal-footer"),D=O("focus");return h(),C("div",{class:M({modal:!0,"is-active":r.active})},[t("div",{class:"modal-background",onClick:o[0]||(o[0]=m=>e.$emit("cancel"))}),t("div",te,[t("div",se,[l.isEditing?(h(),C("h1",oe,n(e.$t("task_types.edit_title"))+" "+n(r.taskTypeToEdit.name),1)):(h(),C("h1",ie,n(e.$t("task_types.new_task_type")),1)),t("form",{onSubmit:o[9]||(o[9]=B(()=>{},["prevent"]))},[J(a(u,{ref:"nameField",label:e.$t("task_types.fields.name"),modelValue:i.form.name,"onUpdate:modelValue":o[1]||(o[1]=m=>i.form.name=m),onEnter:l.confirmClicked},null,8,["label","modelValue","onEnter"]),[[D]]),a(u,{ref:"shortNameField",label:e.$t("task_types.fields.short_name"),modelValue:i.form.short_name,"onUpdate:modelValue":o[2]||(o[2]=m=>i.form.short_name=m),onEnter:l.confirmClicked},null,8,["label","modelValue","onEnter"]),a(y,{"is-field":"",label:e.$t("task_types.fields.allow_timelog"),onEnter:l.confirmClicked,modelValue:i.form.allow_timelog,"onUpdate:modelValue":o[3]||(o[3]=m=>i.form.allow_timelog=m)},null,8,["label","onEnter","modelValue"]),a(k,{label:e.$t("task_types.fields.description"),modelValue:i.form.description,"onUpdate:modelValue":o[4]||(o[4]=m=>i.form.description=m),onEnter:l.confirmClicked},null,8,["label","modelValue","onEnter"]),l.isEditing?T("",!0):(h(),g(f,{key:0,class:"field",label:e.$t("task_types.fields.dedicated_to"),options:i.dedicatedToOptions,onEnter:l.confirmClicked,modelValue:i.form.for_entity,"onUpdate:modelValue":o[5]||(o[5]=m=>i.form.for_entity=m)},null,8,["label","options","onEnter","modelValue"])),a(b,{label:e.$t("task_types.fields.department"),onEnter:l.confirmClicked,modelValue:i.form.department_id,"onUpdate:modelValue":o[6]||(o[6]=m=>i.form.department_id=m)},null,8,["label","onEnter","modelValue"]),a(E,{class:"mt2",label:e.$t("task_types.fields.color"),modelValue:i.form.color,"onUpdate:modelValue":o[7]||(o[7]=m=>i.form.color=m)},null,8,["label","modelValue"]),l.isEditing?(h(),g(s,{key:1,label:e.$t("main.archived"),onEnter:l.confirmClicked,modelValue:i.form.archived,"onUpdate:modelValue":o[8]||(o[8]=m=>i.form.archived=m)},null,8,["label","onEnter","modelValue"])):T("",!0)],32),a(_,{"error-text":e.$t("task_types.create_error"),"is-loading":r.isLoading,"is-error":r.isError,onConfirm:l.confirmClicked,onCancel:o[10]||(o[10]=m=>e.$emit("cancel"))},null,8,["error-text","is-loading","is-error","onConfirm"])])])],2)}const ae=V(ee,[["render",le],["__scopeId","data-v-bbc709e5"]]),ne={name:"task-type-list",components:{draggable:L,BooleanCell:x,DepartmentName:H,RowActionsCell:R,TableInfo:j,TaskTypeCell:K},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked","update-priorities"],data(){return{assetsItems:[],shotsItems:[],editsItems:[],sequencesItems:[],episodesItems:[]}},computed:{...w(["getDepartment"]),assetTaskTypes(){return this.getTaskTypesForEntity("Asset")},shotTaskTypes(){return this.getTaskTypesForEntity("Shot")},editTaskTypes(){return this.getTaskTypesForEntity("Edit")},sequenceTaskTypes(){return this.getTaskTypesForEntity("Sequence")},episodeTaskTypes(){return this.getTaskTypesForEntity("Episode")}},methods:{getTaskTypesForEntity(e){return this.entries.filter(o=>o.for_entity===e)},updatePriority(e){const o=[];e.forEach((r,p)=>{p+=1;const i={id:r.id,name:r.name,priority:String(p)};r.priority=p,o.push(i)}),this.$emit("update-priorities",o)},updatePriorityAssets(){this.updatePriority(this.assetsItems)},updatePriorityShots(){this.updatePriority(this.shotsItems)},updatePriorityEdits(){this.updatePriority(this.editsItems)},updatePrioritySequences(){this.updatePriority(this.sequencesItems)},updatePriorityEpisodes(){this.updatePriority(this.episodesItems)},isEmpty(e){return e==null||e===""}},watch:{entries:{deep:!0,immediate:!0,handler(){this.assetsItems=JSON.parse(JSON.stringify(this.assetTaskTypes)),this.shotsItems=JSON.parse(JSON.stringify(this.shotTaskTypes)),this.editsItems=JSON.parse(JSON.stringify(this.editTaskTypes)),this.sequencesItems=JSON.parse(JSON.stringify(this.sequenceTaskTypes)),this.episodesItems=JSON.parse(JSON.stringify(this.episodeTaskTypes))}}}},de={class:"data-list"},re={class:"datatable-wrapper"},me={class:"datatable multi-section"},ce={class:"datatable-head"},pe={scope:"col",class:"department"},he={scope:"col",class:"name"},_e={scope:"col",class:"short_name"},ue={scope:"col",class:"allow-timelog"},ye={scope:"col",class:"description"},ke={class:"datatable-type-header"},fe={scope:"rowgroup",colspan:"6"},be={class:"datatable-row-header"},ge={class:"datatable-row tasktype-item"},Te={class:"department"},Ee={class:"short_name"},ve={class:"empty"},Ce={scope:"rowgroup",colspan:"6"},we={class:"text"},Ve={class:"datatable-type-header"},De={scope:"rowgroup",colspan:"6"},Ie={class:"datatable-row-header"},Se={class:"datatable-row tasktype-item"},Pe={class:"department"},Ne={class:"short_name"},$e={class:"empty"},qe={scope:"rowgroup",colspan:"6"},Ue={class:"text"},Ae={class:"datatable-type-header"},Fe={scope:"rowgroup",colspan:"6"},Oe={class:"datatable-row-header"},Be={class:"datatable-row tasktype-item"},Je={class:"department"},Me={class:"short_name"},Le={class:"empty"},He={scope:"rowgroup",colspan:"6"},Re={class:"text"},je={class:"datatable-type-header"},Ke={scope:"rowgroup",colspan:"6"},ze={class:"datatable-row-header"},Ge={class:"datatable-row tasktype-item"},Ye={class:"department"},Qe={class:"short_name"},We={class:"empty"},Xe={scope:"rowgroup",colspan:"6"},Ze={class:"text"},xe={class:"datatable-type-header"},et={scope:"rowgroup",colspan:"6"},tt={class:"datatable-row-header"},st={class:"datatable-row tasktype-item"},ot={class:"department"},it={class:"short_name"},lt={class:"empty"},at={scope:"rowgroup",colspan:"6"},nt={class:"text"},dt={class:"has-text-centered nb-task-types"};function rt(e,o,r,p,i,l){const u=d("department-name"),y=d("task-type-cell"),k=d("boolean-cell"),f=d("row-actions-cell"),b=d("draggable"),E=d("table-info");return h(),C("div",de,[t("div",re,[t("table",me,[t("thead",ce,[t("tr",null,[t("th",pe,n(e.$t("task_types.fields.department")),1),t("th",he,n(e.$t("task_types.fields.name")),1),t("th",_e,n(e.$t("task_types.fields.short_name")),1),t("th",ue,n(e.$t("task_types.fields.allow_timelog")),1),t("th",ye,n(e.$t("task_types.fields.description")),1),o[5]||(o[5]=t("th",{scope:"col",class:"actions"},null,-1))])]),a(b,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:l.updatePriorityAssets,modelValue:i.assetsItems,"onUpdate:modelValue":o[0]||(o[0]=s=>i.assetsItems=s)},v({header:c(()=>[t("tr",ke,[t("th",fe,[t("span",be,n(e.$t("assets.title")),1)])])]),item:c(({element:s})=>[t("tr",ge,[t("td",Te,[l.isEmpty(s.department_id)?T("",!0):(h(),g(u,{key:0,department:e.getDepartment(s.department_id)},null,8,["department"]))]),a(y,{class:"name","task-type":s},null,8,["task-type"]),t("td",Ee,n(s.short_name),1),a(k,{class:"allow-timelog",value:s.allow_timelog},null,8,["value"]),t("td",null,n(s.description),1),a(f,{"task-type-id":s.id,onDeleteClicked:_=>e.$emit("delete-clicked",s),onEditClicked:_=>e.$emit("edit-clicked",s)},null,8,["task-type-id","onDeleteClicked","onEditClicked"])])]),_:2},[i.assetsItems.length?void 0:{name:"footer",fn:c(()=>[t("tr",ve,[t("th",Ce,[t("span",we,n(e.$t("task_types.no_task_types")),1)])])]),key:"0"}]),1032,["onEnd","modelValue"]),a(b,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:l.updatePriorityShots,modelValue:i.shotsItems,"onUpdate:modelValue":o[1]||(o[1]=s=>i.shotsItems=s)},v({header:c(()=>[t("tr",Ve,[t("th",De,[t("span",Ie,n(e.$t("shots.title")),1)])])]),item:c(({element:s})=>[t("tr",Se,[t("td",Pe,[l.isEmpty(s.department_id)?T("",!0):(h(),g(u,{key:0,department:e.getDepartment(s.department_id)},null,8,["department"]))]),a(y,{class:"name","task-type":s},null,8,["task-type"]),t("td",Ne,n(s.short_name),1),a(k,{class:"allow-timelog",value:s.allow_timelog},null,8,["value"]),t("td",null,n(s.description),1),a(f,{"task-type-id":s.id,onDeleteClicked:_=>e.$emit("delete-clicked",s),onEditClicked:_=>e.$emit("edit-clicked",s)},null,8,["task-type-id","onDeleteClicked","onEditClicked"])])]),_:2},[i.shotsItems.length?void 0:{name:"footer",fn:c(()=>[t("tr",$e,[t("th",qe,[t("span",Ue,n(e.$t("task_types.no_task_types")),1)])])]),key:"0"}]),1032,["onEnd","modelValue"]),a(b,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:l.updatePriorityEdits,modelValue:i.editsItems,"onUpdate:modelValue":o[2]||(o[2]=s=>i.editsItems=s)},v({header:c(()=>[t("tr",Ae,[t("th",Fe,[t("span",Oe,n(e.$t("edits.title")),1)])])]),item:c(({element:s})=>[t("tr",Be,[t("td",Je,[l.isEmpty(s.department_id)?T("",!0):(h(),g(u,{key:0,department:e.getDepartment(s.department_id)},null,8,["department"]))]),a(y,{class:"name","task-type":s},null,8,["task-type"]),t("td",Me,n(s.short_name),1),a(k,{class:"allow-timelog",value:s.allow_timelog},null,8,["value"]),t("td",null,n(s.description),1),a(f,{"task-type-id":s.id,onDeleteClicked:_=>e.$emit("delete-clicked",s),onEditClicked:_=>e.$emit("edit-clicked",s)},null,8,["task-type-id","onDeleteClicked","onEditClicked"])])]),_:2},[i.editsItems.length?void 0:{name:"footer",fn:c(()=>[t("tr",Le,[t("th",He,[t("span",Re,n(e.$t("task_types.no_task_types")),1)])])]),key:"0"}]),1032,["onEnd","modelValue"]),a(b,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:l.updatePrioritySequences,modelValue:i.sequencesItems,"onUpdate:modelValue":o[3]||(o[3]=s=>i.sequencesItems=s)},v({header:c(()=>[t("tr",je,[t("th",Ke,[t("span",ze,n(e.$t("sequences.title")),1)])])]),item:c(({element:s})=>[t("tr",Ge,[t("td",Ye,[l.isEmpty(s.department_id)?T("",!0):(h(),g(u,{key:0,department:e.getDepartment(s.department_id)},null,8,["department"]))]),a(y,{class:"name","task-type":s},null,8,["task-type"]),t("td",Qe,n(s.short_name),1),a(k,{class:"allow-timelog",value:s.allow_timelog},null,8,["value"]),t("td",null,n(s.description),1),a(f,{"task-type-id":s.id,onDeleteClicked:_=>e.$emit("delete-clicked",s),onEditClicked:_=>e.$emit("edit-clicked",s)},null,8,["task-type-id","onDeleteClicked","onEditClicked"])])]),_:2},[i.sequencesItems.length?void 0:{name:"footer",fn:c(()=>[t("tr",We,[t("th",Xe,[t("span",Ze,n(e.$t("task_types.no_task_types")),1)])])]),key:"0"}]),1032,["onEnd","modelValue"]),a(b,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:l.updatePriorityEpisodes,modelValue:i.episodesItems,"onUpdate:modelValue":o[4]||(o[4]=s=>i.episodesItems=s)},v({header:c(()=>[t("tr",xe,[t("th",et,[t("span",tt,n(e.$t("episodes.title")),1)])])]),item:c(({element:s})=>[t("tr",st,[t("td",ot,[l.isEmpty(s.department_id)?T("",!0):(h(),g(u,{key:0,department:e.getDepartment(s.department_id)},null,8,["department"]))]),a(y,{class:"name","task-type":s},null,8,["task-type"]),t("td",it,n(s.short_name),1),a(k,{class:"allow-timelog",value:s.allow_timelog},null,8,["value"]),t("td",null,n(s.description),1),a(f,{"task-type-id":s.id,onDeleteClicked:_=>e.$emit("delete-clicked",s),onEditClicked:_=>e.$emit("edit-clicked",s)},null,8,["task-type-id","onDeleteClicked","onEditClicked"])])]),_:2},[i.episodesItems.length?void 0:{name:"footer",fn:c(()=>[t("tr",lt,[t("th",at,[t("span",nt,n(e.$t("task_types.no_task_types")),1)])])]),key:"0"}]),1032,["onEnd","modelValue"])])]),a(E,{"is-loading":r.isLoading,"is-error":r.isError},null,8,["is-loading","is-error"]),t("p",dt,n(r.entries.length)+" "+n(e.$tc("task_types.number",r.entries.length)),1)])}const mt=V(ne,[["render",rt],["__scopeId","data-v-1695b1f8"]]),ct={name:"task-types",components:{DeleteModal:z,EditTaskTypeModal:ae,ListPageHeader:X,RouteTabs:Z,TaskTypeList:mt},data(){return{activeTab:"active",errors:{taskTypes:!1,departments:!1,edit:!1,del:!1},loading:{taskTypes:!1,departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}],taskTypeToDelete:{color:"#999999"},taskTypeToEdit:null}},computed:{...w(["archivedTaskTypes","departmentMap","taskTypes"]),isActiveTab(){return this.activeTab==="active"},listTaskTypes(){return(this.isActiveTab?this.taskTypes:this.archivedTaskTypes).filter(o=>o.for_entity!=="Concept")}},mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.taskTypes=!0,this.errors.taskTypes=!1,this.loading.departments=!0,this.errors.departments=!1,this.loadDepartments().then(()=>{this.loading.departments=!1}).catch(e=>{console.error(e),this.loading.departments=!1,this.errors.departments=!0}),this.loadTaskTypes().then(()=>{this.loading.taskTypes=!1}).catch(e=>{console.error(e),this.loading.taskTypes=!1,this.errors.taskTypes=!0})},methods:{...G(["editTaskType","deleteTaskType","loadTaskTypes","loadDepartments"]),confirmEditTaskType(e){let o="newTaskType";this.taskTypeToEdit&&this.taskTypeToEdit.id&&(o="editTaskType",e.id=this.taskTypeToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(o,e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(r=>{console.error(r),this.loading.edit=!1,this.errors.edit=!0})},updatePriorities(e){e.forEach(o=>{this.$store.commit("EDIT_TASK_TYPE_END",o)}),this.savePriorities(e)},savePriorities(e){const o=new Date().getTime();this.lastCall=this.lastCall||0,o-this.lastCall>1e3&&!this.isSaving?(this.lastCall=o,this.isSaving=!0,Y.runPromiseMapAsSeries(e,this.editTaskType).then(()=>{this.isSaving=!1,this.newSaveCall&&this.savePriorities(e)})):this.newSaveCall=!0},confirmDeleteTaskType(){this.loading.del=!0,this.errors.del=!1,this.deleteTaskType(this.taskTypeToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},deleteText(){const e=this.taskTypeToDelete;return e?this.$t("task_types.delete_text",{name:e.name}):""},onDeleteClicked(e){this.taskTypeToDelete=e,this.modals.del=!0},onEditClicked(e){this.taskTypeToEdit=e,this.modals.edit=!0},onExportClicked(){const e=Q.slugify(this.$t("task_types.title")),r=[[this.$t("main.type"),this.$t("task_types.fields.dedicated_to"),this.$t("task_types.fields.department"),this.$t("task_types.fields.name"),this.$t("task_types.fields.description"),this.$t("task_types.fields.color"),this.$t("task_types.fields.allow_timelog")]].concat(this.taskTypes.map(p=>{var i;return[p.type,p.for_entity,(i=this.departmentMap.get(p.department_id))==null?void 0:i.name,p.name,p.description,p.color,p.allow_timelog]}));W.buildCsvFile(e,r)},onNewClicked(){this.taskTypeToEdit={color:"#999999"},this.modals.edit=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("task_types.title")} - Kitsu`}}},pt={class:"task-types page fixed-page"};function ht(e,o,r,p,i,l){const u=d("list-page-header"),y=d("route-tabs"),k=d("task-type-list"),f=d("edit-task-type-modal"),b=d("delete-modal");return h(),C("div",pt,[a(u,{title:e.$t("task_types.title"),"new-entry-label":e.$t("task_types.new_task_type"),"is-exportable":l.isActiveTab,onExportClicked:l.onExportClicked,onNewClicked:l.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),a(y,{class:"mt2","active-tab":i.activeTab,tabs:i.tabs,"route-name":"task-types"},null,8,["active-tab","tabs"]),a(k,{entries:l.listTaskTypes,"is-loading":i.loading.taskTypes||i.loading.departments,"is-error":i.errors.taskTypes||i.errors.departments,onUpdatePriorities:l.updatePriorities,onEditClicked:l.onEditClicked,onDeleteClicked:l.onDeleteClicked},null,8,["entries","is-loading","is-error","onUpdatePriorities","onEditClicked","onDeleteClicked"]),a(f,{active:i.modals.edit,"is-loading":i.loading.edit,"is-error":i.errors.edit,"task-types":e.taskTypes,"task-type-to-edit":i.taskTypeToEdit,onCancel:o[0]||(o[0]=E=>i.modals.edit=!1),onConfirm:l.confirmEditTaskType},null,8,["active","is-loading","is-error","task-types","task-type-to-edit","onConfirm"]),a(b,{active:i.modals.del,"is-loading":i.loading.del,"is-error":i.errors.del,text:l.deleteText(),"error-text":e.$t("task_types.delete_error"),onCancel:o[1]||(o[1]=E=>i.modals.del=!1),onConfirm:l.confirmDeleteTaskType},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const ft=V(ct,[["render",ht]]);export{ft as default};
//# sourceMappingURL=TaskTypes-nfYOW1as.js.map
