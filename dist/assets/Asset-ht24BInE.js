import{_ as L,O as W,m as E,a as M,q as X,u as Y,r as l,c as r,o as n,f as c,e as s,t as i,F as y,g,d as u,Q as Z,H as J,T as x,R as tt,U as et,W as st,E as nt,X as it,Y as ot,Z as rt,K as at,$ as lt,a0 as ct,a1 as ut,B as dt,z as ht,l as b,k as m,w as v,a2 as A,n as pt,a3 as T,a4 as _t}from"./index-D_tEScdB.js";import{E as mt,a as yt,b as ft,c as kt,e as gt}from"./EntityTaskList-ClHaXf-1.js";import{C as bt}from"./ConceptCard-waYz8GI7.js";import{E as vt}from"./EntityChat-DqzH64Tc.js";import{P as At}from"./PeopleNameCell-PVnH6hfd.js";const Ct={name:"entity-output-files",components:{PeopleNameCell:At,Spinner:Y,TaskTypeCell:X},data(){return{isLoading:!1,outputFiles:[]}},props:{entity:{type:Object,default:()=>{}}},mounted(){this.entity&&this.reset()},computed:{...M(["currentProduction","isCurrentUserArtist","personMap","fileStatusMap","outputFileTypeMap","taskMap","taskTypeMap"])},methods:{...E(["loadEntityOutputFiles","loadFileStatuses","loadOutputTypes"]),getTaskType(t){return this.taskTypeMap.get(t.task_type_id)},getFileStatus(t){return this.fileStatusMap.get(t.file_status_id)},getOutputType(t){return this.outputFileTypeMap.get(t.output_type_id)},renderFileSize:W,async reset(){this.isLoading=!0,this.fileStatusMap.size===0&&await this.loadFileStatuses(),this.outputFileTypeMap.size===0&&await this.loadOutputTypes(),this.outputFiles=await this.loadEntityOutputFiles(this.entity.id),this.isLoading=!1}},watch:{entity(){this.entity&&this.reset()}}},St={class:"mt1 flexcolumn wrapper output-files"},wt={key:0,class:"has-text-centered"},Tt={key:1},It={class:"datatable"},Lt={class:"datatable-head"},Et={class:"datatable-row-header"},Mt={class:"tasktype"},Pt={class:"type"},zt={class:"name"},Bt={class:"extension"},Dt={class:"revision"},Ot={class:"size"},Nt={class:"status"},qt={class:"person"},$t={class:"datatable-body"},Vt={class:"datatable-row"},Ft={class:"type"},Ut={class:"name"},Rt={class:"extension"},jt={class:"revision"},Kt={class:"size"},Gt={class:"status"},Ht={key:0,class:"datatable-row"},Qt={colspan:"10"},Wt={key:2,class:"empty"};function Xt(t,o,p,f,e,d){const S=l("spinner"),k=l("task-type-cell"),C=l("people-name-cell");return n(),r("div",St,[e.isLoading?(n(),r("div",wt,[c(S)])):e.outputFiles.length>0?(n(),r("div",Tt,[s("table",It,[s("thead",Lt,[s("tr",Et,[s("th",Mt,i(t.$t("entities.output_files.task_type")),1),s("th",Pt,i(t.$t("entities.output_files.type")),1),s("th",zt,i(t.$t("entities.output_files.name")),1),s("th",Bt,i(t.$t("entities.output_files.extension")),1),s("th",Dt,i(t.$t("entities.output_files.revision")),1),s("th",Ot,i(t.$t("entities.output_files.size")),1),s("th",Nt,i(t.$t("entities.output_files.status")),1),s("th",qt,i(t.$t("entities.output_files.person")),1),o[0]||(o[0]=s("th",{class:"end-cell"},null,-1))])]),s("tbody",$t,[(n(!0),r(y,null,g(e.outputFiles,_=>(n(),r(y,{key:_.id},[s("tr",Vt,[c(k,{class:"type","task-type":d.getTaskType(_),"production-id":t.currentProduction.id},null,8,["task-type","production-id"]),s("td",Ft,i(d.getOutputType(_).name),1),s("td",Ut,i(_.name),1),s("td",Rt,i(_.extension),1),s("td",jt,i(_.revision),1),s("td",Kt,i(d.renderFileSize(_.file_size)),1),s("td",Gt,i(d.getFileStatus(_).name),1),c(C,{class:"person",person:t.personMap.get(_.person_id)},null,8,["person"]),o[1]||(o[1]=s("td",{class:"end-cell"},null,-1))]),_.path?(n(),r("tr",Ht,[s("td",Qt,i(_.path),1)])):u("",!0)],64))),128))])])])):(n(),r("div",Wt,i(t.$t("entities.output_files.no_output_files")),1))])}const Yt=L(Ct,[["render",Xt],["__scopeId","data-v-f5ea00ce"]]),Zt={name:"asset",mixins:[gt,ht],components:{ButtonSimple:dt,ChevronLeftIcon:ut,ChevronRightIcon:ct,ConceptCard:bt,ComboboxNumber:lt,ComboboxStatus:at,CornerLeftUpIcon:rt,DescriptionCell:ot,EditAssetModal:it,EntityChat:vt,EntityNews:kt,EntityOutputFiles:Yt,EntityPreviewFiles:ft,EntityThumbnail:nt,EntityTaskList:yt,EntityTimeLogs:mt,PageSubtitle:st,RouteSectionTabs:et,Schedule:tt,TableInfo:x,TaskInfo:J,TaskTypeName:Z},data(){return{type:"asset",currentAsset:null,currentConcept:null,currentTask:null,currentConceptStatus:null,currentConceptTask:null,localTasks:[],castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...M(["assetMap","assetSearchText","assetMetadataDescriptors","conceptMap","currentEpisode","currentProduction","getTaskTypePriority","isTVShow","isCurrentUserManager","linkedConcepts","route","taskMap","taskStatusMap","taskTypeMap","shotId"]),title(){return this.currentAsset?`${this.currentAsset.asset_type_name} / ${this.currentAsset.name}`:"Loading..."},assetThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentAsset.preview_file_id}.png`},isPreview(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0},nbShotsCastedIn(){return(this.currentAsset?.castInShotsBySequence||[]).reduce((o,p)=>o+p.length,0)},assetsPath(){const t={name:"assets",params:{production_id:this.currentProduction.id},query:{search:this.assetSearchText||""}};return this.currentEpisode&&(t.name="episode-assets",t.params.episode_id=this.currentEpisode.id),t},assetNavOptions(){return[...this.entityNavOptions.slice(0,2),{label:this.$t("main.label.concepts"),value:"concepts"},...this.entityNavOptions.slice(2),{label:this.$t("main.label.output_files"),value:"output-files"}]},assetTabs(){return this.assetNavOptions.map(t=>({label:t.label,name:t.value}))},taskStatusList(){const t={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},o=_t(Array.from(this.taskStatusMap.values()).filter(p=>p.for_concept));return[t].concat(o)},filteredLinkedConcepts(){return this.currentConceptStatus?this.linkedConcepts.filter(t=>t.tasks[0].task_status_id===this.currentConceptStatus):this.linkedConcepts}},methods:{...E(["addSelectedConcepts","clearSelectedTasks","clearSelectedConcepts","editAsset","loadAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadLinkedConcepts","loadShots","setCurrentEpisode"]),changeTab(t){this.selectedTab=t},getCurrentAsset(){return new Promise((t,o)=>{const p=this.route.params.asset_id;p||t(null);let f=T.cache.assetMap.get(p)||null;if(f)return this.localTasks=f.tasks.map(e=>this.taskMap.get(e)),t(f);if(p)return this.loadAsset(p).then(()=>(f=T.cache.assetMap.get(p),this.localTasks=f.tasks.map(e=>this.taskMap.get(e)),t(f)))})},getConceptTaskStatus(t){return this.taskStatusMap.get(t.tasks[0].task_status_id)},onEditClicked(){this.modals.edit=!0},confirmEditAsset(t){t.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(p=>{console.error(p),this.loading.edit=!1,this.errors.edit=!0});const o=T.cache.assetMap.get(t.id);this.currentAsset={...o}},resetData(){this.castIn.isLoading=!0,this.$route.params.episode_id==="main"&&this.setCurrentEpisode("main"),this.$nextTick(()=>{this.getCurrentAsset().then(t=>(this.currentAsset=t,this.loadAssetCastIn(this.currentAsset))).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(t=>{this.castIn.isError=!0,this.castIn.isLoading=!1,console.error(t)})})},conceptPath(t){return{name:"concepts",params:{production_id:this.currentProduction.id}}},shotPath(t){return{name:t.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:t.shot_id,episode_id:t.episode_id?t.episode_id:void 0}}},init(){return this.getCurrentAsset().then(t=>{this.currentAsset=t,this.currentSection=this.route.query.section||"infos",this.castIn.isLoading=!0,this.castIn.isError=!1,this.currentAsset?this.loadAssetCastIn(this.currentAsset).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(o=>{this.castIn.isLoading=!1,this.castIn.isError=!0,console.error(o)}):this.resetData()}).then(()=>{setTimeout(()=>{this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},100)}).catch(console.error)},selectConcept(t){if(this.currentConcept&&this.currentConcept.id===t.id)this.currentConcept=null,this.currentConceptTask=null,this.clearSelectedConcepts();else{const o=new Map;o.set(t.id,t),this.clearSelectedConcepts(),this.addSelectedConcepts(o),this.currentConcept=t,this.currentConceptTask=t.tasks[0]}}},watch:{currentSection(){this.currentSection==="schedule"&&this.scheduleItems.length>0&&this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},zoomLevel(){this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)}},head(){return{title:`${this.title} - Kitsu`}}},Jt={class:"columns fixed-page asset xyz-in",xyz:"fade"},xt={class:"page column main-column"},te={class:"page-header flexrow"},ee={class:"flexrow-item ml2"},se={class:"entity-title flexrow-item"},ne={key:0,class:"ready-for flexrow block mr0 flexrow-item mt1 mb0"},ie={class:"flexrow-item"},oe={class:"asset-data block"},re={class:"flexrow mt1"},ae={key:0,class:"tag tag-standby"},le={class:"flexrow-item mt05"},ce={class:"flexcolumn infos"},ue={class:"flexrow"},de={class:"flexrow-item has-text-right"},he={class:"table-body metadata-infos"},pe={key:0,class:"datatable no-header"},_e={class:"table-body"},me={class:"datatable-row"},ye={class:"field-label"},fe={class:"field-label"},ke={class:"asset-casted-in"},ge={key:0},be={key:0},ve={class:"shot-sequence"},Ae={class:"shot-list"},Ce={class:"break-word"},Se={key:0},we={key:1,class:"mt1"},Te={key:2},Ie={key:0},Le={class:"asset-type"},Ee={class:"asset-list"},Me={class:"break-word"},Pe={key:0},ze={key:1,class:"concepts"},Be={class:"concept-list mt1"},De={key:1},Oe={key:2,class:"schedule mt1"},Ne={class:"wrapper"},qe={class:"column side-column"},$e={class:"column side-column"};function Ve(t,o,p,f,e,d){const S=l("corner-left-up-icon"),k=l("router-link"),C=l("entity-thumbnail"),_=l("task-type-name"),P=l("chevron-left-icon"),z=l("chevron-right-icon"),B=l("route-section-tabs"),D=l("combobox-number"),w=l("page-subtitle"),O=l("entity-task-list"),N=l("button-simple"),q=l("description-cell"),$=l("entity-chat"),V=l("table-info"),F=l("combobox-status"),U=l("concept-card"),R=l("schedule"),j=l("entity-preview-files"),K=l("entity-time-logs"),G=l("entity-output-files"),H=l("entity-news"),I=l("task-info"),Q=l("edit-asset-modal");return n(),r("div",Jt,[s("div",xt,[s("div",te,[c(k,{class:"flexrow-item has-text-centered back-link ml1",to:d.assetsPath},{default:v(()=>[c(S)]),_:1},8,["to"]),s("span",ee,[e.currentAsset?(n(),m(C,{key:0,class:"entity-thumbnail",entity:e.currentAsset,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):u("",!0)]),s("div",se,i(d.title),1),o[5]||(o[5]=s("div",{class:"filler"},null,-1)),e.currentAsset&&e.currentAsset.ready_for&&e.currentAsset.ready_for!=="None"?(n(),r("div",ne,[s("span",ie,i(t.$t("assets.fields.ready_for")),1),c(_,{class:"flexrow-item","task-type":t.taskTypeMap.get(e.currentAsset.ready_for),"current-production-id":t.currentProduction.id},null,8,["task-type","current-production-id"])])):u("",!0),t.previousEntityPath&&t.entityList.length>1?(n(),m(k,{key:1,class:"flexrow-item has-text-centered back-link ml1",to:t.previousEntityPath},{default:v(()=>[c(P)]),_:1},8,["to"])):u("",!0),t.nextEntityPath&&t.entityList.length>1?(n(),m(k,{key:2,class:"flexrow-item has-text-centered back-link",to:t.nextEntityPath},{default:v(()=>[c(z)]),_:1},8,["to"])):u("",!0)]),s("div",oe,[c(B,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:d.assetTabs},null,8,["active-tab","route","tabs"]),s("div",re,[t.currentSection==="casting"&&e.currentAsset?.is_casting_standby?(n(),r("span",ae,i(t.$t("breakdown.fields.standby")),1)):u("",!0),t.currentSection==="schedule"?(n(),r(y,{key:1},[s("span",le,i(t.$t("schedule.zoom_level"))+": ",1),c(D,{class:"zoom-level flexrow-item","is-simple":"",options:t.zoomOptions,modelValue:t.zoomLevel,"onUpdate:modelValue":o[0]||(o[0]=a=>t.zoomLevel=a)},null,8,["options","modelValue"])],64)):u("",!0)]),b(s("div",ce,[c(w,{text:t.$t("main.tasks")},null,8,["text"]),c(O,{class:"task-list",entries:e.localTasks,"is-loading":!e.currentAsset,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",ue,[c(w,{text:t.$t("main.info")},null,8,["text"]),o[6]||(o[6]=s("div",{class:"filler"},null,-1)),s("div",de,[t.isCurrentUserManager?(n(),m(N,{key:0,icon:"edit",title:t.$t("assets.edit_title"),onClick:o[1]||(o[1]=a=>e.modals.edit=!0)},null,8,["title"])):u("",!0)])]),s("div",he,[e.currentAsset?(n(),r("table",pe,[s("tbody",_e,[s("tr",me,[s("td",ye,i(t.$t("assets.fields.description")),1),c(q,{entry:e.currentAsset,full:!0},null,8,["entry"])]),(n(!0),r(y,null,g(t.assetMetadataDescriptors,a=>(n(),r("tr",{key:a.id,class:"datatable-row"},[s("td",fe,i(a.name),1),s("td",null,i(e.currentAsset.data?e.currentAsset.data[a.field_name]:""),1)]))),128))])])):u("",!0)])],512),[[A,t.currentSection==="infos"]]),t.currentSection==="chat"?(n(),m($,{key:0,entity:e.currentAsset,name:e.currentAsset?.full_name},null,8,["entity","name"])):u("",!0),b(s("div",ke,[e.currentAsset?(n(),r("div",ge,[e.currentAsset.castInShotsBySequence&&e.currentAsset.castInShotsBySequence[0].length>0?(n(),r("div",be,[s("em",null,"Casted in "+i(d.nbShotsCastedIn)+" shots",1),e.currentAsset.castInShotsBySequence.length>0&&e.currentAsset.castInShotsBySequence[0][0].sequence_name?(n(!0),r(y,{key:0},g(e.currentAsset.castInShotsBySequence||[],a=>(n(),r("div",{class:"sequence-shots",key:a?.length>0?a[0].sequence_name:""},[s("div",ve,i(a?.length>0?a[0].sequence_name:""),1),s("div",Ae,[(n(!0),r(y,null,g(a,h=>(n(),m(k,{class:"shot-link",key:h.shot_id,to:d.shotPath(h)},{default:v(()=>[c(C,{class:"entity-thumbnail",entity:h,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",Ce,i(h.shot_name),1),h.nb_occurences>1?(n(),r("span",Se," ("+i(h.nb_occurences)+") ",1)):u("",!0)])]),_:2},1032,["to"]))),128))])]))),128)):u("",!0)])):u("",!0),e.currentAsset&&e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0]?.length===0?(n(),r("div",we,i(t.$t("assets.no_cast_in")),1)):u("",!0)])):(n(),m(V,{key:1,"is-loading":e.castIn.isLoading,"is-error":e.castIn.isError},null,8,["is-loading","is-error"])),e.currentAsset&&e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),r("div",Te,[c(w,{text:t.$t("assets.linked")},null,8,["text"]),e.currentAsset.castingAssetsByType&&e.currentAsset.castingAssetsByType[0].length>0?(n(),r("div",Ie,[(n(!0),r(y,null,g(e.currentAsset.castingAssetsByType,a=>(n(),r("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Le,i(a.length>0?a[0].asset_type_name:"")+" ("+i(a.length)+") ",1),s("div",Ee,[(n(!0),r(y,null,g(a,h=>(n(),m(k,{class:"asset-link",key:h.id,to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:h.asset_id}}},{default:v(()=>[c(C,{class:"entity-thumbnail",entity:h,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",null,[s("span",Me,i(h.asset_name),1),h.nb_occurences>1?(n(),r("span",Pe," ("+i(h.nb_occurences)+") ",1)):u("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):u("",!0)])):u("",!0)],512),[[A,t.currentSection==="casting"]]),e.currentAsset?b((n(),r("div",ze,[c(F,{label:t.$t("main.status"),"task-status-list":d.taskStatusList,modelValue:e.currentConceptStatus,"onUpdate:modelValue":o[2]||(o[2]=a=>e.currentConceptStatus=a)},null,8,["label","task-status-list","modelValue"]),s("div",Be,[d.filteredLinkedConcepts.length?(n(!0),r(y,{key:0},g(d.filteredLinkedConcepts,a=>(n(),m(U,{class:pt(["concept",{selected:e.currentConcept?.id===a.id}]),key:"concept-"+a.id,concept:a,onClick:h=>d.selectConcept(a)},null,8,["class","concept","onClick"]))),128)):(n(),r("div",De,i(t.$t("assets.no_concept")),1))])],512)),[[A,t.currentSection==="concepts"]]):u("",!0),t.scheduleItems[0].children.length>0?b((n(),r("div",Oe,[s("div",Ne,[c(R,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:o[3]||(o[3]=a=>t.saveTaskScheduleItem(a.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[A,t.currentSection==="schedule"]]):u("",!0),t.currentSection==="preview-files"?(n(),m(j,{key:3,entity:e.currentAsset},null,8,["entity"])):u("",!0),t.currentSection==="time-logs"?(n(),m(K,{key:4,entity:e.currentAsset},null,8,["entity"])):u("",!0),t.currentSection==="output-files"?(n(),m(G,{key:5,entity:e.currentAsset},null,8,["entity"])):u("",!0)])]),b(s("div",qe,[c(I,{task:e.currentTask,"entity-type":"Asset","with-actions":""},{default:v(()=>[c(H,{class:"news-column",entity:e.currentAsset},null,8,["entity"])]),_:1},8,["task"])],512),[[A,t.currentSection==="infos"]]),b(s("div",$e,[c(I,{"entity-type":"Concept",task:e.currentConceptTask},null,8,["task"])],512),[[A,t.currentSection==="concepts"]]),c(Q,{ref:"edit-asset-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"asset-to-edit":e.currentAsset,onCancel:o[4]||(o[4]=a=>e.modals.edit=!1),onConfirm:d.confirmEditAsset},null,8,["active","is-loading","is-error","asset-to-edit","onConfirm"])])}const Ge=L(Zt,[["render",Ve],["__scopeId","data-v-a8e692eb"]]);export{Ge as default};
//# sourceMappingURL=Asset-ht24BInE.js.map
