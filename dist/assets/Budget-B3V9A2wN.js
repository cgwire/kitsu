import{a as Y,_ as M,r as m,c,o as l,e as r,d as y,t as d,f as g,u as L,B as k,an as z,m as j,a2 as G,aC as J,aD as W,aE as Z,aF as Q,y as X,ay as O,F as B,g as v,n as T,G as w,k as S,af as A,aG as $,aa as N,ab as U,b as F,j as I,w as V,ag as R,l as q,Z as ee,az as C,aB as te,I as se,L as ne,aH as D,aI as oe,aJ as ie,am as re,a7 as de,a9 as ae}from"./index-ExTMSJD3.js";import{g as le}from"./grablist-Da7oVI-6.js";import{P as ue}from"./PageLayout-C4gRiY_8.js";const ce={computed:{...Y(["currentProduction, currentEpisode, isTVShow"])},methods:{},head(){return this.currentProduction?this.isTVSHow&&this.currentEpisode?{title:`${this.currentProduction.name} - ${this.currentEpisode.name} | {this.pageTitle} - Kitsu`}:{title:`${this.currentProduction.name} | ${this.pageTitle} - Kitsu`}:{title:`${this.pageTitle} - Kitsu`}}},ge={class:"flexcolumn analytics-container"},he={class:"has-text-centered strong mt1"},me={key:0},fe={class:"has-text-centered mt1 strong total"},be={class:"has-text-centered mt1"},ye={key:1},pe={class:"has-text-centered mt2"},_e={key:2,class:"mt1 flexcolumn"},Be={__name:"BudgetAnalytics",props:{amount:{type:Number,default:0},currency:{type:String,default:"USD"},budgets:{type:Array,required:!0},budgetDepartments:{type:Array,required:!0},budgetEntries:{type:Array,required:!0},monthsBetweenProductionDates:{type:Array,required:!0},pieChartData:{type:Array,required:!0},pieChartColors:{type:Array,required:!0},columnChartData:{type:Array,required:!0}},setup(e){return(t,s)=>{const i=m("pie-chart"),o=m("column-chart");return l(),c("div",ge,[r("h3",he,d(t.$t("budget.analytics")),1),e.budgets.length>0&&e.budgetDepartments.length>0?(l(),c("div",me,[r("p",fe,d(e.amount.toLocaleString())+" "+d(e.currency||"USD"),1),r("p",be,d(e.budgetDepartments.length)+" "+d(t.$t("budget.departments"))+" - "+d(e.budgetEntries.length)+" "+d(t.$t("budget.entries"))+" - "+d(e.monthsBetweenProductionDates.length)+" "+d(t.$t("budget.months")),1)])):y("",!0),e.budgets.length===0||e.budgetDepartments.length===0?(l(),c("div",ye,[r("p",pe,d(t.$t("budget.no_analytics_to_show")),1)])):(l(),c("div",_e,[r("h4",null,d(t.$t("budget.cash_repartition")),1),g(i,{class:"mb1",legend:!1,data:e.pieChartData,colors:e.pieChartColors,height:"240px"},null,8,["data","colors"]),r("h4",null,d(t.$t("budget.cash_evolution")),1),g(o,{legend:!1,data:e.columnChartData},null,8,["data"])]))])}}},Ee=M(Be,[["__scopeId","data-v-bbb03d69"]]),ve={class:"budget-header"},we={key:0,class:"has-text-centered"},De={key:1,class:"flexrow mt2"},xe={class:"list-error"},Ce={key:2,class:"no-budget has-text-centered mt2"},Se={class:"mt1 has-text-centered create-budget-button"},Me={key:3,class:"flexrow mt1"},ke={class:"selected-budget flexrow-item"},Pe={key:0,class:"error"},Ye={__name:"BudgetHeader",props:{budgets:{type:Array,default:()=>[]},budgetOptions:{type:Array,default:()=>[]},budget:{type:Object},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isErrorExpenses:{type:Boolean,default:!0},isLoadingExpenses:{type:Boolean,default:!1},isShowingExpenses:{type:Boolean,default:!1}},emits:["change-budget","delete-budget","edit-budget","export-budget","toggle-expenses","new-version"],setup(e){return(t,s)=>(l(),c("div",ve,[e.isLoading?(l(),c("div",we,[g(L)])):e.isError?(l(),c("div",De,[r("p",xe,d(t.$t("budget.budgets_error")),1)])):!e.budget||!e.budget.id?(l(),c("div",Ce,[r("p",null,d(t.$t("budget.no_budget_found")),1),r("p",Se,[g(k,{text:t.$t("budget.create_budget"),"is-big":"",onClick:s[0]||(s[0]=i=>t.$emit("new-version"))},null,8,["text"])])])):(l(),c("div",Me,[r("h3",ke,[g(z,{options:e.budgetOptions,value:e.budget,onChange:s[1]||(s[1]=i=>t.$emit("change-budget",i))},null,8,["options","value"])]),g(k,{class:"mr05",title:t.$t("budget.edit_budget"),icon:"pencil",onClick:s[2]||(s[2]=i=>t.$emit("edit-budget"))},null,8,["title"]),g(k,{class:"mr05",title:t.$t("budget.delete_budget"),icon:"trash",onClick:s[3]||(s[3]=i=>t.$emit("delete-budget"))},null,8,["title"]),g(k,{class:"mr05",active:e.isShowingExpenses,"is-loading":e.isLoadingExpenses,text:e.isShowingExpenses?t.$t("budget.hide_expenses"):t.$t("budget.show_expenses"),onClick:s[4]||(s[4]=i=>t.$emit("toggle-expenses"))},null,8,["active","is-loading","text"]),e.isErrorExpenses?(l(),c("span",Pe,d(t.$t("budget.expenses_error")),1)):y("",!0),s[7]||(s[7]=r("div",{class:"filler"},null,-1)),g(k,{class:"flexrow-item",icon:"export",title:t.$t("main.csv.export_file"),onClick:s[5]||(s[5]=i=>t.$emit("export-budget"))},null,8,["title"]),g(k,{text:t.$t("budget.new_version"),icon:"plus",onClick:s[6]||(s[6]=i=>t.$emit("new-version"))},null,8,["text"])]))]))}},Te=M(Ye,[["__scopeId","data-v-570a60e0"]]),Ve={name:"budget-list",mixins:[X,le],emits:["add-budget-entry","delete-budget-entry","edit-budget-entry"],components:{ButtonSimple:k,ChevronDownIcon:Q,ChevronRightIcon:Z,PeopleName:W,PeopleAvatar:J,RowActionsCell:G,Spinner:L},props:{budgetEntries:{type:Array,default:()=>[]},budgetDepartments:{type:Array,default:()=>[]},costsMonths:{type:Object,default:()=>{}},currency:{type:String,default:"USD"},currentBudget:{type:Object,default:()=>{}},expenses:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isShowingExpenses:{type:Boolean,default:!1},monthsBetweenStartAndNow:{type:Array,default:()=>[]},monthsBetweenNowAndEnd:{type:Array,default:()=>[]},monthsBetweenProductionDates:{type:Array,default:()=>[]},salaryScale:{type:Object,default:()=>{}},totalEntry:{type:Object,default:()=>({})}},data(){return{collapsedDepartments:{},domEvents:[["mousemove",this.onMouseMove],["touchmove",this.onMouseMove],["mouseup",this.stopBrowsing],["mouseleave",this.stopBrowsing],["touchend",this.stopBrowsing],["touchcancel",this.stopBrowsing],["keyup",this.stopBrowsing]]}},mounted(){const e=`budget:collapsed-departments-${this.currentProduction.id}`;this.addEvents(this.domEvents),this.collapsedDepartments=O.getObjectPreference(e)||{}},beforeUnmount(){this.removeEvents(this.domEvents),document.body.style.cursor="default"},computed:{...Y(["currentProduction","departmentMap","personMap","organisation"]),convertedExpenses(){const e={},t=this.expenses||{};let s=0;return Object.keys(t).forEach(i=>{let o=0;e[i]={},Object.keys(t[i]).forEach(n=>{let h=0;const f=this.getDailyRate(i,n);e[i][n]={},Object.keys(t[i][n]).forEach(b=>{const E=t[i][n][b],p=this.convertTimeSpentToCost(f,E);e[i][n][b]=p,e[i][b]||(e[i][b]=0),e[i][b]+=p,e[b]||(e[b]=0),e[b]+=p,h+=p}),e[i][n].total=h,o+=h}),e[i].total=o,s+=o}),e.total=s,e},extendedBudgetDepartments(){if(!this.isShowingExpenses)return this.budgetDepartments;const e=this.budgetDepartments.reduce((o,n)=>(o[n.id]=!0,o),{}),t=Object.keys(this.expenses).filter(o=>!e[o]).map(o=>({id:o,monthCosts:{},total:0,duration:0,persons:[],start_date:null})),s=[...this.budgetDepartments,...t],i=s.reduce((o,n)=>(n.persons.forEach(h=>{o[n.id]||(o[n.id]={}),o[n.id][h.person_id]=!0}),o),{});return Object.keys(this.expenses).forEach(o=>{o!=="total"&&Object.keys(this.expenses[o]).forEach(n=>{if(n!=="total"&&!i[o]?.[n]){const h=this.personMap.get(n);s.find(f=>f.id===o).persons.push({id:null,person_id:n,budget_entry_id:null,department_id:o,monthCosts:{},position:h.position,seniority:h.seniority,total:0,months_duration:0,monthly_salary:0,daily_salary:h.daily_salary,start_date:null,exceptions:{}})}})}),s},differences(){const e={total:0};return this.budgetDepartments.forEach(t=>{e[t.id]||(e[t.id]={total:0}),t.persons.forEach(s=>{if(!s.person_id)return;e[t.id][s.person_id]||(e[t.id][s.person_id]=0);let i=0;Object.keys(this.costsMonths).forEach(h=>{i+=this.getMonthCost(s,h)});const o=this.convertedExpenses[t.id]?.[s.person_id]?.total||0,n=i-o||0;e[t.id][s.person_id]+=n,e[t.id].total+=n}),e.total+=e[t.id].total}),e}},methods:{...j(["updateProductionBudgetEntry"]),getDailyRate(e,t){const s=this.personMap.get(t);if(!s)return 0;const i=s.seniority&&s.position?this.salaryScale[e][s.position][s.seniority]:0;return s.daily_salary||i},convertTimeSpentToCost(e,t){const s=t/60/this.organisation.hours_by_day;return Math.round(s*e)},getMonthCost(e,t){let s="";return typeof t=="string"?s=t:s=t.format("YYYY-MM"),e.exceptions=e.exceptions||{},parseInt(e.exceptions[s])||parseInt(e.monthCosts[s])||0},toggleDepartment(e){this.collapsedDepartments[e]=!this.collapsedDepartments[e];const t=`budget:collapsed-departments-${this.currentProduction.id}`;O.setObjectPreference(t,this.collapsedDepartments)},getDepartmentStyle(e,t){return{backgroundColor:this.departmentMap.get(e).color+t}},addPersonException(e,t,s){const i=e.exceptions||{};i[t.format("YYYY-MM")]=s;const o={id:e.budget_entry_id,...e,exceptions:i};this.updateProductionBudgetEntry({productionId:this.currentProduction.id,budgetId:this.currentBudget.id,budgetEntryId:e.budget_entry_id,budgetEntry:o})}}},je={class:"budget-data"},Ae={key:0,class:"has-text-centered mt2"},Oe={key:1,class:"flexrow mt2"},Le={class:"list-error"},Ne={key:2,class:"mt2"},Ue={class:"has-text-centered mt1"},Fe={class:"has-text-centered mt1"},Ie={key:3,class:"data-list filler"},Re={ref:"body",class:"datatable-wrapper flexcolumn filler"},qe={class:"datatable"},Ke={class:"datatable-head"},He={class:"datatable-row-header department-header-header",colspan:"3"},ze={class:"flexrow"},Ge={class:"flexrow-item"},Je={class:"datatable-row-header base-salary-header month"},We={class:"datatable-row-header duration-header month"},Ze={class:"datatable-row-header has-text-right cost-column"},Qe={class:"datatable-row-header has-text-right cost-column"},Xe={class:"datatable-row-header has-text-right cost-column difference"},$e={class:"datatable-row-header has-text-right"},et={class:"datatable-row"},tt={class:"datatable-row-header total-header",colspan:"3"},st={class:"pa05"},nt={key:0,class:"costs expenses"},ot={key:1,class:"remaining expenses"},it={class:"total-cost"},rt=["onClick"],dt={class:"datatable-row-header strong department-header",colspan:"3"},at={class:"flexrow-item"},lt={class:"position datatable-row-header"},ut={class:"seniority datatable-row-header"},ct={class:"name datatable-row-header"},gt={class:"flexrow"},ht={key:2,class:"new-hiring"},mt={class:"base-salary-header text-right entry-data"},ft={class:"duration-header text-right entry-data"},bt={key:0,class:"costs expenses"},yt={key:1,class:"remaining expenses"},pt=["value","onChange"],_t={key:1},Bt={class:"total-cost"};function Et(e,t,s,i,o,n){const h=m("spinner"),f=m("button-simple"),b=m("chevron-right-icon"),E=m("chevron-down-icon"),p=m("people-avatar"),_=m("people-name"),P=m("row-actions-cell");return l(),c("div",je,[s.isLoading?(l(),c("div",Ae,[g(h)])):s.isError?(l(),c("div",Oe,[r("p",Le,d(e.$t("budget.budget_entries_error")),1)])):s.budgetDepartments.length===0?(l(),c("div",Ne,[r("p",Ue,d(e.$t("budget.no_budget_entries_found")),1),r("p",Fe,[g(f,{text:e.$t("budget.add_entry"),onClick:t[0]||(t[0]=a=>e.$emit("add-budget-entry"))},null,8,["text"])])])):(l(),c("div",Ie,[r("div",Re,[r("table",qe,[r("thead",Ke,[r("tr",null,[r("th",He,[r("div",ze,[r("div",Ge,d(e.$t("budget.fields.department")),1),t[4]||(t[4]=r("div",{class:"filler"},null,-1)),g(f,{"is-thin":"",text:e.$t("budget.add_entry"),onClick:t[1]||(t[1]=a=>e.$emit("add-budget-entry"))},null,8,["text"])])]),r("th",Je,d(e.$t("budget.fields.base_salary")),1),r("th",We,d(e.$t("budget.fields.duration")),1),s.isShowingExpenses?(l(),c(B,{key:0},[(l(!0),c(B,null,v(s.monthsBetweenStartAndNow,a=>(l(),c("th",{class:"month datatable-row-header cost-column",key:a},d(a.month()===0?a.format("MMM / YY"):a.format("MMM")),1))),128)),r("th",Ze,d(e.$t("budget.costs")),1),r("th",Qe,d(e.$t("budget.remaining")),1),r("th",Xe,d(e.$t("budget.difference")),1)],64)):y("",!0),(l(!0),c(B,null,v(s.isShowingExpenses?s.monthsBetweenNowAndEnd:s.monthsBetweenProductionDates,a=>(l(),c("th",{key:a,class:"month datatable-row-header"},d(a.month()===0?a.format("MMM / YY"):a.format("MMM")),1))),128)),r("th",$e,d(e.$t("main.total"))+" ("+d(s.currency)+") ",1),t[5]||(t[5]=r("th",{class:"actions datatable-row-header"},null,-1))])]),r("tbody",{class:"datatable-body",onMousedown:t[2]||(t[2]=(...a)=>e.startBrowsing&&e.startBrowsing(...a)),onTouchstart:t[3]||(t[3]=(...a)=>e.startBrowsing&&e.startBrowsing(...a))},[r("tr",et,[r("td",tt,[r("div",st,d(e.$t("main.total")),1)]),t[6]||(t[6]=r("td",{class:"month"},null,-1)),t[7]||(t[7]=r("td",{class:"month"},null,-1)),s.isShowingExpenses?(l(),c(B,{key:0},[(l(!0),c(B,null,v(s.monthsBetweenStartAndNow,a=>(l(),c("td",{key:a,class:"month"},d(n.convertedExpenses[a.format("YYYY-MM")]?.toLocaleString()),1))),128)),s.isShowingExpenses?(l(),c("td",nt,d(n.convertedExpenses.total?.toLocaleString()),1)):y("",!0),s.isShowingExpenses?(l(),c("td",ot,d((s.totalEntry.total-(n.convertedExpenses.total||0)).toLocaleString()),1)):y("",!0),s.isShowingExpenses?(l(),c("td",{key:2,class:T(["difference expenses",{positive:n.differences.total>0,negative:n.differences.total<0}])},d(n.differences.total>0?"+":"")+" "+d(n.differences.total?.toLocaleString()||""),3)):y("",!0)],64)):y("",!0),(l(!0),c(B,null,v(s.isShowingExpenses?s.monthsBetweenNowAndEnd:s.monthsBetweenProductionDates,a=>(l(),c("td",{class:"month",key:a},d(s.totalEntry.monthCosts[a.format("YYYY-MM")]?.toLocaleString()),1))),128)),r("td",it,d(s.totalEntry.total.toLocaleString()),1),t[8]||(t[8]=r("td",{class:"actions"},null,-1))]),(l(!0),c(B,null,v(n.extendedBudgetDepartments,a=>(l(),c(B,{key:a.id},[r("tr",{class:"datatable-row department-row pointer",onClick:u=>n.toggleDepartment(a.id)},[r("td",dt,[r("div",{class:"flexrow department-header-content",style:w(n.getDepartmentStyle(a.id,"99"))},[o.collapsedDepartments[a.id]?(l(),S(b,{key:0,class:"flexrow-item"})):(l(),S(E,{key:1,class:"flexrow-item"})),r("div",at,d(e.departmentMap.get(a.id).name),1)],4)]),r("td",{class:"base-salary-header text-right month",style:w(n.getDepartmentStyle(a.id,"33"))},null,4),r("td",{class:"duration-header text-right month",style:w(n.getDepartmentStyle(a.id,"33"))},null,4),s.isShowingExpenses?(l(),c(B,{key:0},[(l(!0),c(B,null,v(s.monthsBetweenStartAndNow,u=>(l(),c("td",{key:u,class:"month",style:w(n.getDepartmentStyle(a.id,"33"))},d(n.convertedExpenses[a.id]?.[u.format("YYYY-MM")]?.toLocaleString()),5))),128)),s.isShowingExpenses?(l(),c("td",{key:0,class:"costs expenses",style:w(n.getDepartmentStyle(a.id,"33"))},d(n.convertedExpenses[a.id]?.total?.toLocaleString()),5)):y("",!0),s.isShowingExpenses?(l(),c("td",{key:1,class:"remaining expenses",style:w(n.getDepartmentStyle(a.id,"33"))},d((a.total-(n.convertedExpenses[a.id]?.total||0)).toLocaleString()),5)):y("",!0),s.isShowingExpenses?(l(),c("td",{key:2,class:T(["difference expenses",{positive:n.differences[a.id]?.total>0,negative:n.differences[a.id]?.total<0}]),style:w(n.getDepartmentStyle(a.id,"33"))},d(n.differences[a.id]?.total>0?"+":"")+" "+d(n.differences[a.id]?.total?.toLocaleString()||""),7)):y("",!0)],64)):y("",!0),(l(!0),c(B,null,v(s.isShowingExpenses?s.monthsBetweenNowAndEnd:s.monthsBetweenProductionDates,u=>(l(),c("td",{key:a.id+"-"+u,class:"month",style:w(n.getDepartmentStyle(a.id,"33"))},d(a.monthCosts[u.format("YYYY-MM")]?.toLocaleString()),5))),128)),r("td",{class:"total-cost",style:w(n.getDepartmentStyle(a.id,"33"))},d(a.total.toLocaleString()),5),r("td",{class:"actions",style:w(n.getDepartmentStyle(a.id,"33"))},null,4)],8,rt),o.collapsedDepartments[a.id]?y("",!0):(l(!0),c(B,{key:0},v(a.persons,u=>(l(),c("tr",{class:"datatable-row",key:u.id},[r("td",lt,d(e.$t("budget.positions."+u.position||"artist")),1),r("td",ut,d(e.$t("budget.seniorities."+u.seniority||"junior")),1),r("td",ct,[r("div",gt,[u.person_id?(l(),S(p,{key:0,class:"flexrow-item",person:e.personMap.get(u.person_id),"is-link":!1,"font-size":12,size:20},null,8,["person"])):y("",!0),u.person_id?(l(),S(_,{key:1,person:e.personMap.get(u.person_id)},null,8,["person"])):(l(),c("span",ht,d(e.$t("budget.new_hiring")),1))])]),r("td",mt,d((u.monthly_salary||0).toLocaleString()),1),r("td",ft,d(u.months_duration),1),s.isShowingExpenses?(l(),c(B,{key:0},[(l(!0),c(B,null,v(s.monthsBetweenStartAndNow,x=>(l(),c("td",{key:u.id+"-"+x,class:"costs"},d(n.convertedExpenses[a.id]?.[u.person_id]?.[x.format("YYYY-MM")]?.toLocaleString()),1))),128)),s.isShowingExpenses?(l(),c("td",bt,d(n.convertedExpenses[a.id]?.total?.toLocaleString()),1)):y("",!0),s.isShowingExpenses?(l(),c("td",yt,d((u.total-n.convertedExpenses[a.id]?.[u.person_id]?.total||0).toLocaleString()),1)):y("",!0),s.isShowingExpenses?(l(),c("td",{key:2,class:T(["difference expenses",{positive:n.differences[a.id]?.[u.person_id]>0,negative:n.differences[a.id]?.[u.person_id]<0}])},d(n.differences[a.id]?.[u.person_id]>0?"+":"")+" "+d(n.differences[a.id]?.[u.person_id]?.toLocaleString()||""),3)):y("",!0)],64)):y("",!0),(l(!0),c(B,null,v(s.isShowingExpenses?s.monthsBetweenNowAndEnd:s.monthsBetweenProductionDates,x=>(l(),c("td",{key:u.id+"-"+x,class:"month value-cell"},[u.monthCosts[x.format("YYYY-MM")]?(l(),c("input",{key:0,class:"input-editor",type:"number",min:"0",step:"1",value:n.getMonthCost(u,x),onChange:H=>n.addPersonException(u,x,H.target.value)},null,40,pt)):(l(),c("span",_t,"Â "))]))),128)),r("td",Bt,d(u.total.toLocaleString()),1),g(P,{class:"actions","entry-id":u.id,"hide-avatar":!0,"hide-change-password":!0,"hide-delete":!1,"hide-refresh":!0,onDeleteClicked:x=>e.$emit("delete-budget-entry",u),onEditClicked:x=>e.$emit("edit-budget-entry",u)},null,8,["entry-id","onDeleteClicked","onEditClicked"])]))),128))],64))),128))],32)])],512)]))])}const vt=M(Ve,[["render",Et],["__scopeId","data-v-f90fe405"]]),wt={name:"base-modal",mixins:[A],emits:["cancel"],components:{},props:{active:{type:Boolean,default:!1},title:{type:String,default:""}},data(){return{}},methods:{onBackgroundClicked(){this.$emit("cancel")}},watch:{}},Dt={class:"modal-content"},xt={class:"box"},Ct={class:"title"};function St(e,t,s,i,o,n){return l(),c("div",{class:T({modal:!0,"is-active":s.active})},[r("div",{class:"modal-background",onClick:t[0]||(t[0]=(...h)=>n.onBackgroundClicked&&n.onBackgroundClicked(...h))}),r("div",Dt,[r("div",xt,[r("h1",Ct,d(s.title),1),$(e.$slots,"default",{},void 0,!0)])])],2)}const K=M(wt,[["render",St],["__scopeId","data-v-f749bbb4"]]),Mt={name:"edit-budget-modal",mixins:[A],components:{BaseModal:K,Combobox:F,ModalFooter:U,TextField:N},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},budgetToEdit:{type:Object,default:()=>{}},lastRevision:{type:Number,default:1}},emits:["cancel","confirm"],data(){return{form:{name:"",currency:"USD"},currencieOptions:[{label:"USD",value:"USD"},{label:"EUR",value:"EUR"},{label:"GBP",value:"GBP"},{label:"CAD",value:"CAD"},{label:"AUD",value:"AUD"},{label:"CHF",value:"CHF"},{label:"JPY",value:"JPY"},{label:"CNY",value:"CNY"},{label:"INR",value:"INR"}]}},computed:{...Y([]),isDisabled(){return this.form.name.length===0},isEditing(){return this.budgetToEdit&&this.budgetToEdit.id},modalTitle(){return this.isEditing?this.$t("budget.edit_budget"):this.$t("budget.create_budget")}},methods:{...j([""]),runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},budgetToEdit(){this.budgetToEdit.id?this.form={id:this.budgetToEdit.id,name:this.budgetToEdit.name,currency:this.budgetToEdit.currency||"USD"}:this.form={id:null,name:"",currency:"USD"}}}},kt={class:"field"},Pt={class:"label"},Yt={class:"revision-number"};function Tt(e,t,s,i,o,n){const h=m("text-field"),f=m("combobox"),b=m("modal-footer"),E=m("base-modal"),p=I("focus");return l(),S(E,{active:s.active,title:n.modalTitle,onCancel:t[4]||(t[4]=_=>e.$emit("cancel"))},{default:V(()=>[r("form",{onSubmit:t[2]||(t[2]=R(()=>{},["prevent"]))},[r("div",kt,[r("label",Pt,d(e.$t("budget.fields.revision")),1),r("p",Yt," v"+d(n.isEditing?s.budgetToEdit.revision:s.lastRevision+1),1)]),q(g(h,{ref:"nameField",label:e.$t("budget.fields.name"),maxlength:30,modelValue:o.form.name,"onUpdate:modelValue":t[0]||(t[0]=_=>o.form.name=_),onEnter:n.runConfirmation},null,8,["label","modelValue","onEnter"]),[[p]]),g(f,{label:e.$t("budget.fields.currency"),options:o.currencieOptions,modelValue:o.form.currency,"onUpdate:modelValue":t[1]||(t[1]=_=>o.form.currency=_)},null,8,["label","options","modelValue"])],32),g(b,{"error-text":e.$t("budget.create_budget_error"),"is-error":s.isError,"is-loading":s.isLoading,"is-disabled":n.isDisabled,onConfirm:n.runConfirmation,onCancel:t[3]||(t[3]=_=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","is-disabled","onConfirm"])]),_:1},8,["active","title"])}const Vt=M(Mt,[["render",Tt],["__scopeId","data-v-dddfe419"]]),jt={name:"month-field",emits:["update:modelValue"],components:{ComboboxNumber:ee},props:{label:{type:String,default:""},minDate:{type:Date,required:!0},maxDate:{type:Date,required:!0},modelValue:{}},data(){return{selectedMonth:null,selectedYear:null,months:[]}},mounted(){this.months=te(1,12).map(e=>({value:e-1,label:C().month(e-1).format("MMMM")})),this.modelValue&&this.modelValue.getMonth&&(this.selectedMonth=this.modelValue.getMonth(),this.selectedYear=this.modelValue.getFullYear())},computed:{availableYears(){const e=[],t=this.minDate.getFullYear(),s=this.maxDate.getFullYear();for(let i=t;i<=s;i++)e.push(i);return e.map(i=>({value:i,label:i}))},availableMonths(){const e=this.selectedYear||this.availableYears[0].value,t=this.minDate.getFullYear(),s=this.maxDate.getFullYear(),i=this.minDate.getMonth(),o=this.maxDate.getMonth();return this.months.filter(n=>e===t&&e===s?n.value>=i&&n.value<=o:e===t?n.value>=i:e===s?n.value<=o:!0).map(n=>({value:n.value,label:n.label}))}},watch:{modelValue(){this.$options.silent=!0,this.modelValue&&this.modelValue.getMonth&&(this.selectedMonth=this.modelValue.getMonth(),this.selectedYear=this.modelValue.getFullYear()),this.$nextTick(()=>{this.$options.silent=!1})},selectedMonth(e){if(this.$options.silent)return;const t=C(new Date(this.selectedYear,e,1,0,0,0,0));this.$emit("update:modelValue",t.startOf("month").toDate())},selectedYear(e){this.$options.silent||this.$nextTick(()=>{this.selectedMonth=this.availableMonths[0].value;const t=C(new Date(e,this.selectedMonth,1,0,0,0,0));this.$emit("update:modelValue",t.startOf("month").toDate())})}}},At={class:"month-field flexcolumn"},Ot={key:0,class:"label"},Lt={class:"date-selector"};function Nt(e,t,s,i,o,n){const h=m("combobox-number");return l(),c("div",At,[s.label.length>0?(l(),c("label",Ot,d(s.label),1)):y("",!0),r("div",Lt,[g(h,{options:n.availableYears,modelValue:o.selectedYear,"onUpdate:modelValue":t[0]||(t[0]=f=>o.selectedYear=f)},null,8,["options","modelValue"]),g(h,{options:n.availableMonths,modelValue:o.selectedMonth,"onUpdate:modelValue":t[1]||(t[1]=f=>o.selectedMonth=f)},null,8,["options","modelValue"])])])}const Ut=M(jt,[["render",Nt],["__scopeId","data-v-9914ab8b"]]),Ft={name:"edit-budget-entry-modal",mixins:[A],components:{BaseModal:K,Combobox:F,ComboboxDepartment:ne,ModalFooter:U,MonthField:Ut,PeopleField:se,TextField:N},props:{active:{type:Boolean,default:!1},budgetEntryToEdit:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},salaryScale:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{department_id:"",person:null,position:"artist",seniority:"junior",start_date:null,months_duration:1},positionOptions:[{label:"artist",value:"artist"},{label:"supervisor",value:"supervisor"},{label:"lead",value:"lead"}],refreshKeys:{endMonth:0,monthlySalary:0,totalSalary:0},seniorityOptions:[{label:"junior",value:"junior"},{label:"mid",value:"mid"},{label:"senior",value:"senior"}]}},mounted(){this.resetForm()},computed:{...Y(["activePeople","currentProduction","personMap"]),isDisabled(){return!this.form.department_id||this.form.months_duration<1},isEditing(){return this.budgetEntryToEdit&&this.budgetEntryToEdit.id},projectStartDate(){return D(this.currentProduction.start_date).toDate()},projectEndDate(){return D(this.currentProduction.end_date).toDate()},endMonth(){this.refreshKeys.endMonth;const e=D(this.form.start_date),t=D(this.currentProduction.end_date);let s=e.add(this.form.months_duration,"months");return s=C.min(s,t),s.format("YYYY-MM")},dailySalary(){return this.form.department_id?!this.form.person||!this.form.person.daily_salary?this.salaryScale[this.form.department_id][this.form.position||"artist"][this.form.seniority||"junior"].salary:this.form.person.daily_salary:0},monthlySalary(){return this.dailySalary*20},totalSalary(){if(this.form.department_id){const e=Math.min(this.form.months_duration,this.maxDuration);return this.monthlySalary*e}else return 0},maxDuration(){const e=D(this.form.start_date),s=D(this.currentProduction.end_date).endOf("month").diff(e,"months");return s>0?s:1},departmentPeople(){return this.form.department_id?this.activePeople.filter(e=>e.departments.includes(this.form.department_id)):this.activePeople}},methods:{...j([""]),runConfirmation(){this.$emit("confirm",{...this.form,person_id:this.form.person?.id,duration:Math.min(this.form.months_duration,this.maxDuration),salary:this.monthlySalary,total_salary:this.totalSalary})},onPersonChanged(e){e?(this.form.position=e.position||"artist",this.form.seniority=e.seniority||"junior"):(this.form.position="artist",this.form.seniority="junior")},formatDate(e){return oe(e)},resetForm(){if(this.isEditing){const e=this.personMap.get(this.budgetEntryToEdit.person_id);Object.assign(this.form,{id:this.budgetEntryToEdit.id,department_id:this.budgetEntryToEdit.department_id,person:e,position:this.budgetEntryToEdit.position||"artist",seniority:this.budgetEntryToEdit.seniority||"junior",start_date:D(this.budgetEntryToEdit.start_date).toDate(),months_duration:this.budgetEntryToEdit.months_duration,daily_salary:this.budgetEntryToEdit.daily_salary}),this.form.person=e,this.$nextTick(()=>{this.form.daily_salary=this.budgetEntryToEdit.daily_salary})}else this.form={id:null,department_id:"",person:null,position:"artist",seniority:"junior",start_date:D(this.currentProduction.start_date).startOf("month").toDate(),months_duration:1,daily_salary:0}}},watch:{active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs.departmentField.focus()},100))},dailySalary(){this.form.daily_salary=this.dailySalary},budgetEntryToEdit(){this.resetForm()}}},It={class:"flexrow"},Rt={class:"mt0"},qt={class:"salary-label"},Kt={class:"salary-value"},Ht={class:"salary-label"},zt={class:"salary-value"},Gt={class:"salary-label"},Jt={class:"salary-value"},Wt={class:"salary-label"},Zt={class:"salary-value"};function Qt(e,t,s,i,o,n){const h=m("combobox-department"),f=m("people-field"),b=m("combobox"),E=m("month-field"),p=m("text-field"),_=m("modal-footer"),P=m("base-modal"),a=I("focus");return l(),S(P,{active:s.active,title:n.isEditing?e.$t("budget.edit_budget_entry"):e.$t("budget.add_entry"),onCancel:t[9]||(t[9]=u=>e.$emit("cancel"))},{default:V(()=>[r("form",{onSubmit:t[7]||(t[7]=R(()=>{},["prevent"]))},[q(g(h,{ref:"departmentField",label:e.$t("budget.fields.department"),modelValue:o.form.department_id,"onUpdate:modelValue":t[0]||(t[0]=u=>o.form.department_id=u),onEnter:n.runConfirmation},null,8,["label","modelValue","onEnter"]),[[a]]),g(f,{class:"mt2",label:e.$t("budget.fields.person"),people:n.departmentPeople,onSelect:n.onPersonChanged,onEnter:n.runConfirmation,modelValue:o.form.person,"onUpdate:modelValue":t[1]||(t[1]=u=>o.form.person=u)},null,8,["label","people","onSelect","onEnter","modelValue"]),g(b,{class:"mt2",label:e.$t("budget.fields.position"),options:o.positionOptions,"locale-key-prefix":"people.position.",modelValue:o.form.position,"onUpdate:modelValue":t[2]||(t[2]=u=>o.form.position=u),onEnter:n.runConfirmation},null,8,["label","options","modelValue","onEnter"]),g(b,{class:"mt2",label:e.$t("budget.fields.seniority"),options:o.seniorityOptions,"locale-key-prefix":"people.seniority.",modelValue:o.form.seniority,"onUpdate:modelValue":t[3]||(t[3]=u=>o.form.seniority=u),onEnter:n.runConfirmation},null,8,["label","options","modelValue","onEnter"]),r("div",It,[g(E,{class:"mr1",label:e.$t("budget.fields.start_date"),"min-date":n.projectStartDate,"max-date":n.projectEndDate,modelValue:o.form.start_date,"onUpdate:modelValue":t[4]||(t[4]=u=>o.form.start_date=u)},null,8,["label","min-date","max-date","modelValue"]),g(p,{class:"month-duration",type:"number",min:1,max:n.maxDuration,label:e.$t("budget.fields.months_duration"),modelValue:o.form.months_duration,"onUpdate:modelValue":t[5]||(t[5]=u=>o.form.months_duration=u),onEnter:n.runConfirmation},null,8,["max","label","modelValue","onEnter"]),g(p,{class:"month-duration",type:"number",min:0,label:e.$t("budget.fields.daily_salary"),modelValue:o.form.daily_salary,"onUpdate:modelValue":t[6]||(t[6]=u=>o.form.daily_salary=u),onEnter:n.runConfirmation},null,8,["label","modelValue","onEnter"])]),r("div",Rt,[r("span",qt,d(e.$t("budget.fields.start_date")),1),r("span",Kt,d(n.formatDate(o.form.start_date).substring(0,7)),1),t[10]||(t[10]=r("br",null,null,-1)),r("span",Ht,d(e.$t("budget.fields.end_date")),1),r("span",zt,d(n.endMonth),1),t[11]||(t[11]=r("br",null,null,-1)),r("span",Gt,d(e.$t("budget.fields.monthly_salary")),1),r("span",Jt,d(n.monthlySalary),1),t[12]||(t[12]=r("br",null,null,-1)),r("span",Wt,d(e.$t("budget.fields.total_salary")),1),r("span",Zt,d(n.totalSalary),1)])],32),g(_,{"error-text":e.$t("budget.create_budget_error"),"is-error":s.isError,"is-loading":s.isLoading,"is-disabled":n.isDisabled,onConfirm:n.runConfirmation,onCancel:t[8]||(t[8]=u=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","is-disabled","onConfirm"])]),_:1},8,["active","title"])}const Xt=M(Ft,[["render",Qt],["__scopeId","data-v-13f1e48c"]]),$t={resetDepartmentTotals(e){e.total=e.persons.reduce((t,s)=>t+s.total,0),e.monthCosts=e.persons.reduce((t,s)=>(Object.keys(s.monthCosts).forEach(i=>{t[i]=(t[i]||0)+s.monthCosts[i]}),t),{})}},es={name:"budget",mixins:[ce],components:{BudgetAnalytics:Ee,BudgetHeader:Te,BudgetList:vt,DeleteModal:de,EditBudgetEntryModal:Xt,EditBudgetModal:Vt,HardDeleteModal:re,PageLayout:ue},data(){return{budgets:[],budgetEntries:[],budgetEntryToEdit:{},budgetOptions:[],budgetToEdit:{},costsMonths:[],currentBudget:{},errors:{budgets:!1,createBudget:!1,deleteBudget:!1,deleteBudgetEntry:!1,editBudget:!1,editBudgetEntry:!1,entries:!1,expenses:!1},expenses:{data:{},showing:!1},loading:{budgets:!0,createBudget:!1,deleteBudget:!1,deleteBudgetEntry:!1,editBudget:!1,editBudgetEntry:!1,entries:!0,expenses:!1},modals:{createBudget:!1,createBudgetEntry:!1,editBudgetEntry:!1,deleteBudget:!1,deleteBudgetEntry:!1},monthsBetweenProductionDates:[],salaryScale:{}}},async mounted(){this.pageTitle=this.$t("budget.title"),await this.setSalaryScale(),await this.loadBudgets(),await this.loadBudgetEntries(),this.resetMonths()},computed:{...Y(["currentProduction","departments","departmentMap","personMap"]),monthsBetweenStartAndNow(){return this.getMonthsBetweenDates(this.currentProduction.start_date,C().format("YYYY-MM-DD"))},monthsBetweenNowAndEnd(){return this.getMonthsBetweenDates(C().add(1,"month").format("YYYY-MM-DD"),this.currentProduction.end_date)},lastRevision(){return this.budgets.length>0?this.budgets[0].revision:0},budgetDepartments(){const e=new Set(this.budgetEntries.map(s=>s.department_id)),t=[];return Array.from(e).map(s=>{const i=this.budgetEntries.filter(n=>n.department_id===s),o={id:s,monthCosts:{},total:0,duration:0,persons:[],start_date:null};i.forEach(n=>{const h=n.daily_salary*20,f={};let b=0;n.exceptions=n.exceptions||{};for(let _=0;_<n.months_duration;_++){const a=C(n.start_date).add(_,"month").format("YYYY-MM"),u=n.exceptions[a]||h;f[a]=u,b+=u}o.persons.push({id:n.id,person_id:n.person_id,budget_entry_id:n.id,department_id:n.department_id,monthCosts:f,position:n.position,seniority:n.seniority,total:b,months_duration:n.months_duration,monthly_salary:h,daily_salary:n.daily_salary,start_date:n.start_date,exceptions:n.exceptions});const E=C(n.start_date),p=C(o.start_date);(!o.start_date||E.isBefore(p))&&(o.start_date=n.start_date),o.persons.sort(this.sortDepartmentPersons)}),$t.resetDepartmentTotals(o),t.push(o)}),t.sort((s,i)=>{const o=this.departmentMap.get(s.id),n=this.departmentMap.get(i.id);return o.name.localeCompare(n.name)}),t},totalEntry(){const e=this.budgetDepartments.reduce((s,i)=>s+i.total,0),t=this.budgetDepartments.reduce((s,i)=>(Object.keys(i.monthCosts).forEach(o=>{s[o]=(s[o]||0)+i.monthCosts[o]}),s),{});return{total:e,monthCosts:t}},pieChartData(){return this.budgetDepartments.map(e=>[this.departmentMap.get(e.id).name,e.total])},pieChartColors(){return this.budgetDepartments.map(e=>this.departmentMap.get(e.id).color)},columnChartData(){return this.monthsBetweenProductionDates.map(e=>{const t=e.format("YYYY-MM"),[s,i]=t.split("-");return[`${i}/${s.slice(2)}`,this.totalEntry.monthCosts[t]||0]})}},methods:{...j(["createProductionBudgetEntry","createProductionBudget","deleteProductionBudget","deleteProductionBudgetEntry","loadExpenses","loadProductionBudget","loadProductionBudgets","loadProductionBudgetEntry","loadProductionBudgetEntries","loadSalaryScale","updateProductionBudget","updateProductionBudgetEntry"]),formatMonth:ie,resetMonths(){this.monthsBetweenProductionDates=this.getMonthsBetweenDates(this.currentProduction.start_date,this.currentProduction.end_date),this.costsMonths=this.monthsBetweenProductionDates.map(e=>e.format("YYYY-MM"))},sortDepartmentPersons(e,t){const s={junior:1,mid:2,senior:3},i={artist:1,lead:2,supervisor:3},o=s[e.seniority],n=s[t.seniority],h=i[e.position],f=i[t.position];if(e.person_id===null&&t.person_id===null)return h===f?n-o:f-h;if(e.person_id===null)return 1;if(t.person_id===null)return-1;{const b=this.personMap.get(e.person_id),E=this.personMap.get(t.person_id);return b.name===E.name?h===f?n-o:f-h:b.name.localeCompare(E.name)}},async setSalaryScale(){this.salaryScale=await this.loadSalaryScale()},onChangeBudget(e){this.currentBudget=e},onEditBudgetClicked(){this.budgetToEdit=this.currentBudget,this.modals.createBudget=!0},onExportBudgetClicked(){const e=[this.$t("budget.title").toLowerCase(),this.currentProduction.name,`v${this.currentBudget.revision}`,this.currentBudget.name,this.currentBudget.currency];ae.generateBudget(this.$t,this.departmentMap,this.personMap,e,this.currentBudget.currency,this.monthsBetweenProductionDates,this.totalEntry,this.budgetDepartments)},onNewBudgetVersionClicked(){this.budgetToEdit={},this.modals.createBudget=!0},async createBudget(e){try{if(this.loading.createBudget=!0,e.id){await this.updateProductionBudget({productionId:this.currentProduction.id,budget:{id:this.currentBudget.id,name:e.name,currency:e.currency}});const t=this.budgets.find(s=>s.id===this.currentBudget.id);t&&Object.assign(t,{name:e.name,currency:e.currency})}else{this.loading.createBudget=!0;const t=await this.createProductionBudget({productionId:this.currentProduction.id,budget:e});this.budgets.unshift(t),this.currentBudget=t}this.resetBudgetOptions(),this.modals.createBudget=!1}catch(t){console.error(t),this.errors.createBudget=!0}finally{this.loading.createBudget=!1}},onDeleteBudgetClicked(){this.errors.deleteBudget=!1,this.modals.deleteBudget=!0},async deleteBudget(){this.loading.deleteBudget=!0;try{await this.deleteProductionBudget({productionId:this.currentProduction.id,budgetId:this.currentBudget.id}),this.postDeleteBudget(this.currentBudget),this.modals.deleteBudget=!1}catch(e){console.error(e),this.errors.deleteBudget=!0}finally{this.loading.deleteBudget=!1}},postDeleteBudget(e){this.budgets=this.budgets.filter(t=>t.id!==e.id),this.resetBudgetOptions(),this.budgets.length>0?this.currentBudget=this.budgets[0]:this.currentBudget={}},onAddBudgetEntry(){this.budgetEntryToEdit={},this.modals.createBudgetEntry=!0},async confirmCreateBudgetEntry(e){e.id?await this.runRemoteBudgetEntryEdition(e):await this.runRemoteBudgetEntryCreation(e)},async runRemoteBudgetEntryCreation(e){try{this.loading.createBudgetEntry=!0,await this.createProductionBudgetEntry({productionId:this.currentProduction.id,budgetId:this.currentBudget.id,budgetEntry:{...e,person_id:e.person?e.person.id:null}}),this.modals.createBudgetEntry=!1}catch(t){console.error(t),this.errors.createBudgetEntry=!0}finally{this.loading.createBudgetEntry=!1}},editBudgetEntry(e){this.budgetEntryToEdit=e,this.modals.createBudgetEntry=!0},async runRemoteBudgetEntryEdition(e){try{this.loading.editBudgetEntry=!0,this.errors.editBudgetEntry=!1,await this.updateProductionBudgetEntry({productionId:this.currentProduction.id,budgetId:this.currentBudget.id,budgetEntryId:e.id,budgetEntry:{id:e.id,department_id:e.department_id,person_id:e.person?e.person.id:null,position:e.position,seniority:e.seniority,start_date:e.start_date,months_duration:e.duration,daily_salary:e.daily_salary}}),this.modals.createBudgetEntry=!1}catch(t){console.error(t),this.errors.editBudgetEntry=!0}finally{this.loading.editBudgetEntry=!1}},afterEditBudgetEntry(e){const t=this.budgetEntries.find(s=>s.id===e.id);t&&Object.assign(t,e)},async deleteBudgetEntry(e){this.loading.deleteBudgetEntry=!1,this.errors.deleteBudgetEntry=!1,this.modals.deleteBudgetEntry=!0,this.budgetEntryToDelete=e},async confirmDeleteBudgetEntry(){this.loading.deleteBudgetEntry=!0;try{await this.deleteProductionBudgetEntry({productionId:this.currentProduction.id,budgetId:this.currentBudget.id,budgetEntryId:this.budgetEntryToDelete.budget_entry_id}),this.postDeleteBudgetEntry(this.budgetEntryToDelete),this.modals.deleteBudgetEntry=!1}catch(e){console.error(e),this.errors.deleteBudgetEntry=!0}finally{this.loading.deleteBudgetEntry=!1}},postDeleteBudgetEntry(e){this.budgetEntries=this.budgetEntries.filter(t=>t.id!==e.id)},async loadBudgets(){try{this.loading.budgets=!0,this.errors.budgets=!1,this.budgets=await this.loadProductionBudgets(this.currentProduction.id),this.budgets.sort((e,t)=>t.revision-e.revision),this.currentBudget=this.budgets.length>0?this.budgets[0]:{},this.resetBudgetOptions()}catch(e){console.error(e),this.errors.budgets=!0}finally{this.loading.budgets=!1}},async loadBudgetEntries(){if(!(!this.currentBudget||!this.currentBudget.id))try{this.loading.entries=!0,this.errors.entries=!1,this.budgetEntries=await this.loadProductionBudgetEntries({productionId:this.currentProduction.id,budgetId:this.currentBudget.id})}catch(e){console.error(e),this.errors.entries=!0}finally{this.loading.entries=!1}},resetBudgetOptions(){this.budgetOptions=this.budgets.map(e=>({label:`v${e.revision} - ${e.name}`,value:e}))},getMonthsBetweenDates(e,t){const s=[],i=D(e),o=D(t);for(;i<=o;)s.push(i.clone()),i.add(1,"month");return s},async onToggleExpenses(){if(!this.expenses.showing)try{this.loading.expenses=!0,this.expenses.data=await this.loadExpenses(this.currentProduction.id)}catch(e){console.error(e),this.errors.expenses=!0}finally{this.loading.expenses=!1}this.expenses.showing=!this.expenses.showing}},watch:{currentProduction(){this.loadBudgets(),this.resetMonths()},currentBudget(){this.loadBudgetEntries()}},socket:{events:{"budget:create":async function(e){if(e.project_id!==this.currentProduction.id)return;const t=await this.loadProductionBudget({productionId:this.currentProduction.id,budgetId:e.budget_id}),s=this.budgets.find(i=>i.id===t.id);t&&!s&&(this.budgets.unshift(t),this.resetBudgetOptions())},"budget:update":async function(e){if(e.project_id!==this.currentProduction.id)return;const t=await this.loadProductionBudget({productionId:this.currentProduction.id,budgetId:e.budget_id});if(t){const s=this.budgets.find(i=>i.id===t.id);s&&(Object.assign(s,{name:t.name,currency:t.currency}),this.resetBudgetOptions())}},"budget:delete":function(e){if(e.project_id!==this.currentProduction.id)return;const t=this.budgets.find(i=>i.id===e.budget_id),s=this.currentBudget.id===e.budget_id;t&&(this.budgets=this.budgets.filter(i=>i.id!==e.budget_id),this.resetBudgetOptions(),s&&(this.currentBudget=this.budgets[0]))},"budget-entry:create":async function(e){if(e.project_id!==this.currentProduction.id||e.budget_id!==this.currentBudget.id||this.budgetEntries.find(i=>i.id===e.budget_entry_id))return;const s=await this.loadProductionBudgetEntry({productionId:this.currentProduction.id,budgetId:this.currentBudget.id,budgetEntryId:e.budget_entry_id});this.budgetEntries.push(s)},"budget-entry:update":async function(e){if(e.project_id!==this.currentProduction.id||e.budget_id!==this.currentBudget.id||!this.budgetEntries.find(i=>i.id===e.budget_entry_id))return;const s=await this.loadProductionBudgetEntry({productionId:this.currentProduction.id,budgetId:this.currentBudget.id,budgetEntryId:e.budget_entry_id});this.afterEditBudgetEntry(s)},"budget-entry:delete":async function(e){e.project_id!==this.currentProduction.id||e.budget_id!==this.currentBudget.id||!this.budgetEntries.find(s=>s.id===e.budget_entry_id)||this.postDeleteBudgetEntry({id:e.budget_entry_id})}}}},ts={class:"flexcolumn page"};function ss(e,t,s,i,o,n){const h=m("budget-header"),f=m("budget-list"),b=m("edit-budget-modal"),E=m("edit-budget-entry-modal"),p=m("hard-delete-modal"),_=m("delete-modal"),P=m("budget-analytics"),a=m("page-layout");return l(),S(a,null,{main:V(()=>[r("div",ts,[g(h,{budgets:o.budgets,"budget-options":o.budgetOptions,budget:o.currentBudget,"is-loading":o.loading.budgets,"is-error":o.errors.budgets,"is-error-expenses":o.errors.expenses,"is-loading-expenses":o.loading.expenses,"is-showing-expenses":o.expenses.showing,onChangeBudget:n.onChangeBudget,onDeleteBudget:n.onDeleteBudgetClicked,onEditBudget:n.onEditBudgetClicked,onExportBudget:n.onExportBudgetClicked,onToggleExpenses:n.onToggleExpenses,onNewVersion:n.onNewBudgetVersionClicked},null,8,["budgets","budget-options","budget","is-loading","is-error","is-error-expenses","is-loading-expenses","is-showing-expenses","onChangeBudget","onDeleteBudget","onEditBudget","onExportBudget","onToggleExpenses","onNewVersion"]),o.currentBudget.id?(l(),S(f,{key:0,"budget-departments":n.budgetDepartments,"budget-entries":o.budgetEntries,"costs-months":o.costsMonths,currency:o.currentBudget?.currency||"USD","current-budget":o.currentBudget,expenses:o.expenses.data,"is-error":o.errors.entries,"is-loading":o.loading.entries,"is-showing-expenses":o.expenses.showing,"months-between-start-and-now":n.monthsBetweenStartAndNow,"months-between-now-and-end":n.monthsBetweenNowAndEnd,"months-between-production-dates":o.monthsBetweenProductionDates,"salary-scale":o.salaryScale,"total-entry":n.totalEntry,onAddBudgetEntry:n.onAddBudgetEntry,onDeleteBudgetEntry:n.deleteBudgetEntry,onEditBudgetEntry:n.editBudgetEntry},null,8,["budget-departments","budget-entries","costs-months","currency","current-budget","expenses","is-error","is-loading","is-showing-expenses","months-between-start-and-now","months-between-now-and-end","months-between-production-dates","salary-scale","total-entry","onAddBudgetEntry","onDeleteBudgetEntry","onEditBudgetEntry"])):y("",!0),g(b,{active:o.modals.createBudget,"budget-to-edit":o.budgetToEdit,"last-revision":n.lastRevision,"is-loading":o.loading.createBudget||o.loading.editBudget,"is-error":o.errors.createBudget||o.errors.editBudget,onCancel:t[0]||(t[0]=u=>o.modals.createBudget=!1),onConfirm:n.createBudget},null,8,["active","budget-to-edit","last-revision","is-loading","is-error","onConfirm"]),g(E,{active:o.modals.createBudgetEntry,"budget-entry-to-edit":o.budgetEntryToEdit,"is-loading":o.loading.createBudgetEntry,"is-error":o.errors.createBudgetEntry||o.errors.editBudgetEntry,"salary-scale":o.salaryScale,onCancel:t[1]||(t[1]=u=>o.modals.createBudgetEntry=!1),onConfirm:n.confirmCreateBudgetEntry},null,8,["active","budget-entry-to-edit","is-loading","is-error","salary-scale","onConfirm"]),g(p,{active:o.modals.deleteBudget,"error-text":e.$t("budget.delete_budget_error"),"is-loading":o.loading.del,"is-error":o.errors.deleteBudget,"lock-text":o.currentBudget?.name,text:e.$t("budget.delete_budget_message"),onCancel:t[2]||(t[2]=u=>o.modals.deleteBudget=!1),onConfirm:n.deleteBudget},null,8,["active","error-text","is-loading","is-error","lock-text","text","onConfirm"]),g(_,{active:o.modals.deleteBudgetEntry,"error-text":e.$t("budget.delete_budget_entry_error"),"is-loading":o.loading.deleteBudgetEntry,"is-error":o.errors.deleteBudgetEntry,text:e.$t("budget.delete_budget_entry_message"),onCancel:t[3]||(t[3]=u=>o.modals.deleteBudgetEntry=!1),onConfirm:n.confirmDeleteBudgetEntry},null,8,["active","error-text","is-loading","is-error","text","onConfirm"])])]),side:V(()=>[g(P,{amount:n.totalEntry.total,currency:o.currentBudget.currency,budgets:o.budgets,"budget-departments":n.budgetDepartments,"budget-entries":o.budgetEntries,"months-between-production-dates":o.monthsBetweenProductionDates,"pie-chart-data":n.pieChartData,"pie-chart-colors":n.pieChartColors,"column-chart-data":n.columnChartData},null,8,["amount","currency","budgets","budget-departments","budget-entries","months-between-production-dates","pie-chart-data","pie-chart-colors","column-chart-data"])]),_:1})}const rs=M(es,[["render",ss],["__scopeId","data-v-d5f3919e"]]);export{rs as default};
//# sourceMappingURL=Budget-B3V9A2wN.js.map
