import{_ as b,a as C,T as w,ar as v,bv as A,bw as M,r as p,c as r,o as a,e as l,f as c,d as u,t as n,F as m,g as S,G as T,k as g,w as P,a7 as V,c4 as k,m as E,S as D,b as B,B as x,s as U,aB as F,aa as N,ab as Y}from"./index-BeYclKAr.js";import{S as O}from"./StatsCell-Dsqipvqw.js";const j={name:"production-asset-type-list",mixins:[v],props:{displayMode:{type:String,default:"pie"},entries:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},assetTypeStats:{type:Object,default:()=>{}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]}},components:{StatsCell:O,TableInfo:w},computed:{...C(["assetTypeSearchText","currentEpisode","currentProduction","displayedAssetTypesLength","isCurrentUserClient","isTVShow","taskTypeMap"]),isEmptyList(){return this.entries&&this.entries.length===0&&!this.isLoading&&!this.isError&&(!this.assetTypeSearchText||this.assetTypeSearchText.length===0)}},methods:{chartColors(s,t){return M(this.assetTypeStats,s,t)},chartData(s,t){return A(this.assetTypeStats,s,t)},isStats(s,t){return this.assetTypeStats[s]&&this.assetTypeStats[s][t]},onHeaderScroll(s,t){this.$refs.tableWrapper.scrollLeft=t.scrollLeft},taskTypePath(s){const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:s,type:"assets"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t}}},G={class:"data-list"},H={class:"datatable"},z={class:"datatable-head"},K={scope:"col",class:"name datatable-row-header"},Q={scope:"col",class:"validation"},R={key:1,class:"flexrow-item"},W={key:0,class:"datatable-body"},q={key:0,class:"all-line datatable-row"},J={scope:"row",class:"name datatable-row-header"},X={scope:"row",class:"name datatable-row-header"},Z={key:1},I={key:0,class:"has-text-centered"},$={class:"info"},ss={key:1,class:"has-text-centered"},ts={class:"info"},es={key:2,class:"has-text-centered nb-asset-types"};function as(s,t,o,L,h,i){const _=p("router-link"),y=p("stats-cell"),f=p("table-info");return a(),r("div",G,[l("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:t[0]||(t[0]=(...e)=>s.onBodyScroll&&s.onBodyScroll(...e))},[l("table",H,[l("thead",z,[l("tr",null,[l("th",K,n(s.$t("asset_types.fields.name")),1),l("th",Q,n(s.$t("main.all")),1),o.isLoading?u("",!0):(a(!0),r(m,{key:0},S(o.validationColumns,e=>(a(),r("th",{scope:"col",class:"validation validation-cell",key:e},[l("div",{class:"flexrow validation-content",style:T(s.getValidationStyle(e))},[s.isCurrentUserClient?(a(),r("span",R,n(s.taskTypeMap.get(e).name),1)):(a(),g(_,{key:0,class:"flexrow-item",title:s.taskTypeMap.get(e).name,to:i.taskTypePath(e)},{default:P(()=>[V(n(s.taskTypeMap.get(e).name),1)]),_:2},1032,["title","to"]))],4)]))),128)),t[1]||(t[1]=l("th",{scope:"col",class:"actions"},null,-1))])]),o.isLoading?u("",!0):(a(),r("tbody",W,[o.showAll&&!i.isEmptyList?(a(),r("tr",q,[l("th",J,n(s.$t("asset_types.all_asset_types")),1),c(y,{colors:i.chartColors("all","all"),data:i.chartData("all","all"),"display-mode":o.displayMode},null,8,["colors","data","display-mode"]),(a(!0),r(m,null,S(o.validationColumns,e=>(a(),g(y,{style:T(s.getValidationStyle(e)),key:"all-"+e,colors:i.chartColors("all",e),data:i.chartData("all",e),"display-mode":o.displayMode},null,8,["style","colors","data","display-mode"]))),128)),t[2]||(t[2]=l("td",{class:"actions"},null,-1))])):u("",!0),(a(!0),r(m,null,S(o.entries,e=>(a(),r("tr",{class:"datatable-row",key:e.id},[l("td",X,n(e.name),1),i.isStats(e.id,"all")?(a(),g(y,{key:0,colors:i.chartColors(e.id,"all"),data:i.chartData(e.id,"all"),"display-mode":o.displayMode},null,8,["colors","data","display-mode"])):(a(),r("td",Z)),(a(!0),r(m,null,S(o.validationColumns,d=>(a(),r(m,{key:e.id+"-"+d},[i.isStats(e.id,d)?(a(),g(y,{key:e.id+d,style:T(s.getValidationStyle(d)),colors:i.chartColors(e.id,d),data:i.chartData(e.id,d),"display-mode":o.displayMode},null,8,["style","colors","data","display-mode"])):(a(),r("td",{key:1,style:T(s.getValidationStyle(d))},null,4))],64))),128)),t[3]||(t[3]=l("td",{class:"actions"},null,-1))]))),128))]))])],544),c(f,{"is-loading":o.isLoading,"is-error":o.isError},null,8,["is-loading","is-error"]),i.isEmptyList&&!s.isCurrentUserClient&&!o.isLoading?(a(),r("div",I,[t[4]||(t[4]=l("p",{class:"info"},[l("img",{src:k})],-1)),l("p",$,n(s.$t("assets.empty_list")),1)])):u("",!0),i.isEmptyList&&s.isCurrentUserClient&&!o.isLoading?(a(),r("div",ss,[t[5]||(t[5]=l("p",{class:"info"},[l("img",{src:k})],-1)),l("p",ts,n(s.$t("assets.empty_list_client")),1)])):u("",!0),!i.isEmptyList&&!o.isLoading?(a(),r("p",es,n(s.displayedAssetTypesLength)+" "+n(s.$tc("asset_types.number",s.displayedAssetTypesLength)),1)):u("",!0)])}const is=b(j,[["render",as],["__scopeId","data-v-845cb4b7"]]),ls={name:"production-asset-types",mixins:[U],components:{ButtonSimple:x,Combobox:B,ProductionAssetTypeList:is,SearchField:D},data(){return{initialLoading:!0,displayMode:"pie",displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}]}},computed:{...C(["assetTypeMap","assetTypeStats","assetTypeSearchText","assetTypeListScrollPosition","assetValidationColumns","currentEpisode","currentProduction","displayedAssetTypes","isAssetsLoading","isAssetsLoadingError","isTVShow","taskStatusMap","taskTypeMap"]),searchField(){return this.$refs["asset-type-search-field"]}},mounted(){this.setDefaultSearchText(),this.setDefaultListScrollPosition(),setTimeout(()=>{this.reset()},100)},methods:{...E(["computeAssetTypeStats","initAssetTypes","loadAssets","setAssetTypeSearch","setAssetTypeListScrollPosition","setLastProductionScreen"]),setDefaultSearchText(){this.assetTypeSearchText.length>0&&this.$refs["asset-type-search-field"].setValue(this.assetTypeSearchText)},setDefaultListScrollPosition(){this.$refs["asset-type-list"].setScrollPosition(this.assetTypeListScrollPosition)},onSearchChange(){const s=this.$refs["asset-type-search-field"]?.getValue();this.setAssetTypeSearch(s),this.setSearchInUrl(s)},saveScrollPosition(s){this.setAssetTypeListScrollPosition(s)},exportStatisticsToCsv(){const s=[F().format("YYYYMMDD"),this.currentProduction.name,"asset_types","statistics"];this.currentEpisode&&s.splice(2,0,this.currentEpisode.name);const t=N.slugify(s.join("_"));Y.generateStatReports(t,this.assetTypeStats,this.taskTypeMap,this.taskStatusMap,this.assetTypeMap,this.countMode,this.currentProduction)},reset(){this.initialLoading=!0,this.loadAssets().then(()=>{this.computeAssetTypeStats(),this.setAssetTypeListScrollPosition(0),this.initialLoading=!1,this.setSearchFromUrl(),this.onSearchChange()})}},watch:{currentProduction(){this.isTVShow||this.reset()},currentEpisode(){this.isTVShow&&this.reset()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("asset_types.production_title")} - Kitsu`}}},os={class:"asset-types page fixed-page"},rs={class:"asset-type-list-header page-header flexrow"};function ns(s,t,o,L,h,i){const _=p("search-field"),y=p("combobox"),f=p("button-simple"),e=p("production-asset-type-list");return a(),r("div",os,[l("div",rs,[c(_,{class:"flexrow-item mt1",ref:"asset-type-search-field",onChange:i.onSearchChange,placeholder:"ex: chars, agent327"},null,8,["onChange"]),c(y,{class:"mb0 flexrow-item",label:s.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:h.displayModeOptions,modelValue:h.displayMode,"onUpdate:modelValue":t[0]||(t[0]=d=>h.displayMode=d)},null,8,["label","options","modelValue"]),t[1]||(t[1]=l("span",{class:"filler"},null,-1)),c(f,{class:"flexrow-item",icon:"refresh",title:s.$t("main.reload"),onClick:i.reset},null,8,["title","onClick"]),c(f,{class:"flexrow-item",icon:"download",onClick:i.exportStatisticsToCsv},null,8,["onClick"])]),c(e,{ref:"asset-type-list",entries:s.displayedAssetTypes,"is-loading":s.isAssetsLoading||h.initialLoading,"is-error":s.isAssetsLoadingError,"validation-columns":s.assetValidationColumns,"asset-type-stats":s.assetTypeStats,"display-mode":h.displayMode,"show-all":s.assetTypeSearchText.length===0,onScroll:i.saveScrollPosition},null,8,["entries","is-loading","is-error","validation-columns","asset-type-stats","display-mode","show-all","onScroll"])])}const ps=b(ls,[["render",ns]]);export{ps as default};
//# sourceMappingURL=ProductionAssetTypes-7SCKZfnB.js.map
