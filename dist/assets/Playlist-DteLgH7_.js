import{_ as V,c as r,o as n,t as h,n as g,m as K,a as X,bT as Z,O as J,u as Q,S as $,bU as tt,bV as et,U as it,bW as st,bX as lt,K as at,b as nt,B as rt,az as dt,r as c,e as d,f as p,d as u,k as _,a7 as T,F as f,g as P,w as F,G as A,ai as C,bY as ot,bZ as ht,A as M,p as B,b_ as S,b$ as E,c0 as q,a2 as D,c1 as x,aP as yt,b5 as ut,c2 as ct,c3 as pt}from"./index-C9eTF2EQ.js";const gt={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}};function _t(t,e,a,o,l,i){return n(),r("p",{class:g({error:!0,"has-text-right":a.alignRight,"is-hidden":a.hidden})},h(a.text),3)}const ft=V(gt,[["render",_t]]),Pt={name:"playlist",components:{BuildFilterModal:dt,ButtonSimple:rt,Combobox:nt,ComboboxTaskType:at,ErrorText:ft,EditPlaylistModal:lt,LightEntityThumbnail:st,PageSubtitle:it,PlaylistPlayer:et,PlusIcon:tt,SearchField:$,Spinner:Q,TaskTypeName:J,XIcon:Z},data(){return{currentPlaylist:{name:""},currentSort:"updated_at",currentEntities:{},isAddingEntity:!1,isListToggled:!1,isMorePlaylists:!0,page:1,taskTypeId:"",sortedPlaylists:[],sortOptions:["updated_at","created_at","name"].map(t=>({label:t,value:t})),playlistToEdit:{name:`${M().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},previewFileMap:new Map,previewFileEntityMap:new Map,modals:{isBuildFilterDisplayed:!1,isEditDisplayed:!1},loading:{addPlaylist:!1,addDaily:!1,addEpisode:!1,addMovie:!1,addSequence:!1,addWeekly:!1,editPlaylist:!1,morePlaylists:!1,playlist:!1,playlists:!1,playlistsInit:!0},errors:{editPlaylist:!1,playlistLoading:!1}}},computed:{...X(["assetSearchText","currentEpisode","currentProduction","displayedAssets","displayedAssetsByType","displayedSequences","displayedShots","displayedShotsBySequence","isAssetsLoading","isCurrentUserManager","isCurrentUserSupervisor","isShotsLoading","isTVShow","productionTaskTypes","playlistMap","playlists","playlistsPath","shotsByEpisode","shotSearchText","taskMap","taskStatusMap","taskTypeMap"]),isAdditionLoading(){return this.loading.addSequence||this.loading.addWeekly||this.loading.addDaily||this.loading.addEpisode},isAssetPlaylist(){return this.currentPlaylist.for_entity==="asset"},isSequencePlaylist(){return this.currentPlaylist.for_entity==="sequence"},currentEntityType(){return this.currentPlaylist.for_entity},isAddSearchVisible(){return this.isAssetPlaylist&&this.assetSearchText||!this.isAssetPlaylist&&this.shotSearchText},lastPlaylists(){return this.playlists},playlistPlayer(){return this.$refs["playlist-player"]},addEntitiesText(){return this.isAssetPlaylist?this.$t("playlists.add_assets"):this.isSequencePlaylist?this.$t("playlists.add_sequences"):this.$t("playlists.add_shots")},tvShowPageTitle(){const t=this.currentProduction?this.currentProduction.name:"";let e="";return this.currentEpisode&&(this.currentEpisode.id==="all"?e=this.$t("main.all"):this.currentEpisode.id==="main"?e=this.$t("main.main_pack"):e=this.currentEpisode.name),`${t} - ${e} | ${this.$t("playlists.title")} - Kitsu`},shortPageTitle(){return`${this.currentProduction?this.currentProduction.name:""} | ${this.$t("playlists.title")} - Kitsu`},taskTypeList(){return[{id:"",color:"#999",name:this.$t("news.all")}].concat([...this.productionTaskTypes])}},methods:{...K(["changePlaylistOrder","changePlaylistPreview","changePlaylistType","displayMoreAssets","displayMoreShots","editPlaylist","getPendingAssets","getPendingShots","loadEpisodes","loadMorePlaylists","loadPlaylist","loadPlaylists","loadEntityPreviewFiles","loadShots","loadAssets","newPlaylist","refreshPlaylist","removeEntityPreviewFromPlaylist","resetSequences","pushEntityToPlaylist","setAssetSearch","setSequenceSearch","setShotSearch","updatePreviewAnnotation"]),formatDate(t){return pt(t)},getPlaylistPath(t,e){return ct(this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,t,e)},playlistElementStyle(t){return this.isListToggled?void 0:{"border-left":`4px solid ${this.taskTypeMap.get(t.task_type_id)?.color||"transparent"}`}},getTaskStatus(t){let e=E.cache.shotMap.get(t.id);if(e||(e=D.cache.assetMap.get(t.id)),e||(e=x.cache.sequenceMap.get(t.id)),!e)return{};const a=t.validations.get(this.currentPlaylist.task_type_id);if(a){const o=this.taskMap.get(a);return o?this.taskStatusMap.get(o.task_status_id):{}}else return{}},async loadShotsData(){(this.displayedShots.length===0||this.displayedShots[0].project_id!==this.currentProduction.id||this.currentEpisode&&this.displayedShots[0].episode_id!==this.currentEpisode.id)&&(this.isTVShow&&this.currentEpisode&&(this.currentEpisode.id==="main"||this.currentEpisode.id==="all")||(this.isTVShow&&!this.currentEpisode&&await this.loadEpisodes(),await this.loadShots()))},loadAssetsData(){return this.isTVShow||this.displayedAssets.length===0?this.loadAssets():Promise.resolve()},loadPlaylistsData(t=!1){const e=()=>{this.setCurrentPlaylist(()=>((!this.currentPlaylist||!this.currentPlaylist.id)&&this.goFirstPlaylist(),Promise.resolve()))};return this.playlists.length===0||t?this.loadPlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(()=>e()).catch(a=>(console.error(a),this.errors.loadPlaylists=!0,Promise.reject(a))):e()},onPlaylistListScroll(t){if(this.$options.silentMore)return;const e=this.$refs.playlistList,a=e.scrollHeight-e.offsetHeight,o=t.target;a<o.scrollTop+20&&this.onLoadMoreClicked()},onLoadMoreClicked(){this.$options.silentMore=!0,this.page++,this.loading.morePlaylists=!0,this.loadMorePlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(t=>{setTimeout(()=>{this.loading.morePlaylists=!1,this.$options.silentMore=!1},1e3),t.length<20&&(this.isMorePlaylists=!1)}).catch(t=>(console.error(t),this.$options.silentMore=!1,this.errors.loadPlaylists=!0,Promise.reject(t)))},rebuildCurrentEntities(){this.currentEntities={};const t={};this.previewFileMap=new Map,this.previewFileEntityMap=new Map,this.currentPlaylist&&this.currentPlaylist.shots&&this.currentPlaylist.shots.forEach(e=>{const a=this.convertEntityToPlaylistFormat(e);a&&(t[a.id]=a,this.previewFileEntityMap.set(e.preview_file_id,a),Object.values(a.preview_files).forEach(l=>{l.forEach(i=>{this.previewFileMap.set(i.id,i)})}))}),this.$nextTick(()=>{this.currentEntities=t})},onAnnotationsRefreshed(t){const e=this.previewFileEntityMap.get(t.id),a=this.previewFileMap.get(t.id);e&&(e.preview_file_annotations=t.annotations),a&&(a.annotations=t.annotations)},convertEntityToPlaylistFormat(t){let e;if(this.isAssetPlaylist?e=D.cache.assetMap.get(t.id):this.isSequencePlaylist?(e=x.cache.sequenceMap.get(t.id),this.currentEpisode&&(e.episode_name=this.currentEpisode.name)):e=E.cache.shotMap.get(t.id),e){const a={id:t.id,name:e.name,parent_name:e.sequence_name||e.episode_name||e.asset_type_name,preview_files:t.preview_files,preview_file_id:t.preview_file_id||e.preview_file_id,preview_file_extension:t.preview_file_extension||e.preview_file_extension,preview_file_revision:t.preview_file_revision||e.preview_file_revision,preview_file_width:t.preview_file_width||e.preview_file_width,preview_file_height:t.preview_file_height||e.preview_file_height,preview_file_duration:t.preview_file_duration||e.preview_file_duration,preview_file_task_id:t.task_id||t.preview_file_task_id||e.preview_file_task_id,preview_file_annotations:t.preview_file_annotations||e.preview_file_annotations,preview_file_previews:t.preview_file_previews||e.preview_file_previews,preview_nb_frames:t.nb_frames||e.nb_frames||ut};return this.previewFileEntityMap.set(a.preview_file_id,a),(a.preview_file_previews||[]).forEach(l=>{this.previewFileMap.set(l.id,l)}),a}else return null},setCurrentPlaylist(t){const e=this.$route.params.playlist_id,a=this.playlistMap.get(e);a?(this.loading.playlist=!0,this.loadPlaylist(a).then(o=>{this.currentPlaylist=yt(o),this.rebuildCurrentEntities(),this.loading.playlist=!1,t&&t()})):(this.currentPlaylist={name:""},this.currentShots={})},addEntity(t,e,a=!0){return this.currentEntities[t.id]?Promise.resolve():this.loadEntityPreviewFiles(t).then(o=>this.addToStorePlaylistAndSave(o,t,e)).then(o=>{this.addToPlayerPlaylist(o,e,a)}).catch(o=>console.error(o))},addToStorePlaylistAndSave(t,e,a){return this.pushEntityToPlaylist({playlist:a,previewFiles:t,entity:{...e}})},addToPlayerPlaylist(t,e,a=!0){if(e.id!==this.playlistPlayer.playlist.id)return;const o=this.convertEntityToPlaylistFormat(t);this.currentEntities[o.id]=o,this.playlistPlayer.entityList.push(o),a&&this.$nextTick(()=>{this.playlistPlayer?.scrollToRight()})},addEntityToPlaylist(t){if(this.currentEntities[t.id])return;const e=this.currentPlaylist;this.addEntity(t,e).then(this.playlistPlayer.scrollToRight())},onNewEntityDropped(t){let e;if(this.isAssetPlaylist?e=D.cache.assetMap.get(t.after):this.isSequencePlaylist?e=x.cache.sequenceMap.get(t.after):e=E.cache.shotMap.get(t.after),e&&!this.currentEntities[e.id]){const o=this.currentPlaylist;this.addEntity(e,o,!1).then(()=>{this.playlistPlayer.onEntityDropped(t)})}},removeEntity(t){this.removeEntityPreviewFromPlaylist({playlist:this.currentPlaylist,entity:t,callback:()=>{delete this.currentEntities[t.id]}})},clearCurrentPlaylist(){this.currentPlaylist={},this.currentShots={}},resetPlaylist(){this.clearCurrentPlaylist(),this.setCurrentPlaylist()},addCurrentSelection(){this.$options.silent=!0;const t=this.isAssetPlaylist?this.displayedAssets:this.displayedShots;this.addEntities([...t].reverse(),()=>{this.$options.silent=!1})},addSequence(t){if(t.length>0){const e=t[0].sequence_id,a=Array.from(E.cache.shotMap.values()).filter(o=>o.sequence_id===e).sort(B.firstBy("name")).reverse();this.$options.silent=!0,this.addEntities(a,()=>{this.$options.silent=!1})}},async addAllPending(){this.$options.silent=!0,this.loading.addWeekly=!0;const t=this.isAssetPlaylist?this.getPendingAssets:this.getPendingShots,e=this.isAssetPlaylist?q:S;let a=await t(!1);a=e(a).reverse(),this.addEntities(a,()=>{this.loading.addWeekly=!1,this.$options.silent=!1})},async addDailyPending(){this.loading.addDaily=!0,this.$options.silent=!0;const t=this.isAssetPlaylist?this.getPendingAssets:this.getPendingShots,e=this.isAssetPlaylist?q:S;let a=await t(!0);a=e(a).reverse(),this.addEntities(a,()=>{this.loading.addDaily=!1,this.$options.silent=!1})},addEpisodePending(){this.loading.addEpisode=!0,this.$options.silent=!0;let t=[].concat(...this.shotsByEpisode);t=S(t).reverse(),this.addEntities(t,()=>{this.loading.addEpisode=!1,this.$options.silent=!1})},addMovie(){this.loading.addMovie=!0,this.$options.silent=!0;const t=S(Array.from(E.cache.shotMap.values()));this.addEntities(t.reverse(),()=>{this.loading.addMovie=!1,this.$options.silent=!1})},addEntities(t,e,a=void 0){if(a||(a=this.currentPlaylist),t&&t.length>0){const o=t.pop();this.addEntity(o,a).then(()=>{this.addEntities(t,e,a)})}else e()},onPreviewChanged(t,e){this.changePlaylistPreview({playlist:this.currentPlaylist,entity:t,previewFileId:e})},onOrderChange(t){this.changePlaylistOrder({playlist:this.currentPlaylist,info:t})},onAnnotationChanged({preview:t,additions:e,deletions:a,updates:o}){const l=t.task_id;this.updatePreviewAnnotation({taskId:l,preview:t,additions:e,deletions:a,updates:o})},confirmBuildFilter(t){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(t),this.onSearchChange(t)},onSearchChange(t){t.length>1?this.isAssetPlaylist?(this.setAssetSearch(t),this.displayMoreAssets()):this.isSequencePlaylist?(this.setSequenceSearch(t),this.resetSequences()):(this.setShotSearch(t),this.displayMoreShots()):this.isAssetPlaylist?this.setAssetSearch(""):this.isSequencePlaylist?this.setSequenceSearch(""):this.setShotSearch("")},onForClientChanged(t){this.editPlaylist({data:{id:this.currentPlaylist.id,for_client:t}})},runAddPlaylist(t){const e={name:t.name,production_id:this.currentProduction.id,for_client:t.for_client,for_entity:t.for_entity,is_for_all:t.is_for_all,task_type_id:t.task_type_id};this.isTVShow&&this.currentEpisode&&(e.episode_id=this.currentEpisode.id),this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.newPlaylist(e).then(a=>{this.$router.push(this.getPlaylistPath(a.id)),this.loading.editPlaylist=!1,this.modals.isEditDisplayed=!1}).catch(a=>{console.error(a),this.errors.editPlaylist=!0,this.loading.editPlaylist=!1})},confirmEditPlaylist(t){this.playlistToEdit.id?(t.id=this.currentPlaylist.id,this.runEditPlaylist(t)):this.runAddPlaylist(t)},runEditPlaylist(t){this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.editPlaylist({data:{id:t.id,for_client:t.for_client,for_entity:t.for_entity,name:t.name,task_type_id:t.task_type_id},callback:(e,a)=>{e?this.errors.editPlaylist=!0:(this.modals.isEditDisplayed=!1,Object.assign(this.currentPlaylist,a)),this.loading.editPlaylist=!1}})},goFirstPlaylist(){this.playlists.length>0?this.$router.push({name:"playlist",params:{production_id:this.currentProduction.id,playlist_id:this.playlists[0].id}}):this.$router.push(this.playlistsPath)},onEntityDragStart(t,e){t.dataTransfer.setData("entityId",e.id)},toggleAddEntities(){this.isAddingEntity&&this.resetPlaylist(),this.isAddingEntity=!this.isAddingEntity},onTaskTypeChanged(t){this.changePlaylistType({playlist:this.currentPlaylist,taskTypeId:t,callback:()=>{this.rebuildCurrentEntities()}})},onBodyScroll(t){const e=t.target;this.$refs.entityListContent.scrollHeight-this.$refs.entityListContent.offsetHeight<e.scrollTop&&(this.isAssetPlaylist?this.displayMoreAssets():this.displayMoreShots())},resetSorting(){let t=1;["created_at","updated_at"].includes(this.currentSort)&&(t=-1),this.sortedPlaylists=[...this.playlists].sort(B.firstBy(this.currentSort,t).thenBy("name"))},showAddModal(){this.playlistToEdit={name:`${M().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},showEditModal(){this.playlistToEdit=this.currentPlaylist,this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},hideEditModal(){this.playlistToEdit={name:`${M().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.modals.isEditDisplayed=!1},async reloadAll(){this.loading.playlists||(this.loading.playlists=!0,await this.loadShotsData(),await this.loadAssetsData(),this.page=1,await this.loadPlaylistsData(),this.loading.playlists=!1,this.resetPlaylist(),setTimeout(()=>{this.loading.playlistsInit=!1},300))}},mounted(){this.$nextTick(()=>{this.reloadAll(),localStorage.getItem("playlist-sort")&&(this.currentSort=localStorage.getItem("playlist-sort")),this.resetSorting()})},watch:{$route(){this.setCurrentPlaylist()},currentPlaylist(){this.currentPlaylist.shots?(this.$options.silentMore=!1,this.isAddingEntity=Object.keys(this.currentPlaylist.shots).length===0):this.isAddingEntity=!0},currentProduction(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.reloadAll()},currentEpisode(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.currentEpisode&&this.reloadAll()},currentSort(){localStorage.setItem("playlist-sort",this.currentSort),this.loading.playlists=!0,this.page=1,this.loadPlaylistsData(!0).then(()=>{this.loading.playlists=!1})},isListToggled(){this.playlistPlayer?.onWindowResize()},taskTypeId(){this.loadPlaylistsData(!0)}},socket:{events:{"playlist:new"(t){this.playlistMap.get(t.playlist_id)||this.refreshPlaylist(t.playlist_id)},"playlist:update"(t){this.playlistMap.get(t.playlist_id)&&this.refreshPlaylist(t.playlist_id)},"playlist:delete"(t){this.playlistMap.get(t.playlist_id)&&this.$store.commit("DELETE_PLAYLIST_END",{id:t.playlist_id})},"build-job:new"(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=[{id:t.build_job_id,created_at:t.created_at,status:"running",playlist_id:this.currentPlaylist.id}].concat(this.currentPlaylist.build_jobs))},"build-job:update"(t){t.playlist_id===this.currentPlaylist.id&&ht(this.currentPlaylist.build_jobs,{id:t.build_job_id,status:t.status})},"build-job:delete"(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=ot(this.currentPlaylist.build_jobs,{id:t.build_job_id}))}}},head(){return this.isTVShow?{title:this.tvShowPageTitle}:{title:this.shortPageTitle}}},mt={class:"playlists page fixed-page dark"},vt={class:"columns"},wt={class:"flexrow top-section"},Et={key:1,class:"filler"},kt={class:"flexrow"},St={key:1,class:"playlists"},bt={key:0,class:"flexrow"},Tt={class:"ml05"},At={class:"playlist-date"},Ct={key:1,class:"has-text-centered"},Mt={key:3,class:"pa1"},Dt={key:0,class:"playlist-column no-selection"},xt={key:0,class:"flexcolumn xyz-in",xyz:"fade stagger"},Lt={class:"has-text-centered"},Ft={class:"playlist-infos flexrow"},Bt={key:0},qt={key:1},Vt={key:1,class:"playlist-column no-selection has-text-centered"},Ut={key:0},jt={class:"empty-explaination"},Nt={key:2,class:"playlist-column column"},Yt={key:0},Rt={class:"addition-header"},Ot={class:"flexrow"},Ht={class:"flexrow"},It=["disabled"],Wt=["disabled"],zt=["disabled"],Gt=["disabled"],Kt=["disabled"],Xt={key:1,ref:"entityListContent"},Zt={key:0},Jt={key:0,class:"entity-group-title"},Qt={class:"addition-entities"},$t=["onDragstart","onClick"],te={class:"playlisted-shot-name"},ee={key:1},ie={class:"addition-entities"},se=["onDragstart","onClick"],le=["title"],ae={class:"playlisted-shot-name"},ne={key:2},re={key:0,class:"entity-group-title"},de=["onClick"],oe={class:"addition-entities"},he=["onDragstart","onClick"],ye=["title"],ue={class:"playlisted-shot-name"};function ce(t,e,a,o,l,i){const U=c("combobox-task-type"),b=c("button-simple"),j=c("combobox"),N=c("plus-icon"),m=c("light-entity-thumbnail"),L=c("router-link"),k=c("spinner"),Y=c("error-text"),R=c("task-type-name"),O=c("playlist-player"),H=c("page-subtitle"),I=c("x-icon"),W=c("search-field"),z=c("edit-playlist-modal"),G=c("build-filter-modal");return n(),r("div",mt,[d("div",vt,[d("div",{ref:"playlistList",class:g({"playlist-list-column":!0,column:!0,toggled:l.isListToggled}),onScrollPassive:e[4]||(e[4]=(...s)=>i.onPlaylistListScroll&&i.onPlaylistListScroll(...s))},[d("div",wt,[l.isListToggled?u("",!0):(n(),_(U,{key:0,class:"flexrow-item selector mb1","task-type-list":i.taskTypeList,label:t.$t("playlists.filter_task_type"),thin:!0,modelValue:l.taskTypeId,"onUpdate:modelValue":e[0]||(e[0]=s=>l.taskTypeId=s)},null,8,["task-type-list","label","modelValue"])),l.isListToggled?u("",!0):(n(),r("span",Et)),p(b,{class:"flexrow-item",style:{flex:"0"},icon:l.isListToggled?"right":"left","is-small":"",onClick:e[1]||(e[1]=s=>l.isListToggled=!l.isListToggled)},null,8,["icon"])]),d("div",kt,[l.isListToggled?u("",!0):(n(),_(j,{key:0,class:"flexrow-item mb2",label:t.$t("main.sorted_by"),options:l.sortOptions,"locale-key-prefix":"playlists.fields.",modelValue:l.currentSort,"onUpdate:modelValue":e[2]||(e[2]=s=>l.currentSort=s)},null,8,["label","options","modelValue"]))]),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&!l.isListToggled?(n(),r("button",{class:g({button:!0,"is-loading":l.loading.addPlaylist}),onClick:e[3]||(e[3]=(...s)=>i.showAddModal&&i.showAddModal(...s)),key:"new-playlist-button"},[p(N,{class:"icon is-small"}),T(" "+h(t.$t("playlists.new_playlist")),1)],2)):u("",!0),l.loading.playlists?(n(),_(k,{key:2,class:"mt2"})):(n(),r("div",St,[(n(!0),r(f,null,P(t.playlists,s=>(n(),_(L,{key:s.id,to:i.getPlaylistPath(s.id),class:g({"playlist-item":!0,"for-client":s.for_client||!1,selected:s.id===l.currentPlaylist.id})},{default:F(()=>[d("div",{class:"playlist-item-content",style:A(i.playlistElementStyle(s))},[l.isListToggled?(n(),r("div",Ct,[s.first_preview_file_id?(n(),_(m,{key:0,"preview-file-id":s.first_preview_file_id,type:"previews",width:"38px",height:"30px","max-width":"38px","max-height":"30px","empty-width":"38px","empty-height":"30px",title:s.name},null,8,["preview-file-id","title"])):u("",!0)])):(n(),r("div",bt,[p(m,{class:"playlist-thumbnail","preview-file-id":s.first_preview_file_id,type:"previews",width:"53px",height:"35px","max-width":"53px","max-height":"35px","empty-width":"53px","empty-height":"35px",title:s.name},null,8,["preview-file-id","title"]),d("div",Tt,[T(h(s.name)+" ",1),d("span",At,h(t.$t("playlists.updated_at"))+" "+h(i.formatDate(s.updated_at)),1)])]))],4)]),_:2},1032,["to","class"]))),128))])),t.playlists.length>=20&&!l.loading.playlists&&l.isMorePlaylists?(n(),r("div",Mt,[p(b,{class:g({button:!0,"is-loading":l.loading.morePlaylists}),text:t.$t("main.load_more"),onClick:i.onLoadMoreClicked},null,8,["class","text","onClick"])])):u("",!0),l.errors.playlistLoading?(n(),_(Y,{key:4,text:t.$t("playlists.loading_error")},null,8,["text"])):u("",!0)],34),t.playlists.length>0&&!l.currentPlaylist.id&&!l.loading.playlist?(n(),r("div",Dt,[!l.loading.playlists&&!l.loading.playlistsInit?(n(),r("div",xt,[(n(!0),r(f,null,P(i.lastPlaylists,s=>(n(),_(L,{class:"recent-playlist flexrow-item flexrow",key:"recent-playlist-"+s.id,to:i.getPlaylistPath(s.id)},{default:F(()=>[d("div",Lt,[p(m,{class:"playlist-thumbnail","preview-file-id":s.first_preview_file_id,type:"previews",width:"auto",height:"auto","empty-height":"252px"},null,8,["preview-file-id"])]),d("div",Ft,[d("div",null,[d("h3",null,h(s.name),1),l.currentSort==="created_at"?(n(),r("span",Bt,h(t.$t("playlists.created_at"))+" "+h(i.formatDate(s.created_at)),1)):(n(),r("span",qt,h(t.$t("playlists.updated_at"))+" "+h(i.formatDate(s.updated_at)),1))]),e[15]||(e[15]=d("span",{class:"filler"},null,-1)),d("div",null,[s.task_type_id?(n(),_(R,{key:0,"task-type":t.taskTypeMap.get(s.task_type_id)},null,8,["task-type"])):u("",!0)])])]),_:2},1032,["to"]))),128))])):(n(),_(k,{key:1,class:"mt2"}))])):t.playlists.length===0?(n(),r("div",Vt,[!l.loading.playlists&&!l.loading.playlistsInit?(n(),r("div",Ut,[d("p",jt,h(t.$t("playlists.no_playlist")),1),t.isCurrentUserManager||t.isCurrentUserSupervisor?(n(),r("button",{class:g({big:!0,button:!0,"is-loading":l.loading.addPlaylist}),onClick:e[5]||(e[5]=(...s)=>i.showAddModal&&i.showAddModal(...s)),key:"new-playlist-button"},h(t.$t("playlists.new_playlist")),3)):u("",!0)])):(n(),_(k,{key:1,class:"mt2"}))])):(n(),r("div",Nt,[p(O,{ref:"playlist-player",playlist:l.currentPlaylist,entities:l.currentEntities,"is-loading":l.loading.playlist,"is-adding-entity":l.isAddingEntity,"current-entity-type":i.currentEntityType,onEditClicked:i.showEditModal,onShowAddEntities:i.toggleAddEntities,onPreviewChanged:i.onPreviewChanged,onTaskTypeChanged:i.onTaskTypeChanged,onPlaylistDeleted:i.goFirstPlaylist,onRemoveEntity:i.removeEntity,onOrderChange:i.onOrderChange,onAnnotationChanged:i.onAnnotationChanged,onForClientChanged:i.onForClientChanged,onAnnotationsRefreshed:i.onAnnotationsRefreshed,onNewEntityDropped:i.onNewEntityDropped},null,8,["playlist","entities","is-loading","is-adding-entity","current-entity-type","onEditClicked","onShowAddEntities","onPreviewChanged","onTaskTypeChanged","onPlaylistDeleted","onRemoveEntity","onOrderChange","onAnnotationChanged","onForClientChanged","onAnnotationsRefreshed","onNewEntityDropped"]),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&l.isAddingEntity&&!l.loading.playlist?(n(),r("div",Yt,[d("div",Rt,[d("div",Ot,[p(H,{class:"flexrow-item",text:i.addEntitiesText},null,8,["text"]),e[16]||(e[16]=d("span",{class:"filler"},null,-1)),d("a",{class:"close-button",onClick:e[6]||(e[6]=(...s)=>i.toggleAddEntities&&i.toggleAddEntities(...s))},[p(I)])]),d("div",Ht,[p(W,{class:"flexrow-item",ref:"search-field","can-save":!1,onChange:i.onSearchChange,placeholder:i.isAssetPlaylist?"chars mode=wfa":"ex: seq01 anim=wfa"},null,8,["onChange","placeholder"]),p(b,{class:"flexrow-item",title:t.$t("entities.build_filter.title"),icon:"filter",onClick:e[7]||(e[7]=s=>l.modals.isBuildFilterDisplayed=!0)},null,8,["title"]),i.isAddSearchVisible?(n(),r("button",{key:0,class:g({button:!0,"flexrow-item":!0,"add-sequence":!0}),disabled:i.isAdditionLoading,onClick:e[8]||(e[8]=(...s)=>i.addCurrentSelection&&i.addCurrentSelection(...s))},h(t.$t("playlists.add_selection")),9,It)):u("",!0),e[17]||(e[17]=d("span",{class:"filler"},null,-1)),d("button",{class:g({button:!0,"add-sequence":!0,"is-loading":l.loading.addDaily}),disabled:i.isAdditionLoading,onClick:e[9]||(e[9]=(...s)=>i.addDailyPending&&i.addDailyPending(...s))},h(t.$t("playlists.build_daily")),11,Wt),d("button",{class:g({button:!0,"add-sequence":!0,"is-loading":l.loading.addDaily}),disabled:i.isAdditionLoading,onClick:e[10]||(e[10]=(...s)=>i.addAllPending&&i.addAllPending(...s))},h(t.$t("playlists.build_weekly")),11,zt),t.isTVShow&&!i.isAssetPlaylist&&!i.isSequencePlaylist?(n(),r("button",{key:1,class:g({button:!0,"add-sequence":!0,"is-loading":l.loading.addEpisode}),disabled:i.isAdditionLoading,onClick:e[11]||(e[11]=(...s)=>i.addEpisodePending&&i.addEpisodePending(...s))},h(t.$t("playlists.add_episode")),11,Gt)):i.isAssetPlaylist?u("",!0):(n(),r("button",{key:2,class:g({button:!0,"add-sequence":!0,"is-loading":l.loading.addMovie}),disabled:i.isAdditionLoading,onClick:e[12]||(e[12]=(...s)=>i.addMovie&&i.addMovie(...s))},h(t.$t("playlists.add_movie")),11,Kt))])])])):u("",!0),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&l.isAddingEntity?(n(),r("div",{key:1,class:"addition-section",onScrollPassive:e[13]||(e[13]=(...s)=>i.onBodyScroll&&i.onBodyScroll(...s))},[t.isShotsLoading||t.isAssetsLoading?(n(),_(k,{class:"mt2",key:"entity-loader"})):(n(),r("div",Xt,[i.isAssetPlaylist?(n(),r("div",Zt,[(n(!0),r(f,null,P(t.displayedAssetsByType,(s,v)=>(n(),r("div",{key:"asset-type-"+v},[s.length>0?(n(),r("h2",Jt,h(s[0].asset_type_name),1)):u("",!0),d("div",Qt,[(n(!0),r(f,null,P(s.filter(y=>!y.canceled),y=>(n(),r("div",{class:g({"addition-shot":!0,playlisted:l.currentEntities[y.id]!==void 0}),key:y.id,draggable:"true",onDragstart:w=>i.onEntityDragStart(w,y),onClick:C(w=>i.addEntityToPlaylist(y),["prevent"])},[p(m,{"preview-file-id":y.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("span",te,h(y.name),1)],42,$t))),128))])]))),128))])):i.isSequencePlaylist?(n(),r("div",ee,[d("div",ie,[(n(!0),r(f,null,P(t.displayedSequences.filter(s=>!s.canceled),s=>(n(),r("div",{class:g({"addition-shot":!0,playlisted:l.currentEntities[s.id]!==void 0}),key:s.id,draggable:"true",onDragstart:v=>i.onEntityDragStart(v,s),onClick:C(v=>i.addEntityToPlaylist(s),["prevent"])},[p(m,{"preview-file-id":s.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("div",null,[l.currentPlaylist.task_type_id?(n(),r("span",{key:0,title:i.getTaskStatus(s).name,style:A({color:i.getTaskStatus(s).color})}," • ",12,le)):u("",!0),d("span",ae,h(s.name),1)])],42,se))),128))])])):(n(),r("div",ne,[(n(!0),r(f,null,P(t.displayedShotsBySequence,(s,v)=>(n(),r("div",{key:"sequence-"+v},[s.length>0?(n(),r("h2",re,[T(h(s[0].sequence_name)+" ",1),t.isCurrentUserManager||t.isCurrentUserSupervisor?(n(),r("button",{class:"button",onClick:y=>i.addSequence(s),key:"add-sequence-button-"+s[0].sequence_id},h(t.$t("playlists.add_sequence")),9,de)):u("",!0)])):u("",!0),d("div",oe,[(n(!0),r(f,null,P(s.filter(y=>!y.canceled),y=>(n(),r("div",{key:y.id},[d("div",{class:g({"addition-shot":!0,playlisted:l.currentEntities[y.id]!==void 0}),draggable:"true",onDragstart:w=>i.onEntityDragStart(w,y),onClick:C(w=>i.addEntityToPlaylist(y),["prevent"])},[p(m,{"preview-file-id":y.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("div",null,[l.currentPlaylist.task_type_id?(n(),r("span",{key:0,title:i.getTaskStatus(y).name,style:A({color:i.getTaskStatus(y).color})}," • ",12,ye)):u("",!0),d("span",ue,h(y.name),1)])],42,he)]))),128))])]))),128))]))],512))],32)):u("",!0)]))]),p(z,{ref:"edit-playlist-modal",active:l.modals.isEditDisplayed,"is-loading":l.loading.editPlaylist,"is-error":l.errors.editPlaylist,"playlist-to-edit":l.playlistToEdit,"task-type-id":l.taskTypeId,onCancel:i.hideEditModal,onConfirm:i.confirmEditPlaylist},null,8,["active","is-loading","is-error","playlist-to-edit","task-type-id","onCancel","onConfirm"]),p(G,{ref:"build-filter-modal",active:l.modals.isBuildFilterDisplayed,"entity-type":i.currentEntityType,onConfirm:i.confirmBuildFilter,onCancel:e[14]||(e[14]=s=>l.modals.isBuildFilterDisplayed=!1)},null,8,["active","entity-type","onConfirm"])])}const ge=V(Pt,[["render",ce],["__scopeId","data-v-ea8c599b"]]);export{ge as default};
//# sourceMappingURL=Playlist-DteLgH7_.js.map
