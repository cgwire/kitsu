import{j as d,g as l,m as i,a as r,n,l as c,a9 as m,p,M as f,q as h,t as u,u as v,v as _}from"./index-zCN1hhCD.js";import{L as b}from"./ListPageHeader-kl-0_o9V.js";import{R as $}from"./RouteTabs-DcWDeLlF.js";const T={name:"department-list",props:["entries","isLoading","isError"],data(){return{}},components:{RowActionsCell:d,TableInfo:l},computed:{...i([])},methods:{...r([])}};var g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"data-list"},[e("div",{staticClass:"datatable-wrapper"},[e("table",{staticClass:"datatable"},[e("thead",{staticClass:"datatable-head"},[e("tr",[e("th",{staticClass:"name",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("departments.fields.name"))+" ")]),e("th",{attrs:{scope:"col"}},[t._v(t._s(t.$t("departments.fields.color")))]),e("th",{staticClass:"actions",attrs:{scope:"col"}})])]),t.entries.length>0?e("tbody",{staticClass:"datatable-body"},t._l(t.entries,function(a){return e("tr",{key:a.id,staticClass:"datatable-row"},[e("td",{staticClass:"name"},[t._v(" "+t._s(a.name)+" ")]),e("td",{staticClass:"color"},[e("div",[e("span",{style:{background:a.color}})])]),e("row-actions-cell",{attrs:{"entry-id":a.id},on:{"edit-clicked":function(o){return t.$emit("edit-clicked",a)},"delete-clicked":function(o){return t.$emit("delete-clicked",a)}}})],1)}),0):t._e()])]),e("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),e("p",{staticClass:"has-text-centered nb-asset-types"},[t._v(" "+t._s(t.entries.length)+" "+t._s(t.$tc("departments.number",t.entries.length))+" ")])],1)},C=[],E=n(T,g,C,!1,null,"d23abb3f",null,null);const x=E.exports,D={name:"edit-departments-modal",mixins:[c],components:{ColorField:m,ComboboxBoolean:p,ModalFooter:f,TextField:h},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},departmentToEdit:{type:Object,default:()=>{}}},data(){return{form:{name:"",color:"",id:null}}},computed:{...i(["assetTypes","assetTypeStatusOptions"]),isEditing(){return this.departmentToEdit&&this.departmentToEdit.id}},methods:{...r([]),runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},departmentToEdit(){this.isEditing?(this.form.name=this.departmentToEdit.name,this.form.color=this.departmentToEdit.color,this.form.id=this.departmentToEdit.id,this.form.archived=this.departmentToEdit.archive):this.form={name:"",color:"",id:null,archived:String(this.departmentToEdit.archive===!0)}}}};var k=function(){var t=this,e=t._self._c;return e("div",{class:{modal:!0,"is-active":t.active}},[e("div",{staticClass:"modal-background",on:{click:function(a){return t.$emit("cancel")}}}),e("div",{staticClass:"modal-content"},[e("div",{staticClass:"box"},[t.departmentToEdit&&t.departmentToEdit.id?e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("departments.edit_title"))+" "+t._s(t.departmentToEdit.name)+" ")]):e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("departments.new_departments"))+" ")]),e("form",{on:{submit:function(a){a.preventDefault()}}},[e("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("departments.fields.name"),maxlength:30},model:{value:t.form.name,callback:function(a){t.$set(t.form,"name",a)},expression:"form.name"}}),e("color-field",{ref:"colorField",attrs:{label:t.$t("departments.fields.color")},model:{value:t.form.color,callback:function(a){t.$set(t.form,"color",a)},expression:"form.color"}}),t.isEditing?e("combobox-boolean",{attrs:{label:t.$t("main.archived")},on:{enter:t.runConfirmation},model:{value:t.form.archived,callback:function(a){t.$set(t.form,"archived",a)},expression:"form.archived"}}):t._e()],1),e("modal-footer",{attrs:{"error-text":t.$t("departments.create_error"),"is-error":t.isError,"is-loading":t.isLoading},on:{confirm:t.runConfirmation,cancel:function(a){return t.$emit("cancel")}}})],1)])])},w=[],y=n(D,k,w,!1,null,"99fdd9fe",null,null);const F=y.exports,L={name:"departments",components:{DeleteModal:u,DepartmentList:x,EditDepartmentsModal:F,ListPageHeader:b,RouteTabs:$},data(){return{activeTab:"active",departmentToEdit:null,departmentToDelete:null,errors:{departments:!1,edit:!1,del:!1},loading:{departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.departments=!0,this.errors.departments=!1,this.loadDepartments().then(()=>{this.loading.departments=!1,this.errors.departments=!1}).catch(()=>{this.loading.departments=!1,this.errors.departments=!0})},computed:{...i(["departments","archivedDepartments"]),isActiveTab(){return this.activeTab==="active"},departmentList(){return this.isActiveTab?this.departments:this.archivedDepartments},deleteText(){return this.departmentToDelete?this.$t("departments.delete_text",{name:this.departmentToDelete.name}):""}},methods:{...r(["deleteDepartment","loadDepartments","newDepartment"]),onExportClicked(){const s=v.slugify(this.$t("departments.title")),e=[[this.$t("main.type"),this.$t("departments.fields.name"),this.$t("departments.fields.color")]].concat(this.departments.map(a=>[a.type,a.name,a.color]));_.buildCsvFile(s,e)},onNewClicked(){this.departmentToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(s){this.departmentToEdit=s,this.modals.edit=!0},confirmEditDepartment(s){let t="newDepartment";this.departmentToEdit&&this.departmentToEdit.id&&(t="editDepartment",s.id=this.departmentToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,s).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0})},onDeleteClicked(s){this.departmentToDelete=s,this.modals.del=!0},async confirmDeleteDepartment(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteDepartment(this.departmentToDelete),this.loading.del=!1,this.modals.del=!1}catch{this.loading.del=!1,this.errors.del=!0}}},watch:{$route(){this.activeTab=this.$route.query.tab}},metaInfo(){return{title:`${this.$t("departments.title")} - Kitsu`}}};var R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"departments page fixed-page"},[e("list-page-header",{attrs:{title:t.$t("departments.title"),"new-entry-label":t.$t("departments.new_departments"),"is-exportable":t.isActiveTab},on:{"export-clicked":t.onExportClicked,"new-clicked":t.onNewClicked}}),e("route-tabs",{staticClass:"mt2",attrs:{"active-tab":t.activeTab,tabs:t.tabs,"route-name":"departments"}}),e("department-list",{staticClass:"department-list",attrs:{entries:t.departmentList,"is-loading":t.loading.departments,"is-error":t.errors.departments},on:{"edit-clicked":t.onEditClicked,"delete-clicked":t.onDeleteClicked}}),e("edit-departments-modal",{attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"department-to-edit":t.departmentToEdit},on:{cancel:function(a){t.modals.edit=!1},confirm:t.confirmEditDepartment}}),e("delete-modal",{attrs:{active:t.modals.del,"is-loading":t.loading.del,"is-error":t.errors.del,text:t.deleteText,"error-text":t.$t("departments.delete_error")},on:{cancel:function(a){t.modals.del=!1},confirm:t.confirmDeleteDepartment}})],1)},A=[],M=n(L,R,A,!1,null,"4f63f233",null,null);const j=M.exports;export{j as default};
//# sourceMappingURL=Departments-D_I4u4v0.js.map
