import{_ as I,aj as W,r as d,c as u,o,k as v,m as X,a as Y,bI as Z,aR as J,O as Q,u as $,cX as ee,aF as te,U as se,cY as ie,at as re,E as ne,cZ as ae,a9 as oe,Y as de,c_ as le,ap as me,c$ as ce,$ as he,a0 as ue,aI as ke,aL as pe,d0 as ve,z as we,d1 as fe,j as _e,e as n,f as c,d as h,w as _,a7 as Ce,t as m,F as E,g as x,n as Pe,l as ye,d2 as ge,M as b,cw as y,d3 as Te,d4 as Ee,b$ as xe,c1 as be,bc as Ie,aS as Me,a2 as Ae}from"./index-BcnNiyx_.js";import{E as Fe}from"./eye-off-BuRgqRyp.js";const Se={name:"subscribe-button",components:{EyeIcon:W,EyeOffIcon:Fe},props:{subscribed:{default:!1,type:Boolean}},emits:["click"],computed:{buttonTitle(){return this.subscribed?this.$t("tasks.unsubscribe_notifications"):this.$t("tasks.subscribe_notifications")}}},Le=["title"];function De(e,t,i,a,r,s){const l=d("eye-icon"),k=d("eye-off-icon");return o(),u("button",{class:"button",title:s.buttonTitle,onClick:t[0]||(t[0]=w=>e.$emit("click"))},[i.subscribed?(o(),v(l,{key:0,class:"icon is-small"})):(o(),v(k,{key:1,class:"icon is-small"}))],8,Le)}const Re=I(Se,[["render",De]]),Ue={name:"task",mixins:[we,fe],components:{AddComment:ve,AddPreviewModal:pe,ChevronDownIcon:ke,ChevronLeftIcon:ue,ChevronRightIcon:he,ChevronUpIcon:ce,ComboboxStyled:me,Comment:le,CornerLeftUpIcon:de,DeleteModal:oe,EditCommentModal:ae,EntityThumbnail:ne,KitsuIcon:re,ImageIcon:ie,PageSubtitle:se,PeopleAvatar:te,PreviewPlayer:ee,Spinner:$,SubscribeButton:Re,TaskTypeName:Q,ValidationTag:J,ViewPlaylistModal:Z},provide(){return{draftComment:this.draftComment}},data(){return{draftComment:{},previewForms:[],currentFrame:0,currentTask:null,hookupPlaylistTaskIds:[],selectedTab:"validation",taskLoading:{isLoading:!0,isError:!1},modals:{addPreview:!1,addExtraPreview:!1,deleteExtraPreview:!1,deleteComment:!1,editComment:!1,hookupPlaylist:!1},loading:{addComment:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteComment:!1,editComment:!1},errors:{addComment:!1,addCommentMaxRetakes:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteComment:!1,editComment:!1},addPreviewFormData:null,addExtraPreviewFormData:null,task:null,taskComments:[],taskPreviews:[],commentToEdit:null,selectedPreviewId:null}},created(){this.clearSelectedTasks()},async mounted(){await this.loadTaskData(),await this.$nextTick(),await this[`load${this.currentType}s`](),this.reset(),await this.$nextTick(),this.$refs["task-columns"]&&(this.$refs["task-columns"].scrollTop=100,window.scrollTo(0,0))},computed:{...Y(["currentEpisode","currentProduction","displayedShots","displayedAssets","getTaskComments","getTaskPreviews","getTaskComment","isCurrentUserArtist","isCurrentUserClient","isCurrentUserManager","isCurrentUserSupervisor","isSingleEpisode","isTVShow","personMap","productionMap","route","shotMap","taskEntityPreviews","taskStatus","taskStatusForCurrentUser","taskMap","taskTypeMap","user"]),assetList(){return Ae.cache.assets},editList(){return Me.cache.edits},episodeList(){return Ie.cache.episodes},sequenceList(){return be.cache.sequences},shotList(){return xe.cache.shots},currentEntity(){return this.task&&this.task.entity},currentType(){return["Shot","Episode","Sequence","Edit"].includes(this.task?.entity_type_name)?this.task.entity_type_name:"Asset"},previewOptions(){return[...this.taskPreviews].sort((e,t)=>t.revision-e.revision).map(e=>({label:`v${e.revision}`,value:e.id}))},isPreviewButtonVisible(){return this.isCurrentUserManager&&this.task&&this.task.entity&&this.task.entity.preview_file_id!==this.currentPreviewId&&["png","mp4"].includes(this.extension)},isMovie(){return this.extension==="mp4"},isPreviewPlayerReadOnly(){if(this.task){if(this.isCurrentUserManager||this.isCurrentUserClient)return!1;if(this.isCurrentUserSupervisor)return this.user.departments.length===0?!1:!this.user.departments.includes(this.taskType?.department_id)}return!0},extension(){return this.currentPreview?this.currentPreview.extension:""},currentPreviewId(){return this.currentPreview?this.currentPreview.id:""},currentPreview(){if(this.isPreviews){let e=this.taskPreviews[0];const t=this.route.params.preview_id;return this.selectedPreviewId&&(e=this.taskPreviews.find(i=>i.id===t)),e}else return null},currentPreviewComment(){return this.taskComments.find(e=>e.previews?.some(t=>t.revision===this.currentRevision))},currentRevision(){return this.currentPreview?.revision||0},taskTypeBorder(){let e="transparent";return this.task&&(e=this.task.task_type_color),{"border-left":`4px solid ${e}`}},deleteTaskPath(){return this.taskPath(this.task,"task-delete")},isPreviews(){return this.taskPreviews&&this.taskPreviews.length>0},taskEntityPath(){if(this.task){const e=this.currentEpisode?this.currentEpisode.id:this.$route.params.episode_id;return Ee(this.task,e)}else return{name:"open-productions"}},taskEntitiesPath(){if(this.task){const e=this.currentEpisode?this.currentEpisode.id:this.$route.params.episode_id;return Te(this.task,e)}else return{name:"open-productions"}},entityList(){return this[`${this.currentType.toLowerCase()}List`]},previousEntityTaskPath(){if(!this.task)return null;const e=this.entityList.find(l=>l.id===this.task.entity_id);if(!e)return null;let t=e.tasks||[];t=t.sort((l,k)=>{const w=this.taskMap.get(l),f=this.taskMap.get(k),C=this.taskTypeMap.get(w?.task_type_id),P=this.taskTypeMap.get(f?.task_type_id);return y(C,this.currentProduction)-y(P,this.currentProduction)});const i=t.length,r=t.findIndex(l=>l===this.task.id)-1,s=r<0?t[i-1]:t[r];return s?this.taskPath({id:s}):null},nextEntityTaskPath(){if(!this.task)return null;const e=this.entityList.find(l=>l.id===this.task.entity_id);if(!e)return null;let t=e.tasks||[];t=t.sort((l,k)=>{const w=this.taskMap.get(l),f=this.taskMap.get(k),C=this.taskTypeMap.get(w?.task_type_id),P=this.taskTypeMap.get(f?.task_type_id);return y(C,this.currentProduction)-y(P,this.currentProduction)});const i=t.length,r=t.findIndex(l=>l===this.task.id)+1,s=r>=i?t[0]:t[r];return s?this.taskPath({id:s}):null},previousTaskPath(){if(!this.task)return null;const e=this.getEntityIndex(this.task.entity_id);if(e===-1)return null;let t=this.getPreviousEntityIndex(e),i=null;for(;!i&&t!==e;)i=this.getTaskIdFromEntity(t),i||(t=this.getPreviousEntityIndex(t));return i?this.taskPath({id:i}):null},nextTaskPath(){if(!this.task)return null;const e=this.getEntityIndex(this.task.entity_id);if(e===-1)return null;let t=this.getNextEntityIndex(e),i=null;for(;!i&&t!==e;)i=this.getTaskIdFromEntity(t),i||(t=this.getNextEntityIndex(t));return i?this.taskPath({id:i}):null},title(){if(this.task){const e=this.task.entity_type_name;let t=this.task.full_entity_name||this.task.entity_name;return this.isTVShow&&e==="Shot"&&(t=t.split("/").splice(1).join("/")),this.isTVShow&&e==="Episode"&&(t=this.task.entity_name),`${t}`}else return"Loading..."},windowTitle(){if(this.task){const e=this.task.task_type_name;return`${this.title} / ${e}`}else return"Loading..."},deleteText(){if(this.task){const e=this.taskTypeMap.get(this.task.task_type_id);return this.$t("main.delete_text",{name:`${this.task.entity_name} / ${e.name}`})}else return""},assignees(){return b(this.task.assignees.map(e=>this.personMap.get(e)))},isAssigned(){return this.task?.assignees.some(e=>e===this.user.id)??!1},isCommentingAllowed(){return this.isAssigned||this.isCurrentUserClient||this.isDepartmentSupervisor||this.isCurrentUserManager},isDepartmentSupervisor(){return this.isCurrentUserSupervisor?this.user.departments.length===0?!0:this.user.departments.includes(this.taskType?.department_id):!1},isHookupButtonVisible(){return this.task?.entity_type_name==="Shot"},taskType(){return this.taskTypeMap.get(this.task?.task_type_id)},currentTeam(){return b(this.currentProduction.team.map(e=>this.personMap.get(e)))}},methods:{...X(["addAttachmentToComment","ackComment","addCommentPreview","addCommentExtraPreview","commentTask","commentTaskWithPreview","changeCommentPreview","clearSelectedTasks","deleteAttachment","deleteTaskPreview","deleteTaskComment","editTaskComment","loadComment","loadAssets","loadEdits","loadEpisodes","loadSequences","loadShots","loadTask","loadPreviewFileFormData","loadTaskComments","refreshComment","refreshPreview","pinComment","subscribeToTask","setCurrentEpisode","unsubscribeFromTask","updatePreviewAnnotation"]),getPreviousEntityIndex(e){const t=e-1;return t<0?this.entityList.length-1:t},getNextEntityIndex(e){const t=e+1;return t>=this.entityList.length?0:t},getEntityIndex(e){return this.entityList.findIndex(t=>t.id===e)},getTaskIdFromEntity(e){const t=this.task.task_type_id,i=this.entityList[e];return i?i.tasks.find(a=>{const r=this.taskMap.get(a);return r&&r.task_type_id===t}):null},loadTaskData(){const e=this.getCurrentTask();if(e){const t=this.route.params.task_id;return this.task=e,this.loadTaskComments({taskId:t,entityId:e.entity_id}).then(()=>{this.reset()}).catch(i=>{console.error(i),this.taskLoading.isError=!0}).finally(()=>{this.taskLoading.isLoading=!1})}else return this.taskLoading={isLoading:!0,isError:!1},this.loadTask({taskId:this.route.params.task_id}).then(t=>{let i=a=>{this.loadAssets().then(a)};return t.entity_type_name==="Shot"&&(i=a=>{this.loadEpisodes().then(()=>{this.isTVShow&&this.setCurrentEpisode(t.episode.id),this.loadShots(a)}).catch(a)}),i(()=>(this.task=t,this.loadTaskComments({taskId:t.id,entityId:t.entity_id}).then(()=>{this.reset(),this.taskLoading={isLoading:!1,isError:!1}}).catch(a=>{console.error(a),this.taskLoading={isLoading:!1,isError:!0}})))}).catch(t=>{console.error(t),this.taskLoading={isLoading:!1,isError:!0}})},getCurrentTask(){return this.taskMap.get(this.route.params.task_id)},getCurrentTaskComments(){return this.getTaskComments(this.route.params.task_id)},getCurrentTaskPreviews(){return this.getTaskPreviews(this.route.params.task_id)},addComment(e,t,i,a,r=void 0,s=void 0){const l={taskId:this.task.id,taskStatusId:a,attachment:t,checklist:i,comment:e,links:s?[s]:null,revision:r},k=this.previewForms.length>0?"commentTaskWithPreview":"commentTask";this.loading.addComment=!0,this.errors.addComment=!1,this.errors.addCommentMaxRetakes=!1,this.$store.dispatch(k,l).then(()=>{ge.clearTaskDraft(this.task.id),this.$refs["add-comment"]?.reset(),this.reset(),this.loading.addComment=!1}).catch(w=>{console.error(w),this.errors.addComment=!0,this.loading.addComment=!1;const f=w.body?.message?.includes("retake")??!1;this.errors.addComment=!f,this.errors.addCommentMaxRetakes=f})},hideHookupPlaylistModal(){this.modals.hookupPlaylist=!1},showHookupPlaylistModal(){const e=this.task.id,t=Array.from(this.taskMap.values()).filter(s=>s.episode_id===this.task.episode_id&&s.sequence_name===this.task.sequence_name&&s.task_type_id===this.task.task_type_id).sort((s,l)=>s.entity_name.localeCompare(l.entity_name,void 0,{numeric:!0})),i=t.findIndex(s=>s.id===e),a=i>0?t[i-1].id:null,r=i<t.length-1?t[i+1].id:null;this.hookupPlaylistTaskIds=[e],a&&this.hookupPlaylistTaskIds.unshift(a),r&&this.hookupPlaylistTaskIds.push(r),this.modals.hookupPlaylist=!0},reset({keepPreviewFiles:e=!1}={}){this.resetModals(),this.resetPreview(!1),e||this.clearPreviewFiles(!1),this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews(),this.task=this.getCurrentTask(),this.resetDraft(),setTimeout(()=>{this.$route.params.preview_id&&(this.selectedPreviewId=this.$route.params.preview_id)},200)},selectFile(e){this.previewForms=this.previewForms.concat(e),this.loadPreviewFileFormData(this.previewForms)},clearPreviewFiles(){this.previewForms=[],this.loadPreviewFileFormData(this.previewForms),this.$store.commit("CLEAR_UPLOAD_PROGRESS")},isHighlighted(e){return e.preview&&e.preview.id===this.currentPreviewId},createExtraPreview(e){this.selectFile(e),this.errors.addExtraPreview=!1,this.loading.addExtraPreview=!0;const t=this.getCurrentTaskComments().find(i=>i.previews.find(a=>a.id===this.currentPreviewId));this.addCommentExtraPreview({taskId:this.task.id,commentId:t?.id,previewId:this.currentPreviewId}).then(()=>{this.loading.addExtraPreview=!1,this.modals.addExtraPreview=!1,this.$refs["add-extra-preview-modal"].reset(),this.clearPreviewFiles(),setTimeout(()=>{this.$refs["preview-player"].displayLast()},0)}).catch(i=>{console.error(i),this.errors.addExtraPreview=!0,this.loading.addExtraPreview=!1})},resetPreview(e=!0){const t=this.taskPreviews||[],i=t.length>0?t[0]:null;this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews(),i&&e&&this.$router.push(this.previewPath(i.id))},setPreview(){const e=this.$refs["preview-player"];if(!e)return;this.loading.setPreview=!0,this.errors.setPreview=!1;const t=e.currentPreview.id;this.$store.dispatch("setPreview",{taskId:this.task.id,entityId:this.task.entity.id,previewId:t}).then(()=>{this.loading.setPreview=!1}).catch(i=>{console.error(i),this.errors.setPreview=!0})},async saveComment(e){try{await this.editTaskComment({taskId:this.task.id,comment:e})}catch(t){console.error(t),await this.loadTaskData()}},confirmDeleteTaskComment(){this.loading.deleteComment=!0,this.errors.deleteComment=!1;const e=this.commentToEdit.id;this.deleteTaskComment({taskId:this.task.id,commentId:e}).then(()=>{this.loading.deleteComment=!1,this.reset(),this.isPreviews&&this.resetPreview(),this.modals.deleteComment=!1}).catch(t=>{console.error(t),this.loading.deleteComment=!1,this.errors.deleteComment=!0})},confirmDeleteTaskPreview(){this.loading.deleteExtraPreview=!0,this.errors.deleteExtraPreview=!1;const e=this.currentPreviewId,t=this.getCurrentTaskComments().find(i=>i.previews.findIndex(a=>a.id===e)>=0);this.$refs["preview-player"].displayFirst(),this.deleteTaskPreview({taskId:this.task.id,commentId:t.id,previewId:this.currentExtraPreviewId}).then(()=>{this.loading.deleteExtraPreview=!1,this.resetPreview(),this.hideRemoveExtraPreviewModal()}).catch(i=>{console.error(i),this.loading.deleteExtraPreview=!1,this.errors.deleteExtraPreview=!0})},onPreviewAdded(e){const t=e.task_id,i=e.comment_id,a=e.preview_file_id,r=e.revision,s=e.extension,l=this.$store.getters.getTaskComment(t,i);this.task&&l&&l.previews&&(l.previews.length===0||l.previews[0].id!==a)&&t===this.task.id&&(this.$store.commit("ADD_PREVIEW_END",{preview:{id:a,revision:r,extension:s},taskId:t,commentId:i,comment:l}),this.reset({keepPreviewFiles:!0}))},toggleSubscribe(){this.task&&!this.isAssigned&&(this.task.is_subscribed?this.unsubscribeFromTask(this.task.id):this.subscribeToTask(this.task.id))},taskPath(e,t="task"){e?(e.project_id=this.task.project_id,e.episode_id=this.task.episode_id):e=this.task;let i={name:"open-productions"};return e&&(i={name:t,params:{type:this.currentType.toLowerCase()+"s",production_id:e.project_id,task_id:e.id}},this.isTVShow&&this.currentEpisode&&(i.name=`episode-${t}`,i.params.episode_id=e.episode_id||this.currentEpisode.id)),i},previewPath(e){const t=this.taskPath(this.task,"task-preview");if(this.isTVShow){const i=this.taskTypeMap.get(this.task.task_type_id);t.name="episode-task-preview",i.for_entity==="Episode"&&(t.name="episode-episode-task-preview")}return t.params&&(t.params.preview_id=e),t},onAnnotationChanged({preview:e,additions:t,deletions:i,updates:a}){const r=this.task.id;this.updatePreviewAnnotation({taskId:r,preview:e,additions:t,deletions:i,updates:a})},onAddExtraPreviewClicked(){this.clearPreviewFiles(),this.modals.addExtraPreview=!0},onRemoveExtraPreviewClicked(e){this.showRemoveExtraPreviewModal(e)},hideExtraPreviewModal(){this.modals.addExtraPreview=!1},showRemoveExtraPreviewModal(e){this.currentExtraPreviewId=e.id,this.modals.deleteExtraPreview=!0},hideRemoveExtraPreviewModal(){this.modals.deleteExtraPreview=!1},onAddPreviewClicked(){this.modals.addPreview=!0},closeAddPreviewModal(){this.modals.addPreview=!1},confirmAddPreviewModal(e){this.selectFile(e),this.closeAddPreviewModal()},onAckComment(e){this.ackComment(e)},onDuplicateComment(e){this.$refs["add-comment"].setValue(e)},onPinComment(e){this.pinComment(e)},onEditComment(e){this.commentToEdit=e,this.modals.editComment=!0},onDeleteComment(e){this.commentToEdit=e,this.modals.deleteComment=!0},onCancelEditComment(e){this.modals.editComment=!1},onCancelDeleteComment(e){this.modals.deleteComment=!1},onFrameUpdated(e){this.currentFrame=e},onPreviewFormRemoved(e){this.previewForms=this.previewForms.filter(t=>t!==e),this.loadPreviewFileFormData(this.previewForms)},changeCurrentPreview(e){this.$router.push(this.previewPath(e.id))},onRemoteAcknowledge(e,t){if(this.task){const i=this.taskComments.find(r=>r.id===e.comment_id),a=this.personMap.get(e.person_id);i&&a&&(this.user.id===a.id?(t==="ack"&&!i.acknowledgements.includes(a.id)||t==="unack"&&i.acknowledgements.includes(a.id))&&this.$store.commit("ACK_COMMENT",{comment:i,user:a}):this.$store.commit("ACK_COMMENT",{comment:i,user:a}))}},isStatusChange(e){const t=this.taskComments,i=t[e];return e===t.length-1||i.task_status_id!==t[e+1].task_status_id},timeCodeClicked({versionRevision:e,minutes:t,seconds:i,milliseconds:a,frame:r}){this.changeCurrentPreview(this.taskPreviews.find(s=>s.revision===parseInt(e))),setTimeout(()=>{this.$refs["preview-player"]?.setCurrentFrame(r),this.$refs["preview-player"]?.focus()},100)},onPreviewsOrderChanged(){this.taskPreviews=this.getCurrentTaskPreviews()},async extractAnnotationSnapshots(){this.$refs["add-comment"].showAnnotationLoading();const e=await this.$refs["preview-player"].extractAnnotationSnapshots();return this.$refs["add-comment"].setAnnotationSnapshots(e),this.$refs["add-comment"].hideAnnotationLoading(),e}},watch:{$route(){this.task&&this.$route.params.task_id!==this.task.id&&this.loadTaskData(),this.$route.params.preview_id!==this.selectedPreviewId&&(this.selectedPreviewId=this.$route.params.preview_id)},currentProduction(){this.loadTaskData()},selectedPreviewId(){this.task&&this.selectedPreviewId&&this.$router.push(this.previewPath(this.selectedPreviewId))}},socket:{events:{"preview-file:add-file"(e){this.onPreviewAdded(e)},"preview-file:update"(e){const t=this.taskComments.find(i=>i.previews&&i.previews.length>0&&i.previews[0].id===e.preview_file_id);t&&this.task&&this.refreshPreview({taskId:this.task.id,previewId:e.preview_file_id}).then(i=>{t.previews[0].validation_status=i.validation_status})},"comment:acknowledge"(e){this.onRemoteAcknowledge(e,"ack")},"comment:unacknowledge"(e){this.onRemoteAcknowledge(e,"unack")},"comment:new"(e){setTimeout(()=>{this.getCurrentTaskComments().length!==this.taskComments.length&&(this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews())},1e3)},"comment:update"(e){const t=e.comment_id;this.taskComments.some(({id:i})=>i===t)&&this.loadComment({commentId:t}).catch(console.error)},"comment:reply"(e){if(this.task){const t=this.taskComments.find(i=>i.id===e.comment_id);t&&(t.replies||(t.replies=[]),t.replies.some(a=>a.id===e.reply_id)||this.refreshComment({commentId:e.comment_id}).then(a=>{t.replies=a.replies}).catch(console.error))}},"comment:delete"(e){const t=this.getTask();if(t){const a=this.getComments().find(r=>r.id===e.comment_id);a&&(this.$store.commit("REMOVE_TASK_COMMENT",{task:t,comment:a}),this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews())}},"comment:delete-reply"(e){if(this.task){const t=this.taskComments.find(i=>i.id===e.comment_id);t&&(t.replies||(t.replies=[]),this.$store.commit("REMOVE_REPLY_FROM_COMMENT",{comment:t,reply:{id:e.reply_id}}))}},"preview-file:annotation-update"(e){const t=this.$refs["preview-player"];if(!t)return;t.isValidPreviewModification(e.preview_file_id,e.updated_at)&&this.refreshPreview({previewId:t.currentPreview.id,taskId:t.currentPreview.task_id}).then(()=>{t.notSaved||(this.taskPreviews=this.getCurrentTaskPreviews(),this.$nextTick(()=>{t.reloadAnnotations(),t.loadAnnotation()}))})}}},head(){let e="Loading task... - Kitsu";if(this.task){const t=this.taskTypeMap.get(this.task.task_type_id).name;e=`${this.title} / ${t} - Kitsu`}return{title:e}}},Ve={class:"fixed-page columns xyz-in",xyz:"fade"},Oe={class:"page column main-column"},Ne={class:"page-header pa1 mb0",xyz:"fade"},Be={key:0,class:"flexrow header-title"},ze={class:"flexrow-item block flexrow task-type"},qe={class:"flexrow-item ml2"},He={class:"title flexrow-item"},je={class:"flexrow-item flexrow block"},Ke={class:"flexrow-item"},Ge={key:1,class:"flexrow-item"},We={class:"task-columns",ref:"task-columns"},Xe={class:"task-column preview-column"},Ye={class:"preview-column-content block"},Ze={class:"flexrow preview-header"},Je={key:0,class:"flexrow-item"},Qe={key:1},$e={key:2,class:"set-main-preview flexrow-item flexrow pull-right"},et={class:"text"},tt={key:2,class:"error flexrow-item"},st={class:"preview-area mt1"},it={key:0},rt={class:"flexrow-item block mt1 mr0 info-block"},nt={class:"table-body mt1"},at={key:0,class:"datatable no-header"},ot={class:"table-body"},dt={class:"datatable-row"},lt={class:"field-label"},mt={class:"datatable-row"},ct={class:"field-label"},ht={class:"datatable-row"},ut={class:"field-label"},kt={class:"datatable-row"},pt={class:"field-label"},vt={class:"datatable-row"},wt={class:"field-label"},ft={class:"datatable-row"},_t={class:"field-label"},Ct={class:"datatable-row"},Pt={class:"field-label"},yt={class:"task-column comments-column"},gt={key:0},Tt={key:1,class:"comments"},Et={key:2,class:"no-comment"},xt={key:1,class:"has-text-centered"};function bt(e,t,i,a,r,s){const l=d("corner-left-up-icon"),k=d("router-link"),w=d("chevron-left-icon"),f=d("chevron-right-icon"),C=d("task-type-name"),P=d("entity-thumbnail"),M=d("validation-tag"),A=d("people-avatar"),F=d("subscribe-button"),S=d("chevron-up-icon"),L=d("chevron-down-icon"),D=d("combobox-styled"),R=d("kitsu-icon"),U=d("image-icon"),V=d("view-playlist-modal"),O=d("preview-player"),N=d("page-subtitle"),B=d("add-comment"),z=d("comment"),q=d("XyzTransitionGroup"),H=d("spinner"),g=d("add-preview-modal"),j=d("edit-comment-modal"),T=d("delete-modal"),K=_e("xyz");return o(),u("div",Ve,[n("div",Oe,[n("div",Ne,[r.task?(o(),u("div",Be,[c(k,{class:"flexrow-item has-text-centered back-link",to:s.taskEntitiesPath},{default:_(()=>[c(l)]),_:1},8,["to"]),n("div",ze,[s.previousEntityTaskPath?(o(),v(k,{key:0,class:"flexrow-item mt05",to:s.previousEntityTaskPath},{default:_(()=>[c(w)]),_:1},8,["to"])):h("",!0),s.nextEntityTaskPath?(o(),v(k,{key:1,class:"flexrow-item mt05",to:s.nextEntityTaskPath},{default:_(()=>[c(f)]),_:1},8,["to"])):h("",!0),s.taskType?(o(),v(C,{key:2,class:"flexrow-item","task-type":s.taskType,"production-id":e.currentProduction.id},null,8,["task-type","production-id"])):h("",!0)]),n("span",qe,[c(P,{class:"entity-thumbnail",entity:s.currentEntity,"empty-width":100,"empty-height":60,width:100,"with-link":!0},null,8,["entity"])]),n("h1",He,[c(k,{to:s.taskEntityPath},{default:_(()=>[Ce(m(r.task?s.title:"Loading..."),1)]),_:1},8,["to"])]),n("div",je,[n("span",Ke,m(e.$t("tasks.current_status")),1),r.task?(o(),v(M,{key:0,class:"is-medium flexrow-item",task:r.task,"is-static":!0},null,8,["task"])):h("",!0),s.assignees.length>0&&!e.isCurrentUserClient?(o(),u("span",Ge,m(e.$t("tasks.fields.assignees"))+": ",1)):h("",!0),e.isCurrentUserClient?h("",!0):(o(!0),u(E,{key:2},x(s.assignees,p=>(o(),u("span",{class:"flexrow-item avatar-wrapper",key:p.id},[c(A,{class:"flexrow-item",person:p,size:30,"font-size":16},null,8,["person"])]))),128)),s.isAssigned?h("",!0):(o(),v(F,{key:3,class:"flexrow-item action-button",subscribed:s.isAssigned||r.task.is_subscribed,onClick:s.toggleSubscribe},null,8,["subscribed","onClick"])),s.previousTaskPath?(o(),v(k,{key:4,class:"flexrow-item",to:s.previousTaskPath},{default:_(()=>[c(S)]),_:1},8,["to"])):h("",!0),s.nextTaskPath?(o(),v(k,{key:5,class:"flexrow-item",to:s.nextTaskPath},{default:_(()=>[c(L)]),_:1},8,["to"])):h("",!0)])])):h("",!0)]),n("div",We,[n("div",Xe,[n("div",Ye,[n("div",Ze,[s.isPreviews?(o(),u("div",Je,[c(D,{class:"preview-combo flexrow-item",options:s.previewOptions,"is-preview":"",modelValue:r.selectedPreviewId,"onUpdate:modelValue":t[0]||(t[0]=p=>r.selectedPreviewId=p)},null,8,["options","modelValue"])])):(o(),u("div",Qe,[n("em",null,m(e.$t("tasks.no_preview")),1)])),s.currentPreview?(o(),u("div",$e,[s.isHookupButtonVisible?(o(),u("button",{key:0,class:"button flexrow-item",onClick:t[1]||(t[1]=(...p)=>s.showHookupPlaylistModal&&s.showHookupPlaylistModal(...p))},[c(R,{name:"playlists",title:e.$t("tasks.hookup_playlist")},null,8,["title"])])):h("",!0),e.isCurrentUserManager?(o(),u("button",{key:1,class:Pe(["button flexrow-item",{"is-loading":r.loading.setPreview}]),onClick:t[2]||(t[2]=(...p)=>s.setPreview&&s.setPreview(...p))},[c(U,{class:"icon"}),n("span",et,m(e.$t("tasks.set_preview")),1)],2)):h("",!0),r.errors.setPreview?(o(),u("span",tt,m(e.$t("tasks.set_preview_error")),1)):h("",!0)])):h("",!0),c(V,{active:r.modals.hookupPlaylist,"task-ids":r.hookupPlaylistTaskIds,sort:"",onCancel:s.hideHookupPlaylistModal},null,8,["active","task-ids","onCancel"])]),n("div",st,[s.isPreviews?(o(),u("div",it,[s.currentPreview?(o(),v(O,{key:0,ref:"preview-player","entity-preview-files":e.taskEntityPreviews,"extra-wide":!0,"last-preview-files":r.taskPreviews||[],link:s.currentPreviewComment?.links?.[0],previews:s.currentPreview.previews,"read-only":s.isPreviewPlayerReadOnly,task:r.task,"task-type-map":e.taskTypeMap,onAddExtraPreview:s.onAddExtraPreviewClicked,onAnnotationChanged:s.onAnnotationChanged,onChangeCurrentPreview:s.changeCurrentPreview,onRemoveExtraPreview:s.onRemoveExtraPreviewClicked,onPreviewsOrderChanged:s.onPreviewsOrderChanged,onFrameUpdated:s.onFrameUpdated},null,8,["entity-preview-files","last-preview-files","link","previews","read-only","task","task-type-map","onAddExtraPreview","onAnnotationChanged","onChangeCurrentPreview","onRemoveExtraPreview","onPreviewsOrderChanged","onFrameUpdated"])):h("",!0)])):h("",!0)])]),n("div",rt,[c(N,{text:e.$t("main.info")},null,8,["text"]),n("div",nt,[r.task?(o(),u("table",at,[n("tbody",ot,[n("tr",dt,[n("td",lt,m(e.$t("tasks.fields.estimation")),1),n("td",null,m(e.formatDuration(r.task.estimation)),1)]),n("tr",mt,[n("td",ct,m(e.$t("tasks.fields.duration")),1),n("td",null,m(e.formatDuration(r.task.duration)),1)]),n("tr",ht,[n("td",ut,m(e.$t("tasks.fields.retake_count")),1),n("td",null,m(r.task.retake_count),1)]),n("tr",kt,[n("td",pt,m(e.$t("tasks.fields.start_date")),1),n("td",null,m(e.formatSimpleDate(r.task.start_date)),1)]),n("tr",vt,[n("td",wt,m(e.$t("tasks.fields.due_date")),1),n("td",null,m(e.formatSimpleDate(r.task.due_date)),1)]),n("tr",ft,[n("td",_t,m(e.$t("tasks.fields.end_date")),1),n("td",null,m(e.formatSimpleDate(r.task.end_date)),1)]),n("tr",Ct,[n("td",Pt,m(e.$t("tasks.fields.done_date")),1),n("td",null,m(e.formatSimpleDate(r.task.done_date)),1)])])])):h("",!0)])]),t[3]||(t[3]=n("div",{class:"pa2"},null,-1))]),n("div",yt,[r.task?(o(),u("div",gt,[n("div",null,[s.isCommentingAllowed?(o(),v(B,{key:0,ref:"add-comment",frame:r.currentFrame,"is-error":r.errors.addComment,"is-max-retakes-error":r.errors.addCommentMaxRetakes,"is-loading":r.loading.addComment,"is-movie":s.isMovie,team:s.currentTeam,task:r.task,"task-status":e.taskStatusForCurrentUser,"preview-forms":r.previewForms,fps:e.currentFps,revision:s.currentRevision,onAddComment:s.addComment,onAddPreview:s.onAddPreviewClicked,onFileDrop:s.selectFile,onClearFiles:s.clearPreviewFiles,onAnnotationSnapshotsRequested:s.extractAnnotationSnapshots,onRemovePreview:s.onPreviewFormRemoved},null,8,["frame","is-error","is-max-retakes-error","is-loading","is-movie","team","task","task-status","preview-forms","fps","revision","onAddComment","onAddPreview","onFileDrop","onClearFiles","onAnnotationSnapshotsRequested","onRemovePreview"])):h("",!0),r.taskComments&&r.taskComments.length>0?(o(),u("div",Tt,[ye((o(),v(q,{appear:""},{default:_(()=>[(o(!0),u(E,null,x(r.taskComments,(p,G)=>(o(),v(z,{key:p.id,comment:p,fps:e.currentFps,frame:r.currentFrame,"is-change":s.isStatusChange(G),"is-checkable":e.user.id===p.person?.id||e.isCurrentUserArtist&&s.isAssigned||s.isDepartmentSupervisor||e.isCurrentUserManager,"is-editable":e.user.id===p.person?.id||e.isCurrentUserManager,"is-pinnable":s.isDepartmentSupervisor||e.isCurrentUserManager,"is-replyable":e.user.id===p.person?.id||s.isAssigned||s.isDepartmentSupervisor||e.isCurrentUserManager,revision:s.currentRevision,task:r.task,team:s.currentTeam,onAckComment:s.onAckComment,onDuplicateComment:s.onDuplicateComment,onPinComment:s.onPinComment,onEditComment:s.onEditComment,onDeleteComment:s.onDeleteComment,onChecklistUpdated:s.saveComment,onTimeCodeClicked:s.timeCodeClicked},null,8,["comment","fps","frame","is-change","is-checkable","is-editable","is-pinnable","is-replyable","revision","task","team","onAckComment","onDuplicateComment","onPinComment","onEditComment","onDeleteComment","onChecklistUpdated","onTimeCodeClicked"]))),128))]),_:1})),[[K,{fade:!1,up:!1,"flip-up":!1}]])])):(o(),u("div",Et,[n("em",null,m(e.$t("tasks.no_comment")),1)]))])])):h("",!0),r.taskLoading.isLoading?(o(),u("div",xt,[c(H)])):h("",!0)])],512),c(g,{ref:"add-preview-modal",active:r.modals.addPreview,"is-loading":r.loading.addPreview,"is-error":r.errors.addPreview,"form-data":r.addPreviewFormData,fps:e.currentFps,"expected-frames":e.entityFrames,title:r.task?`${r.task.entity_name} / ${e.taskTypeMap.get(r.task.task_type_id).name}`:"",onCancel:s.closeAddPreviewModal,onConfirm:s.confirmAddPreviewModal},null,8,["active","is-loading","is-error","form-data","fps","expected-frames","title","onCancel","onConfirm"]),c(g,{ref:"add-extra-preview-modal",active:r.modals.addExtraPreview,"is-loading":r.loading.addExtraPreview,"is-error":r.errors.addExtraPreview,"form-data":r.addExtraPreviewFormData,message:"",title:r.task?`${r.task.entity_name} / ${e.taskTypeMap.get(r.task.task_type_id).name}`:"",onCancel:s.hideExtraPreviewModal,onConfirm:s.createExtraPreview},null,8,["active","is-loading","is-error","form-data","title","onCancel","onConfirm"]),c(j,{active:r.modals.editComment,frame:r.currentFrame,"is-loading":r.loading.editComment,"is-error":r.errors.editComment,"comment-to-edit":r.commentToEdit,team:s.currentTeam,fps:e.currentFps,revision:s.currentRevision,onConfirm:e.confirmEditTaskComment,onCancel:s.onCancelEditComment},null,8,["active","frame","is-loading","is-error","comment-to-edit","team","fps","revision","onConfirm","onCancel"]),c(T,{active:r.modals.deleteComment,"is-loading":r.loading.deleteComment,"is-error":r.errors.deleteComment,text:e.$t("tasks.delete_comment"),"error-text":e.$t("tasks.delete_comment_error"),onConfirm:s.confirmDeleteTaskComment,onCancel:s.onCancelDeleteComment},null,8,["active","is-loading","is-error","text","error-text","onConfirm","onCancel"]),c(T,{active:r.modals.deleteExtraPreview,"is-loading":r.loading.deleteExtraPreview,"is-error":r.errors.deleteExtraPreview,text:e.$t("tasks.delete_preview"),"error-text":e.$t("tasks.delete_preview_error"),onCancel:s.hideRemoveExtraPreviewModal,onConfirm:s.confirmDeleteTaskPreview},null,8,["active","is-loading","is-error","text","error-text","onCancel","onConfirm"])])])}const At=I(Ue,[["render",bt],["__scopeId","data-v-e5396783"]]);export{At as default};
//# sourceMappingURL=Task-RyfKpZUy.js.map
