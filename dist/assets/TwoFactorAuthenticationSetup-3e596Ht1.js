import{be as X,bI as M,a0 as Z,bi as ae,bJ as ce,F as oe,Q as A,_ as ve,aj as he,$ as ge,bf as Te,bp as Pe,q as we,o as p,c as C,f as q,V as H,h as S,d as _,t as m,g as J,k as j,a4 as ee,O as te,bK as me,bd as be,bL as pe,n as R,bF as Oe,e as Ee,H as Ce}from"./index-DF-DoQlt.js";import{T as _e}from"./TextField-BKWlN2Ov.js";import{C as re}from"./circle-x-BpLnzO06.js";import{C as ye}from"./copy-DgQ7ppWI.js";import{T as Re}from"./trash-DWKk5Pv9.js";var B=function(){return B=Object.assign||function(v){for(var f,l=1,e=arguments.length;l<e;l++){f=arguments[l];for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(v[c]=f[c])}return v},B.apply(this,arguments)};var G;(function(i){var v=(function(){function o(t,r,a,n){if(this.version=t,this.errorCorrectionLevel=r,this.modules=[],this.isFunction=[],t<o.MIN_VERSION||t>o.MAX_VERSION)throw new RangeError("Version value out of range");if(n<-1||n>7)throw new RangeError("Mask value out of range");this.size=t*4+17;for(var u=[],d=0;d<this.size;d++)u.push(!1);for(var d=0;d<this.size;d++)this.modules.push(u.slice()),this.isFunction.push(u.slice());this.drawFunctionPatterns();var T=this.addEccAndInterleave(a);if(this.drawCodewords(T),n==-1)for(var P=1e9,d=0;d<8;d++){this.applyMask(d),this.drawFormatBits(d);var b=this.getPenaltyScore();b<P&&(n=d,P=b),this.applyMask(d)}e(0<=n&&n<=7),this.mask=n,this.applyMask(n),this.drawFormatBits(n),this.isFunction=[]}return o.encodeText=function(t,r){var a=i.QrSegment.makeSegments(t);return o.encodeSegments(a,r)},o.encodeBinary=function(t,r){var a=i.QrSegment.makeBytes(t);return o.encodeSegments([a],r)},o.encodeSegments=function(t,r,a,n,u,d){if(a===void 0&&(a=1),n===void 0&&(n=40),u===void 0&&(u=-1),d===void 0&&(d=!0),!(o.MIN_VERSION<=a&&a<=n&&n<=o.MAX_VERSION)||u<-1||u>7)throw new RangeError("Invalid value");var T,P;for(T=a;;T++){var b=o.getNumDataCodewords(T,r)*8,y=c.getTotalBits(t,T);if(y<=b){P=y;break}if(T>=n)throw new RangeError("Data too long")}for(var w=0,N=[o.Ecc.MEDIUM,o.Ecc.QUARTILE,o.Ecc.HIGH];w<N.length;w++){var O=N[w];d&&P<=o.getNumDataCodewords(T,O)*8&&(r=O)}for(var g=[],I=0,F=t;I<F.length;I++){var L=F[I];f(L.mode.modeBits,4,g),f(L.numChars,L.mode.numCharCountBits(T),g);for(var z=0,D=L.getData();z<D.length;z++){var V=D[z];g.push(V)}}e(g.length==P);var W=o.getNumDataCodewords(T,r)*8;e(g.length<=W),f(0,Math.min(4,W-g.length),g),f(0,(8-g.length%8)%8,g),e(g.length%8==0);for(var U=236;g.length<W;U^=253)f(U,8,g);for(var Q=[];Q.length*8<g.length;)Q.push(0);return g.forEach(function(k,$){return Q[$>>>3]|=k<<7-($&7)}),new o(T,r,Q,u)},o.prototype.getModule=function(t,r){return 0<=t&&t<this.size&&0<=r&&r<this.size&&this.modules[r][t]},o.prototype.getModules=function(){return this.modules},o.prototype.drawFunctionPatterns=function(){for(var t=0;t<this.size;t++)this.setFunctionModule(6,t,t%2==0),this.setFunctionModule(t,6,t%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);for(var r=this.getAlignmentPatternPositions(),a=r.length,t=0;t<a;t++)for(var n=0;n<a;n++)t==0&&n==0||t==0&&n==a-1||t==a-1&&n==0||this.drawAlignmentPattern(r[t],r[n]);this.drawFormatBits(0),this.drawVersion()},o.prototype.drawFormatBits=function(t){for(var r=this.errorCorrectionLevel.formatBits<<3|t,a=r,n=0;n<10;n++)a=a<<1^(a>>>9)*1335;var u=(r<<10|a)^21522;e(u>>>15==0);for(var n=0;n<=5;n++)this.setFunctionModule(8,n,l(u,n));this.setFunctionModule(8,7,l(u,6)),this.setFunctionModule(8,8,l(u,7)),this.setFunctionModule(7,8,l(u,8));for(var n=9;n<15;n++)this.setFunctionModule(14-n,8,l(u,n));for(var n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,l(u,n));for(var n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,l(u,n));this.setFunctionModule(8,this.size-8,!0)},o.prototype.drawVersion=function(){if(!(this.version<7)){for(var t=this.version,r=0;r<12;r++)t=t<<1^(t>>>11)*7973;var a=this.version<<12|t;e(a>>>18==0);for(var r=0;r<18;r++){var n=l(a,r),u=this.size-11+r%3,d=Math.floor(r/3);this.setFunctionModule(u,d,n),this.setFunctionModule(d,u,n)}}},o.prototype.drawFinderPattern=function(t,r){for(var a=-4;a<=4;a++)for(var n=-4;n<=4;n++){var u=Math.max(Math.abs(n),Math.abs(a)),d=t+n,T=r+a;0<=d&&d<this.size&&0<=T&&T<this.size&&this.setFunctionModule(d,T,u!=2&&u!=4)}},o.prototype.drawAlignmentPattern=function(t,r){for(var a=-2;a<=2;a++)for(var n=-2;n<=2;n++)this.setFunctionModule(t+n,r+a,Math.max(Math.abs(n),Math.abs(a))!=1)},o.prototype.setFunctionModule=function(t,r,a){this.modules[r][t]=a,this.isFunction[r][t]=!0},o.prototype.addEccAndInterleave=function(t){var r=this.version,a=this.errorCorrectionLevel;if(t.length!=o.getNumDataCodewords(r,a))throw new RangeError("Invalid argument");for(var n=o.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][r],u=o.ECC_CODEWORDS_PER_BLOCK[a.ordinal][r],d=Math.floor(o.getNumRawDataModules(r)/8),T=n-d%n,P=Math.floor(d/n),b=[],y=o.reedSolomonComputeDivisor(u),w=0,N=0;w<n;w++){var O=t.slice(N,N+P-u+(w<T?0:1));N+=O.length;var g=o.reedSolomonComputeRemainder(O,y);w<T&&O.push(0),b.push(O.concat(g))}for(var I=[],F=function(L){b.forEach(function(z,D){(L!=P-u||D>=T)&&I.push(z[L])})},w=0;w<b[0].length;w++)F(w);return e(I.length==d),I},o.prototype.drawCodewords=function(t){if(t.length!=Math.floor(o.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");for(var r=0,a=this.size-1;a>=1;a-=2){a==6&&(a=5);for(var n=0;n<this.size;n++)for(var u=0;u<2;u++){var d=a-u,T=(a+1&2)==0,P=T?this.size-1-n:n;!this.isFunction[P][d]&&r<t.length*8&&(this.modules[P][d]=l(t[r>>>3],7-(r&7)),r++)}}e(r==t.length*8)},o.prototype.applyMask=function(t){if(t<0||t>7)throw new RangeError("Mask value out of range");for(var r=0;r<this.size;r++)for(var a=0;a<this.size;a++){var n=void 0;switch(t){case 0:n=(a+r)%2==0;break;case 1:n=r%2==0;break;case 2:n=a%3==0;break;case 3:n=(a+r)%3==0;break;case 4:n=(Math.floor(a/3)+Math.floor(r/2))%2==0;break;case 5:n=a*r%2+a*r%3==0;break;case 6:n=(a*r%2+a*r%3)%2==0;break;case 7:n=((a+r)%2+a*r%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[r][a]&&n&&(this.modules[r][a]=!this.modules[r][a])}},o.prototype.getPenaltyScore=function(){for(var t=0,r=0;r<this.size;r++){for(var a=!1,n=0,u=[0,0,0,0,0,0,0],d=0;d<this.size;d++)this.modules[r][d]==a?(n++,n==5?t+=o.PENALTY_N1:n>5&&t++):(this.finderPenaltyAddHistory(n,u),a||(t+=this.finderPenaltyCountPatterns(u)*o.PENALTY_N3),a=this.modules[r][d],n=1);t+=this.finderPenaltyTerminateAndCount(a,n,u)*o.PENALTY_N3}for(var d=0;d<this.size;d++){for(var a=!1,T=0,u=[0,0,0,0,0,0,0],r=0;r<this.size;r++)this.modules[r][d]==a?(T++,T==5?t+=o.PENALTY_N1:T>5&&t++):(this.finderPenaltyAddHistory(T,u),a||(t+=this.finderPenaltyCountPatterns(u)*o.PENALTY_N3),a=this.modules[r][d],T=1);t+=this.finderPenaltyTerminateAndCount(a,T,u)*o.PENALTY_N3}for(var r=0;r<this.size-1;r++)for(var d=0;d<this.size-1;d++){var P=this.modules[r][d];P==this.modules[r][d+1]&&P==this.modules[r+1][d]&&P==this.modules[r+1][d+1]&&(t+=o.PENALTY_N2)}for(var b=0,y=0,w=this.modules;y<w.length;y++){var N=w[y];b=N.reduce(function(I,F){return I+(F?1:0)},b)}var O=this.size*this.size,g=Math.ceil(Math.abs(b*20-O*10)/O)-1;return e(0<=g&&g<=9),t+=g*o.PENALTY_N4,e(0<=t&&t<=2568888),t},o.prototype.getAlignmentPatternPositions=function(){if(this.version==1)return[];for(var t=Math.floor(this.version/7)+2,r=Math.floor((this.version*8+t*3+5)/(t*4-4))*2,a=[6],n=this.size-7;a.length<t;n-=r)a.splice(1,0,n);return a},o.getNumRawDataModules=function(t){if(t<o.MIN_VERSION||t>o.MAX_VERSION)throw new RangeError("Version number out of range");var r=(16*t+128)*t+64;if(t>=2){var a=Math.floor(t/7)+2;r-=(25*a-10)*a-55,t>=7&&(r-=36)}return e(208<=r&&r<=29648),r},o.getNumDataCodewords=function(t,r){return Math.floor(o.getNumRawDataModules(t)/8)-o.ECC_CODEWORDS_PER_BLOCK[r.ordinal][t]*o.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][t]},o.reedSolomonComputeDivisor=function(t){if(t<1||t>255)throw new RangeError("Degree out of range");for(var r=[],a=0;a<t-1;a++)r.push(0);r.push(1);for(var n=1,a=0;a<t;a++){for(var u=0;u<r.length;u++)r[u]=o.reedSolomonMultiply(r[u],n),u+1<r.length&&(r[u]^=r[u+1]);n=o.reedSolomonMultiply(n,2)}return r},o.reedSolomonComputeRemainder=function(t,r){for(var a=r.map(function(P){return 0}),n=function(P){var b=P^a.shift();a.push(0),r.forEach(function(y,w){return a[w]^=o.reedSolomonMultiply(y,b)})},u=0,d=t;u<d.length;u++){var T=d[u];n(T)}return a},o.reedSolomonMultiply=function(t,r){if(t>>>8||r>>>8)throw new RangeError("Byte out of range");for(var a=0,n=7;n>=0;n--)a=a<<1^(a>>>7)*285,a^=(r>>>n&1)*t;return e(a>>>8==0),a},o.prototype.finderPenaltyCountPatterns=function(t){var r=t[1];e(r<=this.size*3);var a=r>0&&t[2]==r&&t[3]==r*3&&t[4]==r&&t[5]==r;return(a&&t[0]>=r*4&&t[6]>=r?1:0)+(a&&t[6]>=r*4&&t[0]>=r?1:0)},o.prototype.finderPenaltyTerminateAndCount=function(t,r,a){return t&&(this.finderPenaltyAddHistory(r,a),r=0),r+=this.size,this.finderPenaltyAddHistory(r,a),this.finderPenaltyCountPatterns(a)},o.prototype.finderPenaltyAddHistory=function(t,r){r[0]==0&&(t+=this.size),r.pop(),r.unshift(t)},o.MIN_VERSION=1,o.MAX_VERSION=40,o.PENALTY_N1=3,o.PENALTY_N2=3,o.PENALTY_N3=40,o.PENALTY_N4=10,o.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],o.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],o})();i.QrCode=v;function f(o,t,r){if(t<0||t>31||o>>>t)throw new RangeError("Value out of range");for(var a=t-1;a>=0;a--)r.push(o>>>a&1)}function l(o,t){return(o>>>t&1)!=0}function e(o){if(!o)throw new Error("Assertion error")}var c=(function(){function o(t,r,a){if(this.mode=t,this.numChars=r,this.bitData=a,r<0)throw new RangeError("Invalid argument");this.bitData=a.slice()}return o.makeBytes=function(t){for(var r=[],a=0,n=t;a<n.length;a++){var u=n[a];f(u,8,r)}return new o(o.Mode.BYTE,t.length,r)},o.makeNumeric=function(t){if(!o.isNumeric(t))throw new RangeError("String contains non-numeric characters");for(var r=[],a=0;a<t.length;){var n=Math.min(t.length-a,3);f(parseInt(t.substring(a,a+n),10),n*3+1,r),a+=n}return new o(o.Mode.NUMERIC,t.length,r)},o.makeAlphanumeric=function(t){if(!o.isAlphanumeric(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");var r=[],a;for(a=0;a+2<=t.length;a+=2){var n=o.ALPHANUMERIC_CHARSET.indexOf(t.charAt(a))*45;n+=o.ALPHANUMERIC_CHARSET.indexOf(t.charAt(a+1)),f(n,11,r)}return a<t.length&&f(o.ALPHANUMERIC_CHARSET.indexOf(t.charAt(a)),6,r),new o(o.Mode.ALPHANUMERIC,t.length,r)},o.makeSegments=function(t){return t==""?[]:o.isNumeric(t)?[o.makeNumeric(t)]:o.isAlphanumeric(t)?[o.makeAlphanumeric(t)]:[o.makeBytes(o.toUtf8ByteArray(t))]},o.makeEci=function(t){var r=[];if(t<0)throw new RangeError("ECI assignment value out of range");if(t<128)f(t,8,r);else if(t<16384)f(2,2,r),f(t,14,r);else if(t<1e6)f(6,3,r),f(t,21,r);else throw new RangeError("ECI assignment value out of range");return new o(o.Mode.ECI,0,r)},o.isNumeric=function(t){return o.NUMERIC_REGEX.test(t)},o.isAlphanumeric=function(t){return o.ALPHANUMERIC_REGEX.test(t)},o.prototype.getData=function(){return this.bitData.slice()},o.getTotalBits=function(t,r){for(var a=0,n=0,u=t;n<u.length;n++){var d=u[n],T=d.mode.numCharCountBits(r);if(d.numChars>=1<<T)return 1/0;a+=4+T+d.bitData.length}return a},o.toUtf8ByteArray=function(t){t=encodeURI(t);for(var r=[],a=0;a<t.length;a++)t.charAt(a)!="%"?r.push(t.charCodeAt(a)):(r.push(parseInt(t.substring(a+1,a+3),16)),a+=2);return r},o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",o})();i.QrSegment=c})(G||(G={}));(function(i){(function(v){var f=(function(){function l(e,c){this.ordinal=e,this.formatBits=c}return l.LOW=new l(0,1),l.MEDIUM=new l(1,0),l.QUARTILE=new l(2,3),l.HIGH=new l(3,2),l})();v.Ecc=f})(i.QrCode||(i.QrCode={}))})(G||(G={}));(function(i){(function(v){var f=(function(){function l(e,c){this.modeBits=e,this.numBitsCharCount=c}return l.prototype.numCharCountBits=function(e){return this.numBitsCharCount[Math.floor((e+7)/17)]},l.NUMERIC=new l(1,[10,12,14]),l.ALPHANUMERIC=new l(2,[9,11,13]),l.BYTE=new l(4,[8,16,16]),l.KANJI=new l(8,[8,10,12]),l.ECI=new l(7,[0,0,0]),l})();v.Mode=f})(i.QrSegment||(i.QrSegment={}))})(G||(G={}));var Y=G,ne="L",Ae=100,ie=0,Ne=.1,Fe=2,se={L:Y.QrCode.Ecc.LOW,M:Y.QrCode.Ecc.MEDIUM,Q:Y.QrCode.Ecc.QUARTILE,H:Y.QrCode.Ecc.HIGH},Me=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})();function le(i){return i in se}function ue(i,v){v===void 0&&(v=0);var f="";return i.forEach(function(l,e){var c=null;l.forEach(function(o,t){if(!o&&c!==null){f+="M".concat(c+v," ").concat(e+v,"h").concat(t-c,"v1H").concat(c+v,"z"),c=null;return}if(t===l.length-1){if(!o)return;c===null?f+="M".concat(t+v,",").concat(e+v," h1v1H").concat(t+v,"z"):f+="M".concat(c+v,",").concat(e+v," h").concat(t+1-c,"v1H").concat(c+v,"z");return}o&&c===null&&(c=t)})}),f}function Ie(i,v,f,l){var e=l.width,c=l.height,o=l.x,t=l.y,r=i.length+f*2,a=Math.floor(v*Ne),n=r/v,u=(e||a)*n,d=(c||a)*n,T=o==null?i.length/2-u/2:o*n,P=t==null?i.length/2-d/2:t*n,b=(l.borderRadius||0)*n,y=null;if(l.excavate){var w=Math.floor(T),N=Math.floor(P),O=Math.ceil(u+T-w),g=Math.ceil(d+P-N);y={x:w,y:N,w:O,h:g}}return{x:T,y:P,h:d,w:u,borderRadius:b,excavation:y}}function de(i){var v=A(function(){var t;return((t=i.margin)!==null&&t!==void 0?t:ie)>>>0}),f=A(function(){var t=le(i.level)?i.level:ne;return Y.QrCode.encodeText(i.value,se[t]).getModules()}),l=A(function(){return f.value.length+v.value*2}),e=A(function(){return ue(f.value,v.value)}),c=A(function(){if(!i.imageSettings.src)return{x:0,y:0,width:0,height:0,borderRadius:0};var t=Ie(f.value,i.size,v.value,i.imageSettings);return{x:t.x+v.value,y:t.y+v.value,width:t.w,height:t.h,borderRadius:t.borderRadius}}),o=A(function(){if(!i.imageSettings.excavate||!i.imageSettings.src)return null;var t=Fe/(i.size/l.value);return{x:c.value.x-t,y:c.value.y-t,width:c.value.width+t*2,height:c.value.height+t*2,borderRadius:c.value.borderRadius}});return{margin:v,numCells:l,cells:f,fgPath:e,imageProps:c,imageBorderProps:o}}var x={value:{type:String,required:!0,default:""},size:{type:Number,default:Ae},level:{type:String,default:ne,validator:function(i){return le(i)}},background:{type:String,default:"#fff"},foreground:{type:String,default:"#000"},margin:{type:Number,required:!1,default:ie},imageSettings:{type:Object,required:!1,default:function(){return{}}},gradient:{type:Boolean,required:!1,default:!1},gradientType:{type:String,required:!1,default:"linear",validator:function(i){return["linear","radial"].indexOf(i)>-1}},gradientStartColor:{type:String,required:!1,default:"#000"},gradientEndColor:{type:String,required:!1,default:"#fff"}},Se=B(B({},x),{renderAs:{type:String,required:!1,default:"canvas",validator:function(i){return["canvas","svg"].indexOf(i)>-1}}}),De=X({name:"QRCodeSvg",props:x,setup:function(i){var v=de(i),f=v.numCells,l=v.fgPath,e=v.imageProps,c=v.imageBorderProps,o="qrcode.vue-gradient",t=function(){if(!i.gradient)return null;var n=i.gradientType==="linear"?{x1:"0%",y1:"0%",x2:"100%",y2:"100%"}:{cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"};return M(i.gradientType==="linear"?"linearGradient":"radialGradient",B({id:o},n),[M("stop",{offset:"0%",style:{stopColor:i.gradientStartColor}}),M("stop",{offset:"100%",style:{stopColor:i.gradientEndColor}})])},r="qrcode.vue-logo-clip-path",a=function(){var n=e.value.borderRadius;return!i.imageSettings.src||n<=0?null:M("clipPath",{id:r},[M("rect",{x:e.value.x,y:e.value.y,width:e.value.width,height:e.value.height,rx:n,ry:n})])};return function(){return M("svg",{width:i.size,height:i.size,"shape-rendering":"crispEdges",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(f.value," ").concat(f.value)},[M("defs",{},[t(),a()]),M("rect",{width:"100%",height:"100%",fill:i.background}),M("path",{fill:i.gradient?"url(#".concat(o,")"):i.foreground,d:l.value}),c.value&&M("rect",{x:c.value.x,y:c.value.y,width:c.value.width,height:c.value.height,fill:i.background,rx:c.value.borderRadius,ry:c.value.borderRadius}),i.imageSettings.src&&M("image",B(B({href:i.imageSettings.src},e.value),e.value.borderRadius>0?{"clip-path":"url(#".concat(r,")")}:{}))])}}}),Le=X({name:"QRCodeCanvas",props:x,setup:function(i,v){var f=de(i),l=f.margin,e=f.cells,c=f.numCells,o=f.imageProps,t=f.imageBorderProps,r=Z(null),a=Z(null),n=function(){var d=i.size,T=i.background,P=i.foreground,b=i.gradient,y=i.gradientType,w=i.gradientStartColor,N=i.gradientEndColor,O=r.value;if(O){var g=O.getContext("2d");if(g){var I=e.value,F=a.value,L=typeof window<"u"&&window.devicePixelRatio||1,z=d/c.value*L;if(O.height=O.width=d*L,g.scale(z,z),g.fillStyle=T,g.fillRect(0,0,c.value,c.value),b){var D=void 0;y==="linear"?D=g.createLinearGradient(0,0,c.value,c.value):D=g.createRadialGradient(c.value/2,c.value/2,0,c.value/2,c.value/2,c.value/2),D.addColorStop(0,w),D.addColorStop(1,N),g.fillStyle=D}else g.fillStyle=P;Me?g.fill(new Path2D(ue(I,l.value))):I.forEach(function(k,$){k.forEach(function(s,h){s&&g.fillRect(h+l.value,$+l.value,1,1)})});var V=i.imageSettings.src&&F&&F.naturalWidth!==0&&F.naturalHeight!==0;if(V){var W=function(k,$,s,h,K,E){k.beginPath(),k.roundRect?k.roundRect($,s,h,K,E):k.rect($,s,h,K)};if(t.value){var U=t.value;g.fillStyle=i.background,W(g,U.x,U.y,U.width,U.height,U.borderRadius),g.fill()}var Q=o.value.borderRadius;Q>0?(g.save(),W(g,o.value.x,o.value.y,o.value.width,o.value.height,Q),g.clip(),g.drawImage(F,o.value.x,o.value.y,o.value.width,o.value.height),g.restore()):g.drawImage(F,o.value.x,o.value.y,o.value.width,o.value.height)}}}};ae(n),ce(n);var u=v.attrs.style;return function(){return M(oe,[M("canvas",B(B({},v.attrs),{ref:r,style:B(B({},u),{width:"".concat(i.size,"px"),height:"".concat(i.size,"px")})})),i.imageSettings.src&&M("img",{ref:a,src:i.imageSettings.src,style:{display:"none"},onLoad:n})])}}}),ke=X({name:"Qrcode",render:function(){var i=this.$props,v=i.renderAs,f=i.value,l=i.size,e=i.margin,c=i.level,o=i.background,t=i.foreground,r=i.imageSettings,a=i.gradient,n=i.gradientType,u=i.gradientStartColor,d=i.gradientEndColor;return M(v==="svg"?De:Le,{value:f,size:l,margin:e,level:c,background:o,foreground:t,imageSettings:r,gradient:a,gradientType:n,gradientStartColor:u,gradientEndColor:d})},props:Se});const ze={class:"two-factor-authentication-setup"},Be={key:0,class:"cancel-two-factor-action"},Ue={key:1,class:"qrcode-informations"},$e={key:2,class:"field"},Qe={class:"control has-icon"},We=["placeholder"],qe={class:"icon"},He={key:3},Ge={class:"label label-recovery-codes"},Ve=["textContent"],Ke={class:"show-message error recovery-codes-warning"},Ye={key:6,class:"field"},Xe={class:"control has-icon"},xe=["placeholder"],Ze={class:"icon"},Je={key:14,class:"label"},je={key:15,class:"pa1"},et={__name:"TwoFactorAuthenticationSetup",props:{showCancelButton:{type:Boolean,default:!1}},setup(i){const{t:v}=he(),f=ge(),l=A(()=>f.getters.user),e=Te({TOTPProvisionningUri:"",OTPSecret:"",OTPRecoveryCodes:null,isLoading:!1,TOTPPreEnabled:!1,TOTPNeedTwoFA:!1,emailOTPPreEnabled:!1,emailOTPNeedTwoFA:!1,FIDONewDeviceName:"",FIDOPreRegistered:!1,newRecoveryCodesNeedTwoFA:!1,validationOTP:"",error:{isWrongOTP:!1,enableTOTP:!1,disableTOTP:!1,enableEmailOTP:!1,disableEmailOTP:!1,registerFIDO:!1,unregisterFIDO:!1,newRecoveryCodes:!1}}),c=A(()=>{const s=[];return l.value.fido_enabled&&s.push("fido"),l.value.totp_enabled&&s.push("totp"),l.value.email_otp_enabled&&s.push("email_otp"),s.length&&s.push("recovery_code"),s}),o=A(()=>l.value.totp_enabled||l.value.email_otp_enabled||l.value.fido_enabled),t=A(()=>e.TOTPNeedTwoFA||e.emailOTPNeedTwoFA||e.newRecoveryCodesNeedTwoFA),r=A(()=>e.TOTPPreEnabled||e.TOTPNeedTwoFA||e.emailOTPPreEnabled||e.emailOTPNeedTwoFA||e.FIDOPreRegistered||e.newRecoveryCodesNeedTwoFA),a=A(()=>e.TOTPPreEnabled?v("profile.two_factor_authentication.totp.button_validate"):e.emailOTPPreEnabled?v("profile.two_factor_authentication.email_otp.button_validate"):""),n=A(()=>e.TOTPNeedTwoFA?v("profile.two_factor_authentication.totp.button_validate_disable"):e.emailOTPNeedTwoFA?v("profile.two_factor_authentication.email_otp.button_validate_disable"):e.newRecoveryCodesNeedTwoFA?v("profile.two_factor_authentication.recovery_codes.button_validate"):""),u=A(()=>e.TOTPNeedTwoFA||e.emailOTPNeedTwoFA),d=A(()=>e.TOTPPreEnabled?v("login.fields.totp"):e.emailOTPPreEnabled?v("login.fields.email_otp"):""),T=A(()=>e.TOTPPreEnabled?v("login.wrong_totp"):e.emailOTPPreEnabled?v("login.wrong_email_otp"):"");function P(){e.error.isWrongOTP=!1,e.error.enableTOTP=!1,e.error.disableTOTP=!1,e.error.enableEmailOTP=!1,e.error.disableEmailOTP=!1,e.error.newRecoveryCodes=!1,e.error.unregisterFIDO=!1,e.error.registerFIDO=!1,e.OTPRecoveryCodes=null}function b(){P(),e.isLoading=!0,f.dispatch("enableTOTP",e.validationOTP).then(s=>{s&&(e.OTPRecoveryCodes=s),e.TOTPPreEnabled=!1,e.validationOTP="",e.error.isWrongOTP=!1,e.OTPSecret=""}).catch(s=>{s.body&&s.body.wrong_OTP?e.error.isWrongOTP=!0:e.error.enableTOTP=!0}).finally(()=>{e.isLoading=!1})}function y(){P(),e.isLoading=!0,e.TOTPPreEnabled=!1,f.dispatch("preEnableTOTP").then(s=>{e.TOTPProvisionningUri=s.totp_provisionning_uri,e.OTPSecret=s.otp_secret,e.TOTPPreEnabled=!0}).catch(()=>{e.error.enableTOTP=!0}).finally(()=>{e.isLoading=!1})}function w(s){P(),e.TOTPNeedTwoFA?(e.isLoading=!0,f.dispatch("disableTOTP",s).then(()=>{e.TOTPNeedTwoFA=!1,e.validationOTP="",e.error.isWrongOTP=!1}).catch(h=>{h.body&&h.body.wrong_OTP?e.error.isWrongOTP=!0:e.error.disableTOTP=!0}).finally(()=>{e.isLoading=!1})):e.TOTPNeedTwoFA=!0}function N(){P(),e.isLoading=!0,f.dispatch("enableEmailOTP",e.validationOTP).then(s=>{s&&(e.OTPRecoveryCodes=s),e.emailOTPPreEnabled=!1,e.validationOTP="",e.error.isWrongOTP=!1}).catch(s=>{s.body&&s.body.wrong_OTP?e.error.isWrongOTP=!0:e.error.enableEmailOTP=!0}).finally(()=>{e.isLoading=!1})}function O(){P(),e.isLoading=!0,e.emailOTPPreEnabled=!1,e.OTPRecoveryCodes=null,f.dispatch("preEnableEmailOTP").then(()=>{e.emailOTPPreEnabled=!0}).catch(()=>{e.error.enableEmailOTP=!0}).finally(()=>{e.isLoading=!1})}function g(s){P(),e.OTPRecoveryCodes=null,e.emailOTPNeedTwoFA?(e.isLoading=!0,f.dispatch("disableEmailOTP",s).then(()=>{e.emailOTPNeedTwoFA=!1,e.validationOTP="",e.error.isWrongOTP=!1}).catch(h=>{h.body&&h.body.wrong_OTP?e.error.isWrongOTP=!0:e.error.disableEmailOTP=!0}).finally(()=>{e.isLoading=!1})):e.emailOTPNeedTwoFA=!0}function I(){P(),e.FIDOPreRegistered=!0}function F(){e.FIDONewDeviceName&&(P(),e.isLoading=!0,f.dispatch("preRegisterFIDO").then(s=>navigator.credentials.create({publicKey:s})).then(s=>f.dispatch("registerFIDO",{registrationResponse:s,deviceName:e.FIDONewDeviceName})).then(s=>{s&&(e.OTPRecoveryCodes=s)}).catch(s=>{s instanceof DOMException&&console.error(s),e.error.registerFIDO=!0}).finally(()=>{e.FIDOPreRegistered=!1,e.isLoading=!1,e.FIDONewDeviceName=""}))}function L(s){P(),e.isLoading=!0,f.dispatch("unregisterFIDO",{deviceName:s}).then(()=>{e.validationOTP="",e.error.isWrongOTP=!1}).catch(h=>{h.body&&h.body.wrong_OTP?e.error.isWrongOTP=!0:e.error.unregisterFIDO=!0}).finally(()=>{e.isLoading=!1})}function z(s){P(),e.newRecoveryCodesNeedTwoFA?(e.isLoading=!0,f.dispatch("newRecoveryCodes",s).then(h=>{e.OTPRecoveryCodes=h,e.newRecoveryCodesNeedTwoFA=!1,e.validationOTP="",e.error.isWrongOTP=!1}).catch(h=>{h.body&&h.body.wrong_OTP?e.error.isWrongOTP=!0:e.error.newRecoveryCodes=!0}).finally(()=>{e.isLoading=!1})):e.newRecoveryCodesNeedTwoFA=!0}function D(){e.TOTPPreEnabled?b():e.emailOTPPreEnabled&&N()}function V(s){e.TOTPNeedTwoFA?w(s):e.emailOTPNeedTwoFA?g(s):e.newRecoveryCodesNeedTwoFA&&z(s)}function W(){navigator.clipboard.writeText(e.OTPRecoveryCodes.join(`
`))}function U(){const s=new Blob([e.OTPRecoveryCodes.join(`
`)],{type:"text/plain;charset=utf-8"}),h=document.createElement("a");h.setAttribute("href",URL.createObjectURL(s)),h.setAttribute("download","kitsu-recovery-codes.txt"),document.body.appendChild(h),h.click()}function Q(){e.error.isWrongOTP=!1}function k(){e.TOTPPreEnabled=!1,e.TOTPNeedTwoFA=!1,e.emailOTPPreEnabled=!1,e.emailOTPNeedTwoFA=!1,e.newRecoveryCodesNeedTwoFA=!1,e.FIDOPreRegistered=!1,e.FIDONewDeviceName="",e.isLoading=!1,e.validationOTP="",e.error.isWrongOTP=!1,e.error.enableTOTP=!1,e.error.disableTOTP=!1,e.error.enableEmailOTP=!1,e.error.disableEmailOTP=!1,e.error.newRecoveryCodes=!1,e.error.unregisterFIDO=!1,e.error.registerFIDO=!1,e.OTPRecoveryCodes=null}function $(s){s.key==="Escape"&&k()}return ae(()=>{window.addEventListener("keydown",$,!1)}),Pe(()=>{window.removeEventListener("keydown",$,!1)}),(s,h)=>{const K=we("focus");return p(),C("div",ze,[i.showCancelButton&&r.value?(p(),C("p",Be,[q(H(re),{class:"action-icon",size:20,onClick:k})])):S("",!0),e.TOTPPreEnabled?(p(),C("div",Ue,[_("p",null,m(s.$t("profile.two_factor_authentication.scan_qrcode")),1),q(ke,{class:"qrcode",value:e.TOTPProvisionningUri,size:300,level:"M"},null,8,["value"]),e.OTPSecret?(p(),J(_e,{key:0,label:s.$t("profile.two_factor_authentication.otp_secret"),readonly:!0,type:"text",modelValue:e.OTPSecret,"onUpdate:modelValue":h[0]||(h[0]=E=>e.OTPSecret=E),modelModifiers:{trim:!0}},null,8,["label","modelValue"])):S("",!0)])):S("",!0),e.TOTPPreEnabled||e.emailOTPPreEnabled?(p(),C("div",$e,[_("p",Qe,[j(_("input",{class:"input is-medium otp-input",type:"text","onUpdate:modelValue":h[1]||(h[1]=E=>e.validationOTP=E),onKeyup:te(D,["enter"]),placeholder:d.value},null,40,We),[[ee,e.validationOTP,void 0,{trim:!0}],[K]]),_("span",qe,[q(H(me),{size:20})])])])):S("",!0),e.OTPRecoveryCodes?(p(),C("div",He,[_("label",Ge,m(s.$t("profile.two_factor_authentication.recovery_codes.title")),1),q(H(re),{class:"action-icon",size:20,onClick:k}),q(H(be),{class:"action-icon",size:20,onClick:U}),q(H(ye),{class:"action-icon",size:20,onClick:W}),_("textarea",{class:"input recovery-codes",textContent:m(e.OTPRecoveryCodes.join("	")),readonly:""},null,8,Ve),_("p",Ke,m(s.$t("profile.two_factor_authentication.recovery_codes.warning")),1)])):t.value?(p(),J(pe,{key:4,"preferred-two-fa":l.value.preferred_two_factor_authentication,"two-fas-enabled":c.value,"is-loading":e.isLoading,email:l.value.email,"text-validate-button":n.value,"is-disable-button":u.value,"is-wrong-otp":e.error.isWrongOTP,"is-profile":!0,onValidate:V,onChangedTwoFa:Q},null,8,["preferred-two-fa","two-fas-enabled","is-loading","email","text-validate-button","is-disable-button","is-wrong-otp"])):S("",!0),e.TOTPPreEnabled||e.emailOTPPreEnabled?(p(),C("button",{key:5,class:R(["two-fa-button button save-button is-medium",{"is-loading":e.isLoading}]),onClick:h[2]||(h[2]=E=>D())},m(a.value),3)):S("",!0),_("p",{class:R(["show-message-2fa error",{"is-hidden":!(e.error.isWrongOTP&&(e.TOTPPreEnabled||e.emailOTPPreEnabled))}])},m(T.value),3),e.FIDOPreRegistered?(p(),C("div",Ye,[_("p",Xe,[j(_("input",{class:"input is-medium otp-input",type:"text","onUpdate:modelValue":h[3]||(h[3]=E=>e.FIDONewDeviceName=E),onKeyup:te(F,["enter"]),placeholder:s.$t("profile.two_factor_authentication.fido.device_name")},null,40,xe),[[ee,e.FIDONewDeviceName,void 0,{trim:!0}],[K]]),_("span",Ze,[q(H(Oe),{size:20})])])])):S("",!0),e.FIDOPreRegistered?(p(),C("button",{key:7,class:R(["two-fa-button button save-button is-medium",{"is-loading":e.isLoading}]),onClick:h[4]||(h[4]=E=>F())},m(s.$t("profile.two_factor_authentication.fido.button_register")),3)):S("",!0),_("p",{class:R(["show-message-2fa error",{"is-hidden":!e.error.registerFIDO}])},m(s.$t("profile.two_factor_authentication.fido.error_register")),3),!l.value.totp_enabled&&!e.TOTPPreEnabled?(p(),C("button",{key:8,class:R(["two-fa-button button save-button is-medium",{"is-disabled":r.value,"is-loading":e.isLoading}]),onClick:h[5]||(h[5]=E=>y())},m(s.$t("profile.two_factor_authentication.totp.button_enable")),3)):!e.TOTPNeedTwoFA&&!e.TOTPPreEnabled?(p(),C("button",{key:9,class:R(["two-fa-button button disable-button is-medium",{"is-disabled":r.value,"is-loading":e.isLoading}]),onClick:h[6]||(h[6]=E=>w())},m(s.$t("profile.two_factor_authentication.totp.button_disable")),3)):S("",!0),_("p",{class:R(["show-message-2fa error",{"is-hidden":!e.error.enableTOTP}])},m(s.$t("profile.two_factor_authentication.totp.error_enable")),3),_("p",{class:R(["show-message-2fa error",{"is-hidden":!e.error.disableTOTP}])},m(s.$t("profile.two_factor_authentication.totp.error_disable")),3),!l.value.email_otp_enabled&&!e.emailOTPPreEnabled?(p(),C("button",{key:10,class:R(["two-fa-button button save-button is-medium",{"is-disabled":r.value,"is-loading":e.isLoading}]),onClick:h[7]||(h[7]=E=>O())},m(s.$t("profile.two_factor_authentication.email_otp.button_enable")),3)):!e.emailOTPNeedTwoFA&&!e.emailOTPPreEnabled?(p(),C("button",{key:11,class:R(["two-fa-button button disable-button is-medium",{"is-disabled":r.value,"is-loading":e.isLoading}]),onClick:h[8]||(h[8]=E=>g())},m(s.$t("profile.two_factor_authentication.email_otp.button_disable")),3)):S("",!0),_("p",{class:R(["show-message-2fa error",{"is-hidden":!e.error.enableEmailOTP}])},m(s.$t("profile.two_factor_authentication.email_otp.error_enable")),3),_("p",{class:R(["show-message-2fa error",{"is-hidden":!e.error.disableEmailOTP}])},m(s.$t("profile.two_factor_authentication.email_otp.error_disable")),3),e.FIDOPreRegistered?S("",!0):(p(),C("button",{key:12,class:R(["two-fa-button button save-button is-medium",{"is-disabled":r.value,"is-loading":e.isLoading}]),onClick:h[9]||(h[9]=E=>I())},m(s.$t("profile.two_factor_authentication.fido.button_register")),3)),o.value&&!e.newRecoveryCodesNeedTwoFA?(p(),C("button",{key:13,class:R(["two-fa-button button save-button is-medium",{"is-disabled":r.value,"is-loading":e.isLoading}]),onClick:h[10]||(h[10]=E=>z())},m(s.$t("profile.two_factor_authentication.recovery_codes.button_new")),3)):S("",!0),_("p",{class:R(["show-message-2fa error",{"is-hidden":!e.error.newRecoveryCodes}])},m(s.$t("profile.two_factor_authentication.recovery_codes.error_new")),3),l.value.fido_enabled?(p(),C("label",Je,m(s.$t("profile.two_factor_authentication.fido.registered_devices_title")),1)):S("",!0),l.value.fido_devices?.length?(p(),C("ul",je,[(p(!0),C(oe,null,Ee(l.value.fido_devices,(E,fe)=>(p(),C("li",{key:`${E}-${fe}`},[Ce(m(E)+" ",1),q(H(Re),{class:"action-icon pull-right",size:15,onClick:tt=>L(E)},null,8,["onClick"])]))),128))])):S("",!0),_("p",{class:R(["show-message-2fa error",{"is-hidden":!e.error.unregisterFIDO}])},m(s.$t("profile.two_factor_authentication.fido.error_unregister")),3)])}}},st=ve(et,[["__scopeId","data-v-c00444a2"]]);export{st as T};
//# sourceMappingURL=TwoFactorAuthenticationSetup-3e596Ht1.js.map
