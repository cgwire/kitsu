import{g as c,aj as i,S as u,ak as d,m as h,al as o,b as m,am as p,an as f,ao as n,ap as r,aq as D,ar as _,n as v}from"./index-874e3fdf.js";const g={name:"production-schedule",components:{ComboboxNumber:c,Datepicker:i,Schedule:u},data(){return{endDate:d().add(6,"months"),scheduleItems:[],startDate:d(),selectedStartDate:null,selectedEndDate:null,zoomLevel:0,zoomOptions:[{label:"Week",value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted(){this.reset()},computed:{...h(["openProductions","taskTypeMap","user"]),locale(){return this.user.locale==="fr_FR"?o.fr:o.en}},methods:{...m(["editProduction","loadScheduleItems","saveScheduleItem"]),changeZoom(t){t.wheelDelta<0&&this.zoomLevel>1&&this.zoomLevel--,t.wheelDelta>0&&this.zoomLevel<3&&this.zoomLevel++},reset(){this.scheduleItems=this.convertScheduleItems(this.openProductions),this.startDate=p(this.scheduleItems),this.endDate=f(this.scheduleItems),this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate()},convertScheduleItems(t){return t.map(e=>{const a=n(e.start_date),s=r(a,e.end_date);return{...e,avatar:e.type==="Project",color:e.color||D.fromString(e.name,!0),startDate:a,endDate:s,expanded:!1,loading:!1,editable:!0,route:_(e.id),children:[]}})},convertTaskTypeScheduleItems(t){return t.map(e=>{const a=n(e.start_date),s=r(a,e.end_date),l=this.taskTypeMap.get(e.task_type_id);return{...e,name:l.name,color:l.color,startDate:a,endDate:s,expanded:!1,loading:!1,editable:!0,children:[]}})},expandProductionElement(t){t.expanded?t.expanded=!1:(t.loading=!0,t.expanded=!0,this.loadScheduleItems(t).then(e=>{e=this.convertTaskTypeScheduleItems(e),t.children=e,t.loading=!1}))},onScheduleItemChanged(t){t.type!=="Project"?this.saveScheduleItem(t):this.editProduction({id:t.id,start_date:t.startDate.format("YYYY-MM-DD"),end_date:t.endDate.format("YYYY-MM-DD")})}},socket:{},watch:{},metaInfo(){return{title:`${this.$t("schedule.title_main")} - Kitsu`}}};var b=function(){var e=this,a=e._self._c;return a("div",{staticClass:"columns fixed-page"},[a("div",{staticClass:"column main-column"},[a("div",{staticClass:"flexrow project-dates"},[a("div",{staticClass:"flexrow-item"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.start_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd",disabled:""},model:{value:e.selectedStartDate,callback:function(s){e.selectedStartDate=s},expression:"selectedStartDate"}})],1),a("div",{staticClass:"flexrow-item field"},[a("label",{staticClass:"label"},[e._v(" "+e._s(e.$t("main.end_date"))+" ")]),a("datepicker",{attrs:{"wrapper-class":"datepicker","input-class":"date-input input",language:e.locale,"disabled-dates":{days:[6,0]},"monday-first":!0,format:"yyyy-MM-dd",disabled:""},model:{value:e.selectedEndDate,callback:function(s){e.selectedEndDate=s},expression:"selectedEndDate"}})],1),a("combobox-number",{staticClass:"flexrow-item zoom-level",attrs:{label:e.$t("schedule.zoom_level"),options:e.zoomOptions},model:{value:e.zoomLevel,callback:function(s){e.zoomLevel=s},expression:"zoomLevel"}})],1),a("schedule",{attrs:{"end-date":e.endDate,hierarchy:e.scheduleItems,"is-loading":e.loading.schedule,"is-error":e.errors.schedule,"start-date":e.startDate,"zoom-level":e.zoomLevel,"hide-man-days":!0},on:{"item-changed":e.onScheduleItemChanged,"change-zoom":e.changeZoom,"root-element-expanded":e.expandProductionElement}})],1)])},S=[],y=v(g,b,S,!1,null,"bce81af1",null,null);const k=y.exports;export{k as default};
//# sourceMappingURL=MainSchedule-edfb9801.js.map
