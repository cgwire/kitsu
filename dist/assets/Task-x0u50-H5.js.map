{"version":3,"file":"Task-x0u50-H5.js","sources":["../../src/components/widgets/SubscribeButton.vue","../../src/components/pages/Task.vue"],"sourcesContent":["<template>\n  <button class=\"button\" :title=\"buttonTitle\" @click=\"$emit('click')\">\n    <eye-icon class=\"icon is-small\" v-if=\"subscribed\" />\n    <eye-off-icon class=\"icon is-small\" v-else />\n  </button>\n</template>\n\n<script>\nimport { EyeIcon, EyeOffIcon } from 'lucide-vue-next'\n\nexport default {\n  name: 'subscribe-button',\n\n  components: {\n    EyeIcon,\n    EyeOffIcon\n  },\n\n  props: {\n    subscribed: {\n      default: false,\n      type: Boolean\n    }\n  },\n\n  emits: ['click'],\n\n  computed: {\n    buttonTitle() {\n      if (!this.subscribed) {\n        return this.$t('tasks.subscribe_notifications')\n      } else {\n        return this.$t('tasks.unsubscribe_notifications')\n      }\n    }\n  }\n}\n</script>\n","<template>\n  <div class=\"fixed-page columns xyz-in\" xyz=\"fade\">\n    <div class=\"page column main-column\">\n      <div class=\"page-header pa1 mb0\" xyz=\"fade\">\n        <div class=\"flexrow header-title\" v-if=\"task\">\n          <router-link\n            class=\"flexrow-item has-text-centered back-link\"\n            :to=\"taskEntitiesPath\"\n          >\n            <corner-left-up-icon />\n          </router-link>\n\n          <div class=\"flexrow-item block flexrow task-type\">\n            <router-link\n              class=\"flexrow-item mt05\"\n              :to=\"previousEntityTaskPath\"\n              v-if=\"previousEntityTaskPath\"\n            >\n              <chevron-left-icon />\n            </router-link>\n\n            <router-link\n              class=\"flexrow-item mt05\"\n              :to=\"nextEntityTaskPath\"\n              v-if=\"nextEntityTaskPath\"\n            >\n              <chevron-right-icon />\n            </router-link>\n            <task-type-name\n              class=\"flexrow-item\"\n              :task-type=\"taskType\"\n              :production-id=\"currentProduction.id\"\n              v-if=\"taskType\"\n            />\n          </div>\n\n          <span class=\"flexrow-item ml2\">\n            <entity-thumbnail\n              class=\"entity-thumbnail\"\n              :entity=\"currentEntity\"\n              :empty-width=\"100\"\n              :empty-height=\"60\"\n              :width=\"100\"\n              :with-link=\"true\"\n            />\n          </span>\n\n          <h1 class=\"title flexrow-item\">\n            <router-link :to=\"taskEntityPath\">\n              {{ task ? title : 'Loading...' }}\n            </router-link>\n          </h1>\n\n          <div class=\"flexrow-item flexrow block\">\n            <span class=\"flexrow-item\">\n              {{ $t('tasks.current_status') }}\n            </span>\n            <validation-tag\n              class=\"is-medium flexrow-item\"\n              :task=\"task\"\n              :is-static=\"true\"\n              v-if=\"task\"\n            />\n            <span\n              class=\"flexrow-item\"\n              v-if=\"assignees.length > 0 && !isCurrentUserClient\"\n            >\n              {{ $t('tasks.fields.assignees') }}:\n            </span>\n            <template v-if=\"!isCurrentUserClient\">\n              <span\n                class=\"flexrow-item avatar-wrapper\"\n                :key=\"person.id\"\n                v-for=\"person in assignees\"\n              >\n                <people-avatar\n                  class=\"flexrow-item\"\n                  :person=\"person\"\n                  :size=\"30\"\n                  :font-size=\"16\"\n                />\n              </span>\n            </template>\n            <subscribe-button\n              class=\"flexrow-item action-button\"\n              :subscribed=\"isAssigned || task.is_subscribed\"\n              @click=\"toggleSubscribe\"\n              v-if=\"!isAssigned\"\n            />\n\n            <router-link\n              class=\"flexrow-item\"\n              :to=\"previousTaskPath\"\n              v-if=\"previousTaskPath\"\n            >\n              <chevron-up-icon />\n            </router-link>\n\n            <router-link\n              class=\"flexrow-item\"\n              :to=\"nextTaskPath\"\n              v-if=\"nextTaskPath\"\n            >\n              <chevron-down-icon />\n            </router-link>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"task-columns\" ref=\"task-columns\">\n        <div class=\"task-column preview-column\">\n          <div class=\"preview-column-content block\">\n            <div class=\"flexrow preview-header\">\n              <div class=\"flexrow-item\" v-if=\"isPreviews\">\n                <combobox-styled\n                  class=\"preview-combo flexrow-item\"\n                  :options=\"previewOptions\"\n                  is-preview\n                  v-model=\"selectedPreviewId\"\n                />\n              </div>\n              <div v-else>\n                <em>\n                  {{ $t('tasks.no_preview') }}\n                </em>\n              </div>\n\n              <div\n                class=\"set-main-preview flexrow-item flexrow pull-right\"\n                v-if=\"currentPreview\"\n              >\n                <button\n                  class=\"button flexrow-item\"\n                  @click=\"showHookupPlaylistModal\"\n                  v-if=\"isHookupButtonVisible\"\n                >\n                  <kitsu-icon\n                    name=\"playlists\"\n                    :title=\"$t('tasks.hookup_playlist')\"\n                  />\n                </button>\n                <button\n                  class=\"button flexrow-item\"\n                  :class=\"{\n                    'is-loading': loading.setPreview\n                  }\"\n                  @click=\"setPreview\"\n                  v-if=\"isCurrentUserManager\"\n                >\n                  <image-icon class=\"icon\" />\n                  <span class=\"text\">\n                    {{ $t('tasks.set_preview') }}\n                  </span>\n                </button>\n                <span class=\"error flexrow-item\" v-if=\"errors.setPreview\">\n                  {{ $t('tasks.set_preview_error') }}\n                </span>\n              </div>\n              <view-playlist-modal\n                :active=\"modals.hookupPlaylist\"\n                :task-ids=\"hookupPlaylistTaskIds\"\n                sort\n                @cancel=\"hideHookupPlaylistModal\"\n              />\n            </div>\n\n            <div class=\"preview-area mt1\">\n              <div v-if=\"isPreviews\">\n                <preview-player\n                  ref=\"preview-player\"\n                  :entity-preview-files=\"taskEntityPreviews\"\n                  :extra-wide=\"true\"\n                  :last-preview-files=\"taskPreviews || []\"\n                  :link=\"currentPreviewComment?.links?.[0]\"\n                  :previews=\"currentPreview.previews\"\n                  :read-only=\"isPreviewPlayerReadOnly\"\n                  :task=\"task\"\n                  :task-type-map=\"taskTypeMap\"\n                  @add-extra-preview=\"onAddExtraPreviewClicked\"\n                  @annotation-changed=\"onAnnotationChanged\"\n                  @change-current-preview=\"changeCurrentPreview\"\n                  @remove-extra-preview=\"onRemoveExtraPreviewClicked\"\n                  @previews-order-changed=\"onPreviewsOrderChanged\"\n                  @frame-updated=\"onFrameUpdated\"\n                  v-if=\"currentPreview\"\n                />\n              </div>\n            </div>\n          </div>\n          <div class=\"flexrow-item block mt1 mr0 info-block\">\n            <page-subtitle :text=\"$t('main.info')\" />\n            <div class=\"table-body mt1\">\n              <table class=\"datatable no-header\" v-if=\"task\">\n                <tbody class=\"table-body\">\n                  <tr class=\"datatable-row\">\n                    <td class=\"field-label\">\n                      {{ $t('tasks.fields.estimation') }}\n                    </td>\n                    <td>{{ formatDuration(task.estimation) }}</td>\n                  </tr>\n                  <tr class=\"datatable-row\">\n                    <td class=\"field-label\">\n                      {{ $t('tasks.fields.duration') }}\n                    </td>\n                    <td>{{ formatDuration(task.duration) }}</td>\n                  </tr>\n                  <tr class=\"datatable-row\">\n                    <td class=\"field-label\">\n                      {{ $t('tasks.fields.retake_count') }}\n                    </td>\n                    <td>{{ task.retake_count }}</td>\n                  </tr>\n                  <tr class=\"datatable-row\">\n                    <td class=\"field-label\">\n                      {{ $t('tasks.fields.start_date') }}\n                    </td>\n                    <td>{{ formatSimpleDate(task.start_date) }}</td>\n                  </tr>\n                  <tr class=\"datatable-row\">\n                    <td class=\"field-label\">\n                      {{ $t('tasks.fields.due_date') }}\n                    </td>\n                    <td>{{ formatSimpleDate(task.due_date) }}</td>\n                  </tr>\n                  <tr class=\"datatable-row\">\n                    <td class=\"field-label\">\n                      {{ $t('tasks.fields.end_date') }}\n                    </td>\n                    <td>{{ formatSimpleDate(task.end_date) }}</td>\n                  </tr>\n                  <tr class=\"datatable-row\">\n                    <td class=\"field-label\">\n                      {{ $t('tasks.fields.done_date') }}\n                    </td>\n                    <td>{{ formatSimpleDate(task.done_date) }}</td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n          <div class=\"pa2\"></div>\n        </div>\n\n        <div class=\"task-column comments-column\">\n          <div v-if=\"task\">\n            <div>\n              <add-comment\n                ref=\"add-comment\"\n                :frame=\"currentFrame\"\n                :is-error=\"errors.addComment\"\n                :is-max-retakes-error=\"errors.addCommentMaxRetakes\"\n                :is-loading=\"loading.addComment\"\n                :is-movie=\"isMovie\"\n                :team=\"currentTeam\"\n                :task=\"task\"\n                :task-status=\"taskStatusForCurrentUser\"\n                :preview-forms=\"previewForms\"\n                :fps=\"currentFps\"\n                :revision=\"currentRevision\"\n                @add-comment=\"addComment\"\n                @add-preview=\"onAddPreviewClicked\"\n                @file-drop=\"selectFile\"\n                @clear-files=\"clearPreviewFiles\"\n                @annotation-snapshots-requested=\"extractAnnotationSnapshots\"\n                @remove-preview=\"onPreviewFormRemoved\"\n                v-if=\"isCommentingAllowed\"\n              />\n              <div\n                class=\"comments\"\n                v-if=\"taskComments && taskComments.length > 0\"\n              >\n                <XyzTransitionGroup\n                  appear\n                  v-xyz=\"{ fade: false, up: false, 'flip-up': false }\"\n                >\n                  <comment\n                    :key=\"comment.id\"\n                    :comment=\"comment\"\n                    :fps=\"currentFps\"\n                    :frame=\"currentFrame\"\n                    :is-change=\"isStatusChange(index)\"\n                    :is-checkable=\"\n                      user.id === comment.person?.id ||\n                      (isCurrentUserArtist && isAssigned) ||\n                      isDepartmentSupervisor ||\n                      isCurrentUserManager\n                    \"\n                    :is-editable=\"\n                      user.id === comment.person?.id || isCurrentUserManager\n                    \"\n                    :is-pinnable=\"\n                      isDepartmentSupervisor || isCurrentUserManager\n                    \"\n                    :is-replyable=\"\n                      user.id === comment.person?.id ||\n                      isAssigned ||\n                      isDepartmentSupervisor ||\n                      isCurrentUserManager\n                    \"\n                    :revision=\"currentRevision\"\n                    :task=\"task\"\n                    :team=\"currentTeam\"\n                    @ack-comment=\"onAckComment\"\n                    @duplicate-comment=\"onDuplicateComment\"\n                    @pin-comment=\"onPinComment\"\n                    @edit-comment=\"onEditComment\"\n                    @delete-comment=\"onDeleteComment\"\n                    @checklist-updated=\"saveComment\"\n                    @time-code-clicked=\"timeCodeClicked\"\n                    v-for=\"(comment, index) in taskComments\"\n                  />\n                </XyzTransitionGroup>\n              </div>\n              <div class=\"no-comment\" v-else>\n                <em>\n                  {{ $t('tasks.no_comment') }}\n                </em>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"has-text-centered\" v-if=\"taskLoading.isLoading\">\n            <spinner />\n          </div>\n        </div>\n      </div>\n\n      <add-preview-modal\n        ref=\"add-preview-modal\"\n        :active=\"modals.addPreview\"\n        :is-loading=\"loading.addPreview\"\n        :is-error=\"errors.addPreview\"\n        :form-data=\"addPreviewFormData\"\n        :fps=\"currentFps\"\n        :expected-frames=\"entityFrames\"\n        :title=\"\n          task\n            ? `${task.entity_name} / ${taskTypeMap.get(task.task_type_id).name}`\n            : ''\n        \"\n        @cancel=\"closeAddPreviewModal\"\n        @confirm=\"confirmAddPreviewModal\"\n      />\n\n      <add-preview-modal\n        ref=\"add-extra-preview-modal\"\n        :active=\"modals.addExtraPreview\"\n        :is-loading=\"loading.addExtraPreview\"\n        :is-error=\"errors.addExtraPreview\"\n        :form-data=\"addExtraPreviewFormData\"\n        message=\"\"\n        :title=\"\n          task\n            ? `${task.entity_name} / ${taskTypeMap.get(task.task_type_id).name}`\n            : ''\n        \"\n        @cancel=\"hideExtraPreviewModal\"\n        @confirm=\"createExtraPreview\"\n      />\n\n      <edit-comment-modal\n        :active=\"modals.editComment\"\n        :frame=\"currentFrame\"\n        :is-loading=\"loading.editComment\"\n        :is-error=\"errors.editComment\"\n        :comment-to-edit=\"commentToEdit\"\n        :team=\"currentTeam\"\n        :fps=\"currentFps\"\n        :revision=\"currentRevision\"\n        @confirm=\"confirmEditTaskComment\"\n        @cancel=\"onCancelEditComment\"\n      />\n\n      <delete-modal\n        :active=\"modals.deleteComment\"\n        :is-loading=\"loading.deleteComment\"\n        :is-error=\"errors.deleteComment\"\n        :text=\"$t('tasks.delete_comment')\"\n        :error-text=\"$t('tasks.delete_comment_error')\"\n        @confirm=\"confirmDeleteTaskComment\"\n        @cancel=\"onCancelDeleteComment\"\n      />\n\n      <delete-modal\n        :active=\"modals.deleteExtraPreview\"\n        :is-loading=\"loading.deleteExtraPreview\"\n        :is-error=\"errors.deleteExtraPreview\"\n        :text=\"$t('tasks.delete_preview')\"\n        :error-text=\"$t('tasks.delete_preview_error')\"\n        @cancel=\"hideRemoveExtraPreviewModal\"\n        @confirm=\"confirmDeleteTaskPreview\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n  ChevronUpIcon,\n  CornerLeftUpIcon,\n  ImageIcon\n} from 'lucide-vue-next'\nimport { mapGetters, mapActions } from 'vuex'\n\nimport drafts from '@/lib/drafts'\nimport { getTaskEntityPath, getTaskEntitiesPath } from '@/lib/path'\nimport { getTaskTypePriorityOfProd } from '@/lib/productions'\nimport { sortPeople } from '@/lib/sorting'\n\nimport { formatListMixin } from '@/components/mixins/format'\nimport { taskMixin } from '@/components/mixins/task'\n\nimport AddComment from '@/components/widgets/AddComment.vue'\nimport AddPreviewModal from '@/components/modals/AddPreviewModal.vue'\nimport Comment from '@/components/widgets/Comment.vue'\nimport ComboboxStyled from '@/components/widgets/ComboboxStyled.vue'\nimport DeleteModal from '@/components/modals/DeleteModal.vue'\nimport EditCommentModal from '@/components/modals/EditCommentModal.vue'\nimport EntityThumbnail from '@/components/widgets/EntityThumbnail.vue'\nimport KitsuIcon from '@/components/widgets/KitsuIcon.vue'\nimport PageSubtitle from '@/components/widgets/PageSubtitle.vue'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar.vue'\nimport Spinner from '@/components/widgets/Spinner.vue'\nimport SubscribeButton from '@/components/widgets/SubscribeButton.vue'\nimport TaskTypeName from '@/components/widgets/TaskTypeName.vue'\nimport ValidationTag from '@/components/widgets/ValidationTag.vue'\nimport PreviewPlayer from '@/components/previews/PreviewPlayer.vue'\nimport ViewPlaylistModal from '@/components/modals/ViewPlaylistModal.vue'\n\nimport assetsStore from '@/store/modules/assets'\nimport editsStore from '@/store/modules/edits'\nimport episodesStore from '@/store/modules/episodes'\nimport sequencesStore from '@/store/modules/sequences'\nimport shotsStore from '@/store/modules/shots'\n\nexport default {\n  name: 'task',\n\n  mixins: [formatListMixin, taskMixin],\n\n  components: {\n    AddComment,\n    AddPreviewModal,\n    ChevronDownIcon,\n    ChevronLeftIcon,\n    ChevronRightIcon,\n    ChevronUpIcon,\n    ComboboxStyled,\n    Comment,\n    CornerLeftUpIcon,\n    DeleteModal,\n    EditCommentModal,\n    EntityThumbnail,\n    KitsuIcon,\n    ImageIcon,\n    PageSubtitle,\n    PeopleAvatar,\n    PreviewPlayer,\n    Spinner,\n    SubscribeButton,\n    TaskTypeName,\n    ValidationTag,\n    ViewPlaylistModal\n  },\n\n  provide() {\n    return {\n      draftComment: this.draftComment\n    }\n  },\n\n  data() {\n    return {\n      draftComment: {},\n      previewForms: [],\n      currentFrame: 0,\n      currentTask: null,\n      hookupPlaylistTaskIds: [],\n      selectedTab: 'validation',\n      taskLoading: {\n        isLoading: true,\n        isError: false\n      },\n      modals: {\n        addPreview: false,\n        addExtraPreview: false,\n        deleteExtraPreview: false,\n        deleteComment: false,\n        editComment: false,\n        hookupPlaylist: false\n      },\n      loading: {\n        addComment: false,\n        addPreview: false,\n        addExtraPreview: false,\n        setPreview: false,\n        deleteComment: false,\n        editComment: false\n      },\n      errors: {\n        addComment: false,\n        addCommentMaxRetakes: false,\n        addPreview: false,\n        addExtraPreview: false,\n        setPreview: false,\n        deleteComment: false,\n        editComment: false\n      },\n      addPreviewFormData: null,\n      addExtraPreviewFormData: null,\n      task: null,\n      taskComments: [],\n      taskPreviews: [],\n      commentToEdit: null,\n      selectedPreviewId: null\n    }\n  },\n\n  created() {\n    this.clearSelectedTasks()\n  },\n\n  async mounted() {\n    await this.loadTaskData()\n    await this.$nextTick()\n    await this[`load${this.currentType}s`]()\n    this.reset()\n    await this.$nextTick()\n    if (this.$refs['task-columns']) {\n      this.$refs['task-columns'].scrollTop = 100\n      window.scrollTo(0, 0)\n    }\n  },\n\n  computed: {\n    ...mapGetters([\n      'currentEpisode',\n      'currentProduction',\n      'displayedShots',\n      'displayedAssets',\n      'getTaskComments',\n      'getTaskPreviews',\n      'getTaskComment',\n      'isCurrentUserArtist',\n      'isCurrentUserClient',\n      'isCurrentUserManager',\n      'isCurrentUserSupervisor',\n      'isSingleEpisode',\n      'isTVShow',\n      'personMap',\n      'productionMap',\n      'route',\n      'shotMap',\n      'taskEntityPreviews',\n      'taskStatus',\n      'taskStatusForCurrentUser',\n      'taskMap',\n      'taskTypeMap',\n      'user'\n    ]),\n\n    assetList() {\n      return assetsStore.cache.assets\n    },\n\n    editList() {\n      return editsStore.cache.edits\n    },\n\n    episodeList() {\n      return episodesStore.cache.episodes\n    },\n\n    sequenceList() {\n      return sequencesStore.cache.sequences\n    },\n\n    shotList() {\n      return shotsStore.cache.shots\n    },\n\n    currentEntity() {\n      return this.task && this.task.entity\n    },\n\n    currentType() {\n      const genericNames = ['Shot', 'Episode', 'Sequence', 'Edit']\n      if (genericNames.includes(this.task?.entity_type_name)) {\n        return this.task.entity_type_name\n      } else {\n        return 'Asset'\n      }\n    },\n\n    previewOptions() {\n      return [...this.taskPreviews]\n        .sort((a, b) => b.revision - a.revision)\n        .map(preview => {\n          return {\n            label: `v${preview.revision}`,\n            value: preview.id\n          }\n        })\n    },\n\n    isPreviewButtonVisible() {\n      return (\n        this.isCurrentUserManager &&\n        this.task &&\n        this.task.entity &&\n        this.task.entity.preview_file_id !== this.currentPreviewId &&\n        ['png', 'mp4'].includes(this.extension)\n      )\n    },\n\n    isMovie() {\n      return this.extension === 'mp4'\n    },\n\n    isPreviewPlayerReadOnly() {\n      if (this.task) {\n        if (this.isCurrentUserManager || this.isCurrentUserClient) {\n          return false\n        } else if (this.isCurrentUserSupervisor) {\n          if (this.user.departments.length === 0) {\n            return false\n          } else {\n            return !this.user.departments.includes(this.taskType?.department_id)\n          }\n        }\n      }\n      return true\n    },\n\n    extension() {\n      return this.currentPreview ? this.currentPreview.extension : ''\n    },\n\n    currentPreviewId() {\n      return this.currentPreview ? this.currentPreview.id : ''\n    },\n\n    currentPreview() {\n      if (this.isPreviews) {\n        let currentPreview = this.taskPreviews[0]\n        const previewId = this.route.params.preview_id\n        if (this.selectedPreviewId) {\n          currentPreview = this.taskPreviews.find(preview => {\n            return preview.id === previewId\n          })\n        }\n        return currentPreview\n      } else {\n        return null\n      }\n    },\n\n    currentPreviewComment() {\n      return this.taskComments.find(comment =>\n        comment.previews?.some(\n          preview => preview.revision === this.currentRevision\n        )\n      )\n    },\n\n    currentRevision() {\n      return this.currentPreview?.revision || 0\n    },\n\n    taskTypeBorder() {\n      let border = 'transparent'\n      if (this.task) border = this.task.task_type_color\n      return {\n        'border-left': `4px solid ${border}`\n      }\n    },\n\n    deleteTaskPath() {\n      return this.taskPath(this.task, 'task-delete')\n    },\n\n    isPreviews() {\n      return this.taskPreviews && this.taskPreviews.length > 0\n    },\n\n    taskEntityPath() {\n      if (this.task) {\n        const episodeId = this.currentEpisode\n          ? this.currentEpisode.id\n          : this.$route.params.episode_id\n        return getTaskEntityPath(this.task, episodeId)\n      } else {\n        return {\n          name: 'open-productions'\n        }\n      }\n    },\n\n    taskEntitiesPath() {\n      if (this.task) {\n        const episodeId = this.currentEpisode\n          ? this.currentEpisode.id\n          : this.$route.params.episode_id\n        return getTaskEntitiesPath(this.task, episodeId)\n      } else {\n        return {\n          name: 'open-productions'\n        }\n      }\n    },\n\n    entityList() {\n      return this[`${this.currentType.toLowerCase()}List`]\n    },\n\n    /*\n     * Get the path to the previous task in the current entity.\n     */\n    previousEntityTaskPath() {\n      if (!this.task) return null\n      const entity = this.entityList.find(\n        entity => entity.id === this.task.entity_id\n      )\n      if (!entity) return null\n      let tasks = entity.tasks || []\n      tasks = tasks.sort((a, b) => {\n        const taskA = this.taskMap.get(a)\n        const taskB = this.taskMap.get(b)\n        const taskTypeA = this.taskTypeMap.get(taskA?.task_type_id)\n        const taskTypeB = this.taskTypeMap.get(taskB?.task_type_id)\n        return (\n          getTaskTypePriorityOfProd(taskTypeA, this.currentProduction) -\n          getTaskTypePriorityOfProd(taskTypeB, this.currentProduction)\n        )\n      })\n      const tasksLength = tasks.length\n      const taskIndex = tasks.findIndex(taskId => taskId === this.task.id)\n      const previousTaskIndex = taskIndex - 1\n      const previousTaskId =\n        previousTaskIndex < 0\n          ? tasks[tasksLength - 1]\n          : tasks[previousTaskIndex]\n      return previousTaskId ? this.taskPath({ id: previousTaskId }) : null\n    },\n\n    /*\n     * Get the path to the next task in the current entity.\n     */\n    nextEntityTaskPath() {\n      if (!this.task) return null\n      const entity = this.entityList.find(\n        entity => entity.id === this.task.entity_id\n      )\n      if (!entity) return null\n      let tasks = entity.tasks || []\n      tasks = tasks.sort((a, b) => {\n        const taskA = this.taskMap.get(a)\n        const taskB = this.taskMap.get(b)\n        const taskTypeA = this.taskTypeMap.get(taskA?.task_type_id)\n        const taskTypeB = this.taskTypeMap.get(taskB?.task_type_id)\n        return (\n          getTaskTypePriorityOfProd(taskTypeA, this.currentProduction) -\n          getTaskTypePriorityOfProd(taskTypeB, this.currentProduction)\n        )\n      })\n      const tasksLength = tasks.length\n      const taskIndex = tasks.findIndex(taskId => taskId === this.task.id)\n      const nextTaskIndex = taskIndex + 1\n      const nextTaskId =\n        nextTaskIndex >= tasksLength ? tasks[0] : tasks[nextTaskIndex]\n      return nextTaskId ? this.taskPath({ id: nextTaskId }) : null\n    },\n\n    /*\n     * Get the path to the previous task. The previous task is the fist task\n     * found in the previous entities with the same task type.\n     */\n    previousTaskPath() {\n      if (!this.task) return null\n\n      const entityIndex = this.getEntityIndex(this.task.entity_id)\n      if (entityIndex === -1) return null\n\n      let previousEntityIndex = this.getPreviousEntityIndex(entityIndex)\n      let taskId = null\n      while (!taskId && previousEntityIndex !== entityIndex) {\n        taskId = this.getTaskIdFromEntity(previousEntityIndex)\n        if (!taskId) {\n          previousEntityIndex = this.getPreviousEntityIndex(previousEntityIndex)\n        }\n      }\n\n      return taskId ? this.taskPath({ id: taskId }) : null\n    },\n\n    /*\n     * Get the path to the next task. The next task is the fist task\n     * found in the next entities with the same task type.\n     */\n    nextTaskPath() {\n      if (!this.task) return null\n\n      const entityIndex = this.getEntityIndex(this.task.entity_id)\n      if (entityIndex === -1) return null\n\n      let nextEntityIndex = this.getNextEntityIndex(entityIndex)\n      let taskId = null\n      while (!taskId && nextEntityIndex !== entityIndex) {\n        taskId = this.getTaskIdFromEntity(nextEntityIndex)\n        if (!taskId) {\n          nextEntityIndex = this.getNextEntityIndex(nextEntityIndex)\n        }\n      }\n\n      return taskId ? this.taskPath({ id: taskId }) : null\n    },\n\n    title() {\n      if (this.task) {\n        const type = this.task.entity_type_name\n        let entityName = this.task.full_entity_name || this.task.entity_name\n        if (this.isTVShow && type === 'Shot') {\n          entityName = entityName.split('/').splice(1).join('/')\n        }\n        if (this.isTVShow && type === 'Episode') {\n          entityName = this.task.entity_name\n        }\n        return `${entityName}`\n      } else {\n        return 'Loading...'\n      }\n    },\n\n    windowTitle() {\n      if (this.task) {\n        const taskTypeName = this.task.task_type_name\n        return `${this.title} / ${taskTypeName}`\n      } else {\n        return 'Loading...'\n      }\n    },\n\n    deleteText() {\n      if (this.task) {\n        const taskType = this.taskTypeMap.get(this.task.task_type_id)\n        return this.$t('main.delete_text', {\n          name: `${this.task.entity_name} / ${taskType.name}`\n        })\n      } else {\n        return ''\n      }\n    },\n\n    assignees() {\n      return sortPeople(\n        this.task.assignees.map(personId => this.personMap.get(personId))\n      )\n    },\n\n    isAssigned() {\n      return (\n        this.task?.assignees.some(personId => personId === this.user.id) ??\n        false\n      )\n    },\n\n    isCommentingAllowed() {\n      return (\n        this.isAssigned ||\n        this.isCurrentUserClient ||\n        this.isDepartmentSupervisor ||\n        this.isCurrentUserManager\n      )\n    },\n\n    isDepartmentSupervisor() {\n      if (!this.isCurrentUserSupervisor) {\n        return false\n      }\n      if (this.user.departments.length === 0) {\n        return true\n      }\n      return this.user.departments.includes(this.taskType?.department_id)\n    },\n\n    isHookupButtonVisible() {\n      return this.task?.entity_type_name === 'Shot'\n    },\n\n    taskType() {\n      return this.taskTypeMap.get(this.task?.task_type_id)\n    },\n\n    currentTeam() {\n      return sortPeople(\n        this.currentProduction.team.map(personId =>\n          this.personMap.get(personId)\n        )\n      )\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'addAttachmentToComment',\n      'ackComment',\n      'addCommentPreview',\n      'addCommentExtraPreview',\n      'commentTask',\n      'commentTaskWithPreview',\n      'changeCommentPreview',\n      'clearSelectedTasks',\n      'deleteAttachment',\n      'deleteTaskPreview',\n      'deleteTaskComment',\n      'editTaskComment',\n      'loadComment',\n      'loadAssets',\n      'loadEdits',\n      'loadEpisodes',\n      'loadSequences',\n      'loadShots',\n      'loadTask',\n      'loadPreviewFileFormData',\n      'loadTaskComments',\n      'refreshComment',\n      'refreshPreview',\n      'pinComment',\n      'subscribeToTask',\n      'setCurrentEpisode',\n      'unsubscribeFromTask',\n      'updatePreviewAnnotation'\n    ]),\n\n    getPreviousEntityIndex(index) {\n      const result = index - 1\n      return result < 0 ? this.entityList.length - 1 : result\n    },\n\n    getNextEntityIndex(index) {\n      const result = index + 1\n      return result >= this.entityList.length ? 0 : result\n    },\n\n    getEntityIndex(entityId) {\n      return this.entityList.findIndex(entity => entity.id === entityId)\n    },\n\n    getTaskIdFromEntity(index) {\n      const taskTypeId = this.task.task_type_id\n      const entity = this.entityList[index]\n      if (!entity) return null\n      return entity.tasks.find(ctaskId => {\n        const task = this.taskMap.get(ctaskId)\n        return task && task.task_type_id === taskTypeId\n      })\n    },\n\n    loadTaskData() {\n      const task = this.getCurrentTask()\n      if (!task) {\n        this.taskLoading = { isLoading: true, isError: false }\n        return this.loadTask({ taskId: this.route.params.task_id })\n          .then(task => {\n            let loadingFunction = callback => {\n              this.loadAssets().then(callback)\n            }\n\n            if (task.entity_type_name === 'Shot') {\n              loadingFunction = callback => {\n                this.loadEpisodes()\n                  .then(() => {\n                    if (this.isTVShow) {\n                      this.setCurrentEpisode(task.episode.id)\n                    }\n                    this.loadShots(callback)\n                  })\n                  .catch(callback)\n              }\n            }\n            return loadingFunction(() => {\n              this.task = task\n              return this.loadTaskComments({\n                taskId: task.id,\n                entityId: task.entity_id\n              })\n                .then(() => {\n                  this.reset()\n                  this.taskLoading = { isLoading: false, isError: false }\n                })\n                .catch(err => {\n                  console.error(err)\n                  this.taskLoading = { isLoading: false, isError: true }\n                })\n            })\n          })\n          .catch(err => {\n            console.error(err)\n            this.taskLoading = { isLoading: false, isError: true }\n          })\n      } else {\n        const taskId = this.route.params.task_id\n        this.task = task\n        return this.loadTaskComments({\n          taskId,\n          entityId: task.entity_id\n        })\n          .then(() => {\n            this.reset()\n          })\n          .catch(err => {\n            console.error(err)\n            this.taskLoading.isError = true\n          })\n          .finally(() => {\n            this.taskLoading.isLoading = false\n          })\n      }\n    },\n\n    getCurrentTask() {\n      return this.taskMap.get(this.route.params.task_id)\n    },\n\n    getCurrentTaskComments() {\n      return this.getTaskComments(this.route.params.task_id)\n    },\n\n    getCurrentTaskPreviews() {\n      return this.getTaskPreviews(this.route.params.task_id)\n    },\n\n    addComment(\n      comment,\n      attachment,\n      checklist,\n      taskStatusId,\n      revision = undefined,\n      link = undefined\n    ) {\n      const params = {\n        taskId: this.task.id,\n        taskStatusId,\n        attachment,\n        checklist,\n        comment,\n        links: link ? [link] : null,\n        revision\n      }\n      const action =\n        this.previewForms.length > 0 ? 'commentTaskWithPreview' : 'commentTask'\n      this.loading.addComment = true\n      this.errors.addComment = false\n      this.errors.addCommentMaxRetakes = false\n      this.$store\n        .dispatch(action, params)\n        .then(() => {\n          drafts.clearTaskDraft(this.task.id)\n          this.$refs['add-comment']?.reset()\n          this.reset()\n          this.loading.addComment = false\n        })\n        .catch(err => {\n          console.error(err)\n          this.errors.addComment = true\n          this.loading.addComment = false\n          const isRetakeError = err.body?.message?.includes('retake') ?? false\n          this.errors.addComment = !isRetakeError\n          this.errors.addCommentMaxRetakes = isRetakeError\n        })\n    },\n\n    hideHookupPlaylistModal() {\n      this.modals.hookupPlaylist = false\n    },\n\n    /*\n     * Create a playlist with the previous, current and next task within the\n     * same sequence\n     */\n    showHookupPlaylistModal() {\n      const currentTaskId = this.task.id\n      const tasks = Array.from(this.taskMap.values())\n        // get all tasks for this sequence\n        .filter(\n          task =>\n            task.episode_id === this.task.episode_id &&\n            task.sequence_name === this.task.sequence_name &&\n            task.task_type_id === this.task.task_type_id\n        )\n        // sort the tasks by shot name\n        .sort((a, b) =>\n          a.entity_name.localeCompare(b.entity_name, undefined, {\n            numeric: true\n          })\n        )\n\n      const currentTaskIndex = tasks.findIndex(\n        task => task.id === currentTaskId\n      )\n\n      const previousTaskId =\n        currentTaskIndex > 0 ? tasks[currentTaskIndex - 1].id : null\n\n      const nextTaskId =\n        currentTaskIndex < tasks.length - 1\n          ? tasks[currentTaskIndex + 1].id\n          : null\n\n      this.hookupPlaylistTaskIds = [currentTaskId]\n      if (previousTaskId) this.hookupPlaylistTaskIds.unshift(previousTaskId)\n      if (nextTaskId) this.hookupPlaylistTaskIds.push(nextTaskId)\n\n      this.modals.hookupPlaylist = true\n    },\n\n    reset({ keepPreviewFiles = false } = {}) {\n      this.resetModals()\n      this.resetPreview(false)\n      if (!keepPreviewFiles) {\n        this.clearPreviewFiles(false)\n      }\n      this.taskComments = this.getCurrentTaskComments()\n      this.taskPreviews = this.getCurrentTaskPreviews()\n      this.task = this.getCurrentTask()\n      this.resetDraft()\n      setTimeout(() => {\n        if (this.$route.params.preview_id) {\n          this.selectedPreviewId = this.$route.params.preview_id\n        }\n      }, 200)\n    },\n\n    selectFile(forms) {\n      this.previewForms = this.previewForms.concat(forms)\n      this.loadPreviewFileFormData(this.previewForms)\n    },\n\n    clearPreviewFiles() {\n      this.previewForms = []\n      this.loadPreviewFileFormData(this.previewForms)\n      this.$store.commit('CLEAR_UPLOAD_PROGRESS')\n    },\n\n    isHighlighted(comment) {\n      return comment.preview && comment.preview.id === this.currentPreviewId\n    },\n\n    createExtraPreview(forms) {\n      this.selectFile(forms)\n      this.errors.addExtraPreview = false\n      this.loading.addExtraPreview = true\n      const comment = this.getCurrentTaskComments().find(comment =>\n        comment.previews.find(preview => preview.id === this.currentPreviewId)\n      )\n      this.addCommentExtraPreview({\n        taskId: this.task.id,\n        commentId: comment?.id,\n        previewId: this.currentPreviewId\n      })\n        .then(() => {\n          this.loading.addExtraPreview = false\n          this.modals.addExtraPreview = false\n          this.$refs['add-extra-preview-modal'].reset()\n          this.clearPreviewFiles()\n          setTimeout(() => {\n            this.$refs['preview-player'].displayLast()\n          }, 0)\n        })\n        .catch(err => {\n          console.error(err)\n          this.errors.addExtraPreview = true\n          this.loading.addExtraPreview = false\n        })\n    },\n\n    resetPreview(changeRoute = true) {\n      const previews = this.taskPreviews || []\n      const preview = previews.length > 0 ? previews[0] : null\n      this.taskComments = this.getCurrentTaskComments()\n      this.taskPreviews = this.getCurrentTaskPreviews()\n      if (preview && changeRoute) {\n        this.$router.push(this.previewPath(preview.id))\n      }\n    },\n\n    setPreview() {\n      const previewPlayer = this.$refs['preview-player']\n      if (!previewPlayer) return\n      this.loading.setPreview = true\n      this.errors.setPreview = false\n      const previewId = previewPlayer.currentPreview.id\n      this.$store\n        .dispatch('setPreview', {\n          taskId: this.task.id,\n          entityId: this.task.entity.id,\n          previewId\n        })\n        .then(() => {\n          this.loading.setPreview = false\n        })\n        .catch(err => {\n          console.error(err)\n          this.errors.setPreview = true\n        })\n    },\n\n    async saveComment(comment) {\n      try {\n        await this.editTaskComment({\n          taskId: this.task.id,\n          comment\n        })\n      } catch (err) {\n        console.error(err)\n        await this.loadTaskData()\n      }\n    },\n\n    confirmDeleteTaskComment() {\n      this.loading.deleteComment = true\n      this.errors.deleteComment = false\n      const commentId = this.commentToEdit.id\n\n      this.deleteTaskComment({\n        taskId: this.task.id,\n        commentId\n      })\n        .then(() => {\n          this.loading.deleteComment = false\n          this.reset()\n          if (this.isPreviews) this.resetPreview()\n          this.modals.deleteComment = false\n        })\n        .catch(err => {\n          console.error(err)\n          this.loading.deleteComment = false\n          this.errors.deleteComment = true\n        })\n    },\n\n    confirmDeleteTaskPreview() {\n      this.loading.deleteExtraPreview = true\n      this.errors.deleteExtraPreview = false\n      const previewId = this.currentPreviewId\n      const comment = this.getCurrentTaskComments().find(comment => {\n        return comment.previews.findIndex(p => p.id === previewId) >= 0\n      })\n\n      this.$refs['preview-player'].displayFirst()\n      this.deleteTaskPreview({\n        taskId: this.task.id,\n        commentId: comment.id,\n        previewId: this.currentExtraPreviewId\n      })\n        .then(() => {\n          this.loading.deleteExtraPreview = false\n          this.resetPreview()\n          this.hideRemoveExtraPreviewModal()\n        })\n        .catch(err => {\n          console.error(err)\n          this.loading.deleteExtraPreview = false\n          this.errors.deleteExtraPreview = true\n        })\n    },\n\n    onPreviewAdded(eventData) {\n      const taskId = eventData.task_id\n      const commentId = eventData.comment_id\n      const previewId = eventData.preview_file_id\n      const revision = eventData.revision\n      const extension = eventData.extension\n      const comment = this.$store.getters.getTaskComment(taskId, commentId)\n\n      if (\n        this.task &&\n        comment &&\n        comment.previews &&\n        (comment.previews.length === 0 ||\n          comment.previews[0].id !== previewId) &&\n        taskId === this.task.id\n      ) {\n        this.$store.commit('ADD_PREVIEW_END', {\n          preview: {\n            id: previewId,\n            revision,\n            extension\n          },\n          taskId,\n          commentId,\n          comment\n        })\n        this.reset({ keepPreviewFiles: true })\n      }\n    },\n\n    toggleSubscribe() {\n      if (this.task && !this.isAssigned) {\n        if (this.task.is_subscribed) {\n          this.unsubscribeFromTask(this.task.id)\n        } else {\n          this.subscribeToTask(this.task.id)\n        }\n      }\n    },\n\n    taskPath(task, section = 'task') {\n      if (!task) {\n        task = this.task\n      } else {\n        task.project_id = this.task.project_id\n        task.episode_id = this.task.episode_id\n      }\n\n      let route = { name: 'open-productions' }\n      if (task) {\n        route = {\n          name: section,\n          params: {\n            type: this.currentType.toLowerCase() + 's',\n            production_id: task.project_id,\n            task_id: task.id\n          }\n        }\n\n        if (this.isTVShow && this.currentEpisode) {\n          route.name = `episode-${section}`\n          route.params.episode_id = task.episode_id || this.currentEpisode.id\n        }\n      }\n      return route\n    },\n\n    previewPath(previewId) {\n      const route = this.taskPath(this.task, 'task-preview')\n      if (this.isTVShow) {\n        const taskType = this.taskTypeMap.get(this.task.task_type_id)\n        route.name = 'episode-task-preview'\n        if (taskType.for_entity === 'Episode') {\n          route.name = 'episode-episode-task-preview'\n        }\n      }\n      if (route.params) {\n        route.params.preview_id = previewId\n      }\n      return route\n    },\n\n    onAnnotationChanged({ preview, additions, deletions, updates }) {\n      const taskId = this.task.id\n      this.updatePreviewAnnotation({\n        taskId,\n        preview,\n        additions,\n        deletions,\n        updates\n      })\n    },\n\n    onAddExtraPreviewClicked() {\n      this.clearPreviewFiles()\n      this.modals.addExtraPreview = true\n    },\n\n    onRemoveExtraPreviewClicked(preview) {\n      this.showRemoveExtraPreviewModal(preview)\n    },\n\n    hideExtraPreviewModal() {\n      this.modals.addExtraPreview = false\n    },\n\n    showRemoveExtraPreviewModal(preview) {\n      this.currentExtraPreviewId = preview.id\n      this.modals.deleteExtraPreview = true\n    },\n\n    hideRemoveExtraPreviewModal() {\n      this.modals.deleteExtraPreview = false\n    },\n\n    onAddPreviewClicked() {\n      this.modals.addPreview = true\n    },\n\n    closeAddPreviewModal() {\n      this.modals.addPreview = false\n    },\n\n    confirmAddPreviewModal(forms) {\n      this.selectFile(forms)\n      this.closeAddPreviewModal()\n    },\n\n    onAckComment(comment) {\n      this.ackComment(comment)\n    },\n\n    onDuplicateComment(comment) {\n      this.$refs['add-comment'].setValue(comment)\n    },\n\n    onPinComment(comment) {\n      this.pinComment(comment)\n    },\n\n    onEditComment(comment) {\n      this.commentToEdit = comment\n      this.modals.editComment = true\n    },\n\n    onDeleteComment(comment) {\n      this.commentToEdit = comment\n      this.modals.deleteComment = true\n    },\n\n    onCancelEditComment(comment) {\n      this.modals.editComment = false\n    },\n\n    onCancelDeleteComment(comment) {\n      this.modals.deleteComment = false\n    },\n\n    onFrameUpdated(frame) {\n      this.currentFrame = frame\n    },\n\n    onPreviewFormRemoved(previewForm) {\n      this.previewForms = this.previewForms.filter(f => f !== previewForm)\n      this.loadPreviewFileFormData(this.previewForms)\n    },\n\n    changeCurrentPreview(preview) {\n      this.$router.push(this.previewPath(preview.id))\n    },\n\n    onRemoteAcknowledge(eventData, type) {\n      if (this.task) {\n        const comment = this.taskComments.find(\n          c => c.id === eventData.comment_id\n        )\n        const user = this.personMap.get(eventData.person_id)\n        if (comment && user) {\n          if (this.user.id === user.id) {\n            if (\n              (type === 'ack' && !comment.acknowledgements.includes(user.id)) ||\n              (type === 'unack' && comment.acknowledgements.includes(user.id))\n            ) {\n              this.$store.commit('ACK_COMMENT', { comment, user })\n            }\n          } else {\n            this.$store.commit('ACK_COMMENT', { comment, user })\n          }\n        }\n      }\n    },\n\n    isStatusChange(index) {\n      const comments = this.taskComments\n      const comment = comments[index]\n      return (\n        index === comments.length - 1 ||\n        comment.task_status_id !== comments[index + 1].task_status_id\n      )\n    },\n\n    timeCodeClicked({\n      versionRevision,\n      minutes,\n      seconds,\n      milliseconds,\n      frame\n    }) {\n      this.changeCurrentPreview(\n        this.taskPreviews.find(p => p.revision === parseInt(versionRevision))\n      )\n      setTimeout(() => {\n        this.$refs['preview-player']?.setCurrentFrame(frame)\n        this.$refs['preview-player']?.focus()\n      }, 100)\n    },\n\n    onPreviewsOrderChanged() {\n      this.taskPreviews = this.getCurrentTaskPreviews()\n    },\n\n    async extractAnnotationSnapshots() {\n      this.$refs['add-comment'].showAnnotationLoading()\n      const files =\n        await this.$refs['preview-player'].extractAnnotationSnapshots()\n      this.$refs['add-comment'].setAnnotationSnapshots(files)\n      this.$refs['add-comment'].hideAnnotationLoading()\n      return files\n    }\n  },\n\n  watch: {\n    $route() {\n      if (this.task && this.$route.params.task_id !== this.task.id) {\n        this.loadTaskData()\n      }\n      if (this.$route.params.preview_id !== this.selectedPreviewId) {\n        this.selectedPreviewId = this.$route.params.preview_id\n      }\n    },\n\n    currentProduction() {\n      this.loadTaskData()\n    },\n\n    selectedPreviewId() {\n      if (this.task && this.selectedPreviewId) {\n        this.$router.push(this.previewPath(this.selectedPreviewId))\n      }\n    }\n  },\n\n  socket: {\n    events: {\n      'preview-file:add-file'(eventData) {\n        this.onPreviewAdded(eventData)\n      },\n\n      'preview-file:update'(eventData) {\n        const comment = this.taskComments.find(\n          c =>\n            c.previews &&\n            c.previews.length > 0 &&\n            c.previews[0].id === eventData.preview_file_id\n        )\n        if (comment && this.task) {\n          this.refreshPreview({\n            taskId: this.task.id,\n            previewId: eventData.preview_file_id\n          }).then(preview => {\n            comment.previews[0].validation_status = preview.validation_status\n          })\n        }\n      },\n\n      'comment:acknowledge'(eventData) {\n        this.onRemoteAcknowledge(eventData, 'ack')\n      },\n\n      'comment:unacknowledge'(eventData) {\n        this.onRemoteAcknowledge(eventData, 'unack')\n      },\n\n      'comment:new'(eventData) {\n        setTimeout(() => {\n          if (\n            this.getCurrentTaskComments().length !== this.taskComments.length\n          ) {\n            this.taskComments = this.getCurrentTaskComments()\n            this.taskPreviews = this.getCurrentTaskPreviews()\n          }\n        }, 1000)\n      },\n\n      'comment:update'(eventData) {\n        const commentId = eventData.comment_id\n        if (!this.taskComments.some(({ id }) => id === commentId)) {\n          return\n        }\n        this.loadComment({ commentId }).catch(console.error)\n      },\n\n      'comment:reply'(eventData) {\n        if (this.task) {\n          const comment = this.taskComments.find(\n            c => c.id === eventData.comment_id\n          )\n          if (comment) {\n            if (!comment.replies) comment.replies = []\n            const hasReply = comment.replies.some(\n              reply => reply.id === eventData.reply_id\n            )\n            if (!hasReply) {\n              this.refreshComment({\n                commentId: eventData.comment_id\n              })\n                .then(remoteComment => {\n                  comment.replies = remoteComment.replies\n                })\n                .catch(console.error)\n            }\n          }\n        }\n      },\n\n      'comment:delete'(eventData) {\n        const task = this.getTask()\n        if (task) {\n          const comments = this.getComments()\n          const comment = comments.find(c => c.id === eventData.comment_id)\n          if (comment) {\n            this.$store.commit('REMOVE_TASK_COMMENT', { task, comment })\n            this.taskComments = this.getCurrentTaskComments()\n            this.taskPreviews = this.getCurrentTaskPreviews()\n          }\n        }\n      },\n\n      'comment:delete-reply'(eventData) {\n        if (this.task) {\n          const comment = this.taskComments.find(\n            c => c.id === eventData.comment_id\n          )\n          if (comment) {\n            if (!comment.replies) comment.replies = []\n            this.$store.commit('REMOVE_REPLY_FROM_COMMENT', {\n              comment,\n              reply: { id: eventData.reply_id }\n            })\n          }\n        }\n      },\n\n      'preview-file:annotation-update'(eventData) {\n        const previewPlayer = this.$refs['preview-player']\n        if (!previewPlayer) return\n        const isValid = previewPlayer.isValidPreviewModification(\n          eventData.preview_file_id,\n          eventData.updated_at\n        )\n        if (isValid) {\n          this.refreshPreview({\n            previewId: previewPlayer.currentPreview.id,\n            taskId: previewPlayer.currentPreview.task_id\n          }).then(() => {\n            if (!previewPlayer.notSaved) {\n              this.taskPreviews = this.getCurrentTaskPreviews()\n              this.$nextTick(() => {\n                previewPlayer.reloadAnnotations()\n                previewPlayer.loadAnnotation()\n              })\n            }\n          })\n        }\n      }\n    }\n  },\n\n  head() {\n    let title = 'Loading task... - Kitsu'\n    if (this.task) {\n      const taskTypeName = this.taskTypeMap.get(this.task.task_type_id).name\n      title = `${this.title} / ${taskTypeName} - Kitsu`\n    }\n    return { title }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark .task-information,\n.dark .add-comment,\n.dark .comment,\n.dark .no-comment,\n.dark .column {\n  background: #46494f;\n  border-color: $dark-grey;\n  box-shadow: 0 0 6px #333;\n}\n\nh2.subtitle {\n  border: 0;\n  margin: 0;\n  padding: 0;\n}\n\n.page {\n  background: #f9f9f9;\n  margin-top: 60px;\n  padding: 0;\n}\n\n.page.column {\n  background: var(--background-page);\n  padding-bottom: 1em;\n}\n\n.page-header {\n  margin: 1em 1em 0 1em;\n  padding-right: 0;\n}\n\n.navigation-buttons {\n  font-size: 1em;\n  margin-top: 0.5em;\n  margin-bottom: 0.5em;\n}\n\n.navigation-buttons .arrow {\n  font-size: 1.2em;\n  font-weight: bold;\n}\n\n.navigation-buttons a {\n  color: $grey;\n}\n\n.selected {\n  border: 0;\n}\n\n.source {\n  color: #aaa;\n  font-size: 0.8em;\n}\n\nvideo {\n  width: 100%;\n}\n\n.validation-buttons button {\n  width: 100%;\n  margin-bottom: 0.3em;\n  border-width: 2px;\n  font-weight: bold;\n}\n\n.preview-row {\n  margin-bottom: 0.5em;\n}\n\n.add-comment {\n  margin-bottom: 1em;\n  padding: 1em;\n  box-shadow: 0 0 6px #e0e0e0;\n}\n\n.no-comment {\n  background: white;\n  box-shadow: 0 0 6px #e0e0e0;\n  padding: 1em;\n  border-radius: 5px;\n}\n\n.comment {\n  box-shadow: 0 0 6px #e0e0e0;\n  margin-top: 0.3em;\n}\n\n.task-columns {\n  display: flex;\n  flex: 1;\n  flex-direction: row;\n}\n\n.task-column {\n  padding: 1em;\n}\n\n.comments-column {\n  flex: 1;\n}\n\n.preview-column {\n  overflow: auto;\n  flex: 2;\n}\n\n.preview-list {\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.page-header .tag {\n  border-radius: 0;\n  font-weight: bold;\n  margin-right: 0.5em;\n}\n\n.assignees {\n  display: flex;\n}\n\n.assignees span {\n  margin-right: 0.2em;\n}\n\n.avatar-wrapper {\n  margin-right: 0.5em;\n}\n\n.entity-thumbnail {\n  margin-right: 0.3em;\n}\n\n.title {\n  margin: 0;\n  flex: 1;\n}\n\n.pull-right {\n  margin-left: auto;\n}\n\n.title a {\n  color: inherit;\n}\n\n.set-main-preview {\n  height: 30px;\n}\n\n.back-link {\n  padding-top: 6px;\n}\n\n.main-column {\n  display: flex;\n  flex-direction: column;\n  max-height: calc(100% - 60px);\n}\n\n.task-columns {\n  display: flex;\n  max-height: 100%;\n  overflow: hidden;\n}\n\n.task-column {\n  overflow-y: auto;\n}\n\n.info-block {\n  margin-right: 0;\n}\n\n.task-type.block {\n  margin-bottom: 0;\n}\n\n.entity-thumbnail {\n  margin-top: 5px;\n}\n\n.field-label {\n  width: 130px;\n  max-width: 130px;\n}\n\n.title {\n  margin: 0;\n  flex: 1;\n  line-height: 1.5em;\n  font-weight: 500;\n  color: $grey;\n}\n\n@media screen and (max-width: 768px) {\n  .action-button {\n    display: none;\n  }\n\n  .title {\n    font-size: 1.3em;\n    line-height: 1.5em;\n  }\n\n  .header-title {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n\n  .header-title .flexrow-item {\n    margin-bottom: 0.5em;\n  }\n\n  .task-column {\n    width: 100%;\n    overflow-y: initial;\n  }\n}\n</style>\n"],"names":["_sfc_main","EyeIcon","EyeOffIcon","_hoisted_1","_createElementBlock","$options","_ctx","$props","_createBlock","_component_eye_icon","_component_eye_off_icon","formatListMixin","taskMixin","AddComment","AddPreviewModal","ChevronDownIcon","ChevronLeftIcon","ChevronRightIcon","ChevronUpIcon","ComboboxStyled","Comment","CornerLeftUpIcon","DeleteModal","EditCommentModal","EntityThumbnail","KitsuIcon","ImageIcon","PageSubtitle","PeopleAvatar","PreviewPlayer","Spinner","SubscribeButton","TaskTypeName","ValidationTag","ViewPlaylistModal","mapGetters","assetsStore","editsStore","episodesStore","sequencesStore","shotsStore","a","b","preview","currentPreview","previewId","comment","border","episodeId","getTaskEntityPath","getTaskEntitiesPath","entity","tasks","taskA","taskB","taskTypeA","taskTypeB","getTaskTypePriorityOfProd","tasksLength","previousTaskIndex","taskId","previousTaskId","nextTaskIndex","nextTaskId","entityIndex","previousEntityIndex","nextEntityIndex","type","entityName","taskTypeName","taskType","sortPeople","personId","mapActions","index","result","entityId","taskTypeId","ctaskId","task","err","loadingFunction","callback","attachment","checklist","taskStatusId","revision","link","params","action","drafts","isRetakeError","currentTaskId","currentTaskIndex","keepPreviewFiles","forms","changeRoute","previews","previewPlayer","commentId","p","eventData","extension","section","route","additions","deletions","updates","frame","previewForm","f","c","user","comments","versionRevision","minutes","seconds","milliseconds","files","id","reply","remoteComment","title","_hoisted_2","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_18","_hoisted_20","_hoisted_22","_hoisted_23","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_openBlock","_createElementVNode","_hoisted_3","$data","_hoisted_4","_createVNode","_component_router_link","_withCtx","_component_corner_left_up_icon","_component_chevron_left_icon","_createCommentVNode","_component_chevron_right_icon","_component_task_type_name","_component_entity_thumbnail","_createTextVNode","_toDisplayString","_component_validation_tag","_hoisted_10","_Fragment","_renderList","person","_component_people_avatar","_component_subscribe_button","_component_chevron_up_icon","_component_chevron_down_icon","_hoisted_11","_hoisted_15","_component_combobox_styled","_cache","$event","_hoisted_16","_hoisted_17","args","_component_kitsu_icon","_normalizeClass","_component_image_icon","_hoisted_19","_component_view_playlist_modal","_hoisted_21","_component_preview_player","_component_page_subtitle","_hoisted_24","_hoisted_41","_component_add_comment","_hoisted_42","_component_XyzTransitionGroup","_component_comment","_hoisted_43","_hoisted_44","_component_spinner","_component_add_preview_modal","_component_edit_comment_modal","_component_delete_modal"],"mappings":"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"}