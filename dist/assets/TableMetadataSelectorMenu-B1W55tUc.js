import{d as g}from"./vuedraggable.umd-DaNNd7iu.js";import{_ as k,a as D,b as M,r as f,o as l,c as n,d as i,t as c,F as p,e as _,H as h,h as V,g as b,w as x,f as C,i as S}from"./index-DF-DoQlt.js";import{G as T}from"./grip-vertical-BnOzHbNG.js";const N={name:"table-metadata-selector-menu",components:{draggable:g,GripVerticalIcon:T},props:{descriptors:{type:Array,required:!0},exclude:{type:Object,default:()=>{}},modelValue:{type:Object,required:!0},namespace:{type:String,required:!0}},emits:["update:modelValue"],data(){return{fieldToName:{estimation:this.$t("main.estimation"),fps:this.$t("main.fps"),frameIn:this.$t("main.frame_in"),frameOut:this.$t("main.frame_out"),frames:this.$t("main.frames"),readyFor:this.$t("assets.fields.ready_for"),timeSpent:this.$t("main.timeSpent"),resolution:this.$t("shots.fields.resolution"),stdby:this.$t("breakdown.fields.standby"),maxRetakes:this.$t("shots.fields.max_retakes")},sortedMetadataDescriptors:[]}},created(){const t=localStorage.getItem(this.localStorageKey);let e={...this.modelValue};t&&(e={...e,...JSON.parse(t)});for(const a of this.descriptors)e[a.field_name]===void 0&&(e[a.field_name]=!0);this.$emit("update:modelValue",e),this.sortedMetadataDescriptors=[...this.filteredMetadataDescriptors]},watch:{filteredMetadataDescriptors:{handler(t){(this.sortedMetadataDescriptors.length===0||this.sortedMetadataDescriptors.length!==t.length)&&(this.sortedMetadataDescriptors=[...t])},immediate:!0}},computed:{...M(["currentProduction","isCurrentUserManager"]),localStorageKey(){return`metadataDisplayHeaders:${this.namespace}`},fixedColumns(){const t=[];for(const e in this.modelValue)this.fieldToName[e]&&t.push({field_name:e,name:this.fieldToName[e],isFixed:!0});return t},filteredFixedColumns(){return this.fixedColumns.filter(t=>!this.exclude[t.field_name])},filteredMetadataDescriptors(){return this.descriptors.filter(e=>!this.exclude[e.field_name]).sort((e,a)=>{const m=e.position??1e3,o=a.position??1e3;if(m!==o)return m-o;const r=e.name||"",u=a.name||"";return r.localeCompare(u)})},entityType(){return this.descriptors.find(e=>e.entity_type)?.entity_type||null}},methods:{...D(["reorderMetadataDescriptors"]),setMetadataDisplayValue(t,e){const a={...this.modelValue};a[t]=e,localStorage.setItem(this.localStorageKey,JSON.stringify(a)),this.$emit("update:modelValue",a)},onDragEnd(){const t=this.sortedMetadataDescriptors.filter(e=>e.id).map(e=>e.id);this.currentProduction?.id&&this.entityType&&t.length>0&&this.reorderMetadataDescriptors({entityType:this.entityType,descriptorIds:t}).catch(e=>{console.error("Failed to reorder metadata descriptors:",e)})}}},v={class:"checkbox"},E=["checked","onChange"],F={key:0,class:"column-separator immutable-column"},B={class:"flexrow"},I={class:"drag-handle"},w={class:"checkbox"},H=["checked","onChange"],O={class:"checkbox"},A=["checked","onChange"];function G(t,e,a,m,o,r){const u=f("grip-vertical-icon"),y=f("draggable");return l(),n("div",{class:"column-menu",style:S({top:a.namespace==="breakdown"?"30px":"40px"})},[i("h2",null,c(t.$t("main.column_visibility")),1),i("ul",null,[(l(!0),n(p,null,_(r.filteredFixedColumns,s=>(l(),n("li",{key:s.field_name,class:"immutable-column"},[i("label",v,[i("input",{type:"checkbox",checked:a.modelValue&&a.modelValue[s.field_name]!==!1,onChange:d=>r.setMetadataDisplayValue(s.field_name,d.target.checked)},null,40,E),h(" "+c(s.name),1)])]))),128)),r.filteredMetadataDescriptors.length>0?(l(),n("li",F,e[1]||(e[1]=[i("hr",null,null,-1)]))):V("",!0),t.isCurrentUserManager?(l(),b(y,{key:1,modelValue:o.sortedMetadataDescriptors,"onUpdate:modelValue":e[0]||(e[0]=s=>o.sortedMetadataDescriptors=s),"item-key":"field_name",handle:".drag-handle",onEnd:r.onDragEnd},{item:x(({element:s})=>[i("li",null,[i("div",B,[i("span",I,[C(u)]),i("label",w,[i("input",{type:"checkbox",checked:a.modelValue&&a.modelValue[s.field_name]!==!1,onChange:d=>r.setMetadataDisplayValue(s.field_name,d.target.checked)},null,40,H),h(" "+c(s.name),1)])])])]),_:1},8,["modelValue","onEnd"])):(l(!0),n(p,{key:2},_(r.filteredMetadataDescriptors,s=>(l(),n("li",{key:s.field_name},[i("label",O,[i("input",{type:"checkbox",checked:a.modelValue&&a.modelValue[s.field_name]!==!1,onChange:d=>r.setMetadataDisplayValue(s.field_name,d.target.checked)},null,40,A),h(" "+c(s.name),1)])]))),128))])],4)}const j=k(N,[["render",G],["__scopeId","data-v-00b72c4e"]]);export{j as T};
//# sourceMappingURL=TableMetadataSelectorMenu-B1W55tUc.js.map
