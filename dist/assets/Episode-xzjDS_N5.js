import{_ as O,s as W,B as j,M as G,N as J,O as K,E as X,R as x,P as H,U as Q,W as Y,T as Z,J as $,X as ee,m as te,b as se,b2 as T,b3 as ie,r as n,o,c as l,e as s,f as d,w as f,l as m,d as u,n as p,$ as h,t as r,F as g,g as E,a3 as oe}from"./index-a83mlrHR.js";import{e as ne,E as re,a as ae,b as le,c as de}from"./EntityTaskList-B9dcjub7.js";import{E as ce}from"./EditEpisodeModal-BCCzcBV4.js";import{E as ue}from"./EntityChat-C4bUpTZp.js";import"./PeopleNameCell-Bt4xdgU8.js";const pe={name:"episode",mixins:[ne,W],components:{ButtonSimple:j,ComboboxNumber:G,CornerLeftUpIcon:J,DescriptionCell:K,EditEpisodeModal:ce,EntityChat:ue,EntityNews:re,EntityPreviewFiles:ae,EntityTaskList:le,EntityTimeLogs:de,EntityThumbnail:X,PageSubtitle:x,PageTitle:H,RouteSectionTabs:Q,Schedule:Y,TableInfo:Z,TaskInfo:$,TaskTypeName:ee},data(){return{type:"episode",currentEpisode:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...te(["currentProduction","getTaskTypePriority","episodeMap","episodeMetadataDescriptors","episodeSearchText","isCurrentUserManager","route","taskMap","taskTypeMap"]),title(){return this.currentEpisode?`${this.currentEpisode.name}`:"Loading..."},currentEntity(){return this.currentEpisode},getEpisodesRoute(){const e={name:"episodes",params:{production_id:this.currentProduction.id,project_id:this.currentProduction.id},query:{search:this.episodeSearchText}};return e.name="episodes",e},nbAssets(){let e=0;return this.currentEpisode&&this.currentSection==="casting"&&this.currentEpisode.castingAssetsByType&&this.currentEpisode.castingAssetsByType.forEach(i=>{e+=i.length}),e}},methods:{...se(["clearSelectedTasks","editEpisode","setCurrentEpisode","loadEpisodesWithTasks","loadEpisodeCasting"]),init(){this.loadCurrentEpisode().then(e=>{this.currentEpisode=e,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentEpisode?this.loadEpisodeCasting(this.currentEpisode).then(()=>{this.casting.isLoading=!1}).catch(i=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(i)}):this.resetData()}).catch(console.error)},async loadCurrentEpisode(){const e=this.route.params.episode_id,i=T.cache.episodeMap.get(e)||null;return!i||!i.validations?(await this.loadEpisodesWithTasks(),T.episodeMap.get(e)||null):i},confirmEditEpisode(e){e.id=this.currentEpisode.id,this.loading.edit=!0,this.errors.edit=!1,this.editEpisode(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const i=this.currentEpisode.id,y={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return ie(y,i)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentEpisode().then(e=>(this.currentEpisode=e,this.loadEpisodeCasting(this.currentEpisode))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},he={class:"columns fixed-page episode xyz-in",xyz:"fade"},me={class:"column main-column"},_e={class:"page-header flexrow"},ye={class:"flexrow-item ml2"},fe={class:"flexrow-item"},ge={class:"episode-data block"},Ee={class:"flexrow infos"},ke={class:"flexrow-item flexcolumn entity-infos"},be={class:"flexrow"},ve={class:"flexrow-item has-text-right"},we={class:"table-body"},Te={key:0,class:"datatable no-header"},Se={class:"table-body"},Ce={class:"datatable-row"},Le={class:"field-label"},Me={key:0,class:"datatable-row"},Be={class:"field-label"},ze={class:"field-label"},Pe={class:"flexrow"},De={class:"episode-casting"},Ne={key:0},Ie={key:0},Re={class:"asset-type"},Ae={class:"asset-list"},Ve={class:"break-word"},Ue={key:0},qe={class:"ready-for flexrow"},Fe={key:1,class:"mt1"},Oe={key:0,class:"schedule mt1"},We={class:"wrapper"},je={class:"column side-column"};function Ge(e,i,y,Je,t,_){var w;const S=n("corner-left-up-icon"),k=n("router-link"),b=n("entity-thumbnail"),C=n("page-title"),L=n("route-section-tabs"),v=n("page-subtitle"),M=n("entity-task-list"),B=n("button-simple"),z=n("description-cell"),P=n("combobox-number"),D=n("task-type-name"),N=n("table-info"),I=n("schedule"),R=n("entity-chat"),A=n("entity-preview-files"),V=n("entity-time-logs"),U=n("entity-news"),q=n("task-info"),F=n("edit-episode-modal");return o(),l("div",he,[s("div",me,[s("div",_e,[d(k,{class:"flexrow-item has-text-centered back-link",to:_.getEpisodesRoute},{default:f(()=>[d(S)]),_:1},8,["to"]),s("span",ye,[t.currentEpisode?(o(),m(b,{key:0,class:"entity-thumbnail",entity:t.currentEpisode,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):u("",!0)]),s("div",fe,[d(C,{text:_.title,class:"entity-title"},null,8,["text"])])]),s("div",ge,[d(L,{class:"section-tabs","active-tab":e.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),p(s("div",Ee,[s("div",ke,[d(v,{text:e.$t("main.tasks")},null,8,["text"]),d(M,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentEpisode,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",be,[d(v,{text:e.$t("main.info")},null,8,["text"]),i[3]||(i[3]=s("div",{class:"filler"},null,-1)),s("div",ve,[e.isCurrentUserManager?(o(),m(B,{key:0,icon:"edit",onClick:i[0]||(i[0]=a=>t.modals.edit=!0)})):u("",!0)])]),s("div",we,[t.currentEpisode?(o(),l("table",Te,[s("tbody",Se,[s("tr",Ce,[s("td",Le,r(e.$t("shots.fields.description")),1),d(z,{entry:t.currentEpisode,full:!0},null,8,["entry"])]),t.currentEpisode&&t.currentEpisode.data&&t.currentEpisode.data.resolution?(o(),l("tr",Me,[s("td",Be,r(e.$t("shots.fields.resolution")),1),s("td",null,r(t.currentEpisode?t.currentEpisode.data.resolution:""),1)])):u("",!0),(o(!0),l(g,null,E(e.episodeMetadataDescriptors,a=>(o(),l("tr",{key:a.id,class:"datatable-row"},[s("td",ze,r(a.name),1),s("td",null,r(t.currentEpisode.data?t.currentEpisode.data[a.field_name]:""),1)]))),128))])])):u("",!0)])])],512),[[h,e.currentSection==="infos"]]),s("div",Pe,[p(s("span",null,r(_.nbAssets)+" "+r(e.$tc("assets.number",_.nbAssets)),513),[[h,e.currentSection==="casting"]]),p(s("span",{class:"tag tag-standby"},r(e.$t("breakdown.fields.standby")),513),[[h,e.currentSection==="casting"&&t.currentEpisode.is_casting_standby]]),i[4]||(i[4]=s("div",{class:"filler"},null,-1)),p(s("span",{class:"flexrow-item mt05"},r(e.$t("schedule.zoom_level"))+": ",513),[[h,e.currentSection==="schedule"]]),p(d(P,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":i[1]||(i[1]=a=>e.zoomLevel=a)},null,8,["options","modelValue"]),[[h,e.currentSection==="schedule"]])]),p(s("div",De,[t.currentEpisode?(o(),l("div",Ne,[t.currentEpisode&&t.currentEpisode.castingAssetsByType&&t.currentEpisode.castingAssetsByType[0].length>0?(o(),l("div",Ie,[(o(!0),l(g,null,E(t.currentEpisode.castingAssetsByType,a=>(o(),l("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Re,r(a.length>0?a[0].asset_type_name:"")+" ("+r(a.length)+") ",1),s("div",Ae,[(o(!0),l(g,null,E(a,c=>(o(),m(k,{class:"asset-link",key:c.id,to:_.buildAssetRoute(c)},{default:f(()=>[d(b,{class:"entity-thumbnail",entity:c,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",Ve,[oe(r(c.asset_name)+" ",1),c.nb_occurences>1?(o(),l("span",Ue," ("+r(c.nb_occurences)+") ",1)):u("",!0)]),s("div",qe,[c.ready_for?(o(),m(D,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(c.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(c.ready_for).name},null,8,["task-type","current-production-id","title"])):u("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(o(),l("div",Fe,r(e.$t("episodes.no_casting")),1))])):(o(),m(N,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[h,e.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?p((o(),l("div",Oe,[s("div",We,[d(I,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[h,e.currentSection==="schedule"]]):p((o(),l("div",{key:1,class:"mt1"},r(e.$t("main.empty_schedule")),513)),[[h,e.currentSection==="schedule"]]),e.currentSection==="chat"?(o(),m(R,{key:2,entity:t.currentEpisode,name:(w=t.currentEpisode)==null?void 0:w.name},null,8,["entity","name"])):u("",!0),e.currentSection==="preview-files"?(o(),m(A,{key:3,entity:t.currentEpisode},null,8,["entity"])):u("",!0),e.currentSection==="time-logs"?(o(),m(V,{key:4,entity:t.currentEpisode},null,8,["entity"])):u("",!0)])]),p(s("div",je,[d(q,{task:t.currentTask,"entity-type":"Episode","with-actions":""},{default:f(()=>[d(U,{class:"news-column",entity:t.currentEpisode},null,8,["entity"])]),_:1},8,["task"])],512),[[h,e.currentSection==="infos"]]),d(F,{ref:"edit-episode-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"episode-to-edit":t.currentEpisode,onCancel:i[2]||(i[2]=a=>t.modals.edit=!1),onConfirm:_.confirmEditEpisode},null,8,["active","is-loading","is-error","episode-to-edit","onConfirm"])])}const Ye=O(pe,[["render",Ge],["__scopeId","data-v-6edf0adc"]]);export{Ye as default};
//# sourceMappingURL=Episode-xzjDS_N5.js.map
