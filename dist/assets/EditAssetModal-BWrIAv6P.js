import{_ as g,M as v,b as S,r as m,q as F,o as a,c as d,d as l,t as r,I as c,f as u,g as T,h as f,k as A,O as _,F as O,e as x,n as p}from"./index-DF-DoQlt.js";import{C as B}from"./Combobox-A6pnhVs3.js";import{C as M}from"./ComboboxBoolean-DT116Lfu.js";import{M as w}from"./BuildFilterModal-C18AF9bI.js";import{T as I}from"./TextField-BKWlN2Ov.js";import{T as U}from"./TextareaField-BVvnEY8u.js";const D={name:"edit-asset-modal",mixins:[v],components:{Combobox:B,ComboboxBoolean:M,MetadataField:w,TextField:I,TextareaField:U},props:{active:{type:Boolean,default:!1},text:{type:String,default:""},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isLoadingStay:{type:Boolean,default:!1},isSuccess:{type:Boolean,default:!1},assetToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm","confirm-and-stay"],data(){return{form:{name:"",description:"",source_id:null,data:{resolution:""},is_shared:"false"},assetSuccessText:""}},mounted(){this.resetForm(),this.assetSuccessText=""},computed:{...S(["assets","assetCreated","assetMetadataDescriptors","assetTypes","currentProduction","currentEpisode","episodes","isTVShow","productionAssetTypes","productionAssetTypeOptions","openProductions"]),resolution(){return this.assetToEdit.data?.resolution||""},episodeOptions(){const e=this.episodes.map(t=>({label:t.name,value:t.id}));return this.currentProduction.production_style!=="video-game"&&e.unshift({label:this.$t("main.main_pack"),value:"null"}),e}},methods:{runConfirmation(){this.form.name.length>0&&(this.isEditing()?this.confirmClicked():this.confirmAndStayClicked())},focusName(){this.$refs.nameField.focus()},confirmAndStayClicked(){this.$emit("confirm-and-stay",{...this.form,is_shared:this.form.is_shared==="true"})},confirmClicked(){this.$emit("confirm",{...this.form,is_shared:this.form.is_shared==="true"})},isEditing(){return this.assetToEdit&&this.assetToEdit.id},getEntityTypeIdDefaultValue(){let e=this.assetToEdit.asset_type_id;return e||(e=this.productionAssetTypeOptions[0]?.value),this.productionAssetTypeOptions.some(o=>o.value===e)||(e=this.productionAssetTypeOptions[0]?.value),e},resetForm(){if(!this.isEditing())!this.form.entity_type_id&&this.productionAssetTypeOptions[0]&&(this.form.entity_type_id=this.productionAssetTypeOptions[0].value),this.openProductions.length>0&&(this.form.project_id=this.currentProduction?this.currentProduction.id:""),this.form.name="",this.form.description="",this.form.source_id=this.currentEpisode?this.currentEpisode.id:null,this.form.data={},this.form.is_shared="false";else{const e=this.getEntityTypeIdDefaultValue();this.form={entity_type_id:e,project_id:this.assetToEdit.project_id,name:this.assetToEdit.name,description:this.assetToEdit.description,source_id:this.assetToEdit.source_id||this.assetToEdit.episode_id,data:{...this.assetToEdit.data,resolution:this.assetToEdit.data.resolution||""},is_shared:String(this.assetToEdit.is_shared===!0)}}}},watch:{assetToEdit(){this.resetForm()},assetCreated(){this.isEditing()?this.assetSuccessText=this.$t("assets.edit_success",{name:this.assetCreated}):this.assetSuccessText=this.$t("assets.new_success",{name:this.assetCreated})},active(){this.assetSuccessText="",this.resetForm(),this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},currentProduction(){this.form.entity_type_id=null,this.resetForm()}}},P={class:"modal-content"},L={class:"box"},j={key:0,class:"title"},N={key:1,class:"title"},K={class:"has-text-right"},q={key:1,class:"error has-text-right info-message"},z={key:2,class:"success has-text-right info-message"};function G(e,t,o,H,i,n){const h=m("combobox"),y=m("text-field"),E=m("textarea-field"),b=m("metadata-field"),C=m("combobox-boolean"),V=F("focus");return a(),d("div",{class:p({modal:!0,"is-active":o.active})},[l("div",{class:"modal-background",onClick:t[0]||(t[0]=s=>e.$emit("cancel"))}),l("div",P,[l("div",L,[o.assetToEdit&&o.assetToEdit.id?(a(),d("h1",j,r(e.$t("assets.edit_title"))+" "+r(o.assetToEdit.name),1)):(a(),d("h1",N,r(e.$t("assets.new_asset")),1)),l("form",{onSubmit:t[7]||(t[7]=c(()=>{},["prevent"]))},[u(h,{label:e.$t("assets.fields.type"),options:e.productionAssetTypeOptions,modelValue:i.form.entity_type_id,"onUpdate:modelValue":t[1]||(t[1]=s=>i.form.entity_type_id=s)},null,8,["label","options","modelValue"]),e.isTVShow?(a(),T(h,{key:0,label:e.$t("assets.fields.episode"),options:n.episodeOptions,modelValue:i.form.source_id,"onUpdate:modelValue":t[2]||(t[2]=s=>i.form.source_id=s)},null,8,["label","options","modelValue"])):f("",!0),A(u(y,{ref:"nameField",label:e.$t("assets.fields.name"),modelValue:i.form.name,"onUpdate:modelValue":t[3]||(t[3]=s=>i.form.name=s),modelModifiers:{trim:!0},onEnter:n.runConfirmation},null,8,["label","modelValue","onEnter"]),[[V]]),u(E,{ref:"descriptionField",label:e.$t("assets.fields.description"),modelValue:i.form.description,"onUpdate:modelValue":t[4]||(t[4]=s=>i.form.description=s),onKeyup:[_(c(n.runConfirmation,["ctrl"]),["enter"]),_(c(n.runConfirmation,["meta"]),["enter"])]},null,8,["label","modelValue","onKeyup"]),u(y,{ref:"resolutionField",label:e.$t("shots.fields.resolution"),modelValue:i.form.data.resolution,"onUpdate:modelValue":t[5]||(t[5]=s=>i.form.data.resolution=s),onEnter:n.runConfirmation},null,8,["label","modelValue","onEnter"]),o.assetToEdit?(a(!0),d(O,{key:1},x(e.assetMetadataDescriptors,s=>(a(),T(b,{key:s.id,descriptor:s,entity:o.assetToEdit,onEnter:n.runConfirmation,modelValue:i.form.data[s.field_name],"onUpdate:modelValue":k=>i.form.data[s.field_name]=k},null,8,["descriptor","entity","onEnter","modelValue","onUpdate:modelValue"]))),128)):f("",!0),u(C,{label:e.$t("assets.fields.shared"),modelValue:i.form.is_shared,"onUpdate:modelValue":t[6]||(t[6]=s=>i.form.is_shared=s),onEnter:n.runConfirmation},null,8,["label","modelValue","onEnter"])],32),l("div",K,[!o.assetToEdit||!o.assetToEdit.id?(a(),d("a",{key:0,class:p({button:!0,"is-primary":!0,"is-loading":o.isLoadingStay}),onClick:t[8]||(t[8]=(...s)=>n.confirmAndStayClicked&&n.confirmAndStayClicked(...s))},r(e.$t("main.confirmation_and_stay")),3)):f("",!0),l("a",{class:p({button:!0,"is-primary":!0,"is-loading":o.isLoading}),onClick:t[9]||(t[9]=(...s)=>n.confirmClicked&&n.confirmClicked(...s))},r(e.$t("main.confirmation")),3),l("button",{class:"button is-link",onClick:t[10]||(t[10]=s=>e.$emit("cancel"))},r(e.$t("main.close")),1),o.isError?(a(),d("p",q,r(e.$t("assets.edit_fail")),1)):f("",!0),o.isSuccess?(a(),d("p",z,r(i.assetSuccessText),1)):f("",!0)])])])],2)}const Z=g(D,[["render",G],["__scopeId","data-v-3141819a"]]);export{Z as E};
//# sourceMappingURL=EditAssetModal-BWrIAv6P.js.map
