import{_ as v,m as g,ac as p,ad as C,af as y,ah as T,r as m,j as k,k as I,o as u,w as H,e as s,f as d,ai as V,l as D,d as E,T as x,a4 as B,c as w,t as l,F as L,g as A,n as F,a as $,a9 as N,aa as M,ab as U}from"./index-qtxoT1kv.js";import{B as j}from"./BaseModal-rMDujnTR.js";import{L as q}from"./ListPageHeader-B5yiuXnY.js";import{R as P}from"./RouteTabs-B2vuzzZ4.js";const R={name:"edit-hardware-item-modal",mixins:[T],components:{BaseModal:j,ComboboxBoolean:y,ModalFooter:C,TextField:p},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},hardwareItemToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{name:"",archived:"false"}}},mounted(){this.loadHardwareItems()},computed:{isEditing(){return!!this.hardwareItemToEdit?.id},modalTitle(){return this.isEditing?this.$t("hardware_items.edit_title")+" "+this.hardwareItemToEdit.name:this.$t("hardware_items.new_hardware_item")}},methods:{...g(["loadHardwareItems"]),runConfirmation(){this.$emit("confirm",this.form)},resetForm(){this.hardwareItemToEdit.id?this.form={name:this.hardwareItemToEdit.name,short_name:this.hardwareItemToEdit.short_name,monthly_cost:this.hardwareItemToEdit.monthly_cost,inventory_amount:this.hardwareItemToEdit.inventory_amount,archived:String(this.hardwareItemToEdit.archived===!0)}:this.form={name:"",short_name:"",monthly_cost:0,inventory_amount:0,archived:"false"}}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField?.focus()},100)},hardwareItemToEdit(){this.resetForm()}}};function S(e,t,i,c,a,r){const h=m("text-field"),f=m("combobox-boolean"),o=m("modal-footer"),_=m("base-modal"),b=k("focus");return u(),I(_,{active:i.active,title:r.modalTitle,onCancel:t[7]||(t[7]=n=>e.$emit("cancel"))},{default:H(()=>[s("form",{onSubmit:t[5]||(t[5]=V(()=>{},["prevent"]))},[D(d(h,{ref:"nameField",label:e.$t("hardware_items.fields.name"),maxlength:30,modelValue:a.form.name,"onUpdate:modelValue":t[0]||(t[0]=n=>a.form.name=n),onEnter:r.runConfirmation},null,8,["label","modelValue","onEnter"]),[[b]]),d(h,{label:e.$t("hardware_items.fields.short_name"),onEnter:r.runConfirmation,modelValue:a.form.short_name,"onUpdate:modelValue":t[1]||(t[1]=n=>a.form.short_name=n)},null,8,["label","onEnter","modelValue"]),d(h,{label:e.$t("hardware_items.fields.monthly_cost"),type:"number",onEnter:r.runConfirmation,modelValue:a.form.monthly_cost,"onUpdate:modelValue":t[2]||(t[2]=n=>a.form.monthly_cost=n)},null,8,["label","onEnter","modelValue"]),d(h,{label:e.$t("hardware_items.fields.inventory_amount"),type:"number",onEnter:r.runConfirmation,modelValue:a.form.inventory_amount,"onUpdate:modelValue":t[3]||(t[3]=n=>a.form.inventory_amount=n)},null,8,["label","onEnter","modelValue"]),r.isEditing?(u(),I(f,{key:0,label:e.$t("main.archived"),onEnter:r.runConfirmation,modelValue:a.form.archived,"onUpdate:modelValue":t[4]||(t[4]=n=>a.form.archived=n)},null,8,["label","onEnter","modelValue"])):E("",!0)],32),d(o,{"error-text":e.$t("hardware_items.create_error"),"is-error":i.isError,"is-loading":i.isLoading,onConfirm:r.runConfirmation,onCancel:t[6]||(t[6]=n=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])]),_:1},8,["active","title"])}const O=v(R,[["render",S],["__scopeId","data-v-17f52bd1"]]),z={name:"hardware-item-list",components:{RowActionsCell:B,TableInfo:x},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},remainingHardwareItems:{type:Object,default:()=>{}}},emits:["delete-clicked","edit-clicked"]},G={class:"data-list"},K={class:"datatable-wrapper"},J={class:"datatable"},Q={class:"datatable-head"},W={scope:"col",class:"name"},X={scope:"col",class:"short-name"},Y={scope:"col",class:"monthly-cost number-cell"},Z={scope:"col",class:"inventory-amount number-cell"},ee={scope:"col",class:"remaining-amount number-cell"},te={key:0,class:"datatable-body"},ae={class:"name"},re={class:"short-name"},ie={class:"monthly-cost number-cell"},se={class:"inventory-amount number-cell"},oe={class:"has-text-centered nb-hardware-items"};function ne(e,t,i,c,a,r){const h=m("row-actions-cell"),f=m("table-info");return u(),w("div",G,[s("div",K,[s("table",J,[s("thead",Q,[s("tr",null,[s("th",W,l(e.$t("hardware_items.fields.name")),1),s("th",X,l(e.$t("hardware_items.fields.short_name")),1),s("th",Y,l(e.$t("hardware_items.fields.monthly_cost")),1),s("th",Z,l(e.$t("hardware_items.fields.inventory_amount")),1),s("th",ee,l(e.$t("hardware_items.fields.remaining_amount")),1),t[0]||(t[0]=s("th",{scope:"col",class:"actions"},null,-1))])]),i.entries.length>0?(u(),w("tbody",te,[(u(!0),w(L,null,A(i.entries,o=>(u(),w("tr",{class:"datatable-row",key:o.id},[s("td",ae,l(o.name),1),s("td",re,l(o.short_name),1),s("td",ie,l(o.monthly_cost),1),s("td",se,l(o.inventory_amount),1),s("td",{class:F([{negative:i.remainingHardwareItems[o.id]<0},"remaining-amount number-cell"])},l(i.remainingHardwareItems[o.id]),3),d(h,{onEditClicked:_=>e.$emit("edit-clicked",o),onDeleteClicked:_=>e.$emit("delete-clicked",o)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):E("",!0)])]),d(f,{"is-loading":i.isLoading,"is-error":i.isError},null,8,["is-loading","is-error"]),s("p",oe,l(i.entries.length)+" "+l(e.$tc("hardware_items.number",i.entries.length)),1)])}const le=v(z,[["render",ne],["__scopeId","data-v-a62e40fa"]]),de={name:"hardware-items",components:{DeleteModal:N,EditHardwareItemModal:O,HardwareItemList:le,ListPageHeader:q,RouteTabs:P},data(){return{activeTab:"active",choices:[],hardwareItemToDelete:null,hardwareItemToEdit:{},linkedHardwareItems:{},errors:{del:!1,edit:!1,list:!1},modals:{del:!1,edit:!1},loading:{del:!1,edit:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.linkedHardwareItems=await this.loadLinkedHardwareItems()},computed:{...$(["activePeople","hardwareItems","archivedHardwareItems"]),isActiveTab(){return this.activeTab==="active"},hardwareItemsList(){return this.isActiveTab?this.hardwareItems:this.archivedHardwareItems},deleteText(){const e=this.hardwareItemToDelete;return e?this.$t("hardware_items.delete_text",{name:e.name}):""},usedAmounts(){const e={};return this.activePeople.forEach(t=>{t.departments.forEach(i=>{(this.linkedHardwareItems[i]||[]).forEach(a=>{e[a.id]||(e[a.id]=0),e[a.id]+=1})})}),e},remainingHardwareItems(){const e={};return this.hardwareItems.forEach(t=>{e[t.id]=t.inventory_amount-(this.usedAmounts[t.id]||0)}),e}},methods:{...g(["deleteHardwareItem","editHardwareItem","newHardwareItem","loadHardwareItems","loadLinkedHardwareItems"]),confirmEditHardwareItem(e){let t="newHardwareItem";this.hardwareItemToEdit&&this.hardwareItemToEdit.id&&(t="editHardwareItem",e.id=this.hardwareItemToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this[t](e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteHardwareItem(){this.loading.del=!0,this.errors.del=!1,this.deleteHardwareItem(this.hardwareItemToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(e=>{console.error(e),this.errors.del=!0,this.loading.del=!1})},onExportClicked(){const e=M.slugify(this.$t("hardware_items.title")),i=[[this.$t("main.type"),this.$t("hardware_items.fields.name"),this.$t("hardware_items.fields.short_name"),this.$t("hardware_items.fields.monthly_cost"),this.$t("hardware_items.fields.inventory_amount")]].concat(this.hardwareItems.map(c=>[c.type,c.name,c.short_name,c.monthly_cost,c.inventory_amount]));U.buildCsvFile(e,i)},onNewClicked(){this.hardwareItemToEdit={},this.errors.edit=!1,this.modals.edit=!0},onEditClicked(e){this.hardwareItemToEdit=e,this.errors.edit=!1,this.modals.edit=!0},onDeleteClicked(e){this.hardwareItemToDelete=e,this.errors.del=!1,this.modals.del=!0}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("hardware_items.title")} - Kitsu`}}},me={class:"hardware-items page fixed-page"};function ce(e,t,i,c,a,r){const h=m("list-page-header"),f=m("route-tabs"),o=m("hardware-item-list"),_=m("edit-hardware-item-modal"),b=m("delete-modal");return u(),w("div",me,[d(h,{title:e.$t("hardware_items.title"),"new-entry-label":e.$t("hardware_items.new_hardware_item"),"is-exportable":r.isActiveTab,onExportClicked:r.onExportClicked,onNewClicked:r.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),d(f,{class:"mt2","active-tab":a.activeTab,tabs:a.tabs},null,8,["active-tab","tabs"]),d(o,{class:"hardware-item-list",entries:r.hardwareItemsList,"is-loading":a.loading.list,"is-error":a.errors.list,"remaining-hardware-items":r.remainingHardwareItems,onEditClicked:r.onEditClicked,onDeleteClicked:r.onDeleteClicked},null,8,["entries","is-loading","is-error","remaining-hardware-items","onEditClicked","onDeleteClicked"]),d(_,{active:a.modals.edit,"is-loading":a.loading.edit,"is-error":a.errors.edit,"hardware-item-to-edit":a.hardwareItemToEdit,onCancel:t[0]||(t[0]=n=>a.modals.edit=!1),onConfirm:r.confirmEditHardwareItem},null,8,["active","is-loading","is-error","hardware-item-to-edit","onConfirm"]),d(b,{active:a.modals.del,"is-loading":a.loading.del,"is-error":a.errors.del,text:r.deleteText,"error-text":e.$t("hardware_items.delete_error"),onCancel:t[1]||(t[1]=n=>a.modals.del=!1),onConfirm:r.confirmDeleteHardwareItem},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const we=v(de,[["render",ce],["__scopeId","data-v-6d2dfcd7"]]);export{we as default};
//# sourceMappingURL=HardwareItems-CL2R-58w.js.map
