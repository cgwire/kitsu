import{_ as R,m as L,a as C,u as P,bc as D,i as Q,C as B,b as j,bd as E,r as h,c as l,o as i,e as r,f as a,l as A,b8 as K,t as n,aj as U,d as u,F as f,g as b,n as w,w as I,a8 as y,k as x,be as q,aQ as T,ab as z}from"./index-CxF1GSzp.js";const F=[12,24,48],O={name:"entity-search",components:{Checkbox:E,Combobox:j,ComboboxProduction:B,EntityPreview:Q,SearchIcon:D,Spinner:P},data(){return{isLoading:!1,isLoadingMoreAssets:!1,isLoadingMoreShots:!1,limit:F[0],limitOptions:F.map(e=>({label:e,value:e})),productionId:"",selectedIndex:0,searchQuery:"",searchFilter:{assets:!0,shots:!0,persons:!1},results:{assets:[],shots:[],persons:[]}}},mounted(){window.addEventListener("keydown",this.onKeyDown),this.$route.query.search&&(this.searchQuery=this.$route.query.search),this.searchField.focus()},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},computed:{...C(["openProductions","productionMap"]),searchField(){return this.$refs["search-field"]},flattenResults(){let e=[];return this.searchFilter.assets&&(e=e.concat(this.results.assets)),this.searchFilter.shots&&(e=e.concat(this.results.shots)),this.searchFilter.persons&&(e=e.concat(this.results.persons)),e},noSearchFilters(){return!this.searchFilter.assets&&!this.searchFilter.shots},productionList(){return[{id:"",name:this.$t("main.all")}].concat([...this.openProductions])}},methods:{...L(["searchData"]),onKeyDown(e){(e.ctrlKey||e.metaKey)&&e.altKey&&e.code==="KeyF"?this.searchField?.focus():e.key==="ArrowDown"?this.selectNext():e.key==="ArrowUp"&&this.selectPrevious()},search(){this.isLoading=!0;const e=Object.entries(this.searchFilter).map(([o,d])=>d?o:void 0).filter(Boolean);this.searchData({query:this.searchQuery,limit:this.limit,productionId:this.productionId,index_names:e}).then(o=>{delete o.persons,this.results=o}).catch(console.error).finally(()=>{this.isLoading=!1})},loadMoreResults(e){const o=[e],d=`isLoadingMore${z.capitalize(e)}`;this[d]=!0,this.searchData({query:this.searchQuery,limit:this.limit,offset:this.results[e].length,productionId:this.productionId,index_names:o}).then(m=>{this.results[e]=this.results[e].concat(m[e])}).catch(console.error).finally(()=>{this[d]=!1})},selectPrevious(){this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.flattenResults.length-1),this.scrollToSelection()},selectNext(){this.selectedIndex++,this.selectedIndex>=this.flattenResults.length&&(this.selectedIndex=0),this.scrollToSelection()},scrollToSelection(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`)?.scrollIntoView(!1)},selectResultById(e){this.selectedIndex=this.flattenResults.findIndex(o=>o.id===e)},onResultSelected(){const e=this.flattenResults[this.selectedIndex];e&&document.getElementById(`result-link-${e.id}`)?.click()},clearSearchResult(){this.results={assets:[],shots:[],persons:[]}},entityPath(e,o){const m=this.productionMap.get(e.project_id).production_type==="tvshow";let t=null;return m&&(t=e.episode_id||"main"),T(e.id,e.project_id,o,t)},personPath(e){return q(e.id)},getMatchDetails(e){const o=e.matched_terms.join(", ");return this.$t("search.match_details",{target:o})}},watch:{productionId(){this.search()},searchQuery(){this.searchQuery.length?this.$router.push({query:{search:this.searchQuery}}):this.$router.push({query:{}}),this.searchQuery.length>2?this.search():this.clearSearchResult(),this.selectedIndex=0}},head(){return{title:`${this.$t("search.title")} - Kitsu`}}},G={class:"entity-search page"},H={class:"search-field"},N={class:"search-icon"},J=["placeholder"],W={class:"search-options pa1 flexrow"},X={class:"flexrow-item no-margin"},Y={class:"search-results mb2"},Z={key:0,class:"has-text-centered"},$={key:1,class:"has-text-centered"},ee={key:2},se={key:3},te={key:0,class:"pb1"},oe={class:"mt0"},ie={key:0,class:"has-text-centered"},le={key:1,class:"result-list"},re=["onMouseover"],ne={class:"production-name"},ce={class:"entity-name"},ae={class:"match"},he={class:"match-icon"},de={key:2,class:"has-text-centered mt2"},ue={key:1,class:"pb1"},me={class:"mt1"},pe={key:0,class:"has-text-centered"},_e={key:1,class:"result-list"},fe=["onMouseover"],ye={class:"production-name"},ge={class:"entity-name"},ve={class:"match"},ke={class:"match-icon"},be={class:"match-details"},we={key:2,class:"has-text-centered mt2"};function Ie(e,o,d,m,t,c){const V=h("combobox-production"),p=h("search-icon"),g=h("checkbox"),M=h("combobox"),_=h("spinner"),v=h("entity-preview"),k=h("router-link");return i(),l("div",G,[r("form",{class:"search-form",onSubmit:o[5]||(o[5]=U(s=>c.onResultSelected(),["prevent"]))},[r("div",null,[a(V,{class:"flexrow-item production-field",label:e.$t("main.production"),"production-list":c.productionList,modelValue:t.productionId,"onUpdate:modelValue":o[0]||(o[0]=s=>t.productionId=s)},null,8,["label","production-list","modelValue"])]),r("div",H,[r("span",N,[a(p,{size:20})]),A(r("input",{ref:"search-field",class:"input",placeholder:e.$t("search.placeholder"),"onUpdate:modelValue":o[1]||(o[1]=s=>t.searchQuery=s)},null,8,J),[[K,t.searchQuery,void 0,{trim:!0}]])]),r("div",W,[a(g,{class:"flexrow-item",toggle:!0,label:e.$t("assets.title"),onChange:c.search,modelValue:t.searchFilter.assets,"onUpdate:modelValue":o[2]||(o[2]=s=>t.searchFilter.assets=s)},null,8,["label","onChange","modelValue"]),a(g,{class:"flexrow-item",toggle:!0,label:e.$t("shots.title"),onChange:c.search,modelValue:t.searchFilter.shots,"onUpdate:modelValue":o[3]||(o[3]=s=>t.searchFilter.shots=s)},null,8,["label","onChange","modelValue"]),o[8]||(o[8]=r("div",{class:"filler"},null,-1)),r("span",X,n(e.$t("search.limit")),1),a(M,{class:"search-limit flexrow-item",options:t.limitOptions,"with-margin":!1,"onUpdate:modelValue":[c.search,o[4]||(o[4]=s=>t.limit=s)],modelValue:t.limit},null,8,["options","onUpdate:modelValue","modelValue"])])],32),r("div",Y,[t.searchQuery.length<3?(i(),l("div",Z,n(e.$t("main.search.type")),1)):c.noSearchFilters?(i(),l("div",$,n(e.$t("main.search.no_filter")),1)):t.isLoading?(i(),l("div",ee,[a(_)])):(i(),l("div",se,[t.searchFilter.assets?(i(),l("div",te,[r("h2",oe,n(e.$t("assets.title"))+" ("+n(t.results.assets?.length||0)+") ",1),t.results.assets?.length?(i(),l("div",le,[(i(!0),l(f,null,b(t.results.assets,s=>(i(),l("div",{class:w(["result flexcolumn",{"selected-result":c.flattenResults[t.selectedIndex]===s}]),key:s.id,onMouseover:S=>c.selectResultById(s.id)},[a(v,{"empty-height":200,"empty-width":300,height:200,width:300,entity:s,"is-rounded-top-border":""},null,8,["entity"]),a(k,{class:"result-description",id:`result-link-${s.id}`,to:c.entityPath(s,"asset")},{default:I(()=>[r("div",ne,n(s.project_name),1),r("div",ce,n(s.asset_type_name)+" / "+n(s.name),1),r("div",ae,[r("span",he,[a(p,{size:15})]),y(" "+n(c.getMatchDetails(s)),1)])]),_:2},1032,["id","to"])],42,re))),128))])):(i(),l("div",ie,n(e.$t("main.search.no_result")),1)),t.results.assets.length!==0&&t.results.assets.length%12===0?(i(),l("p",de,[t.isLoadingMoreAssets?(i(),x(_,{key:1})):(i(),l("button",{key:0,class:"button is-link",onClick:o[6]||(o[6]=s=>c.loadMoreResults("assets"))},n(e.$t("main.load_more")),1))])):u("",!0)])):u("",!0),t.searchFilter.shots?(i(),l("div",ue,[r("h2",me,n(e.$t("shots.title"))+" ("+n(t.results.shots?.length||0)+") ",1),t.results.shots?.length?(i(),l("div",_e,[(i(!0),l(f,null,b(t.results.shots,s=>(i(),l("div",{class:w(["result flexcolumn",{"selected-result":c.flattenResults[t.selectedIndex]===s}]),key:s.id,onMouseover:S=>c.selectResultById(s.id)},[a(v,{"empty-height":200,"empty-width":300,height:200,width:300,entity:s,"is-rounded-top-border":""},null,8,["entity"]),a(k,{class:"result-description",id:`result-link-${s.id}`,to:c.entityPath(s,"shot")},{default:I(()=>[r("div",ye,n(s.project_name),1),r("div",ge,[s.episode_name?(i(),l(f,{key:0},[y(n(s.episode_name)+" / ",1)],64)):u("",!0),y(" "+n(s.sequence_name)+" / "+n(s.name),1)]),r("div",ve,[r("span",ke,[a(p,{size:15})]),r("span",be,n(c.getMatchDetails(s)),1)])]),_:2},1032,["id","to"])],42,fe))),128))])):(i(),l("div",pe,n(e.$t("main.search.no_result")),1)),t.results.shots.length!==0&&t.results.shots.length%12===0?(i(),l("p",we,[t.isLoadingMoreShots?(i(),x(_,{key:1})):(i(),l("button",{key:0,class:"button is-link",onClick:o[7]||(o[7]=s=>c.loadMoreResults("shots"))},n(e.$t("main.load_more")),1))])):u("",!0)])):u("",!0)]))])])}const Fe=R(O,[["render",Ie],["__scopeId","data-v-88c287c3"]]);export{Fe as default};
//# sourceMappingURL=EntitySearch-k8TrRTSc.js.map
