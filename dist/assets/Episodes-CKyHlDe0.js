import{_ as z,E as Q,B as I,a as O,b as R,r,q,o as a,c as l,d as m,f as c,k as N,t as h,g as y,h as d,F as k,e as C,n as E,v as K,w as Y,H as B,i as W,I as G,J,p as X}from"./index-DF-DoQlt.js";import{c as Z}from"./csv-IlynXFQz.js";import{s as j}from"./string-B0Tq569e.js";import{s as $}from"./search-CWIHq9c3.js";import{V as x,T as ee,a as se,M as te,S as ie,C as ae,_ as oe,A as ne,b as le,e as de}from"./SortingInfo-CgBowHF9.js";import{d as re,B as pe}from"./BuildFilterModal-C18AF9bI.js";import{C as me}from"./ComboboxDepartment-Cjj8YvK6.js";import{D as ue}from"./DeleteModal-DwXK5r5w.js";import{E as ce}from"./EditEpisodeModal-DgXHAAlm.js";import{d as he}from"./dom-tO7tlkHV.js";import{e as fe}from"./entity_list-D-byES5y.js";import{f as ye}from"./format-D3oTyBU9.js";import{M as ge,s as ke}from"./MetadataHeader-DNtGPcAE.js";import{D as Ce}from"./DescriptionCell-BohJMv7b.js";import{R as Se}from"./RowActionsCell-DR7b8Q1u.js";import{T as Ee}from"./TableMetadataSelectorMenu-B1W55tUc.js";import{T as Me}from"./TableInfo-D6xnVb4C.js";import{V as De}from"./ValidationCell-BAjZxoUN.js";import{_ as ve}from"./empty_shot-DjP6mzpU.js";import{H as Te}from"./HardDeleteModal-BLE4oONO.js";import{S as be}from"./SearchField-BdP8lRoc.js";import{S as we}from"./SearchQueryList-jldyJweR.js";import Le from"./TaskInfo-C2DOZkHo.js";import"./DepartmentName-DCchDYyW.js";import"./PreviewPlayer-Bpr7Jn1C.js";import"./PlaylistPlayer-ByYDRf10.js";import"./ComboboxSimple-B2TmvsnK.js";import"./ComboboxTaskType-C7Rz0ksS.js";import"./TaskTypeName-C0px4urt.js";import"./ModalFooter-Chk0SGv-.js";import"./TextField-BKWlN2Ov.js";import"./video-Yn96Kb74.js";import"./clipboard-CQqgyZ_h.js";import"./Combobox-A6pnhVs3.js";import"./ComboboxStyled-BlKJF8gk.js";import"./index-Bnig1aiX.js";import"./BaseModal-D3KB-h7q.js";import"./ComboboxStudio-D3qg68ZP.js";import"./play-DUQ3D5JY.js";import"./render-DYxr_jus.js";import"./EmojiButton-CJhEAvTS.js";import"./FileUpload-GCzHM4-i.js";import"./ComboboxStatus-CBgYMSHg.js";import"./ConfirmModal-BIIMruUl.js";import"./triangle-alert-CW28Rlrw.js";import"./ValidationTag-Cx26FfxH.js";import"./thumbs-up-UCZcudrF.js";import"./copy-DgQ7ppWI.js";import"./vue.esm-bundler-pS9-uSLU.js";import"./VideoViewer-B89y-Tko.js";import"./ComboboxBoolean-DT116Lfu.js";import"./check-CO1MD15r.js";import"./ComboboxOptions-CyreNGd5.js";import"./PageTitle-CtScP8aV.js";import"./PeopleField-BoranyvF.js";import"./TextareaField-BVvnEY8u.js";import"./trash-DWKk5Pv9.js";import"./refresh-cw-CYYYI9XK.js";import"./vuedraggable.umd-DaNNd7iu.js";import"./grip-vertical-BnOzHbNG.js";import"./eye-CYjxZyJy.js";import"./BooleanField-r8LThAuD.js";import"./ColorField-ByrVYH4e.js";import"./trash-2-Clb81WsB.js";import"./chevron-up-C5NMcayJ.js";import"./DeleteEntities-5LkT8YiQ.js";import"./corner-right-up-xDF204hE.js";const Ae={name:"episode-list",mixins:[re,he,ye,fe,ke],props:{contactSheetMode:{type:Boolean,default:!1},displayedEpisodes:{type:Array,default:()=>[]},displaySettings:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]},departmentFilter:{type:Array,default:()=>[]}},emits:["create-tasks","delete-clicked","edit-clicked","field-changed","metadata-changed"],data(){return{type:"episode",hiddenColumns:{},lastHeaderMenuDisplayed:null,lastMetadaDataHeaderMenuDisplayed:null,lastHeaderMenuDisplayedIndexInGrid:null,lastSelectedEpisode:null,lastSelection:null,metadataDisplayHeaders:{estimation:!0,timeSpent:!0,status:!0},offsets:{},stickedColumns:{},episodeStatusOptions:[{label:"canceled",value:"canceled"},{label:"complete",value:"complete"},{label:"running",value:"running"},{label:"standby",value:"standby"}]}},components:{ButtonSimple:I,DescriptionCell:Ce,EntityThumbnail:Q,MetadataHeader:ge,MetadataInput:te,RowActionsCell:Se,TableHeaderMenu:se,TableMetadataHeaderMenu:ee,TableMetadataSelectorMenu:Ee,TableInfo:Me,ValidationCell:De,ValidationHeader:x},computed:{...R(["currentProduction","episodeMap","episodeFilledColumns","episodeMetadataDescriptors","episodes","episodeSearchText","episodeSelectionGrid","currentEpisode","displayedEpisodesEstimation","displayedEpisodesLength","displayedEpisodesTimeSpent","displaySettings.bigThumbnails","isCurrentUserAdmin","isCurrentUserManager","isCurrentUserSupervisor","isCurrentUserClient","isSingleEpisode","isEpisodeDescription","isEpisodeEstimation","isEpisodeResolution","isEpisodeTime","displaySettings.showAssignations","displaySettings.showInfos","nbSelectedTasks","selectedTasks","taskMap","taskTypeMap","user"]),isEmptyList(){return this.displayedEpisodes.length&&this.displayedEpisodes[0].length===0&&!this.isLoading&&!this.isError&&(!this.episodeSearchText||this.episodeSearchText.length===0)},isListVisible(){return!this.isLoading&&!this.isError&&this.displayedEpisodesLength>0},displayedValidationColumns(){return this.validationColumns.filter(e=>this.episodeFilledColumns[e]&&(!this.hiddenColumns[e]||this.displaySettings.showInfos))},metadataDescriptors(){return this.episodeMetadataDescriptors},localStorageStickKey(){return`stick-episodes-${this.currentProduction?.id}`}},methods:{...O(["setEpisodeSelection"]),isSelected(e,s){return this.episodeSelectionGrid[e]&&this.episodeSelectionGrid[e][s]},episodePath(e){return this.getPath("episode",e)},getPath(e,s){const o={name:e,params:{production_id:this.currentProduction?.id}};return s&&(o.params.episode_id=s),o},onEpisodeStatusChanged(e,s){this.$emit("field-changed",{entry:e,fieldName:"status",value:s})}},watch:{displayedEpisodes(){this.$options.lineIndex={}},validationColumns(){this.initHiddenColumns(this.validationColumns,this.hiddenColumns)},stickedColumns(){this.updateOffsets()},isLoading(){this.updateOffsets()}}},Ue={class:"data-list"},Ve={class:"datatable"},He={class:"datatable-head",id:"datatable-episode"},Pe={scope:"col",class:"name episode-name datatable-row-header",ref:"th-episode"},Fe={class:"flexrow"},_e={class:"flexrow-item"},Be={key:2,scope:"col",class:"description selectable"},Ne=["title"],ze={key:7,scope:"col",class:"resolution selectable"},Ie={scope:"col",class:"actions",ref:"actionsSection"},Oe={class:"datatable-body"},Re={class:"flexrow"},Ke=["title"],Qe=["title"],qe={key:4,class:"time-spent selectable"},Ye={key:5,class:"estimation selectable"},We={class:"select"},Ge=["onChange"],Je=["value","selected"],Xe={key:7,class:"resolution"},Ze=["value","onInput","onKeyup"],je={key:1,class:"metadata-value selectable"},$e={key:10,class:"actions"},xe={key:0,class:"has-text-centered"},es={class:"info"},ss={key:1,class:"has-text-centered nb-episodes"},ts={key:0};function is(e,s,o,g,i,u){const L=r("table-header-menu"),T=r("table-metadata-header-menu"),M=r("button-simple"),b=r("metadata-header"),w=r("validation-header"),A=r("table-metadata-selector-menu"),U=r("entity-thumbnail"),V=r("router-link"),D=r("metadata-input"),v=r("validation-cell"),H=r("description-cell"),P=r("row-actions-cell"),F=r("table-info"),_=q("columns-resizable");return a(),l("div",Ue,[m("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:s[15]||(s[15]=(...t)=>e.onBodyScroll&&e.onBodyScroll(...t))},[c(L,{ref:"headerMenu","is-minimized":i.hiddenColumns[i.lastHeaderMenuDisplayed],"is-edit-allowed":e.isCurrentUserManager,"is-sticked":i.stickedColumns[i.lastHeaderMenuDisplayed],onMinimizeClicked:s[0]||(s[0]=t=>e.onMinimizeColumnToggled()),onDeleteAllClicked:s[1]||(s[1]=t=>e.onDeleteAllTasksClicked()),onSortByClicked:s[2]||(s[2]=t=>e.onSortByTaskTypeClicked()),onSelectColumn:s[3]||(s[3]=t=>e.onSelectColumn("episode")),onToggleStick:s[4]||(s[4]=t=>e.stickColumnClicked())},null,8,["is-minimized","is-edit-allowed","is-sticked"]),c(T,{ref:"headerMetadataMenu","is-edit-allowed":e.isMetadataColumnEditAllowed(i.lastMetadaDataHeaderMenuDisplayed),"is-sticked":i.stickedColumns[i.lastMetadaDataHeaderMenuDisplayed],onEditClicked:s[5]||(s[5]=t=>e.onEditMetadataClicked()),onDeleteClicked:s[6]||(s[6]=t=>e.onDeleteMetadataClicked()),onSortByClicked:s[7]||(s[7]=t=>e.onSortByMetadataClicked()),onToggleStick:s[8]||(s[8]=t=>e.metadataStickColumnClicked(t))},null,8,["is-edit-allowed","is-sticked"]),m("table",Ve,[N((a(),l("thead",He,[m("tr",null,[m("th",Pe,[m("div",Fe,[m("span",_e,h(e.$t("episodes.fields.name")),1),(e.isCurrentUserManager||e.isCurrentUserSupervisor)&&!o.isLoading?(a(),y(M,{key:0,class:"is-small flexrow-item",icon:"plus",text:"",onClick:e.onAddMetadataClicked},null,8,["onClick"])):d("",!0)])],512),o.displaySettings.showInfos?(a(!0),l(k,{key:0},C(e.stickedVisibleMetadataDescriptors,(t,p)=>(a(),y(b,{ref_for:!0,ref:`editor-${p}`,key:t.id,descriptor:t,left:i.offsets["editor-"+p]?`${i.offsets["editor-"+p]}px`:"0","is-stick":"",style:{"z-index":1001},onShowMetadataHeaderMenu:n=>e.showMetadataHeaderMenu(t.id,n)},null,8,["descriptor","left","onShowMetadataHeaderMenu"]))),128)):d("",!0),o.isLoading?d("",!0):(a(!0),l(k,{key:1},C(e.stickedDisplayedValidationColumns,(t,p)=>(a(),y(w,{ref_for:!0,ref:`validation-${p}`,key:t,"hidden-columns":i.hiddenColumns,"column-id":t,"validation-style":e.getValidationStyle(t),left:i.offsets["validation-"+p]?`${i.offsets["validation-"+p]}px`:"0",type:"editor","is-stick":"",onShowHeaderMenu:n=>e.showHeaderMenu(t,p,n)},null,8,["hidden-columns","column-id","validation-style","left","onShowHeaderMenu"]))),128)),!e.isCurrentUserClient&&o.displaySettings.showInfos&&e.isEpisodeDescription?(a(),l("th",Be,h(e.$t("episodes.fields.description")),1)):d("",!0),o.displaySettings.showInfos?(a(!0),l(k,{key:3},C(e.nonStickedVisibleMetadataDescriptors,t=>(a(),y(b,{key:t.id,descriptor:t,onShowMetadataHeaderMenu:p=>e.showMetadataHeaderMenu(t.id,p)},null,8,["descriptor","onShowMetadataHeaderMenu"]))),128)):d("",!0),!e.isCurrentUserClient&&o.displaySettings.showInfos&&e.isEpisodeTime&&i.metadataDisplayHeaders.timeSpent?(a(),l("th",{key:4,scope:"col",class:"time-spent",ref:"th-spent"},h(e.$t("episodes.fields.time_spent")),513)):d("",!0),!e.isCurrentUserClient&&o.displaySettings.showInfos&&e.isEpisodeEstimation&&i.metadataDisplayHeaders.estimation?(a(),l("th",{key:5,scope:"col",class:"estimation",title:e.$t("main.estimation"),ref:"th-spent"},h(e.$t("main.estimation_short")),9,Ne)):d("",!0),o.displaySettings.showInfos&&i.metadataDisplayHeaders.status?(a(),l("th",{key:6,scope:"col",class:"status",ref:"th-status"},h(e.$t("main.status")),513)):d("",!0),!e.isCurrentUserClient&&o.displaySettings.showInfos&&e.isEpisodeResolution?(a(),l("th",ze,h(e.$t("shots.fields.resolution")),1)):d("",!0),o.isLoading?d("",!0):(a(!0),l(k,{key:8},C(e.nonStickedDisplayedValidationColumns,(t,p)=>(a(),y(w,{key:t,"hidden-columns":i.hiddenColumns,"column-id":t,"validation-style":e.getValidationStyle(t),type:"episodes",onShowHeaderMenu:n=>{e.showHeaderMenu(t,p,n)}},null,8,["hidden-columns","column-id","validation-style","onShowHeaderMenu"]))),128)),m("th",Ie,[e.isCurrentUserManager&&o.displayedEpisodes.length>0&&!o.isLoading?(a(),y(M,{key:0,class:E({"is-small":!0,highlighted:e.isEmptyTask}),icon:"plus",text:e.$t("tasks.create_tasks"),onClick:s[9]||(s[9]=t=>e.$emit("create-tasks"))},null,8,["class","text"])):d("",!0),o.displaySettings.showInfos?N((a(),y(A,{key:1,descriptors:e.episodeMetadataDescriptors,exclude:{timeSpent:!e.isEpisodeTime,estimation:!e.isEpisodeEstimation},namespace:"episodes",modelValue:i.metadataDisplayHeaders,"onUpdate:modelValue":s[10]||(s[10]=t=>i.metadataDisplayHeaders=t)},null,8,["descriptors","exclude","modelValue"])),[[K,e.columnSelectorDisplayed]]):d("",!0),e.episodeMetadataDescriptors.length>0&&o.displaySettings.showInfos?(a(),y(M,{key:2,class:"is-small is-pulled-right mr05",icon:"down",onClick:e.toggleColumnSelector},null,8,["onClick"])):d("",!0)],512)])])),[[_]]),m("tbody",Oe,[!o.isLoading&&u.isListVisible?(a(!0),l(k,{key:0},C(o.displayedEpisodes,(t,p)=>(a(),l("tr",{class:E(["datatable-row",{canceled:t.canceled}]),scope:"row",key:t.id},[m("th",{class:E({"datatable-row-header":!0,"episode-name":!0,name:!0,strong:!t.canceled})},[m("div",Re,[c(U,{entity:t,width:o.displaySettings.bigThumbnails?150:50,height:o.displaySettings.bigThumbnails?100:33,"empty-width":o.displaySettings.bigThumbnails?150:50,"empty-height":o.displaySettings.bigThumbnails?100:34},null,8,["entity","width","height","empty-width","empty-height"]),e.isCurrentUserClient?(a(),l(k,{key:1},[B(h(t.name),1)],64)):(a(),y(V,{key:0,tabindex:"-1",title:t.name,to:u.episodePath(t.id)},{default:Y(()=>[B(h(t.name),1)]),_:2},1032,["title","to"]))])],2),o.displaySettings.showInfos?(a(!0),l(k,{key:0},C(e.stickedVisibleMetadataDescriptors,(n,f)=>(a(),l("td",{ref_for:!0,ref:`editor-${p}-${f}`,class:"metadata-descriptor datatable-row-header",title:t.data?t.data[n.field_name]:"",style:W({"z-index":1e3-p,left:i.offsets["editor-"+f]?`${i.offsets["editor-"+f]}px`:"0"}),key:t.id+"-"+n.id},[c(D,{entity:t,descriptor:n,indexes:{i:p,j:f},onMetadataChanged:s[11]||(s[11]=S=>e.$emit("metadata-changed",S))},null,8,["entity","descriptor","indexes"])],12,Ke))),128)):d("",!0),o.isLoading?d("",!0):(a(!0),l(k,{key:1},C(e.stickedDisplayedValidationColumns,(n,f)=>(a(),y(v,{ref_for:!0,ref:`validation-${p}-${f}`,key:n+"-"+t.id,class:E({"validation-cell":!i.hiddenColumns[n],"hidden-validation-cell":i.hiddenColumns[n],"datatable-row-header":!0}),column:e.taskTypeMap.get(n),"column-y":f,"contact-sheet":o.displaySettings.contactSheetMode,entity:t,"is-assignees":o.displaySettings.showAssignations,"is-static":!0,left:i.offsets["validation-"+f]?`${i.offsets["validation-"+f]}px`:"0",minimized:i.hiddenColumns[n],"row-x":p,selected:u.isSelected(p,f),sticked:!0,"task-test":e.taskMap.get(t.validations.get(n)),onSelect:s[12]||(s[12]=S=>e.onTaskSelected(S,!0)),onUnselect:s[13]||(s[13]=S=>e.onTaskUnselected(S,!0))},null,8,["class","column","column-y","contact-sheet","entity","is-assignees","left","minimized","row-x","selected","task-test"]))),128)),!e.isCurrentUserClient&&o.displaySettings.showInfos&&e.isEpisodeDescription?(a(),y(H,{key:2,class:"description",entry:t,editable:e.isCurrentUserManager,onDescriptionChanged:n=>e.onDescriptionChanged(t,n)},null,8,["entry","editable","onDescriptionChanged"])):d("",!0),o.displaySettings.showInfos?(a(!0),l(k,{key:3},C(e.nonStickedVisibleMetadataDescriptors,(n,f)=>(a(),l("td",{class:"metadata-descriptor",title:t.data?t.data[n.field_name]:"",key:t.id+"-"+n.id},[c(D,{entity:t,descriptor:n,indexes:{i:p,j:f},onMetadataChanged:s[14]||(s[14]=S=>e.$emit("metadata-changed",S))},null,8,["entity","descriptor","indexes"])],8,Qe))),128)):d("",!0),!e.isCurrentUserClient&&o.displaySettings.showInfos&&e.isEpisodeTime&&i.metadataDisplayHeaders.timeSpent?(a(),l("td",qe,h(e.formatDuration(t.timeSpent)),1)):d("",!0),!e.isCurrentUserClient&&o.displaySettings.showInfos&&e.isEpisodeEstimation&&i.metadataDisplayHeaders.estimation?(a(),l("td",Ye,h(e.formatDuration(t.estimation)),1)):d("",!0),o.displaySettings.showInfos&&i.metadataDisplayHeaders.status?(a(),l("td",{key:6,scope:"col",class:"status metadata-descriptor",ref_for:!0,ref:"th-status"},[m("span",We,[m("select",{class:"select-input",onChange:n=>u.onEpisodeStatusChanged(t,n.target.value)},[(a(!0),l(k,null,C(i.episodeStatusOptions,n=>(a(),l("option",{key:`${t.id}-status-option-${n.value}`,value:n.value,selected:(t.status||"running")===n.value},h(e.$t("episodes.status."+n.label)),9,Je))),128))],40,Ge)])],512)):d("",!0),e.isEpisodeResolution&&o.displaySettings.showInfos?(a(),l("td",Xe,[e.isCurrentUserManager?(a(),l("input",{key:0,class:E({"input-editor":!0,error:!e.isValidResolution(t)}),value:e.getMetadataFieldValue({field_name:"resolution"},t),onInput:n=>e.onMetadataFieldChanged(t,{field_name:"resolution"},n),onKeyup:G(n=>e.onInputKeyUp(n,e.getIndex(p,e.k),e.descriptorLength+3),["ctrl"])},null,42,Ze)):(a(),l("span",je,h(e.getMetadataFieldValue({field_name:"resolution"},t)),1))])):d("",!0),o.isLoading?d("",!0):(a(!0),l(k,{key:8},C(e.nonStickedDisplayedValidationColumns,(n,f)=>(a(),y(v,{ref_for:!0,ref:`validation-${p}-${f+e.stickedDisplayedValidationColumns.length}`,key:`${n}-${t.id}`,class:E({"validation-cell":!i.hiddenColumns[n],"hidden-validation-cell":i.hiddenColumns[n]}),"contact-sheet":o.displaySettings.contactSheetMode,column:e.taskTypeMap.get(n),entity:t,"task-test":e.taskMap.get(t.validations?t.validations.get(n):null),minimized:i.hiddenColumns[n],selected:u.isSelected(p,f+e.stickedDisplayedValidationColumns.length),"row-x":p,"column-y":f,"is-assignees":o.displaySettings.showAssignations,onSelect:e.onTaskSelected,onUnselect:e.onTaskUnselected},null,8,["class","contact-sheet","column","entity","task-test","minimized","selected","row-x","column-y","is-assignees","onSelect","onUnselect"]))),128)),e.isCurrentUserManager?(a(),y(P,{key:9,entry:t,onDeleteClicked:n=>e.$emit("delete-clicked",t),onEditClicked:n=>e.$emit("edit-clicked",t)},null,8,["entry","onDeleteClicked","onEditClicked"])):(a(),l("td",$e))],2))),128)):d("",!0)])])],544),c(F,{"is-loading":o.isLoading,"is-error":o.isError},null,8,["is-loading","is-error"]),u.isEmptyList&&e.isCurrentUserClient&&!o.isLoading?(a(),l("div",xe,[s[16]||(s[16]=m("p",{class:"info"},[m("img",{src:ve})],-1)),m("p",es,h(e.$t("episodes.empty_list_client")),1)])):d("",!0),!u.isEmptyList&&!o.isLoading?(a(),l("p",ss,[B(h(e.displayedEpisodesLength)+" "+h(e.$tc("episodes.number",e.displayedEpisodesLength))+" ",1),e.displayedEpisodesTimeSpent>0||e.displayedEpisodesEstimation>0?(a(),l("span",ts," ("+h(e.formatDuration(e.displayedEpisodesTimeSpent))+" "+h(e.isDurationInHours?e.$tc("main.hours_spent",e.formatDuration(e.displayedEpisodesTimeSpent,!1)):e.$tc("main.days_spent",e.formatDuration(e.displayedEpisodesTimeSpent,!1)))+", "+h(e.formatDuration(e.displayedEpisodesEstimation))+" "+h(e.isDurationInHours?e.$tc("main.hours_estimated",e.formatDuration(e.displayedEpisodesEstimation,!1)):e.$tc("main.man_days",e.formatDuration(e.displayedEpisodesEstimation,!1)))+") ",1)):d("",!0)])):d("",!0)])}const as=z(Ae,[["render",is],["__scopeId","data-v-b7ee3a4a"]]),os={name:"episodes",mixins:[$,de],components:{AddMetadataModal:le,AddThumbnailsModal:ne,BuildFilterModal:pe,ButtonSimple:I,ComboboxDepartment:me,ComboboxDisplayOptions:oe,CreateTasksModal:ae,DeleteModal:ue,EditEpisodeModal:ce,EpisodeList:as,HardDeleteModal:Te,SearchField:be,SearchQueryList:we,SortingInfo:ie,TaskInfo:Le},data(){return{type:"episode",contactSheetMode:!1,deleteAllTasksLockText:null,descriptorToEdit:{},departmentFilter:[],episodeToDelete:null,episodeToEdit:null,formData:null,genericColumns:["Metadata column name (text value)","Task type name (task status name value)","Task type name + comment (text value)"],historyEdit:{},initialLoading:!0,optionalColumns:["Description"],pageName:"Episodes",parsedCSV:[],selectedDepartment:"ALL",taskTypeForTaskDeletion:null,modals:{isAddMetadataDisplayed:!1,isAddThumbnailsDisplayed:!1,isBuildFilterDisplayed:!1,isCreateTasksDisplayed:!1,isDeleteDisplayed:!1,isDeleteMetadataDisplayed:!1,isDeleteAllTasksDisplayed:!1,isImportRenderDisplayed:!1,isImportDisplayed:!1,isNewDisplayed:!1},loading:{addMetadata:!1,addThumbnails:!1,creatingTasks:!1,creatingTasksStay:!1,del:!1,deleteAllTasks:!1,deleteMetadata:!1,edit:!1,episode:!1,importing:!1,savingSearch:!1,stay:!1},errors:{addMetadata:!1,creatingTasks:!1,deleteAllTasks:!1,deleteMetadata:!1,edit:!1,importing:!1,importingError:null}}},beforeUnmount(){this.clearSelectedEpisodes()},created(){this.setLastProductionScreen("episodes")},mounted(){this.setSearchFromUrl(),this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition),!this.isCurrentUserManager&&this.user.departments.length>0?(this.selectedDepartment="MY_DEPARTMENTS",this.departmentFilter=this.user.departments):this.departmentFilter=[];const e=()=>{this.initialLoading=!1,this.$refs["episode-list"]&&(this.setSearchFromUrl(),this.onSearchChange(),this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition),this.$nextTick(()=>{this.$refs["episode-list"]?.selectTaskFromQuery()}))};this.episodeMap.size<1||this.episodeValidationColumns.length===0||this.episodeMap.values().next().project_id!==this.currentProduction.id?this.loadEpisodesWithTasks().then(()=>{setTimeout(()=>{e()},200)}).catch(console.error):(this.isEpisodesLoading||(this.initialLoading=!1),e())},computed:{...R(["currentEpisode","currentProduction","departmentMap","departments","displayedEpisodes","episodeMap","episodes","episodeMap","episodeFilledColumns","episodeSearchText","episodeValidationColumns","episodeListScrollPosition","episodeSorting","episodeSearchQueries","isCurrentUserClient","isCurrentUserManager","isEpisodeDescription","isEpisodeEstimation","isEpisodeTime","isEpisodesLoading","isEpisodesLoadingError","isShowAssignations","isTVShow","openProductions","productionEpisodeTaskTypes","selectedTasks","taskTypeMap","user"]),searchField(){return this.$refs["episode-search-field"]},renderColumns(){const e=[...this.dataMatchers,...this.optionalColumns];return this.productionEpisodeTaskTypes.forEach(s=>{e.push(s.name),e.push(`${s.name} comment`)}),e},filteredEpisodes(){const e={};return this.displayedEpisodes.forEach(s=>{const o=s.name;e[o]=!0}),e},metadataDescriptors(){return this.episodeMetadataDescriptors}},methods:{...O(["addMetadataDescriptor","createTasks","changeEpisodeSort","clearSelectedEpisodes","commentTaskWithPreview","deleteAllTasks","deleteEpisode","deleteMetadataDescriptor","editEpisode","getEpisodesCsvLines","hideAssignations","loadEpisodesWithTasks","newEpisode","removeEpisodeSearch","saveEpisodeSearch","setLastProductionScreen","setPreview","setEpisodeSearch","showAssignations","uploadEpisodeFile"]),confirmAddMetadata(e){this.loading.addMetadata=!0,e.entity_type="Episode",this.addMetadataDescriptor(e).then(()=>{this.loading.addMetadata=!1,this.modals.isAddMetadataDisplayed=!1}).catch(s=>{console.error(s),this.loading.addMetadata=!1,this.errors.addMetadata=!0})},showNewModal(){this.episodeToEdit={},this.modals.isNewDisplayed=!0},confirmDeleteEpisode(){this.loading.del=!0,this.errors.del=!1,this.deleteEpisode(this.episodeToDelete).then(()=>{this.loading.del=!1,this.modals.isDeleteDisplayed=!1}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},runTasksCreation(e,s){return this.errors.creatingTasks=!1,this.createTasks({type:"episodes",task_type_id:e.task_type_id,project_id:this.currentProduction.id,selectionOnly:s})},reset(){this.initialLoading=!1,this.loadEpisodesWithTasks(e=>{e&&console.error(e),this.initialLoading=!1})},resetEditModal(){const e={name:""};this.openProductions.length>0&&(e.production_id=this.openProductions[0].id),this.episodeToEdit=e},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveEpisodeSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeEpisodeSearch(e).catch(console.error)},onExportClick(){this.getEpisodesCsvLines().then(e=>{const s=[J().format("YYYY-MM-DD"),"kitsu",this.currentProduction.name,this.$t("episodes.title")],o=j.slugify(s.join("_")),g=[this.$t("episodes.fields.name"),this.$t("episodes.fields.description")];this.currentEpisode&&g.splice(0,0,"Episode"),X([...this.currentProduction.descriptors]).filter(i=>i.entity_type==="Episode").forEach(i=>{g.push(i.name)}),this.isEpisodeTime&&g.push(this.$t("episodes.fields.time_spent")),this.isEpisodeEstimation&&g.push(this.$t("main.estimation_short")),this.episodeValidationColumns.forEach(i=>{g.push(this.taskTypeMap.get(i).name),g.push("Assignations")}),Z.buildCsvFile(o,[g].concat(e))})},async onFieldChanged({entry:e,fieldName:s,value:o}){const g={id:e.id,description:e.description,[s]:o};await this.editEpisode(g),this.applySearchFromUrl(!1)},async onMetadataChanged({entry:e,descriptor:s,value:o}){const g={id:e.id,data:{[s.field_name]:o}};await this.editEpisode(g),this.applySearchFromUrl(!1)},onEditClicked(e){this.episodeToEdit=e,this.modals.isNewDisplayed=!0},onDeleteClicked(e){this.episodeToDelete=e,this.modals.isDeleteDisplayed=!0},confirmEditEpisode(e){this.loading.edit=!0,this.errors.edit=!1,e.id?this.editEpisode(e).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1,this.applySearchFromUrl(!1)}).catch(s=>{console.error(s),this.loading.edit=!1,this.errors.edit=!0}):(e.project_id=this.currentProduction.id,this.newEpisode(e).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0}))},deleteText(){const e=this.episodeToDelete;return e?this.$t("episodes.delete_text",{name:e.name}):""}},watch:{currentProduction(){this.$store.commit("SET_EDIT_LIST_SCROLL_POSITION",0),this.initialLoading=!1,this.reset()},isEpisodesLoading(){this.isEpisodesLoading||(this.initialLoading=!1,this.$nextTick(()=>{this.setSearchFromUrl(),this.onSearchChange()}),this.$refs["episode-list"]&&this.$refs["episode-list"].setScrollPosition(this.episodeListScrollPosition))}},head(){return{title:`${this.currentProduction.name} ${this.$t("episodes.title")} - Kitsu`}}},ns={class:"columns fixed-page"},ls={class:"column main-column"},ds={class:"episodes page"},rs={class:"episode-list-header page-header"},ps={class:"flexrow"},ms={key:0,class:"flexrow flexrow-item"},us={key:1,class:"flexrow"},cs={class:"query-list mt1"},hs={id:"side-column",class:"column side-column"};function fs(e,s,o,g,i,u){const L=r("search-field"),T=r("button-simple"),M=r("combobox-department"),b=r("combobox-display-options"),w=r("search-query-list"),A=r("sorting-info"),U=r("episode-list"),V=r("task-info"),D=r("delete-modal"),v=r("hard-delete-modal"),H=r("create-tasks-modal"),P=r("add-metadata-modal");r("add-thumbnails-modal");const F=r("build-filter-modal"),_=r("edit-episode-modal");return a(),l("div",ns,[m("div",ls,[m("div",ds,[m("div",rs,[m("div",ps,[c(L,{ref:"episode-search-field","can-save":!0,onChange:e.onSearchChange,onSave:u.saveSearchQuery,placeholder:"ex: e01 episode=wip"},null,8,["onChange","onSave"]),c(T,{class:"flexrow-item",title:e.$t("entities.build_filter.title"),icon:"filter",onClick:s[0]||(s[0]=()=>i.modals.isBuildFilterDisplayed=!0)},null,8,["title"]),s[10]||(s[10]=m("div",{class:"filler"},null,-1)),e.isCurrentUserClient?d("",!0):(a(),l("div",ms,[e.departments.length>0?(a(),y(M,{key:0,class:"combobox-department flexrow-item","selectable-departments":e.selectableDepartments("Episode"),"display-all-and-my-departments":!0,rounded:"",modelValue:i.selectedDepartment,"onUpdate:modelValue":s[1]||(s[1]=t=>i.selectedDepartment=t)},null,8,["selectable-departments","modelValue"])):d("",!0),c(b,{class:"flexrow-item",type:i.type,modelValue:e.displaySettings,"onUpdate:modelValue":s[2]||(s[2]=t=>e.displaySettings=t)},null,8,["type","modelValue"])])),e.isCurrentUserManager?(a(),l("div",us,[c(T,{class:"flexrow-item",text:e.$t("episodes.new_episode"),icon:"plus",onClick:u.showNewModal},null,8,["text","onClick"])])):d("",!0)]),m("div",cs,[!e.isEpisodesLoading&&!i.initialLoading?(a(),y(w,{key:0,queries:e.episodeSearchQueries,type:"episode",onRemoveSearch:u.removeSearchQuery},null,8,["queries","onRemoveSearch"])):d("",!0)])]),e.episodeSorting?.length?(a(),y(A,{key:0,sorting:e.episodeSorting,onClearSorting:s[3]||(s[3]=t=>e.onChangeSortClicked(null))},null,8,["sorting"])):d("",!0),c(U,{ref:"episode-list","displayed-episodes":e.displayedEpisodes,"display-settings":e.displaySettings,"is-loading":e.isEpisodesLoading||i.initialLoading,"is-error":e.isEpisodesLoadingError,"validation-columns":e.episodeValidationColumns,"department-filter":i.departmentFilter,onAddMetadata:e.onAddMetadataClicked,onChangeSort:e.onChangeSortClicked,onCreateTasks:e.showCreateTasksModal,onDeleteAllTasks:e.onDeleteAllTasksClicked,onDeleteClicked:u.onDeleteClicked,onDeleteMetadata:e.onDeleteMetadataClicked,onEditClicked:u.onEditClicked,onEditMetadata:e.onEditMetadataClicked,onFieldChanged:u.onFieldChanged,onMetadataChanged:u.onMetadataChanged,onScroll:e.saveScrollPosition,onKeepTaskPanelOpen:e.onKeepTaskPanelOpenChanged},null,8,["displayed-episodes","display-settings","is-loading","is-error","validation-columns","department-filter","onAddMetadata","onChangeSort","onCreateTasks","onDeleteAllTasks","onDeleteClicked","onDeleteMetadata","onEditClicked","onEditMetadata","onFieldChanged","onMetadataChanged","onScroll","onKeepTaskPanelOpen"])])]),N(m("div",hs,[c(V,{task:e.selectedTasks.values().next().value,"entity-type":"Episode","with-actions":""},null,8,["task"])],512),[[K,e.isTaskSidePanelOpen]]),c(D,{ref:"delete-episode-modal",active:i.modals.isDeleteDisplayed,"is-loading":i.loading.del,"is-error":i.errors.del,text:u.deleteText(),"error-text":e.$t("episodes.delete_error"),onCancel:s[4]||(s[4]=t=>i.modals.isDeleteDisplayed=!1),onConfirm:u.confirmDeleteEpisode},null,8,["active","is-loading","is-error","text","error-text","onConfirm"]),c(D,{ref:"delete-metadata-modal",active:i.modals.isDeleteMetadataDisplayed,"is-loading":i.loading.deleteMetadata,"is-error":i.errors.deleteMetadata,text:e.$t("productions.metadata.delete_text"),"error-text":e.$t("productions.metadata.delete_error"),onCancel:s[5]||(s[5]=t=>i.modals.isDeleteMetadataDisplayed=!1),onConfirm:e.confirmDeleteMetadata},null,8,["active","is-loading","is-error","text","error-text","onConfirm"]),c(v,{ref:"delete-all-tasks-modal",active:i.modals.isDeleteAllTasksDisplayed,"is-loading":i.loading.deleteAllTasks,"is-error":i.errors.deleteAllTasks,text:e.deleteAllTasksText(),"error-text":e.$t("tasks.delete_all_error"),"lock-text":i.deleteAllTasksLockText,"selection-option":!0,onCancel:s[6]||(s[6]=t=>i.modals.isDeleteAllTasksDisplayed=!1),onConfirm:e.confirmDeleteAllTasks},null,8,["active","is-loading","is-error","text","error-text","lock-text","onConfirm"]),c(H,{active:i.modals.isCreateTasksDisplayed,"is-loading":i.loading.creatingTasks,"is-loading-stay":i.loading.creatingTasksStay,"is-error":i.errors.creatingTasks,title:e.$t("tasks.create_tasks_episode"),text:e.$t("tasks.create_tasks_episode_explaination"),"error-text":e.$t("tasks.create_tasks_episode_failed"),onCancel:e.hideCreateTasksModal,onConfirm:e.confirmCreateTasks,onConfirmAndStay:e.confirmCreateTasksAndStay},null,8,["active","is-loading","is-loading-stay","is-error","title","text","error-text","onCancel","onConfirm","onConfirmAndStay"]),c(P,{active:i.modals.isAddMetadataDisplayed,"is-loading":i.loading.addMetadata,"is-error":i.errors.addMetadata,"descriptor-to-edit":i.descriptorToEdit,"entity-type":"Episode",onCancel:e.closeMetadataModal,onConfirm:u.confirmAddMetadata},null,8,["active","is-loading","is-error","descriptor-to-edit","onCancel","onConfirm"]),d("",!0),c(F,{ref:"build-filter-modal",active:i.modals.isBuildFilterDisplayed,"entity-type":"episode",onCancel:s[7]||(s[7]=t=>i.modals.isBuildFilterDisplayed=!1),onConfirm:e.confirmBuildFilter},null,8,["active","onConfirm"]),c(_,{active:i.modals.isNewDisplayed,"is-loading":i.loading.edit,"is-error":i.errors.edit,"episode-to-edit":i.episodeToEdit,onCancel:s[8]||(s[8]=t=>i.modals.isNewDisplayed=!1),onConfirm:u.confirmEditEpisode},null,8,["active","is-loading","is-error","episode-to-edit","onConfirm"]),c(v,{active:i.modals.isDeleteDisplayed,"is-loading":i.loading.del,"is-error":i.errors.del,text:u.deleteText(),"error-text":e.$t("episodes.delete_error"),"lock-text":i.episodeToDelete?i.episodeToDelete.name:"",onCancel:s[9]||(s[9]=t=>i.modals.isDeleteDisplayed=!1),onConfirm:u.confirmDeleteEpisode},null,8,["active","is-loading","is-error","text","error-text","lock-text","onConfirm"])])}const At=z(os,[["render",fs],["__scopeId","data-v-226ce07d"]]);export{At as default};
//# sourceMappingURL=Episodes-CKyHlDe0.js.map
