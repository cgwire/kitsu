{"version":3,"file":"EditShotModal-BA5UhfFE.js","sources":["../../src/components/modals/EditShotModal.vue"],"sourcesContent":["<template>\n  <div\n    :class=\"{\n      modal: true,\n      'is-active': active\n    }\"\n  >\n    <div class=\"modal-background\" @click=\"$emit('cancel')\"></div>\n\n    <div class=\"modal-content\">\n      <div class=\"box\">\n        <h1 class=\"title\" v-if=\"shotToEdit && shotToEdit.id\">\n          {{ $t('shots.edit_title') }} {{ shotToEdit.name }}\n        </h1>\n        <h1 class=\"title\" v-else>\n          {{ $t('shots.new_shot') }}\n        </h1>\n\n        <form @submit.prevent>\n          <combobox\n            :label=\"$t('shots.fields.sequence')\"\n            :options=\"sequenceOptions\"\n            v-model=\"form.sequence_id\"\n          />\n          <text-field\n            ref=\"nameField\"\n            :label=\"$t('shots.fields.name')\"\n            v-model.trim=\"form.name\"\n            @enter=\"runConfirmation\"\n            v-focus\n          />\n          <textarea-field\n            ref=\"descriptionField\"\n            :label=\"$t('shots.fields.description')\"\n            v-model=\"form.description\"\n            @keyup.ctrl.enter=\"runConfirmation\"\n            @keyup.meta.enter=\"runConfirmation\"\n          />\n          <text-field\n            ref=\"nbFramesField\"\n            :label=\"$t('shots.fields.nb_frames')\"\n            type=\"number\"\n            v-model=\"form.nb_frames\"\n            @enter=\"runConfirmation\"\n            v-if=\"!isPaperProduction\"\n          />\n          <text-field\n            ref=\"frameInField\"\n            :label=\"$t('shots.fields.frame_in')\"\n            v-model=\"form.frameIn\"\n            type=\"number\"\n          />\n          <text-field\n            ref=\"frameOutField\"\n            :label=\"$t('shots.fields.frame_out')\"\n            v-model=\"form.frameOut\"\n            type=\"number\"\n            @enter=\"runConfirmation\"\n          />\n          <text-field\n            ref=\"fpsField\"\n            :label=\"$t('shots.fields.fps')\"\n            type=\"number\"\n            :max=\"1000\"\n            :step=\"0.001\"\n            v-model=\"form.fps\"\n            @enter=\"runConfirmation\"\n          />\n          <text-field\n            ref=\"resolutionField\"\n            :label=\"$t('shots.fields.resolution')\"\n            v-model=\"form.resolution\"\n            @enter=\"runConfirmation\"\n          />\n          <text-field\n            ref=\"maxRetakesField\"\n            type=\"number\"\n            :label=\"$t('shots.fields.max_retakes')\"\n            v-model=\"form.max_retakes\"\n            @enter=\"runConfirmation\"\n          />\n\n          <template v-if=\"shotToEdit\">\n            <metadata-field\n              :key=\"descriptor.id\"\n              :descriptor=\"descriptor\"\n              :entity=\"shotToEdit\"\n              @enter=\"runConfirmation\"\n              v-model=\"form.data[descriptor.field_name]\"\n              v-for=\"descriptor in shotMetadataDescriptors\"\n            />\n          </template>\n        </form>\n\n        <modal-footer\n          :error-text=\"$t('shots.edit_fail')\"\n          :is-loading=\"isLoading\"\n          :is-error=\"isError\"\n          @confirm=\"confirmClicked\"\n          @cancel=\"$emit('cancel')\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\nimport { modalMixin } from '@/components/modals/base_modal'\nimport { formatListMixin } from '@/components/mixins/format'\n\nimport Combobox from '@/components/widgets/Combobox.vue'\nimport MetadataField from '@/components/widgets/MetadataField.vue'\nimport ModalFooter from '@/components/modals/ModalFooter.vue'\nimport TextField from '@/components/widgets/TextField.vue'\nimport TextareaField from '@/components/widgets/TextareaField.vue'\n\nexport default {\n  name: 'edit-shot-modal',\n\n  mixins: [formatListMixin, modalMixin],\n\n  components: {\n    Combobox,\n    MetadataField,\n    ModalFooter,\n    TextField,\n    TextareaField\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    shotToEdit: {\n      type: Object,\n      default: () => {}\n    }\n  },\n\n  emits: ['cancel', 'confirm', 'confirm-and-stay'],\n\n  data() {\n    return {\n      form: {\n        data: {}\n      },\n      shotSuccessText: ''\n    }\n  },\n\n  mounted() {\n    this.resetForm()\n  },\n\n  computed: {\n    ...mapGetters([\n      'currentProduction',\n      'isPaperProduction',\n      'openProductions',\n      'sequenceOptions',\n      'sequences',\n      'shotCreated',\n      'shotMetadataDescriptors'\n    ]),\n\n    frameIn() {\n      return this.shotToEdit.data ? this.shotToEdit.data.frame_in : ''\n    },\n\n    frameOut() {\n      return this.shotToEdit.data ? this.shotToEdit.data.frame_out : ''\n    },\n\n    fps() {\n      return this.shotToEdit.data ? this.shotToEdit.data.fps : ''\n    },\n\n    resolution() {\n      return this.shotToEdit.data ? this.shotToEdit.data.resolution : ''\n    },\n\n    maxRetakes() {\n      return parseInt(this.shotToEdit.data?.max_retakes) || ''\n    }\n  },\n\n  methods: {\n    ...mapActions(['loadSequences']),\n\n    runConfirmation() {\n      if (this.isEditing()) {\n        this.confirmClicked()\n      } else {\n        this.confirmAndStayClicked()\n      }\n    },\n\n    confirmAndStayClicked() {\n      this.$emit('confirm-and-stay', this.form)\n    },\n\n    confirmClicked() {\n      this.$emit('confirm', this.form)\n    },\n\n    isEditing() {\n      return this.shotToEdit && this.shotToEdit.id\n    },\n\n    resetForm() {\n      this.shotSuccessText = ''\n      if (!this.isEditing()) {\n        if (this.openProductions.length > 0) {\n          this.form.project_id = this.currentProduction\n            ? this.currentProduction.id\n            : ''\n        }\n        if (this.sequences.length > 0) {\n          this.form.sequence_id = this.sequences[0].id\n        }\n        this.form.name = ''\n        this.form.description = ''\n        this.form.nb_frames = 0\n        this.form.data = {}\n      } else {\n        this.form = {\n          sequence_id: this.shotToEdit.sequence_id,\n          project_id: this.shotToEdit.project_id,\n          name: this.shotToEdit.name,\n          description: this.shotToEdit.description,\n          nb_frames: this.shotToEdit.nb_frames,\n          frameIn: this.frameIn,\n          frameOut: this.frameOut,\n          fps: this.fps,\n          max_retakes: this.maxRetakes,\n          resolution: this.resolution,\n          data: { ...this.shotToEdit.data } || {}\n        }\n      }\n    }\n  },\n\n  watch: {\n    active() {\n      this.shotSuccessText = ''\n      this.resetForm()\n      if (this.sequences.length === 0) {\n        this.loadSequences()\n      }\n      if (this.active) {\n        setTimeout(() => {\n          this.$refs.nameField.focus()\n        }, 100)\n      }\n    },\n\n    'form.frameIn'() {\n      const frameIn = this.sanitizeInteger(this.form.frameIn)\n      const frameOut = this.sanitizeInteger(this.form.frameOut)\n      if (frameIn && frameOut && frameOut > frameIn) {\n        this.form.nb_frames = frameOut - frameIn + 1\n      }\n    },\n\n    'form.frameOut'() {\n      const frameIn = this.sanitizeInteger(this.form.frameIn)\n      const frameOut = this.sanitizeInteger(this.form.frameOut)\n      if (frameIn && frameOut && frameOut > frameIn) {\n        this.form.nb_frames = frameOut - frameIn + 1\n      }\n    },\n\n    shotToEdit() {\n      this.resetForm()\n    },\n\n    shotCreated() {\n      if (this.isEditing()) {\n        this.shotSuccessText = this.$t('shots.edit_success', {\n          name: this.shotCreated\n        })\n      } else {\n        this.shotSuccessText = this.$t('shots.new_success', {\n          name: this.shotCreated\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.modal-content .box p.text {\n  margin-bottom: 1em;\n}\n.is-danger {\n  color: #ff3860;\n  font-style: italic;\n}\n.title {\n  border-bottom: 2px solid #ddd;\n  padding-bottom: 0.5em;\n  margin-bottom: 1.2em;\n}\n.info-message {\n  margin-top: 1em;\n}\n\n.modal-content {\n  max-height: 80%;\n}\n</style>\n"],"names":["_sfc_main","formatListMixin","modalMixin","Combobox","MetadataField","ModalFooter","TextField","TextareaField","mapGetters","mapActions","frameIn","frameOut","_hoisted_1","_hoisted_2","_createElementBlock","_normalizeClass","$props","_createElementVNode","_ctx","_hoisted_3","_toDisplayString","_hoisted_4","_cache","_withModifiers","_createVNode","_component_combobox","$data","$event","_component_text_field","$options","_component_textarea_field","_withKeys","_createCommentVNode","_createBlock","_openBlock","_Fragment","_renderList","descriptor","_component_metadata_field","_component_modal_footer"],"mappings":"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"}