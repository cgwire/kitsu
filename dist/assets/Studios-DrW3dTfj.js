import{_ as g,a4 as C,aH as E,a5 as k,a6 as T,a8 as y,r as d,k as w,o as c,c as m,e as s,t as u,a9 as S,n as D,f as n,l as x,d as p,p as $,a1 as V,T as L,F as B,g as F,A as N,aa as A,m as M,b as I,ab as H,ac as R}from"./index-ip1P4Oag.js";import{L as U}from"./ListPageHeader-B1Eqdlzh.js";import{R as q}from"./RouteTabs-CpqfUirB.js";const z={name:"edit-studios-modal",mixins:[C],components:{ColorField:E,ComboboxBoolean:k,ModalFooter:T,TextField:y},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},studioToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){var e;return(e=this.studioToEdit)==null?void 0:e.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},studioToEdit(){this.isEditing?this.form={id:this.studioToEdit.id,name:this.studioToEdit.name,color:this.studioToEdit.color,archived:String(this.studioToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}},j={class:"modal-content"},G={class:"box"},K={key:0,class:"title"},O={key:1,class:"title"};function P(e,t,o,h,i,l){const f=d("text-field"),_=d("color-field"),a=d("combobox-boolean"),b=d("modal-footer"),v=w("focus");return c(),m("div",{class:$(["modal",{"is-active":o.active}])},[s("div",{class:"modal-background",onClick:t[0]||(t[0]=r=>e.$emit("cancel"))}),s("div",j,[s("div",G,[l.isEditing?(c(),m("h1",K,u(e.$t("studios.edit_title"))+" "+u(o.studioToEdit.name),1)):(c(),m("h1",O,u(e.$t("studios.new_studios")),1)),s("form",{onSubmit:t[4]||(t[4]=S(()=>{},["prevent"]))},[D(n(f,{ref:"nameField",label:e.$t("studios.fields.name"),maxlength:30,modelValue:i.form.name,"onUpdate:modelValue":t[1]||(t[1]=r=>i.form.name=r)},null,8,["label","modelValue"]),[[v]]),n(_,{label:e.$t("studios.fields.color"),modelValue:i.form.color,"onUpdate:modelValue":t[2]||(t[2]=r=>i.form.color=r)},null,8,["label","modelValue"]),l.isEditing?(c(),x(a,{key:0,label:e.$t("main.archived"),onEnter:l.runConfirmation,modelValue:i.form.archived,"onUpdate:modelValue":t[3]||(t[3]=r=>i.form.archived=r)},null,8,["label","onEnter","modelValue"])):p("",!0)],32),n(b,{"error-text":e.$t("studios.create_error"),"is-error":o.isError,"is-loading":o.isLoading,onConfirm:l.runConfirmation,onCancel:t[5]||(t[5]=r=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const J=g(z,[["render",P],["__scopeId","data-v-b9c444e1"]]),Q={name:"studio-list",props:["entries","isLoading","isError"],components:{RowActionsCell:V,TableInfo:L},emits:["delete-clicked","edit-clicked"]},W={class:"data-list"},X={class:"datatable-wrapper"},Y={class:"datatable"},Z={class:"datatable-head"},ee={scope:"col",class:"name"},te={scope:"col"},ie={key:0,class:"datatable-body"},oe={class:"name"},se={class:"color"},le={class:"has-text-centered nb-asset-types"};function de(e,t,o,h,i,l){const f=d("row-actions-cell"),_=d("table-info");return c(),m("div",W,[s("div",X,[s("table",Y,[s("thead",Z,[s("tr",null,[s("th",ee,u(e.$t("studios.fields.name")),1),s("th",te,u(e.$t("studios.fields.color")),1),t[0]||(t[0]=s("th",{scope:"col",class:"actions"},null,-1))])]),o.entries.length>0?(c(),m("tbody",ie,[(c(!0),m(B,null,F(o.entries,a=>(c(),m("tr",{class:"datatable-row",key:a.id},[s("td",oe,u(a.name),1),s("td",se,[s("div",null,[s("span",{style:N({background:a.color})},null,4)])]),n(f,{"entry-id":a.id,onEditClicked:b=>e.$emit("edit-clicked",a),onDeleteClicked:b=>e.$emit("delete-clicked",a)},null,8,["entry-id","onEditClicked","onDeleteClicked"])]))),128))])):p("",!0)])]),n(_,{"is-loading":o.isLoading,"is-error":o.isError},null,8,["is-loading","is-error"]),s("p",le,u(o.entries.length)+" "+u(e.$tc("studios.number",o.entries.length)),1)])}const ae=g(Q,[["render",de],["__scopeId","data-v-b0230ef6"]]),ne={name:"studios",components:{DeleteModal:A,EditStudiosModal:J,ListPageHeader:U,RouteTabs:q,StudioList:ae},data(){return{activeTab:"active",studioToEdit:null,studioToDelete:null,errors:{studios:!1,edit:!1,del:!1},loading:{studios:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.studios=!0,this.errors.studios=!1;try{await this.loadStudios()}catch(e){console.error(e),this.errors.studios=!0}this.loading.studios=!1},computed:{...M(["studios","archivedStudios"]),isActiveTab(){return this.activeTab==="active"},studioList(){return this.isActiveTab?this.studios:this.archivedStudios},deleteText(){return this.studioToDelete?this.$t("studios.delete_text",{name:this.studioToDelete.name}):""}},methods:{...I(["deleteStudio","editStudio","loadStudios","newStudio"]),onExportClicked(){const e=H.slugify(this.$t("studios.title")),o=[[this.$t("main.type"),this.$t("studios.fields.name"),this.$t("studios.fields.color")]].concat(this.studios.map(h=>[h.type,h.name,h.color]));R.buildCsvFile(e,o)},onNewClicked(){this.studioToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(e){this.studioToEdit=e,this.modals.edit=!0},async confirmEditStudio(e){var t;this.loading.edit=!0,this.errors.edit=!1,e.id=(t=this.studioToEdit)==null?void 0:t.id;try{e.id?await this.editStudio(e):await this.newStudio(e),this.modals.edit=!1}catch(o){console.error(o),this.errors.edit=!0}this.loading.edit=!1},onDeleteClicked(e){this.studioToDelete=e,this.modals.del=!0},async confirmDeleteStudio(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteStudio(this.studioToDelete),this.modals.del=!1}catch(e){console.error(e),this.errors.del=!0}this.loading.del=!1}},watch:{$route(){this.activeTab=this.$route.query.tab}},head(){return{title:`${this.$t("studios.title")} - Kitsu`}}},re={class:"studios page fixed-page"};function ce(e,t,o,h,i,l){const f=d("list-page-header"),_=d("route-tabs"),a=d("studio-list"),b=d("edit-studios-modal"),v=d("delete-modal");return c(),m("div",re,[n(f,{title:e.$t("studios.title"),"new-entry-label":e.$t("studios.new_studios"),"is-exportable":l.isActiveTab,onExportClicked:l.onExportClicked,onNewClicked:l.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),n(_,{class:"mt2","active-tab":i.activeTab,tabs:i.tabs,"route-name":"studios"},null,8,["active-tab","tabs"]),n(a,{class:"studio-list",entries:l.studioList,"is-loading":i.loading.studios,"is-error":i.errors.studios,onEditClicked:l.onEditClicked,onDeleteClicked:l.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),n(b,{active:i.modals.edit,"is-loading":i.loading.edit,"is-error":i.errors.edit,"studio-to-edit":i.studioToEdit,onCancel:t[0]||(t[0]=r=>i.modals.edit=!1),onConfirm:l.confirmEditStudio},null,8,["active","is-loading","is-error","studio-to-edit","onConfirm"]),n(v,{active:i.modals.del,"is-loading":i.loading.del,"is-error":i.errors.del,text:l.deleteText,"error-text":e.$t("studios.delete_error"),onCancel:t[1]||(t[1]=r=>i.modals.del=!1),onConfirm:l.confirmDeleteStudio},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const fe=g(ne,[["render",ce],["__scopeId","data-v-35e645fb"]]);export{fe as default};
//# sourceMappingURL=Studios-DrW3dTfj.js.map
