import{x as D,K as N,a as X,b as w,_,r as u,o as a,c as l,I as S,F as b,e as E,d as o,i as I,t as d,g as A,H as C,h as f,W as Y,w as O,f as k,n as T,B as x,M as F,b0 as B,S as G,l as j,a1 as R,aY as z,br as K,Q as J}from"./index-C2m_IhNF.js";import{s as M}from"./string-B0Tq569e.js";import{C as Z,d as L}from"./BuildFilterModal-C3nrV5vY.js";import{d as W}from"./dom-tO7tlkHV.js";import{e as ee}from"./entity_list-EwCggK6z.js";import{D as P}from"./DepartmentName-C_7ZW05X.js";import{b as te}from"./PreviewPlayer-CsSraBfQ.js";import{C as U}from"./Combobox-DQpIQydI.js";import{C as se}from"./ComboboxBoolean-DJwCfClJ.js";import{C as ie}from"./ComboboxDepartment-whRm-Bo0.js";import{M as Q}from"./ModalFooter-BJ98b-60.js";import{T as ae}from"./TextField-p_HJuEKt.js";import{C as q}from"./ComboboxTaskType-CiBcPUsC.js";import{F as ne}from"./FileUpload-C4E3YXqL.js";import{C as le}from"./check-_fRnDsm9.js";import{C as oe}from"./ComboboxOptions-XCxMu4bW.js";import{P as re}from"./PageTitle-DzrTLr4-.js";const Ot={data(){return{displaySettings:{bigThumbnails:!1,contactSheetMode:!1,showAssignations:!0,showInfos:!0},keepTaskPanelOpen:!1}},mounted(){const e=D.getPreference(`${this.pageName}:department`),t=this.selectableDepartments(M.capitalize(this.type)).map(s=>s.id);e&&!this.isCurrentUserClient&&(!this.user.departments.length||t.includes(e)||e==="ALL")?this.selectedDepartment=e:!this.isCurrentUserManager&&this.user.departments.length&&(this.selectedDepartment="MY_DEPARTMENTS"),this.onSelectedDepartmentChanged(),this.displaySettings=D.getObjectPreference(`${this.type}s:display_settings`)||this.displaySettings},computed:{...w(["isCurrentUserClient","isCurrentUserManager","nbSelectedTasks","selectedTasks","nbSelectedValidations"]),searchField(){return this.$refs[`${this.type}-search-field`]},addThumbnailsModal(){return this.$refs["add-thumbnails-modal"]},dataMatchers(){return["Name"]},isTaskSidePanelOpen(){return this.nbSelectedTasks>0||this.keepTaskPanelOpen||this.nbSelectedEntities>0||this.nbSelectedValidations>0},nbSelectedEntities(){return this.selectedEntities.size},entityTypeName(){return`${this.type[0].toUpperCase()}${this.type.slice(1)}`},selectedEntities(){return["Episode","Sequence"].includes(this.entityTypeName)?[]:this[`selected${this.entityTypeName}s`]}},methods:{...X(["clearSelectedTasks"]),showImportModal(){this.modals.isImportDisplayed=!0},hideImportModal(){this.modals.isImportDisplayed=!1},showImportRenderModal(){this.modals.isImportRenderDisplayed=!0},hideImportRenderModal(){this.modals.isImportRenderDisplayed=!1},showCreateTasksModal(){this.modals.isCreateTasksDisplayed=!0},hideCreateTasksModal(){this.modals.isCreateTasksDisplayed=!1},showAddThumbnailsModal(){this.modals.isAddThumbnailsDisplayed=!0},hideAddThumbnailsModal(){this.modals.isAddThumbnailsDisplayed=!1},onSelectedDepartmentChanged(){const e=this.selectedDepartment;e==="ALL"?this.departmentFilter=[]:e==="MY_DEPARTMENTS"?this.departmentFilter=this.user.departments:this.departmentFilter=[e],D.setPreference(`${this.pageName}:department`,e)},selectableDepartments(e){return this.currentProduction?this.currentProduction.task_types.map(t=>{const s=this.taskTypeMap.get(t);return s&&s.for_entity===e?this.departmentMap.get(s.department_id):!1}).filter((t,s,m)=>t&&m.indexOf(t)===s):[]},onEntityThumbnailClicked(e){e&&(this.previvewFileIdToShow=e,this.modals.isPreviewDisplayed=!0)},closeMetadataModal(){this.modals.isAddMetadataDisplayed=!1},confirmDeleteMetadata(){this.errors.deleteMetadata=!1,this.loading.deleteMetadata=!0,this.deleteMetadataDescriptor(this.descriptorIdToDelete).then(()=>{this.errors.deleteMetadata=!1,this.loading.deleteMetadata=!1,this.modals.isDeleteMetadataDisplayed=!1}).catch(e=>{console.error(e),this.errors.deleteMetadata=!0,this.loading.deleteMetadata=!1})},onAddMetadataClicked(){this.descriptorToEdit={},this.modals.isAddMetadataDisplayed=!0},onDeleteMetadataClicked(e){this.descriptorIdToDelete=e,this.modals.isDeleteMetadataDisplayed=!0},onEditMetadataClicked(e){this.descriptorToEdit=this.currentProduction.descriptors.find(t=>t.id===e),this.modals.isAddMetadataDisplayed=!0},confirmDeleteAllTasks(e){const t=this.taskTypeForTaskDeletion.id,s=this.currentProduction.id;this.errors.deleteAllTasks=!1,this.loading.deleteAllTasks=!0,this.deleteAllTasks({projectId:s,taskTypeId:t,selectionOnly:e}).then(()=>{this.loading.deleteAllTasks=!1,this.modals.isDeleteAllTasksDisplayed=!1}).catch(m=>{console.error(m),this.loading.deleteAllTasks=!1,this.errors.deleteAllTasks=!0})},confirmAddThumbnails(e){const t=s=>(this.addThumbnailsModal?.markLoading(s.task.entity_id),this.commentTaskWithPreview({taskId:s.task.id,commentText:"",taskStatusId:s.task.task_status_id,form:s}).then(({newComment:m,preview:n})=>this.setPreview({taskId:s.task.id,entityId:s.task.entity_id,previewId:n.id})).then(()=>{this.addThumbnailsModal?.markUploaded(s.task.entity_id)}));this.loading.addThumbnails=!0,N.runPromiseMapAsSeries(e,t).then(()=>{this.loading.addThumbnails=!1,this.modals.isAddThumbnailsDisplayed=!1})},confirmCreateTasks({form:e,selectionOnly:t}){this.loading.creatingTasks=!0,this.runTasksCreation(e,t).then(()=>{this.reset(),this.hideCreateTasksModal(),this.loading.creatingTasks=!1}).catch(s=>{this.errors.creatingTasks=!0,console.error(s)})},confirmCreateTasksAndStay({form:e,selectionOnly:t}){this.loading.creatingTasksStay=!0,this.runTasksCreation(e,t).then(()=>{this.reset(),this.loading.creatingTasksStay=!1}).catch(s=>{this.errors.creatingTasks=!0,console.error(s)})},deleteAllTasksText(){const e=this.taskTypeForTaskDeletion;return e?this.$t("tasks.delete_all_text",{name:e.name}):""},onDeleteAllTasksClicked(e){const t=this.taskTypeMap.get(e);this.taskTypeForTaskDeletion=t,this.deleteAllTasksLockText=t.name,this.modals.isDeleteAllTasksDisplayed=!0},saveScrollPosition(e){this.$store.commit("SET_EDIT_LIST_SCROLL_POSITION",e)},onChangeSortClicked(e){this[`change${this.type[0].toUpperCase()}${this.type.slice(1)}Sort`](e)},onKeepTaskPanelOpenChanged(e){this.keepTaskPanelOpen=e},clearSelection(){this[`clearSelected${this.entityTypeName}s`](),this.clearSelectedTasks()}},watch:{selectedDepartment(){this.onSelectedDepartmentChanged()},displaySettings:{deep:!0,handler(e){D.setObjectPreference(`${this.type}s:display_settings`,e)}}}},de={name:"metadata-input",mixins:[L,W,ee],components:{ComboboxTag:Z},props:{entity:{type:Object,required:!0},descriptor:{type:Object,required:!0},indexes:{type:Object,required:!0}},computed:{...w(["isCurrentUserManager","isCurrentUserSupervisor","user"]),isEditable(){return this.isCurrentUserManager||this.isSupervisorInDepartments(this.descriptor.departments)}}},me=["readonly","value"],ce=["readonly","value"],ue=["disabled","checked"],he={key:3,class:"metadata-value selectable"},pe=["onChange","id","checked","disabled"],fe=["for"],ke={key:4,class:"select"},ye=["disabled","value","selected"],ge={key:6,class:"metadata-value selectable"};function be(e,t,s,m,n,i){const h=u("combobox-tag");return!s.descriptor.data_type||s.descriptor.data_type==="string"?(a(),l("input",{key:0,class:"input-editor",readonly:!i.isEditable,onInput:t[0]||(t[0]=r=>e.onMetadataFieldChanged(s.entity,s.descriptor,r)),onKeyup:t[1]||(t[1]=S(r=>e.onInputKeyUp(r,s.indexes.i,s.indexes.j),["ctrl"])),value:e.getMetadataFieldValue(s.descriptor,s.entity)},null,40,me)):s.descriptor.data_type==="number"?(a(),l("input",{key:1,class:"input-editor",readonly:!i.isEditable,type:"number",step:"any",onKeydown:t[2]||(t[2]=(...r)=>e.onNumberFieldKeyDown&&e.onNumberFieldKeyDown(...r)),onInput:t[3]||(t[3]=r=>e.onMetadataFieldChanged(s.entity,s.descriptor,r)),onKeyup:t[4]||(t[4]=S(r=>e.onInputKeyUp(r,s.indexes.i,s.indexes.j),["ctrl"])),value:e.getMetadataFieldValue(s.descriptor,s.entity)},null,40,ce)):s.descriptor.data_type==="boolean"?(a(),l("input",{key:2,class:"input-editor",disabled:!i.isEditable,onInput:t[5]||(t[5]=r=>e.onMetadataFieldChanged(s.entity,s.descriptor,r)),onKeyup:t[6]||(t[6]=S(r=>e.onInputKeyUp(r,s.indexes.i,s.indexes.j),["ctrl"])),type:"checkbox",checked:e.getMetadataFieldValue(s.descriptor,s.entity)==="true"},null,40,ue)):s.descriptor.data_type==="checklist"&&e.getDescriptorChecklistValues(s.descriptor).length?(a(),l("div",he,[(a(!0),l(b,null,E(e.getDescriptorChecklistValues(s.descriptor),(r,y)=>(a(),l("p",{key:`${s.entity.id}-${s.descriptor.id}-${y}-${r.text}-div`},[o("input",{type:"checkbox",onChange:v=>e.onMetadataChecklistChanged(s.entity,s.descriptor,r.text,v),id:`${s.entity.id}-${s.descriptor.id}-${y}-${r.text}-input`,checked:e.getMetadataChecklistValues(s.descriptor,s.entity)[r.text],disabled:!i.isEditable,style:I([i.isEditable?{cursor:"pointer"}:{cursor:"auto"}])},null,44,pe),o("label",{for:`${s.entity.id}-${s.descriptor.id}-${y}-${r.text}-input`,style:I([i.isEditable?{cursor:"pointer"}:{cursor:"auto"}]),class:"ml05"},d(r.text),13,fe)]))),128))])):s.descriptor.data_type==="list"?(a(),l("span",ke,[o("select",{class:"select-input",onKeyup:t[7]||(t[7]=S(r=>e.onInputKeyUp(r,s.indexes.i,s.indexes.j),["ctrl"])),onChange:t[8]||(t[8]=r=>e.onMetadataFieldChanged(s.entity,s.descriptor,r))},[(a(!0),l(b,null,E(e.getDescriptorChoicesOptions(s.descriptor),(r,y)=>(a(),l("option",{disabled:!i.isEditable,key:`desc-value-${s.entity.id}-${s.descriptor.id}-${y}-${r.label}-${r.value}`,value:r.value,selected:e.getMetadataFieldValue(s.descriptor,s.entity)===r.value},d(r.label),9,ye))),128))],32)])):s.descriptor.data_type==="taglist"?(a(),A(h,{key:5,disabled:!i.isEditable,options:e.getDescriptorChoicesOptions(s.descriptor,!1),shy:!0,"model-value":e.getMetadataFieldValue(s.descriptor,s.entity),"with-margin":!1,"onUpdate:modelValue":t[9]||(t[9]=r=>e.onMetadataFieldChanged(s.entity,s.descriptor,r))},null,8,["disabled","options","model-value"])):(a(),l("div",ge,d(e.getMetadataFieldValue(s.descriptor,s.entity)),1))}const xt=_(de,[["render",be],["__scopeId","data-v-a51f61f6"]]),ve={name:"table-header-menu",props:{isMinimized:{type:Boolean,default:!1},isEditAllowed:{type:Boolean,default:!1},isSticked:{type:Boolean,default:!1}},emits:["delete-all-clicked","minimize-clicked","select-column","sort-by-clicked","toggle-stick"]},Te={class:"header-menu hidden"},Ae={key:0},Ce={key:1};function _e(e,t,s,m,n,i){return a(),l("div",Te,[o("div",{onClick:t[0]||(t[0]=h=>e.$emit("minimize-clicked"))},[s.isMinimized?(a(),l("span",Ae,d(e.$t("main.maximize")),1)):(a(),l("span",Ce,d(e.$t("main.minimize")),1))]),o("div",{onClick:t[1]||(t[1]=h=>e.$emit("sort-by-clicked"))},d(e.$t("main.sort_by")),1),o("div",{onClick:t[2]||(t[2]=h=>e.$emit("select-column"))},d(e.$t("main.select_column")),1),o("div",{onClick:t[3]||(t[3]=h=>e.$emit("toggle-stick"))},[s.isSticked?(a(),l(b,{key:0},[C(d(e.$t("main.unstick")),1)],64)):(a(),l(b,{key:1},[C(d(e.$t("main.stick")),1)],64))]),s.isEditAllowed?(a(),l("div",{key:0,class:"error",onClick:t[4]||(t[4]=h=>e.$emit("delete-all-clicked"))},d(e.$t("main.delete_all")),1)):f("",!0)])}const Lt=_(ve,[["render",_e],["__scopeId","data-v-75a57245"]]),Me={name:"table-metadata-header-menu",props:{isEditAllowed:{type:Boolean,default:!1},isSticked:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked","sort-by-clicked","toggle-stick"]},Ee={class:"header-menu hidden"};function we(e,t,s,m,n,i){return a(),l("div",Ee,[s.isEditAllowed?(a(),l("div",{key:0,onClick:t[0]||(t[0]=h=>e.$emit("edit-clicked"))},d(e.$t("main.edit")),1)):f("",!0),o("div",{onClick:t[1]||(t[1]=h=>e.$emit("sort-by-clicked"))},d(e.$t("main.sort_by")),1),o("div",{onClick:t[2]||(t[2]=h=>e.$emit("toggle-stick"))},[s.isSticked?(a(),l(b,{key:0},[C(d(e.$t("main.unstick")),1)],64)):(a(),l(b,{key:1},[C(d(e.$t("main.stick")),1)],64))]),s.isEditAllowed?(a(),l("div",{key:1,class:"error",onClick:t[3]||(t[3]=h=>e.$emit("delete-clicked"))},d(e.$t("main.delete")),1)):f("",!0)])}const Pt=_(Me,[["render",we],["__scopeId","data-v-488185b1"]]),Se={name:"validation-header",components:{ChevronDownIcon:Y,DepartmentName:P},props:{hiddenColumns:Object,columnId:String,validationStyle:Object,isStick:{type:Boolean,default:!1},left:{type:String},type:{type:String,default:"assets"}},emits:["show-header-menu"],computed:{...w(["currentEpisode","currentProduction","isCurrentUserClient","isTVShow","departmentMap","taskTypeMap"]),currentDepartment(){return this.departmentMap.get(this.currentTaskType.department_id)},currentTaskType(){return this.taskTypeMap.get(this.columnId)??{}},isHiddenColumn(){return this.hiddenColumns[this.columnId]}},methods:{taskTypePath(e){if(this.currentTaskType.for_entity==="Episode")return{name:"episodes-task-type",params:{production_id:this.currentProduction.id,task_type_id:e}};{const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:e,type:this.type}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t}}}},De=["title"];function Ie(e,t,s,m,n,i){const h=u("department-name"),r=u("router-link"),y=u("chevron-down-icon");return a(),l("th",{scope:"col",class:T({"validation-cell":!i.isHiddenColumn,"hidden-validation-cell":i.isHiddenColumn,"datatable-row-header":s.isStick}),style:I({left:s.left})},[o("div",{class:"flexrow validation-content",style:I(s.validationStyle)},[i.currentDepartment?(a(),A(h,{key:0,class:"department-dot",department:i.currentDepartment,"no-padding":"","only-dot":""},null,8,["department"])):f("",!0),e.isCurrentUserClient?(a(),l("span",{key:2,class:"flexrow-item datatable-dropdown ellipsis task-type-name",title:i.isHiddenColumn?null:i.currentTaskType.name},d(i.isHiddenColumn?"":i.currentTaskType.name),9,De)):(a(),A(r,{key:1,class:"flexrow-item datatable-dropdown ellipsis task-type-name",title:i.isHiddenColumn?null:i.currentTaskType.name,to:i.taskTypePath(s.columnId)},{default:O(()=>[C(d(i.isHiddenColumn?"":i.currentTaskType.name),1)]),_:1},8,["title","to"])),o("span",{class:"metadata-menu-button header-icon pointer",onClick:t[0]||(t[0]=v=>e.$emit("show-header-menu",v))},[k(y,{size:14})])],4)],6)}const Ut=_(Se,[["render",Ie],["__scopeId","data-v-080b7096"]]),Ve={name:"add-metadata-modal",mixins:[L,F],components:{ButtonSimple:x,Checklist:te,Combobox:U,ComboboxBoolean:se,ComboboxDepartment:ie,DepartmentName:P,ModalFooter:Q,TextField:ae},props:{active:{type:Boolean,default:!1},descriptorToEdit:{type:Object,default:()=>{}},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},entityType:{type:String,default:"Asset"}},emits:["cancel","confirm"],data(){return{form:{name:"",data_type:"string",for_client:"false",values:[],departments:[]},valueToAdd:"",checklist:[],typeOptions:[{label:this.$t("productions.metadata.string"),value:"string"},{label:this.$t("productions.metadata.number"),value:"number"},{label:this.$t("productions.metadata.boolean"),value:"boolean"},{label:this.$t("productions.metadata.choices"),value:"list"},{label:this.$t("productions.metadata.tags"),value:"taglist"},{label:this.$t("productions.metadata.checklist"),value:"checklist"}],selectedDepartment:null}},mounted(){this.reset()},computed:{...w(["currentProduction","departmentMap","isCurrentUserSupervisor","taskTypeMap","user"]),isEditing(){return!!this.descriptorToEdit.id},selectableDepartments(){if(!this.currentProduction)return[];let e=this.currentProduction.task_types.map(t=>{const s=this.taskTypeMap.get(t);return s&&s.for_entity===this.entityType?this.departmentMap.get(s.department_id):!1}).filter((t,s,m)=>t&&m.indexOf(t)===s&&this.form.departments.findIndex(n=>n===t.id)===-1);return this.isCurrentUserSupervisor&&this.user.departments.length>0&&(e=e.filter(t=>this.user.departments.indexOf(t.id)>=0)),e},isFormFilled(){return this.form.name.length&&(["string","number","boolean"].includes(this.form.data_type)||["list","taglist"].includes(this.form.data_type)&&this.form.values.length||this.form.data_type==="checklist"&&this.checklist?.[0]?.text.length)&&(!this.isCurrentUserSupervisor||!this.user.departments.length||this.form.departments.length)},valueList(){return this.$refs.valueList}},methods:{addValue(e){const t=e;return!this.form.values.find(s=>s===t)&&t&&(this.form.values.push(t),this.form.data_type==="taglist"&&this.form.values.sort(),this.valueToAdd="",this.$nextTick(()=>{const s=this.form.values.findIndex(n=>n===t),m=this.valueList.scrollHeight/this.form.values.length*s;this.valueList.scrollTop=m})),t},confirm(){return["string","number","boolean"].includes(this.form.data_type)?this.form.values=[]:this.form.data_type==="checklist"&&(this.form.values=this.checklist.filter(Boolean).map(e=>(e.checked?"[x] ":"[ ] ")+e.text)),this.$emit("confirm",this.form)},removeValue(e){this.form.values=B(this.form.values,e)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(e){const t=this.form.departments.indexOf(e);t>=0&&this.form.departments.splice(t,1)},addChecklistEntry(e){(e===-1||e===this.checklist.length-1)&&this.checklist.push({text:"",checked:!1})},onAddChecklistItem(e){delete e.index,this.checklist.push(e)},removeTask(e){this.checklist=B(this.checklist,e)},reset(){this.isEditing?(this.form={id:this.descriptorToEdit.id,name:this.descriptorToEdit.name,data_type:this.descriptorToEdit.data_type,for_client:this.descriptorToEdit.for_client?"true":"false",values:[...this.descriptorToEdit.choices],departments:[...this.descriptorToEdit.departments]},this.checklist=this.getDescriptorChecklistValues(this.descriptorToEdit),this.form.data_type==="taglist"&&this.form.values.sort()):(this.form={name:"",data_type:"string",for_client:"false",values:[],departments:[]},this.checklist=[]),this.valueToAdd=""}},watch:{active(){this.active&&(this.reset(),this.$nextTick(()=>{this.$refs.nameField.focus()}))}}},Fe={class:"modal-content"},Be={class:"box content"},Oe={class:"title"},xe={key:0},Le={class:"strong"},Pe={key:0,ref:"valueList",class:"choice-value-wrapper mb1"},Ue=["onClick"],Qe={key:1},qe={key:1},He={class:"strong"},$e={class:"checklist-wrapper"},Ne={key:2,class:"departments mb2"},Xe={class:"label"},Ye=["onClick"],Ge={key:0,class:"flexrow"};function je(e,t,s,m,n,i){const h=u("text-field"),r=u("combobox"),y=u("checklist"),v=u("button-simple"),g=u("department-name"),p=u("combobox-department"),V=u("combobox-boolean"),H=u("modal-footer");return a(),l("div",{class:T({modal:!0,"is-active":s.active})},[o("div",{class:"modal-background",onClick:t[0]||(t[0]=c=>e.$emit("cancel"))}),o("div",Fe,[o("div",Be,[o("h1",Oe,d(i.isEditing?e.$t("productions.metadata.edit_title"):e.$t("productions.metadata.title")),1),k(h,{ref:"nameField",label:e.$t("assets.fields.name"),modelValue:n.form.name,"onUpdate:modelValue":t[1]||(t[1]=c=>n.form.name=c),modelModifiers:{trim:!0},onEnter:i.confirm},null,8,["label","modelValue","onEnter"]),k(r,{label:e.$t("assets.fields.type"),modelValue:n.form.data_type,"onUpdate:modelValue":t[2]||(t[2]=c=>n.form.data_type=c),options:n.typeOptions,onEnter:i.confirm},null,8,["label","modelValue","options","onEnter"]),["list","taglist"].includes(n.form.data_type)?(a(),l("div",xe,[o("p",Le,d(e.$t("productions.metadata.available_values")),1),n.form.values.length?(a(),l("div",Pe,[(a(!0),l(b,null,E(n.form.values,c=>(a(),l("p",{class:"choice-value",key:c},[o("span",null,d(c),1),o("span",{class:"remove-button pull-right",onClick:$=>i.removeValue(c)}," x ",8,Ue)]))),128))],512)):(a(),l("div",Qe,d(e.$t("productions.metadata.add_new_values")),1)),k(h,{modelValue:n.valueToAdd,"onUpdate:modelValue":t[3]||(t[3]=c=>n.valueToAdd=c),modelModifiers:{trim:!0},"button-label":e.$t("main.add"),onEnter:i.addValue},null,8,["modelValue","button-label","onEnter"])])):f("",!0),n.form.data_type==="checklist"?(a(),l("div",qe,[o("p",He,d(e.$t("productions.metadata.checklist")),1),o("div",$e,[n.checklist.length?(a(),A(y,{key:0,checklist:n.checklist,onAddItem:i.onAddChecklistItem,onRemoveTask:i.removeTask},null,8,["checklist","onAddItem","onRemoveTask"])):f("",!0),k(v,{class:T({button:!0,active:n.checklist.length!==0}),icon:"plus",title:e.$t("comments.add_checklist"),onClick:t[4]||(t[4]=c=>i.addChecklistEntry(-1))},null,8,["class","title"])])])):f("",!0),n.form.departments.length||i.selectableDepartments.length?(a(),l("div",Ne,[o("label",Xe,d(e.$t("people.fields.departments")),1),(a(!0),l(b,null,E(n.form.departments,c=>(a(),l("div",{class:"department-element mb1",key:c,onClick:$=>i.removeDepartment(c)},[k(g,{department:e.departmentMap.get(c)},null,8,["department"])],8,Ye))),128)),i.selectableDepartments.length?(a(),l("div",Ge,[k(p,{class:"flexrow-item","selectable-departments":i.selectableDepartments,"max-height-select-input":160,modelValue:n.selectedDepartment,"onUpdate:modelValue":t[5]||(t[5]=c=>n.selectedDepartment=c)},null,8,["selectable-departments","modelValue"]),o("button",{class:T(["button is-success flexrow-item",{"is-disabled":n.selectedDepartment===null}]),onClick:t[6]||(t[6]=(...c)=>i.addDepartment&&i.addDepartment(...c))},d(e.$t("main.add")),3)])):f("",!0)])):f("",!0),k(V,{ref:"hiddenField",label:e.$t("assets.fields.hidden_from_client"),modelValue:n.form.for_client,"onUpdate:modelValue":t[7]||(t[7]=c=>n.form.for_client=c),onEnter:i.confirm},null,8,["label","modelValue","onEnter"]),k(H,{"error-text":e.$t("productions.metadata.error"),"is-error":s.isError,"is-loading":s.isLoading,"is-disabled":!i.isFormFilled,onConfirm:i.confirm,onCancel:t[8]||(t[8]=c=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","is-disabled","onConfirm"])])])],2)}const Qt=_(Ve,[["render",je],["__scopeId","data-v-229d90ea"]]),Re="data:image/png;base64,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",ze={name:"add-thumbnails-modal",mixins:[F],components:{CheckIcon:le,ComboboxTaskType:q,FileUpload:ne,ModalFooter:Q,Spinner:G},props:{active:{type:Boolean,default:!1},entityType:{type:String,required:!0,validator:e=>["Asset","Edit","Shot"].includes(e)},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},parent:{type:String,required:!0}},emits:["cancel","confirm"],data(){return{extensions:".png,.jpg,.jpeg,.mp4,.mov",forms:[],loading:{},taskTypeId:null,uploaded:{}}},mounted(){this.reset()},computed:{...w(["assetValidationColumns","editValidationColumns","shotValidationColumns","taskTypeMap","taskMap"]),isFormFilled(){return this.thumbnailList.length>0},taskTypeList(){let e=[];return this.isAssets?e=this.assetValidationColumns||[]:this.isEdits?e=this.editValidationColumns||[]:this.isShots&&(e=this.shotValidationColumns||[]),e.map(t=>this.taskTypeMap.get(t))},isAssets(){return this.entityType==="Asset"},isEdits(){return this.entityType==="Edit"},isShots(){return this.entityType==="Shot"},validForms(){return this.forms.filter(e=>{const t=this.slugifyFilename(e),s=this.entityMap[t];return s&&s.validations.get(this.taskTypeId)})},invalidForms(){return this.forms.filter(e=>!this.validForms.includes(e))},thumbnailList(){return this.validForms.map(e=>{const t=this.entityMap[this.slugifyFilename(e)],s=this.prepareImagePreview(e);let m="";return this.isAssets?m=t.asset_type_name:this.isEdits?m=t.episode_name:this.isShots&&(m=t.sequence_name),e.asset=t,{parentName:m,name:t.name,id:t.id,src:s}})}},methods:{reset(){this.taskTypeList.length>0&&(this.taskTypeId=this.taskTypeList[0].id),this.$refs["preview-field"].reset(),this.forms=[],this.loading={},this.uploaded={}},confirm(){return this.$emit("confirm",this.validForms.map(this.addTaskInformation))},addEntityToEntityMap(e){let t="";this.isAssets?t=M.slugify(`${e.asset_type_name}_${e.name}`):this.isEdits?t=M.slugify(e.episode_name?`${e.episode_name}_${e.name}`:e.name):this.isShots&&(t=M.slugify(`${e.sequence_name}_${e.name}`)),this.entityMap[t]=e},addTaskInformation(e){const t=this.slugifyFilename(e),s=this.entityMap[t],m=this.taskMap.get(s.validations.get(this.taskTypeId));return e.task=m,e},onFileSelected(e){this.entityMap={},this.uploaded={};let t=[];this.isAssets?t=j.cache.assets:this.isEdits?t=R.cache.edits:this.isShots&&(t=z.cache.shots),t.forEach(this.addEntityToEntityMap),this.forms=e},slugifyFilename(e){const t=e.get("file").name;return M.slugify(M.filenameWithoutExtension(t))},prepareImagePreview(e){return e.get("file").type.startsWith("image")?window.URL.createObjectURL(e.get("file")):""},markLoading(e){this.loading={[e]:!0}},markUploaded(e){this.uploaded[e]=!0}},watch:{active(){this.active&&this.reset()}}},Ke={class:"modal-content"},Je={class:"box content"},Ze={class:"title"},We={class:"label"},et={key:0,class:"warning"},tt={class:"label mt2"},st={class:"invalid-files"},it={key:1,class:"label mt2"},at={key:0,class:"flexrow-item",src:Re,width:"150",height:"100"},nt=["src"],lt={class:"flexrow-item"};function ot(e,t,s,m,n,i){const h=u("combobox-task-type"),r=u("file-upload"),y=u("spinner"),v=u("check-icon"),g=u("modal-footer");return a(),l("div",{class:T(["modal",{"is-active":s.active}])},[o("div",{class:"modal-background",onClick:t[0]||(t[0]=p=>e.$emit("cancel"))}),o("div",Ke,[o("div",Je,[o("h1",Ze,d(e.$t("entities.thumbnails.title")),1),o("p",null,d(e.$t("entities.thumbnails.explanation")),1),k(h,{label:e.$t("entities.thumbnails.select_task_type"),"task-type-list":i.taskTypeList,modelValue:n.taskTypeId,"onUpdate:modelValue":t[1]||(t[1]=p=>n.taskTypeId=p)},null,8,["label","task-type-list","modelValue"]),o("p",null,d(e.$t("entities.thumbnails.explanation_two"))+" "+d(e.$t(`entities.thumbnails.${s.parent}_pattern`)),1),o("label",We,d(e.$t("entities.thumbnails.select_files")),1),k(r,{ref:"preview-field",label:e.$t("main.csv.upload_file"),accept:n.extensions,onFileselected:i.onFileSelected,multiple:!0},null,8,["label","accept","onFileselected"]),i.invalidForms.length?(a(),l("div",et,[o("label",tt,d(e.$t("entities.thumbnails.invalid_files")),1),o("ul",st,[(a(!0),l(b,null,E(i.invalidForms,(p,V)=>(a(),l("li",{key:V},d(p.get("file").name),1))),128))])])):f("",!0),i.thumbnailList.length?(a(),l("label",it,d(e.$t("entities.thumbnails.selected_files")),1)):f("",!0),(a(!0),l(b,null,E(i.thumbnailList,p=>(a(),l("div",{class:"thumbnail-line flexrow",key:p.id},[p.src?f("",!0):(a(),l("img",at)),p.src?(a(),l("img",{key:1,class:"flexrow-item",src:p.src,width:"150",height:"100"},null,8,nt)):f("",!0),o("span",lt,[p.parentName?(a(),l(b,{key:0},[C(d(p.parentName)+" / ",1)],64)):f("",!0),C(" "+d(p.name),1)]),n.loading[p.id]?(a(),A(y,{key:2,size:10})):f("",!0),n.uploaded[p.id]?(a(),A(v,{key:3})):f("",!0)]))),128)),k(g,{"error-text":e.$t("entities.thumbnails.error"),"is-error":s.isError,"is-loading":s.isLoading,"is-disabled":!i.isFormFilled,onConfirm:i.confirm,onCancel:t[2]||(t[2]=p=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","is-disabled","onConfirm"])])])],2)}const qt=_(ze,[["render",ot],["__scopeId","data-v-b96c27d3"]]),Ht={__name:"ComboboxDisplayOptions",props:{type:{type:String,required:!0}},setup(e){const t=e,{t:s}=K(),m=J(()=>{const n=[{label:s("tasks.show_assignations"),value:"showAssignations"},{label:s("tasks.show_infos"),value:"showInfos"},{label:s("tasks.big_thumbnails"),value:"bigThumbnails"},{label:s("tasks.show_contact_sheet"),value:"contactSheetMode"}];return t.type==="shot"?n.push({label:s("shots.show_timecode"),value:"inOutTimecode"}):t.type==="asset"&&n.push({label:s("breakdown.show_library"),value:"showSharedAssets"}),n});return(n,i)=>(a(),A(oe,{options:m.value,thin:"",title:n.$t("entities.display_options")},null,8,["options","title"]))}},rt={name:"create-tasks-modal",mixins:[F],components:{Combobox:U,ComboboxTaskType:q,PageTitle:re},props:{active:{type:Boolean,default:!1},errorText:{type:String,default:""},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isLoadingStay:{type:Boolean,default:!1},text:{type:String,default:""},title:{type:String,default:""}},emits:["cancel","confirm","confirm-and-stay"],data(){return{form:{task_type_id:""},selectionOnly:"true",selectionOptions:[{label:this.$t("tasks.for_selection"),value:"true"},{label:this.$t("tasks.for_project"),value:"false"}]}},computed:{...w(["currentProduction","productionAssetTaskTypes","productionEditTaskTypes","productionEpisodeTaskTypes","productionShotTaskTypes","productionSequenceTaskTypes"]),isAssetTasks(){return this.$route.path.includes("assets")},isShotsTasks(){return this.$route.path.includes("shots")},isSequencesTasks(){return this.$route.path.includes("sequences")},isEditsTasks(){return this.$route.path.includes("edits")},isEpisodesTasks(){return this.$route.path.includes("episodes")}},methods:{getApplicableTaskTypes(){return this.isAssetTasks?this.productionAssetTaskTypes:this.isShotsTasks?this.productionShotTaskTypes:this.isSequencesTasks?this.productionSequenceTaskTypes:this.isEditsTasks?this.productionEditTaskTypes:this.isEpisodesTasks?this.productionEpisodeTaskTypes:[]},confirmClicked(){this.$emit("confirm",{form:this.form,selectionOnly:this.selectionOnly==="true"})},confirmAndStayClicked(){this.$emit("confirm-and-stay",{form:this.form,selectionOnly:this.selectionOnly==="true"})}},mounted(){const e=this.getApplicableTaskTypes();e.length>0&&(this.form.task_type_id=e[0].id)}},dt={class:"modal-content"},mt={class:"box content"},ct={class:"disclaimer"},ut={class:"flexrow"},ht={key:0,class:"error has-text-right info-message"};function pt(e,t,s,m,n,i){const h=u("page-title"),r=u("combobox-task-type"),y=u("router-link"),v=u("combobox");return a(),l("div",{class:T({modal:!0,"is-active":s.active})},[o("div",{class:"modal-background",onClick:t[0]||(t[0]=g=>e.$emit("cancel"))}),o("div",dt,[o("div",mt,[k(h,{text:s.title},null,8,["text"]),o("p",null,d(s.text),1),o("form",{onSubmit:t[2]||(t[2]=S(()=>{},["prevent"])),class:"widden"},[k(r,{class:"mb1","task-type-list":i.getApplicableTaskTypes(),modelValue:n.form.task_type_id,"onUpdate:modelValue":t[1]||(t[1]=g=>n.form.task_type_id=g)},null,8,["task-type-list","modelValue"]),o("div",ct,[k(y,{to:{name:"production-settings",params:{production_id:e.currentProduction?.id},query:{tab:"taskTypes"}},target:"_blank"},{default:O(()=>[C(d(e.$t("tasks.create_tasks_disclaimer")),1)]),_:1},8,["to"])])],32),o("div",ut,[t[7]||(t[7]=o("div",{class:"filler"},null,-1)),k(v,{class:"flexrow-item",options:n.selectionOptions,"with-margin":!1,modelValue:n.selectionOnly,"onUpdate:modelValue":t[3]||(t[3]=g=>n.selectionOnly=g)},null,8,["options","modelValue"]),o("a",{class:T({button:!0,"flexrow-item":!0,"is-primary":!0,"is-loading":s.isLoadingStay}),onClick:t[4]||(t[4]=(...g)=>i.confirmAndStayClicked&&i.confirmAndStayClicked(...g))},d(e.$t("main.confirmation_and_stay")),3),o("a",{class:T({button:!0,"flexrow-item":!0,"is-primary":!0,"is-loading":s.isLoading}),onClick:t[5]||(t[5]=(...g)=>i.confirmClicked&&i.confirmClicked(...g))},d(e.$t("main.confirmation")),3),o("button",{onClick:t[6]||(t[6]=g=>e.$emit("cancel")),class:"button is-link"},d(e.$t("main.cancel")),1)]),s.isError?(a(),l("p",ht,d(s.errorText),1)):f("",!0)])])],2)}const $t=_(rt,[["render",pt],["__scopeId","data-v-1f748d63"]]),ft={name:"sorting-info",components:{ButtonSimple:x},props:{sorting:{type:Array,required:!0}},emits:["clear-sorting"],computed:{text(){return`${this.$t("main.sorted_by")} ${this.sorting[0]?.name}`}}};function kt(e,t,s,m,n,i){const h=u("button-simple");return a(),A(h,{class:"sorting-info mb05 is-small",icon:"remove",text:i.text,title:e.$t("main.clear_sorting"),onClick:t[0]||(t[0]=r=>e.$emit("clear-sorting"))},null,8,["text","title"])}const Nt=_(ft,[["render",kt],["__scopeId","data-v-274b6498"]]);export{qt as A,$t as C,xt as M,Nt as S,Pt as T,Ut as V,Ht as _,Lt as a,Qt as b,Ot as e};
//# sourceMappingURL=SortingInfo-DsYGfVas.js.map
