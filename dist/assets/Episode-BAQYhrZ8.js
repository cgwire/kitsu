import{_ as W,m as j,a as G,O as H,H as K,T as Q,Q as X,R as Y,h as Z,U as J,E as x,X as $,Y as ee,Z as te,$ as se,a0 as ie,B as oe,z as ne,r as n,c as d,o,e as s,l as h,f as r,k as u,d as c,w as y,a1 as m,t as l,F as E,g as k,a7 as re,bb as le,bc as w}from"./index-D4XQA-49.js";import{E as ae,a as de,b as ce,c as ue,e as pe}from"./EntityTaskList-BwLa6NtF.js";import{E as he}from"./EditEpisodeModal-CMYiHrWq.js";import{E as me}from"./EntityChat-C0PqveBZ.js";import"./PeopleNameCell-DNIiv3No.js";const _e={name:"episode",mixins:[pe,ne],components:{ButtonSimple:oe,ChevronLeftIcon:ie,ChevronRightIcon:se,ComboboxNumber:te,CornerLeftUpIcon:ee,DescriptionCell:$,EditEpisodeModal:he,EntityChat:me,EntityNews:ue,EntityPreviewFiles:ce,EntityTaskList:de,EntityTimeLogs:ae,EntityThumbnail:x,PageSubtitle:J,PageTitle:Z,RouteSectionTabs:Y,Schedule:X,TableInfo:Q,TaskInfo:K,TaskTypeName:H},data(){return{type:"episode",currentEpisode:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...G(["currentProduction","getTaskTypePriority","episodeMap","episodeMetadataDescriptors","episodeSearchText","isCurrentUserManager","route","taskMap","taskTypeMap"]),title(){return this.currentEpisode?`${this.currentEpisode.name}`:"Loading..."},currentEntity(){return this.currentEpisode},getEpisodesRoute(){const e={name:"episodes",params:{production_id:this.currentProduction.id,project_id:this.currentProduction.id},query:{search:this.episodeSearchText}};return e.name="episodes",e},nbAssets(){let e=0;return this.currentEpisode&&this.currentSection==="casting"&&this.currentEpisode.castingAssetsByType&&this.currentEpisode.castingAssetsByType.forEach(i=>{e+=i.length}),e}},methods:{...j(["clearSelectedTasks","editEpisode","setCurrentEpisode","loadEpisodesWithTasks","loadEpisodeCasting"]),init(){this.loadCurrentEpisode().then(e=>{this.currentEpisode=e,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentEpisode?this.loadEpisodeCasting(this.currentEpisode).then(()=>{this.casting.isLoading=!1}).catch(i=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(i)}):this.resetData()}).catch(console.error)},async loadCurrentEpisode(){const e=this.route.params.episode_id,i=w.cache.episodeMap.get(e)||null;return!i||!i.validations?(await this.loadEpisodesWithTasks(),w.cache.episodeMap.get(e)||null):i},confirmEditEpisode(e){e.id=this.currentEpisode.id,this.loading.edit=!0,this.errors.edit=!1,this.editEpisode(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const i=this.currentEpisode.id,g={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return le(g,i)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentEpisode().then(e=>(this.currentEpisode=e,this.loadEpisodeCasting(this.currentEpisode))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},ye={class:"columns fixed-page episode xyz-in",xyz:"fade"},fe={class:"column main-column"},ge={class:"page-header flexrow"},Ee={class:"flexrow-item ml2"},ke={class:"flexrow-item"},be={class:"episode-data block"},ve={class:"flexrow infos"},we={class:"flexrow-item flexcolumn entity-infos"},Te={class:"flexrow"},Se={class:"flexrow-item has-text-right"},Ce={class:"table-body"},Le={key:0,class:"datatable no-header"},Me={class:"table-body"},Pe={class:"datatable-row"},ze={class:"field-label"},Be={key:0,class:"datatable-row"},Ie={class:"field-label"},Re={class:"field-label"},De={class:"flexrow"},Ne={class:"episode-casting"},Ae={key:0},Ve={key:0},Ue={class:"asset-type"},qe={class:"asset-list"},Fe={class:"break-word"},Oe={key:0},We={class:"ready-for flexrow"},je={key:1,class:"mt1"},Ge={key:0,class:"schedule mt1"},He={class:"wrapper"},Ke={class:"column side-column"};function Qe(e,i,g,Xe,t,_){const T=n("corner-left-up-icon"),f=n("router-link"),b=n("entity-thumbnail"),S=n("page-title"),C=n("chevron-left-icon"),L=n("chevron-right-icon"),M=n("route-section-tabs"),v=n("page-subtitle"),P=n("entity-task-list"),z=n("button-simple"),B=n("description-cell"),I=n("combobox-number"),R=n("task-type-name"),D=n("table-info"),N=n("schedule"),A=n("entity-chat"),V=n("entity-preview-files"),U=n("entity-time-logs"),q=n("entity-news"),F=n("task-info"),O=n("edit-episode-modal");return o(),d("div",ye,[s("div",fe,[s("div",ge,[r(f,{class:"flexrow-item has-text-centered back-link",to:_.getEpisodesRoute},{default:y(()=>[r(T)]),_:1},8,["to"]),s("span",Ee,[t.currentEpisode?(o(),u(b,{key:0,class:"entity-thumbnail",entity:t.currentEpisode,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):c("",!0)]),s("div",ke,[r(S,{text:_.title,class:"entity-title"},null,8,["text"])]),i[3]||(i[3]=s("div",{class:"filler"},null,-1)),e.previousEntityPath&&e.entityList.length>1?(o(),u(f,{key:0,class:"flexrow-item has-text-centered back-link ml1",to:e.previousEntityPath},{default:y(()=>[r(C)]),_:1},8,["to"])):c("",!0),e.nextEntityPath&&e.entityList.length>1?(o(),u(f,{key:1,class:"flexrow-item has-text-centered back-link",to:e.nextEntityPath},{default:y(()=>[r(L)]),_:1},8,["to"])):c("",!0)]),s("div",be,[r(M,{class:"section-tabs","active-tab":e.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),h(s("div",ve,[s("div",we,[r(v,{text:e.$t("main.tasks")},null,8,["text"]),r(P,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentEpisode,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",Te,[r(v,{text:e.$t("main.info")},null,8,["text"]),i[4]||(i[4]=s("div",{class:"filler"},null,-1)),s("div",Se,[e.isCurrentUserManager?(o(),u(z,{key:0,icon:"edit",title:e.$t("episodes.edit_title"),onClick:i[0]||(i[0]=a=>t.modals.edit=!0)},null,8,["title"])):c("",!0)])]),s("div",Ce,[t.currentEpisode?(o(),d("table",Le,[s("tbody",Me,[s("tr",Pe,[s("td",ze,l(e.$t("shots.fields.description")),1),r(B,{entry:t.currentEpisode,full:!0},null,8,["entry"])]),t.currentEpisode&&t.currentEpisode.data&&t.currentEpisode.data.resolution?(o(),d("tr",Be,[s("td",Ie,l(e.$t("shots.fields.resolution")),1),s("td",null,l(t.currentEpisode?t.currentEpisode.data.resolution:""),1)])):c("",!0),(o(!0),d(E,null,k(e.episodeMetadataDescriptors,a=>(o(),d("tr",{key:a.id,class:"datatable-row"},[s("td",Re,l(a.name),1),s("td",null,l(t.currentEpisode.data?t.currentEpisode.data[a.field_name]:""),1)]))),128))])])):c("",!0)])])],512),[[m,e.currentSection==="infos"]]),s("div",De,[h(s("span",null,l(_.nbAssets)+" "+l(e.$tc("assets.number",_.nbAssets)),513),[[m,e.currentSection==="casting"]]),h(s("span",{class:"tag tag-standby"},l(e.$t("breakdown.fields.standby")),513),[[m,e.currentSection==="casting"&&t.currentEpisode.is_casting_standby]]),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),h(s("span",{class:"flexrow-item mt05"},l(e.$t("schedule.zoom_level"))+": ",513),[[m,e.currentSection==="schedule"]]),h(r(I,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":i[1]||(i[1]=a=>e.zoomLevel=a)},null,8,["options","modelValue"]),[[m,e.currentSection==="schedule"]])]),h(s("div",Ne,[t.currentEpisode?(o(),d("div",Ae,[t.currentEpisode&&t.currentEpisode.castingAssetsByType&&t.currentEpisode.castingAssetsByType[0].length>0?(o(),d("div",Ve,[(o(!0),d(E,null,k(t.currentEpisode.castingAssetsByType,a=>(o(),d("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Ue,l(a.length>0?a[0].asset_type_name:"")+" ("+l(a.length)+") ",1),s("div",qe,[(o(!0),d(E,null,k(a,p=>(o(),u(f,{class:"asset-link",key:p.id,to:_.buildAssetRoute(p)},{default:y(()=>[r(b,{class:"entity-thumbnail",entity:p,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",Fe,[re(l(p.asset_name)+" ",1),p.nb_occurences>1?(o(),d("span",Oe," ("+l(p.nb_occurences)+") ",1)):c("",!0)]),s("div",We,[p.ready_for?(o(),u(R,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(p.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(p.ready_for).name},null,8,["task-type","current-production-id","title"])):c("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(o(),d("div",je,l(e.$t("episodes.no_casting")),1))])):(o(),u(D,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[m,e.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?h((o(),d("div",Ge,[s("div",He,[r(N,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[m,e.currentSection==="schedule"]]):h((o(),d("div",{key:1,class:"mt1"},l(e.$t("main.empty_schedule")),513)),[[m,e.currentSection==="schedule"]]),e.currentSection==="chat"?(o(),u(A,{key:2,entity:t.currentEpisode,name:t.currentEpisode?.name},null,8,["entity","name"])):c("",!0),e.currentSection==="preview-files"?(o(),u(V,{key:3,entity:t.currentEpisode},null,8,["entity"])):c("",!0),e.currentSection==="time-logs"?(o(),u(U,{key:4,entity:t.currentEpisode},null,8,["entity"])):c("",!0)])]),h(s("div",Ke,[r(F,{task:t.currentTask,"entity-type":"Episode","with-actions":""},{default:y(()=>[r(q,{class:"news-column",entity:t.currentEpisode},null,8,["entity"])]),_:1},8,["task"])],512),[[m,e.currentSection==="infos"]]),r(O,{ref:"edit-episode-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"episode-to-edit":t.currentEpisode,onCancel:i[2]||(i[2]=a=>t.modals.edit=!1),onConfirm:_.confirmEditEpisode},null,8,["active","is-loading","is-error","episode-to-edit","onConfirm"])])}const et=W(_e,[["render",Qe],["__scopeId","data-v-c00d661f"]]);export{et as default};
//# sourceMappingURL=Episode-BAQYhrZ8.js.map
