import{_ as j,m as G,a as H,O as K,H as Q,T as W,Q as X,R as Y,U as Z,E as J,cW as x,X as $,Y as tt,$ as et,a0 as st,Z as nt,B as ot,z as it,r,c as l,o as n,e as s,l as m,f as c,k as d,d as h,w as p,t as i,a1 as _,F as g,g as k,n as rt,a7 as T,bb as lt,b$ as at}from"./index-BcnNiyx_.js";import{E as ct,a as ht,b as ut,c as dt,e as mt}from"./EntityTaskList-CbKxtckd.js";import{E as _t}from"./EntityChat-C_GpJ7t2.js";import"./PeopleNameCell-69m8LrQp.js";const ft={name:"shot",mixins:[mt,it],components:{ButtonSimple:ot,ComboboxNumber:nt,ChevronLeftIcon:st,ChevronRightIcon:et,CornerLeftUpIcon:tt,DescriptionCell:$,EditShotModal:x,EntityChat:_t,EntityNews:dt,EntityPreviewFiles:ut,EntityTaskList:ht,EntityTimeLogs:ct,EntityThumbnail:J,PageSubtitle:Z,RouteSectionTabs:Y,Schedule:X,TableInfo:W,TaskInfo:Q,TaskTypeName:K},data(){return{type:"shot",currentShot:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...H(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","route","shotMap","shotMetadataDescriptors","shotSearchText","shotsPath","taskMap","taskTypeMap"]),title(){return this.currentShot?this.currentShot.episode_name?`${this.currentShot.episode_name} / ${this.currentShot.sequence_name} / ${this.currentShot.name}`:`${this.currentShot.sequence_name} / ${this.currentShot.name}`:"Loading..."},shotThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentShot.preview_file_id}.png`},isPreview(){return this.currentShot&&this.currentShot.preview_file_id&&this.currentShot.preview_file_id.length>0},getShotsRoute(){const t={name:"shots",params:{production_id:this.currentProduction.id},query:{search:this.shotSearchText}};return this.currentEpisode&&(t.name="episode-shots",t.params.episode_id=this.currentEpisode.id),t},nbAssets(){let t=0;return this.currentShot&&this.currentSection==="casting"&&this.currentShot.castingAssetsByType&&this.currentShot.castingAssetsByType.forEach(o=>{t+=o.length}),t}},methods:{...G(["clearSelectedTasks","editShot","loadShot","loadShotCasting"]),changeTab(t){this.selectedTab=t},getCurrentShot(){return new Promise((t,o)=>{const S=this.route.params.shot_id,b=at.cache.shotMap.get(S)||null;return b?t(b):this.loadShot(S).then(t)})},onEditClicked(){this.modals.edit=!0},confirmEditShot(t){t.id=this.currentShot.id,t.data.resolution=t.resolution,t.data.max_retakes=t.max_retakes,t.data.frame_in=t.frameIn,t.data.frame_out=t.frameOut,t.data.fps=t.fps,this.loading.edit=!0,this.errors.edit=!1,this.editShot(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(o=>{console.error(o),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(t){let o=t.episode_id;this.isTVShow&&!o&&(o="main");const S={name:"asset",params:{production_id:this.currentProduction.id,asset_id:t.asset_id}};return lt(S,o)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.getCurrentShot().then(t=>(this.currentShot=t,this.loadShotCasting(this.currentShot))).then(()=>{this.casting.isLoading=!1}).catch(t=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(t)})})},init(){this.getCurrentShot().then(t=>{this.currentShot=t,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentShot?this.loadShotCasting(this.currentShot).then(()=>{this.casting.isLoading=!1,setTimeout(this.initSchedule,100)}).catch(o=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(o)}):(this.resetData(),setTimeout(this.initSchedule,100))}).catch(console.error)},initSchedule(){this.$refs["schedule-widget"]?.scrollToDate(this.scheduleItems[0].startDate)}},watch:{$route(){const t=this.route.params.shot_id;this.currentAsset&&this.currentShot.id!==t&&this.init(),this.currentSection=this.route.query.section||"infos"}},head(){return{title:`${this.title} - Kitsu`}}},St={class:"columns fixed-page shot xyz-in",xyz:"fade"},pt={class:"column main-column"},yt={class:"page-header flexrow"},gt={class:"flexrow-item ml2"},bt={class:"entity-title flexrow-item"},kt={class:"entity-data block"},vt={class:"flexrow mt1"},wt={class:"flexcolumn infos"},Tt={class:"flexrow"},Ct={class:"flexrow-item has-text-right"},Et={class:"table-body"},Lt={key:0,class:"datatable no-header"},It={class:"datatable-body"},Pt={class:"datatable-row"},Mt={class:"field-label"},zt={class:"datatable-row"},Bt={class:"field-label"},Dt={key:0,class:"datatable-row"},Rt={class:"field-label"},Vt={key:1,class:"datatable-row"},At={class:"field-label"},Nt={key:2,class:"datatable-row"},qt={class:"field-label"},Ut={key:3,class:"datatable-row"},Ft={class:"field-label"},Ot={key:4,class:"datatable-row"},jt={class:"field-label"},Gt={class:"field-label"},Ht={class:"shot-casting"},Kt={key:0},Qt={key:0},Wt={class:"asset-type"},Xt={class:"asset-list"},Yt={class:"break-word"},Zt={key:0,class:"ready-for flexrow"},Jt={key:1,class:"mt1"},xt={key:1,class:"schedule mt1"},$t={class:"wrapper"},te={class:"column side-column"};function ee(t,o,S,b,e,f){const C=r("corner-left-up-icon"),y=r("router-link"),v=r("entity-thumbnail"),E=r("chevron-left-icon"),L=r("chevron-right-icon"),I=r("route-section-tabs"),P=r("combobox-number"),w=r("page-subtitle"),M=r("entity-task-list"),z=r("button-simple"),B=r("description-cell"),D=r("entity-chat"),R=r("task-type-name"),V=r("table-info"),A=r("schedule"),N=r("entity-preview-files"),q=r("entity-time-logs"),U=r("entity-news"),F=r("task-info"),O=r("edit-shot-modal");return n(),l("div",St,[s("div",pt,[s("div",yt,[c(y,{class:"flexrow-item has-text-centered back-link",to:f.getShotsRoute},{default:p(()=>[c(C)]),_:1},8,["to"]),s("span",gt,[e.currentShot?(n(),d(v,{key:0,class:"entity-thumbnail",entity:e.currentShot,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):h("",!0)]),s("div",bt,i(f.title),1),o[4]||(o[4]=s("div",{class:"filler"},null,-1)),t.previousEntityPath&&t.entityList.length>1?(n(),d(y,{key:0,class:"flexrow-item has-text-centered back-link ml1",to:t.previousEntityPath},{default:p(()=>[c(E)]),_:1},8,["to"])):h("",!0),t.nextEntityPath&&t.entityList.length>1?(n(),d(y,{key:1,class:"flexrow-item has-text-centered back-link",to:t.nextEntityPath},{default:p(()=>[c(L)]),_:1},8,["to"])):h("",!0)]),s("div",kt,[c(I,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:t.entityTabs},null,8,["active-tab","route","tabs"]),s("div",vt,[m(s("span",null,i(f.nbAssets)+" "+i(t.$tc("assets.number",f.nbAssets)),513),[[_,t.currentSection==="casting"]]),m(s("span",{class:"tag tag-standby"},i(t.$t("breakdown.fields.standby")),513),[[_,t.currentSection==="casting"&&e.currentShot&&e.currentShot.is_casting_standby]]),o[5]||(o[5]=s("div",{class:"filler"},null,-1)),m(s("span",{class:"flexrow-item mt05"},i(t.$t("schedule.zoom_level"))+": ",513),[[_,t.currentSection==="schedule"]]),m(c(P,{class:"zoom-level flexrow-item",options:t.zoomOptions,"is-simple":"",modelValue:t.zoomLevel,"onUpdate:modelValue":o[0]||(o[0]=a=>t.zoomLevel=a)},null,8,["options","modelValue"]),[[_,t.currentSection==="schedule"]])]),m(s("div",wt,[c(w,{text:t.$t("shots.tasks")},null,8,["text"]),c(M,{class:"task-list",entries:t.currentTasks,"is-loading":!e.currentShot,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",Tt,[c(w,{text:t.$t("main.info")},null,8,["text"]),o[6]||(o[6]=s("div",{class:"filler"},null,-1)),s("div",Ct,[t.isCurrentUserManager?(n(),d(z,{key:0,icon:"edit",title:t.$t("shots.edit_title"),onClick:o[1]||(o[1]=a=>e.modals.edit=!0)},null,8,["title"])):h("",!0)])]),s("div",Et,[e.currentShot?(n(),l("table",Lt,[s("tbody",It,[s("tr",Pt,[s("td",Mt,i(t.$t("shots.fields.description")),1),c(B,{entry:e.currentShot,full:!0},null,8,["entry"])]),s("tr",zt,[s("td",Bt,i(t.$t("shots.fields.nb_frames")),1),s("td",null,i(e.currentShot?e.currentShot.nb_frames:""),1)]),e.currentShot&&e.currentShot.data&&e.currentShot.data.frame_in!=null?(n(),l("tr",Dt,[s("td",Rt,i(t.$t("shots.fields.frame_in")),1),s("td",null,i(e.currentShot?e.currentShot.data.frame_in:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.frame_out?(n(),l("tr",Vt,[s("td",At,i(t.$t("shots.fields.frame_out")),1),s("td",null,i(e.currentShot?e.currentShot.data.frame_out:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.fps?(n(),l("tr",Nt,[s("td",qt,i(t.$t("shots.fields.fps")),1),s("td",null,i(e.currentShot?e.currentShot.data.fps:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.resolution?(n(),l("tr",Ut,[s("td",Ft,i(t.$t("shots.fields.resolution")),1),s("td",null,i(e.currentShot?e.currentShot.data.resolution:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.max_retakes?(n(),l("tr",Ot,[s("td",jt,i(t.$t("shots.fields.max_retakes")),1),s("td",null,i(e.currentShot?e.currentShot.data.max_retakes:""),1)])):h("",!0),(n(!0),l(g,null,k(t.shotMetadataDescriptors,a=>(n(),l("tr",{key:a.id,class:"datatable-row"},[s("td",Gt,i(a.name),1),s("td",null,i(e.currentShot&&e.currentShot.data?e.currentShot.data[a.field_name]:""),1)]))),128))])])):h("",!0)])],512),[[_,t.currentSection==="infos"]]),t.currentSection==="chat"?(n(),d(D,{key:0,entity:e.currentShot,name:e.currentShot?e.currentShot.full_name:""},null,8,["entity","name"])):h("",!0),m(s("div",Ht,[e.currentShot?(n(),l("div",Kt,[e.currentShot&&e.currentShot.castingAssetsByType&&e.currentShot.castingAssetsByType[0].length>0?(n(),l("div",Qt,[(n(!0),l(g,null,k(e.currentShot.castingAssetsByType,a=>(n(),l("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Wt,i(a.length>0?a[0].asset_type_name:"")+" ("+i(a.length)+") ",1),s("div",Xt,[(n(!0),l(g,null,k(a,u=>(n(),d(y,{class:"asset-link",key:u.id,to:f.buildAssetRoute(u)},{default:p(()=>[c(v,{class:rt(["entity-thumbnail",{shared:u.shared}]),entity:u,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),s("div",Yt,[T(i(u.asset_name)+" ",1),u.nb_occurences>1?(n(),l(g,{key:0},[T(" ("+i(u.nb_occurences)+") ",1)],64)):h("",!0)]),!u.shared&&u.ready_for?(n(),l("div",Zt,[c(R,{class:"flexrow-item","task-type":t.taskTypeMap.get(u.ready_for),"current-production-id":t.currentProduction.id,title:"Ready for: "+t.taskTypeMap.get(u.ready_for).name},null,8,["task-type","current-production-id","title"])])):h("",!0)]),_:2},1032,["to"]))),128))])]))),128))])):(n(),l("div",Jt,i(t.$t("shots.no_casting")),1))])):(n(),d(V,{key:1,"is-loading":e.casting.isLoading,"is-error":e.casting.isError},null,8,["is-loading","is-error"]))],512),[[_,t.currentSection==="casting"]]),t.scheduleItems[0].children.length>0?m((n(),l("div",xt,[s("div",$t,[c(A,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:o[2]||(o[2]=a=>t.saveTaskScheduleItem(a.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[_,t.currentSection==="schedule"]]):h("",!0),t.currentSection==="preview-files"?(n(),d(N,{key:2,entity:e.currentShot},null,8,["entity"])):h("",!0),t.currentSection==="time-logs"?(n(),d(q,{key:3,entity:e.currentShot},null,8,["entity"])):h("",!0)])]),m(s("div",te,[c(F,{task:e.currentTask,"entity-type":"Shot","with-actions":""},{default:p(()=>[c(U,{class:"news-column",entity:e.currentShot},null,8,["entity"])]),_:1},8,["task"])],512),[[_,t.currentSection==="infos"]]),c(O,{ref:"edit-shot-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"shot-to-edit":e.currentShot,onCancel:o[3]||(o[3]=a=>e.modals.edit=!1),onConfirm:f.confirmEditShot},null,8,["active","is-loading","is-error","shot-to-edit","onConfirm"])])}const re=j(ft,[["render",ee],["__scopeId","data-v-b853f215"]]);export{re as default};
//# sourceMappingURL=Shot-SBXVU0gq.js.map
