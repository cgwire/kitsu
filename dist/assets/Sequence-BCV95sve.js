import{_ as F,m as O,a as W,O as G,H,T as K,R as Q,Q as X,h as Y,U as Z,E as j,X as J,Y as $,Z as ee,$ as te,a0 as se,B as ne,z as ie,r as o,c as l,o as i,e as s,l as m,f as r,k as d,d as h,w as f,a1 as _,t as a,F as S,g as q,n as oe,a7 as re,bb as ce,c1 as le,b6 as ae}from"./index-pCmEavk1.js";import{E as ue,a as de,b as he,c as me,e as _e}from"./EntityTaskList-BHmCF9AV.js";import{E as ye}from"./EditSequenceModal-DvbHFgdG.js";import{E as pe}from"./EntityChat-CCAZ8_lO.js";import"./PeopleNameCell-DZJHLKyM.js";const fe={name:"sequence",mixins:[_e,ie],components:{ButtonSimple:ne,ChevronLeftIcon:se,ChevronRightIcon:te,ComboboxNumber:ee,CornerLeftUpIcon:$,DescriptionCell:J,EditSequenceModal:ye,EntityChat:pe,EntityNews:me,EntityPreviewFiles:he,EntityTaskList:de,EntityTimeLogs:ue,EntityThumbnail:j,PageSubtitle:Z,PageTitle:Y,Schedule:X,RouteSectionTabs:Q,TableInfo:K,TaskInfo:H,TaskTypeName:G},data(){return{type:"sequence",currentSequence:null,currentTask:null,currentSection:"infos",casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...W(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","sequenceMap","sequenceMetadataDescriptors","sequenceSearchText","route","taskMap","taskTypeMap"]),title(){return this.currentSequence?this.currentEpisode?`${this.currentEpisode.name} / ${this.currentSequence.name}`:`${this.currentSequence.name}`:"Loading..."},currentEntity(){return this.currentSequence},getSequencesRoute(){const e=this.currentProduction.id,n=this.currentEpisode?.id,p=ae(e,"sequences",n);return p.query={search:this.sequenceSearchText},p},nbAssets(){let e=0;return this.currentSequence&&this.currentSection==="casting"&&this.currentSequence.castingAssetsByType&&this.currentSequence.castingAssetsByType.forEach(n=>{e+=n.length}),e}},methods:{...O(["clearSelectedTasks","editSequence","setCurrentSequence","loadEpisodes","loadSequencesWithTasks","loadSequenceCasting"]),async init(){try{if(this.currentSequence=await this.loadCurrentSequence(),this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentSequence)try{await this.loadSequenceCasting(this.currentSequence),this.casting.isLoading=!1}catch(e){this.casting.isLoading=!1,this.casting.isError=!0,console.error(e)}else this.resetData()}catch(e){console.error(e)}},async loadCurrentSequence(){const e=this.route.params.sequence_id;let n=this.sequenceMap.get(e)||null;return(!n||!n.validations)&&(this.isTVShow&&await this.loadEpisodes(),await this.loadSequencesWithTasks(),n=le.cache.sequenceMap.get(e)||null),n},confirmEditSequence(e){e.id=this.currentSequence.id,this.loading.edit=!0,this.errors.edit=!1,this.editSequence(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(n=>{console.error(n),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const n=this.isTVShow?this.currentEpisode?.id||"main":null,p={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return ce(p,n)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentSequence().then(e=>(this.currentSequence=e,this.loadSequenceCasting(this.currentSequence))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},ge={class:"columns fixed-page sequence xyz-in",xyz:"fade"},Se={class:"column main-column"},qe={class:"page-header flexrow"},ke={class:"flexrow-item ml2"},be={class:"flexrow-item"},ve={class:"sequence-data block"},we={class:"flexrow infos"},Te={class:"flexrow-item flexcolumn entity-infos"},Ee={class:"flexrow"},Ce={class:"flexrow-item has-text-right"},Le={class:"table-body"},Ie={key:0,class:"datatable no-header"},Me={class:"table-body"},Pe={class:"datatable-row"},ze={class:"field-label"},xe={class:"field-label"},Be={class:"flexrow"},Re={class:"sequence-casting"},Ve={class:"casting-data mt1"},De={key:0},Ae={key:0},Ne={class:"asset-type"},Ue={class:"asset-list"},Fe={class:"break-word"},Oe={key:0},We={class:"ready-for flexrow"},Ge={key:1,class:"mt1"},He={key:0,class:"schedule mt1"},Ke={class:"wrapper"},Qe={class:"column side-column"};function Xe(e,n,p,Ye,t,y){const v=o("corner-left-up-icon"),g=o("router-link"),k=o("entity-thumbnail"),w=o("page-title"),T=o("chevron-left-icon"),E=o("chevron-right-icon"),C=o("route-section-tabs"),b=o("page-subtitle"),L=o("entity-task-list"),I=o("button-simple"),M=o("description-cell"),P=o("combobox-number"),z=o("task-type-name"),x=o("table-info"),B=o("schedule"),R=o("entity-chat"),V=o("entity-preview-files"),D=o("entity-time-logs"),A=o("entity-news"),N=o("task-info"),U=o("edit-sequence-modal");return i(),l("div",ge,[s("div",Se,[s("div",qe,[r(g,{class:"flexrow-item has-text-centered back-link",to:y.getSequencesRoute},{default:f(()=>[r(v)]),_:1},8,["to"]),s("span",ke,[t.currentSequence?(i(),d(k,{key:0,class:"entity-thumbnail",entity:t.currentSequence,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):h("",!0)]),s("div",be,[r(w,{text:y.title,class:"entity-title"},null,8,["text"])]),n[3]||(n[3]=s("div",{class:"filler"},null,-1)),e.previousEntityPath&&e.entityList.length>1?(i(),d(g,{key:0,class:"flexrow-item has-text-centered back-link ml1",to:e.previousEntityPath},{default:f(()=>[r(T)]),_:1},8,["to"])):h("",!0),e.nextEntityPath&&e.entityList.length>1?(i(),d(g,{key:1,class:"flexrow-item has-text-centered back-link",to:e.nextEntityPath},{default:f(()=>[r(E)]),_:1},8,["to"])):h("",!0)]),s("div",ve,[r(C,{class:"section-tabs","active-tab":t.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),m(s("div",we,[s("div",Te,[r(b,{text:e.$t("main.tasks")},null,8,["text"]),r(L,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentSequence,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",Ee,[r(b,{text:e.$t("main.info")},null,8,["text"]),n[4]||(n[4]=s("div",{class:"filler"},null,-1)),s("div",Ce,[e.isCurrentUserManager?(i(),d(I,{key:0,icon:"edit",title:e.$t("sequences.edit_title"),onClick:n[0]||(n[0]=c=>t.modals.edit=!0)},null,8,["title"])):h("",!0)])]),s("div",Le,[t.currentSequence?(i(),l("table",Ie,[s("tbody",Me,[s("tr",Pe,[s("td",ze,a(e.$t("shots.fields.description")),1),r(M,{entry:t.currentSequence,full:!0},null,8,["entry"])]),(i(!0),l(S,null,q(e.sequenceMetadataDescriptors,c=>(i(),l("tr",{key:c.id,class:"datatable-row"},[s("td",xe,a(c.name),1),s("td",null,a(t.currentSequence.data?t.currentSequence.data[c.field_name]:""),1)]))),128))])])):h("",!0)])])],512),[[_,t.currentSection==="infos"]]),s("div",Be,[n[5]||(n[5]=s("div",{class:"filler"},null,-1)),m(s("span",{class:"flexrow-item mt05"},a(e.$t("schedule.zoom_level"))+": ",513),[[_,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]]),m(r(P,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":n[1]||(n[1]=c=>e.zoomLevel=c)},null,8,["options","modelValue"]),[[_,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]])]),m(s("div",Re,[s("div",Ve,[m(s("span",null,a(y.nbAssets)+" "+a(e.$tc("assets.number",y.nbAssets)),513),[[_,t.currentSection==="casting"&&y.nbAssets>0]]),m(s("span",{class:"tag tag-standby"},a(e.$t("breakdown.fields.standby")),513),[[_,t.currentSection==="casting"&&t.currentSequence&&t.currentSequence.is_casting_standby]])]),t.currentSequence?(i(),l("div",De,[t.currentSequence&&t.currentSequence.castingAssetsByType&&t.currentSequence.castingAssetsByType[0].length>0?(i(),l("div",Ae,[(i(!0),l(S,null,q(t.currentSequence.castingAssetsByType,c=>(i(),l("div",{class:"type-assets",key:c.length>0?c[0].asset_type_name:""},[s("div",Ne,a(c.length>0?c[0].asset_type_name:"")+" ("+a(c.length)+") ",1),s("div",Ue,[(i(!0),l(S,null,q(c,u=>(i(),d(g,{class:"asset-link",key:u.id,to:y.buildAssetRoute(u)},{default:f(()=>[r(k,{class:oe(["entity-thumbnail",{shared:u.shared}]),entity:u,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),s("div",Fe,[re(a(u.asset_name)+" ",1),u.nb_occurences>1?(i(),l("span",Oe," ("+a(u.nb_occurences)+") ",1)):h("",!0)]),s("div",We,[u.ready_for?(i(),d(z,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(u.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(u.ready_for).name},null,8,["task-type","current-production-id","title"])):h("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(i(),l("div",Ge,a(e.$t("sequences.no_casting")),1))])):(i(),d(x,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[_,t.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?m((i(),l("div",He,[s("div",Ke,[r(B,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[_,t.currentSection==="schedule"]]):m((i(),l("div",{key:1,class:"mt1"},a(e.$t("main.empty_schedule")),513)),[[_,t.currentSection==="schedule"]]),t.currentSection==="chat"?(i(),d(R,{key:2,entity:t.currentSequence,name:t.currentSequence?.full_name},null,8,["entity","name"])):h("",!0),t.currentSequence&&t.currentSection==="preview-files"?(i(),d(V,{key:3,entity:t.currentSequence},null,8,["entity"])):h("",!0),t.currentSequence&&t.currentSection==="time-logs"?(i(),d(D,{key:4,entity:t.currentSequence},null,8,["entity"])):h("",!0)])]),m(s("div",Qe,[r(N,{task:t.currentTask,"entity-type":"Sequence","with-actions":""},{default:f(()=>[r(A,{class:"news-column",entity:t.currentSequence},null,8,["entity"])]),_:1},8,["task"])],512),[[_,t.currentSection==="infos"]]),r(U,{ref:"edit-sequence-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"sequence-to-edit":t.currentSequence,onCancel:n[2]||(n[2]=c=>t.modals.edit=!1),onConfirm:y.confirmEditSequence},null,8,["active","is-loading","is-error","sequence-to-edit","onConfirm"])])}const tt=F(fe,[["render",Xe],["__scopeId","data-v-9a89e1ca"]]);export{tt as default};
//# sourceMappingURL=Sequence-BCV95sve.js.map
