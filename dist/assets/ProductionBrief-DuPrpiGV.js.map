{"version":3,"file":"ProductionBrief-DuPrpiGV.js","sources":["../../src/components/pages/production/ProductionBrief.vue"],"sourcesContent":["<template>\n  <div class=\"production-brief\">\n    <div v-if=\"!isEditing\" class=\"box\" @dblclick=\"openEditing\">\n      <div v-if=\"!currentProduction?.description\">\n        <p>{{ $t('productions.brief.empty') }}</p>\n      </div>\n      <div\n        class=\"content\"\n        v-html=\"renderMarkdown(currentProduction.description)\"\n        v-else\n      ></div>\n    </div>\n    <div v-else class=\"box has-text-right\">\n      <textarea-field\n        class=\"editor\"\n        ref=\"textarea\"\n        input-class=\"textarea\"\n        @keyup.ctrl.enter=\"editBrief\"\n        v-model=\"brief\"\n      />\n      <p v-if=\"errors.editBrief\" class=\"error mt1 has-text-right\">\n        {{ $t('productions.brief.edit_error') }}\n      </p>\n      <p>\n        <button-simple\n          :is-primary=\"true\"\n          :is-loading=\"isLoading\"\n          :disabled=\"isLoading\"\n          :text=\"$t('main.save')\"\n          @click=\"editBrief\"\n        />\n      </p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\n\nimport { renderMarkdown } from '@/lib/render'\n\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\nimport TextareaField from '@/components/widgets/TextareaField.vue'\n\nexport default {\n  name: 'production-brief',\n\n  components: {\n    ButtonSimple,\n    TextareaField\n  },\n\n  data() {\n    return {\n      brief: '',\n      isEditing: false,\n      isLoading: false,\n      errors: {\n        editBrief: false\n      }\n    }\n  },\n\n  computed: {\n    ...mapGetters(['currentProduction', 'isCurrentUserManager']),\n\n    textarea() {\n      return this.$refs.textarea\n    }\n  },\n\n  mounted() {\n    this.brief = this.currentProduction?.description\n  },\n\n  methods: {\n    ...mapActions(['editProduction']),\n\n    openEditing() {\n      if (!this.isCurrentUserManager) {\n        return\n      }\n      this.isEditing = true\n      this.$nextTick(() => {\n        // Needed because of the v-if\n        this.textarea.focus()\n      })\n    },\n\n    async editBrief() {\n      this.isLoading = true\n      this.errors.editBrief = false\n      try {\n        await this.editProduction({\n          id: this.currentProduction.id,\n          description: this.brief\n        })\n        this.isEditing = false\n      } catch {\n        this.errors.editBrief = true\n      }\n      this.isLoading = false\n    },\n\n    renderMarkdown\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .content {\n    color: $white;\n  }\n}\n\n.production-brief {\n  flex: 1;\n}\n\n.box {\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  height: calc(100% - 20px);\n  max-width: 800px;\n  overflow: auto;\n  margin-bottom: 0.5em;\n}\n\n.content {\n  padding-bottom: 1em;\n}\n\n.editor {\n  height: 100%;\n}\n</style>\n"],"names":["_sfc_main","ButtonSimple","TextareaField","mapGetters","mapActions","renderMarkdown","_hoisted_1","_hoisted_3","_openBlock","_createElementBlock","$data","_hoisted_4","_createVNode","_component_textarea_field","_withKeys","_withModifiers","$options","_cache","$event","_hoisted_5","_toDisplayString","_ctx","_createCommentVNode","_createElementVNode","_component_button_simple","args","_hoisted_2"],"mappings":"8IA4CA,MAAKA,EAAU,CACb,KAAM,mBAEN,WAAY,CACV,aAAAC,EACA,cAAAC,GAGF,MAAO,CACL,MAAO,CACL,MAAO,GACP,UAAW,GACX,UAAW,GACX,OAAQ,CACN,UAAW,EACb,CACF,CACF,EAEA,SAAU,CACR,GAAGC,EAAW,CAAC,oBAAqB,sBAAsB,CAAC,EAE3D,UAAW,CACT,OAAO,KAAK,MAAM,QACpB,GAGF,SAAU,CACR,KAAK,MAAQ,KAAK,mBAAmB,WACvC,EAEA,QAAS,CACP,GAAGC,EAAW,CAAC,gBAAgB,CAAC,EAEhC,aAAc,CACP,KAAK,uBAGV,KAAK,UAAY,GACjB,KAAK,UAAU,IAAM,CAEnB,KAAK,SAAS,MAAK,CACrB,CAAC,EACH,EAEA,MAAM,WAAY,CAChB,KAAK,UAAY,GACjB,KAAK,OAAO,UAAY,GACxB,GAAI,CACF,MAAM,KAAK,eAAe,CACxB,GAAI,KAAK,kBAAkB,GAC3B,YAAa,KAAK,MACnB,EACD,KAAK,UAAY,EACnB,MAAQ,CACN,KAAK,OAAO,UAAY,EAC1B,CACA,KAAK,UAAY,EACnB,EAEA,eAAAC,CACF,CACF,EAzGOC,EAAA,CAAA,MAAM,kBAAkB,KAD/B,IAAA,CAAA,EAAAC,EAAA,CAAA,WAAA,KAAA,IAAA,EAYgB,MAAM,yBAZtB,IAAA,EAoBiC,MAAM,qGAnBrC,OAAAC,EAAA,EAAAC,EAgCM,MAhCNH,EAgCM,CA/BQI,EAAA,WAUZF,IAAAC,EAoBM,MApBNE,EAoBM,CAnBJC,EAMEC,EAAA,CALA,MAAM,SACN,IAAI,WACJ,cAAY,WACX,QAjBTC,EAAAC,EAiB2BC,EAAA,UAAS,CAAA,MAAA,CAAA,EAAA,CAAA,OAAA,CAAA,EAjBpC,WAkBiBN,EAAA,MAlBjB,sBAAAO,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,GAkBiBR,EAAA,MAAKQ,qCAEPR,EAAA,OAAO,eAAhBD,EAEI,IAFJU,EAEIC,EADCC,EAAA,GAAE,8BAAA,CAAA,EAAA,CAAA,GArBbC,EAAA,GAAA,EAAA,EAuBMC,EAQI,IAAA,KAAA,CAPFX,EAMEY,EAAA,CALC,aAAY,GACZ,aAAYd,EAAA,UACZ,SAAUA,EAAA,UACV,KAAMW,EAAA,GAAE,WAAA,EACR,QAAOL,EAAA,wEA3BdP,EASM,MAAA,CAXV,IAAA,EAE2B,MAAM,MAAO,+BAAUO,EAAA,aAAAA,EAAA,YAAA,GAAAS,CAAA,KAChCJ,EAAA,mBAAmB,iBAG/BZ,EAIO,MAAA,CAVb,IAAA,EAOQ,MAAM,UACN,UAAQO,EAAA,eAAeK,EAAA,kBAAkB,WAAW,CAR5D,EAAA,KAAA,EAAAd,CAAA,IAGMC,IAAAC,EAEM,MALZiB,EAAA,CAIQH,EAA0C,WAApCF,EAAA,GAAE,yBAAA,CAAA,EAAA,CAAA"}