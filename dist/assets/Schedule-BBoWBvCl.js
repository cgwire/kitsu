import{_ as H,B as J,M as Q,r as _,q as Z,o as l,c as r,d as f,t as w,k as L,f as B,g as x,h as m,n as b,bw as E,S as $,P as ee,bx as te,R as se,aL as ie,by as ae,C as ne,W as le,aP as re,m as W,aF as z,aG as oe,as as P,ao as V,bz as de,bA as j,a as he,b as ce,v as O,F as p,e as S,i as D,w as U,H as A}from"./index-C2m_IhNF.js";import{d as ue}from"./dom-tO7tlkHV.js";import{f as fe}from"./format-CUjWrpVJ.js";import{D as me}from"./DepartmentName-C_7ZW05X.js";import{M as ye}from"./ModalFooter-BJ98b-60.js";import{T as De}from"./TextField-p_HJuEKt.js";import{L as ge}from"./list-chevrons-up-down-ByJjEZOU.js";import{B as be}from"./briefcase-DXQKuIYE.js";const we={name:"edit-milestone-modal",mixins:[Q],components:{ButtonSimple:J,ModalFooter:ye,TextField:De},props:{active:{type:Boolean,default:!1},milestoneToEdit:{type:Object,default:()=>{}},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1}},emits:["cancel","confirm","remove-milestone"],data(){return{form:{name:""}}},mounted(){this.reset(),this.$nextTick(()=>{this.$refs.nameField.focus()})},computed:{isEdit(){return this.milestoneToEdit.id!==void 0},isFormFilled(){return this.form.name.length>0}},methods:{confirm(){return this.$emit("confirm",this.form)},reset(){this.form={id:this.milestoneToEdit.id||void 0,name:this.milestoneToEdit.name||"",date:this.milestoneToEdit.date}}},watch:{active(){this.active&&(this.reset(),setTimeout(()=>{this.$refs.nameField.focus()},1e3))}}},ve={class:"modal-content"},ke={class:"box content"},pe={key:0,class:"title"},_e={key:1,class:"title"};function Se(e,t,i,d,o,s){const c=_("text-field"),h=_("button-simple"),u=_("modal-footer"),g=Z("focus");return l(),r("div",{class:b({modal:!0,"is-active":i.active})},[f("div",{class:"modal-background",onClick:t[0]||(t[0]=v=>e.$emit("cancel"))}),f("div",ve,[f("div",ke,[s.isEdit?(l(),r("h1",_e,w(e.$t("schedule.milestone.edit_milestone"))+": "+w(i.milestoneToEdit.date.format("YYYY-MM-DD")),1)):(l(),r("h1",pe,w(e.$t("schedule.milestone.add_milestone"))+": "+w(i.milestoneToEdit.date.format("YYYY-MM-DD")),1)),L(B(c,{ref:"nameField",label:e.$t("schedule.milestone.name"),maxlength:40,modelValue:o.form.name,"onUpdate:modelValue":t[1]||(t[1]=v=>o.form.name=v),modelModifiers:{trim:!0},onEnter:s.confirm},null,8,["label","modelValue","onEnter"]),[[g]]),s.isEdit?(l(),x(h,{key:2,class:"button is-link error",text:e.$t("schedule.milestone.delete_milestone"),onClick:t[2]||(t[2]=v=>e.$emit("remove-milestone",i.milestoneToEdit))},null,8,["text"])):m("",!0),B(u,{"error-text":e.$t("schedule.milestone.error"),"is-error":i.isError,"is-loading":i.isLoading,"is-disabled":!s.isFormFilled,onConfirm:s.confirm,onCancel:t[3]||(t[3]=v=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","is-disabled","onConfirm"])])])],2)}const Me=H(we,[["render",Se]]),Te={name:"schedule",mixins:[ue,fe],components:{BriefcaseIcon:be,ChevronDownIcon:le,ChevronRightIcon:ne,DepartmentName:me,EditIcon:ae,EditMilestoneModal:Me,LinkIcon:ie,ListChevronsUpDownIcon:ge,PeopleAvatar:se,PlusIcon:te,ProductionName:ee,Spinner:$},data(){return{currentElement:null,selection:[],isBrowsingX:!1,isBrowsingY:!1,isChangeDates:!1,isChangeStartDate:!1,isChangeEndDate:!1,milestoneToEdit:{date:W()},errors:{edit:!1},modals:{edit:!1},loading:{edit:!1},domEvents:[["mousemove",this.onMouseMove],["touchmove",this.onMouseMove],["mouseup",this.stopBrowsing],["mouseleave",this.stopBrowsing],["touchend",this.stopBrowsing],["touchcancel",this.stopBrowsing],["resize",this.resetScheduleSize]]}},props:{daysOff:{type:Array,default:()=>[]},draggedItems:{type:Array,default:()=>[]},endDate:{type:Object,required:!0},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!0},hideEntities:{type:Boolean,default:!1},hideManDays:{type:Boolean,default:!1},hierarchy:{default:()=>[],type:Array},invertLinesColor:{type:Boolean,default:!1},showExpandAll:{type:Boolean,default:!1},subEndDate:{type:Object,default:null},subStartDate:{type:Object,default:null},startDate:{type:Object,required:!0},isEstimationLinked:{type:Boolean,default:!1},withMilestones:{type:Boolean,default:!0},withEstimations:{type:Boolean,default:!0},withGhosts:{type:Boolean,default:!1},withStatuses:{type:Boolean,default:!1},withTimesheets:{type:Boolean,default:!1},hideRoot:{type:Boolean,default:!1},zoomLevel:{type:Number,default:2},multiline:{type:Boolean,default:!1},subchildren:{type:Boolean,default:!1},reassignable:{type:Boolean,default:!1},type:{type:String,validator:e=>["prev","real"].includes(e)}},emits:["estimation-changed","expand-all","item-assign","item-changed","item-drop","item-selected","item-unassign","root-element-expanded","root-element-selected","scroll","task-selected","task-unselected"],mounted(){this.resetScheduleSize(),this.addEvents(this.domEvents)},beforeUnmount(){this.removeEvents(this.domEvents),document.body.style.cursor="default"},computed:{...ce(["currentProduction","departmentMap","isCurrentUserManager","isDarkTheme","milestones","openProductions","organisation","taskMap","taskStatuses"]),statuses(){return{wip:this.taskStatuses.find(e=>e.is_wip)??{},wfa:this.taskStatuses.find(e=>e.is_feedback_request)??{},done:this.taskStatuses.find(e=>e.is_done)??{}}},currentMilestones(){const e={};return Object.keys(this.milestones).forEach(t=>{this.displayedDaysIndex[t]&&(e[t]=this.milestones[t])}),e},cellWidth(){return[20,20,40,60,120][this.zoomLevel]||20},daysAvailable(){const e=[];let t=this.startDate.clone().utc().startOf("day");const i=this.endDate.clone().utc().startOf("day"),d=this.getDayOffRange(this.daysOff).map(o=>o.date);for(;t.isSameOrBefore(i);)t.off=d.includes(t.toISOString().slice(0,10)),t.newWeek=t.isoWeekday()===1,t.newMonth=t.date()===1,t.weekend=[6,7].includes(t.isoWeekday()),t.weekNumber=t.week(),t.text=t.format("YYYY-MM-DD"),t.monthText=t.format("MMMM YY"),t.dayNumber=t.format("DD"),t.dayText=t.format("ddd")[0],e.push(t),t=t.clone().add(1,"days");if(e.length){const o=e.findIndex(c=>c.newMonth);(o>=5||o===-1)&&(e[0].newMonth=!0),e.findIndex(c=>c.newWeek)===-1&&(e[0].newWeek=!0)}return e},weeksAvailable(){const e=[];if(this.daysAvailable.length<1)return[];const t=this.daysAvailable[0],i=this.daysAvailable[this.daysAvailable.length-1],d=t.clone().add(-1,"days");let o=d.toDate();const s=i.clone().add(7,"days").toDate();for(o.weekday=d.isoWeekday(),o.monthday=d.month(),o.week=d.week();o<s;){const c=new Date(Number(o));c.setDate(o.getDate()+1),c.isoweekday>7&&(c.isoweekday=1,c.newWeek=!0),c.monthday=o.monthday+1,c.getMonth()!==o.getMonth()&&(c.newMonth=!0,c.monthday=1);const h=P(W(c).format("YYYY-MM-DD"));h.isoWeekday()===1&&(h.weekText=h.format("YYYY-MM-DD"),h.label=`${h.weekText} to ${h.clone().add(6,"days").format("YYYY-MM-DD")}`,h.weekNumber=h.week(),h.newMonth=e.length===0||h.month()!==e[e.length-1].month(),h.monthText=h.format("MMMM YY"),e.push(h)),o=c}return e},displayedDays(){return this.daysAvailable},displayedDaysIndex(){let e=0;const t={};return this.displayedDays.forEach(i=>{t[i.text]=e,e++}),t},displayedWeeksIndex(){let e=0;const t={};return this.weeksAvailable.forEach(i=>{t[i.weekText]=e,e++}),t},isRealSchedule(){return this.type==="real"},totalManDays(){return this.hierarchy.reduce((e,t)=>e+(t.man_days||0),0)},entityList(){return this.$refs["entity-list"]},schedule(){return this.$refs.schedule},timeline(){return this.$refs.timeline},timelineContent(){return this.$refs["timeline-content"]},timelineContentWrapper(){return this.$refs["timeline-content-wrapper"]},timelineHeader(){return this.$refs["timeline-header"]},timelinePosition(){return this.$refs["timeline-position"]},timelineStyle(){const e=this.daysAvailable[0];return{"background-position-x":`${(e?-1*(e.isoWeekday()-1):0)*this.cellWidth}px`}},timelinePositionStyle(){return{width:`${this.cellWidth}px`}},timelineTodayPositionStyle(){const e=W().utc(!0),t=e.isAfter(this.startDate)&&e.isBefore(this.endDate);return{width:`${this.cellWidth}px`,left:`${this.getTimebarLeft({startDate:e})-3}px`,display:t?"block":"none"}},timelineSubStartStyle(){const e=Math.max(this.dateDiff(this.startDate,this.subStartDate),0);return{left:0,width:`${this.cellWidth*e}px`}},timelineSubEndStyle(){const e=Math.max(this.dateDiff(this.subEndDate,this.endDate)-1,0);return{right:0,width:`${this.cellWidth*e}px`}},dayAfterEndDate(){return this.endDate.clone().add(1,"days")},isWeekMode(){return this.zoomLevel===0},unitOfTime(){return this.zoomLevel>0?"days":"weeks"}},methods:{...he(["deleteMilestone","loadMilestones","saveMilestone"]),getDayOffRange:E,getNbSubChildren(e){return e?Object.values(e).reduce((t,i)=>t+i.length,0):0},getNbLines(e=[]){const t=e.map(i=>i.line||0);return t.length?Math.max(...t)+1:1},refreshAllItemPositions(){this.hierarchy.forEach(e=>{e.expanded&&this.refreshItemPositions(e)})},refreshItemPositions(e){e?.children&&(this.multiline&&R(e.children,this.unitOfTime),this.subchildren&&e.children.forEach(t=>{t.children?t.children.forEach(i=>{R(i,this.unitOfTime)}):R(t,this.unitOfTime)}))},refreshManDays(e){this.hideManDays||!e?.children?.length||(e.man_days=e.children.reduce((t,i)=>t+(i.man_days||0),0))},isVisible(e){const t=e.startDate.isSameOrAfter(this.startDate),i=e.endDate.isSameOrBefore(this.dayAfterEndDate);return t&&i},resetScheduleSize(){this.timelineContent&&(this.zoomLevel>0?this.timelineContent.style.width=`${this.displayedDays.length*this.cellWidth}px`:this.timelineContent.style.width=`${this.weeksAvailable.length*this.cellWidth}px`)},onMouseMove(e){this.isChangeStartDate?this.changeStartDate(e):this.isChangeEndDate?this.changeEndDate(e):this.isChangeDates?this.changeDates(e):(this.isBrowsingX&&this.scrollScheduleLeft(e),this.isBrowsingY&&this.scrollScheduleTop(e)),this.updatePositionBarPosition(e)},onChildEstimationChanged(e,t,i){const d=e.target.valueAsNumber||0;this.isEstimationLinked&&(t.man_days=j(this.organisation,d),t.estimation=t.man_days,this.refreshManDays(i),d>0&&(t.endDate=z(t.startDate,d-1,i.daysOff))),this.$emit("estimation-changed",{taskId:t.id,days:d,item:t,daysOff:i.daysOff})},updatePositionBarPosition(e){if(!this.timelineContentWrapper||!this.timelinePosition)return;const t=this.getClientX(e)-this.timelineContentWrapper.getBoundingClientRect().left;if(t<=0||t>=this.timelineContentWrapper.offsetWidth)return;const i=Math.floor((this.timelineContentWrapper.scrollLeft+t)/this.cellWidth)*this.cellWidth;this.timelinePosition.style.left=`${i}px`},isValidItemDates(e,t){return e&&t&&e.isSameOrAfter(this.startDate.clone().add(-1,"hour"))&&t.isSameOrBefore(this.endDate.clone().add(1,"day"))&&e.isSameOrBefore(t)&&t.isSameOrAfter(e)},getDisplayedDaysIndex(e){const t=e.format("YYYY-MM-DD");return this.displayedDaysIndex[t]},getDisplayedWeeksIndex(e){const t=e.startOf("isoweek").format("YYYY-MM-DD");return this.displayedWeeksIndex[t]},resetDroppableTargets(){this.schedule?.querySelectorAll(".droppable").forEach(e=>{e.classList.remove("droppable")})},changeDates(e){if(!this.isSelected(this.currentElement))return;const t=this.getClientX(e)-this.initialClientX-this.cellWidth/2,i=Math.ceil(t/this.cellWidth);if(this.reassignable){let s=e.target;for(;s&&!s.classList?.contains("drop-item-target");)s=s.parentNode;s||this.resetDroppableTargets();const c=this.currentElement.parentElement;if(this.subchildren&&s&&s.dataset.personId&&s.dataset.entityTypeId&&!this.currentElement.assignees?.includes(s.dataset.personId)){if(s.dataset.personId==="unassigned"||s.dataset.entityTypeId!==this.currentElement.entity_type_id)return;s.classList.add("droppable"),this.selection.forEach(h=>{const u=h.assignees[0],g=s.dataset.personId;h.assignees=h.assignees.filter(v=>v!==u),h.assignees.push(g),this.$emit("item-unassign",h,u),this.$emit("item-assign",h,g),this.refreshItemPositions(c)})}else if(!this.subchildren&&s&&s.dataset.rootElementId&&c.id!==s.dataset.rootElementId){const h=this.hierarchy.find(u=>u.id===s.dataset.rootElementId);this.selection.forEach(u=>{if(!this.checkUserIsAllowed(u,h))return;s.classList.add("droppable");const g=u.parentElement;u.parentElement=h,g.children=g.children.filter(({id:v})=>v!==u.id),h.children=h.children.filter(({id:v})=>v!==u.id),h.children.push(u),this.$emit("item-unassign",u,g),this.$emit("item-assign",u,h),this.refreshItemPositions(g)}),this.refreshItemPositions(h)}}this.lastStartDate.isBefore(this.startDate)&&(this.lastStartDate=this.startDate.clone()),this.lastEndDate.isBefore(this.startDate)&&(this.lastEndDate=this.startDate.clone().add(1,"days"));const d=this.lastStartDate,o=this.lastEndDate;if(this.isWeekMode){const s=this.getDisplayedWeeksIndex(d),h=this.getDisplayedWeeksIndex(o)-s;let u=this.getDisplayedWeeksIndex(d);u+=i,u<0&&(u=0);const g=this.weeksAvailable[u];if(g){const v=this.weeksAvailable[u+h];this.isValidItemDates(g,v)&&(this.currentElement.startDate=g,this.currentElement.endDate=v)}}else{const s=this.getDisplayedDaysIndex(d),h=this.getDisplayedDaysIndex(o)-s;let u=this.getDisplayedDaysIndex(d);u+=i,u<0&&(u=0);const g=this.displayedDays[u];if(g){const v=this.displayedDays[u+h],M=g.diff(this.currentElement.startDate);M&&this.isValidItemDates(g,v)&&(this.selection.forEach(T=>{T.startDate=T.startDate.clone().add(M),T.endDate=T.endDate.clone().add(M)}),(this.multiline||this.subchildren)&&[...new Set(this.selection.map(Y=>Y.parentElement))].forEach(this.refreshItemPositions))}}},changeStartDate(e){const t=this.getClientX(e)-this.initialClientX+this.cellWidth/2,i=Math.floor(t/this.cellWidth),d=this.lastStartDate,o=this.currentElement.endDate;let s,c;this.isWeekMode?(s=this.getDisplayedWeeksIndex(d),c=this.getDisplayedWeeksIndex(o)):(s=this.getDisplayedDaysIndex(d),c=this.getDisplayedDaysIndex(o)),s+=i,s>c&&(s=c),s<0&&(s=0);const h=this.isWeekMode?this.weeksAvailable[s]:this.displayedDays[s];!h.isSame(this.currentElement.startDate)&&this.isValidItemDates(h,this.currentElement.endDate)&&(this.currentElement.startDate=h.clone(),this.updateItemEstimation(this.currentElement),this.refreshItemPositions(this.currentElement.parentElement),this.resetSelection([this.currentElement]))},changeEndDate(e){const t=this.getClientX(e)-this.initialClientX+this.cellWidth/2,i=Math.ceil(t/this.cellWidth);this.currentElement.startDate.isBefore(this.startDate)&&(this.currentElement.startDate=this.startDate.clone()),this.currentElement.endDate.isBefore(this.startDate)&&(this.currentElement.endDate=this.startDate.clone().add(1,"days")),this.lastEndDate.isBefore(this.startDate)&&(this.lastEndDate=this.startDate.clone().add(1,"days"));const d=this.currentElement.startDate,o=this.lastEndDate;let s,c;this.isWeekMode?(s=this.getDisplayedWeeksIndex(d),c=this.getDisplayedWeeksIndex(o)):(s=this.getDisplayedDaysIndex(d),c=this.getDisplayedDaysIndex(o)),c+=i-1,c<s&&(c=s),this.isWeekMode?c>this.displayedWeeksIndex.length&&(c=this.displayedWeeksIndex.length-1):c>this.displayedDaysIndex.length&&(c=this.displayedDaysIndex.length-1);const h=this.isWeekMode?this.weeksAvailable[c]:this.displayedDays[c];h&&!h.isSame(this.currentElement.endDate)&&this.isValidItemDates(this.currentElement.startDate,h)&&(this.currentElement.endDate=h.clone(),this.updateItemEstimation(this.currentElement),this.refreshItemPositions(this.currentElement.parentElement),this.resetSelection([this.currentElement]))},updateItemEstimation(e){if(this.isEstimationLinked){const t=de(e.startDate,e.endDate,e.parentElement?.daysOff);e.estimation=j(this.organisation,t)}},updateSelection(e,t){const i=t.ctrlKey||t.metaKey;this.isSelected(e)?i&&this.removeFromSelection(e):(i||this.resetSelection(),this.addToSelection(e))},isOverlapping(e){return this.withGhosts&&(e.previousElement&&e.startDate.isSameOrBefore(e.previousElement.endDate)||e.nextElement&&e.endDate.isSameOrAfter(e.nextElement.startDate))},isSelected(e){return this.selection.some(({id:t})=>t===e.id)},addToSelection(e){this.selection.push(e)},removeFromSelection(e){this.selection=this.selection.filter(t=>t!==e)},resetSelection(e){this.selection=e||[]},moveTimebar(e,t){t.preventDefault(),!this.isChangeStartDate&&!this.isChangeEndDate&&e.editable&&(this.isChangeDates=!0,this.isChangeStartDate=!1,this.isChangeEndDate=!1,this.currentElement=e,this.lastStartDate=e.startDate.clone(),this.lastEndDate=e.endDate.clone(),this.initialClientX=this.getClientX(t),document.body.style.cursor=this.reassignable?"all-scroll":"ew-resize",this.updateSelection(e,t))},moveTimebarLeftSide(e,t){t.preventDefault(),!this.isChangeDates&&!this.isChangeEndDate&&e.editable&&(this.isChangeDates=!1,this.isChangeStartDate=!0,this.isChangeEndDate=!1,this.currentElement=e,e.endDate||(e.endDate=e.startDate.clone().add(1,"days")),this.lastStartDate=e.startDate.clone(),this.lastEndDate=e.endDate.clone(),this.initialClientX=this.getClientX(t),document.body.style.cursor="w-resize",this.updateSelection(e,t))},moveTimebarRightSide(e,t){t.preventDefault(),!this.isChangeDates&&!this.isChangeStartDate&&e.editable&&(this.isChangeDates=!1,this.isChangeStartDate=!1,this.isChangeEndDate=!0,this.currentElement=e,e.endDate||(e.endDate=e.startDate.clone().add(1,"days")),this.lastStartDate=e.startDate.clone(),this.lastEndDate=e.endDate.clone(),this.initialClientX=this.getClientX(t),document.body.style.cursor="e-resize",this.updateSelection(e,t))},onTimelineScroll(e){if(!e?.target)return;const t=e.target,i=t.scrollTop;this.entityList.scrollTop=i;const d=t.scrollLeft;this.timelineHeader.scrollLeft=d,this.$emit("scroll",{top:t.scrollTop})},setScrollPosition(e){this.timelineContentWrapper.scrollTop=e,this.entityList.scrollTop=e},scrollScheduleLeft(e){if(!this.timelineContentWrapper)return;const t=this.timelineContentWrapper.scrollLeft,i=e.movementX||this.getClientX(e)-this.initialClientX,d=t-i;this.initialClientX=this.getClientX(e),this.timelineContentWrapper.scrollLeft=d,this.timelineHeader.scrollLeft=d},scrollScheduleTop(e){if(!this.timelineContentWrapper)return;const t=this.timelineContentWrapper.scrollTop,i=e.movementY||this.getClientY(e)-this.initialClientY,d=t-i;this.initialClientY=this.getClientY(e),this.setScrollPosition(d)},scrollToToday(){const e=W();this.scrollToDate(e)},scrollToDate(e){setTimeout(()=>{if(this.schedule&&e.isAfter(this.startDate)&&e.isBefore(this.endDate)){const i=this.getTimebarLeft({startDate:e})-5-(this.schedule.offsetWidth/2-300);this.timelineContentWrapper.scrollLeft=i,this.timelineHeader&&(this.timelineHeader.scrollLeft=i)}},10)},startBrowsing(e){!this.isChangeStartDate&&!this.isChangeEndDate&&!this.isChangeDates&&(document.body.style.cursor="grabbing",this.isBrowsingX=!0,this.isBrowsingY=!0,this.initialClientX=this.getClientX(e),this.initialClientY=this.getClientY(e))},startBrowsingX(e){document.body.style.cursor="grabbing",this.isBrowsingX=!0,this.initialClientX=this.getClientX(e)},startBrowsingY(e){document.body.style.cursor="grabbing",this.isBrowsingY=!0,this.initialClientY=this.getClientY(e)},stopBrowsing(e){if(document.body.style.cursor="default",this.currentElement)if(this.initialClientX!==this.getClientX(e))this.selection.forEach(t=>{this.$emit("item-changed",t),this.refreshItemPositions(t.parentElement),this.refreshManDays(t.parentElement)}),this.isChangeDates&&this.selection.length===1&&this.resetSelection();else{const t=e.ctrlKey||e.metaKey;this.isChangeDates&&this.selection.length>1&&!t&&this.resetSelection([this.currentElement])}else{let t=e.target;for(;t&&t!==this.timeline;)t=t.parentNode;t&&(this.resetSelection(),this.$emit("task-unselected"))}this.resetDroppableTargets(),this.isChangeStartDate=!1,this.isChangeEndDate=!1,this.isChangeDates=!1,this.isBrowsingX=!1,this.isBrowsingY=!1,this.initialClientX=null,this.initialClientY=null,this.currentElement=null},dateDiff(e,t,i="days"){if(e.isSame(t)||!e.isValid()||!t.isValid())return 0;const d=e.clone().utc().startOf("day");return t.clone().utc().endOf("day").diff(d,i)},dayClass(e,t=0){return{"day-name":!0,"new-week":e.newWeek||!1,"new-month":e.newMonth||t===0||!1,weekend:e.weekend||!1,"day-name-off":e.off||!1}},dayOffStyle(e){return{left:`${this.getLeftPosition(e.date)}px`,width:`${this.cellWidth-1}px`}},dateStatusStyle(e){return{left:`${this.getLeftPosition(e)+this.cellWidth/2-3}px`}},getLeftPosition(e){const t=W.utc(e);return this.dateDiff(this.startDate,t,this.unitOfTime)*this.cellWidth+1},entityLineStyle(e,t=!1,i=!1,d=!1){const o={};let s=e.color;return t&&(s=this.isDarkTheme?"#222":"#EEF"),t&&(o["border-left"]=`1px solid ${s}`,o["border-top"]=`1px solid ${s}`,d||(o["border-bottom"]=`1px solid ${s}`),i&&(o.background=s)),e.expanded&&(o["margin-bottom"]="0"),o["border-left"]=`1px solid ${s}`,o.color=this.isDarkTheme?"#EEE":"#111",this.isDarkTheme||(o["border-color"]="#BBE"),o},timebarStyle(e,t=!1){const i={left:`${this.getTimebarLeft(e)}px`,width:`${this.getTimebarWidth(e)}px`,cursor:e.editable?!t&&this.reassignable?"all-scroll":"ew-resize":"default"};return t&&(i["background-color"]=e.color),i},timelineMultilineStyle(e){return{top:`${e.line*40+5}px`,left:`${this.getTimebarLeft(e)}px`}},timelineSubchildrenStyle(e){const t=Array.from(e.children.values()),i=t.reduce((o,s)=>o+this.getNbLines(s),0),d=t.length*10;return{height:`${40+40*i+d+2}px`,"padding-top":"13px"}},timebarChildStyle(e,t,i=!1,d=0,o="transparent"){const s=e.color||t.color;return{left:!i&&`${this.getTimebarLeft(e)}px`,width:`${this.getTimebarWidth(e)}px`,cursor:e.editable?this.reassignable?"all-scroll":"ew-resize":"default",background:d?`color-mix(in srgb, ${s}, ${o} ${d}%)`:s}},timesheetStyle(e,t,i,d){return{top:d?"7px":"18px",left:`${this.getTimebarLeft(e,!0)}px`,width:`${this.getTimebarWidth(e)}px`,background:e.color||t.color||i.color}},timebarSubchildStyle(e,t){const i=e.color||t.color,d=this.isSelected(e);return{left:`${this.getTimebarLeft(e)}px`,width:`${this.getTimebarWidth(e)}px`,cursor:e.editable?this.reassignable?"all-scroll":"ew-resize":"default",top:`${5+38*e.line}px`,background:`color-mix(in srgb, ${i} ${d?80:40}%, transparent)`,"box-shadow":`inset 0 0 1px 2px ${d?"var(--background-selected)":i}`}},timebarSubchildTitle(e){const t=e.entity.name,i=e.startDate.format("YYYY-MM-DD"),d=e.endDate.format("YYYY-MM-DD"),o=this.isRealSchedule?this.formatDuration(e.duration):this.formatDuration(e.estimation);return`${t} (${i} - ${d}) ${o} ${this.$t("schedule.md")}`},getTimebarLeft(e){const t=e.startDate||this.startDate;return this.dateDiff(this.startDate,t,this.unitOfTime)*this.cellWidth+3},getTimebarWidth(e){const t=e.startDate||this.startDate;let i=e.endDate||e.startDate&&e.startDate.clone().add(1,"days")||this.startDate.clone().add(1,"days");if(e.man_days>0&&!e.end_date&&!e.endDate){const o=Math.ceil(e.man_days);i=z(t,o-1)}const d=this.dateDiff(t,i,this.unitOfTime);return d>0?(d+1)*this.cellWidth-6:this.cellWidth-4},expandRootElement(e){e.expanded&&this.selection.forEach(t=>{(t.parentElement?.parentElement?.id||t.parentElement?.id)===e.id&&this.removeFromSelection(t)}),this.$emit("root-element-expanded",e,this.multiline||this.subchildren?this.refreshItemPositions:void 0)},childNameStyle(e,t){const d=t%2===0?.7:.9;return{background:V.fadeColor(e.color,d)}},childrenStyle(e,t=!1,i=!1){const d={"border-bottom":`1px solid ${e.color}`,"border-left":`1px solid ${e.color}`};if(t){const o=this.getNbLines(e.children);d.height=`${40*o+10}px`,i&&(d.background=V.fadeColor(e.color,.7))}return d},showEditMilestoneModal(e,t){this.isCurrentUserManager&&(this.modals.edit=!0,t?this.milestoneToEdit={...t,date:P(t.date)}:this.milestoneToEdit={date:e})},hideEditMilestoneModal(){this.modals.edit=!1},confirmEditMilestone(e){this.loading.edit=!0,this.saveMilestone(e).then(()=>{this.modals.edit=!1}).catch(t=>{console.error(t),this.errors.edit=!0}).finally(()=>{this.loading.edit=!1})},removeMilestone(e){this.loading.edit=!0,this.deleteMilestone(e).then(()=>{this.modals.edit=!1}).catch(t=>{console.error(t),this.errors.edit=!0}).finally(()=>{this.loading.edit=!1})},milestoneLineStyle(e){const t=P(this.startDate.format("YYYY-MM-DD")),i=P(e.date);return t.isSameOrBefore(i)?{left:`${(this.dateDiff(t,i,this.unitOfTime)+.5)*this.cellWidth}px`}:{display:"none"}},addMilestoneTitle(e){return`${this.$t("schedule.milestone.add_milestone")} ${e.format("YYYY-MM-DD")}`},checkUserIsAllowed(e,t){if(!e)return!1;const d=this.openProductions.find(({id:s})=>s===e.project_id).team.includes(t.id),o=!t.departments.length||!e.department||t.departments.includes(e.department.id);return d&&o},onTaskDragEnter(e,t){if(!e.dataTransfer.types.find(d=>d===`task-type-${t.task_type_id}`)){const d=this.draggedItems?.[0];if(!this.checkUserIsAllowed(d,t))return}e.currentTarget.classList.add("droppable")},onTaskDragOver(e){e.preventDefault()},onTaskDragLeave(e){e.target.classList.remove("droppable")},onTaskDrop(e,t){e.target.classList.remove("droppable");let i=this.draggedItems?.[0];if(i){if(!this.checkUserIsAllowed(i,t))return}else{const u=e.dataTransfer.getData("entityId"),g=e.dataTransfer.getData("taskTypeId");if(!u||g!==t.task_type_id)return;i={entity_id:u}}const d=this.timelineContentWrapper.scrollLeft+this.getClientX(e)-300-this.cellWidth*1.5,o=Math.floor(d/this.cellWidth),s=this.startDate.clone().add(o,"days"),c=z(s,0,t.daysOff),h=i.estimation?z(c,oe(this.organisation,i.estimation)-1,t.daysOff):c;i.full_entity_name=`${i.entity_type_name} / ${i.entity_name}`,i.start_date=c.format("YYYY-MM-DD"),i.due_date=h.format("YYYY-MM-DD"),i.parentElement=t,this.$emit("item-drop",i,t,this.multiline?this.refreshItemPositions:void 0)},exportData(){return{header:this.daysAvailable,hierarchy:this.hierarchy}}},watch:{startDate(){this.resetScheduleSize()},endDate(){this.resetScheduleSize()},zoomLevel(){this.resetScheduleSize(),this.refreshAllItemPositions(),this.onTimelineScroll(null,{scrollTop:0,scrollLeft:0})},isLoading(){this.$nextTick(this.resetScheduleSize)},height(){this.$nextTick(this.resetScheduleSize)},currentElement(){if(this.currentElement&&this.currentElement.task_type_id){const e=this.taskMap.get(this.currentElement.id);e&&this.$store.commit("UPDATE_TASK",{task:e,updatedAt:re(W())})}},currentProduction:{immediate:!0,handler(){this.withMilestones&&this.loadMilestones(this.currentProduction)}}}},R=(e,t="days")=>{if(!e?.length)return;const i="line",d=[],o=W.min(e.map(u=>u.startDate)).clone().startOf(t),c=W.max(e.map(u=>u.endDate)).clone().endOf(t).diff(o,t)+1;e.forEach(u=>{const g=u.startDate.clone().startOf(t).diff(o,t),v=u.endDate.clone().endOf(t).diff(o,t),M=h(u.id,g,v,d);u[i]=M});function h(u,g,v,M,T=0){for(let Y=g;Y<=v;Y++){if(!M[T])M.push(Array(c).fill(0)),Y=v;else if(M[T][Y])return h(u,g,v,M,T+1);if(Y===v)return M[T].fill(u,g,v+1),T}}},xe={class:"schedule-wrapper"},Ce={class:"actions"},Ye=["title"],Ie={key:0,class:"total-value"},Le=["onClick"],Be={key:0,class:"avatar flexrow-item"},We=["title"],Oe=["onInput","value"],Ae={key:3,class:"man-days-unit flexrow-item"},ze={key:4,class:"man-days-unit flexrow-item"},Pe={key:0,class:"children-loader"},Xe={class:"child-name"},Ne={class:"entity-line entity-name child-line",style:{background:"none"}},Re={class:"filler"},Fe=["title"],Ve={key:2,class:"flexrow flexrow-item man-days-unit-wrapper"},je=["onInput","value"],Ue={key:3,class:"man-days-unit flexrow-item"},He={class:"timeline",ref:"timeline"},Ke=["onClick"],qe={class:"milestone-tooltip"},Ge={key:1,class:"milestone"},Je={class:"date-name"},Qe={key:0,class:"month-name"},Ze={key:1,class:"week-number"},Ee={key:0},$e={class:"day-number"},et=["title","onClick"],tt={class:"button"},st=["title"],it={class:"date-name"},at={key:0,class:"month-name"},nt={class:"day-number"},lt=["data-id"],rt=["title"],ot=["title"],dt=["onClick"],ht=["onMousedown","onTouchstart"],ct=["onMousedown","onTouchstart"],ut=["onMousedown","onTouchstart"],ft={class:"children-loader"},mt=["data-root-element-id","onDragenter","onDrop"],yt={key:0,class:"entity-line child-line hidden"},Dt=["title"],gt=["title"],bt=["title"],wt=["title"],vt=["title"],kt=["title"],pt=["title","onClick"],_t=["onMousedown","onTouchstart"],St=["onMousedown","onTouchstart"],Mt=["onMousedown","onTouchstart"],Tt={key:5,class:"subchildren"},xt=["data-entity-type-id","data-person-id"],Ct=["title"],Yt=["title"],It=["onMousedown","onTouchstart"],Lt=["onMousedown","onTouchstart","onClick"],Bt=["onMousedown","onTouchstart"];function Wt(e,t,i,d,o,s){const c=_("list-chevrons-up-down-icon"),h=_("chevron-right-icon"),u=_("chevron-down-icon"),g=_("production-name"),v=_("people-avatar"),M=_("department-name"),T=_("link-icon"),Y=_("router-link"),F=_("spinner"),X=_("briefcase-icon"),K=_("edit-icon"),q=_("plus-icon"),G=_("edit-milestone-modal");return l(),r("div",xe,[f("div",{ref:"schedule",class:b(["schedule unselectable",`zoom-level-${i.zoomLevel}`])},[L(f("div",{ref:"entity-list",class:"entities",onMousedown:t[1]||(t[1]=(...a)=>s.startBrowsingY&&s.startBrowsingY(...a)),onTouchstart:t[2]||(t[2]=(...a)=>s.startBrowsingY&&s.startBrowsingY(...a))},[f("div",{class:b(["total-man-days",{"without-milestones":!i.withMilestones}])},[f("div",Ce,[i.showExpandAll?(l(),r("button",{key:0,class:"button is-small is-link",title:e.$t("main.expand_all"),onClick:t[0]||(t[0]=a=>e.$emit("expand-all"))},[B(c,{size:15})],8,Ye)):m("",!0)]),i.hideManDays?m("",!0):(l(),r("span",Ie,w(e.formatDuration(s.totalManDays))+" "+w(e.$t("schedule.md")),1))],2),f("div",{class:b(["entity-name-list",{"without-milestones":!i.withMilestones}])},[(l(!0),r(p,null,S(i.hierarchy,a=>(l(),r("div",{key:`entity-${a.id}`,class:"timeline-element"},[L(f("div",{class:b(["entity-line entity-name flexrow root",{expanded:a.expanded}]),style:D(s.entityLineStyle(a,!0,!0))},[f("span",{class:"expand flexrow-item",style:D({color:e.isDarkTheme?"#EEE":"#999","margin-top":"4px"}),onClick:n=>s.expandRootElement(a)},[a.expanded?(l(),x(u,{key:1})):(l(),x(h,{key:0}))],12,Le),a.avatar?(l(),r("span",Be,[a.type==="Project"?(l(),x(g,{key:0,production:a,"only-avatar":!0,size:30},null,8,["production"])):(l(),x(v,{key:1,person:a,"is-link":!1,"font-size":14,size:28},null,8,["person"]))])):m("",!0),f("span",{class:"filler flexrow-item root-element-name ellipsis",style:D({"border-left":a.avatar?null:`4px solid ${a.color}`}),title:a.name},w(a.name),13,We),(l(!0),r(p,null,S(a.departments,n=>(l(),x(M,{class:"ml05",department:e.departmentMap.get(n),key:n,"no-padding":"","only-dot":""},null,8,["department"]))),128)),a.route?(l(),x(Y,{key:1,class:"root-element-link flexrow-item",title:a.name,to:a.route},{default:U(()=>[a.route?(l(),x(T,{key:0,size:12})):m("",!0)]),_:2},1032,["title","to"])):m("",!0),!a.avatar&&a.editable&&!i.hideManDays?(l(),r("input",{key:2,class:"man-day-input flexrow-item mr1",type:"number",step:"any",placeholder:"0",onInput:n=>e.$emit("estimation-changed",{days:n.target.valueAsNumber||0,item:a,daysOff:a.daysOff}),value:e.formatDuration(a.man_days,!1)},null,40,Oe)):m("",!0),!a.avatar&&a.editable&&!i.hideManDays?(l(),r("span",Ae,w(e.$t("schedule.md")),1)):m("",!0),(a.avatar||!a.editable)&&!i.hideManDays?(l(),r("span",ze,w(e.formatDuration(a.man_days))+" "+w(e.$t("schedule.md")),1)):m("",!0)],6),[[O,!i.hideRoot]]),a.expanded?(l(),r("div",{key:0,class:b(["children",{mb0:i.hideRoot}]),style:D(s.childrenStyle(a,i.multiline,!0))},[a.loading?(l(),r("div",Pe,[B(F,{class:"child-spinner",size:20})])):i.subchildren?(l(!0),r(p,{key:1},S(a.children,(n,y)=>(l(),r("div",{key:n.id,style:D(s.childNameStyle(a,y)),class:"child"},[f("div",Xe,[f("span",Ne,[f("span",Re,w(n.name),1)])]),(l(!0),r(p,null,S(n.children,([I])=>(l(),r("div",{key:I,style:D({height:`${40*s.getNbLines(n.children.get(I))}px`}),class:"subchild-label"},[B(v,{person:a.people[I],"is-link":!1,"font-size":14,size:28},null,8,["person"]),A(" "+w(a.people[I].full_name),1)],4))),128))],4))),128)):i.multiline?m("",!0):(l(!0),r(p,{key:2},S(a.children,(n,y)=>(l(),r("div",{class:"child-name",key:`entity-${n.id}`},[f("div",{class:"entity-line entity-name child-line flexrow",style:D(s.childNameStyle(a,y))},[n.route?(l(),x(Y,{key:0,class:"filler flexrow-item child-element-name ellipsis-2-lines",title:n.name,to:n.route},{default:U(()=>[A(w(n.name),1)]),_:2},1032,["title","to"])):(l(),r("span",{key:1,class:"filler flexrow-item ellipsis-2-lines",title:n.name},w(n.name),9,Fe)),n.editable&&!i.hideManDays?(l(),r("span",Ve,[f("input",{class:"flexrow-item man-days-unit",type:"number",min:"0",placeholder:"0",step:"any",onInput:I=>s.onChildEstimationChanged(I,n,a),value:e.formatDuration(n.man_days,!1)},null,40,je),A(" "+w(e.$t("schedule.md")),1)])):(l(),r("span",Ue,w(e.formatDuration(n.man_days))+" "+w(e.$t("schedule.md")),1))],4)]))),128))],6)):m("",!0)]))),128))],2)],544),[[O,!i.hideEntities]]),f("div",He,[i.zoomLevel>0?(l(),r("div",{key:0,ref:"timeline-header",class:b(["timeline-header",{"without-milestones":!i.withMilestones}]),onMousedown:t[3]||(t[3]=(...a)=>s.startBrowsingX&&s.startBrowsingX(...a)),onTouchstart:t[4]||(t[4]=(...a)=>s.startBrowsingX&&s.startBrowsingX(...a))},[(l(!0),r(p,null,S(s.daysAvailable,(a,n)=>(l(),r("div",{class:b(["day",{"without-milestones":!i.withMilestones,"new-week":a.newWeek}]),key:`header-${a.text}-${n}`},[s.currentMilestones[a.text]&&i.withMilestones?(l(),r("div",{key:0,class:"milestone pointer",onClick:y=>s.showEditMilestoneModal(a,s.currentMilestones[a.text])},[f("div",qe,w(s.currentMilestones[a.text].name),1),t[12]||(t[12]=f("div",{class:"bull"},"•",-1))],8,Ke)):i.withMilestones?(l(),r("div",Ge,t[13]||(t[13]=[f("div",{class:"bull"}," ",-1)]))):m("",!0),f("div",{class:b({"with-milestones":i.withMilestones&&e.isCurrentUserManager,"date-widget":!0})},[f("div",Je,[a.newMonth?(l(),r("span",Qe,w(a.monthText),1)):m("",!0),a.newWeek?(l(),r("span",Ze,w(a.weekNumber),1)):m("",!0),f("div",{class:b(s.dayClass(a,n))},[i.zoomLevel>2?(l(),r("span",Ee,w(a.dayText)+" / ",1)):m("",!0),f("span",$e,[a.off?(l(),x(X,{key:0,class:"day-off-icon",size:14})):m("",!0),A(" "+w(a.dayNumber),1)])],2)]),i.withMilestones&&e.isCurrentUserManager?(l(),r("div",{key:0,class:"add-milestone",title:s.addMilestoneTitle(a),onClick:y=>s.showEditMilestoneModal(a,s.currentMilestones[a.text])},[f("span",tt,[s.currentMilestones[a.text]?(l(),x(K,{key:0,size:10})):(l(),x(q,{key:1,size:12,"stroke-width":3}))])],8,et)):m("",!0)],2)],2))),128))],34)):(l(),r("div",{key:1,ref:"timeline-header",class:b(["timeline-header",{"without-milestones":!i.withMilestones}]),onMousedown:t[5]||(t[5]=(...a)=>s.startBrowsingX&&s.startBrowsingX(...a)),onTouchstart:t[6]||(t[6]=(...a)=>s.startBrowsingX&&s.startBrowsingX(...a))},[(l(!0),r(p,null,S(s.weeksAvailable,(a,n)=>(l(),r("div",{class:b(["day week",{"without-milestones":!i.withMilestones}]),key:`header-${a.weekText}-${n}`,title:a.label},[f("div",{class:b({"hidden-milestones":i.withMilestones})},[f("div",it,[a.newMonth?(l(),r("span",at,w(a.monthText),1)):m("",!0),t[14]||(t[14]=f("span",{class:"week-number"},"   ",-1)),f("div",{class:b(s.dayClass(a,n))},[f("span",nt,w(a.weekNumber),1)],2)])],2)],10,st))),128))],34)),f("div",{ref:"timeline-content-wrapper",class:"timeline-content-wrapper",onScrollPassive:t[11]||(t[11]=(...a)=>s.onTimelineScroll&&s.onTimelineScroll(...a))},[f("div",{ref:"timeline-content",class:"timeline-content",style:D(s.timelineStyle),onMousedown:t[9]||(t[9]=(...a)=>s.startBrowsing&&s.startBrowsing(...a)),onTouchstart:t[10]||(t[10]=(...a)=>s.startBrowsing&&s.startBrowsing(...a))},[i.subStartDate?(l(),r("div",{key:0,ref:"timeline-sub-start",class:"sub-zone",style:D(s.timelineSubStartStyle)},null,4)):m("",!0),i.subEndDate?(l(),r("div",{key:1,ref:"timeline-sub-end",class:"sub-zone",style:D(s.timelineSubEndStyle)},null,4)):m("",!0),f("div",{ref:"timeline-today-position",class:"timeline-position today",style:D(s.timelineTodayPositionStyle)},null,4),L(f("div",{ref:"timeline-position",class:"timeline-position",style:D(s.timelinePositionStyle)},null,4),[[O,!o.isChangeDates]]),i.withMilestones&&!s.isWeekMode?(l(!0),r(p,{key:2},S(Object.values(s.currentMilestones),a=>(l(),r("div",{class:"milestone-vertical-line",style:D(s.milestoneLineStyle(a)),key:`milestone-${a.date}`},null,4))),128)):m("",!0),(l(!0),r(p,null,S(i.hierarchy,a=>(l(),r("div",{class:"timeline-element","data-id":a.id,key:`entity-line-${a.id}`},[(l(!0),r(p,null,S(s.getDayOffRange(a.daysOff),(n,y)=>(l(),r("div",{class:b(["day-off",{"day-off-sub-zone":i.subStartDate?.diff(n.date,"days")>0||i.subEndDate?.diff(n.date,"days")<0}]),key:`dayoff-${n.id}-${y}`,style:D(s.dayOffStyle(n)),title:n.description},[B(X,{class:"day-off-icon",size:14})],14,rt))),128)),L(f("div",{class:"entity-line root-element",style:D(s.entityLineStyle(a,!0))},[f("div",{class:b(["timebar-wrapper",{thinner:i.multiline}]),title:`${a.name} (${a.startDate?.format("YYYY-MM-DD")} - ${a.endDate?.format("YYYY-MM-DD")})`,style:D(s.timebarStyle(a,!0))},[a.editable?L((l(),r("div",{key:0,class:"timebar",onClick:n=>e.$emit("root-element-selected",a)},[f("div",{class:"timebar-left-hand",onMousedown:n=>s.moveTimebarLeftSide(a,n),onTouchstart:n=>s.moveTimebarLeftSide(a,n)},null,40,ht),f("div",{class:"timebar-center",onMousedown:n=>s.moveTimebar(a,n),onTouchstart:n=>s.moveTimebar(a,n)},null,40,ct),f("div",{class:"timebar-right-hand",onMousedown:n=>s.moveTimebarRightSide(a,n),onTouchstart:n=>s.moveTimebarRightSide(a,n)},null,40,ut)],8,dt)),[[O,s.isVisible(a)]]):m("",!0)],14,ot)],4),[[O,!i.hideRoot]]),a.expanded&&a.loading?(l(),r("div",{key:0,class:"children",style:D(s.childrenStyle(a,i.multiline))},[f("div",ft,[B(F,{class:"child-spinner",size:20})])],4)):a.expanded?(l(),r("div",{key:1,class:b(["children",{"drop-item-target":i.reassignable&&i.multiline}]),"data-root-element-id":a.id,style:D(s.childrenStyle(a,i.multiline)),onDragenter:n=>s.onTaskDragEnter(n,a),onDragover:t[7]||(t[7]=(...n)=>s.onTaskDragOver&&s.onTaskDragOver(...n)),onDragleave:t[8]||(t[8]=(...n)=>s.onTaskDragLeave&&s.onTaskDragLeave(...n)),onDrop:n=>s.onTaskDrop(n,a)},[i.invertLinesColor?(l(),r("div",yt)):m("",!0),(l(!0),r(p,null,S(a.children,n=>L((l(),r("div",{class:b(["entity-line child-line",{multiline:i.multiline}]),key:`entity-line-${n.id}`,style:D({...i.multiline&&s.timelineMultilineStyle(n),...i.subchildren&&s.timelineSubchildrenStyle(n)})},[i.withStatuses?(l(),r(p,{key:0},[n.real_start_date?(l(),r("span",{key:0,class:b(["status-date status-date-wip",{"status-date-gap":n.real_start_date.slice(0,10)===n.end_date?.slice(0,10)||n.real_start_date.slice(0,10)===n.done_date?.slice(0,10)}]),style:D(s.dateStatusStyle(n.real_start_date)),title:s.statuses.wip.name},null,14,Dt)):m("",!0),n.end_date?(l(),r("span",{key:1,class:b(["status-date status-date-wfa",{"status-date-gap":n.end_date.slice(0,10)===n.real_start_date?.slice(0,10)||n.end_date.slice(0,10)===n.done_date?.slice(0,10)}]),style:D(s.dateStatusStyle(n.end_date)),title:s.statuses.wfa.name},null,14,gt)):m("",!0),n.done_date?(l(),r("span",{key:2,class:b(["status-date status-date-done",{"status-date-gap":n.done_date.slice(0,10)===n.real_start_date?.slice(0,10)||n.done_date.slice(0,10)===n.end_date?.slice(0,10)}]),style:D(s.dateStatusStyle(n.done_date)),title:s.statuses.done.name},null,14,bt)):m("",!0)],64)):m("",!0),i.withTimesheets&&a.timesheet?(l(!0),r(p,{key:1},S(a.timesheet.filter(({task_id:y})=>y===n.id),y=>(l(),r("div",{class:"timesheet",style:D(s.timesheetStyle(y,n,a,i.withEstimations)),title:`${e.formatDuration(y.duration)} ${e.isDurationInHours?e.$tc("main.hours_spent",e.formatDuration(y.duration,!1)):e.$tc("main.days_spent",e.formatDuration(y.duration,!1))}`,key:y.id},null,12,wt))),128)):m("",!0),i.withGhosts&&n.previousElement?(l(),r("div",{key:2,class:b(["timebar timebar-ghost timebar-ghost-before",{"with-timesheets":i.withTimesheets}]),title:`${n.previousElement.name} (${n.previousElement.startDate.format("YYYY-MM-DD")} - ${n.previousElement.endDate.format("YYYY-MM-DD")})`,style:D(s.timebarChildStyle(n.previousElement,a,i.multiline,50))},null,14,vt)):m("",!0),i.withGhosts&&n.nextElement?(l(),r("div",{key:3,class:b(["timebar timebar-ghost timebar-ghost-after",{"with-timesheets":i.withTimesheets}]),title:`${n.nextElement.name} (${n.nextElement.startDate.format("YYYY-MM-DD")} - ${n.nextElement.endDate.format("YYYY-MM-DD")})`,style:D(s.timebarChildStyle(n.nextElement,a,i.multiline,50))},null,14,kt)):m("",!0),i.withEstimations?L((l(),r("div",{key:4,class:b(["timebar",{selected:s.isSelected(n),"timebar-subchildren":i.subchildren,"with-timesheets":i.withTimesheets,invalid:s.isOverlapping(n)}]),title:`${i.multiline&&n.project_name?`${n.project_name} - `:""}${n.name} (${n.startDate.format("YYYY-MM-DD")} - ${n.endDate.format("YYYY-MM-DD")})`,style:D(s.timebarChildStyle(n,a,i.multiline,i.withTimesheets&&25,e.isDarkTheme?"black":"white")),onClick:y=>e.$emit("item-selected",a,n)},[!o.isChangeDates&&o.selection.length===1&&s.isSelected(n)&&n.editable&&!n.unresizable?(l(),r("div",{key:0,class:"timebar-left-hand",onMousedown:y=>s.moveTimebarLeftSide(n,y),onTouchstart:y=>s.moveTimebarLeftSide(n,y)},null,40,_t)):m("",!0),f("div",{class:b(["timebar-center",{ellipsis:i.multiline||i.subchildren,"has-text-centered":i.subchildren}]),onMousedown:y=>s.moveTimebar(n,y),onTouchstart:y=>s.moveTimebar(n,y)},[i.multiline&&n.project_name?(l(),r(p,{key:0},[f("b",null,w(n.project_name),1),t[15]||(t[15]=f("br",null,null,-1))],64)):m("",!0),i.multiline||i.subchildren?(l(),r(p,{key:1},[A(w(n.name),1)],64)):m("",!0)],42,St),!o.isChangeDates&&o.selection.length===1&&s.isSelected(n)&&n.editable&&!n.unresizable?(l(),r("div",{key:1,class:"timebar-right-hand",onMousedown:y=>s.moveTimebarRightSide(n,y),onTouchstart:y=>s.moveTimebarRightSide(n,y)},null,40,Mt)):m("",!0)],14,pt)),[[O,i.subchildren||s.isVisible(n)]]):m("",!0),i.subchildren&&n.children.size?(l(),r("div",Tt,[(l(!0),r(p,null,S(n.children,([y,I])=>(l(),r("div",{key:y,style:D({height:`${40*s.getNbLines(I)}px`}),class:b(["subchild",{"drop-item-target":i.reassignable}]),"data-entity-type-id":n.object_id,"data-person-id":y},[(l(!0),r(p,null,S(s.getDayOffRange(a.people[y].daysOff),(k,N)=>(l(),r("div",{class:"day-off",key:`dayoff-${k.id}-${N}`,style:D(s.dayOffStyle(k)),title:k.description},[B(X,{class:"day-off-icon",size:14})],12,Ct))),128)),(l(!0),r(p,null,S(I,(k,N)=>(l(),r("div",{class:b(["timebar",{selected:s.isSelected(k)}]),key:N,style:D(s.timebarSubchildStyle(k,a)),title:s.timebarSubchildTitle(k)},[!o.isChangeDates&&o.selection.length===1&&s.isSelected(k)&&k.editable&&!k.unresizable?(l(),r("div",{key:0,class:"timebar-left-hand",onMousedown:C=>s.moveTimebarLeftSide(k,C),onTouchstart:C=>s.moveTimebarLeftSide(k,C)},null,40,It)):m("",!0),f("div",{class:"timebar-center ellipsis",onMousedown:C=>s.moveTimebar(k,C),onTouchstart:C=>s.moveTimebar(k,C),onClick:C=>e.$emit("task-selected",a,n,k,o.selection)},w(k.entity.name),41,Lt),!o.isChangeDates&&o.selection.length===1&&s.isSelected(k)&&k.editable&&!k.unresizable?(l(),r("div",{key:1,class:"timebar-right-hand",onMousedown:C=>s.moveTimebarRightSide(k,C),onTouchstart:C=>s.moveTimebarRightSide(k,C)},null,40,Bt)):m("",!0)],14,Yt))),128))],14,xt))),128))])):m("",!0)],6)),[[O,!a.loading]])),128))],46,mt)):m("",!0)],8,lt))),128))],36)],544)],512)],2),i.withMilestones&&o.modals.edit?(l(),x(G,{key:0,active:"","is-loading":o.loading.edit,"is-error":o.errors.edit,"milestone-to-edit":o.milestoneToEdit,onConfirm:s.confirmEditMilestone,onCancel:s.hideEditMilestoneModal,onRemoveMilestone:s.removeMilestone},null,8,["is-loading","is-error","milestone-to-edit","onConfirm","onCancel","onRemoveMilestone"])):m("",!0)])}const Vt=H(Te,[["render",Wt],["__scopeId","data-v-73baf247"]]);export{Vt as S};
//# sourceMappingURL=Schedule-BBoWBvCl.js.map
