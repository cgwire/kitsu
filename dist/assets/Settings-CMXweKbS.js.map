{"version":3,"file":"Settings-CMXweKbS.js","sources":["../../src/components/pages/Settings.vue"],"sourcesContent":["<template>\n  <div class=\"settings page\">\n    <div class=\"settings-form\">\n      <form class=\"settings-header\" @submit.prevent>\n        <h2>\n          {{ $t('main.studio') }}\n        </h2>\n        <div class=\"field\">\n          <label class=\"label\">\n            {{ $t('settings.logo') }}\n          </label>\n          <div class=\"logo-wrapper\" v-if=\"form.has_avatar\">\n            <img :src=\"organisationLogoPath\" />\n          </div>\n          <p class=\"no-logo\" v-else>\n            <em>{{ $t('settings.no_logo') }}</em>\n          </p>\n          <p>\n            <button\n              type=\"button\"\n              class=\"button set-logo-button\"\n              @click=\"showAvatarModal\"\n            >\n              {{ $t('settings.set_logo') }}\n            </button>\n          </p>\n          <p v-if=\"form.has_avatar\">\n            <button\n              type=\"button\"\n              class=\"button is-link remove-logo-button\"\n              @click=\"removeAvatar\"\n            >\n              {{ $t('settings.remove_logo') }}\n            </button>\n          </p>\n        </div>\n      </form>\n      <form ref=\"form\" @submit.prevent=\"saveSettings\">\n        <h2>\n          {{ $t('settings.title') }}\n        </h2>\n        <text-field\n          class=\"mt2\"\n          :label=\"$t('settings.fields.name')\"\n          :required=\"true\"\n          v-model.trim=\"form.name\"\n        />\n        <text-field\n          :label=\"$t('settings.fields.hours_by_day')\"\n          :min=\"1\"\n          :max=\"24\"\n          :required=\"true\"\n          type=\"number\"\n          v-model=\"form.hours_by_day\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.use_original_name')\"\n          v-model=\"form.use_original_file_name\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.show_hd_default')\"\n          v-model=\"form.hd_by_default\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.timesheets_locked')\"\n          v-model=\"form.timesheets_locked\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.format_duration_in_hours')\"\n          v-model=\"form.format_duration_in_hours\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.dark_theme_by_default')\"\n          v-model=\"form.dark_theme_by_default\"\n        />\n        <h2>\n          {{ $t('settings.integrations') }}\n        </h2>\n        <text-field\n          :label=\"$t('settings.fields.slack_token')\"\n          v-model.trim=\"form.chat_token_slack\"\n        />\n        <text-field\n          :label=\"$t('settings.fields.discord_token')\"\n          v-model.trim=\"form.chat_token_discord\"\n        />\n        <div class=\"mattermost_integrations\">\n          <text-field\n            :label=\"$t('settings.fields.mattermost_webhook')\"\n            v-model.trim=\"form.chat_webhook_mattermost\"\n          />\n          <div\n            class=\"error has-text-centered\"\n            v-if=\"errors.webhook_error === true\"\n          >\n            <em>{{ $t('settings.webhook_error') }}</em>\n          </div>\n        </div>\n        <button\n          class=\"button save-button is-medium\"\n          :class=\"{\n            'is-loading': loading.save\n          }\"\n          :disabled=\"loading.save || !$refs.form?.checkValidity()\"\n        >\n          {{ $t('settings.save.button') }}\n        </button>\n        <p class=\"error has-text-centered mt2\" v-if=\"errors.save\">\n          <em>{{ $t('settings.save.error') }}</em>\n        </p>\n      </form>\n    </div>\n\n    <change-avatar-modal\n      :active=\"modals.avatar\"\n      :is-loading=\"loading.saveAvatar\"\n      :is-error=\"errors.saveAvatar\"\n      :title=\"$t('settings.change_logo')\"\n      @confirm=\"uploadAvatarFile\"\n      @cancel=\"hideAvatarModal\"\n    />\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\n\nimport ChangeAvatarModal from '@/components/modals/ChangeAvatarModal.vue'\nimport ComboboxBoolean from '@/components/widgets/ComboboxBoolean.vue'\nimport TextField from '@/components/widgets/TextField.vue'\n\nexport default {\n  name: 'settings',\n\n  components: {\n    ChangeAvatarModal,\n    ComboboxBoolean,\n    TextField\n  },\n\n  data() {\n    return {\n      organisationLogoPath: '',\n      form: {\n        chat_token_discord: '',\n        chat_token_slack: '',\n        chat_webhook_mattermost: '',\n        has_avatar: false,\n        hd_by_default: 'false',\n        hours_by_day: 0,\n        name: '',\n        timesheets_locked: 'false',\n        use_original_file_name: 'false',\n        format_duration_in_hours: 'false',\n        dark_theme_by_default: 'false'\n      },\n      errors: {\n        save: false,\n        saveAvatar: false,\n        webhook_error: false\n      },\n      loading: {\n        save: false,\n        saveAvatar: false\n      },\n      modals: {\n        avatar: false\n      }\n    }\n  },\n\n  mounted() {\n    this.organisationLogoPath = `/api/pictures/thumbnails/organisations/${this.organisation.id}.png`\n  },\n\n  computed: {\n    ...mapGetters(['organisation'])\n  },\n\n  methods: {\n    ...mapActions([\n      'changeAvatar',\n      'deleteOrganisationLogo',\n      'saveOrganisation',\n      'uploadOrganisationLogo'\n    ]),\n\n    checkWebhook() {\n      if (\n        !this.form.chat_webhook_mattermost ||\n        this.form.chat_webhook_mattermost.match('/hooks/[a-zA-Z0-9]+$')\n      ) {\n        this.errors.webhook_error = false\n        return true\n      } else {\n        this.errors.webhook_error = true\n        return false\n      }\n    },\n\n    hideAvatarModal() {\n      this.modals.avatar = false\n    },\n\n    showAvatarModal() {\n      this.modals.avatar = true\n    },\n\n    saveSettings() {\n      if (this.checkWebhook()) {\n        this.loading.save = true\n        this.errors.save = false\n        const organisation = {\n          ...this.form,\n          hd_by_default: this.form.hd_by_default === 'true',\n          timesheets_locked: this.form.timesheets_locked === 'true',\n          use_original_file_name: this.form.use_original_file_name === 'true',\n          format_duration_in_hours:\n            this.form.format_duration_in_hours === 'true',\n          dark_theme_by_default: this.form.dark_theme_by_default === 'true'\n        }\n        this.saveOrganisation(organisation)\n          .catch(err => {\n            console.error(err)\n            this.errors.save = true\n          })\n          .finally(() => {\n            this.loading.save = false\n          })\n      }\n    },\n\n    uploadAvatarFile(formData) {\n      this.loading.saveAvatar = true\n      this.errors.saveAvatar = false\n      this.uploadOrganisationLogo(formData)\n        .then(() => {\n          setTimeout(() => {\n            this.modals.avatar = false\n            const timestamp = Date.now()\n            this.organisationLogoPath = `/api/pictures/thumbnails/organisations/${this.organisation.id}.png?t=${timestamp}`\n          }, 500)\n        })\n        .catch(err => {\n          console.error(err)\n          this.errors.saveAvatar = true\n        })\n        .finally(() => {\n          this.loading.saveAvatar = false\n        })\n    },\n\n    removeAvatar() {\n      this.loading.save = true\n      this.errors.save = false\n      this.deleteOrganisationLogo()\n        .catch(err => {\n          console.error(err)\n          this.errors.save = true\n        })\n        .finally(() => {\n          this.loading.save = false\n        })\n    }\n  },\n\n  watch: {\n    organisation: {\n      immediate: true,\n      handler() {\n        this.form = {\n          chat_token_discord: this.organisation.chat_token_discord,\n          chat_token_slack: this.organisation.chat_token_slack,\n          chat_webhook_mattermost: this.organisation.chat_webhook_mattermost,\n          has_avatar: this.organisation.has_avatar,\n          hd_by_default: this.organisation.hd_by_default ? 'true' : 'false',\n          hours_by_day: this.organisation.hours_by_day,\n          name: this.organisation.name,\n          timesheets_locked: this.organisation.timesheets_locked\n            ? 'true'\n            : 'false',\n          use_original_file_name: this.organisation.use_original_file_name\n            ? 'true'\n            : 'false',\n          format_duration_in_hours: this.organisation.format_duration_in_hours\n            ? 'true'\n            : 'false',\n          dark_theme_by_default: this.organisation.dark_theme_by_default\n            ? 'true'\n            : 'false'\n        }\n      }\n    }\n  },\n\n  head() {\n    return {\n      title: `${this.$t('settings.title')} - Kitsu`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .settings {\n    background: $dark-grey-2;\n    color: $white-grey;\n  }\n\n  .settings-form {\n    background: $dark-grey-lighter;\n    color: $white-grey;\n  }\n\n  .set-logo-button {\n    background-color: $grey;\n    color: $dark-grey;\n  }\n}\n\n.mattermost_integrations {\n  margin-bottom: 4em;\n  .field {\n    margin-bottom: 0;\n  }\n}\n\n.settings {\n  background: $white-grey;\n  height: 100%;\n}\n\n.settings-form {\n  background: white;\n  max-width: 500px;\n  margin: auto;\n  margin-top: 2em;\n  margin-bottom: 2em;\n  padding: 2em;\n  box-shadow: rgba(0, 0, 0, 0.15) 0 1px 4px 2px;\n  border-radius: 1em;\n}\n\ninput,\nselect,\nspan.select {\n  width: 100%;\n}\n\nh2:first-child {\n  margin-top: 0;\n}\n\n.save-button {\n  background: $green;\n  border-radius: 10px;\n  border-color: $green;\n  color: white;\n  width: 100%;\n}\n\n.save-button:hover {\n  background: $light-green;\n  border-color: $light-green;\n}\n\n.logo-wrapper {\n  padding: 0;\n\n  img {\n    width: 100px;\n  }\n}\n\n.no-logo {\n  margin-bottom: 1em;\n}\n\n.remove-logo-button {\n  margin-top: 0.5rem;\n  font-size: 0.7em;\n}\n</style>\n"],"names":["_sfc_main","ChangeAvatarModal","ComboboxBoolean","TextField","mapGetters","mapActions","organisation","err","formData","timestamp","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_6","_hoisted_9","_hoisted_11","_openBlock","_createElementBlock","_createElementVNode","_cache","_withModifiers","_ctx","_toDisplayString","$data","_hoisted_5","_hoisted_7","$options","args","_hoisted_8","_createCommentVNode","_createVNode","_component_text_field","$event","_component_combobox_boolean","_hoisted_10","_normalizeClass","_a","_hoisted_12","_component_change_avatar_modal"],"mappings":"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"}