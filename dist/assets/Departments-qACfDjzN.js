import{_ as T,$,a0 as S,Q as L,o as a,c as d,d as n,t as o,F as I,e as g,n as E,f,r as p,i as H,h as C,M as V,q,I as x,k as B,g as y,a as F,b as N}from"./index-Dw-uod2x.js";import{c as A}from"./csv-Dt0ViJ8m.js";import{s as M}from"./string-B0Tq569e.js";import{D as U}from"./DeleteModal-D5nitPJZ.js";import{D as j}from"./DepartmentName-kmEXEkam.js";import{R as O}from"./RowActionsCell-C9aLugox.js";import{T as R}from"./TableInfo-BOYXFWEz.js";import{C as z}from"./ColorField-COd1sznp.js";import{C as G}from"./ComboboxBoolean-DeubScUy.js";import{M as K}from"./ModalFooter-Dmgqo0ae.js";import{T as P}from"./TextField-EpYNDuEI.js";import{L as Q}from"./ListPageHeader-BHpv9H0Z.js";import{R as J}from"./RouteTabs-BV9uY71q.js";import"./trash-gURpboxh.js";import"./refresh-cw-D3rKtSvX.js";import"./Combobox-Z_ENhFXj.js";import"./PageTitle-CBcleFeD.js";const W={class:"columns"},X={class:"column column-departments"},Y={class:"label"},Z={class:"element-list"},ee=["onClick"],te={class:"column column-middle"},ie={class:"label"},se={class:"element-list"},ne={key:0},re={key:1},ae=["onClick"],oe={class:"item-info"},de={class:"column column-hardware"},le={class:"label"},me={class:"element-list"},ce=["onClick"],pe={__name:"DepartmentLinks",props:{items:{type:Array,required:!0},linkedItems:{type:Object,required:!0}},emits:["link-item","unlink-item"],setup(e,{emit:t}){const r=$(),k=e,i=t,s=S(null),v=L(()=>r.getters.departments),_=L(()=>k.linkedItems[s.value?.id]||[]),m=L(()=>{const l=_.value.map(b=>b.id);return k.items.filter(b=>!l.includes(b.id))}),h=l=>{s.value=s.value===l?null:l},w=l=>{s.value&&i("link-item",{departmentId:s.value.id,itemId:l.id})},u=l=>{s.value&&i("unlink-item",{departmentId:s.value.id,itemId:l.id})};return(l,b)=>(a(),d("div",W,[n("div",X,[n("label",Y,o(l.$t("departments.title")),1),n("ul",Z,[(a(!0),d(I,null,g(v.value,c=>(a(),d("li",{class:E({selected:s.value&&s.value.id===c.id}),key:c.id,onClick:D=>h(c)},[f(j,{department:c},null,8,["department"])],10,ee))),128))])]),n("div",te,[n("label",ie,o(l.$t("departments.linked_items")),1),n("ul",se,[s.value===null?(a(),d("li",ne,o(l.$t("departments.select_department")),1)):e.linkedItems.length===0?(a(),d("li",re,o(l.$t("departments.no_items_linked")),1)):(a(!0),d(I,{key:2},g(_.value,c=>(a(),d("li",{key:c.id,onClick:D=>u(c)},[n("div",oe,o(c.name),1)],8,ae))),128))])]),n("div",de,[n("label",le,o(l.$t("departments.available_items")),1),n("ul",me,[(a(!0),d(I,null,g(m.value,c=>(a(),d("li",{key:c.id,onClick:D=>w(c)},o(c.name),9,ce))),128))])])]))}},he=T(pe,[["__scopeId","data-v-1469b819"]]),ue={name:"department-list",emits:["delete-clicked","edit-clicked"],components:{RowActionsCell:O,TableInfo:R},props:{entries:{type:Array,required:!0},isLoading:{type:Boolean,required:!0},isError:{type:Boolean,required:!0},linkedHardwareItems:{type:Object,required:!0},linkedSoftwareLicenses:{type:Object,required:!0}}},fe={class:"data-list"},ke={class:"datatable-wrapper"},_e={class:"datatable"},ve={class:"datatable-head"},we={scope:"col",class:"name"},be={scope:"col"},Ie={scope:"col"},ge={scope:"col"},Ce={key:0,class:"datatable-body"},Te={class:"name"},Le={class:"color"},ye={class:"items"},De={class:"items"},Ee={class:"has-text-centered nb-asset-types"};function $e(e,t,r,k,i,s){const v=p("row-actions-cell"),_=p("table-info");return a(),d("div",fe,[n("div",ke,[n("table",_e,[n("thead",ve,[n("tr",null,[n("th",we,o(e.$t("departments.fields.name")),1),n("th",be,o(e.$t("departments.fields.color")),1),n("th",Ie,o(e.$t("departments.hardware_used_by_artists")),1),n("th",ge,o(e.$t("departments.software_used_by_artists")),1),t[0]||(t[0]=n("th",{scope:"col",class:"actions"},null,-1))])]),r.entries.length>0?(a(),d("tbody",Ce,[(a(!0),d(I,null,g(r.entries,m=>(a(),d("tr",{class:"datatable-row",key:m.id},[n("td",Te,o(m.name),1),n("td",Le,[n("div",null,[n("span",{style:H({background:m.color})},null,4)])]),n("td",ye,o(r.linkedHardwareItems[m.id]?.map(h=>h.name).join(", ")),1),n("td",De,o(r.linkedSoftwareLicenses[m.id]?.map(h=>h.name).join(", ")),1),f(v,{onEditClicked:h=>e.$emit("edit-clicked",m),onDeleteClicked:h=>e.$emit("delete-clicked",m)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):C("",!0)])]),f(_,{"is-loading":r.isLoading,"is-error":r.isError},null,8,["is-loading","is-error"]),n("p",Ee,o(r.entries.length)+" "+o(e.$tc("departments.number",r.entries.length)),1)])}const Se=T(ue,[["render",$e],["__scopeId","data-v-23ebe73e"]]),He={name:"edit-departments-modal",mixins:[V],components:{ColorField:z,ComboboxBoolean:G,ModalFooter:K,TextField:P},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},departmentToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){return this.departmentToEdit?.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},departmentToEdit(){this.isEditing?this.form={id:this.departmentToEdit.id,name:this.departmentToEdit.name,color:this.departmentToEdit.color,archived:String(this.departmentToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}},Ve={class:"modal-content"},qe={class:"box"},xe={key:0,class:"title"},Be={key:1,class:"title"};function Fe(e,t,r,k,i,s){const v=p("text-field"),_=p("color-field"),m=p("combobox-boolean"),h=p("modal-footer"),w=q("focus");return a(),d("div",{class:E(["modal",{"is-active":r.active}])},[n("div",{class:"modal-background",onClick:t[0]||(t[0]=u=>e.$emit("cancel"))}),n("div",Ve,[n("div",qe,[s.isEditing?(a(),d("h1",xe,o(e.$t("departments.edit_title"))+" "+o(r.departmentToEdit.name),1)):(a(),d("h1",Be,o(e.$t("departments.new_departments")),1)),n("form",{onSubmit:t[4]||(t[4]=x(()=>{},["prevent"]))},[B(f(v,{ref:"nameField",label:e.$t("departments.fields.name"),maxlength:30,modelValue:i.form.name,"onUpdate:modelValue":t[1]||(t[1]=u=>i.form.name=u)},null,8,["label","modelValue"]),[[w]]),f(_,{label:e.$t("departments.fields.color"),modelValue:i.form.color,"onUpdate:modelValue":t[2]||(t[2]=u=>i.form.color=u)},null,8,["label","modelValue"]),s.isEditing?(a(),y(m,{key:0,label:e.$t("main.archived"),onEnter:s.runConfirmation,modelValue:i.form.archived,"onUpdate:modelValue":t[3]||(t[3]=u=>i.form.archived=u)},null,8,["label","onEnter","modelValue"])):C("",!0)],32),f(h,{"error-text":e.$t("departments.create_error"),"is-error":r.isError,"is-loading":r.isLoading,onConfirm:s.runConfirmation,onCancel:t[5]||(t[5]=u=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const Ne=T(He,[["render",Fe],["__scopeId","data-v-2977a63b"]]),Ae={name:"departments",components:{DeleteModal:U,DepartmentLinks:he,DepartmentList:Se,EditDepartmentsModal:Ne,ListPageHeader:Q,RouteTabs:J},data(){return{activeTab:"active",departmentToEdit:null,departmentToDelete:null,linkedHardwareItems:{},linkedSoftwareLicenses:{},errors:{departments:!1,edit:!1,del:!1},loading:{departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")},{name:"linked-hardware",label:this.$t("departments.linked_hardware")},{name:"linked-software",label:this.$t("departments.linked_software")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.departments=!0,this.errors.departments=!1;try{await this.loadDepartments(),await this.loadHardwareItems(),await this.loadSoftwareLicenses(),this.linkedHardwareItems=await this.loadLinkedHardwareItems(),this.linkedSoftwareLicenses=await this.loadLinkedSoftwareLicenses()}catch(e){console.error(e),this.errors.departments=!0}this.loading.departments=!1},computed:{...N(["departments","archivedDepartments","hardwareItems","softwareLicenses"]),isActiveTab(){return this.activeTab==="active"},departmentList(){return this.isActiveTab?this.departments:this.archivedDepartments},deleteText(){return this.departmentToDelete?this.$t("departments.delete_text",{name:this.departmentToDelete.name}):""},linkedItems(){return this.activeTab==="linked-hardware"?this.linkedHardwareItems:this.linkedSoftwareLicenses},items(){return this.activeTab==="linked-hardware"?this.hardwareItems:this.softwareLicenses}},methods:{...F(["deleteDepartment","linkHardwareItem","linkSoftwareLicense","loadDepartments","loadHardwareItems","loadSoftwareLicenses","loadLinkedHardwareItems","loadLinkedSoftwareLicenses","unlinkHardwareItem","unlinkSoftwareLicense"]),onExportClicked(){const e=M.slugify(this.$t("departments.title")),r=[[this.$t("main.type"),this.$t("departments.fields.name"),this.$t("departments.fields.color")]].concat(this.departments.map(k=>[k.type,k.name,k.color]));A.buildCsvFile(e,r)},onNewClicked(){this.departmentToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(e){this.departmentToEdit=e,this.modals.edit=!0},confirmEditDepartment(e){let t="newDepartment";this.departmentToEdit&&this.departmentToEdit.id&&(t="editDepartment",e.id=this.departmentToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0})},onDeleteClicked(e){this.departmentToDelete=e,this.modals.del=!0},async confirmDeleteDepartment(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteDepartment(this.departmentToDelete),this.loading.del=!1,this.modals.del=!1}catch{this.loading.del=!1,this.errors.del=!0}},onLinkItem(e){if(this.activeTab==="linked-hardware"){this.linkHardwareItem({hardwareItemId:e.itemId,departmentId:e.departmentId});const t=this.hardwareItems.find(r=>r.id===e.itemId);this.linkedHardwareItems[e.departmentId]||(this.linkedHardwareItems[e.departmentId]=[]),this.linkedHardwareItems[e.departmentId].push(t)}else if(this.activeTab==="linked-software"){this.linkSoftwareLicense({softwareLicenseId:e.itemId,departmentId:e.departmentId});const t=this.softwareLicenses.find(r=>r.id===e.itemId);this.linkedSoftwareLicenses[e.departmentId]||(this.linkedSoftwareLicenses[e.departmentId]=[]),this.linkedSoftwareLicenses[e.departmentId].push(t)}},onUnlinkItem(e){this.activeTab==="linked-hardware"?(this.unlinkHardwareItem({hardwareItemId:e.itemId,departmentId:e.departmentId}),this.linkedHardwareItems[e.departmentId]=this.linkedHardwareItems[e.departmentId].filter(t=>t.id!==e.itemId)):this.activeTab==="linked-software"&&(this.unlinkSoftwareLicense({softwareLicenseId:e.itemId,departmentId:e.departmentId}),this.linkedSoftwareLicenses[e.departmentId]=this.linkedSoftwareLicenses[e.departmentId].filter(t=>t.id!==e.itemId))}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("departments.title")} - Kitsu`}}},Me={class:"departments page fixed-page"};function Ue(e,t,r,k,i,s){const v=p("list-page-header"),_=p("route-tabs"),m=p("department-list"),h=p("department-links"),w=p("edit-departments-modal"),u=p("delete-modal");return a(),d("div",Me,[f(v,{title:e.$t("departments.title"),"new-entry-label":e.$t("departments.new_departments"),"is-exportable":s.isActiveTab,onExportClicked:s.onExportClicked,onNewClicked:s.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),f(_,{class:"tabs","active-tab":i.activeTab,tabs:i.tabs},null,8,["active-tab","tabs"]),i.activeTab==="active"||i.activeTab==="archived"?(a(),y(m,{key:0,class:"department-list",entries:s.departmentList,"is-loading":i.loading.departments,"is-error":i.errors.departments,"linked-hardware-items":i.linkedHardwareItems,"linked-software-licenses":i.linkedSoftwareLicenses,onEditClicked:s.onEditClicked,onDeleteClicked:s.onDeleteClicked},null,8,["entries","is-loading","is-error","linked-hardware-items","linked-software-licenses","onEditClicked","onDeleteClicked"])):C("",!0),i.activeTab==="linked-hardware"||i.activeTab==="linked-software"?(a(),y(h,{key:1,type:i.activeTab,"linked-items":s.linkedItems,items:s.items,onLinkItem:s.onLinkItem,onUnlinkItem:s.onUnlinkItem},null,8,["type","linked-items","items","onLinkItem","onUnlinkItem"])):C("",!0),f(w,{active:i.modals.edit,"is-loading":i.loading.edit,"is-error":i.errors.edit,"department-to-edit":i.departmentToEdit,onCancel:t[0]||(t[0]=l=>i.modals.edit=!1),onConfirm:s.confirmEditDepartment},null,8,["active","is-loading","is-error","department-to-edit","onConfirm"]),f(u,{active:i.modals.del,"is-loading":i.loading.del,"is-error":i.errors.del,text:s.deleteText,"error-text":e.$t("departments.delete_error"),onCancel:t[1]||(t[1]=l=>i.modals.del=!1),onConfirm:s.confirmDeleteDepartment},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const nt=T(Ae,[["render",Ue],["__scopeId","data-v-94de533a"]]);export{nt as default};
//# sourceMappingURL=Departments-qACfDjzN.js.map
