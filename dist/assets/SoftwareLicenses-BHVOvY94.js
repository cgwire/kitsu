import{_ as b,M as g,a as L,r as m,q as C,o as h,g as p,w as y,d as i,I as T,k,f as d,h as E,c as w,t as r,F as S,e as V,n as x,b as D}from"./index-DF-DoQlt.js";import{c as B}from"./csv-IlynXFQz.js";import{s as A}from"./string-B0Tq569e.js";import{D as F}from"./DeleteModal-DwXK5r5w.js";import{B as M}from"./BaseModal-D3KB-h7q.js";import{C as $}from"./ComboboxBoolean-DT116Lfu.js";import{M as I}from"./ModalFooter-Chk0SGv-.js";import{T as N}from"./TextField-BKWlN2Ov.js";import{L as U}from"./ListPageHeader-G9LHDILe.js";import{R as q}from"./RouteTabs-9ZMuefrE.js";import{R}from"./RowActionsCell-DR7b8Q1u.js";import{T as P}from"./TableInfo-D6xnVb4C.js";import"./Combobox-A6pnhVs3.js";import"./PageTitle-CtScP8aV.js";import"./trash-DWKk5Pv9.js";import"./refresh-cw-CYYYI9XK.js";const j={name:"edit-software-license-modal",mixins:[g],components:{BaseModal:M,ComboboxBoolean:$,ModalFooter:I,TextField:N},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},softwareLicenseToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{name:"",archived:"false"}}},mounted(){this.loadSoftwareLicenses()},computed:{isEditing(){return!!this.softwareLicenseToEdit?.id},modalTitle(){return this.isEditing?this.$t("software_licenses.edit_title")+" "+this.softwareLicenseToEdit.name:this.$t("software_licenses.new_software_license")}},methods:{...L(["loadSoftwareLicenses"]),runConfirmation(){this.$emit("confirm",this.form)},resetForm(){this.softwareLicenseToEdit.id?this.form={name:this.softwareLicenseToEdit.name,short_name:this.softwareLicenseToEdit.short_name,file_extension:this.softwareLicenseToEdit.file_extension,version:this.softwareLicenseToEdit.version,monthly_cost:this.softwareLicenseToEdit.monthly_cost,inventory_amount:this.softwareLicenseToEdit.inventory_amount,archived:String(this.softwareLicenseToEdit.archived===!0)}:this.form={name:"",short_name:"",file_extension:"",version:"",monthly_cost:0,inventory_amount:0,archived:"false"}}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField?.focus()},100)},softwareLicenseToEdit(){this.resetForm()}}};function H(e,t,n,c,s,o){const f=m("text-field"),u=m("combobox-boolean"),a=m("modal-footer"),_=m("base-modal"),v=C("focus");return h(),p(_,{active:n.active,title:o.modalTitle,onCancel:t[9]||(t[9]=l=>e.$emit("cancel"))},{default:y(()=>[i("form",{onSubmit:t[7]||(t[7]=T(()=>{},["prevent"]))},[k(d(f,{ref:"nameField",label:e.$t("software_licenses.fields.name"),maxlength:30,modelValue:s.form.name,"onUpdate:modelValue":t[0]||(t[0]=l=>s.form.name=l),onEnter:o.runConfirmation},null,8,["label","modelValue","onEnter"]),[[v]]),d(f,{label:e.$t("software_licenses.fields.short_name"),onEnter:o.runConfirmation,modelValue:s.form.short_name,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.short_name=l)},null,8,["label","onEnter","modelValue"]),d(f,{label:e.$t("software_licenses.fields.extension"),onEnter:o.runConfirmation,modelValue:s.form.file_extension,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.file_extension=l)},null,8,["label","onEnter","modelValue"]),d(f,{label:e.$t("software_licenses.fields.version"),onEnter:o.runConfirmation,modelValue:s.form.version,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.version=l)},null,8,["label","onEnter","modelValue"]),d(f,{label:e.$t("software_licenses.fields.monthly_cost"),type:"number",onEnter:o.runConfirmation,modelValue:s.form.monthly_cost,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.monthly_cost=l)},null,8,["label","onEnter","modelValue"]),d(f,{label:e.$t("software_licenses.fields.inventory_amount"),type:"number",onEnter:o.runConfirmation,modelValue:s.form.inventory_amount,"onUpdate:modelValue":t[5]||(t[5]=l=>s.form.inventory_amount=l)},null,8,["label","onEnter","modelValue"]),o.isEditing?(h(),p(u,{key:0,label:e.$t("main.archived"),onEnter:o.runConfirmation,modelValue:s.form.archived,"onUpdate:modelValue":t[6]||(t[6]=l=>s.form.archived=l)},null,8,["label","onEnter","modelValue"])):E("",!0)],32),d(a,{"error-text":e.$t("software_licenses.create_error"),"is-error":n.isError,"is-loading":n.isLoading,onConfirm:o.runConfirmation,onCancel:t[8]||(t[8]=l=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])]),_:1},8,["active","title"])}const O=b(j,[["render",H],["__scopeId","data-v-b12e74c6"]]),z={name:"software-license-list",components:{RowActionsCell:R,TableInfo:P},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},remainingSoftwareLicenses:{type:Object,default:()=>({})}},emits:["delete-clicked","edit-clicked"]},G={class:"data-list"},K={class:"datatable-wrapper"},J={class:"datatable"},Q={class:"datatable-head"},W={scope:"col",class:"name"},X={scope:"col",class:"short-name"},Y={scope:"col",class:"extension"},Z={scope:"col",class:"version"},ee={scope:"col",class:"monthly-cost number-cell"},te={scope:"col",class:"inventory-amount number-cell"},se={scope:"col",class:"remaining-amount number-cell"},oe={key:0,class:"datatable-body"},ie={class:"name"},ne={class:"short-name"},le={class:"extension"},re={class:"version"},ae={class:"monthly-cost number-cell"},de={class:"inventory-amount number-cell"},ce={class:"has-text-centered nb-software-licenses"};function me(e,t,n,c,s,o){const f=m("row-actions-cell"),u=m("table-info");return h(),w("div",G,[i("div",K,[i("table",J,[i("thead",Q,[i("tr",null,[i("th",W,r(e.$t("software_licenses.fields.name")),1),i("th",X,r(e.$t("software_licenses.fields.short_name")),1),i("th",Y,r(e.$t("software_licenses.fields.extension")),1),i("th",Z,r(e.$t("software_licenses.fields.version")),1),i("th",ee,r(e.$t("software_licenses.fields.monthly_cost")),1),i("th",te,r(e.$t("software_licenses.fields.inventory_amount")),1),i("th",se,r(e.$t("hardware_items.fields.remaining_amount")),1),t[0]||(t[0]=i("th",{scope:"col",class:"actions"},null,-1))])]),n.entries.length>0?(h(),w("tbody",oe,[(h(!0),w(S,null,V(n.entries,a=>(h(),w("tr",{class:"datatable-row",key:a.id},[i("td",ie,r(a.name),1),i("td",ne,r(a.short_name),1),i("td",le,r(a.file_extension),1),i("td",re,r(a.version),1),i("td",ae,r(a.monthly_cost),1),i("td",de,r(a.inventory_amount),1),i("td",{class:x([{negative:n.remainingSoftwareLicenses[a.id]<0},"remaining-amount number-cell"])},r(n.remainingSoftwareLicenses[a.id]),3),d(f,{onEditClicked:_=>e.$emit("edit-clicked",a),onDeleteClicked:_=>e.$emit("delete-clicked",a)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):E("",!0)])]),d(u,{"is-loading":n.isLoading,"is-error":n.isError},null,8,["is-loading","is-error"]),i("p",ce,r(n.entries.length)+" "+r(e.$tc("software_licenses.number",n.entries.length)),1)])}const fe=b(z,[["render",me],["__scopeId","data-v-e81c9095"]]),he={name:"software-licenses",components:{DeleteModal:F,EditSoftwareLicenseModal:O,ListPageHeader:U,RouteTabs:q,SoftwareLicenseList:fe},data(){return{activeTab:"active",linkedSoftwareLicenses:{},softwareLicenseToDelete:null,softwareLicenseToEdit:{},choices:[],errors:{del:!1,edit:!1,list:!1},modals:{del:!1,edit:!1},loading:{del:!1,edit:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.linkedSoftwareLicenses=await this.loadLinkedSoftwareLicenses()},computed:{...D(["activePeople","softwareLicenses","archivedSoftwareLicenses"]),isActiveTab(){return this.activeTab==="active"},softwareLicensesList(){return this.isActiveTab?this.softwareLicenses:this.archivedSoftwareLicenses},usedAmounts(){const e={};return this.activePeople.forEach(t=>{t.departments.forEach(n=>{(this.linkedSoftwareLicenses[n]||[]).forEach(s=>{e[s.id]||(e[s.id]=0),e[s.id]+=1})})}),e},remainingSoftwareLicenses(){const e={};return this.softwareLicenses.forEach(t=>{e[t.id]=t.inventory_amount-(this.usedAmounts[t.id]||0)}),e},deleteText(){const e=this.softwareLicenseToDelete;return e?this.$t("software_licenses.delete_text",{name:e.name}):""}},methods:{...L(["deleteSoftwareLicense","editSoftwareLicense","newSoftwareLicense","loadLinkedSoftwareLicenses"]),confirmEditSoftwareLicense(e){let t="newSoftwareLicense";this.softwareLicenseToEdit&&this.softwareLicenseToEdit.id&&(t="editSoftwareLicense",e.id=this.softwareLicenseToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this[t](e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(n=>{console.error(n),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteSoftwareLicense(){this.loading.del=!0,this.errors.del=!1,this.deleteSoftwareLicense(this.softwareLicenseToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(e=>{console.error(e),this.errors.del=!0,this.loading.del=!1})},onExportClicked(){const e=A.slugify(this.$t("software_licenses.title")),n=[[this.$t("main.type"),this.$t("software_licenses.fields.name"),this.$t("software_licenses.fields.short_name"),this.$t("software_licenses.fields.extension"),this.$t("software_licenses.fields.version"),this.$t("software_licenses.fields.monthly_cost"),this.$t("software_licenses.fields.inventory_amount")]].concat(this.softwareLicenses.map(c=>[c.type,c.name,c.short_name,c.file_extension,c.version,c.monthly_cost,c.inventory_amount]));B.buildCsvFile(e,n)},onNewClicked(){this.softwareLicenseToEdit={},this.errors.edit=!1,this.modals.edit=!0},onEditClicked(e){this.softwareLicenseToEdit=e,this.errors.edit=!1,this.modals.edit=!0},onDeleteClicked(e){this.softwareLicenseToDelete=e,this.errors.del=!1,this.modals.del=!0}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("software_licenses.title")} - Kitsu`}}},ue={class:"software-licenses page fixed-page"};function _e(e,t,n,c,s,o){const f=m("list-page-header"),u=m("route-tabs"),a=m("software-license-list"),_=m("edit-software-license-modal"),v=m("delete-modal");return h(),w("div",ue,[d(f,{title:e.$t("software_licenses.title"),"new-entry-label":e.$t("software_licenses.new_software_license"),"is-exportable":o.isActiveTab,onExportClicked:o.onExportClicked,onNewClicked:o.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),d(u,{class:"mt2","active-tab":s.activeTab,tabs:s.tabs},null,8,["active-tab","tabs"]),d(a,{class:"software-license-list",entries:o.softwareLicensesList,"is-loading":s.loading.list,"is-error":s.errors.list,"remaining-software-licenses":o.remainingSoftwareLicenses,onEditClicked:o.onEditClicked,onDeleteClicked:o.onDeleteClicked},null,8,["entries","is-loading","is-error","remaining-software-licenses","onEditClicked","onDeleteClicked"]),d(_,{active:s.modals.edit,"is-loading":s.loading.edit,"is-error":s.errors.edit,"software-license-to-edit":s.softwareLicenseToEdit,onCancel:t[0]||(t[0]=l=>s.modals.edit=!1),onConfirm:o.confirmEditSoftwareLicense},null,8,["active","is-loading","is-error","software-license-to-edit","onConfirm"]),d(v,{active:s.modals.del,"is-loading":s.loading.del,"is-error":s.errors.del,text:o.deleteText,"error-text":e.$t("software_licenses.delete_error"),onCancel:t[1]||(t[1]=l=>s.modals.del=!1),onConfirm:o.confirmDeleteSoftwareLicense},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const Ae=b(he,[["render",_e],["__scopeId","data-v-f26fd42b"]]);export{Ae as default};
//# sourceMappingURL=SoftwareLicenses-BHVOvY94.js.map
