import{_ as O,E as G,C as H,j as K,B as Y,r as n,o,c as l,d as s,f as c,w as S,g as d,h,t as r,k as m,v as p,F as g,e as k,n as J,H as T,ab as Q,aY as W,a as X,b as Z}from"./index-C2m_IhNF.js";import{E as x,a as $,b as tt,c as et,e as st}from"./EntityTaskList-CZTh0d-y.js";import{f as ot}from"./format-CUjWrpVJ.js";import{C as it}from"./ComboboxNumber-CjSlWfmA.js";import{D as rt}from"./DescriptionCell-JDDrCWCB.js";import{E as nt}from"./EditShotModal-jw6tia8K.js";import{E as lt}from"./EntityChat-HdGpW8i5.js";import{P as at}from"./PageSubtitle-LvZN62xu.js";import{R as ct}from"./RouteSectionTabs-B7npqca_.js";import{S as ht}from"./Schedule-BBoWBvCl.js";import{T as ut}from"./TableInfo-B2X54z7i.js";import dt from"./TaskInfo-C8qSIbPH.js";import{T as mt}from"./TaskTypeName-bEgQZfX7.js";import{C as pt}from"./corner-left-up-D3eQ9gWL.js";import"./string-B0Tq569e.js";import"./ValidationTag-C6BUHddW.js";import"./render-Bqw3AFAH.js";import"./video-Yn96Kb74.js";import"./EntityPreview-DQBzHKkN.js";import"./VideoViewer-Da8LCLxo.js";import"./index-KDZ8UbBO.js";import"./dom-tO7tlkHV.js";import"./eye-CKzk1Q6q.js";import"./PeopleNameCell-Et8wdH5i.js";import"./TaskTypeCell-DM2gnWrD.js";import"./Combobox-DQpIQydI.js";import"./BuildFilterModal-C3nrV5vY.js";import"./ComboboxStatus-DYpCiml-.js";import"./ComboboxStyled-fscUNRmK.js";import"./ComboboxTaskType-CiBcPUsC.js";import"./ComboboxBoolean-DJwCfClJ.js";import"./TextField-p_HJuEKt.js";import"./ModalFooter-BJ98b-60.js";import"./PeopleField-CJ8IkJD1.js";import"./TextareaField-Bd7jnoYr.js";import"./EmojiButton-B9I5hDFH.js";import"./FileUpload-C4E3YXqL.js";import"./ConfirmModal-CYuRpfjg.js";import"./DepartmentName-C_7ZW05X.js";import"./list-chevrons-up-down-ByJjEZOU.js";import"./briefcase-DXQKuIYE.js";import"./csv-cx9HGs3n.js";import"./PreviewPlayer-CsSraBfQ.js";import"./PlaylistPlayer-DoTL8QsR.js";import"./ComboboxSimple-DU0Ahozo.js";import"./clipboard-CQqgyZ_h.js";import"./DeleteModal-CaB_X4-T.js";import"./BaseModal-BCd5z4wK.js";import"./ComboboxDepartment-whRm-Bo0.js";import"./ComboboxStudio-q2R7SCuH.js";import"./play-B4GV49GM.js";import"./triangle-alert-DAfmXCpT.js";import"./thumbs-up-DoHhBcNt.js";import"./copy-BH2iDnK6.js";import"./vue.esm-bundler-Cb2j4MJL.js";import"./DeleteEntities-ZGV8gTRL.js";import"./HardDeleteModal-CyBgP8oG.js";import"./SearchField-DO27Jrsj.js";import"./corner-right-up-xElzR7oO.js";const _t={name:"shot",mixins:[st,ot],components:{ButtonSimple:Y,ComboboxNumber:it,ChevronLeftIcon:K,ChevronRightIcon:H,CornerLeftUpIcon:pt,DescriptionCell:rt,EditShotModal:nt,EntityChat:lt,EntityNews:et,EntityPreviewFiles:tt,EntityTaskList:$,EntityTimeLogs:x,EntityThumbnail:G,PageSubtitle:at,RouteSectionTabs:ct,Schedule:ht,TableInfo:ut,TaskInfo:dt,TaskTypeName:mt},data(){return{type:"shot",currentShot:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...Z(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","route","shotMap","shotMetadataDescriptors","shotSearchText","shotsPath","taskMap","taskTypeMap"]),title(){return this.currentShot?this.currentShot.episode_name?`${this.currentShot.episode_name} / ${this.currentShot.sequence_name} / ${this.currentShot.name}`:`${this.currentShot.sequence_name} / ${this.currentShot.name}`:this.$t("main.loading")},shotThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentShot.preview_file_id}.png`},isPreview(){return this.currentShot&&this.currentShot.preview_file_id&&this.currentShot.preview_file_id.length>0},getShotsRoute(){const t={name:"shots",params:{production_id:this.currentProduction.id},query:{search:this.shotSearchText}};return this.currentEpisode&&(t.name="episode-shots",t.params.episode_id=this.currentEpisode.id),t},nbAssets(){let t=0;return this.currentShot&&this.currentSection==="casting"&&this.currentShot.castingAssetsByType&&this.currentShot.castingAssetsByType.forEach(i=>{t+=i.length}),t}},methods:{...X(["clearSelectedTasks","editShot","loadShot","loadShotCasting"]),changeTab(t){this.selectedTab=t},getCurrentShot(){return new Promise((t,i)=>{const f=this.route.params.shot_id,b=W.cache.shotMap.get(f)||null;return b?t(b):this.loadShot(f).then(t)})},onEditClicked(){this.modals.edit=!0},confirmEditShot(t){t.id=this.currentShot.id,t.data.resolution=t.resolution,t.data.max_retakes=t.max_retakes,t.data.frame_in=t.frameIn,t.data.frame_out=t.frameOut,t.data.fps=t.fps,this.loading.edit=!0,this.errors.edit=!1,this.editShot(t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(t){let i=t.episode_id;this.isTVShow&&!i&&(i="main");const f={name:"asset",params:{production_id:this.currentProduction.id,asset_id:t.asset_id}};return Q(f,i)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.getCurrentShot().then(t=>(this.currentShot=t,this.loadShotCasting(this.currentShot))).then(()=>{this.casting.isLoading=!1}).catch(t=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(t)})})},init(){this.getCurrentShot().then(t=>{this.currentShot=t,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentShot?this.loadShotCasting(this.currentShot).then(()=>{this.casting.isLoading=!1,setTimeout(this.initSchedule,100)}).catch(i=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(i)}):(this.resetData(),setTimeout(this.initSchedule,100))}).catch(console.error)},initSchedule(){this.$refs["schedule-widget"]?.scrollToDate(this.scheduleItems[0].startDate)}},watch:{$route(){const t=this.route.params.shot_id;this.currentAsset&&this.currentShot.id!==t&&this.init(),this.currentSection=this.route.query.section||"infos"}},head(){return{title:`${this.title} - Kitsu`}}},ft={class:"columns fixed-page shot xyz-in",xyz:"fade"},St={class:"column main-column"},yt={class:"page-header flexrow"},gt={class:"flexrow-item ml2"},bt={class:"entity-title flexrow-item"},kt={class:"entity-data block"},vt={class:"flexrow mt1"},wt={class:"flexcolumn infos"},Tt={class:"flexrow"},Ct={class:"flexrow-item has-text-right"},Et={class:"table-body"},Lt={key:0,class:"datatable no-header"},It={class:"datatable-body"},Pt={class:"datatable-row"},Mt={class:"field-label"},Dt={class:"datatable-row"},zt={class:"field-label"},Bt={key:0,class:"datatable-row"},Rt={class:"field-label"},Vt={key:1,class:"datatable-row"},At={class:"field-label"},Nt={key:2,class:"datatable-row"},qt={class:"field-label"},Ut={key:3,class:"datatable-row"},Ft={class:"field-label"},jt={key:4,class:"datatable-row"},Ot={class:"field-label"},Gt={class:"field-label"},Ht={class:"shot-casting"},Kt={key:0},Yt={key:0},Jt={class:"asset-type"},Qt={class:"asset-list"},Wt={class:"break-word"},Xt={key:0,class:"ready-for flexrow"},Zt={key:1,class:"mt1"},xt={key:1,class:"schedule mt1"},$t={class:"wrapper"},te={class:"column side-column"};function ee(t,i,f,b,e,_){const C=n("corner-left-up-icon"),y=n("router-link"),v=n("entity-thumbnail"),E=n("chevron-left-icon"),L=n("chevron-right-icon"),I=n("route-section-tabs"),P=n("combobox-number"),w=n("page-subtitle"),M=n("entity-task-list"),D=n("button-simple"),z=n("description-cell"),B=n("entity-chat"),R=n("task-type-name"),V=n("table-info"),A=n("schedule"),N=n("entity-preview-files"),q=n("entity-time-logs"),U=n("entity-news"),F=n("task-info"),j=n("edit-shot-modal");return o(),l("div",ft,[s("div",St,[s("div",yt,[c(y,{class:"flexrow-item has-text-centered back-link",to:_.getShotsRoute},{default:S(()=>[c(C)]),_:1},8,["to"]),s("span",gt,[e.currentShot?(o(),d(v,{key:0,class:"entity-thumbnail",entity:e.currentShot,"empty-width":100,"empty-height":60,width:100},null,8,["entity"])):h("",!0)]),s("div",bt,r(_.title),1),i[4]||(i[4]=s("div",{class:"filler"},null,-1)),t.previousEntityPath&&t.entityList.length>1?(o(),d(y,{key:0,class:"flexrow-item has-text-centered back-link ml1",to:t.previousEntityPath},{default:S(()=>[c(E)]),_:1},8,["to"])):h("",!0),t.nextEntityPath&&t.entityList.length>1?(o(),d(y,{key:1,class:"flexrow-item has-text-centered back-link",to:t.nextEntityPath},{default:S(()=>[c(L)]),_:1},8,["to"])):h("",!0)]),s("div",kt,[c(I,{class:"section-tabs","active-tab":t.currentSection,route:t.$route,tabs:t.entityTabs},null,8,["active-tab","route","tabs"]),s("div",vt,[m(s("span",null,r(_.nbAssets)+" "+r(t.$tc("assets.number",_.nbAssets)),513),[[p,t.currentSection==="casting"]]),m(s("span",{class:"tag tag-standby"},r(t.$t("breakdown.fields.standby")),513),[[p,t.currentSection==="casting"&&e.currentShot&&e.currentShot.is_casting_standby]]),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),m(s("span",{class:"flexrow-item mt05"},r(t.$t("schedule.zoom_level"))+": ",513),[[p,t.currentSection==="schedule"]]),m(c(P,{class:"zoom-level flexrow-item",options:t.zoomOptions,"is-simple":"",modelValue:t.zoomLevel,"onUpdate:modelValue":i[0]||(i[0]=a=>t.zoomLevel=a)},null,8,["options","modelValue"]),[[p,t.currentSection==="schedule"]])]),m(s("div",wt,[c(w,{text:t.$t("shots.tasks")},null,8,["text"]),c(M,{class:"task-list",entries:t.currentTasks,"is-loading":!e.currentShot,"is-error":!1,onTaskSelected:t.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",Tt,[c(w,{text:t.$t("main.info")},null,8,["text"]),i[6]||(i[6]=s("div",{class:"filler"},null,-1)),s("div",Ct,[t.isCurrentUserManager?(o(),d(D,{key:0,icon:"edit",title:t.$t("shots.edit_title"),onClick:i[1]||(i[1]=a=>e.modals.edit=!0)},null,8,["title"])):h("",!0)])]),s("div",Et,[e.currentShot?(o(),l("table",Lt,[s("tbody",It,[s("tr",Pt,[s("td",Mt,r(t.$t("shots.fields.description")),1),c(z,{entry:e.currentShot,full:!0},null,8,["entry"])]),s("tr",Dt,[s("td",zt,r(t.$t("shots.fields.nb_frames")),1),s("td",null,r(e.currentShot?e.currentShot.nb_frames:""),1)]),e.currentShot&&e.currentShot.data&&e.currentShot.data.frame_in!=null?(o(),l("tr",Bt,[s("td",Rt,r(t.$t("shots.fields.frame_in")),1),s("td",null,r(e.currentShot?e.currentShot.data.frame_in:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.frame_out?(o(),l("tr",Vt,[s("td",At,r(t.$t("shots.fields.frame_out")),1),s("td",null,r(e.currentShot?e.currentShot.data.frame_out:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.fps?(o(),l("tr",Nt,[s("td",qt,r(t.$t("shots.fields.fps")),1),s("td",null,r(e.currentShot?e.currentShot.data.fps:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.resolution?(o(),l("tr",Ut,[s("td",Ft,r(t.$t("shots.fields.resolution")),1),s("td",null,r(e.currentShot?e.currentShot.data.resolution:""),1)])):h("",!0),e.currentShot&&e.currentShot.data&&e.currentShot.data.max_retakes?(o(),l("tr",jt,[s("td",Ot,r(t.$t("shots.fields.max_retakes")),1),s("td",null,r(e.currentShot?e.currentShot.data.max_retakes:""),1)])):h("",!0),(o(!0),l(g,null,k(t.shotMetadataDescriptors,a=>(o(),l("tr",{key:a.id,class:"datatable-row"},[s("td",Gt,r(a.name),1),s("td",null,r(e.currentShot&&e.currentShot.data?e.currentShot.data[a.field_name]:""),1)]))),128))])])):h("",!0)])],512),[[p,t.currentSection==="infos"]]),t.currentSection==="chat"?(o(),d(B,{key:0,entity:e.currentShot,name:e.currentShot?e.currentShot.full_name:""},null,8,["entity","name"])):h("",!0),m(s("div",Ht,[e.currentShot?(o(),l("div",Kt,[e.currentShot&&e.currentShot.castingAssetsByType&&e.currentShot.castingAssetsByType[0].length>0?(o(),l("div",Yt,[(o(!0),l(g,null,k(e.currentShot.castingAssetsByType,a=>(o(),l("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Jt,r(a.length>0?a[0].asset_type_name:"")+" ("+r(a.length)+") ",1),s("div",Qt,[(o(!0),l(g,null,k(a,u=>(o(),d(y,{class:"asset-link",key:u.id,to:_.buildAssetRoute(u)},{default:S(()=>[c(v,{class:J(["entity-thumbnail",{shared:u.shared}]),entity:u,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),s("div",Wt,[T(r(u.asset_name)+" ",1),u.nb_occurences>1?(o(),l(g,{key:0},[T(" ("+r(u.nb_occurences)+") ",1)],64)):h("",!0)]),!u.shared&&u.ready_for?(o(),l("div",Xt,[c(R,{class:"flexrow-item","task-type":t.taskTypeMap.get(u.ready_for),"current-production-id":t.currentProduction.id,title:"Ready for: "+t.taskTypeMap.get(u.ready_for).name},null,8,["task-type","current-production-id","title"])])):h("",!0)]),_:2},1032,["to"]))),128))])]))),128))])):(o(),l("div",Zt,r(t.$t("shots.no_casting")),1))])):(o(),d(V,{key:1,"is-loading":e.casting.isLoading,"is-error":e.casting.isError},null,8,["is-loading","is-error"]))],512),[[p,t.currentSection==="casting"]]),t.scheduleItems[0].children.length>0?m((o(),l("div",xt,[s("div",$t,[c(A,{ref:"schedule-widget","start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1,onItemChanged:t.saveTaskScheduleItem,onEstimationChanged:i[2]||(i[2]=a=>t.saveTaskScheduleItem(a.item))},null,8,["start-date","end-date","hierarchy","zoom-level","onItemChanged"])])],512)),[[p,t.currentSection==="schedule"]]):h("",!0),t.currentSection==="preview-files"?(o(),d(N,{key:2,entity:e.currentShot},null,8,["entity"])):h("",!0),t.currentSection==="time-logs"?(o(),d(q,{key:3,entity:e.currentShot},null,8,["entity"])):h("",!0)])]),m(s("div",te,[c(F,{task:e.currentTask,"entity-type":"Shot","with-actions":""},{default:S(()=>[c(U,{class:"news-column",entity:e.currentShot},null,8,["entity"])]),_:1},8,["task"])],512),[[p,t.currentSection==="infos"]]),c(j,{ref:"edit-shot-modal",active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"shot-to-edit":e.currentShot,onCancel:i[3]||(i[3]=a=>e.modals.edit=!1),onConfirm:_.confirmEditShot},null,8,["active","is-loading","is-error","shot-to-edit","onConfirm"])])}const ls=O(_t,[["render",ee],["__scopeId","data-v-0b873b16"]]);export{ls as default};
//# sourceMappingURL=Shot-BaCaqMhc.js.map
