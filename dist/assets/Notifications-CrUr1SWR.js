import{x as v,_ as j,S as E,P as H,R as z,aB as q,aC as Q,E as G,B as K,r as n,o,c as m,d as r,f as d,g as u,h as p,t as c,F as _,e as W,k as J,v as X,n as Y,w as T,H as h,i as Z,m as C,aD as $,a as ee,b as te}from"./index-DF-DoQlt.js";import{b as se}from"./render-DYxr_jus.js";import{B as ae}from"./BooleanField-r8LThAuD.js";import{C as ie}from"./ComboboxStatus-CBgYMSHg.js";import{C as oe}from"./ComboboxStyled-BlKJF8gk.js";import{C as re}from"./ComboboxTaskType-C7Rz0ksS.js";import le from"./TaskInfo-C2DOZkHo.js";import{T as ne}from"./TaskTypeName-C0px4urt.js";import{V as me}from"./ValidationTag-Cx26FfxH.js";import{U as pe}from"./user-Dx2ETMiQ.js";import{M as de,C as ce,A as ue}from"./monitor-play-CzM3IYGj.js";import"./video-Yn96Kb74.js";import"./check-CO1MD15r.js";import"./csv-IlynXFQz.js";import"./string-B0Tq569e.js";import"./PreviewPlayer-Bpr7Jn1C.js";import"./PlaylistPlayer-ByYDRf10.js";import"./ComboboxSimple-B2TmvsnK.js";import"./ModalFooter-Chk0SGv-.js";import"./TextField-BKWlN2Ov.js";import"./clipboard-CQqgyZ_h.js";import"./dom-tO7tlkHV.js";import"./Combobox-A6pnhVs3.js";import"./DeleteModal-DwXK5r5w.js";import"./index-Bnig1aiX.js";import"./BaseModal-D3KB-h7q.js";import"./ComboboxDepartment-Cjj8YvK6.js";import"./DepartmentName-DCchDYyW.js";import"./ComboboxStudio-D3qg68ZP.js";import"./play-DUQ3D5JY.js";import"./EmojiButton-CJhEAvTS.js";import"./FileUpload-GCzHM4-i.js";import"./ConfirmModal-BIIMruUl.js";import"./triangle-alert-CW28Rlrw.js";import"./thumbs-up-UCZcudrF.js";import"./copy-DgQ7ppWI.js";import"./vue.esm-bundler-pS9-uSLU.js";import"./VideoViewer-B89y-Tko.js";import"./BuildFilterModal-C18AF9bI.js";import"./ComboboxBoolean-DT116Lfu.js";import"./PeopleField-BoranyvF.js";import"./DeleteEntities-5LkT8YiQ.js";import"./HardDeleteModal-BLE4oONO.js";import"./SearchField-BdP8lRoc.js";import"./corner-right-up-xDF204hE.js";const _e={methods:{applyParametersToUrl(){const e=Object.keys(this.parameters).reduce((s,l)=>(this.parameters[l]&&(s[l]=this.parameters[l],s[l]==="true"?s[l]=!0:s[l]==="false"&&(s[l]=!1)),s),{});this.$router.replace({query:e})},getParametersFromUrl(){return this.$route.query},applyQueryParameters(e){const s=this.getParametersFromUrl();return Object.assign(e,s||{}),e},saveParametersToPreferences(){v.setObjectPreference(`parameters:${this.parameterNamespace}`,this.parameters)},getParametersFromPreferences(e){return v.getObjectPreference(`parameters:${this.parameterNamespace}`)||e}},watch:{parameters:{deep:!0,handler(){this.applyParametersToUrl(),this.saveParametersToPreferences()}}}},he={name:"notifications",mixins:[_e],components:{AtSignIcon:ue,BooleanField:ae,ButtonSimple:K,ComboboxStatus:ie,ComboboxStyled:oe,ComboboxTaskType:re,CornerUpLeftIcon:ce,EntityThumbnail:G,ImageIcon:Q,MessageSquareIcon:q,MonitorPlayIcon:de,PeopleAvatar:z,ProductionName:H,Spinner:E,TaskInfo:le,TaskTypeName:ne,UserIcon:pe,ValidationTag:me},data(){return{currentTask:null,currentNotificationId:null,errors:{notifications:!1},loading:{currentTask:!0,markAll:!1,more:!1,notifications:!1},parameterNamespace:"notifications",parameters:{taskTypeId:"",taskStatusId:"",typeMode:"",showComments:!1,statusMode:null,watchingMode:null},statusOptions:[{label:this.$t("notifications.all_statuses"),value:null},{label:this.$t("notifications.only_read"),value:"read"},{label:this.$t("notifications.only_unread"),value:"unread"}],typeOptions:[{label:this.$t("notifications.all_types"),value:""},{label:this.$t("notifications.only_comments"),value:"comment"},{label:this.$t("notifications.only_mentions"),value:"mention"},{label:this.$t("notifications.only_assignations"),value:"assignation"},{label:this.$t("notifications.only_replies"),value:"reply"},{label:this.$t("notifications.only_playlists_ready"),value:"playlist-ready"}],watchingOptions:[{label:this.$t("notifications.all_notifications"),value:null},{label:this.$t("notifications.only_watching"),value:"watching"},{label:this.$t("notifications.only_non_watching"),value:"non-watching"}]}},created(){this.clearNotifications()},mounted(){const e=this.getParametersFromPreferences(this.parameters)||{};this.applyQueryParameters(e),e.showComments==="true"||e.showComments===!0?e.showComments=!0:e.showComments=!1,this.parameters=e,this.reloadData()},computed:{...te(["departmentMap","notifications","personMap","productionMap","taskStatus","taskTypes","taskTypeMap","user"]),taskStatusList(){return[{id:"",color:"#999",short_name:this.$t("news.all")}].concat([...this.taskStatus])},taskTypeList(){return[{id:"",color:"#999",name:this.$t("news.all")}].concat([...this.taskTypes])}},methods:{...ee(["clearNotifications","loadMoreNotifications","loadNotification","loadNotifications","loadTask","markAllNotificationsAsRead","toggleNotificationReadStatus"]),reloadData(){this.loading.notifications=!0,this.errors.notifications=!1,this.currentTask=null;const e={task_status_id:this.parameters.taskStatusId,task_type_id:this.parameters.taskTypeId,type:this.parameters.typeMode};this.parameters.statusMode&&(e.read=this.parameters.statusMode==="read"),this.parameters.watchingMode!==null&&(e.watching=this.parameters.watchingMode==="watching"),this.loadNotifications(e).then(()=>{this.loading.notifications=!1}).catch(s=>{console.error(s),this.errors.notifications=!0})},onBodyScroll(e){if(!this.$refs.body)return;const s=e.target;this.$refs.body.scrollHeight-this.$refs.body.offsetHeight<s.scrollTop+100&&this.loadFollowingNotifications()},async loadFollowingNotifications(){if(!this.loading.more&&!this.loading.notifications){this.loading.more=!0;const e={task_status_id:this.parameters.taskStatusId,task_type_id:this.parameters.taskTypeId,type:this.parameters.typeMode};this.parameters.statusMode&&(e.read=this.parameters.statusMode==="read"),this.parameters.watchingMode&&(e.watching=this.parameters.watchingMode==="watching"),await this.loadMoreNotifications(e),this.loading.more=!1}},entityPath(e){const s=this.taskTypeMap.get(e.task_type_id);if(!s)return this.$router.currentRoute;const l={name:"task",params:{production_id:e.project_id,task_id:e.task_id,type:$(s.for_entity)}};return e.episode_id&&(l.name="episode-task",l.params.episode_id=e.episode_id),l},formatDate(e){const s=C.tz(e,"UTC");return e=C(s.format()).fromNow(),e[0].toUpperCase()+e.slice(1)},personName(e){const s=this.personMap.get(e.author_id);return s?s.full_name:""},playlistPath(e){const s=this.productionMap.get(e.project_id),l={production_id:e.project_id,playlist_id:e.playlist_id},f=s.production_type==="tvshow";return f&&(e.episode_id&&(l.episode_id=e.episode_id),e.playlist_for_entity==="asset"&&(l.episode_id=e.playlist_is_for_all?"all":"main")),{name:f?"episode-playlist":"playlist",params:l}},buildTaskFromNotification(e){return{id:e.task_id,task_status_id:e.task_status_id,task_type_id:e.task_type_id,episode_id:e.episode_id}},buildTaskTypeFromNotification(e){return{...this.taskTypeMap.get(e.task_type_id),episode_id:e.episode_id}},onNotificationSelected(e,s){this.isPlaylistReady(s)||e.target.classList.contains("bool-field")||e.target.parentElement?.classList.contains("bool-field")||e.target.parentElement?.parentElement?.classList.contains("bool-field")||(this.currentNotificationId!==s.id?(this.loading.currentTask=!0,this.loadTask({taskId:s.task_id}).then(l=>{this.loading.currentTask=!1,this.currentTask=l,this.currentNotificationId=s.id}).catch(console.error)):(this.currentTask=null,this.currentNotificationId=null))},renderComment:se,isAssignation:e=>e.notification_type==="assignation",isComment:e=>!e.notification_type||e.notification_type==="comment"&&!e.preview_file_id,isMention:e=>e.notification_type==="mention",isPlaylistReady:e=>e.notification_type==="playlist-ready",isReplyMention:e=>e.notification_type==="reply-mention",isReply:e=>e.notification_type==="reply",isPublish(e){return e&&e.preview_file_id&&!this.isMention(e)&&!this.isReply(e)&&!this.isReplyMention(e)},isSelected(e){return e.id===this.currentNotificationId},toggleNotificationRead(e,s){s!==e.read&&this.toggleNotificationReadStatus(e)},async markAllNotificationsRead(){this.loading.markAll=!0,await this.markAllNotificationsAsRead(),this.loading.markAll=!1}},socket:{events:{"notification:new"(e){if(this.user.id===e.person_id){const s=e.notification_id;this.loadNotification(s).catch(console.error)}},"preview-file:add-file"(e){const s=e.comment_id,l=e.preview_file_id;this.$store.commit("NOTIFICATION_ADD_PREVIEW",{previewId:l,commentId:s})}}},watch:{"parameters.taskTypeId"(){this.reloadData()},"parameters.taskStatusId"(){this.reloadData()},"parameters.typeMode"(){this.reloadData()},"parameters.statusMode"(){this.reloadData()},"parameters.watchingMode"(){this.reloadData()}},head(){return{title:`${this.$t("notifications.title")} - Kitsu`}}},ye={class:"columns fixed-page"},fe={class:"column main-column"},ke={class:"flexrow"},ge={class:"flexrow mb1"},we={key:0,class:"empty-list has-text-centered"},be={key:1,class:"has-text-centered"},Me=["onClick"],ve={class:"flexcolumn notification-line"},Te={key:0,class:"flexrow notification-header"},Ce={class:"flexrow-item ml1 mr05"},Ne={class:"flexrow-item"},Se={class:"date flexrow-item"},Ie={class:"has-text-right flexrow-item mr0"},Pe={class:"flexrow notification-header"},xe={class:"flexrow-item"},Re={class:"flexrow-item"},Ve={class:"date flexrow-item"},Ae={class:"has-text-right flexrow-item mr0"},Ue={class:"flexrow-item comment-content"},Le={key:0,class:"notification-info flexrow"},De={class:"person-name flexrow-item ml0"},Fe={class:"flexrow-item"},Be=["innerHTML"],Oe={key:2,class:"reply-title mt1"},je=["innerHTML"],Ee={class:"column side-column is-hidden-mobile hide-small-screen"};function He(e,s,l,f,i,a){const N=n("combobox-task-type"),S=n("combobox-status"),k=n("combobox-styled"),g=n("button-simple"),I=n("spinner"),P=n("monitor-play-icon"),w=n("people-avatar"),x=n("production-name"),b=n("router-link"),M=n("boolean-field"),R=n("at-sign-icon"),V=n("corner-up-left-icon"),A=n("user-icon"),U=n("image-icon"),L=n("message-square-icon"),D=n("entity-thumbnail"),F=n("task-type-name"),B=n("validation-tag"),O=n("task-info");return o(),m("div",ye,[r("div",fe,[r("div",{class:"notifications page",onScrollPassive:s[6]||(s[6]=(...t)=>a.onBodyScroll&&a.onBodyScroll(...t)),ref:"body"},[r("div",ke,[d(N,{class:"flexrow-item selector",label:e.$t("news.task_type"),"task-type-list":a.taskTypeList,modelValue:i.parameters.taskTypeId,"onUpdate:modelValue":s[0]||(s[0]=t=>i.parameters.taskTypeId=t)},null,8,["label","task-type-list","modelValue"]),d(S,{class:"flexrow-item selector",label:e.$t("news.task_status"),"task-status-list":a.taskStatusList,modelValue:i.parameters.taskStatusId,"onUpdate:modelValue":s[1]||(s[1]=t=>i.parameters.taskStatusId=t)},null,8,["label","task-status-list","modelValue"]),d(k,{class:"flexrow-item selector field",label:e.$t("main.type"),options:i.typeOptions,modelValue:i.parameters.typeMode,"onUpdate:modelValue":s[2]||(s[2]=t=>i.parameters.typeMode=t)},null,8,["label","options","modelValue"]),d(k,{class:"flexrow-item selector field",label:e.$t("main.status"),options:i.statusOptions,modelValue:i.parameters.statusMode,"onUpdate:modelValue":s[3]||(s[3]=t=>i.parameters.statusMode=t)},null,8,["label","options","modelValue"]),d(k,{class:"flexrow-item selector field",label:e.$t("notifications.watching"),options:i.watchingOptions,modelValue:i.parameters.watchingMode,"onUpdate:modelValue":s[4]||(s[4]=t=>i.parameters.watchingMode=t)},null,8,["label","options","modelValue"])]),r("div",ge,[d(g,{class:"flexrow-item",text:e.$t("notifications.show_comments"),active:i.parameters.showComments,onClick:s[5]||(s[5]=t=>i.parameters.showComments=!i.parameters.showComments)},null,8,["text","active"]),s[7]||(s[7]=r("span",{class:"filler"},null,-1)),i.parameters.taskTypeId===""&&i.parameters.taskStatusId===""&&i.parameters.typeMode===""&&[null,"unread"].includes(i.parameters.statusMode)&&i.parameters.watchingMode===null?(o(),u(g,{key:0,class:"flexrow-item","is-loading":i.loading.markAll,text:e.$t("notifications.mark_all_as_read"),onClick:a.markAllNotificationsRead},null,8,["is-loading","text","onClick"])):p("",!0)]),!i.loading.notifications&&(!e.notifications||e.notifications.length===0)?(o(),m("div",we,c(e.$t("notifications.no_notifications")),1)):p("",!0),i.loading.notifications?(o(),m("div",be,[d(I)])):p("",!0),(o(!0),m(_,null,W(e.notifications,t=>J((o(),m("div",{class:Y({notification:!0,"mention-notification":a.isMention(t),"playlist-ready-notification":a.isPlaylistReady(t),unread:!t.read,selected:a.isSelected(t)}),key:t.id,onClick:y=>a.onNotificationSelected(y,t)},[r("div",ve,[a.isPlaylistReady(t)?(o(),m("div",Te,[d(P,{class:"icon flexrow-item",title:e.$t("notifications.playlist_is_ready")},null,8,["title"]),e.personMap.get(t.author_id)?(o(),u(w,{key:0,class:"flexrow-item",person:e.personMap.get(t.author_id),size:30,"is-link":!1},null,8,["person"])):p("",!0),d(x,{class:"flexrow-item",production:e.productionMap.get(t.project_id),size:30,"with-avatar":!0,"only-avatar":!0},null,8,["production"]),r("span",Ce,c(e.$t("notifications.playlist_ready_text")),1),r("span",Ne,[d(b,{to:a.playlistPath(t)},{default:T(()=>[h(c(t.playlist_name),1)]),_:2},1032,["to"])]),r("span",Se,c(a.formatDate(t.created_at)),1),s[8]||(s[8]=r("div",{class:"filler"},null,-1)),r("div",Ie,[d(M,{class:"selector",label:e.$t("notifications.read"),"is-small":"",onClick:y=>a.toggleNotificationRead(t,y),"model-value":t.read?"true":"false"},null,8,["label","onClick","model-value"])])])):(o(),m(_,{key:1},[r("div",Pe,[a.isMention(t)||a.isReplyMention(t)?(o(),u(R,{key:0,class:"icon flexrow-item",title:e.$t("notifications.mention")},null,8,["title"])):a.isReply(t)?(o(),u(V,{key:1,class:"icon flexrow-item",title:e.$t("notifications.reply")},null,8,["title"])):a.isAssignation(t)?(o(),u(A,{key:2,class:"icon flexrow-item",title:e.$t("notifications.assignation")},null,8,["title"])):a.isPublish(t)?(o(),u(U,{key:3,class:"icon flexrow-item",title:e.$t("notifications.publish")},null,8,["title"])):a.isComment(t)?(o(),u(L,{key:4,class:"icon flexrow-item",title:e.$t("notifications.comment")},null,8,["title"])):p("",!0),e.personMap.get(t.author_id)?(o(),u(w,{key:5,class:"flexrow-item",person:e.personMap.get(t.author_id),size:30,"is-link":!1},null,8,["person"])):p("",!0),r("div",xe,[d(D,{entity:{preview_file_id:t.entity_preview_file_id},height:40},null,8,["entity"])]),r("div",Re,[d(F,{class:"task-type-name","task-type":a.buildTaskTypeFromNotification(t),"production-id":t.project_id},null,8,["task-type","production-id"])]),d(b,{class:"flexrow-item",to:a.entityPath(t)},{default:T(()=>[h(c(t.project_name)+" / "+c(t.full_entity_name),1)]),_:2},1032,["to"]),t.change?(o(),u(B,{key:6,class:"validation-tag flexrow-item",task:a.buildTaskFromNotification(t)},null,8,["task"])):p("",!0),r("span",Ve,c(a.formatDate(t.created_at)),1),s[9]||(s[9]=r("div",{class:"filler"},null,-1)),r("div",Ae,[d(M,{class:"selector",label:e.$t("notifications.read"),"is-small":"",onClick:y=>a.toggleNotificationRead(t,y),"model-value":t.read?"true":"false"},null,8,["label","onClick","model-value"])])]),r("div",Ue,[i.parameters.showComments||a.isSelected(t)?(o(),m("div",Le,[r("span",De,c(a.personName(t)),1),r("div",Fe,[a.isPublish(t)?(o(),m(_,{key:0},[h(c(e.$t("notifications.published")),1)],64)):p("",!0),a.isComment(t)&&!a.isPublish(t)?(o(),m(_,{key:1},[h(c(e.$t("notifications.commented_on")),1)],64)):p("",!0),(a.isComment(t)||a.isPublish(t))&&t.change?(o(),m(_,{key:2},[h(c(e.$t("notifications.and_change_status")),1)],64)):p("",!0),a.isReply(t)?(o(),m(_,{key:3},[h(c(e.$t("notifications.replied_on")),1)],64)):p("",!0),a.isAssignation(t)?(o(),m(_,{key:4},[h(c(e.$t("notifications.assigned_you")),1)],64)):p("",!0),a.isMention(t)||a.isReplyMention(t)?(o(),m(_,{key:5},[h(c(e.$t("notifications.mention_you_on"))+" ",1),a.isReplyMention(t)?(o(),m(_,{key:0},[h(" ("+c(e.$t("main.reply").toLowerCase())+") ",1)],64)):p("",!0)],64)):p("",!0)])])):p("",!0),(a.isReply(t)||a.isReplyMention(t))&&(i.parameters.showComments||a.isSelected(t))?(o(),m("div",{key:1,class:"comment-text content reply-text",innerHTML:a.renderComment(t.reply_text,t.reply_mentions||[],t.reply_department_mentions||[],e.personMap,e.departmentMap)},null,8,Be)):p("",!0),(a.isReply(t)||a.isReplyMention(t))&&t.comment_text&&(i.parameters.showComments||a.isSelected(t))?(o(),m("div",Oe,[r("em",null,c(e.$t("notifications.initial_comment")),1)])):p("",!0),((a.isComment(t)||a.isMention(t))&&t.comment_text||a.isReply(t)||a.isReplyMention(t))&&(i.parameters.showComments||a.isSelected(t))?(o(),m("div",{key:3,class:"comment-text content",style:Z({opacity:a.isReply(t)||a.isReplyMention(t)?"0.8":"1"}),innerHTML:a.renderComment(t.comment_text,t.mentions,t.department_mentions||[],e.personMap,e.departmentMap)},null,12,je)):p("",!0)])],64))])],10,Me)),[[X,!i.loading.notifications]])),128))],544)]),r("div",Ee,[d(O,{task:i.currentTask,"is-loading":i.loading.currentTask},null,8,["task","is-loading"])])])}const Ut=j(he,[["render",He],["__scopeId","data-v-28a18bbe"]]);export{Ut as default};
//# sourceMappingURL=Notifications-CrUr1SWR.js.map
