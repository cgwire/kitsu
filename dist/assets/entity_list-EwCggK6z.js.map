{"version":3,"file":"entity_list-EwCggK6z.js","sources":["../../src/components/mixins/entity_list.js"],"sourcesContent":["import colors from '@/lib/colors'\nimport preferences from '@/lib/preferences'\nimport stringHelpers from '@/lib/string'\n\nimport assetStore from '@/store/modules/assets'\nimport editStore from '@/store/modules/edits'\nimport episodeStore from '@/store/modules/episodes'\nimport sequenceStore from '@/store/modules/sequences'\nimport shotStore from '@/store/modules/shots'\n\nexport const entityListMixin = {\n  emits: [\n    'change-sort',\n    'delete-all-tasks',\n    'field-changed',\n    'keep-task-panel-open',\n    'scroll'\n  ],\n\n  created() {\n    this.initHiddenColumns(this.validationColumns, this.hiddenColumns)\n  },\n\n  mounted() {\n    if (this.resizeHeaders) this.resizeHeaders()\n    window.addEventListener('keydown', this.onKeyDown, false)\n    window.addEventListener('keyup', this.onKeyUp, false)\n    this.stickedColumns =\n      preferences.getObjectPreference(this.localStorageStickKey) || {}\n    if (this.domEvents) this.addEvents(this.domEvents)\n  },\n\n  beforeUnmount() {\n    window.removeEventListener('keydown', this.onKeyDown)\n    window.removeEventListener('keyup', this.onKeyUp)\n    if (this.domEvents) {\n      this.removeEvents(this.domEvents)\n      document.body.style.cursor = 'default'\n    }\n  },\n\n  data() {\n    return {\n      columnSelectorDisplayed: false\n    }\n  },\n\n  computed: {\n    visibleMetadataDescriptors() {\n      return this.metadataDescriptors.filter(descriptor => {\n        const header = this.metadataDisplayHeaders[descriptor.field_name]\n        return header === undefined || header\n      })\n    },\n\n    nonStickedVisibleMetadataDescriptors() {\n      return this.visibleMetadataDescriptors.filter(\n        descriptor =>\n          !this.stickedColumns[descriptor.id] &&\n          this.metadataDescriptorIsInDepartmentFilter(descriptor)\n      )\n    },\n\n    stickedVisibleMetadataDescriptors() {\n      return this.visibleMetadataDescriptors.filter(\n        descriptor =>\n          this.stickedColumns[descriptor.id] &&\n          this.metadataDescriptorIsInDepartmentFilter(descriptor)\n      )\n    },\n\n    nonStickedDisplayedValidationColumns() {\n      return this.displayedValidationColumns.filter(\n        columnId =>\n          !this.stickedColumns[columnId] &&\n          this.validationColumnsIsInDepartmentFilter(columnId)\n      )\n    },\n\n    stickedDisplayedValidationColumns() {\n      return this.displayedValidationColumns.filter(\n        columnId =>\n          this.stickedColumns[columnId] &&\n          this.validationColumnsIsInDepartmentFilter(columnId)\n      )\n    },\n\n    isEmptyTask() {\n      return (\n        !this.isEmptyList &&\n        !this.isLoading &&\n        this.validationColumns &&\n        this.validationColumns.length === 0\n      )\n    }\n  },\n\n  methods: {\n    onBodyScroll(event) {\n      const position = event.target\n      this.$emit('scroll', position.scrollTop)\n    },\n\n    updateOffsets() {\n      if (this.isLoading) {\n        return\n      }\n      this.$nextTick(() => {\n        let offset = this.$refs['th-episode']\n          ? this.$refs['th-episode'].clientWidth\n          : 0\n        this.offsets = {}\n\n        if (this.isShowInfos) {\n          for (\n            let metadataCol = 0;\n            metadataCol < this.stickedVisibleMetadataDescriptors.length;\n            metadataCol++\n          ) {\n            this.offsets[`editor-${metadataCol}`] = offset\n            offset += this.$refs[`editor-${metadataCol}`][0].$el.clientWidth\n          }\n        }\n        for (\n          let validationCol = 0;\n          validationCol < this.stickedDisplayedValidationColumns.length;\n          validationCol++\n        ) {\n          this.offsets[`validation-${validationCol}`] = offset\n          offset += this.$refs[`validation-${validationCol}`][0].$el.clientWidth\n        }\n      })\n    },\n\n    onInputKeyUp(event, i, j) {\n      const listWidth = this.visibleMetadataDescriptors.length + 4\n      const listHeight = this.displayedEpisodesLength\n      this.keyMetadataNavigation(listWidth, listHeight, i, j, event.key)\n      return this.pauseEvent(event)\n    },\n\n    getBackground(color) {\n      return colors.hexToRGBa(color, 0.08)\n    },\n\n    buildHideKey(columnId) {\n      return `column-${this.currentProduction.id}-${columnId}`\n    },\n\n    initHiddenColumns(validationColumns, hiddenColumns) {\n      if (validationColumns && hiddenColumns) {\n        validationColumns.forEach(columnId => {\n          const key = this.buildHideKey(columnId)\n          hiddenColumns[columnId] = localStorage.getItem(key) === 'true'\n        })\n      }\n    },\n\n    hideColumn(columnId) {\n      const key = this.buildHideKey(columnId)\n      let isColumnHidden = true\n      if (localStorage.getItem(key) === 'true') {\n        isColumnHidden = false\n      }\n      localStorage.setItem(key, isColumnHidden)\n      this.hiddenColumns[columnId] = isColumnHidden\n      return isColumnHidden\n    },\n\n    setScrollPosition(scrollPosition) {\n      if (this.$refs.body) {\n        this.$refs.body.scrollTop = scrollPosition\n      }\n    },\n\n    setScrollLeftPosition(scrollPosition) {\n      if (this.$refs.body) {\n        this.$refs.body.scrollLeft = scrollPosition\n      }\n    },\n\n    getValidationStyle(columnId) {\n      const taskType = this.taskTypeMap.get(columnId)\n      if (!taskType) return {}\n      return {\n        'border-left': `1px solid ${taskType.color}`,\n        background: this.getBackground(taskType.color)\n      }\n    },\n\n    onTaskSelected(validationInfo, sticked) {\n      const columnOffset = this.stickedDisplayedValidationColumns.length\n      const selection = []\n      if (!sticked) {\n        validationInfo = { ...validationInfo }\n        validationInfo.y += columnOffset\n      }\n      this.$emit('keep-task-panel-open', true)\n      if (validationInfo.isShiftKey) {\n        if (this.lastSelection) {\n          let startX = this.lastSelection.x\n          let endX = validationInfo.x\n          let startY = this.lastSelection.y\n          if (!sticked) startY += columnOffset\n          let endY = validationInfo.y\n          const grid = this[`${this.type}SelectionGrid`]\n          if (validationInfo.x < this.lastSelection.x) {\n            startX = validationInfo.x\n            endX = this.lastSelection.x\n          }\n          if (validationInfo.y < this.lastSelection.y) {\n            startY = validationInfo.y\n            endY = this.lastSelection.y\n            if (!sticked) endY += columnOffset\n          }\n\n          for (let i = startX; i <= endX; i++) {\n            for (let j = startY; j <= endY; j++) {\n              const validationCell = this.$refs[`validation-${i}-${j}`]?.[0]\n              const isSelectedCell = grid?.[i]?.[j]\n              if (validationCell?.selectable && !isSelectedCell) {\n                let y = validationCell.columnY\n                if (!sticked) y += columnOffset\n\n                selection.push({\n                  entity: validationCell.entity,\n                  column: validationCell.column,\n                  task: validationCell.task,\n                  x: validationCell.rowX,\n                  y\n                })\n              }\n            }\n          }\n          this.$store.commit('ADD_SELECTED_TASK', validationInfo)\n          this.updateTaskInQuery()\n        }\n      } else if (!validationInfo.isCtrlKey) {\n        this.$store.commit('CLEAR_SELECTED_TASKS')\n        this.updateTaskInQuery()\n      }\n      if (selection.length === 0) {\n        this.$store.commit('ADD_SELECTED_TASK', validationInfo)\n        this.updateTaskInQuery()\n      } else {\n        this.$store.commit('ADD_SELECTED_TASKS', selection)\n        this.updateTaskInQuery()\n      }\n\n      if (!validationInfo.isShiftKey && validationInfo.isUserClick) {\n        const x = validationInfo.x\n        let y = validationInfo.y\n        if (!sticked) y -= columnOffset\n        this.lastSelection = { x, y }\n        const ref = `validation-${x}-${y}`\n        const validationCell = this.$refs[ref][0]\n        this.$nextTick(() => {\n          this.scrollToValidationCell(validationCell)\n        })\n      }\n\n      this.$nextTick(() => {\n        this.$emit('keep-task-panel-open', false)\n      })\n    },\n\n    onTaskUnselected(validationInfo, sticked) {\n      if (!sticked) {\n        validationInfo = { ...validationInfo }\n        validationInfo.y += this.stickedDisplayedValidationColumns.length\n      }\n      if (!validationInfo.isCtrlKey) {\n        if (this.nbSelectedTasks === 1) {\n          this.$store.commit('REMOVE_SELECTED_TASK', validationInfo)\n        } else {\n          this.$store.commit('CLEAR_SELECTED_TASKS')\n          this.$store.commit('ADD_SELECTED_TASK', validationInfo)\n        }\n      } else {\n        this.$store.commit('REMOVE_SELECTED_TASK', validationInfo)\n      }\n      this.updateTaskInQuery()\n    },\n\n    showHeaderMenu(columnId, columnIndexInGrid, event) {\n      const headerMenuEl = this.$refs.headerMenu.$el\n      if (headerMenuEl.className === 'header-menu') {\n        headerMenuEl.className = 'header-menu hidden'\n      } else {\n        headerMenuEl.className = 'header-menu'\n        let headerElement = event.srcElement.parentNode.parentNode\n        if (headerElement.tagName !== 'TH') {\n          headerElement = headerElement.parentNode\n        }\n        const headerBox = headerElement.getBoundingClientRect()\n        const left = headerBox.left\n        const top = headerBox.bottom\n        const width = Math.max(100, headerBox.width - 1)\n        headerMenuEl.style.left = `${left}px`\n        headerMenuEl.style.top = `${top}px`\n        headerMenuEl.style.width = `${width}px`\n      }\n      this.lastHeaderMenuDisplayed = columnId\n      this.lastHeaderMenuDisplayedIndexInGrid = columnIndexInGrid\n    },\n\n    onMinimizeColumnToggled() {\n      this.hideColumn(this.lastHeaderMenuDisplayed)\n      this.showHeaderMenu()\n    },\n\n    onDeleteAllTasksClicked() {\n      this.$emit('delete-all-tasks', this.lastHeaderMenuDisplayed)\n      this.showHeaderMenu()\n    },\n\n    onSortByTaskTypeClicked() {\n      const taskTypeId = this.lastHeaderMenuDisplayed\n      this.$emit('change-sort', {\n        type: 'status',\n        column: taskTypeId,\n        name: this.taskTypeMap.get(taskTypeId).name\n      })\n      this.showHeaderMenu()\n    },\n\n    onSelectColumn(type) {\n      const taskTypeId = this.lastHeaderMenuDisplayed\n      const selection = []\n\n      let entities\n      switch (type) {\n        case 'asset':\n          entities = assetStore.cache.result\n          break\n        case 'edit':\n          entities = editStore.cache.result\n          break\n        case 'episode':\n          entities = episodeStore.cache.result\n          break\n        case 'sequence':\n          entities = sequenceStore.cache.result\n          break\n        case 'shot':\n          entities = shotStore.cache.result\n          break\n        default:\n          throw new Error(`Invalid entity type: ${type}`)\n      }\n\n      entities.forEach((entity, i) => {\n        selection.push({\n          entity,\n          column: this.taskTypeMap.get(taskTypeId),\n          task: this.taskMap.get(entity.validations.get(taskTypeId)),\n          x: i,\n          y: this.lastHeaderMenuDisplayedIndexInGrid\n        })\n      })\n\n      this.$store.commit('CLEAR_SELECTED_TASKS')\n      this.$nextTick(() => {\n        this.$store.commit('ADD_SELECTED_TASKS', selection)\n        this.updateTaskInQuery()\n        this.showHeaderMenu()\n      })\n    },\n\n    // i = line number in entity group and k is the index of the entity group\n    getEntityLineNumber(entities, i, k) {\n      this.$options.lineIndex = {}\n      const key = `${i}-${k}`\n      const cached = this.$options.lineIndex[key]\n      if (!cached) {\n        let j = 0\n        let index = 0\n        while (j < k) {\n          index += entities[j].length\n          j++\n        }\n        const val = i + index\n        this.$options.lineIndex[key] = val\n        return val\n      } else {\n        return cached\n      }\n    },\n\n    getGroupKey(group, i, fieldName) {\n      const key = group[0] ? group[0][fieldName] + group[0].canceled : ''\n      return `${i}-${key}`\n    },\n\n    onDescriptionChanged(entry, value) {\n      this.$emit('field-changed', {\n        entry,\n        fieldName: 'description',\n        value\n      })\n    },\n\n    onNumberFieldKeyDown(event) {\n      if (['ArrowDown', 'ArrowUp'].includes(event.key)) {\n        this.pauseEvent(event) // Requires dom mixin\n      }\n    },\n\n    toggleColumnSelector() {\n      this.columnSelectorDisplayed = !this.columnSelectorDisplayed\n    },\n\n    metadataDescriptorIsInDepartmentFilter(metadataDescriptor) {\n      return (\n        this.departmentFilter.length === 0 ||\n        metadataDescriptor.departments.length === 0 ||\n        this.departmentFilter.some(d =>\n          metadataDescriptor.departments.includes(d)\n        )\n      )\n    },\n\n    validationColumnsIsInDepartmentFilter(columnId) {\n      return (\n        this.departmentFilter.length === 0 ||\n        this.taskTypeMap.get(columnId)?.department_id === null ||\n        this.departmentFilter.includes(\n          this.taskTypeMap.get(columnId).department_id\n        )\n      )\n    },\n\n    isMetadataColumnEditAllowed(descriptorId) {\n      if (typeof descriptorId === 'string') {\n        if (this.isCurrentUserManager) {\n          return true\n        } else if (this.isCurrentUserSupervisor) {\n          if (this.user.departments.length === 0) {\n            return true\n          } else {\n            const metadataDescriptor = this.visibleMetadataDescriptors.find(\n              descriptor => descriptor.id === descriptorId\n            )\n            if (\n              metadataDescriptor.departments.length ===\n              this.user.departments.length\n            ) {\n              return this.user.departments.every(department =>\n                metadataDescriptor.departments.includes(department)\n              )\n            }\n          }\n        }\n      }\n      return false\n    },\n\n    isValidResolution(shot) {\n      if (!shot) return true\n      const res = this.getMetadataFieldValue({ field_name: 'resolution' }, shot)\n      if (!res || res.length === 0) return true\n      const isValid = new RegExp(/\\d{3,4}x\\d{3,4}/).test(res)\n      return isValid\n    },\n\n    toggleStickedColumns(columnId) {\n      const sticked = !this.stickedColumns[columnId]\n      this.stickedColumns = {\n        ...this.stickedColumns,\n        [columnId]: sticked\n      }\n      preferences.setObjectPreference(\n        this.localStorageStickKey,\n        this.stickedColumns\n      )\n    },\n\n    stickColumnClicked() {\n      this.toggleStickedColumns(this.lastHeaderMenuDisplayed)\n      this.showHeaderMenu()\n    },\n\n    metadataStickColumnClicked(event) {\n      this.toggleStickedColumns(this.lastMetadaDataHeaderMenuDisplayed)\n      this.showMetadataHeaderMenu(this.lastMetadaDataHeaderMenuDisplayed, event)\n    },\n\n    /*\n     * Update the url query string with the currently selected task id.\n     * (set a task_id field in the query string)\n     * If 0 or more than 1 task is selected, remove the task_id field.\n     */\n    updateTaskInQuery() {\n      if (this.nbSelectedTasks === 1) {\n        const selectedTaskIds = Array.from(this.selectedTasks.keys())\n        const taskId = selectedTaskIds[0]\n        this.$router.push({\n          query: {\n            ...this.$route.query,\n            task_id: taskId\n          }\n        })\n      } else {\n        this.$router.push({\n          query: {\n            ...this.$route.query,\n            task_id: undefined\n          }\n        })\n      }\n    },\n\n    /*\n     * Get entity map for current entity type.\n     *\n     * Do not use computed property to avoid caching issues.\n     */\n    getEntityMap() {\n      const entityMaps = {\n        asset: assetStore.cache.assetMap,\n        shot: shotStore.cache.shotMap,\n        sequence: sequenceStore.cache.sequenceMap,\n        episode: episodeStore.cache.episodeMap,\n        edit: editStore.cache.editMap\n      }\n      return entityMaps[this.type]\n    },\n\n    /*\n     * Select the task listed in the url query string (task_id field) if\n     * present.\n     */\n    selectTaskFromQuery() {\n      const taskId = this.$route.query.task_id\n      const task = this.taskMap.get(taskId)\n      if (task) {\n        const entityMap = this.getEntityMap()\n        const entity = entityMap.get(task.entity_id)\n\n        if (entity) {\n          const taskType = this.taskTypeMap.get(task.task_type_id)\n\n          let list = this[`displayed${stringHelpers.capitalize(this.type)}s`]\n          if (['asset', 'shot'].includes(this.type)) {\n            list = list.flat()\n          }\n          const x = list.findIndex(e => e.id === entity.id)\n          const y = this.displayedValidationColumns.indexOf(task.task_type_id)\n          this.$store.commit('ADD_SELECTED_TASK', {\n            task,\n            entity,\n            column: taskType,\n            x,\n            y\n          })\n        }\n      }\n    },\n\n    startBrowsing(event) {\n      if (event.target.tagName === 'INPUT') return\n\n      document.body.style.cursor = 'grabbing'\n      this.isBrowsingX = true\n      this.isBrowsingY = true\n      this.initialClientX = this.getClientX(event)\n      this.initialClientY = this.getClientY(event)\n    },\n\n    startBrowsingX(event) {\n      document.body.style.cursor = 'grabbing'\n      this.isBrowsingX = true\n      this.initialClientX = this.getClientX(event)\n    },\n\n    startBrowsingY(event) {\n      document.body.style.cursor = 'grabbing'\n      this.isBrowsingY = true\n      this.initialClientY = this.getClientY(event)\n    },\n\n    stopBrowsing(event) {\n      document.body.style.cursor = 'default'\n      this.isBrowsingX = false\n      this.isBrowsingY = false\n      this.initialClientX = null\n      this.initialClientY = null\n    },\n\n    onMouseMove(event) {\n      if (this.isBrowsingX) this.scrollTableLeft(event)\n      if (this.isBrowsingY) this.scrollTableTop(event)\n    },\n\n    scrollTableLeft(event) {\n      const tableWrapper = this.$refs.body\n      const previousLeft = tableWrapper.scrollLeft\n      const movementX =\n        event.movementX || this.getClientX(event) - this.initialClientX\n      const newLeft = previousLeft - movementX\n      this.initialClientX = this.getClientX(event)\n      tableWrapper.scrollLeft = newLeft\n    },\n\n    scrollTableTop(event) {\n      const tableWrapper = this.$refs.body\n      const previousTop = tableWrapper.scrollTop\n      const movementY =\n        event.movementY || this.getClientY(event) - this.initialClientY\n      const newTop = previousTop - movementY\n      this.initialClientY = this.getClientY(event)\n      tableWrapper.scrollTop = newTop\n    }\n  },\n\n  watch: {\n    nbSelectedTasks() {\n      this.updateTaskInQuery()\n    },\n\n    'displaySettings.bigThumbnails'() {\n      this.updateOffsets()\n    }\n  }\n}\n"],"names":["entityListMixin","preferences","descriptor","header","columnId","event","position","offset","metadataCol","validationCol","i","j","listWidth","listHeight","color","colors","validationColumns","hiddenColumns","key","isColumnHidden","scrollPosition","taskType","validationInfo","sticked","columnOffset","selection","startX","endX","startY","endY","grid","validationCell","isSelectedCell","y","x","ref","columnIndexInGrid","headerMenuEl","headerElement","headerBox","left","top","width","taskTypeId","type","entities","assetStore","editStore","episodeStore","sequenceStore","shotStore","entity","k","cached","index","val","group","fieldName","entry","value","metadataDescriptor","d","descriptorId","department","shot","res","taskId","task","list","stringHelpers","e","tableWrapper","previousLeft","movementX","newLeft","previousTop","movementY","newTop"],"mappings":"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"}