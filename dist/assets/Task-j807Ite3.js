import{_ as M,ai as G,r as l,o,c as m,l as p,s as W,cK as X,cL as q,aC as H,am as Q,cM as Y,N as J,aa as Z,cN as $,E as ee,cO as te,R as se,aF as ie,cP as re,x as ne,X as ae,aI as oe,m as de,cQ as le,cR as me,K as I,b as ce,cS as he,k as ue,e as a,f as c,w as P,d as h,a3 as ke,t as d,F as A,g as F,p as ve,n as pe}from"./index-a83mlrHR.js";import{E as we}from"./eye-off-DEUWbKoY.js";const fe={name:"subscribe-button",components:{EyeIcon:G,EyeOffIcon:we},props:{subscribed:{default:!1,type:Boolean}},emits:["click"],computed:{buttonTitle(){return this.subscribed?this.$t("tasks.unsubscribe_notifications"):this.$t("tasks.subscribe_notifications")}}},_e=["title"];function Ce(e,t,r,n,s,i){const u=l("eye-icon"),k=l("eye-off-icon");return o(),m("button",{class:"button",title:i.buttonTitle,onClick:t[0]||(t[0]=w=>e.$emit("click"))},[r.subscribed?(o(),p(u,{key:0,class:"icon is-small"})):(o(),p(k,{key:1,class:"icon is-small"}))],8,_e)}const Pe=M(fe,[["render",Ce]]),ye={name:"task",mixins:[W,X],components:{AddComment:q,AddPreviewModal:H,ComboboxStyled:Q,Comment:Y,CornerLeftUpIcon:J,DeleteModal:Z,EditCommentModal:$,EntityThumbnail:ee,ImageIcon:te,PageSubtitle:se,PeopleAvatar:ie,PreviewPlayer:re,Spinner:ne,SubscribeButton:Pe,TaskTypeName:ae,ValidationTag:oe},data(){return{previewForms:[],currentFrame:0,currentTask:null,selectedTab:"validation",taskLoading:{isLoading:!0,isError:!1},modals:{addPreview:!1,addExtraPreview:!1,deleteExtraPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},loading:{addComment:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},errors:{addComment:!1,addCommentMaxRetakes:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},addPreviewFormData:null,addExtraPreviewFormData:null,task:null,taskComments:[],taskPreviews:[],commentToEdit:null,selectedPreviewId:null}},created(){this.clearSelectedTasks()},mounted(){this.loadTaskData().then(()=>{this.reset()}),this.$nextTick(()=>{this.$refs["task-columns"]&&(this.$refs["task-columns"].scrollTop=100,window.scrollTo(0,0))})},computed:{...de(["currentEpisode","currentProduction","displayedShots","displayedAssets","getTaskComments","getTaskPreviews","getTaskComment","isCurrentUserAdmin","isCurrentUserArtist","isCurrentUserClient","isCurrentUserManager","isCurrentUserSupervisor","isSingleEpisode","isTVShow","personMap","productionMap","route","shotMap","taskEntityPreviews","taskStatus","taskStatusForCurrentUser","taskMap","taskTypeMap","user"]),currentEntity(){return this.task&&this.task.entity},previewOptions(){return[...this.taskPreviews].sort((e,t)=>t.revision-e.revision).map(e=>({label:`v${e.revision}`,value:e.id}))},isPreviewButtonVisible(){return this.isCurrentUserManager&&this.task&&this.task.entity&&this.task.entity.preview_file_id!==this.currentPreviewId&&["png","mp4"].includes(this.extension)},isMovie(){return this.extension==="mp4"},isPreviewPlayerReadOnly(){var e;if(this.task){if(this.isCurrentUserManager||this.isCurrentUserClient)return!1;if(this.isCurrentUserSupervisor)return this.user.departments.length===0?!1:!this.user.departments.includes((e=this.taskType)==null?void 0:e.department_id)}return!0},extension(){return this.currentPreview?this.currentPreview.extension:""},currentPreviewId(){return this.currentPreview?this.currentPreview.id:""},currentPreview(){if(this.isPreviews){let e=this.taskPreviews[0];const t=this.route.params.preview_id;return this.selectedPreviewId&&(e=this.taskPreviews.find(r=>r.id===t)),e}else return null},currentPreviewComment(){return this.taskComments.find(e=>{var t;return(t=e.previews)==null?void 0:t.some(r=>r.revision===this.currentRevision)})},currentRevision(){var e;return((e=this.currentPreview)==null?void 0:e.revision)||0},taskTypeBorder(){let e="transparent";return this.task&&(e=this.task.task_type_color),{"border-left":`4px solid ${e}`}},deleteTaskPath(){return this.taskPath(this.task,"task-delete")},isPreviews(){return this.taskPreviews&&this.taskPreviews.length>0},taskEntityPath(){if(this.task){const e=this.currentEpisode?this.currentEpisode.id:this.$route.params.episode_id;return le(this.task,e)}else return{name:"open-productions"}},taskEntitiesPath(){if(this.task){const e=this.currentEpisode?this.currentEpisode.id:this.$route.params.episode_id;return me(this.task,e)}else return{name:"open-productions"}},entityList(){return this.displayedShots.some(t=>t.id===this.task.entity_id)?this.displayedShots:this.displayedAssets},previousEntity(){if(this.task){const e=this.task.task_type_id,t=this.entityList.findIndex(i=>i.id===this.task.entity_id);let r=!1,n=t-1;n<0&&(n=this.entityList.length-1);let s=null;for(;!s;)if(this.entityList[n]?s=this.entityList[n].tasks.find(u=>{const k=this.taskMap.get(s);return k?k.task_type_id===e:!1}):s=this.task.id,!s&&(n--,n<0)){if(n=this.entityList.length,r)return null;r=!0}return this.taskPath({id:s})}else return{name:"open-productions"}},nextEntity(){if(this.task){const e=this.task.task_type_id;let t=!1,n=this.entityList.findIndex(i=>i.id===this.task.entity_id)+1;n>=this.entityList.length&&(n=0);let s=null;for(;!s;)if(this.entityList[n]?s=this.entityList[n].tasks.find(u=>{const k=this.taskMap.get(s);return k?k.task_type_id===e:!1}):s=this.task.id,!s&&(n++,n>=this.entityList.length)){if(n=0,t)return null;t=!0}return this.taskPath({id:s})}else return{name:"open-productions"}},title(){if(this.task){const e=this.task.entity_type_name;let t=this.task.full_entity_name||this.task.entity_name;return this.isTVShow&&e==="Shot"&&(t=t.split("/").splice(1).join("/")),this.isTVShow&&e==="Episode"&&(t=this.task.entity_name),`${t}`}else return"Loading..."},windowTitle(){if(this.task){const e=this.task.task_type_name;return`${this.title} / ${e}`}else return"Loading..."},deleteText(){if(this.task){const e=this.taskTypeMap.get(this.task.task_type_id);return this.$t("main.delete_text",{name:`${this.task.entity_name} / ${e.name}`})}else return""},assignees(){return I(this.task.assignees.map(e=>this.personMap.get(e)))},isAssigned(){var e;return((e=this.task)==null?void 0:e.assignees.some(t=>t===this.user.id))??!1},isCommentingAllowed(){return this.isAssigned||this.isCurrentUserClient||this.isDepartmentSupervisor||this.isCurrentUserManager},isDepartmentSupervisor(){var e;return this.isCurrentUserSupervisor?this.user.departments.length===0?!0:this.user.departments.includes((e=this.taskType)==null?void 0:e.department_id):!1},taskType(){var e;return this.taskTypeMap.get((e=this.task)==null?void 0:e.task_type_id)},currentTeam(){return I(this.currentProduction.team.map(e=>this.personMap.get(e)))}},methods:{...ce(["addAttachmentToComment","ackComment","addCommentPreview","addCommentExtraPreview","commentTask","commentTaskWithPreview","changeCommentPreview","clearSelectedTasks","deleteAttachment","deleteTask","deleteTaskPreview","deleteTaskComment","editTaskComment","loadComment","loadEpisodes","loadTask","loadShots","loadAssets","loadPreviewFileFormData","loadTaskComments","refreshComment","refreshPreview","pinComment","subscribeToTask","setCurrentEpisode","unsubscribeFromTask","updatePreviewAnnotation"]),loadTaskData(){const e=this.getCurrentTask();if(e){const t=this.route.params.task_id;return this.task=e,this.loadTaskComments({taskId:t,entityId:e.entity_id}).then(()=>{this.reset()}).catch(r=>{console.error(r),this.taskLoading.isError=!0}).finally(()=>{this.taskLoading.isLoading=!1})}else return this.taskLoading={isLoading:!0,isError:!1},this.loadTask({taskId:this.route.params.task_id}).then(t=>{let r=n=>{this.loadAssets().then(n)};return t.entity_type_name==="Shot"&&(r=n=>{this.loadEpisodes().then(()=>{this.isTVShow&&this.setCurrentEpisode(t.episode.id),this.loadShots(n)}).catch(n)}),r(()=>(this.task=t,this.loadTaskComments({taskId:t.id,entityId:t.entity_id}).then(()=>{this.reset(),this.taskLoading={isLoading:!1,isError:!1}}).catch(n=>{console.error(n),this.taskLoading={isLoading:!1,isError:!0}})))}).catch(t=>{console.error(t),this.taskLoading={isLoading:!1,isError:!0}})},getCurrentTask(){return this.taskMap.get(this.route.params.task_id)},getCurrentTaskComments(){return this.getTaskComments(this.route.params.task_id)},getCurrentTaskPreviews(){return this.getTaskPreviews(this.route.params.task_id)},addComment(e,t,r,n,s=void 0,i=void 0){const u={taskId:this.task.id,taskStatusId:n,attachment:t,checklist:r,comment:e,links:i?[i]:null,revision:s},k=this.previewForms.length>0?"commentTaskWithPreview":"commentTask";this.loading.addComment=!0,this.errors.addComment=!1,this.errors.addCommentMaxRetakes=!1,this.$store.dispatch(k,u).then(()=>{he.clearTaskDraft(this.task.id),this.reset(),this.loading.addComment=!1}).catch(w=>{var _,C;console.error(w),this.errors.addComment=!0,this.loading.addComment=!1;const f=((C=(_=w.body)==null?void 0:_.message)==null?void 0:C.includes("retake"))??!1;this.errors.addComment=!f,this.errors.addCommentMaxRetakes=f})},reset({keepPreviewFiles:e=!1}={}){this.resetModals(),this.resetPreview(!1),e||this.clearPreviewFiles(!1),this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews(),this.task=this.getCurrentTask(),this.resetDraft(),setTimeout(()=>{this.$route.params.preview_id&&(this.selectedPreviewId=this.$route.params.preview_id)},200)},selectFile(e){this.previewForms=this.previewForms.concat(e),this.loadPreviewFileFormData(this.previewForms)},clearPreviewFiles(){this.previewForms=[],this.loadPreviewFileFormData(this.previewForms),this.$store.commit("CLEAR_UPLOAD_PROGRESS")},isHighlighted(e){return e.preview&&e.preview.id===this.currentPreviewId},createExtraPreview(e){this.selectFile(e);const t=this.taskPreviews,r=t.length>0?t[0]:null;this.errors.addExtraPreview=!1,this.loading.addExtraPreview=!0;const n=this.getCurrentTaskComments().find(s=>s.previews.findIndex(i=>i.id===r.id)>=0);this.addCommentExtraPreview({taskId:this.task.id,previewId:this.currentPreview.id,commentId:n.id}).then(()=>{this.loading.addExtraPreview=!1,this.modals.addExtraPreview=!1,this.$refs["add-extra-preview-modal"].reset(),this.clearPreviewFiles(),setTimeout(()=>{this.$refs["preview-player"].displayLast()},0)}).catch(s=>{console.error(s),this.errors.addExtraPreview=!0,this.loading.addExtraPreview=!1})},resetPreview(e=!0){const t=this.taskPreviews||[],r=t.length>0?t[0]:null;this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews(),r&&e&&this.$router.push(this.previewPath(r.id))},setPreview(){this.loading.setPreview=!0,this.errors.setPreview=!1;const t=this.$refs["preview-player"].currentPreview.id;this.$store.dispatch("setPreview",{taskId:this.task.id,entityId:this.task.entity.id,previewId:t}).then(()=>{this.loading.setPreview=!1}).catch(r=>{console.error(r),this.errors.setPreview=!0})},async saveComment(e){try{await this.editTaskComment({taskId:this.task.id,comment:e})}catch(t){console.error(t),await this.loadTaskData()}},confirmDeleteTaskComment(){this.loading.deleteComment=!0,this.errors.deleteComment=!1;const e=this.commentToEdit.id;this.deleteTaskComment({taskId:this.task.id,commentId:e}).then(()=>{this.loading.deleteComment=!1,this.reset(),this.isPreviews&&this.resetPreview(),this.modals.deleteComment=!1}).catch(t=>{console.error(t),this.loading.deleteComment=!1,this.errors.deleteComment=!0})},confirmDeleteTaskPreview(){this.loading.deleteExtraPreview=!0,this.errors.deleteExtraPreview=!1;const e=this.currentPreviewId,t=this.getCurrentTaskComments().find(r=>r.previews.findIndex(n=>n.id===e)>=0);this.$refs["preview-player"].displayFirst(),this.deleteTaskPreview({taskId:this.task.id,commentId:t.id,previewId:this.currentExtraPreviewId}).then(()=>{this.loading.deleteExtraPreview=!1,this.resetPreview(),this.hideRemoveExtraPreviewModal()}).catch(r=>{console.error(r),this.loading.deleteExtraPreview=!1,this.errors.deleteExtraPreview=!0})},onPreviewAdded(e){const t=e.task_id,r=e.comment_id,n=e.preview_file_id,s=e.revision,i=e.extension,u=this.$store.getters.getTaskComment(t,r);this.task&&u&&u.previews&&(u.previews.length===0||u.previews[0].id!==n)&&t===this.task.id&&(this.$store.commit("ADD_PREVIEW_END",{preview:{id:n,revision:s,extension:i},taskId:t,commentId:r,comment:u}),this.reset({keepPreviewFiles:!0}))},toggleSubscribe(){this.task&&!this.isAssigned&&(this.task.is_subscribed?this.unsubscribeFromTask(this.task.id):this.subscribeToTask(this.task.id))},taskPath(e,t="task"){e?(e.project_id=this.task.project_id,e.episode_id=this.task.episode_id):e=this.task;let r={name:"open-productions"};return e&&(r={name:t,params:{production_id:e.project_id,task_id:e.id}},this.isTVShow&&this.currentEpisode&&(r.name=`episode-${t}`,r.params.episode_id=e.episode_id||this.currentEpisode.id)),r},previewPath(e){const t=this.taskPath(this.task,"task-preview");if(this.isTVShow){const r=this.taskTypeMap.get(this.task.task_type_id);t.name="episode-task-preview",r.for_entity==="Episode"&&(t.name="episode-episode-task-preview")}return t.params&&(t.params.preview_id=e),t},onAnnotationChanged({preview:e,additions:t,deletions:r,updates:n}){const s=this.task.id;this.updatePreviewAnnotation({taskId:s,preview:e,additions:t,deletions:r,updates:n})},onAddExtraPreviewClicked(){this.clearPreviewFiles(),this.modals.addExtraPreview=!0},onRemoveExtraPreviewClicked(e){this.showRemoveExtraPreviewModal(e)},hideExtraPreviewModal(){this.modals.addExtraPreview=!1},showRemoveExtraPreviewModal(e){this.currentExtraPreviewId=e.id,this.modals.deleteExtraPreview=!0},hideRemoveExtraPreviewModal(){this.modals.deleteExtraPreview=!1},onAddPreviewClicked(){this.modals.addPreview=!0},closeAddPreviewModal(){this.modals.addPreview=!1},confirmAddPreviewModal(e){this.selectFile(e),this.closeAddPreviewModal()},onAckComment(e){this.ackComment(e)},onDuplicateComment(e){this.$refs["add-comment"].setValue(e)},onPinComment(e){this.pinComment(e)},onEditComment(e){this.commentToEdit=e,this.modals.editComment=!0},onDeleteComment(e){this.commentToEdit=e,this.modals.deleteComment=!0},onCancelEditComment(e){this.modals.editComment=!1},onCancelDeleteComment(e){this.modals.deleteComment=!1},onFrameUpdated(e){this.currentFrame=e},onPreviewFormRemoved(e){this.previewForms=this.previewForms.filter(t=>t!==e),this.loadPreviewFileFormData(this.previewForms)},changeCurrentPreview(e){this.$router.push(this.previewPath(e.id))},onRemoteAcknowledge(e,t){if(this.task){const r=this.taskComments.find(s=>s.id===e.comment_id),n=this.personMap.get(e.person_id);r&&n&&(this.user.id===n.id?(t==="ack"&&!r.acknowledgements.includes(n.id)||t==="unack"&&r.acknowledgements.includes(n.id))&&this.$store.commit("ACK_COMMENT",{comment:r,user:n}):this.$store.commit("ACK_COMMENT",{comment:r,user:n}))}},isStatusChange(e){const t=this.taskComments,r=t[e];return e===t.length-1||r.task_status_id!==t[e+1].task_status_id},timeCodeClicked({versionRevision:e,minutes:t,seconds:r,milliseconds:n,frame:s}){this.changeCurrentPreview(this.taskPreviews.find(i=>i.revision===parseInt(e))),setTimeout(()=>{this.$refs["preview-player"].setCurrentFrame(s),this.$refs["preview-player"].focus()},100)},onPreviewsOrderChanged(){this.taskPreviews=this.getCurrentTaskPreviews()},async extractAnnotationSnapshots(){this.$refs["add-comment"].showAnnotationLoading();const e=await this.$refs["preview-player"].extractAnnotationSnapshots();return this.$refs["add-comment"].setAnnotationSnapshots(e),this.$refs["add-comment"].hideAnnotationLoading(),e}},watch:{$route(){this.task&&this.$route.params.task_id!==this.task.id&&this.loadTaskData(),this.$route.params.preview_id!==this.selectedPreviewId&&(this.selectedPreviewId=this.$route.params.preview_id)},currentProduction(){this.loadTaskData()},selectedPreviewId(){this.task&&this.$router.push(this.previewPath(this.selectedPreviewId))}},socket:{events:{"preview-file:add-file"(e){this.onPreviewAdded(e)},"preview-file:update"(e){const t=this.taskComments.find(r=>r.previews&&r.previews.length>0&&r.previews[0].id===e.preview_file_id);t&&this.task&&this.refreshPreview({taskId:this.task.id,previewId:e.preview_file_id}).then(r=>{t.previews[0].validation_status=r.validation_status})},"comment:acknowledge"(e){this.onRemoteAcknowledge(e,"ack")},"comment:unacknowledge"(e){this.onRemoteAcknowledge(e,"unack")},"comment:new"(e){setTimeout(()=>{this.getCurrentTaskComments().length!==this.taskComments.length&&(this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews())},1e3)},"comment:update"(e){const t=e.comment_id;this.taskComments.some(({id:r})=>r===t)&&this.loadComment({commentId:t}).catch(console.error)},"comment:reply"(e){if(this.task){const t=this.taskComments.find(r=>r.id===e.comment_id);t&&(t.replies||(t.replies=[]),t.replies.some(n=>n.id===e.reply_id)||this.refreshComment({commentId:e.comment_id}).then(n=>{t.replies=n.replies}).catch(console.error))}},"comment:delete"(e){const t=this.getTask();if(t){const n=this.getComments().find(s=>s.id===e.comment_id);n&&(this.$store.commit("REMOVE_TASK_COMMENT",{task:t,comment:n}),this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews())}},"comment:delete-reply"(e){if(this.task){const t=this.taskComments.find(r=>r.id===e.comment_id);t&&(t.replies||(t.replies=[]),this.$store.commit("REMOVE_REPLY_FROM_COMMENT",{comment:t,reply:{id:e.reply_id}}))}},"preview-file:annotation-update"(e){const t=this.$refs["preview-player"];if(!t)return;t.isValidPreviewModification(e.preview_file_id,e.updated_at)&&this.refreshPreview({previewId:t.currentPreview.id,taskId:t.currentPreview.task_id}).then(()=>{t.notSaved||(this.taskPreviews=this.getCurrentTaskPreviews(),this.$nextTick(()=>{t.reloadAnnotations(),t.loadAnnotation()}))})}}},head(){let e="Loading task... - Kitsu";if(this.task){const t=this.taskTypeMap.get(this.task.task_type_id).name;e=`${this.title} / ${t} - Kitsu`}return{title:e}}},ge={class:"fixed-page columns xyz-in",xyz:"fade"},Te={class:"page column main-column"},Ee={class:"page-header pa1 mb0",xyz:"fade"},be={key:0,class:"flexrow header-title"},xe={class:"flexrow-item ml2"},Ie={class:"title flexrow-item"},Ae={class:"flexrow-item flexrow block"},Fe={class:"flexrow-item"},Me={key:1,class:"flexrow-item"},Se={class:"task-columns",ref:"task-columns"},Re={class:"task-column preview-column"},Le={class:"preview-column-content block"},De={class:"flexrow preview-header"},Ue={key:0,class:"flexrow-item"},Ve={key:1},Oe={class:"set-main-preview flexrow-item flexrow pull-right"},Ne={class:"text"},ze={key:1,class:"error flexrow-item"},Be={class:"preview-area mt1"},Ke={key:0},je={class:"flexrow-item block mt1 mr0 info-block"},Ge={class:"table-body mt1"},We={key:0,class:"datatable no-header"},Xe={class:"table-body"},qe={class:"datatable-row"},He={class:"field-label"},Qe={class:"datatable-row"},Ye={class:"field-label"},Je={class:"datatable-row"},Ze={class:"field-label"},$e={class:"datatable-row"},et={class:"field-label"},tt={class:"datatable-row"},st={class:"field-label"},it={class:"datatable-row"},rt={class:"field-label"},nt={class:"datatable-row"},at={class:"field-label"},ot={class:"task-column comments-column"},dt={key:0},lt={key:1,class:"comments"},mt={key:2,class:"no-comment"},ct={key:1,class:"has-text-centered"};function ht(e,t,r,n,s,i){var T,E;const u=l("corner-left-up-icon"),k=l("router-link"),w=l("task-type-name"),f=l("entity-thumbnail"),_=l("validation-tag"),C=l("people-avatar"),S=l("subscribe-button"),R=l("combobox-styled"),L=l("image-icon"),D=l("preview-player"),U=l("page-subtitle"),V=l("add-comment"),O=l("comment"),N=l("XyzTransitionGroup"),z=l("spinner"),y=l("add-preview-modal"),B=l("edit-comment-modal"),g=l("delete-modal"),K=ue("xyz");return o(),m("div",ge,[a("div",Te,[a("div",Ee,[s.task?(o(),m("div",be,[c(k,{class:"flexrow-item has-text-centered back-link",to:i.taskEntitiesPath},{default:P(()=>[c(u)]),_:1},8,["to"]),i.taskType?(o(),p(w,{key:0,class:"flexrow-item task-type block","task-type":i.taskType,"production-id":e.currentProduction.id},null,8,["task-type","production-id"])):h("",!0),a("span",xe,[c(f,{class:"entity-thumbnail",entity:i.currentEntity,"empty-width":100,"empty-height":60,width:100,"with-link":!0},null,8,["entity"])]),a("h1",Ie,[c(k,{to:i.taskEntityPath},{default:P(()=>[ke(d(s.task?i.title:"Loading..."),1)]),_:1},8,["to"])]),a("div",Ae,[a("span",Fe,d(e.$t("tasks.current_status")),1),s.task?(o(),p(_,{key:0,class:"is-medium flexrow-item",task:s.task,"is-static":!0},null,8,["task"])):h("",!0),i.assignees.length>0&&!e.isCurrentUserClient?(o(),m("span",Me,d(e.$t("tasks.fields.assignees"))+": ",1)):h("",!0),e.isCurrentUserClient?h("",!0):(o(!0),m(A,{key:2},F(i.assignees,v=>(o(),m("span",{class:"flexrow-item avatar-wrapper",key:v.id},[c(C,{class:"flexrow-item",person:v,size:30,"font-size":16},null,8,["person"])]))),128)),i.isAssigned?h("",!0):(o(),p(S,{key:3,class:"flexrow-item action-button",subscribed:i.isAssigned||s.task.is_subscribed,onClick:i.toggleSubscribe},null,8,["subscribed","onClick"]))])])):h("",!0)]),a("div",Se,[a("div",Re,[a("div",Le,[a("div",De,[i.isPreviews?(o(),m("div",Ue,[c(R,{class:"preview-combo flexrow-item",options:i.previewOptions,"is-preview":"",modelValue:s.selectedPreviewId,"onUpdate:modelValue":t[0]||(t[0]=v=>s.selectedPreviewId=v)},null,8,["options","modelValue"])])):(o(),m("div",Ve,[a("em",null,d(e.$t("tasks.no_preview")),1)])),a("div",Oe,[e.isCurrentUserManager?(o(),m("button",{key:0,class:ve({button:!0,"flexrow-item":!0,"is-loading":s.loading.setPreview}),onClick:t[1]||(t[1]=(...v)=>i.setPreview&&i.setPreview(...v))},[c(L,{class:"icon"}),a("span",Ne,d(e.$t("tasks.set_preview")),1)],2)):h("",!0),s.errors.setPreview?(o(),m("span",ze,d(e.$t("tasks.set_preview_error")),1)):h("",!0)])]),a("div",Be,[i.isPreviews?(o(),m("div",Ke,[i.currentPreview?(o(),p(D,{key:0,ref:"preview-player","entity-preview-files":e.taskEntityPreviews,"extra-wide":!0,"last-preview-files":s.taskPreviews||[],link:(E=(T=i.currentPreviewComment)==null?void 0:T.links)==null?void 0:E[0],previews:i.currentPreview.previews,"read-only":i.isPreviewPlayerReadOnly,task:s.task,"task-type-map":e.taskTypeMap,onAddExtraPreview:i.onAddExtraPreviewClicked,onAnnotationChanged:i.onAnnotationChanged,onChangeCurrentPreview:i.changeCurrentPreview,onRemoveExtraPreview:i.onRemoveExtraPreviewClicked,onPreviewsOrderChanged:i.onPreviewsOrderChanged,onFrameUpdated:i.onFrameUpdated},null,8,["entity-preview-files","last-preview-files","link","previews","read-only","task","task-type-map","onAddExtraPreview","onAnnotationChanged","onChangeCurrentPreview","onRemoveExtraPreview","onPreviewsOrderChanged","onFrameUpdated"])):h("",!0)])):h("",!0)])]),a("div",je,[c(U,{text:e.$t("main.info")},null,8,["text"]),a("div",Ge,[s.task?(o(),m("table",We,[a("tbody",Xe,[a("tr",qe,[a("td",He,d(e.$t("tasks.fields.estimation")),1),a("td",null,d(e.formatDuration(s.task.estimation)),1)]),a("tr",Qe,[a("td",Ye,d(e.$t("tasks.fields.duration")),1),a("td",null,d(e.formatDuration(s.task.duration)),1)]),a("tr",Je,[a("td",Ze,d(e.$t("tasks.fields.retake_count")),1),a("td",null,d(s.task.retake_count),1)]),a("tr",$e,[a("td",et,d(e.$t("tasks.fields.start_date")),1),a("td",null,d(e.formatSimpleDate(s.task.start_date)),1)]),a("tr",tt,[a("td",st,d(e.$t("tasks.fields.due_date")),1),a("td",null,d(e.formatSimpleDate(s.task.due_date)),1)]),a("tr",it,[a("td",rt,d(e.$t("tasks.fields.end_date")),1),a("td",null,d(e.formatSimpleDate(s.task.end_date)),1)]),a("tr",nt,[a("td",at,d(e.$t("tasks.fields.done_date")),1),a("td",null,d(e.formatSimpleDate(s.task.done_date)),1)])])])):h("",!0)])]),t[2]||(t[2]=a("div",{class:"pa2"},null,-1))]),a("div",ot,[s.task?(o(),m("div",dt,[a("div",null,[i.isCommentingAllowed?(o(),p(V,{key:0,ref:"add-comment",frame:s.currentFrame,"is-error":s.errors.addComment,"is-max-retakes-error":s.errors.addCommentMaxRetakes,"is-loading":s.loading.addComment,"is-movie":i.isMovie,team:i.currentTeam,task:s.task,"task-status":e.taskStatusForCurrentUser,"preview-forms":s.previewForms,fps:e.currentFps,revision:i.currentRevision,onAddComment:i.addComment,onAddPreview:i.onAddPreviewClicked,onFileDrop:i.selectFile,onClearFiles:i.clearPreviewFiles,onAnnotationSnapshotsRequested:i.extractAnnotationSnapshots,onRemovePreview:i.onPreviewFormRemoved},null,8,["frame","is-error","is-max-retakes-error","is-loading","is-movie","team","task","task-status","preview-forms","fps","revision","onAddComment","onAddPreview","onFileDrop","onClearFiles","onAnnotationSnapshotsRequested","onRemovePreview"])):h("",!0),s.taskComments&&s.taskComments.length>0?(o(),m("div",lt,[pe((o(),p(N,{appear:""},{default:P(()=>[(o(!0),m(A,null,F(s.taskComments,(v,j)=>{var b,x;return o(),p(O,{key:v.id,comment:v,fps:e.currentFps,frame:s.currentFrame,"is-change":i.isStatusChange(j),"is-checkable":e.user.id===((b=v.person)==null?void 0:b.id)||e.isCurrentUserArtist&&i.isAssigned||i.isDepartmentSupervisor||e.isCurrentUserManager,"is-editable":e.user.id===((x=v.person)==null?void 0:x.id)||e.isCurrentUserAdmin,"is-pinnable":i.isDepartmentSupervisor||e.isCurrentUserManager,revision:i.currentRevision,task:s.task,team:i.currentTeam,onAckComment:i.onAckComment,onDuplicateComment:i.onDuplicateComment,onPinComment:i.onPinComment,onEditComment:i.onEditComment,onDeleteComment:i.onDeleteComment,onChecklistUpdated:i.saveComment,onTimeCodeClicked:i.timeCodeClicked},null,8,["comment","fps","frame","is-change","is-checkable","is-editable","is-pinnable","revision","task","team","onAckComment","onDuplicateComment","onPinComment","onEditComment","onDeleteComment","onChecklistUpdated","onTimeCodeClicked"])}),128))]),_:1})),[[K,{fade:!1,up:!1,"flip-up":!1}]])])):(o(),m("div",mt,[a("em",null,d(e.$t("tasks.no_comment")),1)]))])])):h("",!0),s.taskLoading.isLoading?(o(),m("div",ct,[c(z)])):h("",!0)])],512),c(y,{ref:"add-preview-modal",active:s.modals.addPreview,"is-loading":s.loading.addPreview,"is-error":s.errors.addPreview,"form-data":s.addPreviewFormData,fps:e.currentFps,"expected-frames":e.entityFrames,title:s.task?`${s.task.entity_name} / ${e.taskTypeMap.get(s.task.task_type_id).name}`:"",onCancel:i.closeAddPreviewModal,onConfirm:i.confirmAddPreviewModal},null,8,["active","is-loading","is-error","form-data","fps","expected-frames","title","onCancel","onConfirm"]),c(y,{ref:"add-extra-preview-modal",active:s.modals.addExtraPreview,"is-loading":s.loading.addExtraPreview,"is-error":s.errors.addExtraPreview,"form-data":s.addExtraPreviewFormData,message:"",title:s.task?`${s.task.entity_name} / ${e.taskTypeMap.get(s.task.task_type_id).name}`:"",onCancel:i.hideExtraPreviewModal,onConfirm:i.createExtraPreview},null,8,["active","is-loading","is-error","form-data","title","onCancel","onConfirm"]),c(B,{active:s.modals.editComment,frame:s.currentFrame,"is-loading":s.loading.editComment,"is-error":s.errors.editComment,"comment-to-edit":s.commentToEdit,team:i.currentTeam,fps:e.currentFps,revision:i.currentRevision,onConfirm:e.confirmEditTaskComment,onCancel:i.onCancelEditComment},null,8,["active","frame","is-loading","is-error","comment-to-edit","team","fps","revision","onConfirm","onCancel"]),c(g,{active:s.modals.deleteComment,"is-loading":s.loading.deleteComment,"is-error":s.errors.deleteComment,text:e.$t("tasks.delete_comment"),"error-text":e.$t("tasks.delete_comment_error"),onConfirm:i.confirmDeleteTaskComment,onCancel:i.onCancelDeleteComment},null,8,["active","is-loading","is-error","text","error-text","onConfirm","onCancel"]),c(g,{active:s.modals.deleteExtraPreview,"is-loading":s.loading.deleteExtraPreview,"is-error":s.errors.deleteExtraPreview,text:e.$t("tasks.delete_preview"),"error-text":e.$t("tasks.delete_preview_error"),onCancel:i.hideRemoveExtraPreviewModal,onConfirm:i.confirmDeleteTaskPreview},null,8,["active","is-loading","is-error","text","error-text","onCancel","onConfirm"])])])}const vt=M(ye,[["render",ht],["__scopeId","data-v-a317c866"]]);export{vt as default};
//# sourceMappingURL=Task-j807Ite3.js.map
