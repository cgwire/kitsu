import{b0 as _,B as l,U as p,ai as v,b1 as u,S as f,m as o,ad as n,c,b2 as d,g as m,n as r,f as h,a as b,T as g,b as k,b3 as w}from"./index-CV6x4PgP.js";const y={name:"events",mixins:[_],components:{ButtonSimple:l,DateField:p,PeopleAvatar:v,PeopleName:u,Spinner:f},data(){return{currentDate:new Date,events:[],isLoading:!0,selectedEvents:{}}},mounted(){this.loadDayEvents()},computed:{...o(["personMap","productionMap","user"]),today(){return n().toDate()}},methods:{...c(["loadEvents"]),formatType(a){return a.name.split(":")[1].substring(0,3)},loadDayEvents(){const a=n(this.currentDate).add(1,"days"),t=n(this.currentDate);this.selectedEvents={},this.isLoading=!0,this.loadEvents({after:d(t,this.timezone),before:d(a,this.timezone)}).then(e=>{this.isLoading=!1,this.events=e}).catch(e=>{this.isLoading=!1,console.error(e)})},selectLine(a){m.set(this.selectedEvents,a.id,!this.selectedEvents[a.id])},isLink(a){return["project_id","task_id"].includes(a)},getLink(a,t){const e=a.data.project_id,s=t.substring(0,t.length-3);if(s==="project")return`/productions/${e}/news-feed`;{const i=a.data[t];return`/productions/${e}/${s}s/${i}`}}},watch:{currentDate(){this.loadDayEvents()}},metaInfo(){return{title:`${this.$t("logs.title")} - Kitsu`}}};var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mt1"},[e("div",{staticClass:"flexrow"},[e("date-field",{staticClass:"flexrow-item",attrs:{"can-delete":!1,"disabled-dates":{from:t.today},label:t.$t("logs.current_date_label")},model:{value:t.currentDate,callback:function(s){t.currentDate=s},expression:"currentDate"}}),e("button-simple",{staticClass:"flexrow-item small",attrs:{icon:"refresh"},on:{click:t.loadDayEvents}}),e("span",{staticClass:"flexrow-item nb-events"},[t._v(" "+t._s(t.events.length)+" "+t._s(t.$t("logs.events"))+" ")])],1),!t.isLoading&&t.events.length===0?e("div",{staticClass:"mt2"},[t._v(" "+t._s(t.$t("logs.empty_list"))+" ")]):t._e(),t.isLoading?e("div",{staticClass:"has-text-centered"},[e("spinner")],1):e("div",{staticClass:"log-list"},t._l(t.events,function(s){return e("div",{key:s.id,staticClass:"mt05 event-line",on:{click:function(i){return t.selectLine(s)}}},[e("div",[e("span",{staticClass:"date tag mr1"},[t._v(t._s(t.formatDate(s.created_at))+" ")]),e("span",{staticClass:"type tag",attrs:{title:s.name.split(":")[1],"data-status":t.formatType(s)}},[t._v(" "+t._s(t.formatType(s))+" ")]),e("span",{staticClass:"name tag mr1"},[t._v(t._s(s.name.split(":")[0]))])]),e("ul",{directives:[{name:"show",rawName:"v-show",value:t.selectedEvents[s.id],expression:"selectedEvents[event.id]"}]},[e("li",{staticClass:"flexrow"},[e("span",{staticClass:"key"},[t._v("user")]),s.user_id?e("people-avatar",{staticClass:"flexrow-item",attrs:{size:20,person:t.personMap.get(s.user_id)}}):t._e(),s.user_id?e("people-name",{staticClass:"flexrow-item",attrs:{person:t.personMap.get(s.user_id)}}):t._e()],1),t._l(Object.keys(s.data).sort(),function(i){return e("li",{key:s.id+"-"+i,staticClass:"variable"},[e("span",{staticClass:"key"},[t._v(t._s(i))]),t.isLink(i)?e("a",{attrs:{href:t.getLink(s,i)}},[t._v(" "+t._s(s.data[i])+" ")]):e("span",[t._v(t._s(s.data[i]))])])})],2)])}),0)])},$=[],T=r(y,C,$,!1,null,"50109de6");const x=T.exports,L={name:"preview-file-list",mixins:[h],components:{ButtonSimple:l,ProductionNameCell:b,TableInfo:g,TaskTypeCell:k},props:{previewFiles:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1}},data(){return{currentTask:null}},computed:{...o(["personMap","productionMap","taskTypeMap"])},methods:{...c(["loadTask","markBroken"]),onBodyScroll(a,t){this.$refs.headerWrapper.style.left=`-${t.scrollLeft}px`},async redirectToTask(a,t){if(a.target.parentNode.className==="mark-broken-button button"||a.target.className==="mark-broken-button button")return;const e=await this.loadTask({taskId:t.task_id});return this.$router.push(w(e,e.project,e.project.production_type==="tvshow",e.episode,this.taskTypeMap))}}};var F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"data-list"},[e("div",{staticStyle:{overflow:"hidden"}},[e("table",{ref:"headerWrapper",staticClass:"datatable"},[e("thead",{staticClass:"datatable-head"},[e("tr",{staticClass:"datatable-row-header"},[e("th",{staticClass:"date"},[t._v(" "+t._s(t.$t("logs.preview_files.date"))+" ")]),e("th",{staticClass:"production"},[t._v(" "+t._s(t.$t("logs.preview_files.production"))+" ")]),e("th",{staticClass:"entity-name"},[t._v(" "+t._s(t.$t("logs.preview_files.entity_name"))+" ")]),e("th",{staticClass:"task-type"},[t._v(" "+t._s(t.$t("logs.preview_files.task_type_id"))+" ")]),e("th",{staticClass:"revision"},[t._v(" "+t._s(t.$t("logs.preview_files.revision"))+" ")]),e("th",{staticClass:"status"},[t._v(" "+t._s(t.$t("logs.preview_files.status"))+" ")]),e("th",{staticClass:"end-cell"})])])])]),e("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),t.previewFiles.length>0?e("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}]},[e("table",{staticClass:"datatable"},[e("tbody",{staticClass:"datatable-body"},t._l(t.previewFiles,function(s){return e("tr",{key:s.id,staticClass:"datatable-row",on:{click:i=>t.redirectToTask(i,s)}},[e("td",{staticClass:"date"},[t._v(" "+t._s(t.formatDate(s.created_at))+" ")]),e("td",{staticClass:"production"},[e("production-name-cell",{attrs:{entry:t.productionMap.get(s.project_id)}})],1),e("td",{staticClass:"entity-name"},[t._v(" "+t._s(s.full_entity_name)+" ")]),e("task-type-cell",{staticClass:"task-type",attrs:{"task-type":t.taskTypeMap.get(s.task_type_id)}}),e("td",{staticClass:"revision"},[t._v(" "+t._s(s.revision)+" ")]),e("td",{staticClass:"status",attrs:{"data-status":s.status}},[t._v(" "+t._s(s.status)+" ")]),e("td",{staticClass:"end-cell has-text-right"},[s.status==="processing"?e("button-simple",{staticClass:"mark-broken-button",attrs:{text:t.$t("logs.preview_files.mark_broken")},on:{click:function(i){return t.$emit("mark-broken-clicked",s.id)}}}):t._e()],1)],1)}),0)])]):t._e()],1)},D=[],E=r(L,F,D,!1,null,"c23f7aae");const M=E.exports,B={name:"preview-files",mixins:[_],components:{ButtonSimple:l,PreviewFileList:M},data(){return{previewFilesLoading:!0,previewFiles:[]}},computed:{...o(["personMap","taskTypeMap","user"]),displayedPreviewFiles(){return this.previewFiles.filter(a=>a.status!=="ready")}},methods:{...c(["getRunningPreviewFiles","markPreviewFileAsBroken"]),async reload(){this.previewFiles=[],this.previewFilesLoading=!0,this.previewFiles=await this.getRunningPreviewFiles(),this.previewFilesLoading=!1},async markBrokenClicked(a){const t=this.previewFiles.find(e=>e.id===a);t.status="broken",await this.markPreviewFileAsBroken(a)}},mounted(){this.reload()}};var P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mt1"},[e("p",{staticClass:"flexrow"},[e("em",{staticClass:"flexrow-item"},[t._v(t._s(t.$t("logs.preview_files.explanation")))]),e("span",{staticClass:"filler"}),e("button-simple",{staticClass:"flexrow-item",attrs:{icon:"refresh"},on:{click:t.reload}})],1),t.previewFiles.length===0&&!t.previewFilesLoading?[e("p",{staticClass:"empty"},[t._v(t._s(t.$t("logs.preview_files.empty_list")))])]:[e("preview-file-list",{attrs:{"preview-files":t.previewFiles,"is-loading":t.previewFilesLoading},on:{"mark-broken-clicked":t.markBrokenClicked}})]],2)},A=[],j=r(B,P,A,!1,null,"41e06691");const N=j.exports,R={name:"logs",components:{Events:x,PreviewFiles:N},data(){return{activeTab:"events"}},mounted(){this.$route.query.tab&&(this.activeTab=this.$route.query.tab)},methods:{isActiveTab(a){return this.activeTab===a}},watch:{activeTab(){this.$route.query.tab!==this.activeTab&&this.$router.push({query:{tab:this.activeTab}})}}};var S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"logs fixed-page"},[e("div",{staticClass:"tabs logs-tabs"},[e("ul",[e("li",{class:{"is-active":t.isActiveTab("events")}},[e("a",{on:{click:function(s){t.activeTab="events"}}},[t._v(" "+t._s(t.$t("logs.title"))+" ")])]),e("li",{class:{"is-active":t.isActiveTab("preview_files")}},[e("a",{on:{click:function(s){t.activeTab="preview_files"}}},[t._v(" "+t._s(t.$t("logs.preview_files.title"))+" ")])])])]),t.isActiveTab("events")?e("events"):t._e(),t.isActiveTab("preview_files")?e("preview-files"):t._e()],1)},z=[],q=r(R,S,z,!1,null,"1c1caddd");const K=q.exports;export{K as default};
//# sourceMappingURL=Logs-BNsfP9sw.js.map
