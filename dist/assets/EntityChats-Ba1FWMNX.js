import{_ as y,c as h,o as n,e as i,b9 as d,m as v,a as j,u as b,E as w,z as x,r as o,k as _,w as m,f as u,F as k,g as E,n as F,t as r}from"./index-BAEgV7eE.js";import{E as L}from"./EntityChat-CA8J4WKz.js";const B={name:"page-left-side-layout"},q={ref:"page",class:"columns fixed-page"},M={class:"column left-side-column"},N={class:"column main-column"};function S(t,e,l,f,c,a){return n(),h("div",q,[i("div",M,[d(t.$slots,"side")]),i("div",N,[d(t.$slots,"main")])],512)}const P=y(B,[["render",S]]),Q={name:"entity-chats",mixins:[x],components:{EntityChat:L,EntityThumbnail:w,PageLeftSideLayout:P,Spinner:b},data(){return{chats:[],entity:null,loading:{list:!1}}},async mounted(){this.loading.list=!0,this.chats=await this.getEntityChats(),this.$route.query.entity_id?this.selectFromQuery():this.selectFirstChat(),this.loading.list=!1},computed:{...j(["productionMap","user"]),chatList(){return[...this.chats].sort((t,e)=>t.last_message?e.last_message?t.last_message===e.last_message?t.entity_name.localeCompare(e.entity_name):t.last_message<e.last_message:-1:1)}},methods:{...v(["getEntityChats"]),selectFirstChat(){if(this.chats.length>0){const t=this.chats[this.chats.length-1];this.entity={id:t.object_id}}},selectFromQuery(){const t=this.chats.find(e=>e.object_id===this.$route.query.entity_id);t?this.entity={id:t.object_id}:this.selectFirstChat()},selectChat(t){this.entity={id:t.object_id},this.$nextTick(()=>{this.$refs.entityChat.focusMessageBox()}),this.$router.push({query:{entity_id:t.object_id}})},chatClass(t){return{"chat-item":!0,selected:this.entity&&this.entity.id===t.object_id}},getChatProjectName(t){return this.productionMap.get(t.project_id).name},getChatDate(t){return t.last_message?this.formatDate(t.last_message):this.$t("chats.no_message_yet")}},watch:{"$route.query.entity_id"(){this.selectFromQuery()}},socket:{events:{async"chat:joined"(t){!this.chats.some(e=>e.id===t.chat_id)&&this.user.id===t.person_id&&(this.chats=await this.getEntityChats())},"chat:left"(t){this.chats.some(e=>e.id===t.chat_id)&&this.user.id===t.person_id&&(this.chats=this.chats.filter(e=>e.id!==t.chat_id))},"chat:new-message"(t){const e=this.chats.find(l=>l.id===t.chat_id);e&&(e.last_message=t.last_message)}}},head(){return{title:`${this.$t("chats.title")} - Kitsu`}}},z={class:"chat-column"},T={key:1,class:"chat-list"},V=["onClick"],A={class:"flexrow"},G={class:"flexcolumn flexrow-item ml1"},I={class:"chat-item-project-name"},K={class:"chat-item-title"},D={class:"chat-item-subtitle"},H={class:"selected-entity-chat"};function J(t,e,l,f,c,a){const p=o("spinner"),g=o("entity-thumbnail"),C=o("entity-chat"),$=o("page-left-side-layout");return n(),_($,null,{side:m(()=>[i("div",z,[c.loading.list?(n(),_(p,{key:0,class:"mt1"})):(n(),h("div",T,[(n(!0),h(k,null,E(a.chatList,s=>(n(),h("div",{key:s.id,class:F(a.chatClass(s)),onClick:O=>a.selectChat(s)},[i("div",A,[u(g,{class:"flexrow-item mr1",height:40,"empty-height":40,"empty-width":60,entity:{id:s.object_id,preview_file_id:s.preview_file_id}},null,8,["entity"]),i("div",G,[i("div",I,r(a.getChatProjectName(s)),1),i("div",K,r(s.entity_name),1),i("div",D,r(a.getChatDate(s)),1)])])],10,V))),128))]))])]),main:m(()=>[i("div",H,[u(C,{ref:"entityChat",entity:c.entity,name:a.chatList.find(s=>s.object_id===c.entity.id)?.entity_name},null,8,["entity","name"])])]),_:1})}const W=y(Q,[["render",J],["__scopeId","data-v-ba6568b7"]]);export{W as default};
//# sourceMappingURL=EntityChats-Ba1FWMNX.js.map
