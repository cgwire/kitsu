import{_ as F,E as O,C as W,j,B as G,r as o,o as i,c as l,d as s,f as r,w as y,g as d,h as m,k as h,v as p,t as a,F as S,e as q,n as H,H as K,ab as X,aX as J,a as Q,a6 as Y,b as Z}from"./index-C2m_IhNF.js";import{E as $,a as ee,b as te,c as se,e as ne}from"./EntityTaskList-CZTh0d-y.js";import{f as ie}from"./format-CUjWrpVJ.js";import{C as oe}from"./ComboboxNumber-CjSlWfmA.js";import{D as re}from"./DescriptionCell-JDDrCWCB.js";import{E as ce}from"./EditSequenceModal-Cbd9c6S7.js";import{E as le}from"./EntityChat-HdGpW8i5.js";import{P as ae}from"./PageTitle-DzrTLr4-.js";import{P as ue}from"./PageSubtitle-LvZN62xu.js";import{R as de}from"./RouteSectionTabs-B7npqca_.js";import{S as me}from"./Schedule-BBoWBvCl.js";import{T as he}from"./TableInfo-B2X54z7i.js";import pe from"./TaskInfo-C8qSIbPH.js";import{T as _e}from"./TaskTypeName-bEgQZfX7.js";import{C as fe}from"./corner-left-up-D3eQ9gWL.js";import"./string-B0Tq569e.js";import"./ValidationTag-C6BUHddW.js";import"./render-Bqw3AFAH.js";import"./video-Yn96Kb74.js";import"./EntityPreview-DQBzHKkN.js";import"./VideoViewer-Da8LCLxo.js";import"./index-KDZ8UbBO.js";import"./dom-tO7tlkHV.js";import"./eye-CKzk1Q6q.js";import"./PeopleNameCell-Et8wdH5i.js";import"./TaskTypeCell-DM2gnWrD.js";import"./BuildFilterModal-C3nrV5vY.js";import"./Combobox-DQpIQydI.js";import"./ComboboxStatus-DYpCiml-.js";import"./ComboboxStyled-fscUNRmK.js";import"./ComboboxTaskType-CiBcPUsC.js";import"./ComboboxBoolean-DJwCfClJ.js";import"./TextField-p_HJuEKt.js";import"./ModalFooter-BJ98b-60.js";import"./PeopleField-CJ8IkJD1.js";import"./TextareaField-Bd7jnoYr.js";import"./EmojiButton-B9I5hDFH.js";import"./FileUpload-C4E3YXqL.js";import"./ConfirmModal-CYuRpfjg.js";import"./DepartmentName-C_7ZW05X.js";import"./list-chevrons-up-down-ByJjEZOU.js";import"./briefcase-DXQKuIYE.js";import"./csv-cx9HGs3n.js";import"./PreviewPlayer-CsSraBfQ.js";import"./PlaylistPlayer-DoTL8QsR.js";import"./ComboboxSimple-DU0Ahozo.js";import"./clipboard-CQqgyZ_h.js";import"./DeleteModal-CaB_X4-T.js";import"./BaseModal-BCd5z4wK.js";import"./ComboboxDepartment-whRm-Bo0.js";import"./ComboboxStudio-q2R7SCuH.js";import"./play-B4GV49GM.js";import"./triangle-alert-DAfmXCpT.js";import"./thumbs-up-DoHhBcNt.js";import"./copy-BH2iDnK6.js";import"./vue.esm-bundler-Cb2j4MJL.js";import"./DeleteEntities-ZGV8gTRL.js";import"./HardDeleteModal-CyBgP8oG.js";import"./SearchField-DO27Jrsj.js";import"./corner-right-up-xElzR7oO.js";const ye={name:"sequence",mixins:[ne,ie],components:{ButtonSimple:G,ChevronLeftIcon:j,ChevronRightIcon:W,ComboboxNumber:oe,CornerLeftUpIcon:fe,DescriptionCell:re,EditSequenceModal:ce,EntityChat:le,EntityNews:se,EntityPreviewFiles:te,EntityTaskList:ee,EntityTimeLogs:$,EntityThumbnail:O,PageSubtitle:ue,PageTitle:ae,Schedule:me,RouteSectionTabs:de,TableInfo:he,TaskInfo:pe,TaskTypeName:_e},data(){return{type:"sequence",currentSequence:null,currentTask:null,currentSection:"infos",casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...Z(["currentEpisode","currentProduction","getTaskTypePriority","isCurrentUserManager","isTVShow","sequenceMap","sequenceMetadataDescriptors","sequenceSearchText","route","taskMap","taskTypeMap"]),title(){return this.currentSequence?this.currentEpisode?`${this.currentEpisode.name} / ${this.currentSequence.name}`:`${this.currentSequence.name}`:this.$t("main.loading")},currentEntity(){return this.currentSequence},getSequencesRoute(){const e=this.currentProduction.id,n=this.currentEpisode?.id,f=Y(e,"sequences",n);return f.query={search:this.sequenceSearchText},f},nbAssets(){let e=0;return this.currentSequence&&this.currentSection==="casting"&&this.currentSequence.castingAssetsByType&&this.currentSequence.castingAssetsByType.forEach(n=>{e+=n.length}),e}},methods:{...Q(["clearSelectedTasks","editSequence","setCurrentSequence","loadEpisodes","loadSequencesWithTasks","loadSequenceCasting"]),async init(){try{if(this.currentSequence=await this.loadCurrentSequence(),this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentSequence)try{await this.loadSequenceCasting(this.currentSequence),this.casting.isLoading=!1}catch(e){this.casting.isLoading=!1,this.casting.isError=!0,console.error(e)}else this.resetData()}catch(e){console.error(e)}},async loadCurrentSequence(){const e=this.route.params.sequence_id;let n=this.sequenceMap.get(e)||null;return(!n||!n.validations)&&(this.isTVShow&&await this.loadEpisodes(),await this.loadSequencesWithTasks(),n=J.cache.sequenceMap.get(e)||null),n},confirmEditSequence(e){e.id=this.currentSequence.id,this.loading.edit=!0,this.errors.edit=!1,this.editSequence(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(n=>{console.error(n),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const n=this.isTVShow?this.currentEpisode?.id||"main":null,f={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return X(f,n)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentSequence().then(e=>(this.currentSequence=e,this.loadSequenceCasting(this.currentSequence))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},ge={class:"columns fixed-page sequence xyz-in",xyz:"fade"},Se={class:"column main-column"},qe={class:"page-header flexrow"},ke={class:"flexrow-item ml2"},be={class:"flexrow-item"},ve={class:"sequence-data block"},we={class:"flexrow infos"},Te={class:"flexrow-item flexcolumn entity-infos"},Ee={class:"flexrow"},Ce={class:"flexrow-item has-text-right"},Le={class:"table-body"},Pe={key:0,class:"datatable no-header"},Ie={class:"table-body"},Me={class:"datatable-row"},xe={class:"field-label"},ze={class:"field-label"},Be={class:"flexrow"},De={class:"sequence-casting"},Re={class:"casting-data mt1"},Ve={key:0},Ae={key:0},Ne={class:"asset-type"},Ue={class:"asset-list"},Fe={class:"break-word"},Oe={key:0},We={class:"ready-for flexrow"},je={key:1,class:"mt1"},Ge={key:0,class:"schedule mt1"},He={class:"wrapper"},Ke={class:"column side-column"};function Xe(e,n,f,Je,t,_){const v=o("corner-left-up-icon"),g=o("router-link"),k=o("entity-thumbnail"),w=o("page-title"),T=o("chevron-left-icon"),E=o("chevron-right-icon"),C=o("route-section-tabs"),b=o("page-subtitle"),L=o("entity-task-list"),P=o("button-simple"),I=o("description-cell"),M=o("combobox-number"),x=o("task-type-name"),z=o("table-info"),B=o("schedule"),D=o("entity-chat"),R=o("entity-preview-files"),V=o("entity-time-logs"),A=o("entity-news"),N=o("task-info"),U=o("edit-sequence-modal");return i(),l("div",ge,[s("div",Se,[s("div",qe,[r(g,{class:"flexrow-item has-text-centered back-link",to:_.getSequencesRoute},{default:y(()=>[r(v)]),_:1},8,["to"]),s("span",ke,[t.currentSequence?(i(),d(k,{key:0,class:"entity-thumbnail",entity:t.currentSequence,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):m("",!0)]),s("div",be,[r(w,{text:_.title,class:"entity-title"},null,8,["text"])]),n[3]||(n[3]=s("div",{class:"filler"},null,-1)),e.previousEntityPath&&e.entityList.length>1?(i(),d(g,{key:0,class:"flexrow-item has-text-centered back-link ml1",to:e.previousEntityPath},{default:y(()=>[r(T)]),_:1},8,["to"])):m("",!0),e.nextEntityPath&&e.entityList.length>1?(i(),d(g,{key:1,class:"flexrow-item has-text-centered back-link",to:e.nextEntityPath},{default:y(()=>[r(E)]),_:1},8,["to"])):m("",!0)]),s("div",ve,[r(C,{class:"section-tabs","active-tab":t.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),h(s("div",we,[s("div",Te,[r(b,{text:e.$t("main.tasks")},null,8,["text"]),r(L,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentSequence,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",Ee,[r(b,{text:e.$t("main.info")},null,8,["text"]),n[4]||(n[4]=s("div",{class:"filler"},null,-1)),s("div",Ce,[e.isCurrentUserManager?(i(),d(P,{key:0,icon:"edit",title:e.$t("sequences.edit_title"),onClick:n[0]||(n[0]=c=>t.modals.edit=!0)},null,8,["title"])):m("",!0)])]),s("div",Le,[t.currentSequence?(i(),l("table",Pe,[s("tbody",Ie,[s("tr",Me,[s("td",xe,a(e.$t("shots.fields.description")),1),r(I,{entry:t.currentSequence,full:!0},null,8,["entry"])]),(i(!0),l(S,null,q(e.sequenceMetadataDescriptors,c=>(i(),l("tr",{key:c.id,class:"datatable-row"},[s("td",ze,a(c.name),1),s("td",null,a(t.currentSequence.data?t.currentSequence.data[c.field_name]:""),1)]))),128))])])):m("",!0)])])],512),[[p,t.currentSection==="infos"]]),s("div",Be,[n[5]||(n[5]=s("div",{class:"filler"},null,-1)),h(s("span",{class:"flexrow-item mt05"},a(e.$t("schedule.zoom_level"))+": ",513),[[p,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]]),h(r(M,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":n[1]||(n[1]=c=>e.zoomLevel=c)},null,8,["options","modelValue"]),[[p,t.currentSection==="schedule"&&e.scheduleItems[0].children.length>0]])]),h(s("div",De,[s("div",Re,[h(s("span",null,a(_.nbAssets)+" "+a(e.$tc("assets.number",_.nbAssets)),513),[[p,t.currentSection==="casting"&&_.nbAssets>0]]),h(s("span",{class:"tag tag-standby"},a(e.$t("breakdown.fields.standby")),513),[[p,t.currentSection==="casting"&&t.currentSequence&&t.currentSequence.is_casting_standby]])]),t.currentSequence?(i(),l("div",Ve,[t.currentSequence&&t.currentSequence.castingAssetsByType&&t.currentSequence.castingAssetsByType[0].length>0?(i(),l("div",Ae,[(i(!0),l(S,null,q(t.currentSequence.castingAssetsByType,c=>(i(),l("div",{class:"type-assets",key:c.length>0?c[0].asset_type_name:""},[s("div",Ne,a(c.length>0?c[0].asset_type_name:"")+" ("+a(c.length)+") ",1),s("div",Ue,[(i(!0),l(S,null,q(c,u=>(i(),d(g,{class:"asset-link",key:u.id,to:_.buildAssetRoute(u)},{default:y(()=>[r(k,{class:H(["entity-thumbnail",{shared:u.shared}]),entity:u,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["class","entity"]),s("div",Fe,[K(a(u.asset_name)+" ",1),u.nb_occurences>1?(i(),l("span",Oe," ("+a(u.nb_occurences)+") ",1)):m("",!0)]),s("div",We,[u.ready_for?(i(),d(x,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(u.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(u.ready_for).name},null,8,["task-type","current-production-id","title"])):m("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(i(),l("div",je,a(e.$t("sequences.no_casting")),1))])):(i(),d(z,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[p,t.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?h((i(),l("div",Ge,[s("div",He,[r(B,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[p,t.currentSection==="schedule"]]):h((i(),l("div",{key:1,class:"mt1"},a(e.$t("main.empty_schedule")),513)),[[p,t.currentSection==="schedule"]]),t.currentSection==="chat"?(i(),d(D,{key:2,entity:t.currentSequence,name:t.currentSequence?.full_name},null,8,["entity","name"])):m("",!0),t.currentSequence&&t.currentSection==="preview-files"?(i(),d(R,{key:3,entity:t.currentSequence},null,8,["entity"])):m("",!0),t.currentSequence&&t.currentSection==="time-logs"?(i(),d(V,{key:4,entity:t.currentSequence},null,8,["entity"])):m("",!0)])]),h(s("div",Ke,[r(N,{task:t.currentTask,"entity-type":"Sequence","with-actions":""},{default:y(()=>[r(A,{class:"news-column",entity:t.currentSequence},null,8,["entity"])]),_:1},8,["task"])],512),[[p,t.currentSection==="infos"]]),r(U,{ref:"edit-sequence-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"sequence-to-edit":t.currentSequence,onCancel:n[2]||(n[2]=c=>t.modals.edit=!1),onConfirm:_.confirmEditSequence},null,8,["active","is-loading","is-error","sequence-to-edit","onConfirm"])])}const ss=F(ye,[["render",Xe],["__scopeId","data-v-cc779c47"]]);export{ss as default};
//# sourceMappingURL=Sequence-CD7DQtOj.js.map
