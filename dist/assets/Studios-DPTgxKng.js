import{_ as p,M as C,r as d,q as E,o as c,c as m,d as i,t as u,I as k,k as T,f as r,g as y,h as g,n as w,F as S,e as D,i as x,a as $,b as V}from"./index-DF-DoQlt.js";import{c as L}from"./csv-IlynXFQz.js";import{s as B}from"./string-B0Tq569e.js";import{D as F}from"./DeleteModal-DwXK5r5w.js";import{C as M}from"./ColorField-ByrVYH4e.js";import{C as N}from"./ComboboxBoolean-DT116Lfu.js";import{M as A}from"./ModalFooter-Chk0SGv-.js";import{T as I}from"./TextField-BKWlN2Ov.js";import{L as q}from"./ListPageHeader-G9LHDILe.js";import{R}from"./RouteTabs-9ZMuefrE.js";import{R as U}from"./RowActionsCell-DR7b8Q1u.js";import{T as z}from"./TableInfo-D6xnVb4C.js";import"./Combobox-A6pnhVs3.js";import"./PageTitle-CtScP8aV.js";import"./trash-DWKk5Pv9.js";import"./refresh-cw-CYYYI9XK.js";const H={name:"edit-studios-modal",mixins:[C],components:{ColorField:M,ComboboxBoolean:N,ModalFooter:A,TextField:I},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},studioToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){return this.studioToEdit?.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},studioToEdit(){this.isEditing?this.form={id:this.studioToEdit.id,name:this.studioToEdit.name,color:this.studioToEdit.color,archived:String(this.studioToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}},j={class:"modal-content"},G={class:"box"},K={key:0,class:"title"},O={key:1,class:"title"};function P(e,t,l,f,o,s){const h=d("text-field"),_=d("color-field"),a=d("combobox-boolean"),b=d("modal-footer"),v=E("focus");return c(),m("div",{class:w(["modal",{"is-active":l.active}])},[i("div",{class:"modal-background",onClick:t[0]||(t[0]=n=>e.$emit("cancel"))}),i("div",j,[i("div",G,[s.isEditing?(c(),m("h1",K,u(e.$t("studios.edit_title"))+" "+u(l.studioToEdit.name),1)):(c(),m("h1",O,u(e.$t("studios.new_studios")),1)),i("form",{onSubmit:t[4]||(t[4]=k(()=>{},["prevent"]))},[T(r(h,{ref:"nameField",label:e.$t("studios.fields.name"),maxlength:30,modelValue:o.form.name,"onUpdate:modelValue":t[1]||(t[1]=n=>o.form.name=n)},null,8,["label","modelValue"]),[[v]]),r(_,{label:e.$t("studios.fields.color"),modelValue:o.form.color,"onUpdate:modelValue":t[2]||(t[2]=n=>o.form.color=n)},null,8,["label","modelValue"]),s.isEditing?(c(),y(a,{key:0,label:e.$t("main.archived"),onEnter:s.runConfirmation,modelValue:o.form.archived,"onUpdate:modelValue":t[3]||(t[3]=n=>o.form.archived=n)},null,8,["label","onEnter","modelValue"])):g("",!0)],32),r(b,{"error-text":e.$t("studios.create_error"),"is-error":l.isError,"is-loading":l.isLoading,onConfirm:s.runConfirmation,onCancel:t[5]||(t[5]=n=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const J=p(H,[["render",P],["__scopeId","data-v-b9c444e1"]]),Q={name:"studio-list",props:["entries","isLoading","isError"],components:{RowActionsCell:U,TableInfo:z},emits:["delete-clicked","edit-clicked"]},W={class:"data-list"},X={class:"datatable-wrapper"},Y={class:"datatable"},Z={class:"datatable-head"},ee={scope:"col",class:"name"},te={scope:"col"},oe={key:0,class:"datatable-body"},ie={class:"name"},se={class:"color"},le={class:"has-text-centered nb-asset-types"};function de(e,t,l,f,o,s){const h=d("row-actions-cell"),_=d("table-info");return c(),m("div",W,[i("div",X,[i("table",Y,[i("thead",Z,[i("tr",null,[i("th",ee,u(e.$t("studios.fields.name")),1),i("th",te,u(e.$t("studios.fields.color")),1),t[0]||(t[0]=i("th",{scope:"col",class:"actions"},null,-1))])]),l.entries.length>0?(c(),m("tbody",oe,[(c(!0),m(S,null,D(l.entries,a=>(c(),m("tr",{class:"datatable-row",key:a.id},[i("td",ie,u(a.name),1),i("td",se,[i("div",null,[i("span",{style:x({background:a.color})},null,4)])]),r(h,{onEditClicked:b=>e.$emit("edit-clicked",a),onDeleteClicked:b=>e.$emit("delete-clicked",a)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):g("",!0)])]),r(_,{"is-loading":l.isLoading,"is-error":l.isError},null,8,["is-loading","is-error"]),i("p",le,u(l.entries.length)+" "+u(e.$tc("studios.number",l.entries.length)),1)])}const re=p(Q,[["render",de],["__scopeId","data-v-33df9267"]]),ae={name:"studios",components:{DeleteModal:F,EditStudiosModal:J,ListPageHeader:q,RouteTabs:R,StudioList:re},data(){return{activeTab:"active",studioToEdit:null,studioToDelete:null,errors:{studios:!1,edit:!1,del:!1},loading:{studios:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.studios=!0,this.errors.studios=!1;try{await this.loadStudios()}catch(e){console.error(e),this.errors.studios=!0}this.loading.studios=!1},computed:{...V(["studios","archivedStudios"]),isActiveTab(){return this.activeTab==="active"},studioList(){return this.isActiveTab?this.studios:this.archivedStudios},deleteText(){return this.studioToDelete?this.$t("studios.delete_text",{name:this.studioToDelete.name}):""}},methods:{...$(["deleteStudio","editStudio","loadStudios","newStudio"]),onExportClicked(){const e=B.slugify(this.$t("studios.title")),l=[[this.$t("main.type"),this.$t("studios.fields.name"),this.$t("studios.fields.color")]].concat(this.studios.map(f=>[f.type,f.name,f.color]));L.buildCsvFile(e,l)},onNewClicked(){this.studioToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(e){this.studioToEdit=e,this.modals.edit=!0},async confirmEditStudio(e){this.loading.edit=!0,this.errors.edit=!1,e.id=this.studioToEdit?.id;try{e.id?await this.editStudio(e):await this.newStudio(e),this.modals.edit=!1}catch(t){console.error(t),this.errors.edit=!0}this.loading.edit=!1},onDeleteClicked(e){this.studioToDelete=e,this.modals.del=!0},async confirmDeleteStudio(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteStudio(this.studioToDelete),this.modals.del=!1}catch(e){console.error(e),this.errors.del=!0}this.loading.del=!1}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("studios.title")} - Kitsu`}}},ne={class:"studios page fixed-page"};function ce(e,t,l,f,o,s){const h=d("list-page-header"),_=d("route-tabs"),a=d("studio-list"),b=d("edit-studios-modal"),v=d("delete-modal");return c(),m("div",ne,[r(h,{title:e.$t("studios.title"),"new-entry-label":e.$t("studios.new_studios"),"is-exportable":s.isActiveTab,onExportClicked:s.onExportClicked,onNewClicked:s.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),r(_,{class:"mt2","active-tab":o.activeTab,tabs:o.tabs},null,8,["active-tab","tabs"]),r(a,{class:"studio-list",entries:s.studioList,"is-loading":o.loading.studios,"is-error":o.errors.studios,onEditClicked:s.onEditClicked,onDeleteClicked:s.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),r(b,{active:o.modals.edit,"is-loading":o.loading.edit,"is-error":o.errors.edit,"studio-to-edit":o.studioToEdit,onCancel:t[0]||(t[0]=n=>o.modals.edit=!1),onConfirm:s.confirmEditStudio},null,8,["active","is-loading","is-error","studio-to-edit","onConfirm"]),r(v,{active:o.modals.del,"is-loading":o.loading.del,"is-error":o.errors.del,text:s.deleteText,"error-text":e.$t("studios.delete_error"),onCancel:t[1]||(t[1]=n=>o.modals.del=!1),onConfirm:s.confirmDeleteStudio},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const De=p(ae,[["render",ce],["__scopeId","data-v-67febb31"]]);export{De as default};
//# sourceMappingURL=Studios-DPTgxKng.js.map
