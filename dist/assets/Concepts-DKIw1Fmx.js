import{_ as b,m as T,a as F,H as D,T as w,S as x,I as M,K as B,b as I,B as V,aN as A,s as E,y as P,r as l,c as d,o as r,e as i,f as c,k as N,d as u,t as h,F as L,g as Q,n as O,a4 as K,p as U,N as G,a3 as q,aO as z}from"./index-zd5tlars.js";import{C as H}from"./ConceptCard-f-HM23wR.js";const R={name:"concepts",mixins:[E,P],components:{AddPreviewModal:A,ButtonSimple:V,Combobox:I,ComboboxStatus:B,ConceptCard:H,PeopleField:M,SearchField:x,TableInfo:w,TaskInfo:D},data(){return{imgExtensions:z.IMG_EXTENSIONS_STRING,isDraggingFile:!1,loading:{addingConcept:!1,loadingConcepts:!1,savingSearch:!1},errors:{addingConcept:!1,loadingConcepts:!1},filters:{entityType:null,publisher:null,sortBy:"created_at",taskStatusId:null},form:{file:null},modals:{addConcept:!1},conceptSearchQueries:[{id:"filter-test-1",list_type:"concept",name:"test",search_query:"test"}]}},mounted(){},computed:{...F(["concepts","currentProduction","isDarkTheme","isTVShow","personMap","selectedConcepts","taskStatusMap"]),assetMap(){return q.cache.assetMap},publishers(){const e=new Map;return this.filteredConcepts.forEach(s=>{const a=s.created_by;if(!e.has(a)){const p=this.personMap.get(a);p&&e.set(a,p)}}),G([...e.values()])},currentTask(){return this.currentConcept?.tasks?.[0]},currentConcept(){return this.selectedConcepts.size===1?this.selectedConcepts.values().next().value:null},entityTypeOptions(){const e={label:this.$t("main.all"),value:null},s=["assets","shots","sequences","edits","episodes"].map(a=>({label:this.$t(`${a}.title`),value:a}));return[e].concat(s)},sortByOptions(){return["created_at","updated_at","last_comment_date"].map(e=>({label:e,value:e}))},filteredConcepts(){let e=[...this.concepts];return this.filters.taskStatusId&&(e=e.filter(s=>s.tasks[0].task_status_id===this.filters.taskStatusId)),this.filters.publisher&&(e=e.filter(s=>s.created_by===this.filters.publisher.id)),this.filters.entityType&&(e=e.filter(s=>s.tags?.some(a=>a.type===this.filters.entityType))),e.sort(U.firstBy(this.filters.sortBy,-1).thenBy("created_at",-1))},searchField(){return this.$refs["search-field"]},taskStatusList(){const e={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},s=K(Array.from(this.taskStatusMap.values()).filter(a=>a.for_concept));return[e].concat(s)}},methods:{...T(["addSelectedConcepts","addSelectedTask","clearSelectedConcepts","clearSelectedTasks","loadAssets","loadConcepts","newConcepts","setCurrentEpisode"]),setConceptSearch:e=>Promise.resolve(),saveConceptSearch:e=>Promise.resolve(),removeConceptSearch:e=>Promise.resolve(),setSearch(e){this.searchField.setValue(e)},onSearchChange(){const e=this.searchField.getValue()||"";e?.length!==1&&this.setConceptSearch(e),this.setSearchInUrl()},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveConceptSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeConceptSearch(e).catch(s=>{s&&console.error(s)})},async refreshConcepts(){this.loading.loadingConcepts=!0;try{this.isTVShow&&this.setCurrentEpisode("all"),await this.loadAssets({all:!0}),await this.loadConcepts()}catch(e){console.error(e),this.errors.loadingConcepts=!0}finally{this.loading.loadingConcepts=!1}},isSelected(e){return this.selectedConcepts.has(e.id)},onSelectConcept(e,s=!1){const a=s?new Map(this.selectedConcepts):new Map;s&&this.isSelected(e)||!s&&e===this.currentConcept?a.delete(e.id):a.set(e.id,e),this.clearSelectedConcepts(),this.addSelectedConcepts(a),this.clearSelectedTasks(),this.currentTask&&this.addSelectedTask(this.currentTask)},openAddConceptModal(){this.modals.addConcept=!0},closeAddConceptModal(){this.modals.addConcept=!1},async confirmAddConceptModal(e){this.loading.addingConcept=!0;try{await this.newConcepts(e),this.closeAddConceptModal()}catch(s){console.error(s),this.errors.addingConcept=!0}finally{this.loading.addingConcept=!1}},reset(){this.clearSelectedConcepts(),this.clearSelectedTasks(),this.refreshConcepts()},onFileDrop(e){this.pauseEvent(e);const s=e.dataTransfer.files;this.modals.addConcept=!0,this.isDraggingFile=!1,this.$nextTick(()=>{this.$refs["add-preview-modal"].setFiles(s)})},onFileDragover(e){this.pauseEvent(e),this.isDraggingFile=!0},onFileDragLeave(){this.isDraggingFile=!1}},watch:{currentProduction:{immediate:!0,handler(){const e=this.$route.params.production_id;this.currentProduction?.id===e&&this.reset()}}},socket:{events:{"task:status-changed"(e){const s=this.concepts.find(a=>a.tasks[0].id===e.task_id);s&&(s.tasks[0].task_status_id=e.new_task_status_id)}}},head(){return{title:`${this.currentProduction.name} | ${this.$t("concepts.title")} - Kitsu`}}},X={class:"fixed-page columns"},j={class:"column main-column"},J={class:"concepts page"},W={class:"page-header"},Y={class:"filters"},Z={class:"field"},$={class:"label"},ee={class:"items"},se=["onClick"],te={key:2,class:"has-text-centered mb1 mt1 empty-concepts"},oe={class:"footer mb2"},ae={class:"column side-column"};function ne(e,s,a,p,n,t){l("search-field");const f=l("combobox-status"),g=l("people-field"),C=l("combobox"),_=l("table-info"),y=l("concept-card"),k=l("button-simple"),S=l("add-preview-modal"),v=l("task-info");return r(),d("div",X,[i("div",j,[i("div",J,[i("div",W,[i("div",Y,[u("",!0),c(f,{label:e.$t("main.status"),"task-status-list":t.taskStatusList,modelValue:n.filters.taskStatusId,"onUpdate:modelValue":s[0]||(s[0]=o=>n.filters.taskStatusId=o)},null,8,["label","task-status-list","modelValue"]),i("span",Z,[i("label",$,h(e.$t("concepts.fields.publisher")),1),c(g,{small:"",people:t.publishers,modelValue:n.filters.publisher,"onUpdate:modelValue":s[1]||(s[1]=o=>n.filters.publisher=o)},null,8,["people","modelValue"])]),u("",!0),c(C,{class:"right",label:e.$t("main.sorted_by"),"locale-key-prefix":"concepts.fields.",options:t.sortByOptions,modelValue:n.filters.sortBy,"onUpdate:modelValue":s[3]||(s[3]=o=>n.filters.sortBy=o)},null,8,["label","options","modelValue"])])]),n.loading.loadingConcepts||n.errors.loadingConcepts?(r(),N(_,{key:0,"is-loading":n.loading.loadingConcepts,"is-error":n.errors.loadingConcepts},null,8,["is-loading","is-error"])):t.filteredConcepts?.length?(r(),d("div",{key:1,ref:"concept-list",class:"concept-list pb1",onDragover:s[7]||(s[7]=(...o)=>t.onFileDragover&&t.onFileDragover(...o))},[n.isDraggingFile?(r(),d("div",{key:0,class:"drop-mask",onDrop:s[4]||(s[4]=(...o)=>t.onFileDrop&&t.onFileDrop(...o)),onDragover:s[5]||(s[5]=(...o)=>t.onFileDragover&&t.onFileDragover(...o)),onDragleave:s[6]||(s[6]=(...o)=>t.onFileDragLeave&&t.onFileDragLeave(...o))},h(e.$t("concepts.drop_new_concepts")),33)):u("",!0),i("ul",ee,[(r(!0),d(L,null,Q(t.filteredConcepts,o=>(r(),d("li",{class:O(["item",{"selected-item":t.isSelected(o)}]),key:o.id,onClick:m=>t.onSelectConcept(o,m.ctrlKey||m.metaKey)},[c(y,{concept:o},null,8,["concept"])],10,se))),128))])],544)):(r(),d("div",te,[i("strong",null,h(e.$t("concepts.empty")),1)])),i("div",oe,[c(k,{class:"upload-button",disabled:n.loading.loadingConcepts,text:e.$t("concepts.add_new_concept"),onClick:t.openAddConceptModal},null,8,["disabled","text","onClick"])])])]),c(S,{ref:"add-preview-modal",active:n.modals.addConcept,extensions:n.imgExtensions,"is-concept":"","is-error":n.errors.addingConcept,"is-loading":n.loading.addingConcept,message:"",onCancel:t.closeAddConceptModal,onConfirm:t.confirmAddConceptModal},null,8,["active","extensions","is-error","is-loading","onCancel","onConfirm"]),i("div",ae,[c(v,{"entity-type":"Concept",task:t.currentTask,"with-actions":""},null,8,["task"])])])}const re=b(R,[["render",ne],["__scopeId","data-v-549c84ff"]]);export{re as default};
//# sourceMappingURL=Concepts-DKIw1Fmx.js.map
