import{_ as C,r,o as m,c as f,d as s,t as n,F as k,e as g,f as d,M as v,q as A,I as T,k as x,n as w,g as b,h as E,a as D,b as $}from"./index-C2m_IhNF.js";import{c as V}from"./csv-cx9HGs3n.js";import{s as j}from"./string-B0Tq569e.js";import{f as B}from"./format-CUjWrpVJ.js";import{R as M}from"./RowActionsCell-CrYLK_aO.js";import{T as L}from"./TableInfo-B2X54z7i.js";import{D as N}from"./DeleteModal-CaB_X4-T.js";import{C as F}from"./Combobox-DQpIQydI.js";import{C as I}from"./ComboboxBoolean-DJwCfClJ.js";import{M as U}from"./ModalFooter-BJ98b-60.js";import{T as q}from"./TextField-p_HJuEKt.js";import{L as O}from"./ListPageHeader-DapWf1hA.js";import"./trash-B-JGLDKP.js";import"./refresh-cw-wbk7FbQb.js";import"./PageTitle-DzrTLr4-.js";const S={name:"custom-action-list",mixins:[B],components:{RowActionsCell:M,TableInfo:L},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked"]},H={class:"data-list"},R={class:"datatable-wrapper"},z={class:"datatable"},G={class:"datatable-head"},K={scope:"col",class:"name"},P={scope:"col",class:"url"},J={scope:"col",class:"entity-type"},Q={scope:"col",class:"is-ajax"},W={class:"datatable-body"},X={scope:"row",class:"name datatable-row-header"},Y={class:"url"},Z={class:"entity-type"},ee={class:"is-ajax"},te={class:"has-text-centered nb-custom-actions"};function oe(e,t,i,u,o,l){const _=r("row-actions-cell"),h=r("table-info");return m(),f("div",H,[s("div",R,[s("table",z,[s("thead",G,[s("tr",null,[s("th",K,n(e.$t("custom_actions.fields.name")),1),s("th",P,n(e.$t("custom_actions.fields.url")),1),s("th",J,n(e.$t("custom_actions.fields.entity_type")),1),s("th",Q,n(e.$t("custom_actions.fields.is_ajax")),1),t[0]||(t[0]=s("th",{scope:"col",class:"actions"},"Â ",-1))])]),s("tbody",W,[(m(!0),f(k,null,g(i.entries,a=>(m(),f("tr",{class:"datatable-row",key:a.id},[s("td",X,n(a.name),1),s("td",Y,n(a.url),1),s("td",Z,n(e.$t(`custom_actions.entity_types.${a.entity_type}`)),1),s("td",ee,n(e.formatBoolean(a.is_ajax)),1),d(_,{onEditClicked:p=>e.$emit("edit-clicked",a),onDeleteClicked:p=>e.$emit("delete-clicked",a)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])])]),d(h,{"is-loading":i.isLoading,"is-error":i.isError},null,8,["is-loading","is-error"]),s("p",te,n(i.entries.length)+" "+n(e.$tc("custom_actions.number",i.entries.length)),1)])}const se=C(S,[["render",oe],["__scopeId","data-v-db21cde9"]]),ie={name:"edit-custom-action-modal",mixins:[v],components:{Combobox:F,ComboboxBoolean:I,ModalFooter:U,TextField:q},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},customActionToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{name:"",url:"",entityType:"all",isAjax:"false"},entityTypeOptions:[{label:"all",value:"all"},{label:"asset",value:"asset"},{label:"shot",value:"shot"},{label:"sequence",value:"sequence"},{label:"edit",value:"edit"},{label:"episode",value:"episode"}]}},methods:{confirmClicked(){this.$emit("confirm",this.form)},isEditing(){return!!this.customActionToEdit?.id}},watch:{customActionToEdit:{immediate:!0,handler(){this.customActionToEdit&&(this.form={name:this.customActionToEdit.name,url:this.customActionToEdit.url,entityType:this.customActionToEdit.entity_type,isAjax:(!!this.customActionToEdit.is_ajax).toString()})}},active:{immediate:!0,handler(){this.active&&this.$nextTick(()=>{this.$refs.nameField?.focus()})}}}},le={class:"modal-content"},ne={class:"box"},ae={key:0,class:"title"},re={key:1,class:"title"};function ce(e,t,i,u,o,l){const _=r("text-field"),h=r("combobox"),a=r("combobox-boolean"),p=r("modal-footer"),y=A("focus");return m(),f("div",{class:w({modal:!0,"is-active":i.active})},[s("div",{class:"modal-background",onClick:t[0]||(t[0]=c=>e.$emit("cancel"))}),s("div",le,[s("div",ne,[l.isEditing()?(m(),f("h1",ae,n(e.$t("custom_actions.edit_title"))+" "+n(i.customActionToEdit.name),1)):(m(),f("h1",re,n(e.$t("custom_actions.new_custom_action")),1)),s("form",{onSubmit:t[5]||(t[5]=T(()=>{},["prevent"]))},[x(d(_,{ref:"nameField",label:e.$t("custom_actions.fields.name"),modelValue:o.form.name,"onUpdate:modelValue":t[1]||(t[1]=c=>o.form.name=c),modelModifiers:{trim:!0},onEnter:l.confirmClicked},null,8,["label","modelValue","onEnter"]),[[y]]),d(_,{label:e.$t("custom_actions.fields.url"),placeholder:"https://...",type:"url",modelValue:o.form.url,"onUpdate:modelValue":t[2]||(t[2]=c=>o.form.url=c),modelModifiers:{trim:!0},onEnter:l.confirmClicked},null,8,["label","modelValue","onEnter"]),d(h,{label:e.$t("custom_actions.fields.entity_type"),options:o.entityTypeOptions,modelValue:o.form.entityType,"onUpdate:modelValue":t[3]||(t[3]=c=>o.form.entityType=c),"locale-key-prefix":"custom_actions.entity_types.",onEnter:l.confirmClicked},null,8,["label","options","modelValue","onEnter"]),d(a,{label:e.$t("custom_actions.fields.is_ajax"),modelValue:o.form.isAjax,"onUpdate:modelValue":t[4]||(t[4]=c=>o.form.isAjax=c),onEnter:l.confirmClicked},null,8,["label","modelValue","onEnter"])],32),d(p,{"error-text":e.$t("custom_actions.create_error"),"is-loading":i.isLoading,"is-error":i.isError,onConfirm:l.confirmClicked,onCancel:t[6]||(t[6]=c=>e.$emit("cancel"))},null,8,["error-text","is-loading","is-error","onConfirm"])])])],2)}const de=C(ie,[["render",ce],["__scopeId","data-v-9e390c6b"]]),me={name:"custom-actions",components:{CustomActionList:se,DeleteModal:N,EditCustomActionModal:de,ListPageHeader:O},data(){return{modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},customActionToDelete:null,customActionToEdit:null}},computed:{...$(["customActions"]),deleteText(){const e=this.customActionToDelete;return e?this.$t("custom_actions.delete_text",{name:e.name}):""}},async created(){this.loading.list=!0,this.errors.list=!1;try{await this.loadCustomActions()}catch{this.errors.list=!0}finally{this.loading.list=!1}},methods:{...D(["deleteCustomAction","editCustomAction","loadCustomActions","newCustomAction"]),confirmEditCustomAction(e){let t="newCustomAction";this.customActionToEdit&&this.customActionToEdit.id&&(t="editCustomAction",e.id=this.customActionToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this[t](e).then(()=>{this.modals.edit=!1}).catch(i=>{console.error(i),this.errors.edit=!0,this.modals.isNewDisplayed=!1}).finally(()=>{this.loading.edit=!1})},confirmDeleteCustomAction(){this.loading.del=!0,this.errors.del=!1,this.deleteCustomAction(this.customActionToDelete).then(()=>{this.modals.del=!1}).catch(e=>{console.error(e),this.errors.del=!0}).finally(()=>{this.loading.del=!1})},onExportClicked(){const e=j.slugify(this.$t("custom_actions.title")),i=[[this.$t("main.type"),this.$t("custom_actions.fields.name"),this.$t("custom_actions.fields.url"),this.$t("custom_actions.fields.entity_type"),this.$t("custom_actions.fields.is_ajax")]].concat(this.customActions.map(u=>[u.type,u.name,u.url,u.entity_type,u.is_ajax]));V.buildCsvFile(e,i)},onNewClicked(){this.customActionToEdit={},this.errors.edit=!1,this.modals.edit=!0},onEditClicked(e){this.customActionToEdit=e,this.errors.edit=!1,this.modals.edit=!0},onDeleteClicked(e){this.customActionToDelete=e,this.errors.del=!1,this.modals.del=!0}},head(){return{title:`${this.$t("custom_actions.title")} - Kitsu`}}},ue={class:"custom-actions page fixed-page"};function fe(e,t,i,u,o,l){const _=r("list-page-header"),h=r("custom-action-list"),a=r("edit-custom-action-modal"),p=r("delete-modal");return m(),f("div",ue,[d(_,{title:e.$t("custom_actions.title"),"new-entry-label":e.$t("custom_actions.new_custom_action"),onExportClicked:l.onExportClicked,onNewClicked:l.onNewClicked},null,8,["title","new-entry-label","onExportClicked","onNewClicked"]),d(h,{entries:e.customActions,"is-loading":o.loading.list,"is-error":o.errors.list,onEditClicked:l.onEditClicked,onDeleteClicked:l.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),o.modals.edit?(m(),b(a,{key:0,active:"","is-loading":o.loading.edit,"is-error":o.errors.edit,"custom-action-to-edit":o.customActionToEdit,onCancel:t[0]||(t[0]=y=>o.modals.edit=!1),onConfirm:l.confirmEditCustomAction},null,8,["is-loading","is-error","custom-action-to-edit","onConfirm"])):E("",!0),o.modals.del?(m(),b(p,{key:1,active:"","is-loading":o.loading.del,"is-error":o.errors.del,text:l.deleteText,"error-text":e.$t("custom_actions.delete_error"),onCancel:t[1]||(t[1]=y=>o.modals.del=!1),onConfirm:l.confirmDeleteCustomAction},null,8,["is-loading","is-error","text","error-text","onConfirm"])):E("",!0)])}const $e=C(me,[["render",fe]]);export{$e as default};
//# sourceMappingURL=CustomActions-zS27EYDJ.js.map
