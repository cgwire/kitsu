import{_ as B,u as M,aH as D,ai as U,r as c,c as l,o,e as m,d as n,t as r,f as p,F as _,a8 as v,n as y,a as A,ad as O,aA as L,am as S,J as I,M as N,b as x,ao as z,aj as P,k as f,g as F,aR as j,aG as C,aI as R,aJ as T,bR as q,bS as J,T as G,bT as W,a5 as Z,an as H,y as $}from"./index-7BJAc9wj.js";import{g as K}from"./grablist-Da7oVI-6.js";import{D as Q}from"./DepartmentNamesCell-DGzXoidc.js";const X={name:"edit-avatar-modal",mixins:[U],components:{PeopleAvatar:D,Spinner:M},props:{active:{type:Boolean,default:!1},errorText:{type:String,default:""},isDeleting:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isUpdating:{type:Boolean,default:!1},person:{type:Object,required:!0}},emits:["close","delete","update"],methods:{selectFile(){this.$refs["input-file"].click()},updateAvatar(e){const t=e.target.files[0],i=new FormData;i.append("file",t,t.name),this.$emit("update",i)},deleteAvatar(){this.$emit("delete")},close(){this.isUpdating||this.isDeleting||this.$emit("close")},resetForm(){this.$refs["input-file"].value=null}},watch:{active(){this.active&&this.resetForm()}}},Y={class:"modal-content"},ee={class:"box"},te={class:"title"},ie={class:"flexrow right mt2"},se=["disabled"],oe=["disabled"],le=["disabled"],ae={key:0,class:"error mt1 has-text-right"};function ne(e,t,i,g,a,d){const b=c("people-avatar"),h=c("spinner");return o(),l("div",{class:y(["modal",{"is-active":i.active}])},[m("div",{class:"modal-background",onClick:t[0]||(t[0]=(...u)=>d.close&&d.close(...u))}),m("div",Y,[m("div",ee,[m("h1",te,r(e.$t("profile.avatar.title")),1),m("form",null,[m("input",{ref:"input-file",class:"hidden",type:"file",accept:".png,.jpg,.jpeg",onChange:t[1]||(t[1]=(...u)=>d.updateAvatar&&d.updateAvatar(...u))},null,544),p(b,{"is-lazy":!1,person:i.person,size:150,"font-size":60},null,8,["person"]),m("div",ie,[m("button",{class:"button flexrow-item is-primary",disabled:i.isUpdating||i.isDeleting,type:"button",onClick:t[2]||(t[2]=(...u)=>d.selectFile&&d.selectFile(...u))},[i.isUpdating?(o(),l(_,{key:0},[p(h,{class:"mr05 mt05",size:20,"is-white":""}),v(" "+r(e.$t("profile.avatar.updating")),1)],64)):(o(),l(_,{key:1},[v(r(e.$t("profile.change_avatar")),1)],64))],8,se),m("button",{class:"button flexrow-item",disabled:i.isUpdating||i.isDeleting,type:"button",onClick:t[3]||(t[3]=(...u)=>d.deleteAvatar&&d.deleteAvatar(...u))},[i.isDeleting?(o(),l(_,{key:0},[p(h,{class:"mr05 mt05",size:20}),v(" "+r(e.$t("profile.avatar.removing")),1)],64)):(o(),l(_,{key:1},[v(r(e.$t("profile.clear_avatar")),1)],64))],8,oe),m("button",{class:"button flexrow-item is-link",disabled:i.isUpdating||i.isDeleting,type:"button",onClick:t[4]||(t[4]=(...u)=>d.close&&d.close(...u))},r(e.$t("main.close")),9,le)])]),i.isError?(o(),l("p",ae,r(i.errorText),1)):n("",!0)])])],2)}const nt=B(X,[["render",ne],["__scopeId","data-v-4ba64e80"]]),re={name:"edit-person-modal",mixins:[U,z],components:{Combobox:x,ComboboxDepartment:N,ComboboxStudio:I,DateField:S,DepartmentName:L,TextField:O},props:{active:{type:Boolean,default:!1},isBot:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCreateInviteLoading:{type:Boolean,default:!1},isInviteLoading:{type:Boolean,default:!1},isInvitationSuccess:{type:Boolean,default:!1},isInvitationError:{type:Boolean,default:!1},isUserLimitError:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},personToEdit:{type:Object,default:()=>{}}},emits:["cancel"],data(){return{activeOptions:[{label:this.$t("main.yes"),value:"true"},{label:this.$t("main.no"),value:"false"}],contractOptions:[{label:"open-ended",value:"open-ended"},{label:"fixed-term",value:"fixed-term"},{label:"short-term",value:"short-term"},{label:"freelance",value:"freelance"},{label:"apprentice",value:"apprentice"},{label:"internship",value:"internship"}],form:{first_name:"",last_name:"",email:"",phone:"",role:"user",position:"artist",seniority:"mid",daily_salary:0,contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:!1},roleOptions:[{label:"user",value:"user"},{label:"supervisor",value:"supervisor"},{label:"manager",value:"manager"},{label:"client",value:"client"},{label:"vendor",value:"vendor"},{label:"admin",value:"admin"}],positionOptions:[{label:"",value:null},{label:"artist",value:"artist"},{label:"supervisor",value:"supervisor"},{label:"lead",value:"lead"}],seniorityOptions:[{label:"",value:null},{label:"senior",value:"senior"},{label:"mid",value:"mid"},{label:"junior",value:"junior"}],selectedDepartment:null}},computed:{...A(["departments","departmentMap","people","user"]),selectableDepartments(){return this.departments.filter(e=>!this.form.departments.includes(e.id))},isEditing(){return!!this.personToEdit?.id},isValidName(){return!!this.form.first_name?.length},isValidEmail(){return!this.form.email?.length||!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.form.email)?!1:this.form.is_bot?!0:this.isUniqEmail},isUniqEmail(){return!this.people.some(e=>!e.is_bot&&e.email===this.form.email&&(!this.personToEdit||this.personToEdit.email!==e.email))},isValidForm(){return this.isValidName&&this.isValidEmail}},methods:{emitForm(e){if(!this.isValidForm)return;const t={...this.form,last_name:this.form.last_name||"",active:this.form.active==="true"||this.form.active===!0};this.$emit(e,t)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(e){const t=this.form.departments.indexOf(e);t>=0&&this.form.departments.splice(t,1)},resetForm(){this.isEditing?this.form={first_name:this.personToEdit.first_name,last_name:this.personToEdit.last_name,email:this.personToEdit.email,phone:this.personToEdit.phone,role:this.personToEdit.role,position:this.personToEdit.position,seniority:this.personToEdit.seniority,daily_salary:this.personToEdit.daily_salary,contract_type:this.personToEdit.contract_type,active:this.personToEdit.active?"true":"false",departments:[...this.personToEdit.departments||[]],studio_id:this.personToEdit.studio_id,expiration_date:this.personToEdit.expiration_date,is_bot:this.personToEdit.is_bot}:this.form={role:"user",position:"artist",seniority:"mid",daily_salary:0,contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:this.isBot,email:this.isBot?this.user.email:null}}},watch:{personToEdit:{immediate:!0,handler(){this.resetForm()}},active:{immediate:!0,handler(){this.active&&setTimeout(()=>{this.$refs["name-field"]?.focus()},100)}}}},de={class:"modal-content"},me={key:0,class:"title"},ue={key:1,class:"title"},ce={class:"departments field"},pe={class:"label"},fe={key:0,class:"empty mb1"},be=["onClick"],he={class:"flexrow"},ye={class:"flexrow"},ve=["disabled"],_e=["disabled"],ke=["disabled"],ge={key:11,class:"success has-text-right mt1"},Be={key:12,class:"error has-text-right mt1"},Ee={key:13,class:"error has-text-right mt1"},Ve={key:14,class:"error has-text-right mt1"};function we(e,t,i,g,a,d){const b=c("text-field"),h=c("date-field"),u=c("combobox"),E=c("department-name"),V=c("combobox-department"),w=c("combobox-studio");return o(),l("div",{class:y(["modal",{"is-active":i.active}])},[m("div",{class:"modal-background",onClick:t[0]||(t[0]=s=>e.$emit("cancel"))}),m("div",de,[m("form",{onSubmit:t[18]||(t[18]=P(s=>d.emitForm("confirm"),["prevent"])),class:"box"},[i.personToEdit.id!==void 0?(o(),l("h1",me,r(i.isBot?e.$t("bots.edit_title"):e.$t("people.edit_title"))+" "+r(i.personToEdit.full_name),1)):(o(),l("h1",ue,r(i.isBot?e.$t("bots.new_bot"):e.$t("people.new_person")),1)),p(b,{ref:"name-field",errored:a.form.first_name&&!d.isValidName,label:i.isBot?e.$t("bots.fields.name"):e.$t("people.fields.first_name"),disabled:i.personToEdit.is_generated_from_ldap,modelValue:a.form.first_name,"onUpdate:modelValue":t[1]||(t[1]=s=>a.form.first_name=s),modelModifiers:{trim:!0}},null,8,["errored","label","disabled","modelValue"]),i.isBot?n("",!0):(o(),f(b,{key:2,label:e.$t("people.fields.last_name"),disabled:i.personToEdit.is_generated_from_ldap,modelValue:a.form.last_name,"onUpdate:modelValue":t[2]||(t[2]=s=>a.form.last_name=s),modelModifiers:{trim:!0}},null,8,["label","disabled","modelValue"])),i.isBot?n("",!0):(o(),f(b,{key:3,type:"email",errored:a.form.email&&!d.isValidEmail,"error-text":d.isUniqEmail?"":e.$t("people.email_exist_error"),label:e.$t("people.fields.email"),disabled:i.personToEdit.is_generated_from_ldap,modelValue:a.form.email,"onUpdate:modelValue":t[3]||(t[3]=s=>a.form.email=s),modelModifiers:{trim:!0}},null,8,["errored","error-text","label","disabled","modelValue"])),i.isBot?n("",!0):(o(),f(b,{key:4,label:e.$t("people.fields.phone"),modelValue:a.form.phone,"onUpdate:modelValue":t[4]||(t[4]=s=>a.form.phone=s),modelModifiers:{trim:!0}},null,8,["label","modelValue"])),i.isBot?(o(),f(h,{key:5,label:e.$t("bots.fields.expiration_date"),"min-date":e.today,disabled:d.isEditing,modelValue:a.form.expiration_date,"onUpdate:modelValue":t[5]||(t[5]=s=>a.form.expiration_date=s)},null,8,["label","min-date","disabled","modelValue"])):n("",!0),p(u,{label:e.$t("people.fields.role"),options:a.roleOptions,"locale-key-prefix":"people.role.",modelValue:a.form.role,"onUpdate:modelValue":t[6]||(t[6]=s=>a.form.role=s)},null,8,["label","options","modelValue"]),i.isBot?n("",!0):(o(),f(u,{key:6,label:e.$t("people.fields.position"),options:a.positionOptions,"locale-key-prefix":"people.position.",modelValue:a.form.position,"onUpdate:modelValue":t[7]||(t[7]=s=>a.form.position=s)},null,8,["label","options","modelValue"])),i.isBot?n("",!0):(o(),f(u,{key:7,label:e.$t("people.fields.seniority"),options:a.seniorityOptions,"locale-key-prefix":"people.seniority.",modelValue:a.form.seniority,"onUpdate:modelValue":t[8]||(t[8]=s=>a.form.seniority=s)},null,8,["label","options","modelValue"])),i.isBot?n("",!0):(o(),f(b,{key:8,type:"number",label:e.$t("people.fields.daily_salary"),modelValue:a.form.daily_salary,"onUpdate:modelValue":t[9]||(t[9]=s=>a.form.daily_salary=s)},null,8,["label","modelValue"])),!i.isBot&&a.form.role!=="client"?(o(),f(u,{key:9,label:e.$t("people.fields.contract"),options:a.contractOptions,"locale-key-prefix":"people.contract.",modelValue:a.form.contract_type,"onUpdate:modelValue":t[10]||(t[10]=s=>a.form.contract_type=s)},null,8,["label","options","modelValue"])):n("",!0),m("div",ce,[m("label",pe,r(e.$t("people.fields.departments")),1),a.form.departments&&a.form.departments.length===0?(o(),l("p",fe,r(i.isBot?e.$t("bots.departments_empty"):e.$t("people.departments_empty")),1)):n("",!0),(o(!0),l(_,null,F(a.form.departments,s=>(o(),l("div",{class:"department-element mb1 mt05",key:s,onClick:k=>d.removeDepartment(s)},[s?(o(),f(E,{key:0,department:e.departmentMap.get(s)},null,8,["department"])):n("",!0)],8,be))),128)),m("div",he,[d.selectableDepartments.length>0?(o(),f(V,{key:0,class:"flexrow-item","selectable-departments":d.selectableDepartments,modelValue:a.selectedDepartment,"onUpdate:modelValue":t[11]||(t[11]=s=>a.selectedDepartment=s)},null,8,["selectable-departments","modelValue"])):n("",!0),d.selectableDepartments.length>0?(o(),l("button",{key:1,class:y(["button is-success flexrow-item",{"is-disabled":a.selectedDepartment===null}]),type:"button",onClick:t[12]||(t[12]=(...s)=>d.addDepartment&&d.addDepartment(...s))},r(e.$t("main.add")),3)):n("",!0)])]),i.isBot?n("",!0):(o(),f(w,{key:10,class:"field",label:e.$t("people.fields.studio"),modelValue:a.form.studio_id,"onUpdate:modelValue":t[13]||(t[13]=s=>a.form.studio_id=s)},null,8,["label","modelValue"])),p(u,{label:e.$t("people.fields.active"),options:a.activeOptions,disabled:i.personToEdit.is_generated_from_ldap,modelValue:a.form.active,"onUpdate:modelValue":t[14]||(t[14]=s=>a.form.active=s)},null,8,["label","options","disabled","modelValue"]),m("div",ye,[d.isEditing&&!i.isBot?(o(),l("button",{key:0,class:y(["button flexrow-item",{"is-loading":i.isInviteLoading}]),disabled:!d.isValidEmail,type:"button",onClick:t[15]||(t[15]=s=>d.emitForm("invite"))},r(e.$t("people.invite")),11,ve)):n("",!0),t[19]||(t[19]=m("div",{class:"filler"},null,-1)),!d.isEditing&&!i.isBot?(o(),l("button",{key:1,class:y(["button is-primary flexrow-item",{"is-loading":i.isCreateInviteLoading}]),disabled:!d.isValidForm,type:"button",onClick:t[16]||(t[16]=s=>d.emitForm("confirm-invite"))},r(e.$t("people.create_invite")),11,_e)):n("",!0),m("button",{class:y(["button is-primary flexrow-item",{"is-loading":i.isLoading}]),disabled:!d.isValidForm,type:"submit"},r(d.isEditing?i.isBot?e.$t("bots.confirm_edit"):e.$t("people.confirm_edit"):i.isBot?e.$t("bots.create"):e.$t("people.create")),11,ke),m("button",{class:"button is-link flexrow-item",type:"button",onClick:t[17]||(t[17]=s=>e.$emit("cancel"))},r(e.$t("main.cancel")),1)]),i.isInvitationSuccess?(o(),l("div",ge,r(e.$t("people.invite_success")),1)):n("",!0),i.isInvitationError?(o(),l("div",Be,r(e.$t("people.invite_error")),1)):n("",!0),i.isUserLimitError?(o(),l("div",Ee,r(e.$t("people.user_limit_error")),1)):n("",!0),i.isError?(o(),l("div",Ve,r(e.$t("people.create_error")),1)):n("",!0)],32)])],2)}const rt=B(re,[["render",we],["__scopeId","data-v-10131786"]]),Ce={key:0,class:"flexrow"},Te={class:"filler"},De={key:0,class:"email nowrap"},Ue=["title"],Ae=["title"],Fe={__name:"PeopleUserCell",props:{person:{type:Object,required:!0}},setup(e){const t=e,i=j(),g=C(()=>i.getters.isCurrentUserAdmin),a=C(()=>t.person?.email_otp_enabled||t.person?.totp_enabled||t.person?.fido_enabled);async function d(){await navigator.clipboard.writeText(t.person.email)}return(b,h)=>(o(),l("td",null,[e.person?(o(),l("div",Ce,[p(D,{"is-link":!0,person:e.person},null,8,["person"]),m("div",Te,[p(R,{class:"name",person:e.person,"with-link":""},null,8,["person"]),e.person.email&&!e.person.is_bot?(o(),l("div",De,[v(r(e.person.email)+" ",1),m("span",{class:"copy-icon",title:b.$t("main.copy"),onClick:d},[p(T(q),{size:12})],8,Ue)])):n("",!0)]),g.value&&a.value?(o(),l("span",{key:0,class:"tag",title:b.$t("profile.two_factor_authentication.enabled")},[p(T(J),{class:"mr05",size:15}),h[0]||(h[0]=v(" 2FA "))],8,Ae)):n("",!0)])):n("",!0)]))}},Me=B(Fe,[["__scopeId","data-v-2b4f32cd"]]),Oe={name:"people-list",mixins:[$,K],components:{AlertTriangleIcon:H,DepartmentNamesCell:Q,PeopleUserCell:Me,RowActionsCell:Z,StudioName:W,TableInfo:G},props:{entries:{type:Array,default:()=>[]},isBots:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["avatar-clicked","change-password-clicked","delete-clicked","edit-clicked","refresh-clicked"],data(){return{domEvents:[["mousemove",this.onMouseMove],["touchmove",this.onMouseMove],["mouseup",this.stopBrowsing],["mouseleave",this.stopBrowsing],["touchend",this.stopBrowsing],["touchcancel",this.stopBrowsing],["keyup",this.stopBrowsing]]}},mounted(){this.addEvents(this.domEvents)},beforeUnmount(){this.removeEvents(this.domEvents),document.body.style.cursor="default"},computed:{...A(["isCurrentUserAdmin"]),today(){return new Date().toJSON().slice(0,10)},nextWeek(){const e=new Date;return e.setDate(e.getDate()+7),e.toJSON().slice(0,10)},nbUsersDetails(){const e=this.entries.length,t=this.$tc(this.isBots?"bots.bots":"people.persons",e);return`${e} ${t}`}},methods:{isExpired(e){return e<this.today},isSoonExpired(e){return!this.isExpired(e)&&e<this.nextWeek}}},Le={class:"data-list"},Se={ref:"body",class:"datatable-wrapper"},Ie={key:0,class:"datatable"},Ne={class:"datatable-head"},xe={scope:"col",class:"user datatable-row-header"},ze={key:0,scope:"col",class:"phone"},Pe={key:1,scope:"col",class:"expiration"},je={scope:"col",class:"role"},Re={scope:"col",class:"departments"},qe={key:2,scope:"col",class:"studio"},Je={key:3,scope:"col",class:"contract"},Ge={key:4,scope:"col",class:"position"},We={key:5,scope:"col",class:"seniority"},Ze={key:6,scope:"col",class:"salary"},He={key:0,class:"phone"},$e={class:"role"},Ke={key:2,class:"studio"},Qe={key:3,class:"contract"},Xe={key:4,class:"position"},Ye={key:5,class:"seniority"},et={key:6,class:"salary"},tt={key:8,class:"actions"},it={key:0,class:"has-text-centered footer-info"};function st(e,t,i,g,a,d){const b=c("people-user-cell"),h=c("alert-triangle-icon"),u=c("department-names-cell"),E=c("studio-name"),V=c("row-actions-cell"),w=c("table-info");return o(),l("div",Le,[m("div",Se,[i.isLoading?n("",!0):(o(),l("table",Ie,[m("thead",Ne,[m("tr",null,[m("th",xe,r(i.isBots?e.$t("bots.bots"):e.$t("people.persons")),1),i.isBots?n("",!0):(o(),l("th",ze,r(e.$t("people.list.phone")),1)),i.isBots?(o(),l("th",Pe,r(e.$t("people.list.expiration")),1)):n("",!0),m("th",je,r(e.$t("people.list.role")),1),m("th",Re,r(e.$t("people.list.departments")),1),i.isBots?n("",!0):(o(),l("th",qe,r(e.$t("people.list.studio")),1)),i.isBots?n("",!0):(o(),l("th",Je,r(e.$t("people.list.contract")),1)),i.isBots?n("",!0):(o(),l("th",Ge,r(e.$t("people.list.position")),1)),i.isBots?n("",!0):(o(),l("th",We,r(e.$t("people.list.seniority")),1)),i.isBots?n("",!0):(o(),l("th",Ze,r(e.$t("people.fields.daily_salary")),1)),t[2]||(t[2]=m("th",{scope:"col",class:"actions"},null,-1))])]),i.entries.length>0?(o(),l("tbody",{key:0,class:"datatable-body",onMousedown:t[0]||(t[0]=(...s)=>e.startBrowsing&&e.startBrowsing(...s)),onTouchstart:t[1]||(t[1]=(...s)=>e.startBrowsing&&e.startBrowsing(...s))},[(o(!0),l(_,null,F(i.entries,s=>(o(),l("tr",{key:s.id,class:"datatable-row"},[p(b,{class:"user datatable-row-header",person:s},null,8,["person"]),i.isBots?n("",!0):(o(),l("td",He,r(s.phone),1)),i.isBots?(o(),l("td",{key:1,class:y(["expiration",{error:d.isExpired(s.expiration_date),warning:d.isSoonExpired(s.expiration_date)}])},[v(r(s.expiration_date)+" ",1),p(h,{class:"icon mr05"})],2)):n("",!0),m("td",$e,r(e.$t(`people.role.${s.role}`)),1),p(u,{class:"departments",departments:s.departments},null,8,["departments"]),i.isBots?n("",!0):(o(),l("td",Ke,[s.studio?(o(),f(E,{key:0,studio:s.studio},null,8,["studio"])):n("",!0)])),i.isBots?n("",!0):(o(),l("td",Qe,r(e.$t(`people.contract.${s.contract_type}`)),1)),i.isBots?n("",!0):(o(),l("td",Xe,r(s.position?e.$t(`people.position.${s.position}`):""),1)),i.isBots?n("",!0):(o(),l("td",Ye,r(s.seniority?e.$t(`people.seniority.${s.seniority}`):""),1)),i.isBots?n("",!0):(o(),l("td",et,r(s.daily_salary),1)),e.isCurrentUserAdmin?(o(),f(V,{key:7,class:"datatable-row-footer","hide-avatar":!s.active,"hide-change-password":i.isBots||!s.active,"hide-delete":s.active,"hide-refresh":!i.isBots||!s.active,onAvatarClicked:k=>e.$emit("avatar-clicked",s),onChangePasswordClicked:k=>e.$emit("change-password-clicked",s),onEditClicked:k=>e.$emit("edit-clicked",s),onRefreshClicked:k=>e.$emit("refresh-clicked",s),onDeleteClicked:k=>e.$emit("delete-clicked",s)},null,8,["hide-avatar","hide-change-password","hide-delete","hide-refresh","onAvatarClicked","onChangePasswordClicked","onEditClicked","onRefreshClicked","onDeleteClicked"])):(o(),l("td",tt))]))),128))],32)):n("",!0)]))],512),p(w,{"is-loading":i.isLoading,"is-error":i.isError},null,8,["is-loading","is-error"]),i.isLoading?n("",!0):(o(),l("p",it,r(d.nbUsersDetails),1))])}const dt=B(Oe,[["render",st],["__scopeId","data-v-f92205e2"]]);export{rt as E,dt as P,nt as a};
//# sourceMappingURL=PeopleList-DsSSktWa.js.map
