import{_ as V,u as U,aF as F,ah as C,r as c,c as o,o as l,e as m,d as r,t as a,f,F as v,a7 as k,n as h,a as D,ac as A,ay as M,ak as L,L as O,b as N,am as S,ai as x,k as p,g as T,T as I,a4 as z,al as P,y as j}from"./index-bqLtaTTG.js";import{C as R,S as q}from"./ComboboxStudio-BXytc3xL.js";import{g as J}from"./grablist-Da7oVI-6.js";import{D as W}from"./DepartmentNamesCell-_B1oxxGa.js";import{P as Z}from"./PeopleNameCell-C1EpbfE4.js";const G={name:"edit-avatar-modal",mixins:[C],components:{PeopleAvatar:F,Spinner:U},props:{active:{type:Boolean,default:!1},errorText:{type:String,default:""},isDeleting:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isUpdating:{type:Boolean,default:!1},person:{type:Object,required:!0}},emits:["close","delete","update"],methods:{selectFile(){this.$refs["input-file"].click()},updateAvatar(e){const i=e.target.files[0],t=new FormData;t.append("file",i,i.name),this.$emit("update",t)},deleteAvatar(){this.$emit("delete")},close(){this.isUpdating||this.isDeleting||this.$emit("close")},resetForm(){this.$refs["input-file"].value=null}},watch:{active(){this.active&&this.resetForm()}}},H={class:"modal-content"},K={class:"box"},Q={class:"title"},X={class:"flexrow right mt2"},Y=["disabled"],$=["disabled"],ee=["disabled"],te={key:0,class:"error mt1 has-text-right"};function ie(e,i,t,w,n,d){const b=c("people-avatar"),y=c("spinner");return l(),o("div",{class:h(["modal",{"is-active":t.active}])},[m("div",{class:"modal-background",onClick:i[0]||(i[0]=(...u)=>d.close&&d.close(...u))}),m("div",H,[m("div",K,[m("h1",Q,a(e.$t("profile.avatar.title")),1),m("form",null,[m("input",{ref:"input-file",class:"hidden",type:"file",accept:".png,.jpg,.jpeg",onChange:i[1]||(i[1]=(...u)=>d.updateAvatar&&d.updateAvatar(...u))},null,544),f(b,{"is-lazy":!1,person:t.person,size:150,"font-size":60},null,8,["person"]),m("div",X,[m("button",{class:"button flexrow-item is-primary",disabled:t.isUpdating||t.isDeleting,type:"button",onClick:i[2]||(i[2]=(...u)=>d.selectFile&&d.selectFile(...u))},[t.isUpdating?(l(),o(v,{key:0},[f(y,{class:"mr05 mt05",size:20,"is-white":""}),k(" "+a(e.$t("profile.avatar.updating")),1)],64)):(l(),o(v,{key:1},[k(a(e.$t("profile.change_avatar")),1)],64))],8,Y),m("button",{class:"button flexrow-item",disabled:t.isUpdating||t.isDeleting,type:"button",onClick:i[3]||(i[3]=(...u)=>d.deleteAvatar&&d.deleteAvatar(...u))},[t.isDeleting?(l(),o(v,{key:0},[f(y,{class:"mr05 mt05",size:20}),k(" "+a(e.$t("profile.avatar.removing")),1)],64)):(l(),o(v,{key:1},[k(a(e.$t("profile.clear_avatar")),1)],64))],8,$),m("button",{class:"button flexrow-item is-link",disabled:t.isUpdating||t.isDeleting,type:"button",onClick:i[4]||(i[4]=(...u)=>d.close&&d.close(...u))},a(e.$t("main.close")),9,ee)])]),t.isError?(l(),o("p",te,a(t.errorText),1)):r("",!0)])])],2)}const $e=V(G,[["render",ie],["__scopeId","data-v-4ba64e80"]]),se={name:"edit-person-modal",mixins:[C,S],components:{Combobox:N,ComboboxDepartment:O,ComboboxStudio:R,DateField:L,DepartmentName:M,TextField:A},props:{active:{type:Boolean,default:!1},isBot:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCreateInviteLoading:{type:Boolean,default:!1},isInviteLoading:{type:Boolean,default:!1},isInvitationSuccess:{type:Boolean,default:!1},isInvitationError:{type:Boolean,default:!1},isUserLimitError:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},personToEdit:{type:Object,default:()=>{}}},emits:["cancel"],data(){return{activeOptions:[{label:this.$t("main.yes"),value:"true"},{label:this.$t("main.no"),value:"false"}],contractOptions:[{label:"open-ended",value:"open-ended"},{label:"fixed-term",value:"fixed-term"},{label:"short-term",value:"short-term"},{label:"freelance",value:"freelance"},{label:"apprentice",value:"apprentice"},{label:"internship",value:"internship"}],form:{first_name:"",last_name:"",email:"",phone:"",role:"user",position:"artist",seniority:"mid",daily_salary:0,contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:!1},roleOptions:[{label:"user",value:"user"},{label:"supervisor",value:"supervisor"},{label:"manager",value:"manager"},{label:"client",value:"client"},{label:"vendor",value:"vendor"},{label:"admin",value:"admin"}],positionOptions:[{label:"",value:null},{label:"artist",value:"artist"},{label:"supervisor",value:"supervisor"},{label:"lead",value:"lead"}],seniorityOptions:[{label:"",value:null},{label:"senior",value:"senior"},{label:"mid",value:"mid"},{label:"junior",value:"junior"}],selectedDepartment:null}},computed:{...D(["departments","departmentMap","people","user"]),selectableDepartments(){return this.departments.filter(e=>!this.form.departments.includes(e.id))},isEditing(){return!!this.personToEdit?.id},isValidName(){return!!this.form.first_name?.length},isValidEmail(){return!this.form.email?.length||!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.form.email)?!1:this.form.is_bot?!0:this.isUniqEmail},isUniqEmail(){return!this.people.some(e=>!e.is_bot&&e.email===this.form.email&&(!this.personToEdit||this.personToEdit.email!==e.email))},isValidForm(){return this.isValidName&&this.isValidEmail}},methods:{emitForm(e){if(!this.isValidForm)return;const i={...this.form,last_name:this.form.last_name||"",active:this.form.active==="true"||this.form.active===!0};this.$emit(e,i)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(e){const i=this.form.departments.indexOf(e);i>=0&&this.form.departments.splice(i,1)},resetForm(){this.isEditing?this.form={first_name:this.personToEdit.first_name,last_name:this.personToEdit.last_name,email:this.personToEdit.email,phone:this.personToEdit.phone,role:this.personToEdit.role,position:this.personToEdit.position,seniority:this.personToEdit.seniority,daily_salary:this.personToEdit.daily_salary,contract_type:this.personToEdit.contract_type,active:this.personToEdit.active?"true":"false",departments:[...this.personToEdit.departments||[]],studio_id:this.personToEdit.studio_id,expiration_date:this.personToEdit.expiration_date,is_bot:this.personToEdit.is_bot}:this.form={role:"user",position:"artist",seniority:"mid",daily_salary:0,contract_type:"open-ended",active:"true",departments:[],studio_id:null,expiration_date:null,is_bot:this.isBot,email:this.isBot?this.user.email:null}}},watch:{personToEdit:{immediate:!0,handler(){this.resetForm()}},active:{immediate:!0,handler(){this.active&&setTimeout(()=>{this.$refs["name-field"]?.focus()},100)}}}},le={class:"modal-content"},oe={key:0,class:"title"},ae={key:1,class:"title"},ne={class:"departments field"},re={class:"label"},de={key:0,class:"empty mb1"},me=["onClick"],ue={class:"flexrow"},ce={class:"flexrow"},pe=["disabled"],fe=["disabled"],be=["disabled"],he={key:11,class:"success has-text-right mt1"},ye={key:12,class:"error has-text-right mt1"},ve={key:13,class:"error has-text-right mt1"},_e={key:14,class:"error has-text-right mt1"};function ke(e,i,t,w,n,d){const b=c("text-field"),y=c("date-field"),u=c("combobox"),g=c("department-name"),B=c("combobox-department"),E=c("combobox-studio");return l(),o("div",{class:h(["modal",{"is-active":t.active}])},[m("div",{class:"modal-background",onClick:i[0]||(i[0]=s=>e.$emit("cancel"))}),m("div",le,[m("form",{onSubmit:i[18]||(i[18]=x(s=>d.emitForm("confirm"),["prevent"])),class:"box"},[t.personToEdit.id!==void 0?(l(),o("h1",oe,a(t.isBot?e.$t("bots.edit_title"):e.$t("people.edit_title"))+" "+a(t.personToEdit.full_name),1)):(l(),o("h1",ae,a(t.isBot?e.$t("bots.new_bot"):e.$t("people.new_person")),1)),f(b,{ref:"name-field",errored:n.form.first_name&&!d.isValidName,label:t.isBot?e.$t("bots.fields.name"):e.$t("people.fields.first_name"),disabled:t.personToEdit.is_generated_from_ldap,modelValue:n.form.first_name,"onUpdate:modelValue":i[1]||(i[1]=s=>n.form.first_name=s),modelModifiers:{trim:!0}},null,8,["errored","label","disabled","modelValue"]),t.isBot?r("",!0):(l(),p(b,{key:2,label:e.$t("people.fields.last_name"),disabled:t.personToEdit.is_generated_from_ldap,modelValue:n.form.last_name,"onUpdate:modelValue":i[2]||(i[2]=s=>n.form.last_name=s),modelModifiers:{trim:!0}},null,8,["label","disabled","modelValue"])),t.isBot?r("",!0):(l(),p(b,{key:3,type:"email",errored:n.form.email&&!d.isValidEmail,"error-text":d.isUniqEmail?"":e.$t("people.email_exist_error"),label:e.$t("people.fields.email"),disabled:t.personToEdit.is_generated_from_ldap,modelValue:n.form.email,"onUpdate:modelValue":i[3]||(i[3]=s=>n.form.email=s),modelModifiers:{trim:!0}},null,8,["errored","error-text","label","disabled","modelValue"])),t.isBot?r("",!0):(l(),p(b,{key:4,label:e.$t("people.fields.phone"),modelValue:n.form.phone,"onUpdate:modelValue":i[4]||(i[4]=s=>n.form.phone=s),modelModifiers:{trim:!0}},null,8,["label","modelValue"])),t.isBot?(l(),p(y,{key:5,label:e.$t("bots.fields.expiration_date"),"min-date":e.today,disabled:d.isEditing,modelValue:n.form.expiration_date,"onUpdate:modelValue":i[5]||(i[5]=s=>n.form.expiration_date=s)},null,8,["label","min-date","disabled","modelValue"])):r("",!0),f(u,{label:e.$t("people.fields.role"),options:n.roleOptions,"locale-key-prefix":"people.role.",modelValue:n.form.role,"onUpdate:modelValue":i[6]||(i[6]=s=>n.form.role=s)},null,8,["label","options","modelValue"]),t.isBot?r("",!0):(l(),p(u,{key:6,label:e.$t("people.fields.position"),options:n.positionOptions,"locale-key-prefix":"people.position.",modelValue:n.form.position,"onUpdate:modelValue":i[7]||(i[7]=s=>n.form.position=s)},null,8,["label","options","modelValue"])),t.isBot?r("",!0):(l(),p(u,{key:7,label:e.$t("people.fields.seniority"),options:n.seniorityOptions,"locale-key-prefix":"people.seniority.",modelValue:n.form.seniority,"onUpdate:modelValue":i[8]||(i[8]=s=>n.form.seniority=s)},null,8,["label","options","modelValue"])),t.isBot?r("",!0):(l(),p(b,{key:8,type:"number",label:e.$t("people.fields.daily_salary"),modelValue:n.form.daily_salary,"onUpdate:modelValue":i[9]||(i[9]=s=>n.form.daily_salary=s)},null,8,["label","modelValue"])),!t.isBot&&n.form.role!=="client"?(l(),p(u,{key:9,label:e.$t("people.fields.contract"),options:n.contractOptions,"locale-key-prefix":"people.contract.",modelValue:n.form.contract_type,"onUpdate:modelValue":i[10]||(i[10]=s=>n.form.contract_type=s)},null,8,["label","options","modelValue"])):r("",!0),m("div",ne,[m("label",re,a(e.$t("people.fields.departments")),1),n.form.departments&&n.form.departments.length===0?(l(),o("p",de,a(t.isBot?e.$t("bots.departments_empty"):e.$t("people.departments_empty")),1)):r("",!0),(l(!0),o(v,null,T(n.form.departments,s=>(l(),o("div",{class:"department-element mb1 mt05",key:s,onClick:_=>d.removeDepartment(s)},[s?(l(),p(g,{key:0,department:e.departmentMap.get(s)},null,8,["department"])):r("",!0)],8,me))),128)),m("div",ue,[d.selectableDepartments.length>0?(l(),p(B,{key:0,class:"flexrow-item","selectable-departments":d.selectableDepartments,modelValue:n.selectedDepartment,"onUpdate:modelValue":i[11]||(i[11]=s=>n.selectedDepartment=s)},null,8,["selectable-departments","modelValue"])):r("",!0),d.selectableDepartments.length>0?(l(),o("button",{key:1,class:h(["button is-success flexrow-item",{"is-disabled":n.selectedDepartment===null}]),type:"button",onClick:i[12]||(i[12]=(...s)=>d.addDepartment&&d.addDepartment(...s))},a(e.$t("main.add")),3)):r("",!0)])]),t.isBot?r("",!0):(l(),p(E,{key:10,class:"field",label:e.$t("people.fields.studio"),modelValue:n.form.studio_id,"onUpdate:modelValue":i[13]||(i[13]=s=>n.form.studio_id=s)},null,8,["label","modelValue"])),f(u,{label:e.$t("people.fields.active"),options:n.activeOptions,disabled:t.personToEdit.is_generated_from_ldap,modelValue:n.form.active,"onUpdate:modelValue":i[14]||(i[14]=s=>n.form.active=s)},null,8,["label","options","disabled","modelValue"]),m("div",ce,[d.isEditing&&!t.isBot?(l(),o("button",{key:0,class:h(["button flexrow-item",{"is-loading":t.isInviteLoading}]),disabled:!d.isValidEmail,type:"button",onClick:i[15]||(i[15]=s=>d.emitForm("invite"))},a(e.$t("people.invite")),11,pe)):r("",!0),i[19]||(i[19]=m("div",{class:"filler"},null,-1)),!d.isEditing&&!t.isBot?(l(),o("button",{key:1,class:h(["button is-primary flexrow-item",{"is-loading":t.isCreateInviteLoading}]),disabled:!d.isValidForm,type:"button",onClick:i[16]||(i[16]=s=>d.emitForm("confirm-invite"))},a(e.$t("people.create_invite")),11,fe)):r("",!0),m("button",{class:h(["button is-primary flexrow-item",{"is-loading":t.isLoading}]),disabled:!d.isValidForm,type:"submit"},a(d.isEditing?t.isBot?e.$t("bots.confirm_edit"):e.$t("people.confirm_edit"):t.isBot?e.$t("bots.create"):e.$t("people.create")),11,be),m("button",{class:"button is-link flexrow-item",type:"button",onClick:i[17]||(i[17]=s=>e.$emit("cancel"))},a(e.$t("main.cancel")),1)]),t.isInvitationSuccess?(l(),o("div",he,a(e.$t("people.invite_success")),1)):r("",!0),t.isInvitationError?(l(),o("div",ye,a(e.$t("people.invite_error")),1)):r("",!0),t.isUserLimitError?(l(),o("div",ve,a(e.$t("people.user_limit_error")),1)):r("",!0),t.isError?(l(),o("div",_e,a(e.$t("people.create_error")),1)):r("",!0)],32)])],2)}const et=V(se,[["render",ke],["__scopeId","data-v-10131786"]]),ge={name:"people-list",mixins:[j,J],components:{AlertTriangleIcon:P,DepartmentNamesCell:W,PeopleNameCell:Z,RowActionsCell:z,StudioName:q,TableInfo:I},props:{entries:{type:Array,default:()=>[]},isBots:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["avatar-clicked","change-password-clicked","delete-clicked","edit-clicked","refresh-clicked"],data(){return{domEvents:[["mousemove",this.onMouseMove],["touchmove",this.onMouseMove],["mouseup",this.stopBrowsing],["mouseleave",this.stopBrowsing],["touchend",this.stopBrowsing],["touchcancel",this.stopBrowsing],["keyup",this.stopBrowsing]]}},mounted(){this.addEvents(this.domEvents)},beforeUnmount(){this.removeEvents(this.domEvents),document.body.style.cursor="default"},computed:{...D(["isCurrentUserAdmin"]),today(){return new Date().toJSON().slice(0,10)},nextWeek(){const e=new Date;return e.setDate(e.getDate()+7),e.toJSON().slice(0,10)},nbUsersDetails(){const e=this.entries.length,i=this.$tc(this.isBots?"bots.bots":"people.persons",e);return`${e} ${i}`}},methods:{isExpired(e){return e<this.today},isSoonExpired(e){return!this.isExpired(e)&&e<this.nextWeek}}},Be={class:"data-list"},Ee={ref:"body",class:"datatable-wrapper"},Ve={key:0,class:"datatable"},we={class:"datatable-head"},Ce={scope:"col",class:"name datatable-row-header"},De={key:0,scope:"col",class:"email"},Te={key:1,scope:"col",class:"phone"},Ue={key:2,scope:"col",class:"expiration"},Fe={scope:"col",class:"role"},Ae={scope:"col",class:"departments"},Me={key:3,scope:"col",class:"studio"},Le={key:4,scope:"col",class:"contract"},Oe={key:5,scope:"col",class:"position"},Ne={key:6,scope:"col",class:"seniority"},Se={key:7,scope:"col",class:"salary"},xe={key:0,class:"email"},Ie={key:1,class:"phone"},ze={class:"role"},Pe={key:3,class:"studio"},je={key:4,class:"contract"},Re={key:5,class:"position"},qe={key:6,class:"seniority"},Je={key:7,class:"salary"},We={key:9,class:"actions"},Ze={key:0,class:"has-text-centered footer-info"};function Ge(e,i,t,w,n,d){const b=c("people-name-cell"),y=c("alert-triangle-icon"),u=c("department-names-cell"),g=c("studio-name"),B=c("row-actions-cell"),E=c("table-info");return l(),o("div",Be,[m("div",Ee,[t.isLoading?r("",!0):(l(),o("table",Ve,[m("thead",we,[m("tr",null,[m("th",Ce,a(e.$t("people.list.name")),1),t.isBots?r("",!0):(l(),o("th",De,a(e.$t("people.list.email")),1)),t.isBots?r("",!0):(l(),o("th",Te,a(e.$t("people.list.phone")),1)),t.isBots?(l(),o("th",Ue,a(e.$t("people.list.expiration")),1)):r("",!0),m("th",Fe,a(e.$t("people.list.role")),1),m("th",Ae,a(e.$t("people.list.departments")),1),t.isBots?r("",!0):(l(),o("th",Me,a(e.$t("people.list.studio")),1)),t.isBots?r("",!0):(l(),o("th",Le,a(e.$t("people.list.contract")),1)),t.isBots?r("",!0):(l(),o("th",Oe,a(e.$t("people.list.position")),1)),t.isBots?r("",!0):(l(),o("th",Ne,a(e.$t("people.list.seniority")),1)),t.isBots?r("",!0):(l(),o("th",Se,a(e.$t("people.fields.daily_salary")),1)),i[2]||(i[2]=m("th",{scope:"col",class:"actions"},null,-1))])]),t.entries.length>0?(l(),o("tbody",{key:0,class:"datatable-body",onMousedown:i[0]||(i[0]=(...s)=>e.startBrowsing&&e.startBrowsing(...s)),onTouchstart:i[1]||(i[1]=(...s)=>e.startBrowsing&&e.startBrowsing(...s))},[(l(!0),o(v,null,T(t.entries,s=>(l(),o("tr",{key:s.id,class:"datatable-row"},[f(b,{class:"name datatable-row-header",person:s},null,8,["person"]),t.isBots?r("",!0):(l(),o("td",xe,a(s.email),1)),t.isBots?r("",!0):(l(),o("td",Ie,a(s.phone),1)),t.isBots?(l(),o("td",{key:2,class:h(["expiration",{error:d.isExpired(s.expiration_date),warning:d.isSoonExpired(s.expiration_date)}])},[k(a(s.expiration_date)+" ",1),f(y,{class:"icon mr05"})],2)):r("",!0),m("td",ze,a(e.$t(`people.role.${s.role}`)),1),f(u,{class:"departments",departments:s.departments},null,8,["departments"]),t.isBots?r("",!0):(l(),o("td",Pe,[s.studio?(l(),p(g,{key:0,studio:s.studio},null,8,["studio"])):r("",!0)])),t.isBots?r("",!0):(l(),o("td",je,a(e.$t(`people.contract.${s.contract_type}`)),1)),t.isBots?r("",!0):(l(),o("td",Re,a(s.position?e.$t(`people.position.${s.position}`):""),1)),t.isBots?r("",!0):(l(),o("td",qe,a(s.seniority?e.$t(`people.seniority.${s.seniority}`):""),1)),t.isBots?r("",!0):(l(),o("td",Je,a(s.daily_salary),1)),e.isCurrentUserAdmin?(l(),p(B,{key:8,class:"datatable-row-footer","hide-avatar":!s.active,"hide-change-password":t.isBots||!s.active,"hide-delete":s.active,"hide-refresh":!t.isBots||!s.active,onAvatarClicked:_=>e.$emit("avatar-clicked",s),onChangePasswordClicked:_=>e.$emit("change-password-clicked",s),onEditClicked:_=>e.$emit("edit-clicked",s),onRefreshClicked:_=>e.$emit("refresh-clicked",s),onDeleteClicked:_=>e.$emit("delete-clicked",s)},null,8,["hide-avatar","hide-change-password","hide-delete","hide-refresh","onAvatarClicked","onChangePasswordClicked","onEditClicked","onRefreshClicked","onDeleteClicked"])):(l(),o("td",We))]))),128))],32)):r("",!0)]))],512),f(E,{"is-loading":t.isLoading,"is-error":t.isError},null,8,["is-loading","is-error"]),t.isLoading?r("",!0):(l(),o("p",Ze,a(d.nbUsersDetails),1))])}const tt=V(ge,[["render",Ge],["__scopeId","data-v-38046e94"]]);export{et as E,tt as P,$e as a};
//# sourceMappingURL=PeopleList-G8wqKM7A.js.map
