import{_,r as n,o as c,c as u,d as i,t as m,F as v,e as E,H as C,f as r,M as T,I as B,h as p,g as w,n as y,a as $,b as F}from"./index-DF-DoQlt.js";import{B as D}from"./BooleanCell-c9e_U1nn.js";import{R as x}from"./RowActionsCell-DR7b8Q1u.js";import{T as V}from"./TableInfo-D6xnVb4C.js";import{D as L}from"./DeleteModal-DwXK5r5w.js";import{B as N}from"./BooleanField-r8LThAuD.js";import{C as M}from"./ComboboxBoolean-DT116Lfu.js";import{F as S}from"./FileUpload-GCzHM4-i.js";import{M as U}from"./ModalFooter-Chk0SGv-.js";import{T as I}from"./TextField-BKWlN2Ov.js";import{L as R}from"./ListPageHeader-G9LHDILe.js";import{R as q}from"./RouteTabs-9ZMuefrE.js";import"./check-CO1MD15r.js";import"./trash-DWKk5Pv9.js";import"./refresh-cw-CYYYI9XK.js";import"./Combobox-A6pnhVs3.js";import"./PageTitle-CtScP8aV.js";const A={name:"background-list",props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{BooleanCell:D,RowActionsCell:x,TableInfo:V},emits:["delete-clicked","edit-clicked"]},H={class:"data-list"},j={class:"datatable-wrapper"},z={class:"datatable"},G={class:"datatable-head"},K={scope:"col",class:"name"},O={scope:"col",class:"is-default"},P={class:"datatable-body"},J={class:"name"},Q={class:"flexrow"},W=["href"],X=["src","alt"],Y={class:"has-text-centered"};function Z(e,t,s,k,o,l){const f=n("boolean-cell"),b=n("row-actions-cell"),h=n("table-info");return c(),u("div",H,[i("div",j,[i("table",z,[i("thead",G,[i("tr",null,[i("th",K,m(e.$t("backgrounds.fields.name")),1),i("th",O,m(e.$t("backgrounds.fields.is_default")),1),t[0]||(t[0]=i("th",{scope:"col",class:"actions"},null,-1))])]),i("tbody",P,[(c(!0),u(v,null,E(s.entries,a=>(c(),u("tr",{class:"datatable-row",key:a.id},[i("td",J,[i("span",Q,[i("a",{href:a.url,target:"_blank",class:"thumbnail-wrapper thumbnail-picture entity-thumbnail flexrow-item"},[i("img",{src:a.thumbnail,alt:a.name,width:"100",height:"67"},null,8,X)],8,W),C(" "+m(a.name),1)])]),r(f,{class:"is-default",value:a.is_default},null,8,["value"]),r(b,{"hide-delete":a.is_default===!0,onEditClicked:g=>e.$emit("edit-clicked",a),onDeleteClicked:g=>e.$emit("delete-clicked",a)},null,8,["hide-delete","onEditClicked","onDeleteClicked"])]))),128))])])]),r(h,{"is-loading":s.isLoading,"is-error":s.isError},null,8,["is-loading","is-error"]),i("p",Y,m(s.entries.length)+" "+m(e.$tc("backgrounds.number",s.entries.length)),1)])}const ee=_(A,[["render",Z],["__scopeId","data-v-1450c13a"]]),te={name:"edit-background-modal",mixins:[T],components:{BooleanField:N,ComboboxBoolean:M,FileUpload:S,ModalFooter:U,TextField:I},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},backgroundToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{file:null,name:"",is_default:"false",archived:"false"}}},computed:{isEditing(){return this.backgroundToEdit?.id}},methods:{confirmClicked(){if(!(!this.isEditing&&!this.form.file)){if(!this.form.name){this.$refs.nameField.focus();return}this.$emit("confirm",{...this.form,is_default:this.form.is_default==="true",archived:this.form.archived==="true"})}},onFileSelected(e){const t=e.get("file");this.form.file=e,this.form.name.length||(this.form.name=t.name.slice(0,-4)),this.$nextTick(()=>{this.$refs.nameField?.focus()})},resetForm(){this.backgroundToEdit&&(this.form={file:null,name:this.backgroundToEdit.name||"",is_default:String(this.backgroundToEdit.is_default||!1),archived:String(this.backgroundToEdit.archived||!1)},this.$refs.fileUpload?.reset())}},watch:{backgroundToEdit(){this.resetForm()},active(){this.active&&this.resetForm()}}},oe={class:"modal-content"},ie={class:"box"},le={key:0,class:"title"},se={key:1,class:"title"},ae={key:0,class:"field"},ne={class:"label"};function re(e,t,s,k,o,l){const f=n("file-upload"),b=n("text-field"),h=n("boolean-field"),a=n("combobox-boolean"),g=n("modal-footer");return c(),u("div",{class:y({modal:!0,"is-active":s.active})},[i("div",{class:"modal-background",onClick:t[0]||(t[0]=d=>e.$emit("cancel"))}),i("div",oe,[i("div",ie,[l.isEditing?(c(),u("h1",le,m(e.$t("backgrounds.edit_background"))+" "+m(s.backgroundToEdit.name),1)):(c(),u("h1",se,m(e.$t("backgrounds.new_background")),1)),i("form",{onSubmit:t[4]||(t[4]=B(()=>{},["prevent"]))},[l.isEditing?p("",!0):(c(),u("div",ae,[i("label",ne,m(e.$t("backgrounds.fields.file")),1),r(f,{ref:"fileUpload",label:e.$t("main.select_file"),accept:".hdr","is-primary":!1,onFileselected:l.onFileSelected},null,8,["label","onFileselected"])])),r(b,{ref:"nameField","input-class":"task-status-name",label:e.$t("backgrounds.fields.name"),maxlength:40,onEnter:l.confirmClicked,modelValue:o.form.name,"onUpdate:modelValue":t[1]||(t[1]=d=>o.form.name=d),modelModifiers:{trim:!0}},null,8,["label","onEnter","modelValue"]),r(h,{"is-field":"",label:e.$t("backgrounds.fields.is_default"),onEnter:l.confirmClicked,modelValue:o.form.is_default,"onUpdate:modelValue":t[2]||(t[2]=d=>o.form.is_default=d)},null,8,["label","onEnter","modelValue"]),l.isEditing?(c(),w(a,{key:1,label:e.$t("main.archived"),onEnter:l.confirmClicked,modelValue:o.form.archived,"onUpdate:modelValue":t[3]||(t[3]=d=>o.form.archived=d)},null,8,["label","onEnter","modelValue"])):p("",!0)],32),r(g,{"error-text":e.$t("backgrounds.create_error"),"is-error":s.isError,"is-loading":s.isLoading,onConfirm:l.confirmClicked,onCancel:t[5]||(t[5]=d=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const de=_(te,[["render",re],["__scopeId","data-v-f5554bdd"]]),ce={name:"backgrounds",components:{BackgroundList:ee,DeleteModal:L,EditBackgroundModal:de,ListPageHeader:R,RouteTabs:q},data(){return{activeTab:"active",backgroundToEdit:{},backgroundToDelete:{},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active"},computed:{...F(["archivedBackgrounds","backgrounds"]),backgroundsList(){return this.activeTab==="active"?this.backgrounds:this.archivedBackgrounds}},methods:{...$(["deleteBackground"]),confirmEditBackground(e){const t=!this.backgroundToEdit?.id;let s="newBackground";t||(s="saveBackground",e.id=this.backgroundToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(s,e).then(()=>{this.modals.edit=!1}).catch(k=>{console.error(k),this.errors.edit=!0}).finally(()=>{this.loading.edit=!1})},confirmDeleteBackground(){this.loading.del=!0,this.errors.del=!1,this.deleteBackground(this.backgroundToDelete).then(()=>{this.modals.del=!1}).catch(e=>{console.error(e),this.errors.del=!0}).finally(()=>{this.loading.del=!1})},deleteText(){const e=this.backgroundToDelete;return e?this.$t("backgrounds.delete_text",{name:e.name}):""},onNewClicked(){this.backgroundToEdit={},this.modals.edit=!0},onEditClicked(e){this.backgroundToEdit=e,this.modals.edit=!0},onDeleteClicked(e){this.backgroundToDelete=e,this.modals.del=!0}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("backgrounds.title")} - Kitsu`}}},me={class:"backgrounds page fixed-page"};function ue(e,t,s,k,o,l){const f=n("list-page-header"),b=n("route-tabs"),h=n("background-list"),a=n("edit-background-modal"),g=n("delete-modal");return c(),u("div",me,[r(f,{title:e.$t("backgrounds.library_title"),"new-entry-label":e.$t("backgrounds.new_background"),"is-exportable":!1,onNewClicked:l.onNewClicked},null,8,["title","new-entry-label","onNewClicked"]),r(b,{class:"mt2","active-tab":o.activeTab,tabs:o.tabs},null,8,["active-tab","tabs"]),r(h,{entries:l.backgroundsList,"is-loading":o.loading.list,"is-error":o.errors.list,onEditClicked:l.onEditClicked,onDeleteClicked:l.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),r(a,{active:o.modals.edit,"is-loading":o.loading.edit,"is-error":o.errors.edit,"background-to-edit":o.backgroundToEdit,onCancel:t[0]||(t[0]=d=>o.modals.edit=!1),onConfirm:l.confirmEditBackground},null,8,["active","is-loading","is-error","background-to-edit","onConfirm"]),r(g,{active:o.modals.del,"is-loading":o.loading.del,"is-error":o.errors.del,text:l.deleteText(),"error-text":e.$t("backgrounds.delete_error"),onCancel:t[1]||(t[1]=d=>o.modals.del=!1),onConfirm:l.confirmDeleteBackground},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const xe=_(ce,[["render",ue]]);export{xe as default};
//# sourceMappingURL=Backgrounds-DUABiLI-.js.map
