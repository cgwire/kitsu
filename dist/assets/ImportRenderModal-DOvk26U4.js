import{F}from"./FileUpload-Cng9V_As.js";import{_ as w,M as E,r as v,o as l,c as n,d as t,t as i,H as h,F as u,e as m,h as $,n as g,k as b,v as C,f as _,a4 as T,B,b as O}from"./index-Dw-uod2x.js";import{M as V}from"./ModalFooter-Dmgqo0ae.js";import{C as A}from"./Combobox-Z_ENhFXj.js";import{C as S}from"./Checkbox-in6UcoC-.js";const U={name:"import-modal",mixins:[E],components:{FileUpload:F,ModalFooter:V},emits:["cancel","confirm"],data(){return{formData:null,pastedCode:"",activeTab:"file",tabs:[{id:"file",name:this.$t("main.csv.tab_select_file")},{id:"text",name:this.$t("main.csv.tab_paste_code")}]}},props:{active:{type:Boolean,default:!1},columns:{type:Array,default:()=>[]},optionalColumns:{type:Array,default:()=>[]},genericColumns:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1}},computed:{isValid(){return this.activeTab==="file"&&this.formData||this.activeTab==="text"&&this.pastedCode},pasteAreaPlaceholder(){return this.columns.join(";")}},methods:{onFileSelected(e){this.formData=e},onConfirmClicked(){const e=this.activeTab,s=e==="file"?this.formData:this.pastedCode;this.$emit("confirm",s,e)},reset(){this.$refs.inputFile.reset(),this.activeTab="file",this.formData=null,this.pastedCode=""}},watch:{active(){this.reset()}}},q={class:"modal-content"},R={class:"box"},I={class:"title"},L={key:0,class:"mb1"},N={key:1,class:"mb1"},j={key:2,class:"mb1"},P={class:"tabs"},z=["onClick"],G=["placeholder"];function H(e,s,o,y,c,a){const k=v("file-upload"),D=v("modal-footer");return l(),n("div",{class:g({modal:!0,"is-active":o.active})},[t("div",{class:"modal-background",onClick:s[0]||(s[0]=d=>e.$emit("cancel"))}),t("div",q,[t("div",R,[t("h1",I,i(e.$t("main.csv.import_title")),1),o.columns.length>0?(l(),n("div",L,[h(i(e.$t("main.csv.required_fields"))+" ",1),t("ul",null,[(l(!0),n(u,null,m(o.columns,d=>(l(),n("li",{key:d},i(d),1))),128))])])):$("",!0),o.optionalColumns.length>0?(l(),n("div",N,[h(i(e.$t("main.csv.optional_fields"))+" ",1),t("ul",null,[(l(!0),n(u,null,m(o.optionalColumns,d=>(l(),n("li",{key:d},i(d),1))),128))])])):$("",!0),o.genericColumns.length>0?(l(),n("div",j,[h(i(e.$t("main.csv.generic_fields"))+" ",1),t("ul",null,[(l(!0),n(u,null,m(o.genericColumns,d=>(l(),n("li",{key:d},i(d),1))),128))])])):$("",!0),t("div",P,[t("ul",null,[(l(!0),n(u,null,m(c.tabs,d=>(l(),n("li",{class:g({"is-active":c.activeTab===d.id}),key:`tab-${d.id}`},[t("a",{onClick:M=>c.activeTab=d.id},i(d.name),9,z)],2))),128))])]),b(t("div",null,[t("p",null,i(e.$t("main.csv.select_file")),1),_(k,{onFileselected:a.onFileSelected,label:e.$t("main.csv.upload_file"),ref:"inputFile"},null,8,["onFileselected","label"])],512),[[C,c.activeTab==="file"]]),b(t("div",null,[t("p",null,i(e.$t("main.csv.paste_code")),1),b(t("textarea",{class:"paste-area",placeholder:a.pasteAreaPlaceholder,"onUpdate:modelValue":s[1]||(s[1]=d=>c.pastedCode=d)},null,8,G),[[T,c.pastedCode]])],512),[[C,c.activeTab==="text"]]),_(D,{"confirm-label":e.$t("main.csv.preview"),"error-text":e.$t("main.csv.error_upload"),"is-loading":o.isLoading,"is-disabled":!a.isValid,"is-error":o.isError,onConfirm:a.onConfirmClicked,onCancel:s[2]||(s[2]=d=>e.$emit("cancel"))},null,8,["confirm-label","error-text","is-loading","is-disabled","is-error","onConfirm"])])])],2)}const ye=w(U,[["render",H],["__scopeId","data-v-26155646"]]),J={name:"import-render-modal",mixins:[E],components:{ButtonSimple:B,Combobox:A,Checkbox:S,ModalFooter:V},emits:["cancel","confirm","reupload"],data(){return{duplicates:[],formData:null,updateData:!1}},props:{active:{type:Boolean,default:!1},parsedCsv:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},dataMatchers:{type:Array,default:()=>[]},database:{type:Object,default:()=>{}},disableUpdate:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},importError:{type:Error,default:null}},mounted(){this.formData=null},computed:{...O(["assetMetadataDescriptors","shotMetadataDescriptors","editMetadataDescriptors"]),columnsRequired(){return this.parsedCsv.length!==0?this.columns.filter(e=>!this.parsedCsv[0].includes(e)&&this.dataMatchers.includes(e)):[]},columnsOptional(){return this.parsedCsv.length!==0?this.columns.filter(e=>!this.parsedCsv[0].includes(e)&&!this.dataMatchers.includes(e)):[]},metadataDescriptors(){return this.$route.path.indexOf("assets")>0?this.assetMetadataDescriptors:this.$route.path.indexOf("shots")>0?this.shotMetadataDescriptors:this.$route.path.indexOf("edits")>0?this.editMetadataDescriptors:[]},columnsAllowed(){const e=[...this.columns];return this.metadataDescriptors.forEach(s=>{e.includes(s.name)||e.push(s.name)}),e},columnOptions(){const e=[{label:this.$t("main.csv.choose"),value:this.$t("main.csv.unknown")}];return this.columnsAllowed.forEach(s=>{e.push({label:s,value:s})}),e},columnSelect(){return this.parsedCsv[0]},indexMatchers(){const e=[];return this.dataMatchers.forEach(s=>{e.push(this.parsedCsv[0].indexOf(s))}),e},errorText(){let e=this.$t("main.csv.error_upload");if(this.importError&&this.importError.status===400){const s=this.importError.response;e+=` (line: ${s.body.line_number}) ${s.body.message}`}return e}},methods:{onConfirmClicked(){this.$emit("confirm",this.parsedCsv,this.updateData)},onReupload(){this.$emit("reupload")},stateColumn(e){if(!this.columnsAllowed.includes(e))return"ignored"},checkForDuplicate(){const e=this.$t("main.csv.unknown");this.duplicates=this.columnSelect.filter((s,o)=>this.columnSelect.indexOf(s)!==o).filter(s=>s!==e)},isDuplicated(e){if(this.duplicates.includes(this.columnSelect[e]))return!0},existingData(e){const s=this.parsedCsv[e+1],o=this.database,y=this.indexMatchers;let c="";return y.forEach(a=>{c+=s[a]}),o[c]}}},K={class:"modal-content"},Q={class:"box content"},W={class:"title"},X={class:"description"},Y={class:"legend-title"},Z={class:"legend-title"},ee={class:"flexrow legends"},te={class:"legend flexrow-item"},se={class:"legend-definition"},le={class:"legend-definition"},ne={class:"legend-definition"},ie={class:"legend-definition"},ae={class:"legend flexrow-item"},oe={class:"legend-definition"},re={class:"legend-definition"},de={class:"legend-definition"},ce={class:"render-container"},ue={class:"render"},me={class:"render-headers"},he={class:"render-select"},fe={class:"render-footer"};function pe(e,s,o,y,c,a){const k=v("checkbox"),D=v("combobox"),d=v("button-simple"),M=v("modal-footer");return l(),n("div",{class:g({modal:!0,"is-active":o.active})},[t("div",{class:"modal-background",onClick:s[0]||(s[0]=r=>e.$emit("cancel"))}),t("div",K,[t("div",Q,[t("h1",W,i(e.$t("main.csv.preview_title")),1),t("p",null,i(e.$t("main.csv.preview_required")),1),t("div",X,[b(t("div",null,[t("h2",Y,i(e.$t("main.csv.options.title")),1),_(k,{toggle:!0,label:e.$t("main.csv.options.update"),modelValue:c.updateData,"onUpdate:modelValue":s[1]||(s[1]=r=>c.updateData=r)},null,8,["label","modelValue"])],512),[[C,!o.disableUpdate]]),t("h3",Z,i(e.$t("main.csv.legend")),1),t("div",ee,[t("ul",te,[t("li",se,[s[3]||(s[3]=t("span",{class:"legend-term"},null,-1)),h(" "+i(e.$t("main.csv.legend_ok")),1)]),t("li",le,[s[4]||(s[4]=t("span",{class:"legend-term ignored"},null,-1)),h(" "+i(e.$t("main.csv.legend_ignored")),1)]),t("li",ne,[s[5]||(s[5]=t("span",{class:"legend-term missing"},null,-1)),h(" "+i(e.$t("main.csv.legend_missing")),1)]),t("li",ie,[s[6]||(s[6]=t("span",{class:"legend-term missing-optional"},null,-1)),h(" "+i(e.$t("main.csv.legend_missing_optional")),1)])]),t("ul",ae,[t("li",oe,[s[7]||(s[7]=t("span",{class:"legend-term"},null,-1)),h(" "+i(e.$t("main.csv.legend_line_ok")),1)]),t("li",re,[s[8]||(s[8]=t("span",{class:"legend-term disabled"},null,-1)),h(" "+i(e.$t("main.csv.legend_disabled")),1)]),b(t("li",de,[s[9]||(s[9]=t("span",{class:"legend-term overwrite"},null,-1)),h(" "+i(e.$t("main.csv.legend_overwrite")),1)],512),[[C,!o.disableUpdate]])])])]),t("div",ce,[t("table",ue,[t("colgroup",null,[(l(!0),n(u,null,m(a.columnsRequired,r=>(l(),n("col",{key:`col-missing-${r}`,class:"missing"}))),128)),(l(!0),n(u,null,m(o.parsedCsv[0],(r,f)=>(l(),n("col",{key:`col-${f}`,class:g(a.stateColumn(r))},null,2))),128)),(l(!0),n(u,null,m(a.columnsOptional,r=>(l(),n("col",{key:`col-missing-${r}`,class:"missing-optional"}))),128))]),t("thead",null,[t("tr",me,[(l(!0),n(u,null,m(a.columnsRequired,r=>(l(),n("th",{class:"required-header",key:`header-${r}`},i(r),1))),128)),(l(!0),n(u,null,m(o.parsedCsv[0],(r,f)=>(l(),n("th",{key:`header-${f}`},[t("div",he,[_(D,{options:a.columnOptions,value:r,error:a.isDuplicated(f),modelValue:a.columnSelect[f],"onUpdate:modelValue":[p=>a.columnSelect[f]=p,a.checkForDuplicate]},null,8,["options","value","error","modelValue","onUpdate:modelValue"])]),h(" "+i(r||"-"),1)]))),128)),(l(!0),n(u,null,m(a.columnsOptional,r=>(l(),n("th",{class:"optional-header",key:`header-${r}`},i(r),1))),128))])]),t("tbody",null,[(l(!0),n(u,null,m(o.parsedCsv.slice(1).filter(r=>r.length>1),(r,f)=>(l(),n("tr",{class:g({overwrite:c.updateData&&a.existingData(f),disabled:!c.updateData&&a.existingData(f)}),key:`line-${f}`},[(l(!0),n(u,null,m(a.columnsRequired,p=>(l(),n("td",{key:`cell-${p}`},i("-")))),128)),(l(!0),n(u,null,m(r,(p,x)=>(l(),n("td",{key:`cell-${x}`},i(p||"-"),1))),128)),(l(!0),n(u,null,m(a.columnsOptional,p=>(l(),n("td",{key:`cell-${p}`},i("-")))),128))],2))),128))])])]),t("div",fe,[_(d,{text:e.$t("main.csv.preview_reupload"),onClick:a.onReupload},null,8,["text","onClick"]),_(M,{"error-text":a.errorText,"is-loading":o.isLoading,"is-disabled":c.formData===void 0,"is-error":o.isError,onConfirm:a.onConfirmClicked,onCancel:s[2]||(s[2]=r=>e.$emit("cancel"))},null,8,["error-text","is-loading","is-disabled","is-error","onConfirm"])])])])],2)}const ke=w(J,[["render",pe],["__scopeId","data-v-dc5fcf1b"]]);export{ke as I,ye as a};
//# sourceMappingURL=ImportRenderModal-DOvk26U4.js.map
