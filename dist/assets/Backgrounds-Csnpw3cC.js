import{_,a1 as p,T as E,r as n,o as c,c as m,e as i,t as u,F as C,g as T,a3 as B,f as d,a4 as w,ad as $,a5 as y,ae as F,a6 as x,a8 as D,a9 as V,d as v,l as L,p as N,aa as M,m as S,b as U}from"./index-ip1P4Oag.js";import{B as A}from"./BooleanCell-DnNEOzZP.js";import{L as I}from"./ListPageHeader-B1Eqdlzh.js";import{R}from"./RouteTabs-CpqfUirB.js";const q={name:"background-list",props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{BooleanCell:A,RowActionsCell:p,TableInfo:E},emits:["delete-clicked","edit-clicked"]},j={class:"data-list"},z={class:"datatable-wrapper"},G={class:"datatable"},H={class:"datatable-head"},K={scope:"col",class:"name"},O={scope:"col",class:"is-default"},P={class:"datatable-body"},J={class:"name"},Q={class:"flexrow"},W=["href"],X=["src","alt"],Y={class:"has-text-centered"};function Z(e,t,a,f,o,l){const b=n("boolean-cell"),g=n("row-actions-cell"),h=n("table-info");return c(),m("div",j,[i("div",z,[i("table",G,[i("thead",H,[i("tr",null,[i("th",K,u(e.$t("backgrounds.fields.name")),1),i("th",O,u(e.$t("backgrounds.fields.is_default")),1),t[0]||(t[0]=i("th",{scope:"col",class:"actions"},null,-1))])]),i("tbody",P,[(c(!0),m(C,null,T(a.entries,s=>(c(),m("tr",{class:"datatable-row",key:s.id},[i("td",J,[i("span",Q,[i("a",{href:s.url,target:"_blank",class:"thumbnail-wrapper thumbnail-picture entity-thumbnail flexrow-item"},[i("img",{src:s.thumbnail,alt:s.name,width:"100",height:"67"},null,8,X)],8,W),B(" "+u(s.name),1)])]),d(b,{class:"is-default",value:s.is_default},null,8,["value"]),d(g,{"entry-id":s.id,"hide-delete":s.is_default===!0,onEditClicked:k=>e.$emit("edit-clicked",s),onDeleteClicked:k=>e.$emit("delete-clicked",s)},null,8,["entry-id","hide-delete","onEditClicked","onDeleteClicked"])]))),128))])])]),d(h,{"is-loading":a.isLoading,"is-error":a.isError},null,8,["is-loading","is-error"]),i("p",Y,u(a.entries.length)+" "+u(e.$tc("backgrounds.number",a.entries.length)),1)])}const ee=_(q,[["render",Z],["__scopeId","data-v-1cdf3016"]]),te={name:"edit-background-modal",mixins:[w],components:{BooleanField:$,ComboboxBoolean:y,FileUpload:F,ModalFooter:x,TextField:D},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},backgroundToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{file:null,name:"",is_default:"false",archived:"false"}}},computed:{isEditing(){var e;return(e=this.backgroundToEdit)==null?void 0:e.id}},methods:{confirmClicked(){if(!(!this.isEditing&&!this.form.file)){if(!this.form.name){this.$refs.nameField.focus();return}this.$emit("confirm",{...this.form,is_default:this.form.is_default==="true",archived:this.form.archived==="true"})}},onFileSelected(e){const t=e.get("file");this.form.file=e,this.form.name.length||(this.form.name=t.name.slice(0,-4)),this.$nextTick(()=>{this.$refs.nameField.focus()})},resetForm(){var e;this.backgroundToEdit&&(this.form={file:null,name:this.backgroundToEdit.name||"",is_default:String(this.backgroundToEdit.is_default||!1),archived:String(this.backgroundToEdit.archived||!1)},(e=this.$refs.fileUpload)==null||e.reset())}},watch:{backgroundToEdit(){this.resetForm()},active(){this.active&&this.resetForm()}}},oe={class:"modal-content"},ie={class:"box"},le={key:0,class:"title"},ae={key:1,class:"title"},se={key:0,class:"field"},ne={class:"label"};function de(e,t,a,f,o,l){const b=n("file-upload"),g=n("text-field"),h=n("boolean-field"),s=n("combobox-boolean"),k=n("modal-footer");return c(),m("div",{class:N({modal:!0,"is-active":a.active})},[i("div",{class:"modal-background",onClick:t[0]||(t[0]=r=>e.$emit("cancel"))}),i("div",oe,[i("div",ie,[l.isEditing?(c(),m("h1",le,u(e.$t("backgrounds.edit_background"))+" "+u(a.backgroundToEdit.name),1)):(c(),m("h1",ae,u(e.$t("backgrounds.new_background")),1)),i("form",{onSubmit:t[4]||(t[4]=V(()=>{},["prevent"]))},[l.isEditing?v("",!0):(c(),m("div",se,[i("label",ne,u(e.$t("backgrounds.fields.file")),1),d(b,{ref:"fileUpload",label:e.$t("main.select_file"),accept:".hdr","is-primary":!1,onFileselected:l.onFileSelected},null,8,["label","onFileselected"])])),d(g,{ref:"nameField","input-class":"task-status-name",label:e.$t("backgrounds.fields.name"),maxlength:40,onEnter:l.confirmClicked,modelValue:o.form.name,"onUpdate:modelValue":t[1]||(t[1]=r=>o.form.name=r),modelModifiers:{trim:!0}},null,8,["label","onEnter","modelValue"]),d(h,{"is-field":"",label:e.$t("backgrounds.fields.is_default"),onEnter:l.confirmClicked,modelValue:o.form.is_default,"onUpdate:modelValue":t[2]||(t[2]=r=>o.form.is_default=r)},null,8,["label","onEnter","modelValue"]),l.isEditing?(c(),L(s,{key:1,label:e.$t("main.archived"),onEnter:l.confirmClicked,modelValue:o.form.archived,"onUpdate:modelValue":t[3]||(t[3]=r=>o.form.archived=r)},null,8,["label","onEnter","modelValue"])):v("",!0)],32),d(k,{"error-text":e.$t("backgrounds.create_error"),"is-error":a.isError,"is-loading":a.isLoading,onConfirm:l.confirmClicked,onCancel:t[5]||(t[5]=r=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const re=_(te,[["render",de],["__scopeId","data-v-ad2abf5d"]]),ce={name:"backgrounds",components:{BackgroundList:ee,DeleteModal:M,EditBackgroundModal:re,ListPageHeader:I,RouteTabs:R},data(){return{activeTab:"active",backgroundToEdit:{},backgroundToDelete:{},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active"},computed:{...S(["archivedBackgrounds","backgrounds"]),backgroundsList(){return this.activeTab==="active"?this.backgrounds:this.archivedBackgrounds}},methods:{...U(["deleteBackground"]),confirmEditBackground(e){var f;const t=!((f=this.backgroundToEdit)!=null&&f.id);let a="newBackground";t||(a="saveBackground",e.id=this.backgroundToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(a,e).then(()=>{this.modals.edit=!1}).catch(o=>{console.error(o),this.errors.edit=!0}).finally(()=>{this.loading.edit=!1})},confirmDeleteBackground(){this.loading.del=!0,this.errors.del=!1,this.deleteBackground(this.backgroundToDelete).then(()=>{this.modals.del=!1}).catch(e=>{console.error(e),this.errors.del=!0}).finally(()=>{this.loading.del=!1})},deleteText(){const e=this.backgroundToDelete;return e?this.$t("backgrounds.delete_text",{name:e.name}):""},onNewClicked(){this.backgroundToEdit={},this.modals.edit=!0},onEditClicked(e){this.backgroundToEdit=e,this.modals.edit=!0},onDeleteClicked(e){this.backgroundToDelete=e,this.modals.del=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("backgrounds.title")} - Kitsu`}}},ue={class:"backgrounds page fixed-page"};function me(e,t,a,f,o,l){const b=n("list-page-header"),g=n("route-tabs"),h=n("background-list"),s=n("edit-background-modal"),k=n("delete-modal");return c(),m("div",ue,[d(b,{title:e.$t("backgrounds.title"),"new-entry-label":e.$t("backgrounds.new_background"),"is-exportable":!1,onNewClicked:l.onNewClicked},null,8,["title","new-entry-label","onNewClicked"]),d(g,{class:"mt2","active-tab":o.activeTab,tabs:o.tabs,"route-name":"backgrounds"},null,8,["active-tab","tabs"]),d(h,{entries:l.backgroundsList,"is-loading":o.loading.list,"is-error":o.errors.list,onEditClicked:l.onEditClicked,onDeleteClicked:l.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),d(s,{active:o.modals.edit,"is-loading":o.loading.edit,"is-error":o.errors.edit,"background-to-edit":o.backgroundToEdit,onCancel:t[0]||(t[0]=r=>o.modals.edit=!1),onConfirm:l.confirmEditBackground},null,8,["active","is-loading","is-error","background-to-edit","onConfirm"]),d(k,{active:o.modals.del,"is-loading":o.loading.del,"is-error":o.errors.del,text:l.deleteText(),"error-text":e.$t("backgrounds.delete_error"),onCancel:t[1]||(t[1]=r=>o.modals.del=!1),onConfirm:l.confirmDeleteBackground},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const ke=_(ce,[["render",me]]);export{ke as default};
//# sourceMappingURL=Backgrounds-Csnpw3cC.js.map
