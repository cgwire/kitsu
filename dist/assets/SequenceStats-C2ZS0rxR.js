import{_ as b,a as k,T as M,as as L,by as P,bz as T,r as h,c as l,o,e as n,f as u,d as S,t as d,F as p,g,G as q,k as v,w as E,a8 as V,bm as w,m as D,aw as O,S as F,b as B,B as Q,s as U,aC as x,ab as N,ac as A}from"./index-GLYNEfD5.js";import{S as R}from"./StatsCell-PApn2p9k.js";const Y={name:"sequence-stats-list",mixins:[L],components:{StatsCell:R,TableInfo:M},props:{countMode:{type:String,default:"count"},displayMode:{type:String,default:"pie"},entries:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},sequenceStats:{type:Object,default:()=>{}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]}},computed:{...k(["currentProduction","currentEpisode","displayedSequencesLength","isCurrentUserClient","isTVShow","sequenceSearchText","taskTypeMap"]),entryStats(){return this.entries.filter(e=>this.isEntryStats(e.id))},isEmptyList(){return this.entries&&this.entries.length===0&&!this.isLoading&&!this.isError&&(!this.sequenceSearchText||this.sequenceSearchText.length===0)}},methods:{chartColors(e,t){return T(this.sequenceStats,e,t)},chartData(e,t,i="count"){return P(this.sequenceStats,e,t,i)},isStats(e,t){return this.sequenceStats[e]&&this.sequenceStats[e][t]},isEntryStats(e){if(!this.sequenceStats[e]&&this.sequenceSearchText)return!1;if(!this.sequenceStats[e])return!0;let t=!1;return Object.keys(this.sequenceStats[e]).forEach(i=>{t=t||this.sequenceStats[e][i]}),t},editPath(e){return this.getPath("edit-sequence",e)},deletePath(e){return this.getPath("delete-sequence",e)},taskTypePath(e){const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:e,type:"shots"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t},getPath(e,t){const i={name:e,params:{production_id:this.currentProduction.id}};return this.isTVShow&&this.currentEpisode&&(i.name=`episode-${e}`,i.params.episode_id=this.currentEpisode.id),t&&(i.params.sequence_id=t),i}}},j={class:"data-list"},z={class:"datatable"},G={class:"datatable-head"},K={scope:"col",class:"validation"},H=["title"],J={key:0,class:"datatable-body"},W={key:0,class:"all-line datatable-row"},X={scope:"row",class:"name datatable-row-header"},Z={scope:"row",class:"name datatable-row-header"},I={key:1},$={key:0,class:"has-text-centered"},ee={class:"info"},te={key:1,class:"has-text-centered"},se={class:"info"},ae={key:2,class:"has-text-centered nb-sequences"};function ie(e,t,i,f,c,a){const _=h("router-link"),m=h("stats-cell"),y=h("table-info");return o(),l("div",j,[n("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:t[0]||(t[0]=(...s)=>e.onBodyScroll&&e.onBodyScroll(...s))},[n("table",z,[n("thead",G,[n("tr",null,[n("th",{scope:"col",class:"name datatable-row-header",ref:"th-sequence"},d(e.$t("shots.fields.sequence")),513),n("th",K,d(e.$t("main.all")),1),i.isLoading?S("",!0):(o(!0),l(p,{key:0},g(i.validationColumns,s=>(o(),l("th",{scope:"col",class:"validation validation-cell",key:s},[n("div",{class:"flexrow validation-content",style:q(e.getValidationStyle(s))},[e.isCurrentUserClient?(o(),l("span",{key:1,class:"flexrow-item ellipsis",title:e.taskTypeMap.get(s).name},d(e.taskTypeMap.get(s).name),9,H)):(o(),v(_,{key:0,class:"flexrow-item ellipsis",title:e.taskTypeMap.get(s).name,to:a.taskTypePath(s)},{default:E(()=>[V(d(e.taskTypeMap.get(s).name),1)]),_:2},1032,["title","to"]))],4)]))),128)),t[1]||(t[1]=n("th",{scope:"col",class:"actions"},null,-1))])]),i.isLoading?S("",!0):(o(),l("tbody",J,[i.showAll&&!a.isEmptyList?(o(),l("tr",W,[n("th",X,d(e.$t("sequences.all_sequences")),1),u(m,{class:"all-validation",colors:a.chartColors("all","all"),data:a.chartData("all","all"),"frames-data":a.chartData("all","all","frames"),"drawings-data":a.chartData("all","all","drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["colors","data","frames-data","drawings-data","count-mode","display-mode"]),(o(!0),l(p,null,g(i.validationColumns,s=>(o(),v(m,{style:q(e.getValidationStyle(s)),key:"all-"+s,colors:a.chartColors("all",s),data:a.chartData("all",s),"frames-data":a.chartData("all",s,"frames"),"drawings-data":a.chartData("all",s,"drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["style","colors","data","frames-data","drawings-data","count-mode","display-mode"]))),128)),t[2]||(t[2]=n("td",{class:"actions"},null,-1))])):S("",!0),(o(!0),l(p,null,g(a.entryStats,s=>(o(),l("tr",{class:"datatable-row",key:s.id},[n("td",Z,d(s.name),1),a.isStats(s.id,"all")?(o(),v(m,{key:0,colors:a.chartColors(s.id,"all"),data:a.chartData(s.id,"all"),"frames-data":a.chartData(s.id,"all","frames"),"drawings-data":a.chartData(s.id,"all","drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["colors","data","frames-data","drawings-data","count-mode","display-mode"])):(o(),l("td",I)),(o(!0),l(p,null,g(i.validationColumns,r=>(o(),l(p,{key:s.id+"-"+r},[a.isStats(s.id,r)?(o(),v(m,{key:s.id+r,style:q(e.getValidationStyle(r)),colors:a.chartColors(s.id,r),data:a.chartData(s.id,r),"frames-data":a.chartData(s.id,r,"frames"),"drawings-data":a.chartData(s.id,r,"drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["style","colors","data","frames-data","drawings-data","count-mode","display-mode"])):(o(),l("td",{key:1,style:q(e.getValidationStyle(r))},null,4))],64))),128)),t[3]||(t[3]=n("td",{class:"actions"},null,-1))]))),128))]))])],544),u(y,{"is-loading":i.isLoading,"is-error":i.isError},null,8,["is-loading","is-error"]),a.isEmptyList&&!e.isCurrentUserClient&&!i.isLoading?(o(),l("div",$,[t[4]||(t[4]=n("p",{class:"info"},[n("img",{src:w})],-1)),n("p",ee,d(e.$t("sequences.empty_list")),1)])):S("",!0),a.isEmptyList&&e.isCurrentUserClient&&!i.isLoading?(o(),l("div",te,[t[5]||(t[5]=n("p",{class:"info"},[n("img",{src:w})],-1)),n("p",se,d(e.$t("sequences.empty_list_client")),1)])):S("",!0),!a.isEmptyList&&!i.isLoading?(o(),l("p",ae,d(e.displayedSequencesLength)+" "+d(e.$tc("sequences.number",e.displayedSequencesLength)),1)):S("",!0)])}const oe=b(Y,[["render",ie],["__scopeId","data-v-ce2791e2"]]),ne={name:"sequence-stats",mixins:[U],components:{ButtonSimple:Q,Combobox:B,SearchField:F,SearchQueryList:O,SequenceStatsList:oe},data(){return{countMode:"count",displayMode:"pie",initialLoading:!0,countModeOptions:[{label:"shots",value:"count"},{label:"frames",value:"frames"}],displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}],loading:{savingSearch:!1}}},mounted(){this.setCountOptions(),this.loadShots(()=>{this.initSequences().then(()=>{this.initialLoading=!1,setTimeout(()=>{this.setSearchFromUrl(),this.onSearchChange()},100)}).catch(e=>console.error(e))})},computed:{...k(["currentEpisode","currentProduction","displayedSequences","isPaperProduction","isShotsLoading","isShotsLoadingError","isTVShow","searchSequenceFilters","sequenceMap","sequencesPath","sequenceStats","sequenceSearchText","sequenceSearchQueries","sequenceListScrollPosition","shotValidationColumns","taskTypeMap","taskStatusMap"]),searchField(){return this.$refs["sequence-search-field"]}},methods:{...D(["computeSequenceStats","initSequences","loadShots","removeSequenceSearch","saveSequenceSearch","setSequenceListScrollPosition","setSequenceStatsSearch"]),reloadData(){this.initialLoading=!0,this.loadShots(()=>{this.initialLoading=!1,this.computeSequenceStats()})},setDefaultListScrollPosition(){this.$refs["sequence-list"]?.setScrollPosition(this.sequenceListScrollPosition)},navigateToList(){this.$router.push(this.sequencesPath)},onSearchChange(){const e=this.$refs["sequence-search-field"]?.getValue();this.setSearchInUrl(),this.setSequenceStatsSearch(e)},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveSequenceSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeSequenceSearch(e).catch(console.error)},saveScrollPosition(e){this.setSequenceListScrollPosition(e)},exportStatisticsToCsv(){const e=[x().format("YYYYMMDD"),this.currentProduction.name,"sequences","statistics"];this.currentEpisode&&e.splice(2,0,this.currentEpisode.name);const t=N.slugify(e.join("_"));A.generateStatReports(t,this.sequenceStats,this.taskTypeMap,this.taskStatusMap,this.sequenceMap,this.countMode,this.currentProduction)},onFieldChanged({entry:e,fieldName:t,value:i}){const f={id:e.id};f[t]=i,this.editSequence(f)},setCountOptions(){this.isPaperProduction?this.countModeOptions=[{label:"shots",value:"count"},{label:"drawings",value:"drawings"}]:this.countModeOptions=[{label:"shots",value:"count"},{label:"frames",value:"frames"}],this.countMode=this.countModeOptions[0].value}},watch:{currentProduction(){this.$refs["sequence-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.setCountOptions(),this.isTVShow||this.loadShots(()=>{this.initSequences().catch(e=>console.error(e))})},currentEpisode(){this.isTVShow&&this.currentEpisode&&this.loadShots(()=>{this.initSequences().then(()=>{this.initialLoading=!1}).catch(e=>console.error(e))})},searchSequenceFilters:{deep:!0,handler(){this.computeSequenceStats()}},"$route.query.search"(e){this.searchField?.setValue(e),this.onSearchChange()}},head(){return this.isTVShow?{title:`${this.currentProduction?this.currentProduction.name:""} - ${this.currentEpisode?this.currentEpisode.name:""} | ${this.$t("sequences.title")} - Kitsu`}:{title:`${this.currentProduction?this.currentProduction.name:""} | ${this.$t("sequences.title")} - Kitsu`}}},le={class:"sequences page fixed-page"},re={class:"sequence-list-header page-header flexrow"},ce={class:"query-list mt1"};function de(e,t,i,f,c,a){const _=h("search-field"),m=h("combobox"),y=h("button-simple"),s=h("search-query-list"),r=h("sequence-stats-list");return o(),l("div",le,[n("div",re,[u(_,{class:"flexrow-item mt1",ref:"sequence-search-field","can-save":!0,onChange:a.onSearchChange,onSave:a.saveSearchQuery,placeholder:"ex: e01 s01 anim=wip"},null,8,["onChange","onSave"]),u(m,{class:"mb0 flexrow-item",label:e.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:c.displayModeOptions,modelValue:c.displayMode,"onUpdate:modelValue":t[0]||(t[0]=C=>c.displayMode=C)},null,8,["label","options","modelValue"]),u(m,{class:"mb0 flexrow-item",label:e.$t("statistics.count_mode"),"locale-key-prefix":"statistics.",options:c.countModeOptions,modelValue:c.countMode,"onUpdate:modelValue":t[1]||(t[1]=C=>c.countMode=C)},null,8,["label","options","modelValue"]),t[2]||(t[2]=n("span",{class:"filler"},null,-1)),u(y,{class:"flexrow-item",icon:"refresh",title:e.$t("main.reload"),onClick:a.reloadData},null,8,["title","onClick"]),u(y,{class:"flexrow-item",icon:"download",title:e.$t("main.csv.export_file"),onClick:a.exportStatisticsToCsv},null,8,["title","onClick"])]),n("div",ce,[u(s,{queries:e.sequenceSearchQueries,type:"sequenceStat",onRemoveSearch:a.removeSearchQuery},null,8,["queries","onRemoveSearch"])]),u(r,{ref:"sequence-list","count-mode":c.countMode,"display-mode":c.displayMode,entries:e.displayedSequences,"is-loading":e.isShotsLoading||c.initialLoading,"is-error":e.isShotsLoadingError,"validation-columns":e.shotValidationColumns,"sequence-stats":e.sequenceStats,"show-all":!e.sequenceSearchText,onFieldChanged:a.onFieldChanged,onScroll:a.saveScrollPosition},null,8,["count-mode","display-mode","entries","is-loading","is-error","validation-columns","sequence-stats","show-all","onFieldChanged","onScroll"])])}const me=b(ne,[["render",de],["__scopeId","data-v-24f487d2"]]);export{me as default};
//# sourceMappingURL=SequenceStats-C2ZS0rxR.js.map
