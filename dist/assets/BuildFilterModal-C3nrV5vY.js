import{b as I,_ as A,W as E,b8 as R,r as k,o as n,c as r,t as y,h as m,d as u,f as h,F as _,e as T,H as B,n as D,i as S,g as f,B as Q,M as N,b9 as M,ba as P,s as H,k as W,v as J}from"./index-C2m_IhNF.js";import{C as U}from"./Combobox-DQpIQydI.js";import{C as K}from"./ComboboxStatus-DYpCiml-.js";import{C as z}from"./ComboboxStyled-fscUNRmK.js";import{C as G}from"./ComboboxTaskType-CiBcPUsC.js";import{C as q}from"./ComboboxBoolean-DJwCfClJ.js";import{T as X}from"./TextField-p_HJuEKt.js";import{M as Y}from"./ModalFooter-BJ98b-60.js";import{P as Z}from"./PeopleField-CJ8IkJD1.js";const O={emits:["add-metadata","change-sort","delete-metadata","edit-metadata","metadata-changed"],computed:{...I(["isCurrentUserSupervisor","selectedAssets","selectedShots","selectedEdits","user"]),descriptorLength(){return this.shotMetadataDescriptors.length!==void 0?this.shotMetadataDescriptors.length:this.assetMetadataDescriptors.length!==void 0?this.assetMetadataDescriptors.length:this.editMetadataDescriptors.length!==void 0?this.editMetadataDescriptors.length:0}},methods:{onAddMetadataClicked(){this.$emit("add-metadata")},emitMetadataChanged(e,t,s){this.$emit("metadata-changed",{entry:e,descriptor:t,value:s})},onMetadataFieldChanged(e,t,s){let a;if(typeof s=="string")a=s;else if(s.target.validity.valid)t.data_type==="boolean"?a=s.target.checked?"true":"false":t.data_type==="number"?a=isNaN(s.target.valueAsNumber)?null:s.target.valueAsNumber:a=s.target.value;else return;this.selectedShots.has(e.id)?this.selectedShots.forEach(l=>{this.emitMetadataChanged(l,t,a)}):this.selectedAssets.has(e.id)?this.selectedAssets.forEach(l=>{this.emitMetadataChanged(l,t,a)}):this.selectedEdits.has(e.id)?this.selectedEdits.forEach(l=>{this.emitMetadataChanged(l,t,a)}):this.selectedEpisodes&&this.selectedEpisodes.has(e.id)?this.selectedEpisodes.forEach(l=>{this.emitMetadataChanged(l,t,a)}):this.emitMetadataChanged(e,t,a)},onMetadataChecklistChanged(e,t,s,a){const l=this.getMetadataChecklistValues(t,e);l[s]=a.target.checked,a.target.value=JSON.stringify(l),this.onMetadataFieldChanged(e,t,a)},onSortByMetadataClicked(){const e=this.lastMetadaDataHeaderMenuDisplayed,t=this.currentProduction.descriptors.find(s=>s.id===e);this.$emit("change-sort",{type:"metadata",column:t.field_name,name:t.name,data_type:t.data_type}),this.showMetadataHeaderMenu()},onEditMetadataClicked(){this.$emit("edit-metadata",this.lastMetadaDataHeaderMenuDisplayed),this.showMetadataHeaderMenu()},onDeleteMetadataClicked(){this.$emit("delete-metadata",this.lastMetadaDataHeaderMenuDisplayed),this.showMetadataHeaderMenu()},showMetadataHeaderMenu(e,t){const s=this.$refs.headerMetadataMenu.$el;if(s.className==="header-menu")s.className="header-menu hidden";else{s.className="header-menu";const l=t.srcElement.parentNode.parentNode.getBoundingClientRect(),i=l.left-3,c=l.bottom+11,p=Math.max(100,l.width-1);s.style.left=i+"px",s.style.top=c+"px",s.style.width=p+"px"}this.lastMetadaDataHeaderMenuDisplayed=e},getDescriptorChoicesOptions(e,t=!0){const s=e.choices.map(a=>({label:a,value:a}));return t&&s.unshift({label:"",value:""}),s},getMetadataFieldValue(e,t){return t.data&&e.field_name in t.data&&t.data[e.field_name]!=null?t.data[e.field_name]:t.entity_data&&e.field_name in t.entity_data&&t.entity_data[e.field_name]!=null?t.entity_data[e.field_name]:""},getDescriptorChecklistValues(e){const t=e.choices.reduce((s,a)=>(a&&typeof a=="string"&&a.startsWith("[x] ")?s.push({text:a.slice(4),checked:!0}):a&&typeof a=="string"&&a.startsWith("[ ] ")&&s.push({text:a.slice(4),checked:!1}),s),[]);return t.length===e.choices.length?t:[]},getMetadataChecklistValues(e,t){let s;try{s=JSON.parse(this.getMetadataFieldValue(e,t))}catch{s={}}return this.getDescriptorChecklistValues(e).forEach(function(a){a.text in s||(s[a.text]=a.checked)}),s},isSupervisorInDepartments(e=[]){return Array.isArray(e)||(e=[e]),this.isCurrentUserSupervisor&&(this.user.departments.length===0||this.user.departments.some(t=>e.includes(t)))},keyMetadataNavigation(e,t,s,a,l){if(l==="ArrowDown")s=s+1,s>=t&&(s=0);else if(l==="ArrowLeft")a=a-1,a<0&&(a=e-1);else if(l==="ArrowRight")a=a+1,a>=e&&(a=0);else if(l==="ArrowUp")s=s-1,s<0&&(s=t-1);else return;const i=`editor-${s}-${a}`;this.$refs[i][0]&&this.$refs[i][0].focus()}}},j={name:"combobox-tag",components:{ChevronDownIcon:E},emits:["change","update:modelValue"],data(){return{showList:!1}},props:{disabled:{default:!1,type:Boolean},label:{default:"",type:String},options:{default:()=>[],type:Array},modelValue:{default:"",type:String},localeKeyPrefix:{default:"",type:String},isReversed:{default:!1,type:Boolean},shy:{default:!1,type:Boolean},thin:{default:!1,type:Boolean},withMargin:{default:!0,type:Boolean}},computed:{optionList(){const e=R([...this.options]);return this.isReversed&&e.reverse(),e},renderedValue(){return this.modelValue.split(",").filter(Boolean).sort().join(", ")}},methods:{selectOption(e){let t=this.modelValue.split(",").filter(Boolean);t.includes(e.value)?t.splice(t.indexOf(e.value),1):t=this.optionList.filter(a=>this.isChecked(a)||a.value===e.value).map(a=>a.value);const s=t.join(",");this.$emit("update:modelValue",s),this.$emit("change",s)},toggleList(){this.showList&&(this.lastScrollPosition=this.$refs.select.scrollTop),this.showList=!this.showList,this.showList&&this.$nextTick(()=>{this.$refs.select?.scrollTo({top:this.lastScrollPosition,left:0})})},getOptionLabel(e){return this.localeKeyPrefix&&e.label?this.$t(this.localeKeyPrefix+e.label.toLowerCase()):e.label},isChecked(e){return this.modelValue.split(",").includes(e.value)}},watch:{showList(){this.showList&&this.$nextTick(()=>{if(!this.$refs.select?.children)return;let e=null;for(const t of this.$refs.select.children)t.className!=="flexrow"&&(e=t);e?.scrollTo({top:this.optionList.length*60})})}}},$={key:0,class:"label"},ee=["title"],te={class:"selected-line flexrow-item ellipsis"},se={key:0,class:"select-input"},ae=["onClick"],le=["checked","disabled"];function ie(e,t,s,a,l,i){const c=k("chevron-down-icon");return n(),r("div",{class:D({field:s.withMargin})},[s.label.length>0?(n(),r("label",$,y(s.label),1)):m("",!0),u("div",{class:D({combo:!0,thin:s.thin,reversed:s.isReversed,open:l.showList,shy:s.shy}),ref:"select"},[u("div",{class:"flexrow",onClick:t[0]||(t[0]=(...p)=>i.toggleList&&i.toggleList(...p)),title:i.renderedValue},[u("div",te,y(i.renderedValue),1),h(c,{class:"down-icon flexrow-item"})],8,ee),l.showList?(n(),r("div",se,[(n(!0),r(_,null,T(i.optionList,p=>(n(),r("div",{key:p.id,class:"option-line flexrow",onClick:x=>!s.disabled&&i.selectOption(p)},[u("input",{type:"checkbox",class:"mr05",checked:i.isChecked(p),disabled:s.disabled},null,8,le),B(" "+y(i.getOptionLabel(p)),1)],8,ae))),128))])):m("",!0)],2),u("div",{onClick:t[1]||(t[1]=(...p)=>i.toggleList&&i.toggleList(...p)),class:D({"c-mask":!0,"is-active":l.showList})},null,2)],2)}const oe=A(j,[["render",ie],["__scopeId","data-v-dd7fb424"]]),ne={name:"metadata-field",mixins:[O],components:{Combobox:U,ComboboxBoolean:q,ComboboxTag:oe,TextField:X},props:{descriptor:{type:Object,required:!0},entity:{type:Object,required:!0},label:{type:String},modelValue:{type:[Number,String,Object],default:""}},emits:["enter","update:modelValue"],computed:{...I(["isCurrentUserManager","isCurrentUserSupervisor","user"]),descriptorChecklistValues(){return this.getDescriptorChecklistValues(this.descriptor)},metadataChecklistValues(){return this.getMetadataChecklistValues(this.descriptor,this.entity)},isEditable(){return!!(this.isCurrentUserManager||this.isSupervisorInDepartments(this.descriptor.departments))}},methods:{updateValue(e){this.$emit("update:modelValue",e)},onEnter(){this.$emit("enter")},onMetadataCheckboxChanged(e,t){const s=this.metadataChecklistValues;s[e]=t,this.updateValue(JSON.stringify(s))}}},re=["onChange","id","checked","disabled"],de=["for"];function ue(e,t,s,a,l,i){const c=k("combobox"),p=k("combobox-boolean"),x=k("combobox-tag"),g=k("text-field");return s.descriptor.data_type==="checklist"&&i.descriptorChecklistValues.length?(n(),r("div",{class:"field",key:`${s.descriptor.id}-checklist-wrapper`},[(n(),r("label",{class:"label",key:`${s.descriptor.id}-${s.descriptor.name}`},y(s.descriptor.name),1)),(n(!0),r(_,null,T(i.descriptorChecklistValues,(b,V)=>(n(),r("div",{class:"checkbox-wrapper",key:`${s.descriptor.id}-${V}-${b.text}-wrapper`},[u("input",{type:"checkbox",onChange:F=>i.onMetadataCheckboxChanged(b.text,F.target.checked),id:`${s.descriptor.id}-${V}-${b.text}-checkbox`,checked:i.metadataChecklistValues[b.text],disabled:!i.isEditable,style:S([i.isEditable?{cursor:"pointer"}:{cursor:"auto"}])},null,44,re),u("label",{class:"checkbox-label",for:`${s.descriptor.id}-${V}-${b.text}-checkbox`,style:S([i.isEditable?{cursor:"pointer"}:{cursor:"auto"}])},[u("span",null,y(b.text),1)],12,de)]))),128))])):s.descriptor.data_type==="list"?(n(),f(c,{key:1,label:s.label??s.descriptor.name,options:e.getDescriptorChoicesOptions(s.descriptor),"model-value":s.modelValue,onEnter:i.onEnter,"onUpdate:modelValue":i.updateValue},null,8,["label","options","model-value","onEnter","onUpdate:modelValue"])):s.descriptor.data_type==="boolean"?(n(),f(p,{key:2,label:s.label??s.descriptor.name,"model-value":s.modelValue==="true"?s.modelValue:"false",onEnter:i.onEnter,"onUpdate:modelValue":i.updateValue},null,8,["label","model-value","onEnter","onUpdate:modelValue"])):s.descriptor.data_type==="taglist"?(n(),f(x,{key:3,label:s.label??s.descriptor.name,options:e.getDescriptorChoicesOptions(s.descriptor,!1),"model-value":s.modelValue,onEnter:i.onEnter,"onUpdate:modelValue":i.updateValue},null,8,["label","options","model-value","onEnter","onUpdate:modelValue"])):(n(),f(g,{key:4,label:s.label??s.descriptor.name,type:s.descriptor.data_type,"model-value":s.modelValue,min:null,onEnter:i.onEnter,"onUpdate:modelValue":i.updateValue},null,8,["label","type","model-value","onEnter","onUpdate:modelValue"]))}const ce=A(ne,[["render",ue],["__scopeId","data-v-51789d8c"]]),he={name:"build-filter-modal",mixins:[N,O],components:{ButtonSimple:Q,Combobox:U,ComboboxStatus:K,ComboboxStyled:z,ComboboxTaskType:G,MetadataField:ce,ModalFooter:Y,PeopleField:Z},props:{active:{type:Boolean,default:!1},entityType:{type:String,default:"asset"}},emits:["cancel","confirm"],data(){return{assetTypeFilters:{operator:"=",value:""},assignation:{person:null,taskTypeId:"",value:"nofilter",options:[{label:"no_filter",value:"nofilter"},{label:"assigned_to",value:"assignedto"},{label:"not_assigned_to",value:"-assignedto"},{label:"assignation_exists_for",value:"assigned"},{label:"no_assignation_for",value:"unassigned"}]},general:{operatorOptions:[{label:"equal",value:"="},{label:"not_equal",value:"=-"},{label:"in",value:"in"}],booleanOptions:[{label:"checked",value:"true"},{label:"not_checked",value:"-true"}],checklistOptions:[{label:"checked",value:!0},{label:"not_checked",value:!1}],taskTypeOperatorOptions:[{label:"equal",value:"="},{label:"not_equal",value:"=-"},{label:"in",value:"in"}],unionOptions:[{label:"union_and",value:"and"},{label:"union_or",value:"or"}]},hasThumbnail:{value:"nofilter",options:[{label:"no_filter",value:"nofilter"},{label:"with_thumbnail",value:"withthumbnail"},{label:"without_thumbnail",value:"-withthumbnail"}]},priorityOptions:[{label:"priority.normal",value:"0"},{label:"priority.high",value:"1"},{label:"priority.very_high",value:"2"},{label:"priority.emergency",value:"3"}],priority:{taskTypeId:"",value:"-1"},readyFor:{taskTypeId:""},isAssetsReady:{value:"nofilter",taskTypeId:"",options:[{label:"no_filter",value:"nofilter"},{label:"assets_ready",value:"assetsready"},{label:"assets_not_ready",value:"-assetsready"}]},metadataDescriptorFilters:{values:[]},taskTypeFilters:{values:[]},union:"and"}},mounted(){this.reset(),this.setFiltersFromCurrentQuery()},computed:{...I(["assetMetadataDescriptors","assetTypeMap","assetSearchText","assetValidationColumns","currentProduction","editSearchText","editMetadataDescriptors","editValidationColumns","episodeSearchText","episodeMetadataDescriptors","episodeValidationColumns","isCurrentUserVendor","people","personMap","productionAssetTypes","productionTaskStatuses","productionTaskTypes","productionShotTaskTypes","sequenceSearchText","sequenceMetadataDescriptors","sequenceValidationColumns","shotMetadataDescriptors","shotSearchText","shotValidationColumns","taskTypeMap","taskStatusMap"]),isAssets(){return this.entityType==="asset"},isShots(){return this.entityType==="shot"},isAssetsOnly(){return this.currentProduction?.production_type==="assets"},assetTypeOptions(){return[{label:this.$t("entities.build_filter.all_types"),value:"-"},...this.productionAssetTypes.filter(e=>e!==void 0).map(e=>({label:e.name,value:e.id}))]},taskStatuses(){return this.productionTaskStatuses.filter(e=>!e.for_concept)},taskTypeListWithAll(){return[{id:"",color:"#999",name:this.$t("main.all")}].concat(this.taskTypeList)},taskTypeList(){return this[`${this.entityType}ValidationColumns`].map(e=>this.taskTypeMap.get(e))},readyForTaskTypeList(){return[{id:"",color:"#999",name:this.$t("news.all")}].concat(this.productionShotTaskTypes)},team(){return H(this.currentProduction.team.map(e=>this.personMap.get(e)).filter(e=>e&&!e.is_bot))},descriptorOptions(){return this.metadataDescriptors.map(e=>({label:e.name,value:e.id}))},metadataDescriptors(){return this[`${this.entityType}MetadataDescriptors`]}},methods:{applyFilter(){const e=this.buildFilter();this.$emit("confirm",e)},buildFilter(){let e="";return e=this.applyAssetTypeChoice(e),e=this.applyTaskTypeChoice(e),e=this.applyDescriptorChoice(e),e=this.applyAssignationChoice(e),e=this.applyThumbnailChoice(e),e=this.applyPriorityChoice(e),e=this.applyReadyForChoice(e),e=this.applyAssetsReadyChoice(e),e=this.applyUnionChoice(e),e.trim()},applyAssetTypeChoice(e){const t=this.assetTypeFilters.value;if(t&&t!=="-"){let s="=[";this.assetTypeFilters.operator==="=-"&&(s="=[-");const a=this.assetTypeMap.get(t);e+=` type${s}${a.name}]`}return e},applyTaskTypeChoice(e){return this.taskTypeFilters.values.forEach(t=>{let s="=[";t.operator==="=-"&&(s="=[-");const a=this.taskTypeMap.get(t.id),l=t.values.map(i=>this.taskStatusMap.get(i).short_name).join(",");e+=` [${a.name}]${s}${l}]`}),e},applyDescriptorChoice(e){return this.metadataDescriptorFilters.values.forEach(t=>{let s="=[",a;if(t.is_checklist)a=t.values[0].text,a+=t.values[0].checked?":true":":false";else{t.operator==="=-"&&(s="=[-");const i=t.values;i.length===0||i[0]===""?a=this.getDescriptorChoiceOptions(t.id,t.is_checklist)[0]?.value??"":a=t.values.join(",")}const l=this.getDescriptor(t.id);e+=` [${l.name}]${s}${a}]`}),e},applyAssignationChoice(e){if(this.assignation.value!=="nofilter"){if(this.assignation.person){let t=this.assignation.person.name;const s=this.taskTypeMap.get(this.assignation.taskTypeId);this.assignation.value==="-assignedto"&&(t=`-${t}`),s?e+=` assignedto[${s.name}]=[${t}]`:e+=` assignedto[]=[${t}]`}else if(this.assignation.taskTypeId){const t=this.taskTypeMap.get(this.assignation.taskTypeId),s=this.assignation.value==="assigned"?"assigned":"unassigned";e+=` [${t.name}]=${s}`}}return e},applyThumbnailChoice(e){return this.hasThumbnail.value!=="nofilter"&&(e+=` ${this.hasThumbnail.value}`),e},applyPriorityChoice(e){if(this.priority.taskTypeId!==""&&this.priority.value!=="-1"){const t=this.taskTypeMap.get(this.priority.taskTypeId),s=this.priority.value;e+=` priority-[${t.name.toLowerCase()}]=${s}`}return e},applyReadyForChoice(e){if(this.readyFor.taskTypeId!==""){const t=this.taskTypeMap.get(this.readyFor.taskTypeId);e+=` readyfor=[${t.name.toLowerCase()}]`}return e},applyAssetsReadyChoice(e){if(this.isAssetsReady.value!=="nofilter"){this.isAssetsReady.taskTypeId.length===0&&(this.isAssetsReady.taskTypeId=this.taskTypeList[0].id);const t=this.taskTypeMap.get(this.isAssetsReady.taskTypeId),s=this.isAssetsReady.value==="assetsready"?"":"-";e+=` assetsready=[${s}${t.name}]`}return e},applyUnionChoice(e){return this.union==="or"&&(e=`+(${e.trim()})`),e},addTaskTypeFilter(){const e={localId:M(),id:this.taskTypeList[0].id,operator:"=",values:[this.taskStatuses[0].id]};return this.taskTypeFilters.values.push(e),e},addInTaskTypeFilter(e){e.values.push(this.taskStatuses[0].id)},removeTaskTypeFilter(e){this.taskTypeFilters.values=this.taskTypeFilters.values.filter(t=>t.localId!==e.localId)},addInDescriptorFilter(e){e.values.push("")},onDescriptorChanged(e,t){const s=this.getDescriptor(t);if(e.is_checklist=!1,s.choices.length>0){const a=this.getDescriptorChecklistValues(s);a.length>0?(e.is_checklist=!0,e.values=[a[0]],e.operator="="):e.values=[s.choices[0]]}else s.data_type==="boolean"?e.values=["-true"]:e.values=[""]},addDescriptorFilter(){const e=this.getDescriptor(this.descriptorOptions[0].value),t=[];let s=!1;if(e.choices.length>0){const l=this.getDescriptorChecklistValues(e);l.length>0?(s=!0,t.push({...l[0],checked:!0})):t.push(e.choices[0])}else e.data_type==="boolean"?t.push("-true"):t.push("");const a={localId:M(),id:this.descriptorOptions[0].value,operator:"=",values:t,is_checklist:s};return this.metadataDescriptorFilters.values.push(a),a},removeDescriptorFilter(e){this.metadataDescriptorFilters.values=this.metadataDescriptorFilters.values.filter(t=>t.localId!==e.localId)},getDescriptor(e){return this.metadataDescriptors.find(t=>t.id===e)},getDescriptorChoiceOptions(e,t){const s=this.getDescriptor(e);return t?this.getDescriptorChecklistValues(s).map(a=>({label:a.text,value:a.text})):s.choices.map(a=>({label:a,value:a}))},onOperatorChanged(e,t){e!=="in"&&(t.values=[t.values[0]])},setFiltersFromCurrentQuery(){const e=this[`${this.entityType}SearchText`];if(e){const t=P({entryIndex:[],assetTypes:this.productionAssetTypes,taskTypes:this.productionTaskTypes,taskStatuses:this.taskStatuses,descriptors:this.metadataDescriptors,persons:this.people,query:e});t.forEach(s=>{s.type==="assettype"?this.setFiltersFromAssetTypeQuery(s):s.type==="status"?this.setFiltersFromStatusQuery(s):s.type==="descriptor"?this.setFiltersFromDescriptorQuery(s):s.type==="assignation"?this.setFiltersFromAssignationQuery(s):s.type==="assignedto"?this.setFiltersFromAssignedToQuery(s):s.type==="thumbnail"?this.setFiltersFromThumbnailQuery(s):s.type==="priority"?this.setFiltersFromPriorityQuery(s):s.type==="readyfor"?this.setFiltersFromReadyForQuery(s):s.type==="assetsready"&&this.setFiltersFromAssetsReadyQuery(s)}),t.union&&this.setUnion()}},setFiltersFromAssetTypeQuery(e){this.assetTypeFilters.operator=e.excluding?"=-":"=",this.assetTypeFilters.value=e.assetType.id},setFiltersFromStatusQuery(e){let t="=";e.taskStatuses.length>1?t="in":e.excluding&&(t="=-"),this.taskTypeFilters.values.push({localId:M(),id:e.taskType.id,operator:t,values:e.taskStatuses})},setFiltersFromDescriptorQuery(e){let t="=",s=!1,a=e.values;e.values.length>1?t="in":e.values[0].endsWith(":true")?(s=!0,a=[{text:e.values[0].replace(/:true$/,""),checked:!0}]):e.values[0].endsWith(":false")?(s=!0,a=[{text:e.values[0].replace(/:false$/,""),checked:!1}]):e.excluding&&(e.descriptor.data_type==="boolean"?a=[`-${e.values[0]}`]:t="=-"),this.metadataDescriptorFilters.values.push({localId:M(),id:e.descriptor.id,operator:t,values:a,is_checklist:s})},setFiltersFromAssignationQuery(e){e.assigned?this.assignation.value="assigned":this.assignation.value="unassigned",this.assignation.taskTypeId=e.taskType.id},setFiltersFromAssignedToQuery(e){this.assignation.value=e.excluding?"-assignedto":"assignedto",this.assignation.person=this.people.find(t=>t.id===e.personIds[0]),this.assignation.taskTypeId=e.taskType?.id},setFiltersFromThumbnailQuery(e){e.excluding?this.hasThumbnail.value="-withthumbnail":this.hasThumbnail.value="withthumbnail"},setFiltersFromPriorityQuery(e){this.priority.taskTypeId=e.taskTypeId,this.priority.value=String(e.value)},setFiltersFromReadyForQuery(e){this.readyFor.taskTypeId=e.value},setFiltersFromAssetsReadyQuery(e){this.isAssetsReady.taskTypeId=e.value,this.isAssetsReady.value=e.excluding?"-assetsready":"assetsready"},setUnion(){this.union="or"},onTaskTypeOperatorChanged(e){e.operator!=="in"&&(e.values=[e.values[0]])},reset(){this.assignation.value="nofilter",this.assignation.person=null,this.assignation.taskTypeId="",this.hasThumbnail.value="nofilter",this.metadataDescriptorFilters.values=[],this.taskTypeFilters.values=[],this.assetTypeFilters.operator="=",this.assetTypeFilters.value="-"}},watch:{active(){this.active&&(this.reset(),this.assignation.taskTypeId=this.taskTypeList.length>0?this.taskTypeList[0].id:"",this.readyFor.taskTypeId="",this.priority.taskTypeId="",this.priority.value="0",this.setFiltersFromCurrentQuery())}}},pe={class:"modal-content"},me={class:"box content"},ye={class:"title"},fe={key:0,class:"subtitle"},ke={key:1,class:"flexrow asset-type-filter"},ve={class:"subtitle"},ge={class:"flexrow-item flexrow value-column"},be={class:"add-button"},_e={key:2,class:"mt2"},Te={class:"subtitle"},Ve={key:3,class:"flexrow-item flexrow value-column"},Ce={class:"add-button"},xe={key:3,class:"subtitle"},we={key:4,class:"flexrow assignation-filter"},Me={class:"flexcolumn"},De={class:"flexrow-item mt05 mb05"},Fe={class:"subtitle"},Ie={class:"subtitle flexrow-item mt2"},Ae={class:"flexrow"},Se={key:5,class:"subtitle flexrow-item mt2"},Ue={key:6,class:"flexrow"},Oe={key:7,class:"subtitle flexrow-item mt2"},Le={key:8,class:"flexrow"};function Ee(e,t,s,a,l,i){const c=k("combobox"),p=k("combobox-task-type"),x=k("combobox-status"),g=k("button-simple"),b=k("metadata-field"),V=k("people-field"),F=k("combobox-styled"),L=k("modal-footer");return n(),r("div",{class:D({modal:!0,"is-active":s.active})},[u("div",{onClick:t[0]||(t[0]=o=>e.$emit("cancel")),class:"modal-background"}),u("div",pe,[u("div",me,[u("h1",ye,y(e.$t("entities.build_filter.title")),1),h(c,{class:"flexrow-item",options:l.general.unionOptions,"locale-key-prefix":"entities.build_filter.",modelValue:l.union,"onUpdate:modelValue":t[1]||(t[1]=o=>l.union=o)},null,8,["options","modelValue"]),i.isAssets?(n(),r("h3",fe,y(e.$t("entities.build_filter.asset_type")),1)):m("",!0),i.isAssets?(n(),r("div",ke,[h(c,{class:"flexrow-item",options:l.general.operatorOptions,"locale-key-prefix":"entities.build_filter.",modelValue:l.assetTypeFilters.operator,"onUpdate:modelValue":t[2]||(t[2]=o=>l.assetTypeFilters.operator=o)},null,8,["options","modelValue"]),h(c,{class:"flexrow-item",options:i.assetTypeOptions,modelValue:l.assetTypeFilters.value,"onUpdate:modelValue":t[3]||(t[3]=o=>l.assetTypeFilters.value=o)},null,8,["options","modelValue"])])):m("",!0),u("h3",ve,y(e.$t("entities.build_filter.status")),1),(n(!0),r(_,null,T(l.taskTypeFilters.values,(o,w)=>(n(),r("div",{class:"flexrow task-type-filter",key:`task-type-${w}`},[h(p,{class:"flexrow-item","task-type-list":i.taskTypeList,modelValue:o.id,"onUpdate:modelValue":d=>o.id=d},null,8,["task-type-list","modelValue","onUpdate:modelValue"]),h(c,{class:"flexrow-item",options:l.general.taskTypeOperatorOptions,"onUpdate:modelValue":[d=>i.onTaskTypeOperatorChanged(o),d=>o.operator=d],"locale-key-prefix":"entities.build_filter.",modelValue:o.operator},null,8,["options","onUpdate:modelValue","modelValue"]),u("div",ge,[(n(!0),r(_,null,T(o.values,(d,v)=>(n(),f(x,{class:"flexrow-item",key:`task-type-value-${w}-${v}`,"task-status-list":i.taskStatuses,modelValue:o.values[v],"onUpdate:modelValue":C=>o.values[v]=C},null,8,["task-status-list","modelValue","onUpdate:modelValue"]))),128)),o.operator==="in"?(n(),f(g,{key:0,class:"mt05",icon:"plus",onClick:d=>i.addInTaskTypeFilter(o)},null,8,["onClick"])):m("",!0)]),h(g,{class:"mt05",icon:"minus",onClick:d=>i.removeTaskTypeFilter(o)},null,8,["onClick"])]))),128)),u("div",be,[h(g,{disabled:!i.taskTypeList.length,icon:"plus",onClick:i.addTaskTypeFilter},null,8,["disabled","onClick"])]),i.descriptorOptions.length>0?(n(),r("div",_e,[u("h3",Te,y(e.$t("entities.build_filter.descriptor")),1),(n(!0),r(_,null,T(l.metadataDescriptorFilters.values,(o,w)=>(n(),r("div",{class:"flexrow descriptor-filter",key:`descriptor-${w}`},[h(c,{class:"flexrow-item",options:i.descriptorOptions,"onUpdate:modelValue":[d=>i.onDescriptorChanged(o,d),d=>o.id=d],modelValue:o.id},null,8,["options","onUpdate:modelValue","modelValue"]),o.is_checklist?(n(),f(c,{key:0,class:"flexrow-item",options:l.general.checklistOptions,"locale-key-prefix":"entities.build_filter.",modelValue:o.values[0].checked,"onUpdate:modelValue":d=>o.values[0].checked=d},null,8,["options","modelValue","onUpdate:modelValue"])):i.getDescriptor(o.id).data_type==="boolean"?(n(),f(c,{key:1,class:"flexrow-item",options:l.general.booleanOptions,"locale-key-prefix":"entities.build_filter.",modelValue:o.values[0],"onUpdate:modelValue":d=>o.values[0]=d},null,8,["options","modelValue","onUpdate:modelValue"])):(n(),f(c,{key:2,class:"flexrow-item",options:l.general.operatorOptions,"locale-key-prefix":"entities.build_filter.","onUpdate:modelValue":[d=>i.onOperatorChanged(d,o),d=>o.operator=d],modelValue:o.operator},null,8,["options","onUpdate:modelValue","modelValue"])),i.getDescriptor(o.id).data_type!=="boolean"?(n(),r("div",Ve,[(n(!0),r(_,null,T(o.values,(d,v)=>(n(),r(_,null,[i.getDescriptor(o.id).choices.length===0?(n(),f(b,{class:"flexrow-item",label:"",descriptor:i.getDescriptor(o.id),entity:{},key:`descriptor-value-field-${v}`,modelValue:o.values[v],"onUpdate:modelValue":C=>o.values[v]=C},null,8,["descriptor","modelValue","onUpdate:modelValue"])):(n(),f(c,{class:"flexrow-item",key:`descriptor-value-combobox-${v}`,options:i.getDescriptorChoiceOptions(o.id,o.is_checklist),modelValue:o.values[v].text,"onUpdate:modelValue":C=>o.values[v].text=C},null,8,["options","modelValue","onUpdate:modelValue"]))],64))),256)),o.operator==="in"?(n(),f(g,{key:0,class:"mt05",icon:"plus",onClick:d=>i.addInDescriptorFilter(o)},null,8,["onClick"])):m("",!0)])):m("",!0),h(g,{class:"mt05",icon:"minus",onClick:d=>i.removeDescriptorFilter(o)},null,8,["onClick"])]))),128)),u("div",Ce,[h(g,{icon:"plus",onClick:i.addDescriptorFilter},null,8,["onClick"])])])):m("",!0),e.isCurrentUserVendor?m("",!0):(n(),r("h3",xe,y(e.$t("entities.build_filter.assignation")),1)),e.isCurrentUserVendor?m("",!0):(n(),r("div",we,[h(c,{class:"flexrow-item",options:l.assignation.options,"locale-key-prefix":"entities.build_filter.",modelValue:l.assignation.value,"onUpdate:modelValue":t[4]||(t[4]=o=>l.assignation.value=o)},null,8,["options","modelValue"]),u("div",Me,[["assignedto","-assignedto"].includes(l.assignation.value)?(n(),r(_,{key:0},[h(V,{class:"flexrow-item",people:i.team,modelValue:l.assignation.person,"onUpdate:modelValue":t[5]||(t[5]=o=>l.assignation.person=o)},null,8,["people","modelValue"]),u("span",De,y(e.$t("main.on")),1)],64)):m("",!0),["assigned","unassigned","assignedto","-assignedto"].includes(l.assignation.value)?(n(),f(p,{key:1,class:"flexrow-item","task-type-list":["assigned","unassigned"].includes(l.assignation.value)?i.taskTypeList:i.taskTypeListWithAll,modelValue:l.assignation.taskTypeId,"onUpdate:modelValue":t[6]||(t[6]=o=>l.assignation.taskTypeId=o)},null,8,["task-type-list","modelValue"])):m("",!0)])])),u("h3",Fe,y(e.$t("entities.build_filter.thumbnail")),1),h(c,{options:l.hasThumbnail.options,"locale-key-prefix":"entities.build_filter.",modelValue:l.hasThumbnail.value,"onUpdate:modelValue":t[7]||(t[7]=o=>l.hasThumbnail.value=o)},null,8,["options","modelValue"]),u("h3",Ie,y(e.$t("task_types.fields.priority")),1),u("div",Ae,[h(p,{class:"flexrow-item","task-type-list":i.taskTypeListWithAll,"open-top":"",modelValue:l.priority.taskTypeId,"onUpdate:modelValue":t[8]||(t[8]=o=>l.priority.taskTypeId=o)},null,8,["task-type-list","modelValue"]),W(h(F,{class:"flexrow-item",options:l.priorityOptions,"locale-key-prefix":"tasks.",modelValue:l.priority.value,"onUpdate:modelValue":t[9]||(t[9]=o=>l.priority.value=o)},null,8,["options","modelValue"]),[[J,l.priority.taskTypeId!==""]])]),i.isAssets&&!i.isAssetsOnly?(n(),r("h3",Se,y(e.$t("assets.fields.ready_for")),1)):m("",!0),i.isAssets&&!i.isAssetsOnly?(n(),r("div",Ue,[h(p,{class:"flexrow-item","task-type-list":i.readyForTaskTypeList,"open-top":"",modelValue:l.readyFor.taskTypeId,"onUpdate:modelValue":t[10]||(t[10]=o=>l.readyFor.taskTypeId=o)},null,8,["task-type-list","modelValue"])])):m("",!0),i.isShots?(n(),r("h3",Oe,y(e.$t("entities.build_filter.is_assets_ready")),1)):m("",!0),i.isShots?(n(),r("div",Le,[h(p,{class:"flexrow-item","task-type-list":i.taskTypeList,"open-top":"",modelValue:l.isAssetsReady.taskTypeId,"onUpdate:modelValue":t[11]||(t[11]=o=>l.isAssetsReady.taskTypeId=o)},null,8,["task-type-list","modelValue"]),h(c,{class:"flexrow-item",options:l.isAssetsReady.options,"locale-key-prefix":"entities.build_filter.",modelValue:l.isAssetsReady.value,"onUpdate:modelValue":t[12]||(t[12]=o=>l.isAssetsReady.value=o)},null,8,["options","modelValue"])])):m("",!0),h(L,{"error-text":e.$t("entities.thumbnails.error"),onConfirm:i.applyFilter,onCancel:t[13]||(t[13]=o=>e.$emit("cancel"))},null,8,["error-text","onConfirm"])])])],2)}const ze=A(he,[["render",Ee],["__scopeId","data-v-0edd13ef"]]);export{ze as B,oe as C,ce as M,O as d};
//# sourceMappingURL=BuildFilterModal-C3nrV5vY.js.map
