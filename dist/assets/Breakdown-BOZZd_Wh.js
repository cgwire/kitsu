import{_ as A,o as n,c as r,e as c,t as f,p as E,a4 as G,C as Y,a6 as X,r as p,k as J,a9 as S,n as I,f as g,q as Z,ab as F,F as b,d as m,ao as q,ap as $,E as ee,m as x,aq as se,g as C,A as _,l as y,ak as te,ar as ie,B as ae,am as ne,aa as oe,as as re,Q as le,at as de,au as ce,S as he,av as ue,aw as me,x as fe,ax as pe,ay as T,b as ye,az as L,ac as D,aA as B,aB as ge,$ as O}from"./index-a83mlrHR.js";import{B as ve}from"./ButtonHrefLink-B43EuuB1.js";import"./upload-B8viYZ_L.js";const be={name:"available-asset-block",props:{asset:{default:()=>({id:"",name:""}),type:Object},active:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},bigMode:{default:!0,type:Boolean}},emits:["add-one","add-ten"],methods:{addOneAsset(e){this.active&&this.$emit("add-one",this.asset.id)},addTenAssets(e){this.active&&this.$emit("add-ten",this.asset.id)}}},Ce=["id","title"],ke={key:0,class:"asset-picture"},we=["src"],_e={key:1,class:"asset-picture"},Se={class:"empty-picture"},Ee={class:"asset-text-name flexrow-item"};function Te(e,s,t,l,a,i){return t.textMode?(n(),r("div",{key:1,class:E(["asset-text flexrow-item flexrow",{shared:t.asset.shared}])},[c("span",Ee,f(t.asset.name),1),c("span",{class:"modify-asset flexrow-item",onClick:s[2]||(s[2]=(...h)=>i.addOneAsset&&i.addOneAsset(...h))}," + 1 ")],2)):(n(),r("div",{key:0,id:`casting-${t.asset.id}`,class:E(["asset",{active:t.active,"big-asset":t.bigMode,shared:t.asset.shared}]),title:t.asset.name},[c("div",{class:"asset-add",onClick:s[0]||(s[0]=(...h)=>i.addOneAsset&&i.addOneAsset(...h))},"+ 1"),c("div",{class:"asset-add-10",onClick:s[1]||(s[1]=(...h)=>i.addTenAssets&&i.addTenAssets(...h))},"+ 10"),t.asset.preview_file_id?(n(),r("div",ke,[c("img",{loading:"lazy",alt:"",src:`/api/pictures/thumbnails-square/preview-files/${t.asset.preview_file_id}.png`},null,8,we)])):(n(),r("div",_e,[c("span",Se,f(t.asset.name),1)]))],10,Ce))}const Ae=A(be,[["render",Te],["__scopeId","data-v-9d0dcb14"]]),Ie={name:"edit-label-modal",mixins:[G],components:{Combobox:Y,ModalFooter:X},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},label:{type:String}},emits:["cancel","confirm"],mounted(){this.form.label=this.label},data(){return{form:{label:"animate"},typeOptions:[{label:this.$t("breakdown.options.animate"),value:"animate"},{label:this.$t("breakdown.options.fixed"),value:"fixed"}]}},methods:{confirm(){return this.$emit("confirm",this.form)}},watch:{label(){this.form.label=this.label}}},Me={class:"modal-content"},De={class:"box content"},Oe={class:"title"};function Le(e,s,t,l,a,i){const h=p("combobox"),v=p("modal-footer"),o=J("focus");return n(),r("div",{class:E({modal:!0,"is-active":t.active})},[c("div",{class:"modal-background",onClick:s[0]||(s[0]=u=>e.$emit("cancel"))}),c("div",Me,[c("div",De,[c("h1",Oe,f(e.$t("breakdown.edit_label")),1),c("form",{onSubmit:s[3]||(s[3]=S(()=>{},["prevent"]))},[I(g(h,{ref:"typeField",label:e.$t("breakdown.label"),options:a.typeOptions,onEnter:i.confirm,modelValue:a.form.label,"onUpdate:modelValue":s[1]||(s[1]=u=>a.form.label=u)},null,8,["label","options","onEnter","modelValue"]),[[o]]),g(v,{"is-error":t.isError,"is-loading":t.isLoading,onConfirm:i.confirm,onCancel:s[2]||(s[2]=u=>e.$emit("cancel"))},null,8,["is-error","is-loading","onConfirm"])],32)])])],2)}const Be=A(Ie,[["render",Le],["__scopeId","data-v-5af38152"]]),Fe={name:"asset-block",mixins:[Z],props:{asset:{default:()=>({id:"",name:""}),type:Object},nbOccurences:{default:1,type:Number},active:{default:!0,type:Boolean},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},bigMode:{default:!1,type:Boolean}},emits:["add-one","edit-label","remove-one"],methods:{removeOneAsset(e){this.$emit("remove-one",this.asset.asset_id)},addOneAsset(e){this.$emit("add-one",this.asset.asset_id)},shortenName(e){return F.shortenText(e,13)},onEditLabelClicked(){this.readOnly||this.$emit("edit-label",this.asset,this.asset.label)}}},qe=["title"],xe={class:"asset-wrapper"},Re={key:1,class:"asset-picture"},Ve=["src"],Ne={key:0,class:"nb-occurences"},Pe={key:2,class:"asset-picture"},ze={class:"empty-picture"},Ue=["label"],He={class:"asset-text-name flexrow-item filler"};function We(e,s,t,l,a,i){return t.textMode?(n(),r("div",{key:1,class:E(["asset-text flexrow-item flexrow",{shared:t.asset.shared}])},[c("span",He,f(t.asset.name)+" ("+f(t.nbOccurences)+") ",1),!t.readOnly&&t.active?(n(),r("span",{key:0,class:"modify-asset flexrow-item",onClick:s[3]||(s[3]=S((...h)=>i.removeOneAsset&&i.removeOneAsset(...h),["stop"]))}," - 1 ")):m("",!0)],2)):(n(),r("div",{key:0,class:E(["asset big casted labelled",{active:t.active,"big-asset":t.bigMode,shared:t.asset.shared}]),title:`${t.asset.name} (${t.nbOccurences})`},[c("div",xe,[!t.readOnly&&t.active?(n(),r(b,{key:0},[c("div",{class:"asset-add-1",onClick:s[0]||(s[0]=S((...h)=>i.addOneAsset&&i.addOneAsset(...h),["stop"]))},"+ 1"),c("div",{class:"asset-add",onClick:s[1]||(s[1]=S((...h)=>i.removeOneAsset&&i.removeOneAsset(...h),["stop"]))},"- 1")],64)):m("",!0),t.asset.preview_file_id?(n(),r("div",Re,[c("img",{loading:"lazy",alt:"",src:`/api/pictures/thumbnails-square/preview-files/${t.asset.preview_file_id}.png`},null,8,Ve),t.nbOccurences>1?(n(),r("span",Ne,f(t.nbOccurences),1)):m("",!0)])):(n(),r("div",Pe,[c("span",ze,f(i.shortenName(t.asset.name))+" ("+f(t.nbOccurences)+") ",1)]))]),c("div",{class:"asset-label",label:t.asset.label,onClick:s[2]||(s[2]=(...h)=>i.onEditLabelClicked&&i.onEditLabelClicked(...h))},f(t.asset.label||e.$t("breakdown.options.animate")),9,Ue)],10,qe))}const Ke=A(Fe,[["render",We],["__scopeId","data-v-6c299a76"]]),je={name:"shot-line",mixins:[q,$],components:{AssetBlock:Ke,EntityThumbnail:ee},props:{entity:{default:()=>{},type:Object},previewFileId:{default:"",type:String},selected:{default:!1,type:Boolean},name:{default:"",type:String},assets:{default:()=>[],type:Array},assetTypes:{default:()=>[],type:Array},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},metadataDescriptors:{default:()=>[],type:Array},metadataDisplayHeaders:{default:()=>{},type:Object},bigMode:{default:!1,type:Boolean},isDescription:{default:!0,type:Boolean},isSaveError:{default:!1,type:Boolean},columnWidth:{default:()=>{},type:Object}},emits:["add-one","click","description-changed","edit-label","remove-one","standby-changed"],computed:{...x(["assetMap","isCurrentUserManager","isCurrentUserSupervisor","isFrameIn","isFrameOut","isFrames","isShowInfosBreakdown","user"]),chunks(){return this.name.split(" / ").filter(s=>s&&s!=="undefined")},assetsByAssetTypesMap(){const e={};return this.assets.forEach(s=>{s[0]&&(e[s[0].asset_type_name]=s)}),e}},methods:{onClicked(e){this.$emit("click",this.entity.id,e)},onEditLabelClicked(e,s){this.$emit("edit-label",e,s,this.entity.id)},removeOneAsset(e){this.$emit("remove-one",e)},addOneAsset(e){this.$emit("add-one",e)},onDescriptionChanged(e,s){this.$emit("description-changed",e,s.target.value)},onStandbyChanged(e,s){this.$emit("standby-changed",e,s.target.checked)},renderMarkdown:se,nbAssetsForType(e){return this.assetsByAssetTypesMap[e].reduce((s,t)=>s+t.nb_occurences,0)}}},Qe=["id"],Ge={key:0,class:"error has-text-left info-message"},Ye={class:"flexrow"},Xe={class:"shot-name flexrow-item ml05"},Je={key:0,class:"standby-column flexrow-item"},Ze=["checked","disabled"],$e={key:1,class:"description-column flexrow-item"},es=["innerHTML"],ss=["value"],ts={key:2,class:"frames-column flexrow-item"},is=["value"],as={key:1,class:"metadata-value selectable"},ns={key:3,class:"frames-column flexrow-item"},os=["value"],rs={key:1,class:"metadata-value selectable"},ls={key:4,class:"frames-column flexrow-item"},ds=["value"],cs={key:1,class:"metadata-value selectable"},hs=["title"],us=["onInput","value"],ms={key:1,class:"metadata-value selectable"},fs=["onChange","id","checked","disabled"],ps=["for"],ys={key:2,class:"select"},gs=["onChange"],vs=["value","selected"],bs={key:3,class:"metadata-value selectable"},Cs={key:0,class:"asset-type-line flexcolumn"},ks={class:"flexrow-item mb05"},ws={class:"asset-type-items flexrow-item"},_s={key:1,class:"asset-type-line flexrow empty mt05 mb05"};function Ss(e,s,t,l,a,i){const h=p("entity-thumbnail"),v=p("asset-block");return n(),r("div",{id:t.entity.id,class:E(["shot unselectable",{selected:t.selected,stdby:t.entity?t.entity.is_casting_standby:!1,"text-mode":t.textMode}]),onClick:s[5]||(s[5]=o=>i.onClicked(o))},[c("div",{class:"flexrow-item sticky",style:_({"max-width":t.columnWidth.name?t.columnWidth.name+"px":"250px"})},[t.isSaveError?(n(),r("p",Ge,f(e.$t("breakdown.save_error")),1)):m("",!0),c("div",Ye,[g(h,{class:"flexrow-item mr1",entity:{},height:t.bigMode?100:60,width:t.bigMode?150:90,"empty-height":t.bigMode?100:60,"empty-width":t.bigMode?150:90,"preview-file-id":t.previewFileId},null,8,["height","width","empty-height","empty-width","preview-file-id"]),c("div",Xe,[(n(!0),r(b,null,C(i.chunks,(o,u)=>(n(),r("div",{key:`chunk-${u}`},f(o),1))),128))])])],4),e.isShowInfosBreakdown?(n(),r("div",Je,[c("input",{type:"checkbox",checked:t.entity?t.entity.is_casting_standby:!1,disabled:!e.isCurrentUserManager,style:_([e.isCurrentUserManager?{cursor:"pointer"}:{cursor:"auto"}]),onInput:s[0]||(s[0]=o=>i.onStandbyChanged(t.entity,o))},null,44,Ze)])):m("",!0),e.isShowInfosBreakdown&&t.isDescription?(n(),r("div",$e,[t.readOnly?(n(),r("div",{key:0,class:"tooltip-text",innerHTML:i.renderMarkdown(t.entity.description)},null,8,es)):(n(),r("textarea",{key:1,class:"tooltip-editor",ref:"text",value:t.entity.description,onInput:s[1]||(s[1]=o=>i.onDescriptionChanged(t.entity,o))},"      ",40,ss))])):m("",!0),e.isFrames&&e.isShowInfosBreakdown&&t.metadataDisplayHeaders.frames?(n(),r("div",ts,[e.isCurrentUserManager?(n(),r("input",{key:0,class:"input-editor",step:"1",value:t.entity.nb_frames,type:"number",min:"0",onInput:s[2]||(s[2]=o=>e.onNbFramesChanged(t.entity,o.target.value))},null,40,is)):(n(),r("span",as,f(t.entity.nb_frames),1))])):m("",!0),e.isFrameIn&&e.isShowInfosBreakdown&&t.metadataDisplayHeaders.frameIn?(n(),r("div",ns,[e.isCurrentUserManager?(n(),r("input",{key:0,class:"input-editor",step:"1",type:"number",min:"0",value:e.getMetadataFieldValue({field_name:"frame_in"},t.entity),onInput:s[3]||(s[3]=o=>e.onMetadataFieldChanged(t.entity,{field_name:"frame_in",data_type:"number"},o))},null,40,os)):(n(),r("span",rs,f(e.getMetadataFieldValue({field_name:"frame_in"},t.entity)),1))])):m("",!0),e.isFrameOut&&e.isShowInfosBreakdown&&t.metadataDisplayHeaders.frameOut?(n(),r("div",ls,[e.isCurrentUserManager?(n(),r("input",{key:0,class:"input-editor",step:"1",type:"number",min:"0",value:e.getMetadataFieldValue({field_name:"frame_out"},t.entity),onInput:s[4]||(s[4]=o=>e.onMetadataFieldChanged(t.entity,{field_name:"frame_out",data_type:"number"},o))},null,40,ds)):(n(),r("span",cs,f(e.getMetadataFieldValue({field_name:"frame_out"},t.entity)),1))])):m("",!0),e.isShowInfosBreakdown?(n(!0),r(b,{key:5},C(e.visibleMetadataDescriptors,o=>(n(),r("div",{class:"metadata-descriptor flexrow-item",title:t.entity.data?t.entity.data[o.field_name]:"",key:"desc"+t.entity.id+"-"+o.id,style:_({"min-width":t.columnWidth[o.id]?t.columnWidth[o.id]+"px":"110px","max-width":t.columnWidth[o.id]?t.columnWidth[o.id]+"px":"110px"})},[o.choices.length===0&&(e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments))?(n(),r("input",{key:0,class:"input-editor",onInput:u=>e.onMetadataFieldChanged(t.entity,o,u),value:e.getMetadataFieldValue(o,t.entity)},null,40,us)):o.choices.length>0&&e.getDescriptorChecklistValues(o).length>0?(n(),r("div",ms,[(n(!0),r(b,null,C(e.getDescriptorChecklistValues(o),(u,k)=>(n(),r("p",{key:`${t.entity.id}-${o.id}-${k}-${u.text}-div`},[c("input",{type:"checkbox",onChange:M=>e.onMetadataChecklistChanged(t.entity,o,u.text,M),id:`${t.entity.id}-${o.id}-${k}-${u.text}-input`,checked:e.getMetadataChecklistValues(o,t.entity)[u.text],disabled:!(e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)),style:_([e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)?{cursor:"pointer"}:{cursor:"auto"}])},null,44,fs),c("label",{for:`${t.entity.id}-${o.id}-${k}-${u.text}-input`,style:_([e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)?{cursor:"pointer"}:{cursor:"auto"}])},f(u.text),13,ps)]))),128))])):e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)?(n(),r("span",ys,[c("select",{class:"select-input",onChange:u=>e.onMetadataFieldChanged(t.entity,o,u)},[(n(!0),r(b,null,C(e.getDescriptorChoicesOptions(o),(u,k)=>(n(),r("option",{key:`desc-value-${t.entity.id}-${o.id}-${k}-${u.label}-${u.value}`,value:u.value,selected:e.getMetadataFieldValue(o,t.entity)===u.value},f(u.label),9,vs))),128))],40,gs)])):(n(),r("span",bs,f(e.getMetadataFieldValue(o,t.entity)),1))],12,hs))),128)):m("",!0),(n(!0),r(b,null,C(t.assetTypes,o=>(n(),r("div",{class:"asset-list flexrow-item",key:t.entity.id+"-"+o},[i.assetsByAssetTypesMap[o]!==void 0?(n(),r("div",Cs,[c("div",ks,f(i.nbAssetsForType(o))+" "+f(e.$tc("assets.number",i.nbAssetsForType(o))),1),c("div",ws,[(n(!0),r(b,null,C(i.assetsByAssetTypesMap[o],u=>(n(),y(v,{class:"flexrow-item",key:u.id,asset:u,active:t.selected,"nb-occurences":u.nb_occurences,"read-only":t.readOnly,"text-mode":t.textMode,"big-mode":t.bigMode,onEditLabel:i.onEditLabelClicked,onRemoveOne:i.removeOneAsset,onAddOne:i.addOneAsset},null,8,["asset","active","nb-occurences","read-only","text-mode","big-mode","onEditLabel","onRemoveOne","onAddOne"]))),128))]),s[6]||(s[6]=c("div",{class:"actions filler"},null,-1))])):(n(),r("div",_s,f(e.$t("breakdown.empty")),1))]))),128))],10,Qe)}const Es=A(je,[["render",Ss],["__scopeId","data-v-b54542e6"]]),Ts={name:"breakdown",mixins:[q,te],components:{AvailableAssetBlock:Ae,BuildFilterModal:ie,ButtonHrefLink:ve,ButtonSimple:ae,ComboboxStyled:ne,DeleteModal:oe,DepartmentName:re,EditAssetModal:le,EditLabelModal:Be,ImportModal:de,ImportRenderModal:ce,SearchField:he,SearchQueryList:ue,ShotLine:Es,ShowInfosButton:me,Spinner:fe,TableMetadataSelectorMenu:pe},data(){return{assetTypeId:"",castingType:"shot",columnSelectorDisplayed:!1,editedAsset:null,editedEntityId:null,editedAssetLinkLabel:null,episodeId:"",importCsvFormData:{},isBigMode:!1,isLocked:!1,isLoading:!1,isOnlyCurrentEpisode:!1,isTextMode:!1,libraryDisplayed:!1,optionalCsvColumns:["Label"],parsedCSV:[],removalData:{},saveErrors:{},selection:{},sequenceId:"all",errors:{edit:!1,editLabel:!1,importing:!1,importingError:null,remove:!1,stay:!1},loading:{edit:!1,editLabel:!1,importing:!1,remove:!1,stay:!1},metadataDisplayHeaders:{stdby:!0,fps:!1,frameIn:!0,frameOut:!0,frames:!0,estimation:!1,maxRetakes:!1,resolution:!1,timeSpent:!1},modals:{isBuildFilterDisplayed:!1,isEditLabelDisplayed:!1,isNewDisplayed:!1,isImportRenderDisplayed:!1,isRemoveConfirmationDisplayed:!1,importing:!1},success:{edit:!1},columnWidth:{}}},mounted(){this.isLoading||this.reset(),this.resetSequenceOption(),this.setLastProductionScreen("breakdown"),this.isTextMode=T.getBoolPreference("breakdown:text-mode"),window.addEventListener("keydown",this.onKeyDown,!1),this.resetDisplayHeaders(),this.resetColumnWidth()},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},computed:{...x(["assetMap","assetMetadataDescriptors","assetTypeMap","assetsByType","breakdownSearchQueries","breakdownSearchFilterGroups","casting","castingAssetTypeAssets","castingAssetTypesOptions","castingByType","castingCurrentShot","castingEpisodes","castingSequenceShots","castingSequencesOptions","currentEpisode","currentProduction","departmentMap","displayedSequences","displayedShots","episodeMap","episodes","isAssetsLoading","isCurrentUserManager","isFrameIn","isFrameOut","isFrames","isShotsLoading","isShowInfosBreakdown","isTVShow","sequenceMap","shotMap","shotMetadataDescriptors"]),searchField(){return this.$refs["search-field"]},castingTypeOptions(){const e=this.currentProduction.production_type==="assets",s=this.currentProduction.production_type==="shots",t=[];return s||t.push({label:this.$t("assets.title"),value:"asset"}),!e&&(!this.isTVShow||this.currentEpisode&&this.currentEpisode.id!=="main")&&t.unshift({label:this.$t("shots.title"),value:"shot"}),t},availableAssetsByType(){const e=[];return this.assetsByType.forEach(s=>{let t=s.filter(l=>!l.canceled);this.isTVShow&&this.isOnlyCurrentEpisode&&(t=s.filter(l=>{var a;return l.episode_id===this.currentEpisode.id||((a=l.casting_episode_ids)==null?void 0:a.includes(this.currentEpisode.id))})),t.length>0&&e.push(t)}),e},exportUrlPath(){let e=`/api/export/csv/projects/${this.currentProduction.id}/casting.csv`,s=!1;return this.currentEpisode&&(e+=`?episode_id=${this.currentEpisode.id}`,s=!0),this.isShotCasting&&(e+=`${s?"&":"?"}is_shot_casting=${this.isShotCasting}`),e},isEpisodeCasting(){return this.currentEpisode&&this.currentEpisode.id==="all"},isAssetCasting(){return!this.isEpisodeCasting&&this.castingType==="asset"},isShotCasting(){return!this.isEpisodeCasting&&this.castingType==="shot"},castingEntities(){return this.isEpisodeCasting?this.castingEpisodes:this.isShotCasting?this.castingSequenceShots:this.isTVShow&&this.currentEpisode&&this.currentEpisode.id!=="main"?this.castingAssetTypeAssets.filter(e=>{var s;return e.episode_id===this.currentEpisode.id||((s=e.casting_episode_ids)==null?void 0:s.includes(this.currentEpisode.id))}):this.isTVShow&&this.currentEpisode.id==="main"?this.castingAssetTypeAssets.filter(e=>!e.episode_id):this.castingAssetTypeAssets},castingAssetTypes(){const e=[],s={};return this.castingEntities.forEach(t=>{this.castingByType[t.id]&&this.castingByType[t.id].forEach(l=>{l[0]&&!s[l[0].asset_type_name]&&(s[l[0].asset_type_name]=!0,e.push(l[0].asset_type_name))})}),e.sort()},editLabelModal(){return this.$refs["edit-label-modal"]},filteredCasting(){const e={};return this.castingEntities.forEach(s=>{this.castingByType[s.id]&&this.castingByType[s.id].forEach(t=>{t.forEach(l=>{const a=`${l.asset_name}${l.asset_type_name}${l.name}`;e[a]=!0})})}),e},isDescription(){return this.castingEntities.some(e=>e.description&&e.description.length>0)},csvColumns(){var e;return this.isTVShow&&((e=this.currentEpisode)==null?void 0:e.id)!=="all"?["Episode","Parent","Name","Asset Type","Asset","Occurences"]:["Parent","Name","Asset Type","Asset","Occurences"]},renderColumns(){return[...this.csvColumns,...this.optionalCsvColumns]},dataMatchers(){return this.isTVShow?["Episode","Name","Asset Type","Asset"]:["Name","Asset Type","Asset"]},metadataDescriptors(){return this.isEpisodeCasting?[]:this.isShotCasting?this.shotMetadataDescriptors:this.assetMetadataDescriptors}},methods:{...ye(["addAssetToCasting","editEpisode","editShot","editAsset","displayMoreAssets","loadEpisodeCasting","loadEpisodes","loadAssetCasting","loadAssets","loadShotCasting","loadShots","newAsset","removeAssetFromCasting","removeBreakdownSearch","saveBreakdownSearch","loadSequences","saveBreakdownSearchFilterGroup","saveCasting","setAssetLinkLabel","setAssetSearch","setCastingEpisodes","setCastingAssetType","setCastingAssetTypes","setCastingEpisode","setCastingForProductionEpisodes","setCastingSequence","setCurrentEpisode","setEntityCasting","setLastProductionScreen","uploadCastingFile"]),reset(){if(!this.isTVShow){const e={...this.$route};e&&e.params&&e.params.episode_id&&(e.name="breakdown",e.params.episode_id=null,this.$router.push(e))}this.isLoading=!0,setTimeout(()=>{this.reloadEntities()},100)},async reloadEntities(){this.isLoading=!0,await this.loadSequences(),await this.loadShots(),this.isTVShow?(this.currentEpisode&&(this.episodeId=this.currentEpisode.id),this.setCastingEpisode(this.episodeId),this.setCastingForProductionEpisodes()):this.setCastingEpisode(null),this.loadAssets({all:!0,withTasks:!0}).then(()=>{this.isLoading=!1,this.displayMoreAssets(),this.setCastingAssetTypes(),this.assetTypeId?this.setCastingAssetType(this.assetTypeId):this.setCastingSequence(this.sequenceId||"all"),this.resetSequenceOption(),this.resetSelection(),(this.currentEpisode&&this.currentEpisode.id==="main"||this.currentProduction.production_type==="assets")&&(this.castingType="asset")})},resetSequenceOption(){this.currentProduction.production_style==="nft"&&(this.sequenceId=this.castingSequencesOptions[1].value)},resetSelection(){const e={};this.isEpisodeCasting?this.castingEpisodes.forEach(s=>{e[s.id]=!1}):this.isShotCasting?this.castingSequenceShots.forEach(s=>{e[s.id]=!1}):this.castingAssetTypeAssets.forEach(s=>{e[s.id]=!1}),this.selection=e},confirmBuildFilter(e){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(e),this.onSearchChange(e)},onSearchChange(e){this.setAssetSearch(e),this.displayMoreAssets(),this.displayMoreAssets()},selectEntity(e,s){const t={...this.selection};!(s.ctrlKey||s.metaKey)&&!s.shitKey&&this.clearSelection(),this.previousEntityId&&s.shiftKey&&this.selectRange(this.previousEntityId,e),(!this.previousEntityId||!s.shiftKey)&&(this.previousEntityId=e);const l=Object.keys(t).filter(a=>t[a]).length;!t[e]||l>1&&!(s.ctrlKey||s.metaKey)?this.selection[e]=!0:t[e]&&(s.ctrlKey||s.metaKey)&&(this.selection[e]=!1)},clearSelection(){Object.keys(this.selection).filter(e=>this.selection[e]).forEach(e=>{this.selection[e]=!1})},selectRange(e,s){const t=Object.keys(this.selection),l=t.findIndex(h=>h===e),a=t.findIndex(h=>h===s);let i=[];l<a?i=L(l,a):i=L(a,l),i.forEach(h=>{h>=0&&(this.selection[t[h]]=!0)})},setLock(){this.$options.lockTimeout||(this.$options.lockTimeout=setTimeout(()=>{this.isLocked=!1},3e3))},async addOneAsset(e,s=1){this.isLocked=!0;const t=Object.keys(this.selection).filter(l=>this.selection[l]);for(const l of t){this.addAssetToCasting({entityId:l,assetId:e,nbOccurences:s,label:this.castingType==="shot"?"animate":"fixed"}),delete this.saveErrors[l];try{await this.saveCasting(l),this.setLock()}catch(a){this.saveErrors[l]=!0,console.error(a)}}},async addTenAssets(e){this.addOneAsset(e,10)},confirmAssetRemoval(){this.saveAssetRemoval(this.removalData.entityId,this.removalData.assetId,this.removalData.nbOccurences)},saveAssetRemoval(e,s,t){return this.loading.remove=!0,this.removeAssetFromCasting({entityId:e,assetId:s,nbOccurences:t}),delete this.saveErrors[e],this.saveCasting(e).then(()=>{this.setLock(),this.modals.isRemoveConfirmationDisplayed=!1}).catch(l=>{this.saveErrors[e]=!0,this.errors.remove=!0,console.error(l)}).finally(()=>{this.loading.remove=!1})},async removeOneAssetFromSelection(e){const s=Object.keys(this.selection).filter(t=>this.selection[t]);for(const t of s){const l=this.casting[t].find(a=>a.asset_id===e);l&&await this.removeOneAsset(e,t,l.nb_occurences)}},removeOneAsset(e,s,t){return this.isLocked=!0,this.isEpisodeCasting&&t===1?(this.removalData={assetId:e,entityId:s,nbOccurences:t},this.modals.isRemoveConfirmationDisplayed=!0,Promise.resolve()):this.saveAssetRemoval(s,e,1)},onAssetListScroll(e){const s=this.$refs["asset-list"],t=s.scrollHeight-s.offsetHeight,l=e.target;t<l.scrollTop+100&&this.displayMoreAssets()},showImportModal(){this.modals.importing=!0},hideImportModal(){this.modals.importing=!1},showImportRenderModal(){this.modals.isImportRenderDisplayed=!0},hideImportRenderModal(){this.modals.isImportRenderDisplayed=!1},renderImport(e,s){this.loading.importing=!0,this.errors.importing=!1,s==="file"&&(e=e.get("file")),D.processCSV(e).then(t=>{this.parsedCSV=t,this.hideImportModal(),this.loading.importing=!1,this.showImportRenderModal()})},uploadImportFile(e){const s=new FormData,t="import.csv",l=D.turnEntriesToCsvString(e),a=new File([l],t,{type:"text/csv"});s.append("file",a),this.loading.importing=!0,this.errors.importing=!1,this.errors.importingError=null,this.importCsvFormData=s,this.uploadCastingFile(this.importCsvFormData).then(()=>{this.hideImportRenderModal(),this.sequenceId&&this.setCastingSequence(this.sequenceId||"all")}).catch(i=>{this.errors.importingError=i,this.errors.importing=!0}).finally(()=>{this.loading.importing=!1})},resetImport(){this.errors.importing=!1,this.errors.importingError=null,this.hideImportRenderModal(),this.importCsvFormData=void 0,this.$refs["import-modal"].reset(),this.showImportModal()},updateUrl(){let e=!1,s={};if(this.isEpisodeCasting?this.$route.params.episode_id!==this.episodeId&&(e=!0,s={name:"breakdown-episode",params:{production_id:this.currentProduction.id,episode_id:this.episodeId}}):this.isAssetCasting?(this.$route.params.asset_type_id||"")!==this.assetTypeId&&(e=!0,s={name:"breakdown-asset-type",params:{production_id:this.currentProduction.id,asset_type_id:this.assetTypeId}}):(this.$route.params.sequence_id||"all")!==this.sequenceId&&(e=!0,s={name:"breakdown-sequence",params:{production_id:this.currentProduction.id,sequence_id:this.sequenceId||"all"}}),e){let t=this.$route.params.episode_id;!t&&this.currentEpisode&&(t=this.currentEpisode.id),t&&(s.name=`episode-${s.name}`,s.params.episode_id=t,t==="all"&&(s.params.sequence_id="all")),this.$router.push(s)}},onEditLabelClicked(e,s,t){this.editedAsset=e,this.editedEntityId=t,this.editedAssetLinkLabel=s,this.modals.isEditLabelDisplayed=!0},confirmEditLabel(e={}){const s=e.label;this.loading.editLabel=!0,this.setAssetLinkLabel({label:s,asset:this.editedAsset,targetEntityId:this.editedEntityId}).then(()=>{this.modals.isEditLabelDisplayed=!1,this.loading.editLabel=!1}).catch(t=>{console.error(t),this.errors.editLabel=!0,this.loading.editLabel=!1})},toggleTextMode(){this.isTextMode=!this.isTextMode,localStorage.setItem("breakdown:text-mode",this.isTextMode)},toggleColumnSelector(){this.columnSelectorDisplayed=!this.columnSelectorDisplayed},confirmNewAssetStay(e){this.loading.stay=!0,this.success.edit=!1,this.newAsset(e).then(s=>{this.loading.stay=!1,this.loading.edit=!1,this.resetLightEditModal(s),this.$refs["edit-asset-modal"].focusName(),this.success.edit=!0}).catch(s=>{console.error(s),this.loading.stay=!1,this.loading.edit=!1,this.success.edit=!1,this.errors.edit=!0})},confirmNewAsset(e){this.loading.edit=!0,this.errors.edit=!1,this.newAsset(e).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1}).catch(s=>{console.error(s),this.loading.edit=!1,this.errors.edit=!0})},resetLightEditModal(e){const s={name:"",entity_type_id:e.entit_type_id,production_id:this.currentProduction.id};this.assetToEdit=s},onKeyDown(e){["INPUT","TEXTAREA"].includes(e.target.tagName)||((e.ctrlKey||e.metaKey)&&e.keyCode===67?this.copyCasting():(e.ctrlKey||e.metaKey)&&e.keyCode===86&&this.pasteCasting())},copyCasting(){const e=Object.keys(this.selection).find(t=>this.selection[t]),s=this.casting[e];B.copyCasting(s)},async pasteCasting(){const e=B.pasteCasting();if(!e||e.length===0)return;const s=Object.keys(this.selection).filter(t=>this.selection[t]);for(const t of s)this.setEntityCasting({entityId:t,casting:e}),delete this.saveErrors[t],await this.saveCasting(t).then(this.setLock).catch(l=>{this.saveErrors[t]=!0,console.error(l)});return e},onMetadataChanged({entry:e,descriptor:s,value:t}){const l={};l[s.field_name]=t;const a={id:e.id,data:l};this.isEpisodeCasting?this.editEpisode(a):this.isShotCasting?this.editShot(a):this.editAsset(a)},onDescriptionChanged(e,s){const t={id:e.id,description:s};this.isEpisodeCasting?this.editEpisode(t):this.isShotCasting?this.editShot(t):this.editAsset(t)},onStandbyChanged(e,s){const t={id:e.id,is_casting_standby:s};this.isEpisodeCasting?this.editEpisode(t):this.isShotCasting?this.editShot(t):this.editAsset(t)},descriptorCurrentDepartments(e){return(e.departments||[]).map(t=>this.departmentMap.get(t))},getEntityName(e){return this.sequenceId==="all"&&(!this.isTVShow||this.isTVShow&&this.currentEpisode.id!=="all")?e.sequence_name+" / "+e.name:e.name},getCsvFileName(){const e=[ge().format("YYYY-MM-DD"),"kitsu",this.castingType+"s",this.currentProduction.name,this.$t("breakdown.title")];return this.isTVShow?this.currentEpisode&&(this.currentEpisode.id==="all"?e.splice(4,0,"all"):this.currentEpisode.id==="main"?(e.splice(4,0,"main pack"),this.assetTypeId!=="all"&&this.castingType==="asset"&&e.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name)):(e.splice(4,0,this.currentEpisode.name),this.sequenceId!=="all"&&this.castingType==="shot"&&e.splice(5,0,this.sequenceMap.get(this.sequenceId).name),this.assetTypeId!=="all"&&this.castingType==="asset"&&e.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name))):(this.sequenceId!=="all"&&this.castingType==="shot"&&e.splice(5,0,this.sequenceMap.get(this.sequenceId).name),this.assetTypeId!=="all"&&this.castingType==="asset"&&e.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name)),F.slugify(e.join("_"))},getCsvFileHeaders(){const e=[this.$t("shots.fields.name"),this.$t("breakdown.fields.standby")];return this.isFrames&&e.push(this.$t("main.frames")),this.isFrameIn&&e.push(this.$t("main.frame_in")),this.isFrameOut&&e.push(this.$t("main.frame_out")),this.metadataDescriptors.forEach(s=>{e.push(s.name)}),e.concat(this.castingAssetTypes)},getCsvEntries(){return this.castingEntities.map(s=>{const t=[s.name,s.is_casting_standby?"X":""];this.isFrames&&t.push(s.nb_frames),this.isFrameIn&&t.push(s.data.frame_in),this.isFrameOut&&t.push(s.data.frame_out),this.metadataDescriptors.forEach(i=>{t.push(s.data[i.field_name]||"")});const l=this.castingByType[s.id]||[],a={};return l.forEach(i=>{a[i[0].asset_type_name]=i}),this.castingAssetTypes.forEach(i=>{const h=a[i]||[],v=h.reduce((o,u)=>o+u.nb_occurences,0);if(v>0){let o=v+" assets: ";o+=h.map(u=>u.asset_name+" ("+u.nb_occurences+")").join(", "),t.push(o)}else t.push("")}),t})},exportViewToCsv(){const e=this.getCsvEntries(),s=this.getCsvFileName(),t=this.getCsvFileHeaders();D.buildCsvFile(s,[t].concat(e))},removeSearchQuery(e){this.removeBreakdownSearch(e).catch(console.error)},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveBreakdownSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},initResize(e,s,t){this.resizedKnobRefName=e+(t||""),this.resizedRefName=s+(t||""),this.resizedDescriptorId=t,window.addEventListener("mousemove",this.startResizing),window.addEventListener("mouseup",this.stopResizing)},startResizing(e){const s=this.resizedKnobRefName,t=this.resizedRefName,l=this.$refs[s][0]?this.$refs[s][0]:this.$refs[s],a=this.$refs[t][0]?this.$refs[t][0]:this.$refs[t],i=e.clientX-l.getBoundingClientRect().left,h=a.getBoundingClientRect().width;if(this.columnWidth={...this.columnWidth},this.resizedDescriptorId){const v=Math.max(h+i,110);this.columnWidth[this.resizedDescriptorId]=v;const o=`breakdown:column-width-descriptor-${this.resizedDescriptorId}`;T.setPreference(o,v)}else{const v=Math.max(h+i,160);this.columnWidth.name=v;const o=`breakdown:column-width-name-${this.castingType}-${this.currentProduction.id}`;T.setPreference(o,v)}},stopResizing(){window.removeEventListener("mousemove",this.startResizing),window.removeEventListener("mouseup",this.stopResizing),this.resizedKnobRefName=null,this.resizedRefName=null,this.resizedDescriptorId=null},resetDisplayHeaders(){this.isEpisodeCasting?this.metadataDisplayHeaders={}:this.isShotCasting?this.metadataDisplayHeaders={stdby:!0,fps:!1,frameIn:!0,frameOut:!0,frames:!0,estimation:!1,maxRetakes:!1,resolution:!1,timeSpent:!1}:this.metadataDisplayHeaders={estimation:!1,readyFor:!1,timeSpent:!1}},resetColumnWidth(){const e=`breakdown:column-width-name-${this.castingType}-${this.currentProduction.id}`,s=T.getPreference(e);s&&(this.columnWidth.name=s),this.metadataDescriptors.forEach(t=>{const l=T.getPreference(`breakdown:column-width-descriptor-${t.id}`);l&&(this.columnWidth[t.id]=l)})},onCastingHeaderScroll(e){const s=e.target;this.$refs["casting-list"].scrollLeft=s.scrollLeft},onCastingScroll(e){const s=e.target;this.$refs["casting-header"].scrollLeft=s.scrollLeft}},watch:{castingType(){if(this.isShotCasting&&this.displayedSequences.length>0&&(this.sequenceId=this.displayedSequences[0].id,this.assetTypeId=""),this.isAssetCasting&&this.castingAssetTypesOptions.length>0){const e=this.$route.params.asset_type_id;this.sequenceId="all",this.castingType="asset",e?this.assetTypeId=e:this.castingAssetTypesOptions.length>0&&(this.assetTypeId=this.castingAssetTypesOptions[0].value)}this.resetDisplayHeaders(),this.resetColumnWidth()},sequenceId(){this.sequenceId&&this.displayedSequences&&this.displayedSequences.length>0&&!this.isAssetCasting&&(this.setCastingSequence(this.sequenceId),this.updateUrl(),this.resetSelection())},assetTypeId(){this.assetTypeId&&this.castingAssetTypesOptions.length>0&&(this.setCastingAssetType(this.assetTypeId),this.updateUrl(),this.resetSelection())},episodeId(){this.episodeId&&this.episodes&&this.episodes.length>0&&(this.episodeId==="all"&&this.setCastingForProductionEpisodes(this.episodeId),this.resetSelection())},castingSequencesOptions(){if(this.$route.path.indexOf("asset-type")<0){const e=this.$route.params.sequence_id||"all";e&&this.sequenceMap.get(e)?this.sequenceId=e:this.castingSequencesOptions.length>0?this.sequenceId=this.castingSequencesOptions[0].value:this.sequenceId="all"}},castingAssetTypesOptions(){if(this.$route.path.indexOf("asset-type")>0){const e=this.$route.params.asset_type_id;this.castingType="asset",e?this.assetTypeId=e:this.castingAssetTypesOptions.length>0?this.assetTypeId=this.castingAssetTypesOptions[0].value:this.assetTypeId=""}},currentProduction(){this.isLoading||(this.reset(),this.resetColumnWidth())},currentEpisode(){this.currentEpisode&&this.episodeId!==this.currentEpisode.id&&!this.isLoading&&(this.currentEpisode.id==="all"?this.episodeId="all":this.reset())},displayedSequences(){this.$store.commit("CASTING_SET_SEQUENCES",this.displayedSequences)}},socket:{events:{"episode:casting-update"(e){const s=this.episodeMap.get(e.episode_id);s&&!this.isLocked&&this.loadEpisodeCasting(s)},"shot:casting-update"(e){const s=this.shotMap.get(e.shot_id);s&&s.sequence_id===this.sequenceId&&!this.isLocked&&this.loadShotCasting(s)},"asset:casting-update"(e){const s=this.assetMap.get(e.asset_id);s&&s.asset_type_id===this.assetTypeId&&!this.isLocked&&this.loadAssetCasting(s)}}},head(){var e,s;return this.isTVShow?{title:`${((e=this.currentProduction)==null?void 0:e.name)||""} - ${((s=this.currentEpisode)==null?void 0:s.name)||""} | ${this.$t("breakdown.title")} - Kitsu`}:{title:`${this.currentProduction.name} | ${this.$t("breakdown.title")} - Kitsu`}}},As={class:"breakdown page"},Is={class:"breakdown-columns"},Ms={class:"breakdown-column casting-column"},Ds={class:"flexrow mb1"},Os={key:0},Ls={class:"subtitle mt05"},Bs={class:"flexrow mb05 list-options"},Fs={key:0,class:"standby-header"},qs={key:1,class:"description-header"},xs={key:2,class:"frames-header"},Rs={key:3,class:"frames-header"},Vs={key:4,class:"frames-header"},Ns={key:0,class:"mr1"},Ps=["title"],zs=["onMousedown"],Us={class:"shot-lines"},Hs={class:"subtitle"},Ws={class:"flexrow mt1 mb1"},Ks={class:"filters-area flexrow"},js={class:"query-list"},Qs={class:"asset-type"},Gs={class:"asset-list"};function Ys(e,s,t,l,a,i){const h=p("combobox-styled"),v=p("show-infos-button"),o=p("button-simple"),u=p("button-href-link"),k=p("spinner"),M=p("table-metadata-selector-menu"),R=p("department-name"),V=p("shot-line"),N=p("search-field"),P=p("search-query-list"),z=p("available-asset-block"),U=p("import-render-modal"),H=p("import-modal"),W=p("edit-label-modal"),K=p("build-filter-modal"),j=p("edit-asset-modal"),Q=p("delete-modal");return n(),r("div",As,[c("div",Is,[c("div",Ms,[c("div",Ds,[i.isEpisodeCasting?(n(),r("div",Os,[c("h2",Ls,f(e.$t("breakdown.episode_casting")),1)])):m("",!0),i.isEpisodeCasting?m("",!0):(n(),y(h,{key:1,class:"mr1",label:e.$t("main.for"),options:i.castingTypeOptions,modelValue:a.castingType,"onUpdate:modelValue":s[0]||(s[0]=d=>a.castingType=d)},null,8,["label","options","modelValue"])),i.isShotCasting?(n(),y(h,{key:2,label:e.$t("shots.fields.sequence"),options:e.castingSequencesOptions,modelValue:a.sequenceId,"onUpdate:modelValue":s[1]||(s[1]=d=>a.sequenceId=d)},null,8,["label","options","modelValue"])):m("",!0),i.isAssetCasting?(n(),y(h,{key:3,label:e.$t("tasks.fields.asset_type"),options:e.castingAssetTypesOptions,modelValue:a.assetTypeId,"onUpdate:modelValue":s[2]||(s[2]=d=>a.assetTypeId=d)},null,8,["label","options","modelValue"])):m("",!0),s[17]||(s[17]=c("span",{class:"filler"},null,-1)),g(v,{class:"flexrow-item","is-breakdown":!0}),g(o,{class:"flexrow-item",title:a.isTextMode?e.$t("breakdown.picture_mode"):e.$t("breakdown.text_mode"),icon:"type","is-on":a.isTextMode,"is-responsive":!0,onClick:i.toggleTextMode},null,8,["title","is-on","onClick"]),g(o,{class:"flexrow-item",icon:"big-thumbnail","is-on":a.isBigMode,title:e.$t("tasks.big_thumbnails"),onClick:s[3]||(s[3]=d=>a.isBigMode=!a.isBigMode)},null,8,["is-on","title"]),e.isCurrentUserManager?(n(),y(o,{key:4,class:"flexrow-item",title:e.$t("main.csv.import_file"),icon:"import","is-responsive":!0,onClick:i.showImportModal},null,8,["title","onClick"])):m("",!0),g(o,{class:"flexrow-item",icon:"export","is-responsive":!0,title:e.$t("main.csv.export_current_view"),onClick:i.exportViewToCsv},null,8,["title","onClick"]),e.isCurrentUserManager?(n(),y(u,{key:5,class:"flexrow-item",title:e.$t("main.csv.export_file"),icon:"export-lines","is-responsive":!0,path:i.exportUrlPath},null,8,["title","path"])):m("",!0)]),a.isLoading?(n(),y(k,{key:0,class:"mt1"})):m("",!0),c("div",Bs,[e.isShowInfosBreakdown?I((n(),y(M,{key:0,namespace:"breakdown",descriptors:i.metadataDescriptors,exclude:{fps:!0,estimation:!0,resolution:!0,maxRetakes:!0,timeSpent:!0},modelValue:a.metadataDisplayHeaders,"onUpdate:modelValue":s[4]||(s[4]=d=>a.metadataDisplayHeaders=d)},null,8,["descriptors","modelValue"])),[[O,a.columnSelectorDisplayed]]):m("",!0),s[18]||(s[18]=c("span",{class:"filler"},null,-1)),e.isShowInfosBreakdown?(n(),y(o,{key:1,class:"is-small mr05",icon:"down",onClick:i.toggleColumnSelector},null,8,["onClick"])):m("",!0)]),a.isLoading?m("",!0):(n(),r("div",{key:1,ref:"casting-header",class:"casting-header flexrow",onScrollPassive:s[6]||(s[6]=(...d)=>i.onCastingHeaderScroll&&i.onCastingHeaderScroll(...d))},[c("div",{class:"entity-header",ref:"name-header",style:_({"min-width":a.columnWidth.name?a.columnWidth.name+"px":"250px"})},[c("div",null,f(e.$t("shots.fields.name")),1),s[19]||(s[19]=c("div",{class:"filler"},null,-1)),c("div",{ref:"resizable-knob-name",class:"resizable-knob",onMousedown:s[5]||(s[5]=S(d=>i.initResize("resizable-knob-name","name-header"),["prevent"]))},null,544)],4),e.isShowInfosBreakdown?(n(),r("div",Fs,f(e.$t("breakdown.fields.standby")),1)):m("",!0),e.isShowInfosBreakdown&&i.isDescription?(n(),r("div",qs,f(e.$t("shots.fields.description")),1)):m("",!0),i.isShotCasting&&e.isFrames&&e.isShowInfosBreakdown&&a.metadataDisplayHeaders.frames?(n(),r("div",xs,f(e.$t("shots.fields.nb_frames")),1)):m("",!0),i.isShotCasting&&e.isFrameIn&&e.isShowInfosBreakdown&&a.metadataDisplayHeaders.frameIn?(n(),r("div",Rs,f(e.$t("shots.fields.frame_in")),1)):m("",!0),i.isShotCasting&&e.isFrameOut&&e.isShowInfosBreakdown&&a.metadataDisplayHeaders.frameOut?(n(),r("div",Vs,f(e.$t("shots.fields.frame_out")),1)):m("",!0),(n(!0),r(b,null,C(e.visibleMetadataDescriptors,d=>I((n(),r("div",{class:"descriptor-header",key:"descriptor-header-"+d.id,ref_for:!0,ref:"descriptor-header-"+d.id,style:_({"min-width":a.columnWidth[d.id]?a.columnWidth[d.id]+"px":"110px"})},[i.descriptorCurrentDepartments(d).length?(n(),r("div",Ns,[(n(!0),r(b,null,C(i.descriptorCurrentDepartments(d),w=>(n(),y(R,{key:w.id,department:w,"no-padding":"","only-dot":""},null,8,["department"]))),128))])):m("",!0),c("span",{class:"flexrow-item ellipsis descriptor-name filler",title:d.name},f(d.name),9,Ps),c("div",{ref_for:!0,ref:"resizable-knob-descriptor-"+d.id,class:"resizable-knob",onMousedown:S(w=>i.initResize("resizable-knob-descriptor-","descriptor-header-",d.id),["prevent"])},null,40,zs)],4)),[[O,e.isShowInfosBreakdown]])),128)),(n(!0),r(b,null,C(i.castingAssetTypes,d=>(n(),r("div",{key:d,class:"asset-type-header"},f(d),1))),128)),s[20]||(s[20]=c("div",{class:"actions filler"},null,-1))],544)),a.isLoading?m("",!0):(n(),r("div",{key:2,ref:"casting-list",class:"casting-list",onScrollPassive:s[7]||(s[7]=(...d)=>i.onCastingScroll&&i.onCastingScroll(...d))},[c("div",Us,[(n(!0),r(b,null,C(i.castingEntities,d=>(n(),y(V,{key:d.id,entity:d,"preview-file-id":d.preview_file_id,selected:a.selection[d.id],name:i.getEntityName(d),assets:e.castingByType[d.id]||[],"asset-types":i.castingAssetTypes,"read-only":!e.isCurrentUserManager,"text-mode":a.isTextMode,"metadata-descriptors":i.metadataDescriptors,"metadata-display-headers":a.metadataDisplayHeaders,"big-mode":a.isBigMode,"is-description":i.isDescription,"is-save-error":a.saveErrors[d.id],"column-width":a.columnWidth,onAddOne:i.addOneAsset,onClick:i.selectEntity,onDescriptionChanged:i.onDescriptionChanged,onEditLabel:i.onEditLabelClicked,onMetadataChanged:i.onMetadataChanged,onRemoveOne:i.removeOneAssetFromSelection,onStandbyChanged:i.onStandbyChanged},null,8,["entity","preview-file-id","selected","name","assets","asset-types","read-only","text-mode","metadata-descriptors","metadata-display-headers","big-mode","is-description","is-save-error","column-width","onAddOne","onClick","onDescriptionChanged","onEditLabel","onMetadataChanged","onRemoveOne","onStandbyChanged"]))),128))])],544))]),e.isCurrentUserManager?(n(),r("div",{key:0,ref:"asset-list",onScrollPassive:s[12]||(s[12]=(...d)=>i.onAssetListScroll&&i.onAssetListScroll(...d)),class:"breakdown-column assets-column"},[c("h2",Hs,f(e.$t("breakdown.all_assets")),1),c("div",Ws,[a.isOnlyCurrentEpisode?m("",!0):(n(),y(o,{key:0,class:"flexrow-item",title:e.$t("assets.new_asset"),icon:"plus",onClick:s[8]||(s[8]=d=>a.modals.isNewDisplayed=!0)},null,8,["title"])),s[21]||(s[21]=c("span",{class:"filler"},null,-1)),a.isOnlyCurrentEpisode?m("",!0):(n(),y(o,{key:1,class:"flexrow-item",text:e.$t("breakdown.show_library"),icon:"assets","is-on":a.libraryDisplayed,onClick:s[9]||(s[9]=d=>a.libraryDisplayed=!a.libraryDisplayed)},null,8,["text","is-on"])),e.isTVShow&&!i.isEpisodeCasting?(n(),y(o,{key:2,class:"flexrow-item",text:e.$t("assets.only_current_episode"),"is-on":a.isOnlyCurrentEpisode,onClick:s[10]||(s[10]=d=>a.isOnlyCurrentEpisode=!a.isOnlyCurrentEpisode)},null,8,["text","is-on"])):m("",!0)]),c("div",Ks,[g(N,{class:"flexrow-item",ref:"search-field","can-save":!0,onSave:i.saveSearchQuery,onChange:i.onSearchChange},null,8,["onSave","onChange"]),g(o,{class:"flexrow-item",title:e.$t("entities.build_filter.title"),icon:"filter",onClick:s[11]||(s[11]=d=>a.modals.isBuildFilterDisplayed=!0)},null,8,["title"])]),c("div",js,[g(P,{groups:e.breakdownSearchFilterGroups,"is-group-enabled":!0,queries:e.breakdownSearchQueries,type:"breakdown",onChangeSearch:e.changeSearch,onRemoveSearch:i.removeSearchQuery},null,8,["groups","queries","onChangeSearch","onRemoveSearch"])]),e.isAssetsLoading?(n(),y(k,{key:0})):(n(!0),r(b,{key:1},C(i.availableAssetsByType,d=>(n(),r("div",{class:"type-assets",key:d.length>0?d[0].asset_type_name:""},[c("div",Qs,f(d.length>0?d[0].asset_type_name:""),1),c("div",Gs,[(n(!0),r(b,null,C(d,w=>I((n(),y(z,{key:w.id,asset:w,active:Object.keys(a.selection).length>0,"text-mode":a.isTextMode,"big-mode":a.isBigMode,onAddOne:i.addOneAsset,onAddTen:i.addTenAssets},null,8,["asset","active","text-mode","big-mode","onAddOne","onAddTen"])),[[O,a.libraryDisplayed||!w.shared]])),128))])]))),128))],544)):m("",!0)]),g(U,{active:a.modals.isImportRenderDisplayed,"is-loading":a.loading.importing,"is-error":a.errors.importing,"import-error":a.errors.importingError,"parsed-csv":a.parsedCSV,"form-data":a.importCsvFormData,columns:i.renderColumns,"data-matchers":i.dataMatchers,database:i.filteredCasting,"disable-update":!0,onReupload:i.resetImport,onCancel:i.hideImportRenderModal,onConfirm:i.uploadImportFile},null,8,["active","is-loading","is-error","import-error","parsed-csv","form-data","columns","data-matchers","database","onReupload","onCancel","onConfirm"]),g(H,{ref:"import-modal",active:a.modals.importing,"is-loading":a.loading.importing,"is-error":a.errors.importing,"form-data":a.importCsvFormData,columns:i.csvColumns,"optional-columns":a.optionalCsvColumns,onCancel:i.hideImportModal,onConfirm:i.renderImport},null,8,["active","is-loading","is-error","form-data","columns","optional-columns","onCancel","onConfirm"]),g(W,{ref:"edit-label-modal",active:a.modals.isEditLabelDisplayed,"is-loading":a.loading.editLabel,"is-error":a.loading.editError,asset:a.editedAsset,label:a.editedAssetLinkLabel,onCancel:s[13]||(s[13]=d=>a.modals.isEditLabelDisplayed=!1),onConfirm:i.confirmEditLabel},null,8,["active","is-loading","is-error","asset","label","onConfirm"]),g(K,{ref:"build-filter-modal",active:a.modals.isBuildFilterDisplayed,onConfirm:i.confirmBuildFilter,onCancel:s[14]||(s[14]=d=>a.modals.isBuildFilterDisplayed=!1)},null,8,["active","onConfirm"]),g(j,{ref:"edit-asset-modal",active:a.modals.isNewDisplayed,"asset-to-edit":{},"is-error":a.errors.edit,"is-loading":a.loading.edit,"is-loading-stay":a.loading.stay,"is-success":a.success.edit,onConfirm:i.confirmNewAsset,onConfirmAndStay:i.confirmNewAssetStay,onCancel:s[15]||(s[15]=d=>a.modals.isNewDisplayed=!1)},null,8,["active","is-error","is-loading","is-loading-stay","is-success","onConfirm","onConfirmAndStay"]),g(Q,{active:a.modals.isRemoveConfirmationDisplayed,"delete-button-text":e.$t("breakdown.remove.confirm"),"error-text":e.$t("breakdown.remove.error"),"is-loading":a.loading.remove,"is-error":a.loading.error,text:e.$t("breakdown.remove.text"),onConfirm:i.confirmAssetRemoval,onCancel:s[16]||(s[16]=d=>a.modals.isRemoveConfirmationDisplayed=!1)},null,8,["active","delete-button-text","error-text","is-loading","is-error","text","onConfirm"])])}const $s=A(Ts,[["render",Ys],["__scopeId","data-v-02857237"]]);export{$s as default};
//# sourceMappingURL=Breakdown-BOZZd_Wh.js.map
