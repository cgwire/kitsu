import{_ as L,B as V,r as a,o as d,c as f,d as p,g as k,h as u,k as v,v as B,f as n,t as h,p as _,ar as x,a as M,u as m,as as P,m as E,s as j,b as O,at as G}from"./index-C2m_IhNF.js";import{C as U}from"./Combobox-DQpIQydI.js";import{C as D}from"./ComboboxStatus-DYpCiml-.js";import{C as F}from"./ComboboxProduction-Dndrtu96.js";import{C as N}from"./ComboboxTaskType-CiBcPUsC.js";import{P as q}from"./PeopleField-CJ8IkJD1.js";import A from"./TaskInfo-C8qSIbPH.js";import{T as K}from"./TodosList-C3TWuqz_.js";import{V as z}from"./PreviewPlayer-CsSraBfQ.js";import"./TaskTypeName-bEgQZfX7.js";import"./csv-cx9HGs3n.js";import"./string-B0Tq569e.js";import"./render-Bqw3AFAH.js";import"./video-Yn96Kb74.js";import"./dom-tO7tlkHV.js";import"./BuildFilterModal-C3nrV5vY.js";import"./ComboboxStyled-fscUNRmK.js";import"./ComboboxBoolean-DJwCfClJ.js";import"./TextField-p_HJuEKt.js";import"./ModalFooter-BJ98b-60.js";import"./DeleteEntities-ZGV8gTRL.js";import"./HardDeleteModal-CyBgP8oG.js";import"./SearchField-DO27Jrsj.js";import"./corner-right-up-xElzR7oO.js";import"./thumbs-up-DoHhBcNt.js";import"./DeleteModal-CaB_X4-T.js";import"./format-CUjWrpVJ.js";import"./MetadataHeader-BasyloSw.js";import"./DepartmentName-C_7ZW05X.js";import"./DescriptionCell-JDDrCWCB.js";import"./ProductionNameCell-Bu7vB3PB.js";import"./TaskTypeCell-DM2gnWrD.js";import"./TableInfo-B2X54z7i.js";import"./ValidationCell-D9FwmVzb.js";import"./eye-CKzk1Q6q.js";import"./DateField-OvNA3wsX.js";import"./PlaylistPlayer-DoTL8QsR.js";import"./ComboboxSimple-DU0Ahozo.js";import"./clipboard-CQqgyZ_h.js";import"./index-KDZ8UbBO.js";import"./BaseModal-BCd5z4wK.js";import"./ComboboxDepartment-whRm-Bo0.js";import"./ComboboxStudio-q2R7SCuH.js";import"./play-B4GV49GM.js";import"./EmojiButton-B9I5hDFH.js";import"./FileUpload-C4E3YXqL.js";import"./ConfirmModal-CYuRpfjg.js";import"./triangle-alert-DAfmXCpT.js";import"./ValidationTag-C6BUHddW.js";import"./copy-BH2iDnK6.js";import"./vue.esm-bundler-Cb2j4MJL.js";import"./VideoViewer-Da8LCLxo.js";const H={name:"my-checks",components:{ButtonSimple:V,Combobox:U,ComboboxProduction:F,ComboboxStatus:D,ComboboxTaskType:N,PeopleField:q,TaskInfo:A,TodosList:K,ViewPlaylistModal:z},data(){return{currentFilter:"all_tasks",currentSort:"priority",episodeId:"",isLoading:!1,isLoadingError:!1,isPlaylist:!1,filterOptions:["all_tasks","due_this_week"].map(t=>({label:t,value:t})),person:{},productionId:"",productionList:[],selectionGrid:{},sortOptions:["entity_name","priority","due_date","estimation","last_comment_date"].map(t=>({label:t,value:t})),taskStatusId:"",taskTypeId:"",taskStatusList:[],taskTypeList:[],tasksToCheck:[]}},mounted(){this.isLoading=!0,this.clearSelectedTasks(),this.loadTasksToCheck().then(t=>{t&&(t.forEach(G),this.buildSelectionGrid(t),this.resetProductionList(t),this.resetTaskTypeList(t),this.resetTaskStatusList(t),this.tasksToCheck=t,this.isLoading=!1)}).catch(t=>{console.error(t)})},computed:{...O(["nbSelectedTasks","personMap","productionMap","selectedTasks","taskStatusMap","taskTypeMap"]),nbTasksToCheck(){return this.sortedTasks.filter(t=>this.taskStatusMap.get(t.task_status_id).is_feedback_request).length},assignees(){const t=[],e={};return this.tasksToCheck.forEach(r=>{r.assignees.forEach(o=>{e[o]||(t.push(this.personMap.get(o)),e[o]=!0)})}),j(t)},episodeOptions(){const t=[],e={};return this.productionId?this.productionMap.get(this.productionId).production_type!=="tvshow"?[]:(this.tasksToCheck.filter(o=>o.project_id===this.productionId).forEach(o=>{o.episode_id&&!e[o.episode_id]&&o.entity_type_name==="Shot"&&(e[o.episode_id]=!0,t.push({label:o.episode_name,value:o.episode_id}))}),[{label:this.$t("main.all"),value:"all"}].concat(t.sort((o,s)=>o.label.localeCompare(s.label,void 0,{numeric:!0})))):[]},filteredTasks(){let t=this.currentFilter==="all_tasks"?[...this.tasksToCheck]:this.tasksToCheck.filter(e=>{const r=P(e.due_date);return E().startOf("week").isSame(r,"week")});return this.productionId!==""&&(t=t.filter(e=>e.project_id===this.productionId)),this.taskTypeId!==""&&(t=t.filter(e=>e.task_type_id===this.taskTypeId)),this.taskStatusId!==""&&(t=t.filter(e=>e.task_status_id===this.taskStatusId)),this.person&&this.person.id&&(t=t.filter(e=>e.assignees.includes(this.person.id))),this.productionId&&this.episodeId&&this.episodeId!=="all"&&(t=t.filter(e=>e.episode_id===this.episodeId)),t},sortedTasks(){const t=this.currentSort==="entity_name",e=this.currentSort==="priority",r=this.currentSort==="due_date",o=[...this.filteredTasks];return t?o.sort(m.firstBy("project_name").thenBy("task_type_name").thenBy("full_entity_name")):e?o.sort(m.firstBy("priority",-1).thenBy((s,l)=>s.due_date?l.due_date?s.due_date.localeCompare(l.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):r?o.sort(m.firstBy((s,l)=>s.due_date?l.due_date?s.due_date.localeCompare(l.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):o.sort(m.firstBy(this.currentSort,-1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name"))}},methods:{...M(["clearSelectedTasks","loadTasksToCheck"]),buildSelectionGrid(t){this.selectionGrid=x(t.length,1)},resetProductionList(t=[]){const e={},r=[];t.forEach(o=>{e[o.project_id]||(e[o.project_id]=!0,r.push(this.productionMap.get(o.project_id)))}),this.productionList=[{id:"",name:this.$t("main.all")}].concat(_(r))},resetTaskTypeList(t){const e={},r=[];t.forEach(o=>{e[o.task_type_id]||(e[o.task_type_id]=!0,r.push(this.taskTypeMap.get(o.task_type_id)))}),this.taskTypeList=[{id:"",color:"#999",name:this.$t("news.all")}].concat(_(r))},resetTaskStatusList(t){const e={},r=[];t.forEach(o=>{e[o.task_status_id]||(e[o.task_status_id]=!0,r.push(this.taskStatusMap.get(o.task_status_id)))}),this.taskStatusList=[{id:"",color:"#999",name:this.$t("news.all"),short_name:this.$t("news.all")}].concat(_(r))}},watch:{productionId(){this.episodeId=""},nbSelectedTasks(){this.nbSelectedTasks===0&&this.buildSelectionGrid(this.sortedTasks)}},head(){return{title:`${this.$t("tasks.my_checks")} - Kitsu`}}},J={class:"columns fixed-page"},Q={class:"column main-column"},R={class:"todos page"},W={class:"flexrow"},X={class:"field flexrow-item selector"},Y={class:"label person-label"},Z={class:"flexrow"},$={class:"title mt1 flexrow-item filler"},tt={key:0,class:"column side-column"};function et(t,e,r,o,s,l){const y=a("combobox-production"),c=a("combobox"),b=a("combobox-task-type"),T=a("combobox-status"),S=a("people-field"),g=a("button-simple"),I=a("todos-list"),w=a("task-info"),C=a("view-playlist-modal");return d(),f("div",J,[p("div",Q,[p("div",R,[p("div",W,[s.productionList.length>0?(d(),k(y,{key:0,class:"flexrow-item",label:t.$t("main.production"),"production-list":s.productionList,modelValue:s.productionId,"onUpdate:modelValue":e[0]||(e[0]=i=>s.productionId=i)},null,8,["label","production-list","modelValue"])):u("",!0),l.episodeOptions.length>0?v((d(),k(c,{key:1,class:"flexrow-item",label:t.$t("shots.fields.episode"),options:l.episodeOptions,modelValue:s.episodeId,"onUpdate:modelValue":e[1]||(e[1]=i=>s.episodeId=i)},null,8,["label","options","modelValue"])),[[B,s.productionId]]):u("",!0),s.taskTypeList.length>0?(d(),k(b,{key:2,class:"flexrow-item selector",label:t.$t("news.task_type"),"task-type-list":s.taskTypeList,modelValue:s.taskTypeId,"onUpdate:modelValue":e[2]||(e[2]=i=>s.taskTypeId=i)},null,8,["label","task-type-list","modelValue"])):u("",!0),n(T,{class:"flexrow-item selector",label:t.$t("news.task_status"),"task-status-list":s.taskStatusList,modelValue:s.taskStatusId,"onUpdate:modelValue":e[3]||(e[3]=i=>s.taskStatusId=i)},null,8,["label","task-status-list","modelValue"]),p("div",X,[p("label",Y,h(t.$t("main.person")),1),n(S,{people:l.assignees,small:"",modelValue:s.person,"onUpdate:modelValue":e[4]||(e[4]=i=>s.person=i)},null,8,["people","modelValue"])]),n(c,{class:"flexrow-item",label:t.$t("main.show"),options:s.filterOptions,"locale-key-prefix":"tasks.",modelValue:s.currentFilter,"onUpdate:modelValue":e[5]||(e[5]=i=>s.currentFilter=i)},null,8,["label","options","modelValue"]),n(c,{class:"flexrow-item",label:t.$t("main.sorted_by"),options:s.sortOptions,"locale-key-prefix":"tasks.fields.",modelValue:s.currentSort,"onUpdate:modelValue":e[6]||(e[6]=i=>s.currentSort=i)},null,8,["label","options","modelValue"])]),p("div",Z,[p("h1",$,h(l.nbTasksToCheck)+" "+h(t.$tc("my_checks.title",l.nbTasksToCheck)),1),n(g,{class:"flexrow-item",onClick:e[7]||(e[7]=i=>s.isPlaylist=!0),text:t.$t("tasks.build_playlist")},null,8,["text"])]),n(I,{tasks:l.sortedTasks,"is-loading":s.isLoading,"is-error":s.isLoadingError,"selection-grid":s.selectionGrid,"is-to-check":!0},null,8,["tasks","is-loading","is-error","selection-grid"])])]),t.nbSelectedTasks===1?(d(),f("div",tt,[n(w,{task:t.selectedTasks.values().next().value},null,8,["task"])])):u("",!0),n(C,{active:s.isPlaylist,"task-ids":l.sortedTasks.map(i=>i.id),onCancel:e[8]||(e[8]=i=>s.isPlaylist=!1)},null,8,["active","task-ids"])])}const te=L(H,[["render",et],["__scopeId","data-v-3d68e037"]]);export{te as default};
//# sourceMappingURL=MyChecks-CNLYbNYq.js.map
