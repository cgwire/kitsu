{"version":3,"file":"DescriptionCell-BohJMv7b.js","sources":["../../src/components/cells/DescriptionCell.vue"],"sourcesContent":["<template>\n  <td class=\"description-cell\" @keyup.esc=\"onClick\" @click=\"onClick\">\n    <template v-if=\"full\">\n      <div\n        class=\"description-shorten-text\"\n        v-html=\"renderMarkdown(entry.description)\"\n      ></div>\n    </template>\n    <template v-else>\n      <div class=\"c-mask\" v-if=\"isOpen\"></div>\n      <span\n        class=\"description-shorten-text selectable\"\n        v-html=\"\n          renderMarkdown(shortenText(entry.description, 20), {\n            allowedLinkTag: false\n          })\n        \"\n      >\n      </span>\n      <teleport to=\"body\">\n        <div\n          class=\"tooltip\"\n          :class=\"{ dark: isDarkTheme }\"\n          @dblclick=\"onDoubleClick\"\n          @keyup.esc=\"onClick\"\n          v-if=\"isOpen\"\n          :style=\"tooltipStyle\"\n        >\n          <div\n            class=\"tooltip-text\"\n            @keyup.esc=\"onClick\"\n            v-html=\"renderMarkdown(entry.description)\"\n            v-if=\"!isEditing\"\n          ></div>\n          <textarea\n            class=\"tooltip-editor\"\n            ref=\"text\"\n            :value=\"entry.description\"\n            @keyup.esc=\"onClick\"\n            @keyup.ctrl.enter=\"onDoubleClick\"\n            v-else\n          >\n          </textarea>\n        </div>\n      </teleport>\n    </template>\n  </td>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\n\nimport { renderMarkdown } from '@/lib/render'\nimport stringHelpers from '@/lib/string'\n\nexport default {\n  name: 'description-cell',\n\n  data() {\n    return {\n      isEditing: false,\n      isOpen: false,\n      tooltipPosition: { top: 0, left: 0 }\n    }\n  },\n\n  props: {\n    editable: {\n      type: Boolean,\n      default: false\n    },\n    entry: {\n      type: Object,\n      default: () => {}\n    },\n    full: {\n      type: Boolean,\n      default: false\n    }\n  },\n\n  emits: ['description-changed'],\n\n  computed: {\n    ...mapGetters(['isDarkTheme']),\n\n    tooltipStyle() {\n      return {\n        top: this.tooltipPosition.top + 'px',\n        left: this.tooltipPosition.left + 'px'\n      }\n    }\n  },\n\n  methods: {\n    renderMarkdown,\n\n    shortenText: stringHelpers.shortenText,\n\n    onClick(event) {\n      if (\n        (event.currentTarget.classList.contains('description-cell') &&\n          !event.target.closest('.description-cell .tooltip')) ||\n        event.keyCode === 27\n      ) {\n        this.isOpen = !this.isOpen\n        if (this.isOpen) {\n          const td = event.currentTarget\n          const rect = td.getBoundingClientRect()\n          const scrollTop =\n            window.pageYOffset || document.documentElement.scrollTop\n          const scrollLeft =\n            window.pageXOffset || document.documentElement.scrollLeft\n          this.tooltipPosition = {\n            top: rect.top + scrollTop - 105,\n            left: rect.left + scrollLeft + rect.width / 2 - 160\n          }\n        } else if (this.isEditing) {\n          this.isEditing = false\n          const val = this.$refs.text.value\n          this.$emit('description-changed', val)\n        }\n      }\n    },\n\n    onDoubleClick() {\n      if (this.editable) {\n        if (this.isEditing) {\n          const val = this.$refs.text.value\n          this.$emit('description-changed', val)\n        }\n        this.isEditing = !this.isEditing\n        if (this.isEditing) {\n          this.$nextTick(() => {\n            this.$refs.text.focus()\n          })\n        }\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark.tooltip {\n  background: $dark-grey-light;\n  box-shadow: 0 0 3px 0 $dark-grey-strong;\n\n  &::after {\n    border-top-color: $dark-grey-light;\n  }\n}\n\n.description-cell {\n  cursor: pointer;\n  position: relative;\n}\n\n.description-shorten-text {\n  min-height: 30px;\n  min-width: 100px;\n}\n\n.tooltip {\n  background-color: $white;\n  border-radius: 0.5rem;\n  display: block;\n  font-size: 0.9em;\n  min-height: 100px;\n  max-height: 200px;\n  padding: 0.6rem;\n  position: absolute;\n  width: 320px;\n  box-shadow: 0 0 3px 0 $grey;\n  z-index: 1000;\n\n  p {\n    margin: 1em;\n  }\n\n  .tooltip-text {\n    padding: 0.5em;\n    overflow-y: auto;\n    height: 80px;\n  }\n\n  .tooltip-editor {\n    box-shadow: inset 0 0 3px 0 $grey;\n    padding: 0.5em;\n    color: inherit;\n    font-size: 0.95em;\n    height: 100%;\n    line-height: 1.7em;\n    min-height: 80px;\n    width: 100%;\n\n    &:focus {\n      outline: none;\n    }\n  }\n\n  &::after {\n    position: absolute;\n    top: 100px;\n    left: 50%;\n    transform: translateX(-50%);\n    height: 0;\n    width: 0;\n    border: 0.5rem solid transparent;\n    border-top-color: $white;\n    content: '';\n  }\n}\n\n.c-mask {\n  width: 100%;\n  height: 100%;\n}\n</style>\n"],"names":["_sfc_main","mapGetters","renderMarkdown","stringHelpers","event","rect","scrollTop","scrollLeft","val","_hoisted_1","_hoisted_3","_hoisted_4","_hoisted_5","_createElementBlock","_cache","_withKeys","$options","args","$props","_openBlock","_Fragment","$data","_hoisted_2","_createCommentVNode","_createElementVNode","_createBlock","_Teleport","_normalizeClass","_ctx","_normalizeStyle","_withModifiers"],"mappings":"+MAuDA,MAAKA,EAAU,CACb,KAAM,mBAEN,MAAO,CACL,MAAO,CACL,UAAW,GACX,OAAQ,GACR,gBAAiB,CAAE,IAAK,EAAG,KAAM,CAAA,CACnC,CACF,EAEA,MAAO,CACL,SAAU,CACR,KAAM,QACN,QAAS,IAEX,MAAO,CACL,KAAM,OACN,QAAS,IAAM,CAAC,GAElB,KAAM,CACJ,KAAM,QACN,QAAS,EACX,GAGF,MAAO,CAAC,qBAAqB,EAE7B,SAAU,CACR,GAAGC,EAAW,CAAC,aAAa,CAAC,EAE7B,cAAe,CACb,MAAO,CACL,IAAK,KAAK,gBAAgB,IAAM,KAChC,KAAM,KAAK,gBAAgB,KAAO,IACpC,CACF,GAGF,QAAS,CACP,eAAAC,EAEA,YAAaC,EAAc,YAE3B,QAAQC,EAAO,CACb,GACGA,EAAM,cAAc,UAAU,SAAS,kBAAkB,GACxD,CAACA,EAAM,OAAO,QAAQ,4BAA4B,GACpDA,EAAM,UAAY,IAGlB,GADA,KAAK,OAAS,CAAC,KAAK,OAChB,KAAK,OAAQ,CAEf,MAAMC,EADKD,EAAM,cACD,sBAAqB,EAC/BE,EACJ,OAAO,aAAe,SAAS,gBAAgB,UAC3CC,EACJ,OAAO,aAAe,SAAS,gBAAgB,WACjD,KAAK,gBAAkB,CACrB,IAAKF,EAAK,IAAMC,EAAY,IAC5B,KAAMD,EAAK,KAAOE,EAAaF,EAAK,MAAQ,EAAI,GAClD,CACF,SAAW,KAAK,UAAW,CACzB,KAAK,UAAY,GACjB,MAAMG,EAAM,KAAK,MAAM,KAAK,MAC5B,KAAK,MAAM,sBAAuBA,CAAG,CACvC,EAEJ,EAEA,eAAgB,CACd,GAAI,KAAK,SAAU,CACjB,GAAI,KAAK,UAAW,CAClB,MAAMA,EAAM,KAAK,MAAM,KAAK,MAC5B,KAAK,MAAM,sBAAuBA,CAAG,CACvC,CACA,KAAK,UAAY,CAAC,KAAK,UACnB,KAAK,WACP,KAAK,UAAU,IAAM,CACnB,KAAK,MAAM,KAAK,MAAK,CACvB,CAAC,CAEL,CACF,CACF,CACF,EA5IAC,EAAA,CAAA,WAAA,KAAA,IAAA,EASW,MAAM,UATjBC,EAAA,CAAA,WAAA,EAAAC,EAAA,CAAA,WAAA,EAAAC,EAAA,CAAA,OAAA,qCACEC,EA6CK,KAAA,CA7CD,MAAM,mBAAoB,QAAKC,EAAA,CAAA,IAAAA,EAAA,CAAA,EADrCC,UAC2CC,EAAA,SAAAA,EAAA,QAAA,GAAAC,CAAA,EAAO,CAAA,KAAA,CAAA,GAAG,4BAAOD,EAAA,SAAAA,EAAA,QAAA,GAAAC,CAAA,KACxCC,EAAA,UACdL,EAGO,MAAA,CANb,IAAA,EAIQ,MAAM,2BACN,UAAQG,EAAA,eAAeE,EAAA,MAAM,WAAW,CALhD,EAAA,KAAA,EAAAT,CAAA,IAQIU,EAAA,EAAAN,EAqCWO,GA7Cf,IAAA,CAAA,EAAA,CASgCC,EAAA,QAA1BF,IAAAN,EAAwC,MAAxCS,CAAwC,GAT9CC,EAAA,GAAA,EAAA,EAUMC,EAQO,OAAA,CAPL,MAAM,sCACN,UAAmBR,EAAA,eAAeA,EAAA,YAAYE,EAAA,MAAM,YAAW,EAAA,EAAA,oBAZvE,EAAA,KAAA,EAAAR,CAAA,OAmBMe,EAyBWC,EAAA,CAzBD,GAAG,MAAM,EAAA,CAMTL,EAAA,YALRR,EAuBM,MAAA,CA3Cd,IAAA,EAqBU,MArBVc,EAAA,CAqBgB,UAAS,CAAA,KACCC,EAAA,WAAW,CAAA,CAAA,EAC1B,+BAAUZ,EAAA,eAAAA,EAAA,cAAA,GAAAC,CAAA,GACV,QAAKH,EAAA,CAAA,IAAAA,EAAA,CAAA,EAxBhBC,UAwBsBC,EAAA,SAAAA,EAAA,QAAA,GAAAC,CAAA,EAAO,CAAA,KAAA,CAAA,GAElB,MA1BXY,EA0BkBb,EAAA,YAAY,IAMXK,EAAA,eAETR,EAQW,WAAA,CA1CrB,IAAA,EAmCY,MAAM,iBACN,IAAI,OACH,MAAOK,EAAA,MAAM,YACb,QAAK,CAtClBJ,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAA,IAAAE,IAsCwBD,EAAA,SAAAA,EAAA,QAAA,GAAAC,CAAA,EAAO,CAAA,KAAA,CAAA,GAtC/BH,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAAe,UAuC+Bd,EAAA,eAAAA,EAAA,cAAA,GAAAC,CAAA,EAAa,CAAA,MAAA,CAAA,EAAA,CAAA,OAAA,CAAA,GAEjC,EAAA,aACD,GA1CVL,CAAA,QA4BUC,EAKO,MAAA,CAjCjB,IAAA,EA6BY,MAAM,eACL,QAAKC,EAAA,CAAA,IAAAA,EAAA,CAAA,EA9BlBC,UA8BwBC,EAAA,SAAAA,EAAA,QAAA,GAAAC,CAAA,EAAO,CAAA,KAAA,CAAA,GACnB,UAAQD,EAAA,eAAeE,EAAA,MAAM,WAAW,CA/BpD,EAAA,KAAA,GAAAP,CAAA,SAAAY,EAAA,GAAA,EAAA"}