{"version":3,"file":"VideoViewer-Da8LCLxo.js","sources":["../../src/components/previews/VideoViewer.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"container\"\n    class=\"video-player\"\n    :style=\"{\n      'border-top-left-radius': isRoundedTopBorder ? '10px' : '',\n      'border-top-right-radius': isRoundedTopBorder ? '10px' : ''\n    }\"\n    @click=\"$emit('click')\"\n  >\n    <div\n      class=\"video-wrapper\"\n      :style=\"{\n        'border-top-left-radius': isRoundedTopBorder ? '10px' : '',\n        'border-top-right-radius': isRoundedTopBorder ? '10px' : ''\n      }\"\n    >\n      <div class=\"loading-background\" v-if=\"isLoading\">\n        <spinner class=\"spinner\" />\n      </div>\n      <video\n        ref=\"movie\"\n        class=\"annotation-movie\"\n        :src=\"moviePath\"\n        :poster=\"posterPath\"\n        preload=\"auto\"\n        type=\"video/mp4\"\n        v-show=\"!isLoading\"\n      ></video>\n    </div>\n  </div>\n</template>\n\n<script>\nimport panzoom from 'panzoom'\nimport { mapGetters } from 'vuex'\n\nimport { formatFrame } from '@/lib/video'\n\nimport { domMixin } from '@/components/mixins/dom'\n\nimport Spinner from '@/components/widgets/Spinner.vue'\n\nexport default {\n  name: 'video-viewer',\n\n  mixins: [domMixin],\n\n  components: {\n    Spinner\n  },\n\n  props: {\n    name: {\n      type: String,\n      default: ''\n    },\n    big: {\n      type: Boolean,\n      default: false\n    },\n    isComparing: {\n      type: Boolean,\n      default: false\n    },\n    isComparisonOverlay: {\n      type: Boolean,\n      default: false\n    },\n    isHd: {\n      type: Boolean,\n      default: false\n    },\n    isDrawing: {\n      type: Boolean,\n      default: false\n    },\n    isTyping: {\n      type: Boolean,\n      default: false\n    },\n    isMuted: {\n      type: Boolean,\n      default: false\n    },\n    isRepeating: {\n      type: Boolean,\n      default: false\n    },\n    light: {\n      type: Boolean,\n      default: false\n    },\n    currentFrame: {\n      type: Number,\n      default: 0\n    },\n    nbFrames: {\n      type: Number,\n      default: 0\n    },\n    preview: {\n      type: Object,\n      default: () => {}\n    },\n    defaultHeight: {\n      type: Number,\n      default: 0\n    },\n    fullScreen: {\n      type: Boolean,\n      default: false\n    },\n    isRoundedTopBorder: {\n      type: Boolean,\n      default: false\n    },\n    panzoom: {\n      type: Boolean,\n      default: false\n    }\n  },\n\n  emits: [\n    'click',\n    'duration-changed',\n    'frame-update',\n    'play-ended',\n    'size-changed',\n    'video-end',\n    'video-loaded'\n  ],\n\n  data() {\n    return {\n      annotations: [],\n      currentTimeRaw: 0,\n      isLoading: false,\n      maxDuration: '00:00.000',\n      videoDuration: 0\n    }\n  },\n\n  mounted() {\n    this.$options.currentTimeCalls = []\n\n    this.container.style.height = this.defaultHeight + 'px'\n    this.isLoading = true\n    if (this.isMuted) {\n      this.video.muted = this.isMuted\n    }\n    setTimeout(() => {\n      if (this.video) {\n        if (this.video.readyState === 4) {\n          this.configureVideo()\n          this.onWindowResize()\n          this.isLoading = false\n          this.setCurrentTime(0)\n          this.setCurrentTimeRaw(0)\n          this.$nextTick(() => {\n            this.video.currentTime = 0\n          })\n          this.$emit('video-loaded')\n        }\n        this.video.addEventListener(\n          'focus',\n          function () {\n            this.blur()\n          },\n          false\n        )\n        this.video.addEventListener('resize', this.resetSize)\n\n        this.video.addEventListener('loadedmetadata', () => {\n          if (!this.video) return\n          this.configureVideo()\n          this.onWindowResize()\n          this.setCurrentTime(0)\n          this.setCurrentTimeRaw(0)\n          this.$emit('video-loaded')\n        })\n\n        this.video.addEventListener('canplay', () => {\n          this.isLoading = false\n        })\n\n        this.video.addEventListener('ended', () => {\n          this.isLoading = false\n        })\n\n        this.video.addEventListener('error', err => {\n          console.error('An error occurred while loading a video', err)\n          if (this.$refs.movie) {\n            this.$refs.movie.style.height = this.defaultHeight + 'px'\n          }\n          this.isLoading = false\n        })\n\n        this.video.addEventListener('loadstart', () => {\n          this.isLoading = true\n        })\n\n        this.video.addEventListener('stalled', () => {\n          this.isLoading = true\n        })\n\n        this.video.addEventListener('waiting', () => {\n          if (this.name.indexOf('comparison') < 0) {\n            this.isLoading = true\n          }\n        })\n\n        window.addEventListener('resize', this.onWindowResize)\n      }\n    }, 0)\n\n    if (this.panzoom) {\n      this.panzoomInstance = panzoom(this.container, {\n        bounds: true,\n        boundsPadding: 0.2,\n        maxZoom: 5,\n        minZoom: 1\n      })\n      this.pausePanZoom()\n    }\n  },\n\n  beforeUnmount() {\n    this.pause()\n    window.removeEventListener('keydown', this.onKeyDown)\n    window.removeEventListener('resize', this.onWindowResize)\n    this.panzoomInstance?.dispose()\n  },\n\n  computed: {\n    ...mapGetters(['currentProduction']),\n\n    container() {\n      return this.$refs.container\n    },\n\n    extension() {\n      return this.preview ? this.preview.extension : ''\n    },\n\n    fps() {\n      return parseFloat(this.currentProduction?.fps) || 25\n    },\n\n    frameDuration() {\n      return Math.round((1 / this.fps) * 10000) / 10000\n    },\n\n    isAvailable() {\n      return !['broken', 'processing'].includes(this.status)\n    },\n\n    isMovie() {\n      return this.extension === 'mp4'\n    },\n\n    isVideo() {\n      return this.$refs.movie && this.videoDuration && this.videoDuration > 0\n    },\n\n    status() {\n      return this.preview && this.preview.status ? this.preview.status : 'ready'\n    },\n\n    video() {\n      return this.$refs.movie\n    },\n\n    moviePath() {\n      if (this.extension === 'mp4' && this.isAvailable && !this.isHd) {\n        return `/api/movies/low/preview-files/${this.preview.id}.mp4`\n      } else if (this.extension === 'mp4' && this.isAvailable) {\n        return `/api/movies/originals/preview-files/${this.preview.id}.mp4`\n      } else {\n        return null\n      }\n    },\n\n    movieDlPath() {\n      if (this.preview && this.isAvailable) {\n        return `/api/movies/originals/preview-files/${this.preview.id}/download`\n      } else {\n        return ''\n      }\n    },\n\n    posterPath() {\n      if (this.extension === 'mp4' && this.isAvailable) {\n        return `/api/pictures/previews/preview-files/${this.preview.id}.png`\n      } else {\n        return null\n      }\n    }\n  },\n\n  methods: {\n    formatFrame,\n\n    getNaturalDimensions() {\n      return {\n        height: this.video ? this.video.videoHeight : 0,\n        width: this.video ? this.video.videoWidth : 0\n      }\n    },\n\n    getDimensions() {\n      const dimensions = this.getNaturalDimensions()\n      const ratio = dimensions.height / dimensions.width || 1\n      const fullWidth = this.container ? this.container.offsetWidth : 0\n      const fullHeight = this.container ? this.container.offsetHeight : 0\n      let width = fullWidth\n      let height = Math.floor(width * ratio)\n      if (height > fullHeight) {\n        height = fullHeight\n        width = height / ratio\n      }\n      return { width, height }\n    },\n\n    getLastPushedCurrentTime() {\n      const length = this.$options.currentTimeCalls.length\n      if (length > 0) {\n        return this.$options.currentTimeCalls[length - 1]\n      } else {\n        return this.currentTimeRaw\n      }\n    },\n\n    setCurrentFrame(frame) {\n      this.setCurrentTime(frame * this.frameDuration)\n    },\n\n    setCurrentTimeRaw(currentTime) {\n      if (currentTime < this.frameDuration) currentTime = 0\n      this.video.currentTime = currentTime\n    },\n\n    setCurrentTime(currentTime) {\n      if (!this.$options.currentTimeCalls) {\n        this.$options.currentTimeCalls = []\n      }\n      this.$options.currentTimeCalls.push(currentTime)\n      this.runSetCurrentTime()\n    },\n\n    runSetCurrentTime() {\n      if (this.$options.currentTimeCalls.length === 0) {\n        this.$options.running = false\n      } else {\n        this.$options.running = true\n        const currentTime = this.$options.currentTimeCalls.shift()\n        if (this.video.currentTime !== currentTime) {\n          this.video.currentTime = Number(currentTime.toPrecision(4)) + 0.001\n        }\n        setTimeout(() => {\n          this.runSetCurrentTime()\n        }, 10)\n      }\n    },\n\n    configureVideo() {\n      this.video.onended = this.onVideoEnd\n      if (this.video.currentTime === 0) {\n        this.mountVideo()\n      }\n    },\n\n    mountVideo() {\n      if (!this.isMovie) return\n      this.video.mute = this.isMuted\n      this.videoDuration = this.video.duration\n      this.isLoading = false\n      this.$emit('duration-changed', this.videoDuration)\n      this.resetSize()\n      setTimeout(() => {\n        this.resetSize()\n      }, 500)\n    },\n\n    resetSize() {\n      const { height: initialHeight } = this.getDimensions()\n      if (initialHeight > 0) {\n        this.container.style.height = this.defaultHeight + 'px'\n        this.video.style.height = initialHeight + 'px'\n        const videoPosition = this.video.getBoundingClientRect()\n        const containerPosition = this.container.getBoundingClientRect()\n        const top = videoPosition.top - containerPosition.top\n        const left = videoPosition.left - containerPosition.left\n        const width = videoPosition.width\n        const height = videoPosition.height\n\n        if (\n          !this.previousDimensions ||\n          this.previousDimensions.width !== width ||\n          this.previousDimensions.height !== height ||\n          this.previousDimensions.left !== left ||\n          this.previousDimensions.top !== top\n        ) {\n          this.$emit('size-changed', { width, height, top, left })\n        }\n        this.previousDimensions = { width, height, top, left }\n      } else {\n        this.$emit('size-changed', { width: 0, height: 0, top: 0, left: 0 })\n      }\n    },\n\n    getFrameFromPlayer() {\n      const currentTimeRaw = this.video ? this.video.currentTime : 0\n      if (currentTimeRaw === 0) {\n        return 0\n      }\n      let frame = Math.ceil(currentTimeRaw / this.frameDuration) + 1\n      frame = Number(frame.toPrecision(4))\n      frame = Math.min(frame, this.nbFrames)\n      return frame\n    },\n\n    play() {\n      if (\n        !this.isPlaying &&\n        this.videoDuration === this.video.currentTime &&\n        this.name.indexOf('comparison') < 0\n      ) {\n        this.setCurrentTime(0)\n      }\n      this.video.play()\n      if (this.name.indexOf('comparison') < 0) {\n        this.runEmitTimeUpdateLoop()\n      }\n    },\n\n    runEmitTimeUpdateLoop() {\n      clearInterval(this.$options.playLoop)\n      this.$options.playLoop = setInterval(\n        this.emitFrameChange,\n        this.frameDuration\n      )\n    },\n\n    emitFrameChange() {\n      const frame = this.getFrameFromPlayer()\n      this.$emit('frame-update', frame)\n    },\n\n    pause() {\n      this.video.pause()\n      clearInterval(this.$options.playLoop)\n      this.video.currentTime = this.currentFrame * this.frameDuration\n      this.$emit('frame-update', this.currentFrame)\n    },\n\n    toggleMute() {\n      this.video.muted = !this.video.muted\n    },\n\n    goPreviousFrame() {\n      const nextFrame = this.currentFrame - 1\n      if (nextFrame < 0) return\n      this.video.currentTime = nextFrame * this.frameDuration + 0.001\n      this.$emit('frame-update', nextFrame)\n      return nextFrame\n    },\n\n    goNextFrame() {\n      const nextFrame = this.currentFrame + 1\n      if (nextFrame >= this.nbFrames) return\n      this.video.currentTime = nextFrame * this.frameDuration + 0.001\n      this.$emit('frame-update', nextFrame)\n      return nextFrame\n    },\n\n    onVideoEnd() {\n      this.isPlaying = false\n      clearInterval(this.$options.playLoop)\n      if (this.isRepeating) {\n        this.$emit('video-end')\n        this.video.currentTime = 0\n        this.play()\n      } else {\n        this.$emit('play-ended')\n      }\n    },\n\n    onWindowResize() {\n      this.mountVideo()\n    },\n\n    resetPanZoom() {\n      if (this.panzoomInstance) {\n        this.panzoomInstance.moveTo(0, 0)\n        this.panzoomInstance.zoomAbs(0, 0, 1)\n      }\n    },\n\n    pausePanZoom() {\n      if (this.panzoomInstance) {\n        this.panzoomInstance.pause()\n      }\n    },\n\n    resumePanZoom() {\n      if (this.panzoomInstance) {\n        this.panzoomInstance.resume()\n      }\n    },\n\n    setSpeed(rate) {\n      if (this.video) {\n        this.video.playbackRate = rate\n      }\n    },\n\n    setVolume(volume) {\n      if (this.video) {\n        this.video.volume = volume / 100\n      }\n    }\n  },\n\n  watch: {\n    preview() {\n      this.resetPanZoom()\n      this.maxDuration = '00:00.000'\n      this.pause()\n      this.$nextTick(() => {\n        this.resetPanZoom()\n        setTimeout(() => {\n          this.resetPanZoom()\n        }, 100)\n      })\n    },\n\n    light() {\n      this.resetPanZoom()\n      this.mountVideo()\n    },\n\n    isComparing() {\n      this.resetPanZoom()\n      this.mountVideo()\n    },\n\n    isComparingOverlay() {\n      this.resetPanZoom()\n      this.mountVideo()\n    },\n\n    isMuted() {\n      this.video.muted = this.isMuted\n    },\n\n    fullScreen() {\n      this.resetPanZoom()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.loading-background {\n  background: #00000088;\n  position: absolute;\n  display: flex;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n}\n\n.spinner {\n  margin: auto;\n}\n\n.video-player {\n  display: flex;\n  flex-direction: column;\n  align-content: flex-end;\n  height: 100%;\n  width: 100%;\n  text-align: center;\n  background: #36393f;\n  overflow: hidden;\n}\n\n.video-wrapper {\n  flex: 1;\n  display: flex;\n  background: black;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  margin: auto;\n  width: 100%;\n  height: 100%;\n  position: relative;\n}\n\nvideo {\n  object-fit: inherit;\n}\n\n.video-time {\n  position: absolute;\n  font-size: 2em;\n}\n</style>\n"],"names":["_sfc_main","domMixin","Spinner","err","panzoom","mapGetters","formatFrame","dimensions","ratio","fullWidth","fullHeight","width","height","length","frame","currentTime","initialHeight","videoPosition","containerPosition","top","left","currentTimeRaw","nextFrame","rate","volume","_hoisted_2","_createElementBlock","_normalizeStyle","$props","_ctx","_createElementVNode","$data","_openBlock","_hoisted_1","_createVNode","_component_spinner","_createCommentVNode","$options"],"mappings":"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"}