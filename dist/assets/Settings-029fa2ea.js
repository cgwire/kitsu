import{G as o,d as n,m as r,b as i,n as l}from"./index-e733f708.js";import{C as _}from"./ChangeAvatarModal-d4cef786.js";const c={name:"settings",components:{ChangeAvatarModal:_,ComboboxBoolean:o,TextField:n},data(){return{organisationLogoKey:new Date().getUTCDate(),organisationLogoPath:"",form:{name:"",hours_by_day:0,original_file_name:"false",hd_by_default:"false",chat_token_slack:"",chat_webhook_mattermost:"",chat_token_discord:""},errors:{save:!1,saveAvatar:!1,webhook_error:!1},loading:{save:!1,saveAvatar:!1},modals:{avatar:!1}}},mounted(){this.form=Object.assign(this.form,this.organisation),this.organisationLogoKey="key"+new Date().toISOString(),this.organisationLogoPath=`/api/pictures/thumbnails/organisations/${this.organisation.id}.png`},computed:{...r(["organisation"])},methods:{...i(["changeAvatar","uploadOrganisationLogo","saveOrganisation"]),checkWebhook(){return!this.form.chat_webhook_mattermost||this.form.chat_webhook_mattermost.match("/hooks/[a-zA-Z0-9]+$")?(this.errors.webhook_error=!1,!0):(this.errors.webhook_error=!0,!1)},hideAvatarModal(){this.modals.avatar=!1},saveSettings(){this.checkWebhook()&&(this.loading.save=!0,this.errors.save=!1,this.saveOrganisation(this.form).then(()=>{this.loading.save=!1,this.errors.save=!1}).catch(s=>{console.error(s),this.loading.save=!1,this.errors.save=!0}))},uploadAvatarFile(s){this.loading.saveAvatar=!0,this.errors.saveAvatar=!1,this.uploadOrganisationLogo(s).then(()=>{setTimeout(()=>{this.loading.saveAvatar=!1,this.modals.avatar=!1,this.organisationLogoPath=`/api/pictures/thumbnails/organisations/${this.organisation.id}.png?t=`+new Date().toISOString()},500)}).catch(t=>{console.error(t),this.loading.saveAvatar=!1,this.errors.saveAvatar=!0})},showAvatarModal(){this.modals.avatar=!0}},watch:{organisation(){this.form={name:this.organisation.name,hours_by_day:this.organisation.hours_by_day,use_original_file_name:this.organisation.use_original_file_name?"true":"false",timesheets_locked:this.organisation.timesheets_locked?"true":"false",hd_by_default:this.organisation.hd_by_default?"true":"false",chat_token_slack:this.organisation.chat_token_slack,chat_token_discord:this.organisation.chat_token_discord,chat_webhook_mattermost:this.organisation.chat_webhook_mattermost}}},metaInfo(){return{title:`${this.$t("settings.title")} - Kitsu`}}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"settings page"},[e("div",{staticClass:"settings-content"},[e("div",{staticClass:"settings-body"},[e("h2",[t._v(" "+t._s(t.$t("settings.title"))+" ")]),e("p",[e("label",{staticClass:"label"},[t._v(" "+t._s(t.$t("settings.logo"))+" ")])]),t.organisation.has_avatar?e("div",{staticClass:"logo-wrapper"},[e("img",{attrs:{src:t.organisationLogoPath}})]):e("p",{staticClass:"no-logo"},[t._v(" "+t._s(t.$t("settings.no_logo"))+" ")]),e("p",[e("button",{staticClass:"button set-logo-button",on:{click:t.showAvatarModal}},[t._v(" "+t._s(t.$t("settings.set_logo"))+" ")])]),e("text-field",{staticClass:"mt2",attrs:{label:t.$t("settings.fields.name")},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.name,callback:function(a){t.$set(t.form,"name",a)},expression:"form.name"}}),e("text-field",{attrs:{label:t.$t("settings.fields.hours_by_day"),type:"number"},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.hours_by_day,callback:function(a){t.$set(t.form,"hours_by_day",a)},expression:"form.hours_by_day"}}),e("combobox-boolean",{attrs:{label:t.$t("settings.fields.use_original_name")},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.use_original_file_name,callback:function(a){t.$set(t.form,"use_original_file_name",a)},expression:"form.use_original_file_name"}}),e("combobox-boolean",{attrs:{label:t.$t("settings.fields.show_hd_default")},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.hd_by_default,callback:function(a){t.$set(t.form,"hd_by_default",a)},expression:"form.hd_by_default"}}),e("combobox-boolean",{attrs:{label:t.$t("settings.fields.timesheets_locked")},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.timesheets_locked,callback:function(a){t.$set(t.form,"timesheets_locked",a)},expression:"form.timesheets_locked"}}),e("h2",[t._v(" "+t._s(t.$t("settings.integrations"))+" ")]),e("text-field",{attrs:{label:t.$t("settings.fields.slack_token")},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.chat_token_slack,callback:function(a){t.$set(t.form,"chat_token_slack",a)},expression:"form.chat_token_slack"}}),e("text-field",{attrs:{label:t.$t("settings.fields.discord_token")},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.chat_token_discord,callback:function(a){t.$set(t.form,"chat_token_discord",a)},expression:"form.chat_token_discord"}}),e("div",{attrs:{id:"mattermost_integrations"}},[e("text-field",{attrs:{label:t.$t("settings.fields.mattermost_webhook")},on:{enter:function(a){return t.saveSettings()}},model:{value:t.form.chat_webhook_mattermost,callback:function(a){t.$set(t.form,"chat_webhook_mattermost",a)},expression:"form.chat_webhook_mattermost"}}),this.errors.webhook_error===!0?e("div",{staticClass:"error pull-right"},[e("em",[t._v(t._s(t.$t("settings.webhook_error")))])]):t._e()],1),e("button",{class:{button:!0,"save-button":!0,"is-medium":!0,"is-loading":t.loading.save},on:{click:function(a){return t.saveSettings()}}},[t._v(" "+t._s(t.$t("settings.save.button"))+" ")]),e("p",{class:{error:!0,"is-hidden":!t.errors.save}},[t._v(" "+t._s(t.$t("settings.save.error"))+" ")])],1)]),e("change-avatar-modal",{attrs:{active:t.modals.avatar,"is-loading":t.loading.saveAvatar,"is-error":t.errors.saveAvatar,title:t.$t("settings.change_logo")},on:{confirm:t.uploadAvatarFile,cancel:t.hideAvatarModal}})],1)},m=[],d=l(c,h,m,!1,null,"8f24c4b3",null,null);const u=d.exports;export{u as default};
//# sourceMappingURL=Settings-029fa2ea.js.map
