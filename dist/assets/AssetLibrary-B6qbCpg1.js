import{_ as E,m as C,a as T,E as $,D as L,C as B,b as V,B as N,r as d,c as a,o as n,d as A,e as r,f as c,t as u,F as f,g as I,T as q,S as D,P as j,h as z,i as J,s as O,j as R,k as S,w as k,l as G,n as K,p as _}from"./index-qtxoT1kv.js";import{P as Q}from"./PageLayout-B53zo_ty.js";const H={name:"manage-library",components:{ButtonSimple:N,Combobox:V,ComboboxProduction:B,DeleteEntities:L,EntityThumbnail:$},props:{extendable:{type:Boolean,default:!0}},emits:["library-updated"],data(){return{productionId:null,entityTypeId:null,entityIds:[],loading:!1,error:!1}},async mounted(){this.productionId=this.openProductions[0]?.id,this.$nextTick(()=>{this.entityTypeId=this.productionEntityTypes[0]?.value}),await this.refresh()},computed:{...T(["assetTypes","assetTypeMap","openProductions","productionMap","selectedAssets","unsharedAssets"]),productionEntityTypes(){const e=this.productionMap.get(this.productionId);return e?(e.asset_types?.length?this.assetTypes.filter(s=>e.asset_types.includes(s.id)):this.assetTypes).map(s=>({label:s.name,value:s.id})):[]},productionUnsharedEntities(){return this.unsharedAssets.filter(e=>e.project_id===this.productionId&&e.entity_type_id===this.entityTypeId)},selectedEntities(){return[...this.selectedAssets.values()]}},methods:{...C(["clearSelectedAssets","loadUnsharedAssets","shareAssets","unshareAssets"]),async refresh(){this.loading=!0,this.entityIds=[];const e=this.productionMap.get(this.productionId);try{await this.loadUnsharedAssets({production:e})}catch(t){console.error(t)}this.loading=!1},toggleEntities(e){const t=e.every(s=>this.isSelected(s));e.forEach(s=>this.toggleEntity(s,!t))},toggleEntity(e,t=!1){t||!this.isSelected(e)?this.entityIds.push(e.id):this.entityIds=this.entityIds.filter(s=>s!==e.id)},isSelected(e){return this.entityIds.includes(e.id)},async importFromProduction(e){this.loading=!0;const t=this.productionMap.get(e);try{await this.shareAssets({production:t}),this.$emit("library-updated")}catch(s){console.error(s)}this.loading=!1,await this.refresh()},async importFromAssetType(e,t){this.loading=!0;const s=this.productionMap.get(e),p=this.assetTypeMap.get(t);try{await this.shareAssets({production:s,assetType:p}),this.$emit("library-updated")}catch(i){console.error(i)}this.loading=!1,await this.refresh()},async importFromEntityIds(e){this.loading=!0;try{await this.shareAssets({assetIds:e}),this.$emit("library-updated")}catch(t){console.error(t)}this.loading=!1,await this.refresh()},async removeSharedEntities(e){this.loading=!0;const t=e.map(s=>s.id);try{await this.unshareAssets({assetIds:t}),this.$emit("library-updated"),this.clearSelectedAssets()}catch(s){console.error(s)}this.loading=!1,await this.refresh()}},watch:{productionId(){this.refresh()}}},W={class:"side-wrapper"},X={key:0,class:"extend-bar"},Y={class:"side manage-library"},Z={key:0,class:"flexrowcolumn"},ee={class:"has-text-centered pa1"},te={key:1},se={class:"mt0"},ie={key:2,class:"has-text-centered mt2"},re={class:"flexcolumn mt2"},oe={class:"flexcolumn mt2"},ne={class:"flexcolumn"},le={key:0,class:"mt1"},ae={key:1,class:"unshared-entities mt1"},de={class:"datatable"},ce=["onClick"],ue={class:"flexrow"},he=["checked"],pe={class:"entity-name ml05"};function me(e,t,s,p,i,o){const g=d("delete-entities"),b=d("combobox-production"),v=d("combobox"),y=d("button-simple"),w=d("entity-thumbnail");return n(),a("div",W,[s.extendable?(n(),a("div",X)):A("",!0),r("div",Y,[o.selectedEntities.length?(n(),a("div",Z,[c(g,{"error-text":e.$t("assets.multiple_delete_error"),"is-loading":i.loading,"is-error":i.error,text:e.$tc("library.remove_selected_assets",o.selectedEntities.length,{nbSelectedAssets:o.selectedEntities.length}),onConfirm:t[0]||(t[0]=l=>o.removeSharedEntities(o.selectedEntities))},null,8,["error-text","is-loading","is-error","text"]),r("div",ee,[r("a",{onClick:t[1]||(t[1]=l=>e.clearSelectedAssets())},u(e.$t("main.clear_selection")),1)])])):A("",!0),o.selectedEntities.length?(n(),a("hr",te)):A("",!0),r("h2",se,u(e.$t("library.manage")),1),e.openProductions.length?(n(),a(f,{key:3},[r("div",re,[c(b,{class:"flexrow-item",label:e.$t("library.select_production"),"production-list":e.openProductions,"with-margin":!1,modelValue:i.productionId,"onUpdate:modelValue":t[2]||(t[2]=l=>i.productionId=l)},null,8,["label","production-list","modelValue"]),c(v,{class:"flexrow-item mt2",disabled:!i.productionId,label:e.$t("library.select_asset_type"),options:o.productionEntityTypes,"with-margin":!1,modelValue:i.entityTypeId,"onUpdate:modelValue":t[3]||(t[3]=l=>i.entityTypeId=l)},null,8,["disabled","label","options","modelValue"])]),r("div",oe,[c(y,{class:"flexrow-item mb05",disabled:!i.productionId,"is-loading":i.loading,text:e.$t("library.import_from_production"),onClick:t[4]||(t[4]=l=>o.importFromProduction(i.productionId))},null,8,["disabled","is-loading","text"]),c(y,{class:"flexrow-item",disabled:!i.productionId,"is-loading":i.loading,text:e.$t("library.import_from_asset_type"),onClick:t[5]||(t[5]=l=>o.importFromAssetType(i.productionId,i.entityTypeId))},null,8,["disabled","is-loading","text"]),t[7]||(t[7]=r("hr",{class:"mt1"},null,-1)),c(y,{class:"flexrow-item",disabled:!i.entityIds.length,"is-loading":i.loading,text:e.$t("library.import_from_list"),onClick:t[6]||(t[6]=l=>o.importFromEntityIds(i.entityIds))},null,8,["disabled","is-loading","text"])]),r("div",ne,[o.productionUnsharedEntities.length?(n(),a("div",ae,[r("table",de,[(n(!0),a(f,null,I(o.productionUnsharedEntities,l=>(n(),a("tr",{class:"datatable-row",key:l.id},[r("td",{class:"datatable-row-header pointer",onClick:x=>o.toggleEntity(l)},[r("div",ue,[r("input",{type:"checkbox",class:"flexrow-item",checked:o.isSelected(l)},null,8,he),c(w,{class:"entity-thumbnail flexrow-item",entity:l,width:50,height:30,"empty-width":50,"empty-height":32},null,8,["entity"]),r("span",pe,u(l.name),1)])],8,ce)]))),128))])])):(n(),a("div",le,u(e.$t("library.no_entities")),1))])],64)):(n(),a("div",ie,u(e.$t("library.no_open_productions")),1))])])}const ye=E(H,[["render",me],["__scopeId","data-v-dfd54a62"]]),_e={name:"asset-library",mixins:[O],components:{Combobox:V,ComboboxProduction:B,EntityPreview:J,ManageLibrary:ye,PageLayout:Q,PageTitle:z,ProductionName:j,SearchField:D,TableInfo:q},data(){return{errors:{sharedAssets:!1},filters:{productionId:null},loading:{sharedAssets:!1},sorting:{current:"name",options:["name","production","created_at","updated_at"].map(e=>({label:e,value:e}))}}},mounted(){this.filters.productionId=this.$route.query.production||void 0,this.searchField.setValue(this.$route.query.search||void 0),this.$nextTick(()=>{this.onSearchChange()})},computed:{...T(["displayedSharedAssets","displayedSharedAssetsByType","isCurrentUserManager","openProductions","productionMap","selectedAssets"]),searchField(){return this.$refs["search-field"]},productionList(){return[{name:this.$t("main.all")},...this.openProductions]},sortedSharedAssetsByType(){const e=(s,p)=>s.name.localeCompare(p.name,void 0,{numeric:!0}),t=(s,p)=>s.production.name.localeCompare(p.production.name,void 0,{numeric:!0});return this.displayedSharedAssetsByType.map(s=>this.sorting.current==="production"?s.sort(_.firstBy(t).thenBy(e)):this.sorting.current==="created_at"?s.sort(_.firstBy("created_at")):this.sorting.current==="updated_at"?s.sort(_.firstBy("updated_at",-1)):s.sort(_.firstBy(e).thenBy(t)))}},methods:{...C(["loadSharedAssets","setAssetSelection","setSharedAssetSearch"]),async refresh(e=!1){this.loading.sharedAssets=!e;const t=this.productionMap.get(this.filters.productionId);try{await this.loadSharedAssets({production:t})}catch(s){console.error(s),this.errors.sharedAssets=!0}this.loading.sharedAssets=!1},toggleEntity(e){const t=this.isSelected(e);this.setAssetSelection({asset:e,selected:!t})},isSelected(e){return this.selectedAssets.has(e.id)},onSearchChange(){const e=this.searchField.getValue()||"";this.setSharedAssetSearch(e),this.setSearchInUrl()},updateRoute({production:e,search:t}){const s={...this.$route.query,production:e||void 0,search:t||void 0};JSON.stringify(s)!==JSON.stringify(this.$route.query)&&this.$router.push({query:s})}},watch:{"filters.productionId"(e){this.updateRoute({production:e}),this.refresh()}},head(){return{title:`${this.$t("library.asset_library")} - Kitsu`}}},fe={class:"asset-library"},ge={class:"flexrow"},be={class:"filters flexrow"},ve={class:"entities mb2"},we={key:1,class:"has-text-centered"},Ae={class:"mt0"},Ie={class:"items"},xe=["onClick"],Se=["title"],ke={class:"item-description flexrow"},Ee={class:"entity-name ml1 flexrow-item"};function Ce(e,t,s,p,i,o){const g=d("page-title"),b=d("search-field"),v=d("combobox-production"),y=d("combobox"),w=d("table-info"),l=d("entity-preview"),x=d("production-name"),M=d("manage-library"),P=d("page-layout"),U=R("focus");return n(),S(P,{side:e.isCurrentUserManager},{main:k(()=>[r("div",fe,[r("header",ge,[c(g,{class:"mt1 filler",text:e.$t("library.asset_library")},null,8,["text"])]),r("div",be,[G(c(b,{ref:"search-field",class:"flexrow-item",onChange:o.onSearchChange,"can-save":!1},null,8,["onChange"]),[[U]]),c(v,{class:"flexrow-item",label:e.$t("main.production"),"production-list":o.productionList,modelValue:i.filters.productionId,"onUpdate:modelValue":t[0]||(t[0]=h=>i.filters.productionId=h)},null,8,["label","production-list","modelValue"]),t[3]||(t[3]=r("span",{class:"filler"},null,-1)),c(y,{class:"flexrow-item",label:e.$t("main.sorted_by"),options:i.sorting.options,"locale-key-prefix":"library.fields.",modelValue:i.sorting.current,"onUpdate:modelValue":t[1]||(t[1]=h=>i.sorting.current=h)},null,8,["label","options","modelValue"])]),r("div",ve,[i.loading.sharedAssets||i.errors.sharedAssets?(n(),S(w,{key:0,"is-loading":i.loading.sharedAssets,"is-error":i.errors.sharedAssets},null,8,["is-loading","is-error"])):e.displayedSharedAssets.length?(n(!0),a(f,{key:2},I(o.sortedSharedAssetsByType,(h,F)=>(n(),a("div",{class:"pb1",key:F},[r("h2",Ae,u(h[0].asset_type_name)+" ("+u(h.length)+") ",1),r("ul",Ie,[(n(!0),a(f,null,I(h,m=>(n(),a("li",{class:K(["item flexcolumn",{"selectable-item":e.isCurrentUserManager,"selected-item":o.isSelected(m)}]),key:m.id,onClick:Te=>e.isCurrentUserManager&&o.toggleEntity(m)},[r("div",{class:"card",title:m.full_name},[c(l,{"empty-height":100,"empty-width":150,height:100,width:150,entity:m,"is-rounded-top-border":""},null,8,["entity"]),r("div",ke,[c(x,{class:"flexrow-item mr0",production:m.production,size:20,"only-avatar":""},null,8,["production"]),r("div",Ee,u(m.name),1)])],8,Se)],10,xe))),128))])]))),128)):(n(),a("div",we,u(e.$t("library.no_shared_assets")),1))])])]),side:k(()=>[c(M,{onLibraryUpdated:t[2]||(t[2]=h=>o.refresh(!0))})]),_:1},8,["side"])}const Me=E(_e,[["render",Ce],["__scopeId","data-v-9c448fb2"]]);export{Me as default};
//# sourceMappingURL=AssetLibrary-B6qbCpg1.js.map
