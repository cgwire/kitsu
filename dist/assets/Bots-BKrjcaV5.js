import{_ as y,ac as D,aj as A,ak as V,al as S,ah as L,am as F,r as l,c as h,o as a,e as i,t as c,ai as U,f as d,a7 as C,F as R,k as m,w as N,d as u,an as B,n as M,m as q,a as I,S as G,h as O,ao as j,ap as z,L as H,B as K,s as Q}from"./index-HWsAVBQH.js";import{P as J,E as W,a as X}from"./PeopleList-CtLYf545.js";import{E as Y}from"./eye-off-EWzGIpHo.js";import{R as Z}from"./RouteTabs-BsGpuiOx.js";import"./ComboboxStudio-D_-3kV_s.js";import"./grablist-Da7oVI-6.js";import"./DepartmentNamesCell-BU8MiSh9.js";import"./PeopleNameCell-ssEGNdg4.js";const $={name:"new-token-modal",mixins:[L,F],components:{AlertTriangleIcon:S,DateField:V,EyeIcon:A,EyeOffIcon:Y,TextField:D},props:{active:{type:Boolean,default:!1},person:{type:Object,default:()=>{}}},emits:["cancel","close","generate-token"],data(){return{form:{expiration_date:null},message:null,visible:!1}},computed:{isValidExpirationDate(){return!this.form.expiration_date||new Date(this.form.expiration_date)>new Date}},methods:{generateToken(){this.$emit("generate-token",{id:this.person.id,expiration_date:this.form.expiration_date})},async copyClicked(){this.message=null,await navigator.clipboard.writeText(this.person.access_token),this.message=this.$t("bots.token_copied"),setTimeout(()=>{this.message=null},5e3)},resetForm(){this.form={expiration_date:this.person.expiration_date},this.message=null,this.visible=!1}},watch:{active(){this.active&&this.resetForm()}}},ee={class:"modal-content"},te={class:"box"},se={class:"title"},oe={class:"mb2 warning-text"},ie={class:"flexrow right"},le=["disabled"],ae={class:"mb2 warning-text"},ne={class:"token"},re={class:"flexrow right"},de={key:0,class:"success has-text-right mr05"},ce=["disabled"];function me(e,t,n,b,s,o){const f=l("alert-triangle-icon"),v=l("date-field"),g=l("text-field"),k=l("eye-off-icon"),_=l("eye-icon");return a(),h("div",{class:M(["modal",{"is-active":n.active}])},[t[8]||(t[8]=i("div",{class:"modal-background"},null,-1)),i("div",ee,[i("div",te,[i("h1",se,c(e.$t("bots.new_token_title",{name:n.person.full_name})),1),n.person.access_token?(a(),h(R,{key:1},[i("p",ae,[d(f,{class:"icon mr05 warning"}),C(" "+c(e.$t("bots.copy_token_warning")),1)]),i("div",ne,[d(g,{ref:"token",disabled:!s.visible,"input-class":" token-input",readonly:!0,type:s.visible?"text":"password","model-value":n.person.access_token},null,8,["disabled","type","model-value"]),s.visible?(a(),m(k,{key:0,class:"icon",onClick:t[4]||(t[4]=r=>s.visible=!1)})):(a(),m(_,{key:1,class:"icon",onClick:t[5]||(t[5]=r=>s.visible=!0)}))]),i("div",re,[d(B,{name:"fade"},{default:N(()=>[s.message?(a(),h("p",de,c(s.message),1)):u("",!0)]),_:1}),i("button",{class:"button flexrow-item is-primary",onClick:t[6]||(t[6]=(...r)=>o.copyClicked&&o.copyClicked(...r)),disabled:!n.person.access_token},c(e.$t("main.copy")),9,ce),i("button",{class:"button flexrow-item is-link",onClick:t[7]||(t[7]=r=>e.$emit("close"))},c(e.$t("main.close")),1)])],64)):(a(),h("form",{key:0,class:"form",onSubmit:t[3]||(t[3]=U(()=>{},["prevent"]))},[i("p",oe,[d(f,{class:"icon mr05 warning"}),C(" "+c(e.$t("bots.new_token_warning")),1)]),d(v,{invalid:!o.isValidExpirationDate,label:e.$t("bots.fields.expiration_date"),"min-date":e.today,modelValue:s.form.expiration_date,"onUpdate:modelValue":t[0]||(t[0]=r=>s.form.expiration_date=r)},null,8,["invalid","label","min-date","modelValue"]),i("div",ie,[i("button",{class:"button flexrow-item is-primary",disabled:!o.isValidExpirationDate,onClick:t[1]||(t[1]=(...r)=>o.generateToken&&o.generateToken(...r))},c(e.$t("bots.generate")),9,le),i("button",{class:"button flexrow-item is-link",onClick:t[2]||(t[2]=r=>e.$emit("cancel"))},c(e.$t("main.cancel")),1)])],32))])])],2)}const pe=y($,[["render",me],["__scopeId","data-v-3bc778f6"]]),ue={name:"bots",mixins:[Q],components:{ButtonSimple:K,ComboboxDepartment:H,ComboboxStyled:z,EditAvatarModal:X,EditPersonModal:W,HardDeleteModal:j,NewTokenModal:pe,PageTitle:O,PeopleList:J,RouteTabs:Z,SearchField:G},data(){return{activeTab:"active",role:"all",roleOptions:[{label:"all",value:"all"},{label:"admin",value:"admin"},{label:"client",value:"client"},{label:"manager",value:"manager"},{label:"supervisor",value:"supervisor"},{label:"user",value:"user"},{label:"vendor",value:"vendor"}],errors:{avatar:!1,del:!1,edit:!1,userLimit:!1},loading:{del:!1,deletingAvatar:!1,edit:!1,updatingAvatar:!1},modals:{avatar:!1,del:!1,edit:!1,newToken:!1},personToDelete:{},personToEdit:{role:"user"},selectedDepartment:"",tabs:[{name:"active",label:this.$t("main.active")},{name:"unactive",label:this.$t("people.unactive")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.role=this.$route.query.role||"all",this.selectedDepartment=this.$route.query.department||"",this.setSearchFromUrl(),await this.loadPeople(),this.onSearchChange()},watch:{"modals.edit"(){this.modals.edit&&(this.errors.edit=!1,this.errors.userLimit=!1,this.loading.edit=!1)},selectedDepartment(){this.updateRoute()},role(){this.updateRoute()},"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},computed:{...I(["displayedPeople","isCurrentUserAdmin","isPeopleLoading","isPeopleLoadingError"]),currentPeople(){let e=this.displayedPeople.filter(t=>t.is_bot);return this.role!=="all"&&(e=e.filter(t=>t.role===this.role)),this.selectedDepartment&&(e=e.filter(t=>t.departments.includes(this.selectedDepartment))),e},deleteText(){const e=this.personToDelete?.full_name;return e?this.$t("people.delete_text",{personName:e}):""},searchField(){return this.$refs["search-field"]},activePeople(){return this.currentPeople.filter(e=>e.active)},unactivePeople(){return this.currentPeople.filter(e=>!e.active)}},methods:{...q(["clearPersonAvatar","deletePeople","editPerson","generateToken","loadPeople","newPerson","setPeopleSearch","uploadPersonAvatar"]),async deleteAvatar(){this.loading.deletingAvatar=!0;try{await this.clearPersonAvatar(this.personToEdit),this.modals.avatar=!1,this.onSearchChange()}catch{this.errors.avatar=!0}this.loading.deletingAvatar=!1},async updateAvatar(e){this.loading.updatingAvatar=!0;try{await this.uploadPersonAvatar({person:this.personToEdit,formData:e}),this.modals.avatar=!1,this.onSearchChange()}catch{this.errors.avatar=!0}this.loading.updatingAvatar=!1},confirmGenerateToken(e){this.generateToken(e).then(t=>{this.updatePersonToEdit(t)}).catch(console.error)},confirmEditPeople(e){let t="editPerson";this.personToEdit.id===void 0?t="newPerson":e.id=this.personToEdit.id,this.loading.edit=!0,this.errors.edit=!1,this.errors.userLimit=!1,this[t](e).then(n=>{this.loading.edit=!1,this.modals.edit=!1,n.access_token?.length&&(this.updatePersonToEdit(n),this.modals.newToken=!0),this.onSearchChange()}).catch(n=>{console.error(n),n.body?.message?.includes("limit")??!1?this.errors.userLimit=!0:this.errors.edit=!0,this.loading.edit=!1})},confirmDeletePeople(){this.loading.del=!0,this.errors.del=!1,this.deletePeople(this.personToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1,this.onSearchChange()}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},onSearchChange(){if(this.searchField){const e=this.searchField.getValue();e?.length!==1&&this.setPeopleSearch(e),this.setSearchInUrl()}this.tabs[0].label=`${this.$t("main.active")} (${this.activePeople.length})`,this.tabs[1].label=`${this.$t("people.unactive")} (${this.unactivePeople.length})`},onAvatarClicked(e){this.updatePersonToEdit(e),this.errors.avatar=!1,this.modals.avatar=!0},onDeleteClicked(e){this.personToDelete=e,this.modals.del=!0},onEditClicked(e){this.updatePersonToEdit(e),this.modals.edit=!0},onRefreshClicked(e){this.updatePersonToEdit(e),this.modals.newToken=!0},onNewClicked(){this.updatePersonToEdit({role:"user"}),this.modals.edit=!0},updatePersonToEdit(e){this.personToEdit={...e,expiration_date:e.expiration_date?new Date(e.expiration_date):null}},updateRoute(){const e=this.searchField.getValue(),t=this.selectedDepartment,n=this.role;this.$router.push({query:{search:e,department:t,role:n}})}},head(){return{title:`${this.$t("bots.title")} - Kitsu`}}},he={class:"bots page fixed-page"},fe={class:"flexrow page-header"},ve={class:"flexrow search-options"},be={key:1,class:"has-text-centered strong"};function ge(e,t,n,b,s,o){const f=l("page-title"),v=l("button-simple"),g=l("search-field"),k=l("combobox-department"),_=l("combobox-styled"),r=l("route-tabs"),T=l("people-list"),w=l("edit-avatar-modal"),x=l("edit-person-modal"),P=l("new-token-modal"),E=l("hard-delete-modal");return a(),h("div",he,[i("div",fe,[d(f,{class:"flexrow-item filler",text:e.$t("bots.title")},null,8,["text"]),e.isCurrentUserAdmin?(a(),m(v,{key:0,class:"flexrow-item",text:e.$t("bots.new_bot"),"is-responsive":!0,icon:"plus",onClick:o.onNewClicked},null,8,["text","onClick"])):u("",!0)]),i("div",ve,[d(g,{ref:"search-field",class:"search flexrow-item",onChange:o.onSearchChange,placeholder:"ex: gazu bot"},null,8,["onChange"]),d(k,{class:"flexrow-item",label:e.$t("main.department"),modelValue:s.selectedDepartment,"onUpdate:modelValue":t[0]||(t[0]=p=>s.selectedDepartment=p)},null,8,["label","modelValue"]),d(_,{class:"flexrow-item",label:e.$t("people.fields.role"),"locale-key-prefix":"people.role.",options:s.roleOptions,modelValue:s.role,"onUpdate:modelValue":t[1]||(t[1]=p=>s.role=p)},null,8,["label","options","modelValue"])]),t[7]||(t[7]=i("div",{class:"query-list"},null,-1)),d(r,{class:"mb0","active-tab":s.activeTab,tabs:s.tabs},null,8,["active-tab","tabs"]),e.isPeopleLoading||o.currentPeople.length>0?(a(),m(T,{key:0,entries:s.activeTab==="active"?o.activePeople:o.unactivePeople,"is-bots":!0,"is-loading":e.isPeopleLoading,"is-error":e.isPeopleLoadingError,onAvatarClicked:o.onAvatarClicked,onDeleteClicked:o.onDeleteClicked,onEditClicked:o.onEditClicked,onRefreshClicked:o.onRefreshClicked},null,8,["entries","is-loading","is-error","onAvatarClicked","onDeleteClicked","onEditClicked","onRefreshClicked"])):(a(),h("div",be,[i("p",null,c(e.$t("bots.no_bot")),1),e.isCurrentUserAdmin?(a(),m(v,{key:0,class:"mt1",text:e.$t("bots.new_bot"),"is-responsive":!0,onClick:o.onNewClicked},null,8,["text","onClick"])):u("",!0)])),s.modals.avatar?(a(),m(w,{key:2,active:"","error-text":e.$t("bots.edit_avatar_error"),"is-deleting":s.loading.deletingAvatar,"is-error":s.errors.avatar,"is-updating":s.loading.updatingAvatar,person:s.personToEdit,onClose:t[2]||(t[2]=p=>s.modals.avatar=!1),onDelete:o.deleteAvatar,onUpdate:o.updateAvatar},null,8,["error-text","is-deleting","is-error","is-updating","person","onDelete","onUpdate"])):u("",!0),s.modals.edit?(a(),m(x,{key:3,active:"","is-bot":!0,"is-error":s.errors.edit,"is-loading":s.loading.edit,"is-user-limit-error":s.errors.userLimit,"person-to-edit":s.personToEdit,onCancel:t[3]||(t[3]=p=>s.modals.edit=!1),onConfirm:o.confirmEditPeople},null,8,["is-error","is-loading","is-user-limit-error","person-to-edit","onConfirm"])):u("",!0),s.modals.newToken?(a(),m(P,{key:4,active:"",person:s.personToEdit,onCancel:t[4]||(t[4]=p=>s.modals.newToken=!1),onClose:t[5]||(t[5]=p=>s.modals.newToken=!1),onGenerateToken:o.confirmGenerateToken},null,8,["person","onGenerateToken"])):u("",!0),s.modals.del?(a(),m(E,{key:5,active:"","error-text":e.$t("people.delete_error"),"is-loading":s.loading.del,"is-error":s.errors.del,"lock-text":s.personToDelete?s.personToDelete.full_name:"",text:o.deleteText,onCancel:t[6]||(t[6]=p=>s.modals.del=!1),onConfirm:o.confirmDeletePeople},null,8,["error-text","is-loading","is-error","lock-text","text","onConfirm"])):u("",!0)])}const Ee=y(ue,[["render",ge],["__scopeId","data-v-ec1d8a17"]]);export{Ee as default};
//# sourceMappingURL=Bots-BKrjcaV5.js.map
