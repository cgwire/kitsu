import{S as l,T as u,m as r,a as c,r as d,n as o,f as h,B as p,C as m,b as _,c as f,D as v,E as y,d as C,P as g,R as k,e as w,g as A,h as b,i as S,s as T}from"./index-CONkTS-P.js";import{e as x,E as I,a as $,b as M,c as E}from"./EntityTaskList-DpdzyWEI.js";import{C as L}from"./ConceptCard-oEthkG-h.js";import{E as P}from"./EntityChat-q5pzcxpF.js";import"./PeopleNameCell-BxXu_Sgj.js";const z={name:"entity-output-files",components:{Spinner:l,TaskTypeCell:u},data(){return{isLoading:!1,outputFiles:[]}},props:{entity:{type:Object,default:()=>{}}},mounted(){this.entity&&this.reset()},computed:{...r(["currentProduction","isCurrentUserArtist","personMap","fileStatusMap","outputFileTypeMap","taskMap","taskTypeMap"])},methods:{...c(["loadEntityOutputFiles","loadFileStatuses","loadOutputTypes"]),getTaskType(e){return this.taskTypeMap.get(e.task_type_id)},getFileStatus(e){return this.fileStatusMap.get(e.file_status_id)},getOutputType(e){return this.outputFileTypeMap.get(e.output_type_id)},getDownloadPath(e){return`/api/${this.isMovie?"movies":"pictures"}/originals/output-files/${e}/download`},renderFileSize:d,async reset(){this.isLoading=!0,this.fileStatusMap.size===0&&await this.loadFileStatuses(),this.outputFileTypeMap.size===0&&await this.loadOutputTypes(),this.outputFiles=await this.loadEntityOutputFiles(this.entity.id),this.isLoading=!1}},watch:{entity(){this.entity&&this.reset()}}};var N=function(){var t=this,s=t._self._c;return s("div",{staticClass:"mt1 flexcolumn wrapper output-files"},[t.isLoading?s("div",{staticClass:"has-text-centered"},[s("spinner")],1):t.outputFiles.length>0?s("div",[s("table",{staticClass:"datatable"},[s("thead",{staticClass:"datatable-head"},[s("tr",{staticClass:"datatable-row-header"},[s("th",{staticClass:"tasktype"},[t._v(" "+t._s(t.$t("entities.output_files.task_type"))+" ")]),s("th",{staticClass:"type"},[t._v(" "+t._s(t.$t("entities.output_files.type"))+" ")]),s("th",{staticClass:"name"},[t._v(" "+t._s(t.$t("entities.output_files.name"))+" ")]),s("th",{staticClass:"extension"},[t._v(" "+t._s(t.$t("entities.output_files.extension"))+" ")]),s("th",{staticClass:"revision"},[t._v(" "+t._s(t.$t("entities.output_files.revision"))+" ")]),s("th",{staticClass:"size"},[t._v(" "+t._s(t.$t("entities.output_files.size"))+" ")]),s("th",{staticClass:"status"},[t._v(" "+t._s(t.$t("entities.output_files.status"))+" ")]),s("th",{staticClass:"person"},[t._v(" "+t._s(t.$t("entities.output_files.person"))+" ")]),s("th",{staticClass:"end-cell"})])]),s("tbody",{staticClass:"datatable-body"},[t._l(t.outputFiles,function(a){return[s("tr",{key:a.id,staticClass:"datatable-row"},[s("task-type-cell",{staticClass:"type",attrs:{"task-type":t.getTaskType(a),"production-id":t.currentProduction.id}}),s("td",{staticClass:"type"},[t._v(" "+t._s(t.getOutputType(a).name)+" ")]),s("td",{staticClass:"name"},[t._v(" "+t._s(a.name)+" ")]),s("td",{staticClass:"extension"},[t._v(" "+t._s(a.extension)+" ")]),s("td",{staticClass:"revision"},[t._v(" "+t._s(a.revision)+" ")]),s("td",{staticClass:"size"},[t._v(" "+t._s(t.renderFileSize(a.file_size))+" ")]),s("td",{staticClass:"status"},[t._v(" "+t._s(t.getFileStatus(a).name)+" ")]),s("people-name-cell",{staticClass:"person",attrs:{person:t.personMap.get(a.person_id)}}),s("td",{staticClass:"end-cell"})],1),a.path?s("tr",{key:"path-"+a.id,staticClass:"datatable-row"},[s("td",{attrs:{colspan:"10"}},[t._v(" "+t._s(a.path)+" ")])]):t._e()]})],2)])]):s("div",{staticClass:"empty"},[t._v(" "+t._s(t.$t("entities.output_files.no_output_files"))+" ")])])},D=[],O=o(z,N,D,!1,null,"ca13c35f",null,null);const B=O.exports,q={name:"asset",mixins:[x,h],components:{ButtonSimple:p,ConceptCard:L,ComboboxNumber:m,CornerLeftUpIcon:_,ComboboxStatus:f,DescriptionCell:v,EditAssetModal:y,EntityChat:P,EntityNews:I,EntityOutputFiles:B,EntityPreviewFiles:$,EntityThumbnail:C,EntityTaskList:M,EntityTimeLogs:E,PageSubtitle:g,RouteSectionTabs:k,Schedule:w,TableInfo:A,TaskInfo:b,TaskTypeName:S},data(){return{type:"asset",currentAsset:null,currentTask:null,currentConceptStatus:null,localTasks:[],castIn:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1,preview:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...r(["assetMap","assetSearchText","assetMetadataDescriptors","conceptMap","currentEpisode","currentProduction","getTaskTypePriority","isTVShow","isCurrentUserManager","linkedConcepts","route","taskMap","taskStatusMap","taskTypeMap","shotId"]),title(){return this.currentAsset?`${this.currentAsset.asset_type_name} / ${this.currentAsset.name}`:"Loading..."},assetThumbnailPath(){return`/api/pictures/originals/preview-files/${this.currentAsset.preview_file_id}.png`},isPreview(){return this.currentAsset&&this.currentAsset.preview_file_id&&this.currentAsset.preview_file_id.length>0},nbShotsCastedIn(){var t;return(((t=this.currentAsset)==null?void 0:t.castInShotsBySequence)||[]).reduce((s,a)=>s+a.length,0)},previousAssetPath(){const e=Array.from(this.assetMap.values());if(e.length===0)return{name:"open-productions"};const t=e.findIndex(n=>n&&this.currentAsset&&n.id===this.currentAsset.id),s=t!==0?t-1:e.length-1,a=e[s];if(!a)return{name:"open-productions"};const i={name:"asset",params:{production_id:this.currentProduction.id,asset_id:a.id},query:{search:""}};return this.currentEpisode&&(i.name="episode-asset",i.params.episode_id=this.currentEpisode.id),i},nextAssetPath(){const e=Array.from(this.assetMap.values());if(e.length===0)return{name:"open-productions"};const t=e.findIndex(n=>n&&this.currentAsset&&n.id===this.currentAsset.id),s=t===e.length-1?0:t+1,a=e[s];if(!a)return{name:"open-productions"};const i={name:"asset",params:{production_id:this.currentProduction.id,asset_id:a.id},query:{search:""}};return this.currentEpisode&&(i.name="episode-asset",i.params.episode_id=this.currentEpisode.id),i},assetsPath(){const e={name:"assets",params:{production_id:this.currentProduction.id},query:{search:this.assetSearchText||""}};return this.currentEpisode&&(e.name="episode-assets",e.params.episode_id=this.currentEpisode.id),e},assetNavOptions(){return[...this.entityNavOptions.slice(0,2),{label:"Concepts",value:"concepts"},...this.entityNavOptions.slice(2),{label:"Output Files",value:"output-files"}]},assetTabs(){return this.assetNavOptions.map(e=>({label:e.label,name:e.value}))},taskStatusList(){const e={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},t=T(Array.from(this.taskStatusMap.values()).filter(s=>s.for_concept));return[e].concat(t)},filteredLinkedConcepts(){return this.currentConceptStatus?this.linkedConcepts.filter(e=>e.tasks[0].task_status_id===this.currentConceptStatus):this.linkedConcepts}},methods:{...c(["clearSelectedTasks","editAsset","loadAsset","loadAssets","loadAssetCastIn","loadAssetCasting","loadLinkedConcepts","loadShots","setCurrentEpisode"]),changeTab(e){this.selectedTab=e},getCurrentAsset(){return new Promise((e,t)=>{const s=this.route.params.asset_id;this.currentAssetId=s,s||e(null);let a=this.assetMap.get(s)||null;if(a)return this.localTasks=a.tasks.map(i=>this.taskMap.get(i)),e(a);if(s)return this.loadAsset(s).then(()=>(a=this.assetMap.get(s),this.localTasks=a.tasks.map(i=>this.taskMap.get(i)),e(a)))})},getConceptTaskStatus(e){return this.taskStatusMap.get(e.tasks[0].task_status_id)},onEditClicked(){this.modals.edit=!0},confirmEditAsset(e){e.id=this.currentAsset.id,this.loading.edit=!0,this.errors.edit=!1,this.editAsset(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(t=>{console.error(t),this.loading.edit=!1,this.errors.edit=!0})},resetData(){this.castIn.isLoading=!0,this.$route.params.episode_id==="main"&&this.setCurrentEpisode("main"),this.$nextTick(()=>{this.getCurrentAsset().then(e=>(this.currentAsset=e,this.loadAssetCastIn(this.currentAsset))).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(e=>{this.castIn.isError=!0,this.castIn.isLoading=!1,console.error(e)})})},conceptPath(e){return{name:"concepts",params:{production_id:this.currentProduction.id}}},shotPath(e){return{name:e.episode_id?"episode-shot":"shot",params:{production_id:this.currentProduction.id,shot_id:e.shot_id,episode_id:e.episode_id?e.episode_id:void 0}}},init(){return this.getCurrentAsset().then(e=>{this.currentAsset=e,this.currentSection=this.route.query.section||"infos",this.castIn.isLoading=!0,this.castIn.isError=!1,this.currentAsset?this.loadAssetCastIn(this.currentAsset).then(()=>this.loadAssetCasting(this.currentAsset)).then(()=>{this.castIn.isLoading=!1}).then(()=>this.loadLinkedConcepts(this.currentAsset)).catch(t=>{this.castIn.isLoading=!1,this.castIn.isError=!0,console.error(t)}):this.resetData()}).then(()=>{setTimeout(()=>{this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},100)}).catch(console.error)}},watch:{$route(){const e=this.route.params.asset_id;this.currentAsset&&this.currentAsset.id!==e&&this.init(),this.currentSection=this.route.query.section||"infos"},currentSection(){this.currentSection==="schedule"&&this.scheduleItems.length>0&&this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)},zoomLevel(){this.$refs["schedule-widget"]&&this.$refs["schedule-widget"].scrollToDate(this.scheduleItems[0].startDate)}},metaInfo(){return{title:`${this.title} - Kitsu`}}};var F=function(){var a;var t=this,s=t._self._c;return s("div",{staticClass:"columns fixed-page asset xyz-in",attrs:{xyz:"fade"}},[s("div",{staticClass:"page column main-column"},[s("div",{staticClass:"page-header flexrow"},[s("router-link",{staticClass:"flexrow-item has-text-centered back-link ml1",attrs:{to:t.assetsPath}},[s("corner-left-up-icon")],1),s("span",{staticClass:"flexrow-item ml2"},[t.currentAsset?s("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:t.currentAsset,"empty-width":100,"empty-height":60,width:100}}):t._e()],1),s("div",{staticClass:"entity-title flexrow-item"},[t._v(" "+t._s(t.title)+" ")]),s("div",{staticClass:"filler"}),t.currentAsset&&t.currentAsset.ready_for&&t.currentAsset.ready_for!=="None"?s("div",{staticClass:"ready-for flexrow block mr0"},[s("span",{staticClass:"flexrow-item"},[t._v(" "+t._s(t.$t("assets.fields.ready_for"))+" ")]),s("task-type-name",{staticClass:"flexrow-item",attrs:{"task-type":t.taskTypeMap.get(t.currentAsset.ready_for),"current-production-id":this.currentProduction.id}})],1):t._e()],1),s("div",{staticClass:"asset-data block"},[s("route-section-tabs",{staticClass:"section-tabs",attrs:{activeTab:t.currentSection,route:t.$route,tabs:t.assetTabs}}),s("div",{staticClass:"flexrow mt1"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="casting"&&t.currentAsset.is_casting_standby,expression:`
            currentSection === 'casting' && currentAsset.is_casting_standby
          `}],staticClass:"tag tag-standby"},[t._v(" "+t._s(t.$t("breakdown.fields.standby"))+" ")]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"flexrow-item mt05"},[t._v(" "+t._s(t.$t("schedule.zoom_level"))+": ")]),s("combobox-number",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"zoom-level flexrow-item",attrs:{options:t.zoomOptions,"is-simple":""},model:{value:t.zoomLevel,callback:function(i){t.zoomLevel=i},expression:"zoomLevel"}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="infos",expression:"currentSection === 'infos'"}],staticClass:"flexrow infos"},[s("div",{staticClass:"flexrow-item flexcolumn entity-infos"},[s("page-subtitle",{attrs:{text:t.$t("main.tasks")}}),s("entity-task-list",{staticClass:"task-list",attrs:{entries:t.localTasks,"is-loading":!t.currentAsset,"is-error":!1},on:{"task-selected":t.onTaskSelected}}),s("div",{staticClass:"flexrow"},[s("page-subtitle",{attrs:{text:t.$t("main.info")}}),s("div",{staticClass:"filler"}),s("div",{staticClass:"flexrow-item has-text-right"},[t.isCurrentUserManager?s("button-simple",{attrs:{icon:"edit"},on:{click:function(i){t.modals.edit=!0}}}):t._e()],1)],1),s("div",{staticClass:"table-body"},[t.currentAsset?s("table",{staticClass:"datatable no-header"},[s("tbody",{staticClass:"table-body"},[s("tr",{staticClass:"datatable-row"},[s("td",{staticClass:"field-label"},[t._v(" "+t._s(t.$t("assets.fields.description"))+" ")]),s("description-cell",{attrs:{entry:t.currentAsset,full:!0}})],1),t._l(t.assetMetadataDescriptors,function(i){return s("tr",{key:i.id,staticClass:"datatable-row"},[s("td",{staticClass:"field-label"},[t._v(t._s(i.name))]),s("td",[t._v(" "+t._s(t.currentAsset.data?t.currentAsset.data[i.field_name]:"")+" ")])])})],2)]):t._e()])],1)]),t.currentSection==="chat"?s("entity-chat",{attrs:{entity:t.currentAsset,name:(a=t.currentAsset)==null?void 0:a.full_name}}):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="casting",expression:"currentSection === 'casting'"}],staticClass:"asset-casted-in"},[t.currentAsset?s("div",[t.currentAsset.castInShotsBySequence&&t.currentAsset.castInShotsBySequence[0].length>0?s("div",[s("em",[t._v("Casted in "+t._s(t.nbShotsCastedIn)+" shots")]),t._l(t.currentAsset.castInShotsBySequence,function(i){return i[0].sequence_name?s("div",{key:i.length>0?i[0].sequence_name:"",staticClass:"sequence-shots"},[s("div",{staticClass:"shot-sequence"},[t._v(" "+t._s(i.length>0?i[0].sequence_name:"")+" ")]),s("div",{staticClass:"shot-list"},t._l(i,function(n){return s("router-link",{key:n.shot_id,staticClass:"shot-link",attrs:{to:t.shotPath(n)}},[s("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:n,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),s("div",[s("span",{staticClass:"break-word"},[t._v(t._s(n.shot_name))]),n.nb_occurences>1?s("span",[t._v(" ("+t._s(n.nb_occurences)+") ")]):t._e()])],1)}),1)]):t._e()})],2):s("div",[t._v(" "+t._s(t.$t("assets.no_cast_in"))+" ")])]):s("table-info",{attrs:{"is-loading":t.castIn.isLoading,"is-error":t.castIn.isError}}),t.currentAsset&&t.currentAsset.castingAssetsByType&&t.currentAsset.castingAssetsByType[0].length>0?s("div",[s("page-subtitle",{attrs:{text:t.$t("assets.linked")}}),t.currentAsset.castingAssetsByType&&t.currentAsset.castingAssetsByType[0].length>0?s("div",t._l(t.currentAsset.castingAssetsByType,function(i){return s("div",{key:i.length>0?i[0].asset_type_name:"",staticClass:"type-assets"},[s("div",{staticClass:"asset-type"},[t._v(" "+t._s(i.length>0?i[0].asset_type_name:"")+" ("+t._s(i.length)+") ")]),s("div",{staticClass:"asset-list"},t._l(i,function(n){return s("router-link",{key:n.id,staticClass:"asset-link",attrs:{to:{name:"asset",params:{production_id:t.currentProduction.id,asset_id:n.asset_id}}}},[s("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:n,square:!0,"empty-width":103,"empty-height":103,"with-link":!1}}),s("div",[s("span",{staticClass:"break-word"},[t._v(t._s(n.asset_name))]),n.nb_occurences>1?s("span",[t._v(" ("+t._s(n.nb_occurences)+") ")]):t._e()])],1)}),1)])}),0):t._e()],1):t._e()],1),t.currentAsset?s("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="concepts",expression:"currentSection === 'concepts'"}],staticClass:"concepts"},[s("combobox-status",{attrs:{label:t.$t("main.status"),"task-status-list":t.taskStatusList},model:{value:t.currentConceptStatus,callback:function(i){t.currentConceptStatus=i},expression:"currentConceptStatus"}}),s("div",{staticClass:"concept-list mt1"},[t.filteredLinkedConcepts.length?t._l(t.filteredLinkedConcepts,function(i){return s("concept-card",{key:"concept-"+i.id,attrs:{concept:i}})}):s("div",[t._v(" "+t._s(t.$t("assets.no_concept"))+" ")])],2)],1):t._e(),t.scheduleItems[0].children.length>0?s("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="schedule",expression:"currentSection === 'schedule'"}],staticClass:"schedule mt1"},[s("div",{staticClass:"wrapper"},[s("schedule",{ref:"schedule-widget",attrs:{"start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},on:{"item-changed":t.saveTaskScheduleItem,"estimation-changed":i=>t.saveTaskScheduleItem(i.item)}})],1)]):t._e(),t.currentSection==="preview-files"?s("entity-preview-files",{attrs:{entity:t.currentAsset}}):t._e(),t.currentSection==="time-logs"?s("entity-time-logs",{attrs:{entity:t.currentAsset}}):t._e(),t.currentSection==="output-files"?s("entity-output-files",{attrs:{entity:t.currentAsset}}):t._e()],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.currentSection==="infos",expression:"currentSection === 'infos'"}],staticClass:"column side-column"},[s("task-info",{attrs:{task:t.currentTask,"entity-type":"Asset","with-actions":""}},[s("entity-news",{staticClass:"news-column",attrs:{entity:t.currentAsset}})],1)],1),s("edit-asset-modal",{ref:"edit-asset-modal",attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"asset-to-edit":t.currentAsset},on:{cancel:function(i){t.modals.edit=!1},confirm:t.confirmEditAsset}})],1)},R=[],U=o(q,F,R,!1,null,"7e89cb38",null,null);const J=U.exports;export{J as default};
//# sourceMappingURL=Asset-DSgrIYQW.js.map
