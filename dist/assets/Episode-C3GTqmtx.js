import{_ as O,E as W,C as G,j as H,B as K,r as n,o,c as d,d as s,f as r,w as _,g as p,h as c,k as m,v as h,t as l,F as E,e as k,H as J,ab as Q,D as w,a as X,b as Y}from"./index-C2m_IhNF.js";import{E as Z,a as x,b as $,c as ee,e as te}from"./EntityTaskList-CZTh0d-y.js";import{f as se}from"./format-CUjWrpVJ.js";import{C as ie}from"./ComboboxNumber-CjSlWfmA.js";import{D as oe}from"./DescriptionCell-JDDrCWCB.js";import{E as ne}from"./EditEpisodeModal-BlfaEUgi.js";import{E as re}from"./EntityChat-HdGpW8i5.js";import{P as le}from"./PageTitle-DzrTLr4-.js";import{P as ae}from"./PageSubtitle-LvZN62xu.js";import{R as de}from"./RouteSectionTabs-B7npqca_.js";import{S as ce}from"./Schedule-BBoWBvCl.js";import{T as pe}from"./TableInfo-B2X54z7i.js";import ue from"./TaskInfo-C8qSIbPH.js";import{T as me}from"./TaskTypeName-bEgQZfX7.js";import{C as he}from"./corner-left-up-D3eQ9gWL.js";import"./string-B0Tq569e.js";import"./ValidationTag-C6BUHddW.js";import"./render-Bqw3AFAH.js";import"./video-Yn96Kb74.js";import"./EntityPreview-DQBzHKkN.js";import"./VideoViewer-Da8LCLxo.js";import"./index-KDZ8UbBO.js";import"./dom-tO7tlkHV.js";import"./eye-CKzk1Q6q.js";import"./PeopleNameCell-Et8wdH5i.js";import"./TaskTypeCell-DM2gnWrD.js";import"./ComboboxStyled-fscUNRmK.js";import"./BuildFilterModal-C3nrV5vY.js";import"./Combobox-DQpIQydI.js";import"./ComboboxStatus-DYpCiml-.js";import"./ComboboxTaskType-CiBcPUsC.js";import"./ComboboxBoolean-DJwCfClJ.js";import"./TextField-p_HJuEKt.js";import"./ModalFooter-BJ98b-60.js";import"./PeopleField-CJ8IkJD1.js";import"./TextareaField-Bd7jnoYr.js";import"./EmojiButton-B9I5hDFH.js";import"./FileUpload-C4E3YXqL.js";import"./ConfirmModal-CYuRpfjg.js";import"./DepartmentName-C_7ZW05X.js";import"./list-chevrons-up-down-ByJjEZOU.js";import"./briefcase-DXQKuIYE.js";import"./csv-cx9HGs3n.js";import"./PreviewPlayer-CsSraBfQ.js";import"./PlaylistPlayer-DoTL8QsR.js";import"./ComboboxSimple-DU0Ahozo.js";import"./clipboard-CQqgyZ_h.js";import"./DeleteModal-CaB_X4-T.js";import"./BaseModal-BCd5z4wK.js";import"./ComboboxDepartment-whRm-Bo0.js";import"./ComboboxStudio-q2R7SCuH.js";import"./play-B4GV49GM.js";import"./triangle-alert-DAfmXCpT.js";import"./thumbs-up-DoHhBcNt.js";import"./copy-BH2iDnK6.js";import"./vue.esm-bundler-Cb2j4MJL.js";import"./DeleteEntities-ZGV8gTRL.js";import"./HardDeleteModal-CyBgP8oG.js";import"./SearchField-DO27Jrsj.js";import"./corner-right-up-xElzR7oO.js";const fe={name:"episode",mixins:[te,se],components:{ButtonSimple:K,ChevronLeftIcon:H,ChevronRightIcon:G,ComboboxNumber:ie,CornerLeftUpIcon:he,DescriptionCell:oe,EditEpisodeModal:ne,EntityChat:re,EntityNews:ee,EntityPreviewFiles:$,EntityTaskList:x,EntityTimeLogs:Z,EntityThumbnail:W,PageSubtitle:ae,PageTitle:le,RouteSectionTabs:de,Schedule:ce,TableInfo:pe,TaskInfo:ue,TaskTypeName:me},data(){return{type:"episode",currentEpisode:null,currentTask:null,casting:{isLoading:!1,isError:!1},errors:{edit:!1},loading:{edit:!1},modals:{edit:!1}}},mounted(){this.clearSelectedTasks(),this.init()},computed:{...Y(["currentProduction","getTaskTypePriority","episodeMap","episodeMetadataDescriptors","episodeSearchText","isCurrentUserManager","route","taskMap","taskTypeMap"]),title(){return this.currentEpisode?`${this.currentEpisode.name}`:this.$t("main.loading")},currentEntity(){return this.currentEpisode},getEpisodesRoute(){const e={name:"episodes",params:{production_id:this.currentProduction.id,project_id:this.currentProduction.id},query:{search:this.episodeSearchText}};return e.name="episodes",e},nbAssets(){let e=0;return this.currentEpisode&&this.currentSection==="casting"&&this.currentEpisode.castingAssetsByType&&this.currentEpisode.castingAssetsByType.forEach(i=>{e+=i.length}),e}},methods:{...X(["clearSelectedTasks","editEpisode","setCurrentEpisode","loadEpisodesWithTasks","loadEpisodeCasting"]),init(){this.loadCurrentEpisode().then(e=>{this.currentEpisode=e,this.currentSection=this.route.query.section||"infos",this.casting.isLoading=!0,this.casting.isError=!1,this.currentEpisode?this.loadEpisodeCasting(this.currentEpisode).then(()=>{this.casting.isLoading=!1}).catch(i=>{this.casting.isLoading=!1,this.casting.isError=!0,console.error(i)}):this.resetData()}).catch(console.error)},async loadCurrentEpisode(){const e=this.route.params.episode_id,i=w.cache.episodeMap.get(e)||null;return!i||!i.validations?(await this.loadEpisodesWithTasks(),w.cache.episodeMap.get(e)||null):i},confirmEditEpisode(e){e.id=this.currentEpisode.id,this.loading.edit=!0,this.errors.edit=!1,this.editEpisode(e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},buildAssetRoute(e){const i=this.currentEpisode.id,g={name:"asset",params:{production_id:this.currentProduction.id,asset_id:e.asset_id}};return Q(g,i)},resetData(){this.casting.isLoading=!0,this.$nextTick(()=>{this.loadCurrentEpisode().then(e=>(this.currentEpisode=e,this.loadEpisodeCasting(this.currentEpisode))).then(()=>{this.casting.isLoading=!1}).catch(e=>{this.casting.isError=!0,this.casting.isLoading=!1,console.error(e)})})}},head(){return{title:`${this.title} - Kitsu`}}},_e={class:"columns fixed-page episode xyz-in",xyz:"fade"},ye={class:"column main-column"},ge={class:"page-header flexrow"},Ee={class:"flexrow-item ml2"},ke={class:"flexrow-item"},be={class:"episode-data block"},ve={class:"flexrow infos"},we={class:"flexrow-item flexcolumn entity-infos"},Te={class:"flexrow"},Se={class:"flexrow-item has-text-right"},Ce={class:"table-body"},Le={key:0,class:"datatable no-header"},Pe={class:"table-body"},Me={class:"datatable-row"},Be={class:"field-label"},De={key:0,class:"datatable-row"},ze={class:"field-label"},Ie={class:"field-label"},Re={class:"flexrow"},Ne={class:"episode-casting"},Ae={key:0},Ve={key:0},Ue={class:"asset-type"},qe={class:"asset-list"},Fe={class:"break-word"},je={key:0},Oe={class:"ready-for flexrow"},We={key:1,class:"mt1"},Ge={key:0,class:"schedule mt1"},He={class:"wrapper"},Ke={class:"column side-column"};function Je(e,i,g,Qe,t,f){const T=n("corner-left-up-icon"),y=n("router-link"),b=n("entity-thumbnail"),S=n("page-title"),C=n("chevron-left-icon"),L=n("chevron-right-icon"),P=n("route-section-tabs"),v=n("page-subtitle"),M=n("entity-task-list"),B=n("button-simple"),D=n("description-cell"),z=n("combobox-number"),I=n("task-type-name"),R=n("table-info"),N=n("schedule"),A=n("entity-chat"),V=n("entity-preview-files"),U=n("entity-time-logs"),q=n("entity-news"),F=n("task-info"),j=n("edit-episode-modal");return o(),d("div",_e,[s("div",ye,[s("div",ge,[r(y,{class:"flexrow-item has-text-centered back-link",to:f.getEpisodesRoute},{default:_(()=>[r(T)]),_:1},8,["to"]),s("span",Ee,[t.currentEpisode?(o(),p(b,{key:0,class:"entity-thumbnail",entity:t.currentEpisode,"empty-width":120,"empty-height":50,width:120},null,8,["entity"])):c("",!0)]),s("div",ke,[r(S,{text:f.title,class:"entity-title"},null,8,["text"])]),i[3]||(i[3]=s("div",{class:"filler"},null,-1)),e.previousEntityPath&&e.entityList.length>1?(o(),p(y,{key:0,class:"flexrow-item has-text-centered back-link ml1",to:e.previousEntityPath},{default:_(()=>[r(C)]),_:1},8,["to"])):c("",!0),e.nextEntityPath&&e.entityList.length>1?(o(),p(y,{key:1,class:"flexrow-item has-text-centered back-link",to:e.nextEntityPath},{default:_(()=>[r(L)]),_:1},8,["to"])):c("",!0)]),s("div",be,[r(P,{class:"section-tabs","active-tab":e.currentSection,route:e.$route,tabs:e.entityNavOptions},null,8,["active-tab","route","tabs"]),m(s("div",ve,[s("div",we,[r(v,{text:e.$t("main.tasks")},null,8,["text"]),r(M,{class:"task-list",entries:e.currentTasks,"is-loading":!t.currentEpisode,"is-error":!1,onTaskSelected:e.onTaskSelected},null,8,["entries","is-loading","onTaskSelected"]),s("div",Te,[r(v,{text:e.$t("main.info")},null,8,["text"]),i[4]||(i[4]=s("div",{class:"filler"},null,-1)),s("div",Se,[e.isCurrentUserManager?(o(),p(B,{key:0,icon:"edit",title:e.$t("episodes.edit_title"),onClick:i[0]||(i[0]=a=>t.modals.edit=!0)},null,8,["title"])):c("",!0)])]),s("div",Ce,[t.currentEpisode?(o(),d("table",Le,[s("tbody",Pe,[s("tr",Me,[s("td",Be,l(e.$t("shots.fields.description")),1),r(D,{entry:t.currentEpisode,full:!0},null,8,["entry"])]),t.currentEpisode&&t.currentEpisode.data&&t.currentEpisode.data.resolution?(o(),d("tr",De,[s("td",ze,l(e.$t("shots.fields.resolution")),1),s("td",null,l(t.currentEpisode?t.currentEpisode.data.resolution:""),1)])):c("",!0),(o(!0),d(E,null,k(e.episodeMetadataDescriptors,a=>(o(),d("tr",{key:a.id,class:"datatable-row"},[s("td",Ie,l(a.name),1),s("td",null,l(t.currentEpisode.data?t.currentEpisode.data[a.field_name]:""),1)]))),128))])])):c("",!0)])])],512),[[h,e.currentSection==="infos"]]),s("div",Re,[m(s("span",null,l(f.nbAssets)+" "+l(e.$tc("assets.number",f.nbAssets)),513),[[h,e.currentSection==="casting"]]),m(s("span",{class:"tag tag-standby"},l(e.$t("breakdown.fields.standby")),513),[[h,e.currentSection==="casting"&&t.currentEpisode.is_casting_standby]]),i[5]||(i[5]=s("div",{class:"filler"},null,-1)),m(s("span",{class:"flexrow-item mt05"},l(e.$t("schedule.zoom_level"))+": ",513),[[h,e.currentSection==="schedule"]]),m(r(z,{class:"zoom-level flexrow-item",options:e.zoomOptions,"is-simple":"",modelValue:e.zoomLevel,"onUpdate:modelValue":i[1]||(i[1]=a=>e.zoomLevel=a)},null,8,["options","modelValue"]),[[h,e.currentSection==="schedule"]])]),m(s("div",Ne,[t.currentEpisode?(o(),d("div",Ae,[t.currentEpisode&&t.currentEpisode.castingAssetsByType&&t.currentEpisode.castingAssetsByType[0].length>0?(o(),d("div",Ve,[(o(!0),d(E,null,k(t.currentEpisode.castingAssetsByType,a=>(o(),d("div",{class:"type-assets",key:a.length>0?a[0].asset_type_name:""},[s("div",Ue,l(a.length>0?a[0].asset_type_name:"")+" ("+l(a.length)+") ",1),s("div",qe,[(o(!0),d(E,null,k(a,u=>(o(),p(y,{class:"asset-link",key:u.id,to:f.buildAssetRoute(u)},{default:_(()=>[r(b,{class:"entity-thumbnail",entity:u,square:!0,"empty-width":103,"empty-height":103,"with-link":!1},null,8,["entity"]),s("div",Fe,[J(l(u.asset_name)+" ",1),u.nb_occurences>1?(o(),d("span",je," ("+l(u.nb_occurences)+") ",1)):c("",!0)]),s("div",Oe,[u.ready_for?(o(),p(I,{key:0,class:"flexrow-item","task-type":e.taskTypeMap.get(u.ready_for),"current-production-id":e.currentProduction.id,title:"Ready for: "+e.taskTypeMap.get(u.ready_for).name},null,8,["task-type","current-production-id","title"])):c("",!0)])]),_:2},1032,["to"]))),128))])]))),128))])):(o(),d("div",We,l(e.$t("episodes.no_casting")),1))])):(o(),p(R,{key:1,"is-loading":t.casting.isLoading,"is-error":t.casting.isError},null,8,["is-loading","is-error"]))],512),[[h,e.currentSection==="casting"]]),e.scheduleItems[0].children.length>0?m((o(),d("div",Ge,[s("div",He,[r(N,{ref:"schedule-widget","start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1},null,8,["start-date","end-date","hierarchy","zoom-level"])])],512)),[[h,e.currentSection==="schedule"]]):m((o(),d("div",{key:1,class:"mt1"},l(e.$t("main.empty_schedule")),513)),[[h,e.currentSection==="schedule"]]),e.currentSection==="chat"?(o(),p(A,{key:2,entity:t.currentEpisode,name:t.currentEpisode?.name},null,8,["entity","name"])):c("",!0),e.currentSection==="preview-files"?(o(),p(V,{key:3,entity:t.currentEpisode},null,8,["entity"])):c("",!0),e.currentSection==="time-logs"?(o(),p(U,{key:4,entity:t.currentEpisode},null,8,["entity"])):c("",!0)])]),m(s("div",Ke,[r(F,{task:t.currentTask,"entity-type":"Episode","with-actions":""},{default:_(()=>[r(q,{class:"news-column",entity:t.currentEpisode},null,8,["entity"])]),_:1},8,["task"])],512),[[h,e.currentSection==="infos"]]),r(j,{ref:"edit-episode-modal",active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"episode-to-edit":t.currentEpisode,onCancel:i[2]||(i[2]=a=>t.modals.edit=!1),onConfirm:f.confirmEditEpisode},null,8,["active","is-loading","is-error","episode-to-edit","onConfirm"])])}const ts=O(fe,[["render",Je],["__scopeId","data-v-761a1c66"]]);export{ts as default};
//# sourceMappingURL=Episode-C3GTqmtx.js.map
