import{_ as I,o as a,c as r,d as c,t as f,n as _,M as Y,r as p,q as X,I as E,k as O,f as y,F as b,h as u,E as J,b as D,e as k,i as C,g as v,N as Z,a as q,S as $,B as ee,v as B,x as T,J as se,y as L}from"./index-C2m_IhNF.js";import{c as A}from"./csv-cx9HGs3n.js";import{c as F}from"./clipboard-CQqgyZ_h.js";import{s as x}from"./string-B0Tq569e.js";import{s as te}from"./search-CWIHq9c3.js";import{e as R}from"./entity_list-EwCggK6z.js";import{d as ie,B as ne}from"./BuildFilterModal-C3nrV5vY.js";import{B as ae}from"./ButtonHrefLink-Cg__Yhd0.js";import{C as oe}from"./ComboboxStyled-fscUNRmK.js";import{D as re}from"./DeleteModal-CaB_X4-T.js";import{D as le}from"./DepartmentName-C_7ZW05X.js";import{E as de}from"./EditAssetModal-CPhWz-DX.js";import{C as ce}from"./Combobox-DQpIQydI.js";import{M as he}from"./ModalFooter-BJ98b-60.js";import{I as me,a as ue}from"./ImportRenderModal-DmK76ufV.js";import{S as fe}from"./SearchField-DO27Jrsj.js";import{S as pe}from"./SearchQueryList-BrkMtSsZ.js";import{a as ye}from"./render-Bqw3AFAH.js";import{d as ge}from"./dom-tO7tlkHV.js";import{T as ve}from"./TableMetadataSelectorMenu-lq871AXj.js";import"./ComboboxStatus-DYpCiml-.js";import"./ComboboxTaskType-CiBcPUsC.js";import"./TaskTypeName-bEgQZfX7.js";import"./ComboboxBoolean-DJwCfClJ.js";import"./TextField-p_HJuEKt.js";import"./PeopleField-CJ8IkJD1.js";import"./upload-C0APJe-3.js";import"./TextareaField-Bd7jnoYr.js";import"./FileUpload-C4E3YXqL.js";import"./Checkbox-ByQFc4Am.js";import"./ConfirmModal-CYuRpfjg.js";import"./BooleanField-BK_C2MOf.js";import"./check-_fRnDsm9.js";import"./ComboboxDepartment-whRm-Bo0.js";import"./ColorField--VnpcHkf.js";import"./trash-2-DSHW2jWN.js";import"./chevron-up-kHAV03RH.js";import"./video-Yn96Kb74.js";import"./vuedraggable.umd-CN5ywgj8.js";import"./vue.esm-bundler-Cb2j4MJL.js";import"./grip-vertical-iCvwh_h9.js";const be={name:"available-asset-block",props:{asset:{default:()=>({id:"",name:""}),type:Object},active:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},bigMode:{default:!0,type:Boolean}},emits:["add-one","add-ten"],methods:{addOneAsset(e){this.active&&this.$emit("add-one",this.asset.id)},addTenAssets(e){this.active&&this.$emit("add-ten",this.asset.id)}}},ke=["id","title"],we={key:0,class:"asset-picture"},Ce=["src"],_e={key:1,class:"asset-picture"},Se={class:"empty-picture"},Ee={class:"asset-text-name flexrow-item"};function Ie(e,s,t,l,n,i){return t.textMode?(a(),r("div",{key:1,class:_(["asset-text flexrow-item flexrow",{shared:t.asset.shared}])},[c("span",Ee,f(t.asset.name),1),c("span",{class:"modify-asset flexrow-item",onClick:s[2]||(s[2]=(...h)=>i.addOneAsset&&i.addOneAsset(...h))}," + 1 ")],2)):(a(),r("div",{key:0,id:`casting-${t.asset.id}`,class:_(["asset",{active:t.active,"big-asset":t.bigMode,shared:t.asset.shared}]),title:t.asset.name},[c("div",{class:"asset-add",onClick:s[0]||(s[0]=(...h)=>i.addOneAsset&&i.addOneAsset(...h))},"+ 1"),c("div",{class:"asset-add-10",onClick:s[1]||(s[1]=(...h)=>i.addTenAssets&&i.addTenAssets(...h))},"+ 10"),t.asset.preview_file_id?(a(),r("div",we,[c("img",{loading:"lazy",alt:"",src:`/api/pictures/thumbnails-square/preview-files/${t.asset.preview_file_id}.png`},null,8,Ce)])):(a(),r("div",_e,[c("span",Se,f(t.asset.name),1)]))],10,ke))}const Te=I(be,[["render",Ie],["__scopeId","data-v-9d0dcb14"]]),Me={name:"edit-label-modal",mixins:[Y],components:{Combobox:ce,ModalFooter:he},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},label:{type:String}},emits:["cancel","confirm"],mounted(){this.form.label=this.label},data(){return{form:{label:"animate"},typeOptions:[{label:this.$t("breakdown.options.animate"),value:"animate"},{label:this.$t("breakdown.options.fixed"),value:"fixed"}]}},methods:{confirm(){return this.$emit("confirm",this.form)}},watch:{label(){this.form.label=this.label}}},Ae={class:"modal-content"},Oe={class:"box content"},De={class:"title"};function Be(e,s,t,l,n,i){const h=p("combobox"),g=p("modal-footer"),o=X("focus");return a(),r("div",{class:_({modal:!0,"is-active":t.active})},[c("div",{class:"modal-background",onClick:s[0]||(s[0]=m=>e.$emit("cancel"))}),c("div",Ae,[c("div",Oe,[c("h1",De,f(e.$t("breakdown.edit_label")),1),c("form",{onSubmit:s[3]||(s[3]=E(()=>{},["prevent"]))},[O(y(h,{ref:"typeField",label:e.$t("breakdown.label"),options:n.typeOptions,onEnter:i.confirm,modelValue:n.form.label,"onUpdate:modelValue":s[1]||(s[1]=m=>n.form.label=m)},null,8,["label","options","onEnter","modelValue"]),[[o]]),y(g,{"is-error":t.isError,"is-loading":t.isLoading,onConfirm:i.confirm,onCancel:s[2]||(s[2]=m=>e.$emit("cancel"))},null,8,["is-error","is-loading","onConfirm"])],32)])])],2)}const Le=I(Me,[["render",Be],["__scopeId","data-v-5af38152"]]),Fe={name:"asset-block",mixins:[ge],props:{asset:{default:()=>({id:"",name:""}),type:Object},nbOccurences:{default:1,type:Number},active:{default:!0,type:Boolean},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},bigMode:{default:!1,type:Boolean}},emits:["add-one","edit-label","remove-one"],methods:{removeOneAsset(e){this.$emit("remove-one",this.asset.asset_id)},addOneAsset(e){this.$emit("add-one",this.asset.asset_id)},shortenName(e){return x.shortenText(e,13)},onEditLabelClicked(){this.readOnly||this.$emit("edit-label",this.asset,this.asset.label)}}},qe=["title"],xe={class:"asset-wrapper"},Re={key:1,class:"asset-picture"},Ve=["src"],Ne={key:0,class:"nb-occurences"},Pe={key:2,class:"asset-picture"},Ue={class:"empty-picture"},We=["label"],He={class:"asset-text-name flexrow-item filler"};function ze(e,s,t,l,n,i){return t.textMode?(a(),r("div",{key:1,class:_(["asset-text flexrow-item flexrow",{shared:t.asset.shared}])},[c("span",He,f(t.asset.name)+" ("+f(t.nbOccurences)+") ",1),!t.readOnly&&t.active?(a(),r("span",{key:0,class:"modify-asset flexrow-item",onClick:s[3]||(s[3]=E((...h)=>i.removeOneAsset&&i.removeOneAsset(...h),["stop"]))}," - 1 ")):u("",!0)],2)):(a(),r("div",{key:0,class:_(["asset big casted labelled",{active:t.active,"big-asset":t.bigMode,shared:t.asset.shared}]),title:`${t.asset.name} (${t.nbOccurences})`},[c("div",xe,[!t.readOnly&&t.active?(a(),r(b,{key:0},[c("div",{class:"asset-add-1",onClick:s[0]||(s[0]=E((...h)=>i.addOneAsset&&i.addOneAsset(...h),["stop"]))},"+ 1"),c("div",{class:"asset-add",onClick:s[1]||(s[1]=E((...h)=>i.removeOneAsset&&i.removeOneAsset(...h),["stop"]))},"- 1")],64)):u("",!0),t.asset.preview_file_id?(a(),r("div",Re,[c("img",{loading:"lazy",alt:"",src:`/api/pictures/thumbnails-square/preview-files/${t.asset.preview_file_id}.png`},null,8,Ve),t.nbOccurences>1?(a(),r("span",Ne,f(t.nbOccurences),1)):u("",!0)])):(a(),r("div",Pe,[c("span",Ue,f(i.shortenName(t.asset.name))+" ("+f(t.nbOccurences)+") ",1)]))]),c("div",{class:"asset-label",label:t.asset.label,onClick:s[2]||(s[2]=(...h)=>i.onEditLabelClicked&&i.onEditLabelClicked(...h))},f(t.asset.label||e.$t("breakdown.options.animate")),9,We)],10,qe))}const Ke=I(Fe,[["render",ze],["__scopeId","data-v-6c299a76"]]),je={name:"shot-line",mixins:[R,ie],components:{AssetBlock:Ke,EntityThumbnail:J},props:{entity:{default:()=>{},type:Object},previewFileId:{default:"",type:String},selected:{default:!1,type:Boolean},name:{default:"",type:String},assets:{default:()=>[],type:Array},assetTypes:{default:()=>[],type:Array},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean},metadataDescriptors:{default:()=>[],type:Array},metadataDisplayHeaders:{default:()=>{},type:Object},bigMode:{default:!1,type:Boolean},isDescription:{default:!0,type:Boolean},isSaveError:{default:!1,type:Boolean},columnWidth:{default:()=>{},type:Object}},emits:["add-one","click","edit-label","field-changed","remove-one"],computed:{...D(["assetMap","isCurrentUserManager","isCurrentUserSupervisor","isFrameIn","isFrameOut","isFrames","isShowInfosBreakdown","user"]),chunks(){return this.name.split(" / ").filter(s=>s&&s!=="undefined")},assetsByAssetTypesMap(){const e={};return this.assets.forEach(s=>{s[0]&&(e[s[0].asset_type_name]=s)}),e}},methods:{onClicked(e){this.$emit("click",this.entity.id,e)},onEditLabelClicked(e,s){this.$emit("edit-label",e,s,this.entity.id)},removeOneAsset(e){this.$emit("remove-one",e)},addOneAsset(e){this.$emit("add-one",e)},onDescriptionChanged(e,s){this.$emit("field-changed",{entry:e,fieldName:"description",value:s.target.value})},onNbFramesChanged(e,s){this.$emit("field-changed",{entry:e,fieldName:"nb_frames",value:s.target.value})},onStandbyChanged(e,s){this.$emit("field-changed",{entry:e,fieldName:"is_casting_standby",value:s.target.checked})},renderMarkdown:ye,nbAssetsForType(e){return this.assetsByAssetTypesMap[e].reduce((s,t)=>s+t.nb_occurences,0)}}},Qe=["id"],Ge={key:0,class:"error has-text-left info-message"},Ye={class:"flexrow"},Xe={class:"shot-name flexrow-item ml05"},Je={key:0,class:"standby-column flexrow-item"},Ze=["checked","disabled"],$e={key:1,class:"description-column flexrow-item"},es=["innerHTML"],ss=["value"],ts={key:2,class:"frames-column flexrow-item"},is=["value"],ns={key:1,class:"metadata-value selectable"},as={key:3,class:"frames-column flexrow-item"},os=["value"],rs={key:1,class:"metadata-value selectable"},ls={key:4,class:"frames-column flexrow-item"},ds=["value"],cs={key:1,class:"metadata-value selectable"},hs=["title"],ms=["onInput","value"],us={key:1,class:"metadata-value selectable"},fs=["onChange","id","checked","disabled"],ps=["for"],ys={key:2,class:"select"},gs=["onChange"],vs=["value","selected"],bs={key:3,class:"metadata-value selectable"},ks={key:0,class:"asset-type-line flexcolumn"},ws={class:"flexrow-item mb05"},Cs={class:"asset-type-items flexrow-item"},_s={key:1,class:"asset-type-line flexrow empty mt05 mb05"};function Ss(e,s,t,l,n,i){const h=p("entity-thumbnail"),g=p("asset-block");return a(),r("div",{id:t.entity.id,class:_(["shot unselectable",{selected:t.selected,stdby:t.entity?t.entity.is_casting_standby:!1,"text-mode":t.textMode}]),onClick:s[5]||(s[5]=o=>i.onClicked(o))},[c("div",{class:"flexrow-item sticky",style:C({"max-width":t.columnWidth.name?t.columnWidth.name+"px":"250px","min-width":t.columnWidth.name?t.columnWidth.name+"px":"250px"})},[t.isSaveError?(a(),r("p",Ge,f(e.$t("breakdown.save_error")),1)):u("",!0),c("div",Ye,[y(h,{class:"flexrow-item mr1",entity:{},height:t.bigMode?100:60,width:t.bigMode?150:90,"empty-height":t.bigMode?100:60,"empty-width":t.bigMode?150:90,"preview-file-id":t.previewFileId},null,8,["height","width","empty-height","empty-width","preview-file-id"]),c("div",Xe,[(a(!0),r(b,null,k(i.chunks,(o,m)=>(a(),r("div",{key:`chunk-${m}`},f(o),1))),128))])])],4),e.isShowInfosBreakdown?(a(),r("div",Je,[c("input",{type:"checkbox",checked:t.entity?t.entity.is_casting_standby:!1,disabled:!e.isCurrentUserManager,style:C([e.isCurrentUserManager?{cursor:"pointer"}:{cursor:"auto"}]),onInput:s[0]||(s[0]=o=>i.onStandbyChanged(t.entity,o))},null,44,Ze)])):u("",!0),e.isShowInfosBreakdown&&t.isDescription?(a(),r("div",$e,[t.readOnly?(a(),r("div",{key:0,class:"tooltip-text",innerHTML:i.renderMarkdown(t.entity.description)},null,8,es)):(a(),r("textarea",{key:1,class:"tooltip-editor",ref:"text",value:t.entity.description,onInput:s[1]||(s[1]=o=>i.onDescriptionChanged(t.entity,o))},"      ",40,ss))])):u("",!0),e.isFrames&&e.isShowInfosBreakdown&&t.metadataDisplayHeaders.frames?(a(),r("div",ts,[e.isCurrentUserManager?(a(),r("input",{key:0,class:"input-editor",step:"1",value:t.entity.nb_frames,type:"number",min:"0",onInput:s[2]||(s[2]=o=>i.onNbFramesChanged(t.entity,o))},null,40,is)):(a(),r("span",ns,f(t.entity.nb_frames),1))])):u("",!0),e.isFrameIn&&e.isShowInfosBreakdown&&t.metadataDisplayHeaders.frameIn?(a(),r("div",as,[e.isCurrentUserManager?(a(),r("input",{key:0,class:"input-editor",step:"1",type:"number",min:"0",value:e.getMetadataFieldValue({field_name:"frame_in"},t.entity),onInput:s[3]||(s[3]=o=>e.onMetadataFieldChanged(t.entity,{field_name:"frame_in",data_type:"number"},o))},null,40,os)):(a(),r("span",rs,f(e.getMetadataFieldValue({field_name:"frame_in"},t.entity)),1))])):u("",!0),e.isFrameOut&&e.isShowInfosBreakdown&&t.metadataDisplayHeaders.frameOut?(a(),r("div",ls,[e.isCurrentUserManager?(a(),r("input",{key:0,class:"input-editor",step:"1",type:"number",min:"0",value:e.getMetadataFieldValue({field_name:"frame_out"},t.entity),onInput:s[4]||(s[4]=o=>e.onMetadataFieldChanged(t.entity,{field_name:"frame_out",data_type:"number"},o))},null,40,ds)):(a(),r("span",cs,f(e.getMetadataFieldValue({field_name:"frame_out"},t.entity)),1))])):u("",!0),e.isShowInfosBreakdown?(a(!0),r(b,{key:5},k(e.visibleMetadataDescriptors,o=>(a(),r("div",{class:"metadata-descriptor flexrow-item",title:t.entity.data?t.entity.data[o.field_name]:"",key:"desc"+t.entity.id+"-"+o.id,style:C({"min-width":t.columnWidth[o.id]?t.columnWidth[o.id]+"px":"110px","max-width":t.columnWidth[o.id]?t.columnWidth[o.id]+"px":"110px"})},[o.choices.length===0&&(e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments))?(a(),r("input",{key:0,class:"input-editor",onInput:m=>e.onMetadataFieldChanged(t.entity,o,m),value:e.getMetadataFieldValue(o,t.entity)},null,40,ms)):o.choices.length>0&&e.getDescriptorChecklistValues(o).length>0?(a(),r("div",us,[(a(!0),r(b,null,k(e.getDescriptorChecklistValues(o),(m,w)=>(a(),r("p",{key:`${t.entity.id}-${o.id}-${w}-${m.text}-div`},[c("input",{type:"checkbox",onChange:M=>e.onMetadataChecklistChanged(t.entity,o,m.text,M),id:`${t.entity.id}-${o.id}-${w}-${m.text}-input`,checked:e.getMetadataChecklistValues(o,t.entity)[m.text],disabled:!(e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)),style:C([e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)?{cursor:"pointer"}:{cursor:"auto"}])},null,44,fs),c("label",{class:"ml05",for:`${t.entity.id}-${o.id}-${w}-${m.text}-input`,style:C([e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)?{cursor:"pointer"}:{cursor:"auto"}])},f(m.text),13,ps)]))),128))])):e.isCurrentUserManager||e.isSupervisorInDepartments(o.departments)?(a(),r("span",ys,[c("select",{class:"select-input",onChange:m=>e.onMetadataFieldChanged(t.entity,o,m)},[(a(!0),r(b,null,k(e.getDescriptorChoicesOptions(o),(m,w)=>(a(),r("option",{key:`desc-value-${t.entity.id}-${o.id}-${w}-${m.label}-${m.value}`,value:m.value,selected:e.getMetadataFieldValue(o,t.entity)===m.value},f(m.label),9,vs))),128))],40,gs)])):(a(),r("span",bs,f(e.getMetadataFieldValue(o,t.entity)),1))],12,hs))),128)):u("",!0),(a(!0),r(b,null,k(t.assetTypes,o=>(a(),r("div",{class:"asset-list flexrow-item",key:t.entity.id+"-"+o},[i.assetsByAssetTypesMap[o]!==void 0?(a(),r("div",ks,[c("div",ws,f(i.nbAssetsForType(o))+" "+f(e.$tc("assets.number",i.nbAssetsForType(o))),1),c("div",Cs,[(a(!0),r(b,null,k(i.assetsByAssetTypesMap[o],m=>(a(),v(g,{class:"flexrow-item",key:m.id,asset:m,active:t.selected,"nb-occurences":m.nb_occurences,"read-only":t.readOnly,"text-mode":t.textMode,"big-mode":t.bigMode,onEditLabel:i.onEditLabelClicked,onRemoveOne:i.removeOneAsset,onAddOne:i.addOneAsset},null,8,["asset","active","nb-occurences","read-only","text-mode","big-mode","onEditLabel","onRemoveOne","onAddOne"]))),128))]),s[6]||(s[6]=c("div",{class:"actions filler"},null,-1))])):(a(),r("div",_s,f(e.$t("breakdown.empty")),1))]))),128))],10,Qe)}const Es=I(je,[["render",Ss],["__scopeId","data-v-c63a5849"]]),Is={name:"show-infos-button",components:{KitsuIcon:Z},computed:{...D(["isShowInfosBreakdown"]),buttonIsOn(){return this.isShowInfosBreakdown}},methods:{...q(["hideInfosBreakdown","showInfosBreakdown"]),toggleInfos(){this.isShowInfosBreakdown?this.hideInfosBreakdown():this.showInfosBreakdown()}},mounted(){localStorage.getItem("show-infos-breakdown")==="false"?this.hideInfosBreakdown():this.showInfosBreakdown()},watch:{isShowInfosBreakdown(){const e=this.isShowInfosBreakdown.toString();localStorage.setItem("show-infos-breakdown",e)}}},Ts=["title"];function Ms(e,s,t,l,n,i){const h=p("kitsu-icon");return a(),r("button",{class:_({"level-item":!0,button:!0,"is-toggle":!0,"is-on":i.buttonIsOn}),title:e.$t(i.buttonIsOn?"tasks.hide_infos":"tasks.show_infos"),onClick:s[0]||(s[0]=(...g)=>i.toggleInfos&&i.toggleInfos(...g))},[y(h,{class:"icon is-small",name:"infos",title:e.$t(i.buttonIsOn?"tasks.hide_infos":"tasks.show_infos")},null,8,["title"])],10,Ts)}const As=I(Is,[["render",Ms],["__scopeId","data-v-fcd40d6e"]]),Os={name:"breakdown",mixins:[R,te],components:{AvailableAssetBlock:Te,BuildFilterModal:ne,ButtonHrefLink:ae,ButtonSimple:ee,ComboboxStyled:oe,DeleteModal:re,DepartmentName:le,EditAssetModal:de,EditLabelModal:Le,ImportModal:ue,ImportRenderModal:me,SearchField:fe,SearchQueryList:pe,ShotLine:Es,ShowInfosButton:As,Spinner:$,TableMetadataSelectorMenu:ve},data(){return{assetTypeId:"",castingType:"shot",columnSelectorDisplayed:!1,editedAsset:null,editedEntityId:null,editedAssetLinkLabel:null,episodeId:"",importCsvFormData:{},isBigMode:!1,isLocked:!1,isLoading:!1,isOnlyCurrentEpisode:!1,isTextMode:!1,libraryDisplayed:!1,optionalCsvColumns:["Label"],parsedCSV:[],removalData:{},saveErrors:{},selection:{},sequenceId:"all",errors:{edit:!1,editLabel:!1,importing:!1,importingError:null,remove:!1},loading:{edit:!1,editLabel:!1,importing:!1,remove:!1,stay:!1},metadataDisplayHeaders:{stdby:!0,fps:!1,frameIn:!0,frameOut:!0,frames:!0,estimation:!1,maxRetakes:!1,resolution:!1,timeSpent:!1},modals:{isBuildFilterDisplayed:!1,isEditLabelDisplayed:!1,isNewDisplayed:!1,isImportRenderDisplayed:!1,isRemoveConfirmationDisplayed:!1,importing:!1},success:{edit:!1},columnWidth:{}}},mounted(){this.isLoading||this.reset(),this.resetSequenceOption(),this.setLastProductionScreen("breakdown"),this.isTextMode=T.getBoolPreference("breakdown:text-mode"),window.addEventListener("keydown",this.onKeyDown,!1),this.resetDisplayHeaders(),this.resetColumnWidth(),this.setSearchFromUrl()},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},computed:{...D(["assetMap","assetMetadataDescriptors","assetTypeMap","assetsByType","breakdownSearchQueries","breakdownSearchFilterGroups","casting","castingAssetTypeAssets","castingAssetTypesOptions","castingByType","castingCurrentShot","castingEpisodes","castingSequenceShots","castingSequencesOptions","currentEpisode","currentProduction","departmentMap","displayedSequences","displayedShots","episodeMap","episodes","isAssetsLoading","isCurrentUserManager","isFrameIn","isFrameOut","isFrames","isShotsLoading","isShowInfosBreakdown","isTVShow","sequenceMap","shotMap","shotMetadataDescriptors"]),searchField(){return this.$refs["search-field"]},castingTypeOptions(){const e=this.currentProduction.production_type==="assets",s=this.currentProduction.production_type==="shots",t=[];return s||t.push({label:this.$t("assets.title"),value:"asset"}),!e&&(!this.isTVShow||this.currentEpisode&&this.currentEpisode.id!=="main")&&t.unshift({label:this.$t("shots.title"),value:"shot"}),t},availableAssetsByType(){const e=[];return this.assetsByType.forEach(s=>{let t=s.filter(l=>!l.canceled&&(!l.shared||this.libraryDisplayed));this.isTVShow&&this.isOnlyCurrentEpisode&&(t=s.filter(l=>l.episode_id===this.currentEpisode.id||l.casting_episode_ids?.includes(this.currentEpisode.id))),t.length>0&&e.push(t)}),e},exportUrlPath(){let e=`/api/export/csv/projects/${this.currentProduction.id}/casting.csv`,s=!1;return this.currentEpisode&&(e+=`?episode_id=${this.currentEpisode.id}`,s=!0),this.isShotCasting&&(e+=`${s?"&":"?"}is_shot_casting=${this.isShotCasting}`),e},isEpisodeCasting(){return this.currentEpisode&&this.currentEpisode.id==="all"},isAssetCasting(){return!this.isEpisodeCasting&&this.castingType==="asset"},isShotCasting(){return!this.isEpisodeCasting&&this.castingType==="shot"},castingEntities(){return this.isEpisodeCasting?this.castingEpisodes:this.isShotCasting?this.castingSequenceShots:this.isTVShow&&this.currentEpisode&&this.currentEpisode.id!=="main"?this.castingAssetTypeAssets.filter(e=>e.episode_id===this.currentEpisode.id||e.casting_episode_ids?.includes(this.currentEpisode.id)):this.isTVShow&&this.currentEpisode.id==="main"?this.castingAssetTypeAssets.filter(e=>!e.episode_id):this.castingAssetTypeAssets},castingAssetTypes(){const e=[],s={};return this.castingEntities.forEach(t=>{this.castingByType[t.id]&&this.castingByType[t.id].forEach(l=>{l[0]&&!s[l[0].asset_type_name]&&(s[l[0].asset_type_name]=!0,e.push(l[0].asset_type_name))})}),e.sort()},filteredCasting(){const e={};return this.castingEntities.forEach(s=>{this.castingByType[s.id]&&this.castingByType[s.id].forEach(t=>{t.forEach(l=>{const n=`${l.asset_name}${l.asset_type_name}${l.name}`;e[n]=!0})})}),e},isDescription(){return this.castingEntities.some(e=>e.description&&e.description.length>0)},csvColumns(){return this.isTVShow&&this.currentEpisode?.id!=="all"?["Episode","Parent","Name","Asset Type","Asset","Occurences"]:["Parent","Name","Asset Type","Asset","Occurences"]},renderColumns(){return[...this.csvColumns,...this.optionalCsvColumns]},dataMatchers(){return this.isTVShow?["Episode","Name","Asset Type","Asset"]:["Name","Asset Type","Asset"]},metadataDescriptors(){return this.isEpisodeCasting?[]:this.isShotCasting?this.shotMetadataDescriptors:this.assetMetadataDescriptors},nameHeaderMinWidth(){return this.columnWidth.name?parseInt(this.columnWidth.name,10)+1+"px":"251px"}},methods:{...q(["addAssetToCasting","editEpisode","editShot","editAsset","displayMoreAssets","loadEpisodeCasting","loadEpisodes","loadAssetCasting","loadAssets","loadShotCasting","loadShots","newAsset","removeAssetFromCasting","removeBreakdownSearch","saveBreakdownSearch","loadSequences","saveBreakdownSearchFilterGroup","saveCasting","setAssetLinkLabel","setAssetSearch","setCastingEpisodes","setCastingAssetType","setCastingAssetTypes","setCastingEpisode","setCastingForProductionEpisodes","setCastingSequence","setCurrentEpisode","setEntityCasting","setLastProductionScreen","uploadCastingFile"]),reset(){if(!this.isTVShow){const e={...this.$route};e&&e.params&&e.params.episode_id&&(e.name="breakdown",e.params.episode_id=null,this.$router.push(e))}this.isLoading=!0,setTimeout(()=>{this.reloadEntities()},100)},async reloadEntities(){this.isLoading=!0,(!this.isTVShow||this.currentEpisode?.id!=="main")&&(await this.loadSequences(),await this.loadShots()),this.isTVShow?(this.currentEpisode&&(this.episodeId=this.currentEpisode.id),this.setCastingEpisode(this.episodeId),this.setCastingForProductionEpisodes()):this.setCastingEpisode(null),this.loadAssets({all:!0,withTasks:!0}).then(()=>{this.isLoading=!1,this.displayMoreAssets(),this.setCastingAssetTypes(),this.assetTypeId?this.setCastingAssetType(this.assetTypeId):(!this.isTVShow||this.episodeId&&!["main","all"].includes(this.episodeId))&&this.setCastingSequence(this.sequenceId||"all"),this.resetSequenceOption(),this.resetSelection(),(this.currentEpisode&&this.currentEpisode.id==="main"||this.currentProduction.production_type==="assets")&&(this.castingType="asset")})},resetSequenceOption(){this.currentProduction.production_style==="nft"&&this.castingSequencesOptions[1]&&(this.sequenceId=this.castingSequencesOptions[1].value)},resetSelection(){const e={};this.isEpisodeCasting?this.castingEpisodes.forEach(s=>{e[s.id]=!1}):this.isShotCasting?this.castingSequenceShots.forEach(s=>{e[s.id]=!1}):this.castingAssetTypeAssets.forEach(s=>{e[s.id]=!1}),this.selection=e},confirmBuildFilter(e){this.modals.isBuildFilterDisplayed=!1,this.searchField.setValue(e),this.onSearchChange(e)},onSearchChange(e){this.setAssetSearch(e),this.setSearchInUrl(e),this.displayMoreAssets(),this.displayMoreAssets()},selectEntity(e,s){const t={...this.selection};!(s.ctrlKey||s.metaKey)&&!s.shitKey&&this.clearSelection(),this.previousEntityId&&s.shiftKey&&this.selectRange(this.previousEntityId,e),(!this.previousEntityId||!s.shiftKey)&&(this.previousEntityId=e);const l=Object.keys(t).filter(n=>t[n]).length;!t[e]||l>1&&!(s.ctrlKey||s.metaKey)?this.selection[e]=!0:t[e]&&(s.ctrlKey||s.metaKey)&&(this.selection[e]=!1)},clearSelection(){Object.keys(this.selection).filter(e=>this.selection[e]).forEach(e=>{this.selection[e]=!1})},selectRange(e,s){const t=Object.keys(this.selection),l=t.findIndex(h=>h===e),n=t.findIndex(h=>h===s);(l<n?L(l,n):L(n,l)).forEach(h=>{h>=0&&(this.selection[t[h]]=!0)})},setLock(){this.$options.lockTimeout||(this.$options.lockTimeout=setTimeout(()=>{this.isLocked=!1},3e3))},async addOneAsset(e,s=1){this.isLocked=!0;const t=Object.keys(this.selection).filter(l=>this.selection[l]);for(const l of t){this.addAssetToCasting({entityId:l,assetId:e,nbOccurences:s,label:this.castingType==="shot"?"animate":"fixed"}),delete this.saveErrors[l];try{await this.saveCasting(l),this.setLock()}catch(n){this.saveErrors[l]=!0,console.error(n)}}},async addTenAssets(e){this.addOneAsset(e,10)},confirmAssetRemoval(){this.saveAssetRemoval(this.removalData.entityId,this.removalData.assetId,this.removalData.nbOccurences)},saveAssetRemoval(e,s,t){return this.loading.remove=!0,this.removeAssetFromCasting({entityId:e,assetId:s,nbOccurences:t}),delete this.saveErrors[e],this.saveCasting(e).then(()=>{this.setLock(),this.modals.isRemoveConfirmationDisplayed=!1}).catch(l=>{this.saveErrors[e]=!0,this.errors.remove=!0,console.error(l)}).finally(()=>{this.loading.remove=!1})},async removeOneAssetFromSelection(e){const s=Object.keys(this.selection).filter(t=>this.selection[t]);for(const t of s){const l=this.casting[t].find(n=>n.asset_id===e);l&&await this.removeOneAsset(e,t,l.nb_occurences)}},removeOneAsset(e,s,t){return this.isLocked=!0,this.isEpisodeCasting&&t===1?(this.removalData={assetId:e,entityId:s,nbOccurences:t},this.modals.isRemoveConfirmationDisplayed=!0,Promise.resolve()):this.saveAssetRemoval(s,e,1)},onAssetListScroll(e){const s=this.$refs["asset-list"],t=s.scrollHeight-s.offsetHeight,l=e.target;t<l.scrollTop+100&&this.displayMoreAssets()},showImportModal(){this.modals.importing=!0},hideImportModal(){this.modals.importing=!1},showImportRenderModal(){this.modals.isImportRenderDisplayed=!0},hideImportRenderModal(){this.modals.isImportRenderDisplayed=!1},renderImport(e,s){this.loading.importing=!0,this.errors.importing=!1,s==="file"&&(e=e.get("file")),A.processCSV(e).then(t=>{this.parsedCSV=t,this.hideImportModal(),this.loading.importing=!1,this.showImportRenderModal()})},uploadImportFile(e){const s=new FormData,t="import.csv",l=A.turnEntriesToCsvString(e),n=new File([l],t,{type:"text/csv"});s.append("file",n),this.loading.importing=!0,this.errors.importing=!1,this.errors.importingError=null,this.importCsvFormData=s,this.uploadCastingFile(this.importCsvFormData).then(()=>{this.hideImportRenderModal(),this.sequenceId&&this.setCastingSequence(this.sequenceId||"all")}).catch(i=>{this.errors.importingError=i,this.errors.importing=!0}).finally(()=>{this.loading.importing=!1})},resetImport(){this.errors.importing=!1,this.errors.importingError=null,this.hideImportRenderModal(),this.importCsvFormData=void 0,this.$refs["import-modal"].reset(),this.showImportModal()},updateUrl(){let e=!1,s={};if(this.isEpisodeCasting?this.$route.params.episode_id!==this.episodeId&&(e=!0,s={name:"breakdown-episode",params:{production_id:this.currentProduction.id,episode_id:this.episodeId}}):this.isAssetCasting?(this.$route.params.asset_type_id||"")!==this.assetTypeId&&(e=!0,s={name:"breakdown-asset-type",params:{production_id:this.currentProduction.id,asset_type_id:this.assetTypeId}}):(this.$route.params.sequence_id||"all")!==this.sequenceId&&(e=!0,s={name:"breakdown-sequence",params:{production_id:this.currentProduction.id,sequence_id:this.sequenceId||"all"}}),e){let t=this.$route.params.episode_id;!t&&this.currentEpisode&&(t=this.currentEpisode.id),t&&(s.name=`episode-${s.name}`,s.params.episode_id=t,t==="all"&&(s.params.sequence_id="all")),this.$router.push(s)}},onEditLabelClicked(e,s,t){this.editedAsset=e,this.editedEntityId=t,this.editedAssetLinkLabel=s,this.modals.isEditLabelDisplayed=!0},confirmEditLabel(e={}){const s=e.label;this.loading.editLabel=!0,this.setAssetLinkLabel({label:s,asset:this.editedAsset,targetEntityId:this.editedEntityId}).then(()=>{this.modals.isEditLabelDisplayed=!1,this.loading.editLabel=!1}).catch(t=>{console.error(t),this.errors.editLabel=!0,this.loading.editLabel=!1})},toggleTextMode(){this.isTextMode=!this.isTextMode,localStorage.setItem("breakdown:text-mode",this.isTextMode)},toggleColumnSelector(){this.columnSelectorDisplayed=!this.columnSelectorDisplayed},confirmNewAssetStay(e){this.loading.stay=!0,this.success.edit=!1,this.newAsset(e).then(s=>{this.loading.stay=!1,this.loading.edit=!1,this.resetLightEditModal(s),this.$refs["edit-asset-modal"].focusName(),this.success.edit=!0}).catch(s=>{console.error(s),this.loading.stay=!1,this.loading.edit=!1,this.success.edit=!1,this.errors.edit=!0})},confirmNewAsset(e){this.loading.edit=!0,this.errors.edit=!1,this.newAsset(e).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1}).catch(s=>{console.error(s),this.loading.edit=!1,this.errors.edit=!0})},resetLightEditModal(e){const s={name:"",entity_type_id:e.entit_type_id,production_id:this.currentProduction.id};this.assetToEdit=s},onKeyDown(e){["INPUT","TEXTAREA"].includes(e.target.tagName)||((e.ctrlKey||e.metaKey)&&e.keyCode===67?this.copyCasting():(e.ctrlKey||e.metaKey)&&e.keyCode===86&&this.pasteCasting())},copyCasting(){const e=Object.keys(this.selection).find(t=>this.selection[t]),s=this.casting[e];F.copyCasting(s)},async pasteCasting(){const e=F.pasteCasting();if(!e||e.length===0)return;const s=Object.keys(this.selection).filter(t=>this.selection[t]);for(const t of s)this.setEntityCasting({entityId:t,casting:e}),delete this.saveErrors[t],await this.saveCasting(t).then(this.setLock).catch(l=>{this.saveErrors[t]=!0,console.error(l)});return e},async editEntity(e){this.isEpisodeCasting?await this.editEpisode(e):this.isShotCasting?await this.editShot(e):await this.editAsset(e)},async onFieldChanged({entry:e,fieldName:s,value:t}){const l={id:e.id,[s]:t};await this.editEntity(l)},async onMetadataChanged({entry:e,descriptor:s,value:t}){const l={id:e.id,data:{[s.field_name]:t}};await this.editEntity(l)},descriptorCurrentDepartments(e){return(e.departments||[]).map(t=>this.departmentMap.get(t))},getEntityName(e){return this.sequenceId==="all"&&(!this.isTVShow||this.isTVShow&&this.currentEpisode.id!=="all")?e.sequence_name+" / "+e.name:e.name},getCsvFileName(){const e=[se().format("YYYY-MM-DD"),"kitsu",this.castingType+"s",this.currentProduction.name,this.$t("breakdown.title")];return this.isTVShow?this.currentEpisode&&(this.currentEpisode.id==="all"?e.splice(4,0,"all"):this.currentEpisode.id==="main"?(e.splice(4,0,"main pack"),this.assetTypeId!=="all"&&this.castingType==="asset"&&e.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name)):(e.splice(4,0,this.currentEpisode.name),this.sequenceId!=="all"&&this.castingType==="shot"&&e.splice(5,0,this.sequenceMap.get(this.sequenceId).name),this.assetTypeId!=="all"&&this.castingType==="asset"&&e.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name))):(this.sequenceId!=="all"&&this.castingType==="shot"&&e.splice(5,0,this.sequenceMap.get(this.sequenceId).name),this.assetTypeId!=="all"&&this.castingType==="asset"&&e.splice(5,0,this.assetTypeMap.get(this.assetTypeId).name)),x.slugify(e.join("_"))},getCsvFileHeaders(){const e=[this.$t("shots.fields.name"),this.$t("breakdown.fields.standby")];return this.isFrames&&e.push(this.$t("main.frames")),this.isFrameIn&&e.push(this.$t("main.frame_in")),this.isFrameOut&&e.push(this.$t("main.frame_out")),this.metadataDescriptors.forEach(s=>{e.push(s.name)}),e.concat(this.castingAssetTypes)},getCsvEntries(){return this.castingEntities.map(s=>{const t=[s.name,s.is_casting_standby?"X":""];this.isFrames&&t.push(s.nb_frames),this.isFrameIn&&t.push(s.data.frame_in),this.isFrameOut&&t.push(s.data.frame_out),this.metadataDescriptors.forEach(i=>{t.push(s.data[i.field_name]||"")});const l=this.castingByType[s.id]||[],n={};return l.forEach(i=>{n[i[0].asset_type_name]=i}),this.castingAssetTypes.forEach(i=>{const h=n[i]||[],g=h.reduce((o,m)=>o+m.nb_occurences,0);if(g>0){let o=g+" assets: ";o+=h.map(m=>m.asset_name+" ("+m.nb_occurences+")").join(", "),t.push(o)}else t.push("")}),t})},exportViewToCsv(){const e=this.getCsvEntries(),s=this.getCsvFileName(),t=this.getCsvFileHeaders();A.buildCsvFile(s,[t].concat(e))},removeSearchQuery(e){this.removeBreakdownSearch(e).catch(console.error)},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveBreakdownSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},initResize(e,s,t){this.resizedKnobRefName=e+(t||""),this.resizedRefName=s+(t||""),this.resizedDescriptorId=t,window.addEventListener("mousemove",this.startResizing),window.addEventListener("mouseup",this.stopResizing)},startResizing(e){const s=this.resizedKnobRefName,t=this.resizedRefName,l=this.$refs[s][0]?this.$refs[s][0]:this.$refs[s],n=this.$refs[t][0]?this.$refs[t][0]:this.$refs[t],i=e.clientX-l.getBoundingClientRect().left,h=n.getBoundingClientRect().width;if(this.columnWidth={...this.columnWidth},this.resizedDescriptorId){const g=Math.max(h+i,110);this.columnWidth[this.resizedDescriptorId]=g;const o=`breakdown:column-width-descriptor-${this.resizedDescriptorId}`;T.setPreference(o,g)}else{const g=Math.max(h+i,160);this.columnWidth.name=g;const o=`breakdown:column-width-name-${this.castingType}-${this.currentProduction.id}`;T.setPreference(o,g)}},stopResizing(){window.removeEventListener("mousemove",this.startResizing),window.removeEventListener("mouseup",this.stopResizing),this.resizedKnobRefName=null,this.resizedRefName=null,this.resizedDescriptorId=null},resetDisplayHeaders(){this.isEpisodeCasting?this.metadataDisplayHeaders={}:this.isShotCasting?this.metadataDisplayHeaders={stdby:!0,fps:!1,frameIn:!0,frameOut:!0,frames:!0,estimation:!1,maxRetakes:!1,resolution:!1,timeSpent:!1}:this.metadataDisplayHeaders={estimation:!1,readyFor:!1,timeSpent:!1}},resetColumnWidth(){const e=`breakdown:column-width-name-${this.castingType}-${this.currentProduction.id}`,s=T.getPreference(e);s&&(this.columnWidth.name=s),this.metadataDescriptors.forEach(t=>{const l=T.getPreference(`breakdown:column-width-descriptor-${t.id}`);l&&(this.columnWidth[t.id]=l)})},onCastingHeaderScroll(e){const s=e.target;this.$refs["casting-list"].scrollLeft=s.scrollLeft},onCastingScroll(e){const s=e.target;this.$refs["casting-header"].scrollLeft=s.scrollLeft}},watch:{castingType(){if(this.isShotCasting&&this.displayedSequences.length>0&&(this.sequenceId=this.displayedSequences[0].id,this.assetTypeId=""),this.isAssetCasting&&this.castingAssetTypesOptions.length>0){const e=this.$route.params.asset_type_id;this.sequenceId="all",this.castingType="asset",e?this.assetTypeId=e:this.castingAssetTypesOptions.length>0&&(this.assetTypeId=this.castingAssetTypesOptions[0].value)}this.resetDisplayHeaders(),this.resetColumnWidth()},sequenceId(){this.sequenceId&&this.displayedSequences&&this.displayedSequences.length>0&&!this.isAssetCasting&&(this.setCastingSequence(this.sequenceId),this.updateUrl(),this.resetSelection())},assetTypeId(){this.assetTypeId&&this.castingAssetTypesOptions.length>0&&(this.setCastingAssetType(this.assetTypeId),this.updateUrl(),this.resetSelection())},episodeId(){this.episodeId&&this.episodes&&this.episodes.length>0&&(this.episodeId==="all"&&this.setCastingForProductionEpisodes(),this.resetSelection())},castingSequencesOptions(){if(this.$route.path.indexOf("asset-type")<0){const e=this.$route.params.sequence_id||"all";this.sequenceMap.get(e)?this.sequenceId=e:this.castingSequencesOptions.length>0?this.sequenceId=this.castingSequencesOptions[0].value:this.sequenceId="all"}},castingAssetTypesOptions(){if(this.$route.path.indexOf("asset-type")>0){const e=this.$route.params.asset_type_id;this.castingType="asset",e?this.assetTypeId=e:this.castingAssetTypesOptions.length>0?this.assetTypeId=this.castingAssetTypesOptions[0].value:this.assetTypeId=""}},currentProduction(){this.isLoading||(this.reset(),this.resetColumnWidth())},currentEpisode(){this.currentEpisode&&this.episodeId!==this.currentEpisode.id&&!this.isLoading&&(this.currentEpisode.id==="all"?this.episodeId="all":this.reset())},displayedSequences(){this.$store.commit("CASTING_SET_SEQUENCES",this.displayedSequences)},"$route.query.search"(e){this.searchField?.setValue(e),this.onSearchChange(e)}},socket:{events:{"episode:casting-update"(e){const s=this.episodeMap.get(e.episode_id);s&&!this.isLocked&&this.loadEpisodeCasting(s)},"shot:casting-update"(e){const s=this.shotMap.get(e.shot_id);s&&s.sequence_id===this.sequenceId&&!this.isLocked&&this.loadShotCasting(s)},"asset:casting-update"(e){const s=this.assetMap.get(e.asset_id);s&&s.asset_type_id===this.assetTypeId&&!this.isLocked&&this.loadAssetCasting(s)}}},head(){return this.isTVShow?{title:`${this.currentProduction?.name||""} - ${this.currentEpisode?.name||""} | ${this.$t("breakdown.title")} - Kitsu`}:{title:`${this.currentProduction.name} | ${this.$t("breakdown.title")} - Kitsu`}}},Ds={class:"breakdown page"},Bs={class:"breakdown-columns"},Ls={class:"breakdown-column casting-column"},Fs={class:"flexrow mb1"},qs={key:0},xs={class:"subtitle mt05"},Rs={class:"flexrow mb05 list-options"},Vs={key:0,class:"standby-header"},Ns={key:1,class:"description-header"},Ps={key:2,class:"frames-header"},Us={key:3,class:"frames-header"},Ws={key:4,class:"frames-header"},Hs={key:0,class:"descriptor-departments mr05"},zs=["title"],Ks=["onMousedown"],js=["title"],Qs={class:"shot-lines"},Gs={class:"subtitle"},Ys={class:"flexrow mt1 mb1"},Xs={class:"filters-area flexrow"},Js={class:"query-list"},Zs={class:"asset-type"},$s={class:"asset-list"};function et(e,s,t,l,n,i){const h=p("combobox-styled"),g=p("show-infos-button"),o=p("button-simple"),m=p("button-href-link"),w=p("spinner"),M=p("table-metadata-selector-menu"),V=p("department-name"),N=p("shot-line"),P=p("search-field"),U=p("search-query-list"),W=p("available-asset-block"),H=p("import-render-modal"),z=p("import-modal"),K=p("edit-label-modal"),j=p("build-filter-modal"),Q=p("edit-asset-modal"),G=p("delete-modal");return a(),r("div",Ds,[c("div",Bs,[c("div",Ls,[c("div",Fs,[i.isEpisodeCasting?(a(),r("div",qs,[c("h2",xs,f(e.$t("breakdown.episode_casting")),1)])):u("",!0),i.isEpisodeCasting?u("",!0):(a(),v(h,{key:1,class:"mr1",label:e.$t("main.for"),options:i.castingTypeOptions,modelValue:n.castingType,"onUpdate:modelValue":s[0]||(s[0]=d=>n.castingType=d)},null,8,["label","options","modelValue"])),i.isShotCasting?(a(),v(h,{key:2,label:e.$t("shots.fields.sequence"),options:e.castingSequencesOptions,modelValue:n.sequenceId,"onUpdate:modelValue":s[1]||(s[1]=d=>n.sequenceId=d)},null,8,["label","options","modelValue"])):u("",!0),i.isAssetCasting?(a(),v(h,{key:3,label:e.$t("tasks.fields.asset_type"),options:e.castingAssetTypesOptions,modelValue:n.assetTypeId,"onUpdate:modelValue":s[2]||(s[2]=d=>n.assetTypeId=d)},null,8,["label","options","modelValue"])):u("",!0),s[17]||(s[17]=c("span",{class:"filler"},null,-1)),y(g,{class:"flexrow-item"}),y(o,{class:"flexrow-item",title:n.isTextMode?e.$t("breakdown.picture_mode"):e.$t("breakdown.text_mode"),icon:"type","is-on":n.isTextMode,"is-responsive":!0,onClick:i.toggleTextMode},null,8,["title","is-on","onClick"]),y(o,{class:"flexrow-item",icon:"big-thumbnail","is-on":n.isBigMode,title:e.$t("tasks.big_thumbnails"),onClick:s[3]||(s[3]=d=>n.isBigMode=!n.isBigMode)},null,8,["is-on","title"]),e.isCurrentUserManager?(a(),v(o,{key:4,class:"flexrow-item",title:e.$t("main.csv.import_file"),icon:"import","is-responsive":!0,onClick:i.showImportModal},null,8,["title","onClick"])):u("",!0),y(o,{class:"flexrow-item",icon:"export","is-responsive":!0,title:e.$t("main.csv.export_current_view"),onClick:i.exportViewToCsv},null,8,["title","onClick"]),e.isCurrentUserManager?(a(),v(m,{key:5,class:"flexrow-item",title:e.$t("main.csv.export_file"),icon:"export-lines","is-responsive":!0,path:i.exportUrlPath},null,8,["title","path"])):u("",!0)]),n.isLoading?(a(),v(w,{key:0,class:"mt1"})):u("",!0),c("div",Rs,[e.isShowInfosBreakdown?O((a(),v(M,{key:0,namespace:"breakdown",descriptors:i.metadataDescriptors,exclude:{fps:!0,estimation:!0,resolution:!0,maxRetakes:!0,timeSpent:!0},modelValue:n.metadataDisplayHeaders,"onUpdate:modelValue":s[4]||(s[4]=d=>n.metadataDisplayHeaders=d)},null,8,["descriptors","modelValue"])),[[B,n.columnSelectorDisplayed]]):u("",!0),s[18]||(s[18]=c("span",{class:"filler"},null,-1)),e.isShowInfosBreakdown?(a(),v(o,{key:1,class:"is-small mr05",icon:"down",onClick:i.toggleColumnSelector},null,8,["onClick"])):u("",!0)]),n.isLoading?u("",!0):(a(),r("div",{key:1,ref:"casting-header",class:"casting-header flexrow",onScrollPassive:s[6]||(s[6]=(...d)=>i.onCastingHeaderScroll&&i.onCastingHeaderScroll(...d))},[c("div",{class:"entity-header",ref:"name-header",style:C({"min-width":i.nameHeaderMinWidth})},[c("div",null,f(e.$t("shots.fields.name")),1),s[19]||(s[19]=c("div",{class:"filler"},null,-1)),c("div",{ref:"resizable-knob-name",class:"resizable-knob",onMousedown:s[5]||(s[5]=E(d=>i.initResize("resizable-knob-name","name-header"),["prevent"]))},null,544)],4),e.isShowInfosBreakdown?(a(),r("div",Vs,f(e.$t("breakdown.fields.standby")),1)):u("",!0),e.isShowInfosBreakdown&&i.isDescription?(a(),r("div",Ns,f(e.$t("shots.fields.description")),1)):u("",!0),i.isShotCasting&&e.isFrames&&e.isShowInfosBreakdown&&n.metadataDisplayHeaders.frames?(a(),r("div",Ps,f(e.$t("shots.fields.nb_frames")),1)):u("",!0),i.isShotCasting&&e.isFrameIn&&e.isShowInfosBreakdown&&n.metadataDisplayHeaders.frameIn?(a(),r("div",Us,f(e.$t("shots.fields.frame_in")),1)):u("",!0),i.isShotCasting&&e.isFrameOut&&e.isShowInfosBreakdown&&n.metadataDisplayHeaders.frameOut?(a(),r("div",Ws,f(e.$t("shots.fields.frame_out")),1)):u("",!0),(a(!0),r(b,null,k(e.visibleMetadataDescriptors,d=>O((a(),r("div",{class:"descriptor-header",key:"descriptor-header-"+d.id,ref_for:!0,ref:"descriptor-header-"+d.id,style:C({"min-width":n.columnWidth[d.id]?n.columnWidth[d.id]+"px":"110px"})},[i.descriptorCurrentDepartments(d).length?(a(),r("span",Hs,[(a(!0),r(b,null,k(i.descriptorCurrentDepartments(d),S=>(a(),v(V,{key:S.id,department:S,"no-padding":"","only-dot":""},null,8,["department"]))),128))])):u("",!0),c("span",{class:"ellipsis nowrap descriptor-name filler",title:d.name},f(d.name),9,zs),c("div",{ref_for:!0,ref:"resizable-knob-descriptor-"+d.id,class:"resizable-knob",onMousedown:E(S=>i.initResize("resizable-knob-descriptor-","descriptor-header-",d.id),["prevent"])},null,40,Ks)],4)),[[B,e.isShowInfosBreakdown]])),128)),(a(!0),r(b,null,k(i.castingAssetTypes,d=>(a(),r("div",{key:d,class:"asset-type-header"},[c("span",{class:"ellipsis nowrap",title:d},f(d),9,js)]))),128)),s[20]||(s[20]=c("div",{class:"actions filler"},null,-1))],544)),n.isLoading?u("",!0):(a(),r("div",{key:2,ref:"casting-list",class:"casting-list",onScrollPassive:s[7]||(s[7]=(...d)=>i.onCastingScroll&&i.onCastingScroll(...d))},[c("div",Qs,[(a(!0),r(b,null,k(i.castingEntities,d=>(a(),v(N,{key:d.id,entity:d,"preview-file-id":d.preview_file_id,selected:n.selection[d.id],name:i.getEntityName(d),assets:e.castingByType[d.id]||[],"asset-types":i.castingAssetTypes,"read-only":!e.isCurrentUserManager,"text-mode":n.isTextMode,"metadata-descriptors":i.metadataDescriptors,"metadata-display-headers":n.metadataDisplayHeaders,"big-mode":n.isBigMode,"is-description":i.isDescription,"is-save-error":n.saveErrors[d.id],"column-width":n.columnWidth,onAddOne:i.addOneAsset,onClick:i.selectEntity,onEditLabel:i.onEditLabelClicked,onFieldChanged:i.onFieldChanged,onMetadataChanged:i.onMetadataChanged,onRemoveOne:i.removeOneAssetFromSelection},null,8,["entity","preview-file-id","selected","name","assets","asset-types","read-only","text-mode","metadata-descriptors","metadata-display-headers","big-mode","is-description","is-save-error","column-width","onAddOne","onClick","onEditLabel","onFieldChanged","onMetadataChanged","onRemoveOne"]))),128))])],544))]),e.isCurrentUserManager?(a(),r("div",{key:0,ref:"asset-list",onScrollPassive:s[12]||(s[12]=(...d)=>i.onAssetListScroll&&i.onAssetListScroll(...d)),class:"breakdown-column assets-column"},[c("h2",Gs,f(e.$t("breakdown.all_assets")),1),c("div",Ys,[n.isOnlyCurrentEpisode?u("",!0):(a(),v(o,{key:0,class:"flexrow-item",title:e.$t("assets.new_asset"),icon:"plus",onClick:s[8]||(s[8]=d=>n.modals.isNewDisplayed=!0)},null,8,["title"])),s[21]||(s[21]=c("span",{class:"filler"},null,-1)),n.isOnlyCurrentEpisode?u("",!0):(a(),v(o,{key:1,class:"flexrow-item",text:e.$t("breakdown.show_library"),icon:"assets","is-on":n.libraryDisplayed,onClick:s[9]||(s[9]=d=>n.libraryDisplayed=!n.libraryDisplayed)},null,8,["text","is-on"])),e.isTVShow&&!i.isEpisodeCasting?(a(),v(o,{key:2,class:"flexrow-item",text:e.$t("assets.only_current_episode"),"is-on":n.isOnlyCurrentEpisode,onClick:s[10]||(s[10]=d=>n.isOnlyCurrentEpisode=!n.isOnlyCurrentEpisode)},null,8,["text","is-on"])):u("",!0)]),c("div",Xs,[y(P,{class:"flexrow-item",ref:"search-field","can-save":!0,onSave:i.saveSearchQuery,onChange:i.onSearchChange},null,8,["onSave","onChange"]),y(o,{class:"flexrow-item",title:e.$t("entities.build_filter.title"),icon:"filter",onClick:s[11]||(s[11]=d=>n.modals.isBuildFilterDisplayed=!0)},null,8,["title"])]),c("div",Js,[y(U,{groups:e.breakdownSearchFilterGroups,"is-group-enabled":!0,queries:e.breakdownSearchQueries,type:"breakdown",onRemoveSearch:i.removeSearchQuery},null,8,["groups","queries","onRemoveSearch"])]),e.isAssetsLoading?(a(),v(w,{key:0})):(a(!0),r(b,{key:1},k(i.availableAssetsByType,d=>(a(),r("div",{class:"type-assets",key:d.length>0?d[0].asset_type_name:""},[c("div",Zs,f(d.length>0?d[0].asset_type_name:""),1),c("div",$s,[(a(!0),r(b,null,k(d,S=>(a(),v(W,{key:S.id,asset:S,active:Object.keys(n.selection).length>0,"text-mode":n.isTextMode,"big-mode":n.isBigMode,onAddOne:i.addOneAsset,onAddTen:i.addTenAssets},null,8,["asset","active","text-mode","big-mode","onAddOne","onAddTen"]))),128))])]))),128))],544)):u("",!0)]),y(H,{active:n.modals.isImportRenderDisplayed,"is-loading":n.loading.importing,"is-error":n.errors.importing,"import-error":n.errors.importingError,"parsed-csv":n.parsedCSV,"form-data":n.importCsvFormData,columns:i.renderColumns,"data-matchers":i.dataMatchers,database:i.filteredCasting,"disable-update":!0,onReupload:i.resetImport,onCancel:i.hideImportRenderModal,onConfirm:i.uploadImportFile},null,8,["active","is-loading","is-error","import-error","parsed-csv","form-data","columns","data-matchers","database","onReupload","onCancel","onConfirm"]),y(z,{ref:"import-modal",active:n.modals.importing,"is-loading":n.loading.importing,"is-error":n.errors.importing,"form-data":n.importCsvFormData,columns:i.csvColumns,"optional-columns":n.optionalCsvColumns,onCancel:i.hideImportModal,onConfirm:i.renderImport},null,8,["active","is-loading","is-error","form-data","columns","optional-columns","onCancel","onConfirm"]),y(K,{ref:"edit-label-modal",active:n.modals.isEditLabelDisplayed,"is-loading":n.loading.editLabel,"is-error":n.loading.editError,asset:n.editedAsset,label:n.editedAssetLinkLabel,onCancel:s[13]||(s[13]=d=>n.modals.isEditLabelDisplayed=!1),onConfirm:i.confirmEditLabel},null,8,["active","is-loading","is-error","asset","label","onConfirm"]),y(j,{ref:"build-filter-modal",active:n.modals.isBuildFilterDisplayed,onConfirm:i.confirmBuildFilter,onCancel:s[14]||(s[14]=d=>n.modals.isBuildFilterDisplayed=!1)},null,8,["active","onConfirm"]),y(Q,{ref:"edit-asset-modal",active:n.modals.isNewDisplayed,"asset-to-edit":{},"is-error":n.errors.edit,"is-loading":n.loading.edit,"is-loading-stay":n.loading.stay,"is-success":n.success.edit,onConfirm:i.confirmNewAsset,onConfirmAndStay:i.confirmNewAssetStay,onCancel:s[15]||(s[15]=d=>n.modals.isNewDisplayed=!1)},null,8,["active","is-error","is-loading","is-loading-stay","is-success","onConfirm","onConfirmAndStay"]),y(G,{active:n.modals.isRemoveConfirmationDisplayed,"delete-button-text":e.$t("breakdown.remove.confirm"),"error-text":e.$t("breakdown.remove.error"),"is-loading":n.loading.remove,"is-error":n.loading.error,text:e.$t("breakdown.remove.text"),onConfirm:i.confirmAssetRemoval,onCancel:s[16]||(s[16]=d=>n.modals.isRemoveConfirmationDisplayed=!1)},null,8,["active","delete-button-text","error-text","is-loading","is-error","text","onConfirm"])])}const Wt=I(Os,[["render",et],["__scopeId","data-v-a3cdae3f"]]);export{Wt as default};
//# sourceMappingURL=Breakdown-DPInXZUe.js.map
