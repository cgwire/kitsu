import{_ as I,E as Q,B as N,Z as K,a as O,b as z,r as d,q as Y,o as n,c as l,d as h,f as m,k as _,t as p,g as y,h as r,F as g,e as k,n as q,v as R,w as W,H as B,i as G,I as J,J as Z,p as X}from"./index-Dw-uod2x.js";import{c as j}from"./csv-Dt0ViJ8m.js";import{s as $}from"./string-B0Tq569e.js";import{s as x}from"./search-CWIHq9c3.js";import{V as ee,T as te,a as se,M as ie,S as ne,C as ae,_ as oe,A as le,b as re,e as de}from"./SortingInfo-IpI7epo0.js";import{d as ue,B as ce}from"./BuildFilterModal-AsQyG_6U.js";import{C as me}from"./ComboboxDepartment-DQ8ZI2WM.js";import{D as he}from"./DeleteModal-D5nitPJZ.js";import{E as pe}from"./EditSequenceModal-lzBDvQvZ.js";import{d as fe}from"./dom-tO7tlkHV.js";import{e as ye}from"./entity_list-4DDYrVPE.js";import{f as Se}from"./format-fMWuo47O.js";import{M as ge,s as ke}from"./MetadataHeader-BsMptUuX.js";import{D as Ce}from"./DescriptionCell-Cm2KfHAo.js";import{R as qe}from"./RowActionsCell-C9aLugox.js";import{T as Me}from"./TableMetadataSelectorMenu-D6tnIEf6.js";import{T as De}from"./TableInfo-BOYXFWEz.js";import{V as Te}from"./ValidationCell-C4EqjcEB.js";import{_ as ve}from"./empty_shot-DjP6mzpU.js";import{H as we}from"./HardDeleteModal-BWVmHjcR.js";import{S as be}from"./SearchField-B9agWdMK.js";import{S as Ee}from"./SearchQueryList-eqDHREjk.js";import Le from"./TaskInfo-r8aZr1NT.js";import"./DepartmentName-kmEXEkam.js";import"./PreviewPlayer-Dm_ANgjQ.js";import"./PlaylistPlayer-B4BWqUJa.js";import"./ComboboxSimple-Vf48mrbl.js";import"./ComboboxTaskType-DmSe2PuZ.js";import"./TaskTypeName-CzX-aVdj.js";import"./ModalFooter-Dmgqo0ae.js";import"./TextField-EpYNDuEI.js";import"./video-Yn96Kb74.js";import"./clipboard-CQqgyZ_h.js";import"./Combobox-Z_ENhFXj.js";import"./ComboboxStyled-DrFBZe-s.js";import"./index-C15PprjC.js";import"./BaseModal-CUMx-WEe.js";import"./ComboboxStudio-D4rrWH2h.js";import"./play-qfd1WDm6.js";import"./render-GdzifLjz.js";import"./EmojiButton-BTNSPSu1.js";import"./FileUpload-Cng9V_As.js";import"./ComboboxStatus-DknHLATL.js";import"./ConfirmModal-DnlSFX-8.js";import"./triangle-alert-D6jyW-fK.js";import"./ValidationTag-Dmpl-p74.js";import"./thumbs-up-Dziai4S2.js";import"./copy-C1lXCnZO.js";import"./vue.esm-bundler-44hZGVEk.js";import"./VideoViewer-C7DK8vtH.js";import"./ComboboxBoolean-DeubScUy.js";import"./check-B15weKo7.js";import"./ComboboxOptions-Cj6TJfKz.js";import"./PageTitle-CBcleFeD.js";import"./PeopleField-Dk8dxPgh.js";import"./TextareaField-Cu9GLtzh.js";import"./trash-gURpboxh.js";import"./refresh-cw-D3rKtSvX.js";import"./vuedraggable.umd-DphOE8B6.js";import"./grip-vertical-Ds04I29U.js";import"./eye-ByTwqQRj.js";import"./BooleanField-DWHGtZOu.js";import"./ColorField-COd1sznp.js";import"./trash-2-B6whY4z4.js";import"./chevron-up-DrIzzrNn.js";import"./DeleteEntities-DujJJYkA.js";import"./corner-right-up-ZAfxlICJ.js";const Ae={name:"sequence-list",mixins:[ue,fe,Se,ye,ke],props:{displaySettings:{type:Object,default:()=>({})},displayedSequences:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]},departmentFilter:{type:Array,default:()=>[]}},emits:["create-tasks","delete-clicked","edit-clicked","metadata-changed"],data(){return{type:"sequence",hiddenColumns:{},lastHeaderMenuDisplayed:null,lastMetadaDataHeaderMenuDisplayed:null,lastHeaderMenuDisplayedIndexInGrid:null,lastSelectedSequence:null,lastSelection:null,metadataDisplayHeaders:{estimation:!0,timeSpent:!0},offsets:{},stickedColumns:{},domEvents:[["mousemove",this.onMouseMove],["touchmove",this.onMouseMove],["mouseup",this.stopBrowsing],["mouseleave",this.stopBrowsing],["touchend",this.stopBrowsing],["touchcancel",this.stopBrowsing],["keyup",this.stopBrowsing]]}},components:{ButtonSimple:N,DescriptionCell:Ce,EntityThumbnail:Q,MetadataHeader:ge,MetadataInput:ie,RowActionsCell:qe,TableHeaderMenu:se,TableMetadataHeaderMenu:te,TableMetadataSelectorMenu:Me,TableInfo:De,ValidationCell:Te,ValidationHeader:ee},computed:{...z(["currentEpisode","currentProduction","currentSequence","displayedSequencesEstimation","displayedSequencesLength","displayedSequencesTimeSpent","displaySettings.bigThumbnails","isCurrentUserAdmin","isCurrentUserManager","isCurrentUserSupervisor","isCurrentUserClient","isSingleSequence","isSequenceDescription","isSequenceEstimation","isSequenceResolution","isSequenceTime","nbSelectedTasks","selectedTasks","sequenceMap","sequenceFilledColumns","sequenceMetadataDescriptors","sequences","sequenceSearchText","sequenceSelectionGrid","sequences","taskMap","taskTypeMap","user"]),isEmptyList(){return this.displayedSequences&&this.displayedSequences.length===0&&!this.isLoading&&!this.isError&&(!this.sequenceSearchText||this.sequenceSearchText.length===0)},isListVisible(){return!this.isLoading&&!this.isError&&this.displayedSequencesLength>0},visibleColumns(){let e=2;return e+=!this.isCurrentUserClient&&this.displaySettings.showInfos&&this.isSequenceDescription?1:0,e+=this.visibleMetadataDescriptors.length,e+=!this.isCurrentUserClient&&this.displaySettings.showInfos&&this.isSequenceTime&&this.metadataDisplayHeaders.timeSpent?1:0,e+=!this.isCurrentUserClient&&this.displaySettings.showInfos&&this.isSequenceEstimation&&this.metadataDisplayHeaders.estimation?1:0,e+=this.displayedValidationColumns.length,e},displayedValidationColumns(){return this.validationColumns.filter(e=>this.sequenceFilledColumns[e]&&(!this.hiddenColumns[e]||this.displaySettings.showInfos))},metadataDescriptors(){return this.sequenceMetadataDescriptors},localStorageStickKey(){return`stick-sequences-${this.currentProduction?.id}`}},methods:{...O(["setSequenceSelection"]),isSelected(e,t){return this.sequenceSelectionGrid[e]&&this.sequenceSelectionGrid[e][t]},sequencePath(e){return this.getPath("sequence",e)},getPath(e,t){const a=this.currentProduction?.id,S=this.currentEpisode?this.currentEpisode.id:null;return K(t,a,e,S)}},watch:{displayedSequences(){this.$options.lineIndex={}},validationColumns(){this.initHiddenColumns(this.validationColumns,this.hiddenColumns)},stickedColumns(){this.updateOffsets()},isLoading(){this.updateOffsets()}}},Ve={class:"data-list"},Ue={class:"datatable"},Pe={class:"datatable-head",id:"datatable-sequence"},He={scope:"col",class:"name sequence-name datatable-row-header",ref:"th-sequence"},Fe={class:"flexrow"},Be={class:"flexrow-item"},_e={key:1,scope:"col",class:"description selectable"},Ie={key:2,scope:"col",class:"resolution"},Ne=["title"],Oe={scope:"col",class:"actions",ref:"actionsSection"},ze={class:"flexrow"},Re=["title"],Qe={key:3,class:"resolution"},Ke=["value","onInput","onKeyup"],Ye={key:1,class:"metadata-value selectable"},We=["title"],Ge={key:5,class:"time-spent selectable"},Je={key:6,class:"estimation selectable"},Ze={key:9,class:"actions"},Xe={key:0,class:"has-text-centered"},je={class:"info"},$e={key:1,class:"has-text-centered nb-sequences"},xe={key:0};function et(e,t,a,S,i,c){const E=d("table-header-menu"),v=d("table-metadata-header-menu"),M=d("button-simple"),w=d("metadata-header"),b=d("validation-header"),L=d("table-metadata-selector-menu"),A=d("entity-thumbnail"),V=d("router-link"),D=d("metadata-input"),T=d("validation-cell"),U=d("description-cell"),P=d("row-actions-cell"),H=d("table-info"),F=Y("columns-resizable");return n(),l("div",Ve,[h("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:t[17]||(t[17]=(...s)=>e.onBodyScroll&&e.onBodyScroll(...s))},[m(E,{ref:"headerMenu","is-minimized":i.hiddenColumns[i.lastHeaderMenuDisplayed],"is-edit-allowed":e.isCurrentUserManager,"is-sticked":i.stickedColumns[i.lastHeaderMenuDisplayed],onMinimizeClicked:t[0]||(t[0]=s=>e.onMinimizeColumnToggled()),onDeleteAllClicked:t[1]||(t[1]=s=>e.onDeleteAllTasksClicked()),onSortByClicked:t[2]||(t[2]=s=>e.onSortByTaskTypeClicked()),onSelectColumn:t[3]||(t[3]=s=>e.onSelectColumn("sequence")),onToggleStick:t[4]||(t[4]=s=>e.stickColumnClicked())},null,8,["is-minimized","is-edit-allowed","is-sticked"]),m(v,{ref:"headerMetadataMenu","is-edit-allowed":e.isCurrentUserManager,"is-sticked":i.stickedColumns[i.lastMetadaDataHeaderMenuDisplayed],onEditClicked:t[5]||(t[5]=s=>e.onEditMetadataClicked()),onDeleteClicked:t[6]||(t[6]=s=>e.onDeleteMetadataClicked()),onSortByClicked:t[7]||(t[7]=s=>e.onSortByMetadataClicked()),onToggleStick:t[8]||(t[8]=s=>e.metadataStickColumnClicked(s))},null,8,["is-edit-allowed","is-sticked"]),h("table",Ue,[_((n(),l("thead",Pe,[h("tr",null,[h("th",He,[h("div",Fe,[h("span",Be,p(e.$t("sequences.fields.name")),1),(e.isCurrentUserManager||e.isCurrentUserSupervisor)&&!a.isLoading?(n(),y(M,{key:0,class:"is-small flexrow-item",icon:"plus",text:"",onClick:e.onAddMetadataClicked},null,8,["onClick"])):r("",!0)])],512),a.displaySettings.showInfos?(n(!0),l(g,{key:0},k(e.stickedVisibleMetadataDescriptors,(s,u)=>(n(),y(w,{ref_for:!0,ref:`editor-${u}`,key:s.id,descriptor:s,left:i.offsets["editor-"+u]?`${i.offsets["editor-"+u]}px`:"0","is-stick":"",style:{"z-index":1001},onShowMetadataHeaderMenu:o=>e.showMetadataHeaderMenu(s.id,o)},null,8,["descriptor","left","onShowMetadataHeaderMenu"]))),128)):r("",!0),(n(!0),l(g,null,k(e.stickedDisplayedValidationColumns,(s,u)=>(n(),y(b,{ref_for:!0,ref:`validation-${u}`,key:s,"hidden-columns":i.hiddenColumns,"column-id":s,"validation-style":e.getValidationStyle(s),left:i.offsets["validation-"+u]?`${i.offsets["validation-"+u]}px`:"0",type:"editor","is-stick":"",onShowHeaderMenu:o=>e.showHeaderMenu(s,u,o)},null,8,["hidden-columns","column-id","validation-style","left","onShowHeaderMenu"]))),128)),!e.isCurrentUserClient&&a.displaySettings.showInfos&&e.isSequenceDescription?(n(),l("th",_e,p(e.$t("sequences.fields.description")),1)):r("",!0),e.isSequenceResolution&&a.displaySettings.showInfos?(n(),l("th",Ie,p(e.$t("shots.fields.resolution")),1)):r("",!0),a.displaySettings.showInfos?(n(!0),l(g,{key:3},k(e.nonStickedVisibleMetadataDescriptors,s=>(n(),y(w,{key:s.id,descriptor:s,onShowMetadataHeaderMenu:u=>e.showMetadataHeaderMenu(s.id,u)},null,8,["descriptor","onShowMetadataHeaderMenu"]))),128)):r("",!0),!e.isCurrentUserClient&&a.displaySettings.showInfos&&e.isSequenceTime&&i.metadataDisplayHeaders.timeSpent?(n(),l("th",{key:4,scope:"col",class:"time-spent",ref:"th-spent"},p(e.$t("sequences.fields.time_spent")),513)):r("",!0),!e.isCurrentUserClient&&a.displaySettings.showInfos&&e.isSequenceEstimation&&i.metadataDisplayHeaders.estimation?(n(),l("th",{key:5,scope:"col",class:"estimation",title:e.$t("main.estimation"),ref:"th-spent"},p(e.$t("main.estimation_short")),9,Ne)):r("",!0),a.isLoading?r("",!0):(n(!0),l(g,{key:6},k(e.nonStickedDisplayedValidationColumns,(s,u)=>(n(),y(b,{key:s,"hidden-columns":i.hiddenColumns,"column-id":s,"validation-style":e.getValidationStyle(s),type:"sequences",onShowHeaderMenu:o=>{e.showHeaderMenu(s,u,o)}},null,8,["hidden-columns","column-id","validation-style","onShowHeaderMenu"]))),128)),h("th",Oe,[e.isCurrentUserManager&&a.displayedSequences.length>0&&!a.isLoading?(n(),y(M,{key:0,class:q({"is-small":!0,highlighted:e.isEmptyTask}),icon:"plus",text:e.$t("tasks.create_tasks"),onClick:t[9]||(t[9]=s=>e.$emit("create-tasks"))},null,8,["class","text"])):r("",!0),a.displaySettings.showInfos?_((n(),y(L,{key:1,descriptors:e.sequenceMetadataDescriptors,exclude:{timeSpent:!e.isSequenceTime,estimation:!e.isSequenceEstimation},namespace:"sequences",modelValue:i.metadataDisplayHeaders,"onUpdate:modelValue":t[10]||(t[10]=s=>i.metadataDisplayHeaders=s)},null,8,["descriptors","exclude","modelValue"])),[[R,e.columnSelectorDisplayed]]):r("",!0),e.sequenceMetadataDescriptors.length>0&&a.displaySettings.showInfos?(n(),y(M,{key:2,class:"is-small is-pulled-right mr05",icon:"down",onClick:e.toggleColumnSelector},null,8,["onClick"])):r("",!0)],512)])])),[[F]]),h("tbody",{class:"datatable-body",onMousedown:t[15]||(t[15]=(...s)=>e.startBrowsing&&e.startBrowsing(...s)),onTouchstart:t[16]||(t[16]=(...s)=>e.startBrowsing&&e.startBrowsing(...s))},[!a.isLoading&&c.isListVisible?(n(!0),l(g,{key:0},k(a.displayedSequences,(s,u)=>(n(),l("tr",{class:q(["datatable-row",{canceled:s.canceled}]),scope:"row",key:s.id},[h("th",{class:q({"datatable-row-header":!0,"sequence-name":!0,name:!0,strong:!s.canceled})},[h("div",ze,[m(A,{entity:s,width:a.displaySettings.bigThumbnails?150:50,height:a.displaySettings.bigThumbnails?100:33,"empty-width":a.displaySettings.bigThumbnails?150:50,"empty-height":a.displaySettings.bigThumbnails?100:34},null,8,["entity","width","height","empty-width","empty-height"]),e.isCurrentUserClient?(n(),l(g,{key:1},[B(p(s.name),1)],64)):(n(),y(V,{key:0,tabindex:"-1",title:s.name,to:c.sequencePath(s.id)},{default:W(()=>[B(p(s.name),1)]),_:2},1032,["title","to"]))])],2),a.displaySettings.showInfos&&!a.isLoading?(n(!0),l(g,{key:0},k(e.stickedVisibleMetadataDescriptors,(o,f)=>(n(),l("td",{ref_for:!0,ref:`editor-${u}-${f}`,class:"metadata-descriptor datatable-row-header",title:s.data?s.data[o.field_name]:"",style:G({"z-index":1e3-u,left:i.offsets["editor-"+f]?`${i.offsets["editor-"+f]}px`:"0"}),key:s.id+"-"+o.id},[m(D,{entity:s,descriptor:o,onMetadataChanged:t[11]||(t[11]=C=>e.$emit("metadata-changed",C)),indexes:{i:u,j:f}},null,8,["entity","descriptor","indexes"])],12,Re))),128)):r("",!0),a.isLoading?r("",!0):(n(!0),l(g,{key:1},k(e.stickedDisplayedValidationColumns,(o,f)=>(n(),y(T,{ref_for:!0,ref:`validation-${u}-${f}`,key:o+"-"+s.id,class:q({"validation-cell":!i.hiddenColumns[o],"hidden-validation-cell":i.hiddenColumns[o],"datatable-row-header":!0}),"contact-sheet":a.displaySettings.contactSheetMode,column:e.taskTypeMap.get(o),"column-y":f,entity:s,"is-assignees":a.displaySettings.showAssignations,"is-static":!0,left:i.offsets["validation-"+f]?`${i.offsets["validation-"+f]}px`:"0",minimized:i.hiddenColumns[o],"row-x":u,selected:c.isSelected(u,f),sticked:!0,"task-test":e.taskMap.get(s.validations.get(o)),onSelect:t[12]||(t[12]=C=>e.onTaskSelected(C,!0)),onUnselect:t[13]||(t[13]=C=>e.onTaskUnselected(C,!0))},null,8,["class","contact-sheet","column","column-y","entity","is-assignees","left","minimized","row-x","selected","task-test"]))),128)),!e.isCurrentUserClient&&a.displaySettings.showInfos&&e.isSequenceDescription?(n(),y(U,{key:2,class:"description",entry:s,editable:e.isCurrentUserManager,onDescriptionChanged:o=>e.onDescriptionChanged(s,o)},null,8,["entry","editable","onDescriptionChanged"])):r("",!0),e.isSequenceResolution&&a.displaySettings.showInfos?(n(),l("td",Qe,[e.isCurrentUserManager?(n(),l("input",{key:0,class:q({"input-editor":!0,error:!e.isValidResolution(s)}),value:e.getMetadataFieldValue({field_name:"resolution"},s),onInput:o=>e.onMetadataFieldChanged(s,{field_name:"resolution"},o),onKeyup:J(o=>e.onInputKeyUp(o,e.getIndex(u,e.k),e.descriptorLength+3),["ctrl"])},null,42,Ke)):(n(),l("span",Ye,p(e.getMetadataFieldValue({field_name:"resolution"},s)),1))])):r("",!0),a.displaySettings.showInfos?(n(!0),l(g,{key:4},k(e.nonStickedVisibleMetadataDescriptors,(o,f)=>(n(),l("td",{class:"metadata-descriptor",title:s.data?s.data[o.field_name]:"",key:s.id+"-"+o.id},[m(D,{entity:s,descriptor:o,indexes:{i:u,j:f},onMetadataChanged:t[14]||(t[14]=C=>e.$emit("metadata-changed",C))},null,8,["entity","descriptor","indexes"])],8,We))),128)):r("",!0),!e.isCurrentUserClient&&a.displaySettings.showInfos&&e.isSequenceTime&&i.metadataDisplayHeaders.timeSpent?(n(),l("td",Ge,p(e.formatDuration(s.timeSpent)),1)):r("",!0),!e.isCurrentUserClient&&a.displaySettings.showInfos&&e.isSequenceEstimation&&i.metadataDisplayHeaders.estimation?(n(),l("td",Je,p(e.formatDuration(s.estimation)),1)):r("",!0),a.isLoading?r("",!0):(n(!0),l(g,{key:7},k(e.nonStickedDisplayedValidationColumns,(o,f)=>(n(),y(T,{ref_for:!0,ref:`validation-${u}-${f+e.stickedDisplayedValidationColumns.length}`,class:q({"validation-cell":!i.hiddenColumns[o],"hidden-validation-cell":i.hiddenColumns[o]}),"contact-sheet":a.displaySettings.contactSheetMode,key:`${o}-${s.id}`,column:e.taskTypeMap.get(o),entity:s,"task-test":e.taskMap.get(s.validations?s.validations.get(o):null),minimized:i.hiddenColumns[o],selected:c.isSelected(u,f+e.stickedDisplayedValidationColumns.length),"row-x":u,"column-y":f,"is-assignees":a.displaySettings.showAssignations,onSelect:e.onTaskSelected,onUnselect:e.onTaskUnselected},null,8,["class","contact-sheet","column","entity","task-test","minimized","selected","row-x","column-y","is-assignees","onSelect","onUnselect"]))),128)),e.isCurrentUserManager?(n(),y(P,{key:8,entry:s,onDeleteClicked:o=>e.$emit("delete-clicked",s),onEditClicked:o=>e.$emit("edit-clicked",s)},null,8,["entry","onDeleteClicked","onEditClicked"])):(n(),l("td",Ze))],2))),128)):r("",!0)],32)])],544),m(H,{"is-loading":a.isLoading,"is-error":a.isError},null,8,["is-loading","is-error"]),c.isEmptyList&&!e.isCurrentUserClient&&!a.isLoading?(n(),l("div",Xe,[t[18]||(t[18]=h("p",{class:"info"},[h("img",{src:ve})],-1)),h("p",je,p(e.$t("sequences.empty_list_client")),1)])):r("",!0),!c.isEmptyList&&!a.isLoading?(n(),l("p",$e,[B(p(e.displayedSequencesLength)+" "+p(e.$tc("sequences.number",e.displayedSequencesLength))+" ",1),e.displayedSequencesTimeSpent>0||e.displayedSequencesEstimation>0?(n(),l("span",xe," ("+p(e.formatDuration(e.displayedSequencesTimeSpent))+" "+p(e.isDurationInHours?e.$tc("main.hours_spent",e.formatDuration(e.displayedSequencesTimeSpent,!1)):e.$tc("main.days_spent",e.formatDuration(e.displayedSequencesTimeSpent,!1)))+", "+p(e.formatDuration(e.displayedSequencesEstimation))+" "+p(e.isDurationInHours?e.$tc("main.hours_estimated",e.formatDuration(e.displayedSequencesEstimation,!1)):e.$tc("main.man_days",e.formatDuration(e.displayedSequencesEstimation,!1)))+") ",1)):r("",!0)])):r("",!0)])}const tt=I(Ae,[["render",et],["__scopeId","data-v-16cd0914"]]),st={name:"sequences",mixins:[x,de],components:{AddMetadataModal:re,AddThumbnailsModal:le,BuildFilterModal:ce,ButtonSimple:N,ComboboxDepartment:me,ComboboxDisplayOptions:oe,CreateTasksModal:ae,DeleteModal:he,EditSequenceModal:pe,SequenceList:tt,HardDeleteModal:we,SearchField:be,SearchQueryList:Ee,SortingInfo:ne,TaskInfo:Le},data(){return{type:"sequence",contactSheetMode:!1,deleteAllTasksLockText:null,descriptorToEdit:{},departmentFilter:[],sequenceToDelete:null,sequenceToEdit:null,formData:null,genericColumns:["Metadata column name (text value)","Task type name (task status name value)","Task type name + comment (text value)"],historyEdit:{},initialLoading:!0,optionalColumns:["Description"],pageName:"Sequences",parsedCSV:[],selectedDepartment:"ALL",taskTypeForTaskDeletion:null,modals:{isAddMetadataDisplayed:!1,isAddThumbnailsDisplayed:!1,isBuildFilterDisplayed:!1,isCreateTasksDisplayed:!1,isDeleteDisplayed:!1,isDeleteMetadataDisplayed:!1,isDeleteAllTasksDisplayed:!1,isImportRenderDisplayed:!1,isImportDisplayed:!1,isNewDisplayed:!1},loading:{addMetadata:!1,addThumbnails:!1,creatingTasks:!1,creatingTasksStay:!1,del:!1,deleteAllTasks:!1,deleteMetadata:!1,edit:!1,importing:!1,savingSearch:!1,sequence:!1,stay:!1},errors:{addMetadata:!1,creatingTasks:!1,deleteAllTasks:!1,deleteMetadata:!1,edit:!1,importing:!1,importingError:null}}},beforeUnmount(){this.clearSelectedSequences()},created(){this.setLastProductionScreen("sequences")},mounted(){this.$refs["sequence-list"].setScrollPosition(this.sequenceListScrollPosition),this.$refs["sequence-list"].setScrollPosition(this.sequenceListScrollPosition),!this.isCurrentUserManager&&this.user.departments.length>0?(this.selectedDepartment="MY_DEPARTMENTS",this.departmentFilter=this.user.departments):this.departmentFilter=[];const e=()=>{this.initialLoading=!1,this.$refs["sequence-list"]&&(this.$refs["sequence-list"].setScrollPosition(this.sequenceListScrollPosition),this.$refs["sequence-list"].selectTaskFromQuery(),setTimeout(()=>{this.applySearchFromUrl()},200))};this.sequenceMap.size<1||this.sequenceValidationColumns.length===0||this.sequenceMap.values().next().project_id!==this.currentProduction.id?this.loadSequencesWithTasks().then(()=>{this.initialLoading=!1,e()}).catch(console.error):(this.isSequencesLoading||(this.initialLoading=!1),e())},computed:{...z(["currentEpisode","currentProduction","currentSection","displayedSequences","departmentMap","departments","sequenceMap","sequences","sequenceSearchQueries","isCurrentUserClient","isCurrentUserManager","isSequenceDescription","isSequenceEstimation","isSequenceTime","isSequencesLoading","isSequencesLoadingError","isShowAssignations","isTVShow","openProductions","productionSequenceTaskTypes","sequenceMap","sequenceFilledColumns","sequenceSearchText","sequenceValidationColumns","sequenceListScrollPosition","sequenceSorting","taskTypeMap","user"]),searchField(){return this.$refs["sequence-search-field"]},renderColumns(){const e=[...this.dataMatchers,...this.optionalColumns];return this.productionSequenceTaskTypes.forEach(t=>{e.push(t.name),e.push(`${t.name} comment`)}),e},filteredSequences(){const e={};return this.displayedSequences.forEach(t=>{const a=t.name;e[a]=!0}),e},metadataDescriptors(){return this.sequenceMetadataDescriptors}},methods:{...O(["addMetadataDescriptor","createTasks","changeSequenceSort","clearSelectedSequences","commentTaskWithPreview","deleteAllTasks","deleteSequence","deleteMetadataDescriptor","editSequence","getSequencesCsvLines","hideAssignations","loadSequencesWithTasks","newSequence","removeSequenceSearch","saveSequenceSearch","setLastProductionScreen","setPreview","setSequenceSearch","showAssignations","uploadSequenceFile"]),confirmAddMetadata(e){this.loading.addMetadata=!0,e.entity_type="Sequence",this.addMetadataDescriptor(e).then(()=>{this.loading.addMetadata=!1,this.modals.isAddMetadataDisplayed=!1}).catch(t=>{console.error(t),this.loading.addMetadata=!1,this.errors.addMetadata=!0})},showNewModal(){this.sequenceToEdit={},this.modals.isNewDisplayed=!0},confirmDeleteSequence(){this.loading.del=!0,this.errors.del=!1,this.deleteSequence(this.sequenceToDelete).then(()=>{this.loading.del=!1,this.modals.isDeleteDisplayed=!1}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},runTasksCreation(e,t){return this.errors.creatingTasks=!1,this.createTasks({type:"sequences",task_type_id:e.task_type_id,project_id:this.currentProduction.id,selectionOnly:t})},reset(){this.initialLoading=!1,this.loadSequencesWithTasks(e=>{e&&console.error(e),this.applySearchFromUrl(),this.initialLoading=!1})},resetEditModal(){const e={name:""};this.openProductions.length>0&&(e.production_id=this.openProductions[0].id),this.sequenceToEdit=e},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveSequenceSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeSequenceSearch(e).catch(console.error)},onExportClick(){this.getSequencesCsvLines().then(e=>{const t=[Z().format("YYYY-MM-DD"),"kitsu",this.currentProduction.name,this.$t("sequences.title")],a=$.slugify(t.join("_")),S=[this.$t("sequences.fields.name"),this.$t("sequences.fields.description")];this.currentSequence&&S.splice(0,0,"Sequence"),X([...this.currentProduction.descriptors]).filter(i=>i.entity_type==="Sequence").forEach(i=>{S.push(i.name)}),this.isSequenceTime&&S.push(this.$t("sequences.fields.time_spent")),this.isSequenceEstimation&&S.push(this.$t("main.estimation_short")),this.sequenceValidationColumns.forEach(i=>{S.push(this.taskTypeMap.get(i).name),S.push("Assignations")}),j.buildCsvFile(a,[S].concat(e))})},async onFieldChanged({entry:e,fieldName:t,value:a}){const S={id:e.id,[t]:a};await this.editSequence(S),this.applySearchFromUrl(!1)},async onMetadataChanged({entry:e,descriptor:t,value:a}){const S={id:e.id,data:{[t.field_name]:a}};await this.editSequence(S),this.applySearchFromUrl(!1)},onEditClicked(e){this.sequenceToEdit=e,this.modals.isNewDisplayed=!0},onDeleteClicked(e){this.sequenceToDelete=e,this.modals.isDeleteDisplayed=!0},confirmEditSequence(e){this.loading.edit=!0,this.errors.edit=!1,e.id?this.editSequence(e).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1,this.applySearchFromUrl(!1)}).catch(t=>{console.error(t),this.loading.edit=!1,this.errors.edit=!0}):(e.project_id=this.currentProduction.id,this.currentEpisode&&(e.episode_id=this.currentEpisode.id),this.newSequence(e).then(()=>{this.loading.edit=!1,this.modals.isNewDisplayed=!1}).catch(t=>{console.error(t),this.loading.edit=!1,this.errors.edit=!0}))},deleteText(){const e=this.sequenceToDelete;return e?this.$t("sequences.delete_text",{name:e.name}):""}},watch:{currentProduction(){this.$refs["sequence-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.initialLoading=!1,this.reset()},currentEpisode(){this.$refs["sequence-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.initialLoading=!1,this.reset()},currentSection(){(this.isTVShow&&this.displayedSequences.length===0||this.displayedSequences[0]?.episode_id!==this.currentEpisode?.id)&&(this.$refs["sequence-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.initialLoading=!1,this.reset())},isSequencesLoading(){this.isSequencesLoading||(this.initialLoading=!1,this.$refs["sequence-list"]&&this.$refs["sequence-list"].setScrollPosition(this.sequenceListScrollPosition))}},head(){return this.isTVShow?{title:`${this.currentProduction?.name||""} - ${this.currentEpisode?.name||""} | ${this.$t("sequences.title")} - Kitsu`}:{title:`${this.currentProduction.name} | ${this.$t("sequences.title")} - Kitsu`}}},it={class:"columns fixed-page"},nt={class:"column main-column"},at={class:"sequences page"},ot={class:"sequence-list-header page-header"},lt={class:"flexrow"},rt={key:0,class:"flexrow flexrow-item"},dt={key:1,class:"flexrow"},ut={class:"query-list mt1"},ct={id:"side-column",class:"column side-column"};function mt(e,t,a,S,i,c){const E=d("search-field"),v=d("button-simple"),M=d("combobox-department"),w=d("combobox-display-options"),b=d("search-query-list"),L=d("sorting-info"),A=d("sequence-list"),V=d("task-info"),D=d("delete-modal"),T=d("hard-delete-modal"),U=d("create-tasks-modal"),P=d("add-metadata-modal");d("add-thumbnails-modal");const H=d("build-filter-modal"),F=d("edit-sequence-modal");return n(),l("div",it,[h("div",nt,[h("div",at,[h("div",ot,[h("div",lt,[m(E,{ref:"sequence-search-field","can-save":!0,onChange:e.onSearchChange,onSave:c.saveSearchQuery,placeholder:"ex: e01 sequence=wip"},null,8,["onChange","onSave"]),m(v,{class:"flexrow-item",title:e.$t("entities.build_filter.title"),icon:"filter",onClick:t[0]||(t[0]=()=>i.modals.isBuildFilterDisplayed=!0)},null,8,["title"]),t[10]||(t[10]=h("div",{class:"filler"},null,-1)),e.isCurrentUserClient?r("",!0):(n(),l("div",rt,[e.departments.length>0?(n(),y(M,{key:0,class:"combobox-department flexrow-item","selectable-departments":e.selectableDepartments("Sequence"),"display-all-and-my-departments":!0,rounded:"",modelValue:i.selectedDepartment,"onUpdate:modelValue":t[1]||(t[1]=s=>i.selectedDepartment=s)},null,8,["selectable-departments","modelValue"])):r("",!0),m(w,{class:"flexrow-item",type:i.type,modelValue:e.displaySettings,"onUpdate:modelValue":t[2]||(t[2]=s=>e.displaySettings=s)},null,8,["type","modelValue"])])),e.isCurrentUserManager?(n(),l("div",dt,[m(v,{class:"flexrow-item",text:e.$t("sequences.new_sequence"),icon:"plus",onClick:c.showNewModal},null,8,["text","onClick"])])):r("",!0)]),h("div",ut,[!e.isSequencesLoading&&!i.initialLoading?(n(),y(b,{key:0,queries:e.sequenceSearchQueries,type:"sequence",onRemoveSearch:c.removeSearchQuery},null,8,["queries","onRemoveSearch"])):r("",!0)])]),e.sequenceSorting?.length?(n(),y(L,{key:0,sorting:e.sequenceSorting,onClearSorting:t[3]||(t[3]=s=>e.onChangeSortClicked(null))},null,8,["sorting"])):r("",!0),m(A,{ref:"sequence-list","contact-sheet-mode":i.contactSheetMode,"display-settings":e.displaySettings,"displayed-sequences":e.displayedSequences,"is-loading":e.isSequencesLoading||i.initialLoading,"is-error":e.isSequencesLoadingError,"validation-columns":e.sequenceValidationColumns,"department-filter":i.departmentFilter,onAddMetadata:e.onAddMetadataClicked,onChangeSort:e.onChangeSortClicked,onCreateTasks:e.showCreateTasksModal,onDeleteAllTasks:e.onDeleteAllTasksClicked,onDeleteClicked:c.onDeleteClicked,onDeleteMetadata:e.onDeleteMetadataClicked,onEditClicked:c.onEditClicked,onEditMetadata:e.onEditMetadataClicked,onFieldChanged:c.onFieldChanged,onMetadataChanged:c.onMetadataChanged,onScroll:e.saveScrollPosition,onKeepTaskPanelOpen:e.onKeepTaskPanelOpenChanged},null,8,["contact-sheet-mode","display-settings","displayed-sequences","is-loading","is-error","validation-columns","department-filter","onAddMetadata","onChangeSort","onCreateTasks","onDeleteAllTasks","onDeleteClicked","onDeleteMetadata","onEditClicked","onEditMetadata","onFieldChanged","onMetadataChanged","onScroll","onKeepTaskPanelOpen"])])]),_(h("div",ct,[m(V,{task:e.selectedTasks.values().next().value,"entity-type":"Sequence","with-actions":""},null,8,["task"])],512),[[R,e.isTaskSidePanelOpen]]),m(D,{ref:"delete-sequence-modal",active:i.modals.isDeleteDisplayed,"is-loading":i.loading.del,"is-error":i.errors.del,text:c.deleteText(),"error-text":e.$t("sequences.delete_error"),onCancel:t[4]||(t[4]=s=>i.modals.isDeleteDisplayed=!1),onConfirm:c.confirmDeleteSequence},null,8,["active","is-loading","is-error","text","error-text","onConfirm"]),m(D,{ref:"delete-metadata-modal",active:i.modals.isDeleteMetadataDisplayed,"is-loading":i.loading.deleteMetadata,"is-error":i.errors.deleteMetadata,text:e.$t("productions.metadata.delete_text"),"error-text":e.$t("productions.metadata.delete_error"),onCancel:t[5]||(t[5]=s=>i.modals.isDeleteMetadataDisplayed=!1),onConfirm:e.confirmDeleteMetadata},null,8,["active","is-loading","is-error","text","error-text","onConfirm"]),m(T,{ref:"delete-all-tasks-modal",active:i.modals.isDeleteAllTasksDisplayed,"is-loading":i.loading.deleteAllTasks,"is-error":i.errors.deleteAllTasks,text:e.deleteAllTasksText(),"error-text":e.$t("tasks.delete_all_error"),"lock-text":i.deleteAllTasksLockText,"selection-option":!0,onCancel:t[6]||(t[6]=s=>i.modals.isDeleteAllTasksDisplayed=!1),onConfirm:e.confirmDeleteAllTasks},null,8,["active","is-loading","is-error","text","error-text","lock-text","onConfirm"]),m(U,{active:i.modals.isCreateTasksDisplayed,"is-loading":i.loading.creatingTasks,"is-loading-stay":i.loading.creatingTasksStay,"is-error":i.errors.creatingTasks,title:e.$t("tasks.create_tasks_sequence"),text:e.$t("tasks.create_tasks_sequence_explaination"),"error-text":e.$t("tasks.create_tasks_sequence_failed"),onCancel:e.hideCreateTasksModal,onConfirm:e.confirmCreateTasks,onConfirmAndStay:e.confirmCreateTasksAndStay},null,8,["active","is-loading","is-loading-stay","is-error","title","text","error-text","onCancel","onConfirm","onConfirmAndStay"]),m(P,{active:i.modals.isAddMetadataDisplayed,"is-loading":i.loading.addMetadata,"is-error":i.errors.addMetadata,"descriptor-to-edit":i.descriptorToEdit,"entity-type":"Sequence",onCancel:e.closeMetadataModal,onConfirm:c.confirmAddMetadata},null,8,["active","is-loading","is-error","descriptor-to-edit","onCancel","onConfirm"]),r("",!0),m(H,{ref:"build-filter-modal",active:i.modals.isBuildFilterDisplayed,"entity-type":"sequence",onCancel:t[7]||(t[7]=s=>i.modals.isBuildFilterDisplayed=!1),onConfirm:e.confirmBuildFilter},null,8,["active","onConfirm"]),m(F,{active:i.modals.isNewDisplayed,"is-loading":i.loading.edit,"is-error":i.errors.edit,"sequence-to-edit":i.sequenceToEdit,onCancel:t[8]||(t[8]=s=>i.modals.isNewDisplayed=!1),onConfirm:c.confirmEditSequence},null,8,["active","is-loading","is-error","sequence-to-edit","onConfirm"]),m(T,{active:i.modals.isDeleteDisplayed,"is-loading":i.loading.del,"is-error":i.errors.del,text:c.deleteText(),"error-text":e.$t("sequences.delete_error"),"lock-text":i.sequenceToDelete?i.sequenceToDelete.name:"",onCancel:t[9]||(t[9]=s=>i.modals.isDeleteDisplayed=!1),onConfirm:c.confirmDeleteSequence},null,8,["active","is-loading","is-error","text","error-text","lock-text","onConfirm"])])}const ws=I(st,[["render",mt],["__scopeId","data-v-2bd3d073"]]);export{ws as default};
//# sourceMappingURL=Sequences-Ds0NXSDi.js.map
