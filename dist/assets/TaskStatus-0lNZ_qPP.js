import{_ as y,L as C,r as c,o as _,c as b,d as i,t as d,f as l,w,H as E,h as v,g as T,a as S,b as D}from"./index-DF-DoQlt.js";import{c as $}from"./csv-IlynXFQz.js";import{s as P}from"./string-B0Tq569e.js";import{D as q}from"./DeleteModal-DwXK5r5w.js";import{E as L}from"./EditTaskStatusModal-DhwN8hlY.js";import{L as N}from"./ListPageHeader-G9LHDILe.js";import{R as x}from"./RouteTabs-9ZMuefrE.js";import{d as B}from"./vuedraggable.umd-DaNNd7iu.js";import{f as V}from"./format-D3oTyBU9.js";import{B as A}from"./BooleanCell-c9e_U1nn.js";import{R as U}from"./RowActionsCell-DR7b8Q1u.js";import{T as H}from"./TableInfo-D6xnVb4C.js";import{T as I}from"./TaskStatusCell-B4T4zJ_D.js";import"./BooleanField-r8LThAuD.js";import"./check-CO1MD15r.js";import"./ColorField-ByrVYH4e.js";import"./ComboboxBoolean-DT116Lfu.js";import"./Combobox-A6pnhVs3.js";import"./ModalFooter-Chk0SGv-.js";import"./TextField-BKWlN2Ov.js";import"./TextareaField-BVvnEY8u.js";import"./PageTitle-CtScP8aV.js";import"./vue.esm-bundler-pS9-uSLU.js";import"./trash-DWKk5Pv9.js";import"./refresh-cw-CYYYI9XK.js";const M={name:"task-status-list",mixins:[V],components:{BooleanCell:A,draggable:B,HelpCircleIcon:C,RowActionsCell:U,TableInfo:H,TaskStatusCell:I},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked","update-priorities"],data(){return{taskStatuses:[]}},mounted(){this.taskStatuses=this.entries},computed:{},methods:{async updateTaskStatusPriorities(){const t=this.taskStatuses.map((s,n)=>({id:s.id,priority:n+1}));this.$emit("update-priorities",t)}},watch:{entries(){this.taskStatuses=this.entries}}},R={class:"data-list"},F={class:"datatable-wrapper"},G={class:"datatable"},K={class:"datatable-head"},Q={scope:"col",class:"name"},j={scope:"col",class:"short-name"},z={scope:"col",class:"is-default"},J={scope:"col",class:"is-wip"},O={scope:"col",class:"is-done"},W={scope:"col",class:"is-retake"},X={scope:"col",class:"is-artist-allowed"},Y={scope:"col",class:"is-client-allowed"},Z={scope:"col",class:"is-feedback-request"},tt={class:"datatable-row task-status"},et={class:"name"},st=["title"],it={class:"has-text-centered nb-task-status"};function at(t,s,n,o,e,r){const h=c("help-circle-icon"),m=c("task-status-cell"),u=c("boolean-cell"),k=c("row-actions-cell"),p=c("draggable"),f=c("table-info");return _(),b("div",R,[i("div",F,[i("table",G,[i("thead",K,[i("tr",null,[i("th",Q,d(t.$t("task_status.fields.name")),1),i("th",j,d(t.$t("task_status.fields.short_name")),1),i("th",z,d(t.$t("task_status.fields.is_default")),1),i("th",J,d(t.$t("task_status.fields.is_wip")),1),i("th",O,d(t.$t("task_status.fields.is_done")),1),i("th",W,d(t.$t("task_status.fields.is_retake")),1),i("th",X,d(t.$t("task_status.fields.is_artist_allowed")),1),i("th",Y,d(t.$t("task_status.fields.is_client_allowed")),1),i("th",Z,d(t.$t("task_status.fields.is_feedback_request")),1),s[1]||(s[1]=i("th",{scope:"col",class:"actions"},null,-1))])]),l(p,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:r.updateTaskStatusPriorities,modelValue:e.taskStatuses,"onUpdate:modelValue":s[0]||(s[0]=a=>e.taskStatuses=a)},{item:w(({element:a})=>[i("tr",tt,[i("td",et,[E(d(a.name)+" ",1),a.description?(_(),b("span",{key:0,title:a.description},[l(h,{class:"icon is-small"})],8,st)):v("",!0)]),l(m,{class:"short-name",entry:a},null,8,["entry"]),l(u,{class:"is-default",value:a.is_default},null,8,["value"]),l(u,{class:"is-wip",value:a.is_wip},null,8,["value"]),l(u,{class:"is-done",value:a.is_done},null,8,["value"]),l(u,{class:"is-retake",value:a.is_retake},null,8,["value"]),l(u,{class:"is-artist-allowed",value:a.is_artist_allowed},null,8,["value"]),l(u,{class:"is-client-allowed",value:a.is_client_allowed},null,8,["value"]),l(u,{class:"is-feedback-request",value:a.is_feedback_request},null,8,["value"]),l(k,{"hide-delete":a.is_default===!0||a.for_concept,onEditClicked:g=>t.$emit("edit-clicked",a),onDeleteClicked:g=>t.$emit("delete-clicked",a)},null,8,["hide-delete","onEditClicked","onDeleteClicked"])])]),_:1},8,["onEnd","modelValue"])])]),l(f,{"is-loading":n.isLoading,"is-error":n.isError},null,8,["is-loading","is-error"]),i("p",it,d(n.entries.length)+" "+d(t.$tc("task_status.number",n.entries.length)),1)])}const lt=y(M,[["render",at],["__scopeId","data-v-0ad95398"]]),ot={name:"task-status",components:{DeleteModal:q,EditTaskStatusModal:L,ListPageHeader:N,RouteTabs:x,TaskStatusList:lt},data(){return{activeTab:"active",entityTab:"entities",entityTabs:[{name:"entities",label:this.$t("entities.title")},{name:"concepts",label:this.$t("concepts.title")}],taskStatusToDelete:null,taskStatusToEdit:{color:"#000000"},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"entities"},computed:{...D(["archivedTaskStatus","taskStatus"]),isActiveTab(){return this.activeTab==="active"},activeTaskStatuses(){return this.isActiveTab?this.taskStatus:this.archivedTaskStatus},taskStatusList(){return this.activeTaskStatuses.filter(t=>!t.for_concept).sort((t,s)=>t.priority-s.priority)},conceptStatusList(){return this.activeTaskStatuses.filter(t=>t.for_concept).sort((t,s)=>t.priority-s.priority)}},methods:{...S(["deleteTaskStatus","updateTaskStatusPriority"]),async updatePriorities(t){for(const s of t)await this.updateTaskStatusPriority(s)},confirmEditTaskStatus(t){const s=!(this.taskStatusToEdit&&this.taskStatusToEdit.id);let n="newTaskStatus";s||(n="saveTaskStatus",t.id=this.taskStatusToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(n,t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(o=>{console.error(o),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteTaskStatus(){this.loading.del=!0,this.errors.del=!1,this.deleteTaskStatus(this.taskStatusToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(t=>{console.error(t),this.loading.del=!1,this.errors.del=!0})},deleteText(){const t=this.taskStatusToDelete;return t?this.$t("task_status.delete_text",{name:t.name}):""},onExportClicked(){const t=P.slugify(this.$t("task_status.title")),n=[[this.$t("main.type"),this.$t("task_status.fields.name"),this.$t("task_status.fields.short_name"),this.$t("task_status.fields.description"),this.$t("task_status.fields.color"),this.$t("task_status.fields.is_default"),this.$t("task_status.fields.is_wip"),this.$t("task_status.fields.is_done"),this.$t("task_status.fields.is_retake"),this.$t("task_status.fields.is_artist_allowed"),this.$t("task_status.fields.is_client_allowed"),this.$t("task_status.fields.is_feedback_request")]].concat(this.taskStatus.map(o=>[o.type,o.name,o.short_name,o.description,o.color,o.is_default,o.is_wip,o.is_done,o.is_retake,o.is_artist_allowed,o.is_client_allowed,o.is_feedback_request]));$.buildCsvFile(t,n)},onNewClicked(){this.taskStatusToEdit={color:"#000000"},this.modals.edit=!0},onEditClicked(t){this.taskStatusToEdit=t,this.modals.edit=!0},onDeleteClicked(t){this.taskStatusToDelete=t,this.modals.del=!0}},watch:{"$route.query"(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"entities"}},head(){return{title:`${this.$t("task_status.title")} - Kitsu`}}},rt={class:"task-status page fixed-page"},nt={class:"column"};function dt(t,s,n,o,e,r){const h=c("list-page-header"),m=c("route-tabs"),u=c("task-status-list"),k=c("edit-task-status-modal"),p=c("delete-modal");return _(),b("div",rt,[l(h,{title:t.$t("task_status.library_title"),"new-entry-label":t.$t("task_status.new_task_status"),"is-exportable":r.isActiveTab,onExportClicked:r.onExportClicked,onNewClicked:r.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),l(m,{class:"mt2","active-tab":e.activeTab,tabs:e.tabs},null,8,["active-tab","tabs"]),l(m,{"active-tab":e.entityTab,tabs:e.entityTabs,"route-key":"entity"},null,8,["active-tab","tabs"]),i("div",nt,[e.entityTab==="entities"?(_(),T(u,{key:0,entries:r.taskStatusList,"is-loading":e.loading.list,"is-error":e.errors.list,onEditClicked:r.onEditClicked,onDeleteClicked:r.onDeleteClicked,onUpdatePriorities:r.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"])):v("",!0),e.entityTab==="concepts"?(_(),T(u,{key:1,entries:r.conceptStatusList,"is-loading":e.loading.list,"is-error":e.errors.list,onEditClicked:r.onEditClicked,onDeleteClicked:r.onDeleteClicked,onUpdatePriorities:r.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"])):v("",!0)]),l(k,{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"task-status-to-edit":e.taskStatusToEdit,onCancel:s[0]||(s[0]=f=>e.modals.edit=!1),onConfirm:r.confirmEditTaskStatus},null,8,["active","is-loading","is-error","task-status-to-edit","onConfirm"]),l(p,{active:e.modals.del,"is-loading":e.loading.del,"is-error":e.errors.del,text:r.deleteText(),"error-text":t.$t("task_status.delete_error"),onCancel:s[1]||(s[1]=f=>e.modals.del=!1),onConfirm:r.confirmDeleteTaskStatus},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const Vt=y(ot,[["render",dt],["__scopeId","data-v-8fac3395"]]);export{Vt as default};
//# sourceMappingURL=TaskStatus-0lNZ_qPP.js.map
