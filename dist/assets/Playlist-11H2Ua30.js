import{_ as j,c as r,o as n,t as h,n as g,m as K,a as Z,bW as J,Q,u as $,S as tt,bX as et,bY as it,W as st,bZ as lt,b_ as at,L as nt,b as rt,B as dt,aA as ot,r as p,e as d,f as u,d as c,k as _,a8 as b,F as P,g as m,w as F,G as C,aj as M,b$ as ht,c0 as yt,aR as B,A,p as q,c1 as k,c2 as E,c3 as V,a3 as L,c4 as D,b7 as ct,c5 as ut,c6 as pt}from"./index-BsDo8rDw.js";const gt={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}};function _t(t,e,l,o,a,i){return n(),r("p",{class:g({error:!0,"has-text-right":l.alignRight,"is-hidden":l.hidden})},h(l.text),3)}const ft=j(gt,[["render",_t]]),Pt={name:"playlist",components:{BuildFilterModal:ot,ButtonSimple:dt,Combobox:rt,ComboboxTaskType:nt,ErrorText:ft,EditPlaylistModal:at,LightEntityThumbnail:lt,PageSubtitle:st,PlaylistPlayer:it,PlusIcon:et,SearchField:tt,Spinner:$,TaskTypeName:Q,XIcon:J},data(){return{currentPlaylist:{name:""},currentSort:"updated_at",currentEntitiesMap:{},currentEntitiesList:[],entityLoading:{},isAddingEntity:!1,isListToggled:!1,isMorePlaylists:!0,page:1,taskTypeId:"",sortedPlaylists:[],sortOptions:["updated_at","created_at","name"].map(t=>({label:t,value:t})),playlistToEdit:{name:`${A().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},previewFileMap:new Map,previewFileEntityMap:new Map,modals:{isBuildFilterDisplayed:!1,isEditDisplayed:!1},loading:{addPlaylist:!1,addDaily:!1,addEpisode:!1,addMovie:!1,addSequence:!1,addWeekly:!1,editPlaylist:!1,morePlaylists:!1,playlist:!1,playlists:!1,playlistsInit:!0},errors:{editPlaylist:!1,playlistLoading:!1},lockSystem:{isSilent:!1,operationCount:0}}},computed:{...Z(["assetSearchText","currentEpisode","currentProduction","displayedAssets","displayedAssetsByType","displayedSequences","displayedShots","displayedShotsBySequence","isAssetsLoading","isCurrentUserManager","isCurrentUserSupervisor","isShotsLoading","isTVShow","productionTaskTypes","playlistMap","playlists","playlistsPath","shotsByEpisode","shotSearchText","taskMap","taskStatusMap","taskTypeMap"]),isAdditionLoading(){return this.loading.addSequence||this.loading.addWeekly||this.loading.addDaily||this.loading.addEpisode},isAssetPlaylist(){return this.currentPlaylist.for_entity==="asset"},isSequencePlaylist(){return this.currentPlaylist.for_entity==="sequence"},currentEntityType(){return this.currentPlaylist.for_entity},isAddSearchVisible(){return this.isAssetPlaylist&&this.assetSearchText||!this.isAssetPlaylist&&this.shotSearchText},lastPlaylists(){return this.playlists},playlistPlayer(){return this.$refs["playlist-player"]},addEntitiesText(){return this.isAssetPlaylist?this.$t("playlists.add_assets"):this.isSequencePlaylist?this.$t("playlists.add_sequences"):this.$t("playlists.add_shots")},tvShowPageTitle(){const t=this.currentProduction?this.currentProduction.name:"";let e="";return this.currentEpisode&&(this.currentEpisode.id==="all"?e=this.$t("main.all"):this.currentEpisode.id==="main"?e=this.$t("main.main_pack"):e=this.currentEpisode.name),`${t} - ${e} | ${this.$t("playlists.title")} - Kitsu`},shortPageTitle(){return`${this.currentProduction?this.currentProduction.name:""} | ${this.$t("playlists.title")} - Kitsu`},taskTypeList(){return[{id:"",color:"#999",name:this.$t("news.all")}].concat([...this.productionTaskTypes])}},methods:{...K(["changePlaylistOrder","changePlaylistPreview","changePlaylistType","displayMoreAssets","displayMoreShots","editPlaylist","getPendingAssets","getPendingShots","loadEpisodes","loadMorePlaylists","loadPlaylist","loadPlaylists","loadEntityPreviewFiles","loadShots","loadAssets","newPlaylist","refreshPlaylist","removeEntityPreviewFromPlaylist","resetSequences","pushEntityToPlaylist","setAssetSearch","setSequenceSearch","setShotSearch","updatePreviewAnnotation"]),setSilent(){this.lockSystem.operationCount++,this.lockSystem.isSilent=!0},clearSilent(){setTimeout(()=>{this.lockSystem.operationCount--,this.lockSystem.operationCount<=0&&(this.lockSystem.isSilent=!1,this.lockSystem.operationCount=0)},2e3)},formatDate(t){return pt(t)},getPlaylistPath(t,e){return ut(this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,t,e)},playlistElementStyle(t){return this.isListToggled?void 0:{"border-left":`4px solid ${this.taskTypeMap.get(t.task_type_id)?.color||"transparent"}`}},getTaskStatus(t){let e=E.cache.shotMap.get(t.id);if(e||(e=L.cache.assetMap.get(t.id)),e||(e=D.cache.sequenceMap.get(t.id)),!e)return{};const l=t.validations.get(this.currentPlaylist.task_type_id);if(l){const o=this.taskMap.get(l);return o?this.taskStatusMap.get(o.task_status_id):{}}else return{}},async loadShotsData(){(this.displayedShots.length===0||this.displayedShots[0].project_id!==this.currentProduction.id||this.currentEpisode&&this.displayedShots[0].episode_id!==this.currentEpisode.id)&&(this.isTVShow&&this.currentEpisode&&(this.currentEpisode.id==="main"||this.currentEpisode.id==="all")||(this.isTVShow&&!this.currentEpisode&&await this.loadEpisodes(),await this.loadShots()))},loadAssetsData(){return this.isTVShow||this.displayedAssets.length===0?this.loadAssets():Promise.resolve()},loadPlaylistsData(t=!1){const e=()=>{this.setCurrentPlaylist(()=>((!this.currentPlaylist||!this.currentPlaylist.id)&&this.goFirstPlaylist(),Promise.resolve()))};return this.playlists.length===0||t?this.loadPlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(()=>e()).catch(l=>(console.error(l),this.errors.loadPlaylists=!0,Promise.reject(l))):e()},onPlaylistListScroll(t){if(this.$options.silentMore)return;const e=this.$refs.playlistList,l=e.scrollHeight-e.offsetHeight,o=t.target;l<o.scrollTop+20&&this.onLoadMoreClicked()},onLoadMoreClicked(){this.$options.silentMore=!0,this.page++,this.loading.morePlaylists=!0,this.loadMorePlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then(t=>{setTimeout(()=>{this.loading.morePlaylists=!1,this.$options.silentMore=!1},1e3),t.length<20&&(this.isMorePlaylists=!1)}).catch(t=>(console.error(t),this.$options.silentMore=!1,this.errors.loadPlaylists=!0,Promise.reject(t)))},rebuildCurrentEntities(){this.currentEntitiesMap={},this.currentEntitiesList=[];const t=[];this.previewFileMap=new Map,this.previewFileEntityMap=new Map,this.currentPlaylist&&this.currentPlaylist.shots&&this.currentPlaylist.shots.forEach(e=>{const l=this.convertEntityToPlaylistFormat(e);l&&(t.push(l),this.currentEntitiesMap[l.id]=l,this.previewFileEntityMap.set(e.preview_file_id,l),Object.values(l.preview_files).forEach(a=>{a.forEach(i=>{this.previewFileMap.set(i.id,i)})}))}),this.$nextTick(()=>{this.currentEntitiesList=t})},onAnnotationsRefreshed(t){const e=this.previewFileEntityMap.get(t.id),l=this.previewFileMap.get(t.id);e&&(e.preview_file_annotations=t.annotations),l&&(l.annotations=t.annotations)},convertEntityToPlaylistFormat(t){let e;if(!t)return null;if(this.isAssetPlaylist?e=L.cache.assetMap.get(t.id):this.isSequencePlaylist?(e=D.cache.sequenceMap.get(t.id),this.currentEpisode&&(e.episode_name=this.currentEpisode.name)):e=E.cache.shotMap.get(t.id),e){const l={id:t.id,name:e.name,parent_name:e.sequence_name||e.episode_name||e.asset_type_name,preview_files:t.preview_files,preview_file_id:t.preview_file_id||e.preview_file_id,preview_file_extension:t.preview_file_extension||e.preview_file_extension,preview_file_revision:t.preview_file_revision||e.preview_file_revision,preview_file_width:t.preview_file_width||e.preview_file_width,preview_file_height:t.preview_file_height||e.preview_file_height,preview_file_duration:t.preview_file_duration||e.preview_file_duration,preview_file_task_id:t.task_id||t.preview_file_task_id||e.preview_file_task_id,preview_file_annotations:t.preview_file_annotations||e.preview_file_annotations,preview_file_previews:t.preview_file_previews||e.preview_file_previews,preview_nb_frames:t.nb_frames||e.nb_frames||ct};return this.previewFileEntityMap.set(l.preview_file_id,l),(l.preview_file_previews||[]).forEach(a=>{this.previewFileMap.set(a.id,a)}),l}else return null},async setCurrentPlaylist(){const t=this.$route.params.playlist_id,e=this.playlistMap.get(t);if(e){this.loading.playlist=!0;const l=await this.loadPlaylist(e);this.currentPlaylist=B(l),this.rebuildCurrentEntities(),this.loading.playlist=!1}else this.currentPlaylist={name:""},this.currentShots={}},async addEntity(t,e){this.entityLoading[t.id]=!0;try{const l=await this.loadEntityPreviewFiles(t),o=await this.addToStorePlaylistAndSave(l,t,e);return await this.addToPlayerPlaylist(o,e),this.entityLoading[t.id]=!1,o}catch(l){return console.error(l),this.entityLoading[t.id]=!1,null}},addToStorePlaylistAndSave(t,e,l){return this.pushEntityToPlaylist({playlist:l,previewFiles:t,entity:{...e},entityMap:this.currentEntitiesMap})},addToPlayerPlaylist(t,e,l=!0){if(e.id!==this.playlistPlayer.playlist.id)return;const o=this.convertEntityToPlaylistFormat(t);o&&(this.currentEntitiesList.push(o),this.currentEntitiesMap[o.id]=o,l&&this.$nextTick(()=>{this.playlistPlayer?.scrollToRight()}))},addEntityToPlaylist(t){this.setSilent();const e=this.currentPlaylist;this.addEntity(t,e).then(()=>{this.clearSilent(),this.playlistPlayer.scrollToRight()})},onNewEntityDropped(t){let e;if(this.setSilent(),this.isAssetPlaylist?e=L.cache.assetMap.get(t.after):this.isSequencePlaylist?e=D.cache.sequenceMap.get(t.after):e=E.cache.shotMap.get(t.after),e&&!this.currentEntitiesMap[e.id]){const o=this.currentPlaylist;this.addEntity(e,o,!1).then(()=>{this.playlistPlayer.onEntityDropped(t),this.clearSilent()})}else this.clearSilent()},async removeEntity({entity:t,previewFileId:e}){this.setSilent(),this.currentEntitiesList=this.currentEntitiesList.filter(o=>o.id!==t.id||o.preview_file_id!==e),this.currentEntitiesList.find(o=>o.id===t.id)||(this.currentEntitiesMap[t.id]=void 0),await this.removeEntityPreviewFromPlaylist({playlist:this.currentPlaylist,entity:t,previewFileId:e}),this.clearSilent()},clearCurrentPlaylist(){this.currentPlaylist={},this.currentShots={}},resetPlaylist(){this.clearCurrentPlaylist(),this.setCurrentPlaylist()},addCurrentSelection(){this.setSilent();const t=this.isAssetPlaylist?this.displayedAssets:this.displayedShots;this.addEntities([...t].reverse(),()=>{this.clearSilent()})},addSequence(t){if(t.length>0){const e=t[0].sequence_id,l=Array.from(E.cache.shotMap.values()).filter(o=>o.sequence_id===e).sort(q.firstBy("name")).reverse();this.setSilent(),this.addEntities(l,()=>{this.clearSilent()})}},async addAllPending(){this.setSilent(),this.loading.addWeekly=!0;const t=this.isAssetPlaylist?this.getPendingAssets:this.getPendingShots,e=this.isAssetPlaylist?V:k;let l=await t(!1);l=e(l).reverse(),this.addEntities(l,()=>{this.loading.addWeekly=!1,this.clearSilent()})},async addDailyPending(){this.loading.addDaily=!0,this.setSilent();const t=this.isAssetPlaylist?this.getPendingAssets:this.getPendingShots,e=this.isAssetPlaylist?V:k;let l=await t(!0);l=e(l).reverse(),this.addEntities(l,()=>{this.loading.addDaily=!1,this.clearSilent()})},addEpisodePending(){this.loading.addEpisode=!0,this.setSilent();let t=[].concat(...this.shotsByEpisode);t=k(t).reverse(),this.addEntities(t,()=>{this.loading.addEpisode=!1,this.clearSilent()})},addMovie(){this.loading.addMovie=!0,this.setSilent();const t=k(Array.from(E.cache.shotMap.values()));this.addEntities(t.reverse(),()=>{this.loading.addMovie=!1,this.clearSilent()})},addEntities(t,e,l=void 0){if(l||(l=this.currentPlaylist),t&&t.length>0){const o=t.pop();this.addEntity(o,l).then(()=>{this.addEntities(t,e,l)})}else e()},async onPreviewChanged({entity:t,previewFileId:e,previousPreviewFileId:l}){this.setSilent(),await this.changePlaylistPreview({playlist:this.currentPlaylist,entity:t,previewFileId:e,previousPreviewFileId:l}),this.clearSilent()},onOrderChange(t){this.setSilent(),this.changePlaylistOrder({playlist:this.currentPlaylist,info:t}),this.clearSilent()},onAnnotationChanged({preview:t,additions:e,deletions:l,updates:o}){const a=t.task_id;this.updatePreviewAnnotation({taskId:a,preview:t,additions:e,deletions:l,updates:o})},confirmBuildFilter(t){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(t),this.onSearchChange(t)},onSearchChange(t){t.length>1?this.isAssetPlaylist?(this.setAssetSearch(t),this.displayMoreAssets()):this.isSequencePlaylist?(this.setSequenceSearch(t),this.resetSequences()):(this.setShotSearch(t),this.displayMoreShots()):this.isAssetPlaylist?this.setAssetSearch(""):this.isSequencePlaylist?this.setSequenceSearch(""):this.setShotSearch("")},onForClientChanged(t){this.editPlaylist({data:{id:this.currentPlaylist.id,for_client:t}})},runAddPlaylist(t){const e={name:t.name,production_id:this.currentProduction.id,for_client:t.for_client,for_entity:t.for_entity,is_for_all:t.is_for_all,task_type_id:t.task_type_id};this.isTVShow&&this.currentEpisode&&(e.episode_id=this.currentEpisode.id),this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.newPlaylist(e).then(l=>{this.$router.push(this.getPlaylistPath(l.id)),this.loading.editPlaylist=!1,this.modals.isEditDisplayed=!1}).catch(l=>{console.error(l),this.errors.editPlaylist=!0,this.loading.editPlaylist=!1})},confirmEditPlaylist(t){this.playlistToEdit.id?(this.setSilent(),t.id=this.currentPlaylist.id,this.runEditPlaylist(t).finally(()=>{this.clearSilent()})):this.runAddPlaylist(t)},async runEditPlaylist(t){this.loading.editPlaylist=!0,this.errors.editPlaylist=!1;try{const e=await this.editPlaylist({data:{id:t.id,for_client:t.for_client,for_entity:t.for_entity,name:t.name,task_type_id:t.task_type_id}});this.modals.isEditDisplayed=!1,Object.assign(this.currentPlaylist,e)}catch{this.errors.editPlaylist=!0}finally{this.loading.editPlaylist=!1}},goFirstPlaylist(){this.playlists.length>0?this.$router.push({name:"playlist",params:{production_id:this.currentProduction.id,playlist_id:this.playlists[0].id}}):this.$router.push(this.playlistsPath)},onEntityDragStart(t,e){t.dataTransfer.setData("entityId",e.id)},toggleAddEntities(){this.isAddingEntity&&this.resetPlaylist(),this.isAddingEntity=!this.isAddingEntity},async onTaskTypeChanged(t){this.setSilent("onTaskTypeChanged");try{await this.changePlaylistType({playlist:this.currentPlaylist,taskTypeId:t}),this.rebuildCurrentEntities()}catch(e){console.error(e)}finally{this.clearSilent()}},onBodyScroll(t){const e=t.target;this.$refs.entityListContent.scrollHeight-this.$refs.entityListContent.offsetHeight<e.scrollTop&&(this.isAssetPlaylist?this.displayMoreAssets():this.displayMoreShots())},resetSorting(){let t=1;["created_at","updated_at"].includes(this.currentSort)&&(t=-1),this.sortedPlaylists=[...this.playlists].sort(q.firstBy(this.currentSort,t).thenBy("name"))},showAddModal(){this.playlistToEdit={name:`${A().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},showEditModal(){this.playlistToEdit=this.currentPlaylist,this.errors.editPlaylist=!1,this.modals.isEditDisplayed=!0},hideEditModal(){this.playlistToEdit={name:`${A().format("YYYY-MM-DD HH:mm:ss")}`,for_client:!1},this.modals.isEditDisplayed=!1},async reloadAll(){this.loading.playlists||(this.loading.playlists=!0,await this.loadShotsData(),await this.loadAssetsData(),this.page=1,await this.loadPlaylistsData(),this.loading.playlists=!1,this.resetPlaylist(),setTimeout(()=>{this.loading.playlistsInit=!1},300))}},mounted(){this.$nextTick(()=>{this.reloadAll(),localStorage.getItem("playlist-sort")&&(this.currentSort=localStorage.getItem("playlist-sort")),this.resetSorting()})},watch:{$route(){this.setCurrentPlaylist()},currentPlaylist(){this.currentPlaylist.shots?(this.$options.silentMore=!1,this.isAddingEntity=Object.keys(this.currentPlaylist.shots).length===0):this.isAddingEntity=!0},currentProduction(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.reloadAll()},currentEpisode(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.currentEpisode&&this.reloadAll()},currentSort(){localStorage.setItem("playlist-sort",this.currentSort),this.loading.playlists=!0,this.page=1,this.loadPlaylistsData(!0).then(()=>{this.loading.playlists=!1})},isListToggled(){this.playlistPlayer?.onWindowResize()},taskTypeId(){this.loadPlaylistsData(!0)}},socket:{events:{"playlist:new"(t){this.playlistMap.get(t.playlist_id)||this.refreshPlaylist(t.playlist_id)},"playlist:update"(t){this.playlistMap.get(t.playlist_id)&&!this.lockSystem.isSilent&&!this.isAddingEntity&&this.refreshPlaylist(t.playlist_id).then(e=>{this.currentPlaylist=B(e),this.$nextTick(()=>{this.rebuildCurrentEntities()})})},"playlist:delete"(t){this.playlistMap.get(t.playlist_id)&&this.$store.commit("DELETE_PLAYLIST_END",{id:t.playlist_id})},"build-job:new"(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=[{id:t.build_job_id,created_at:t.created_at,status:"running",playlist_id:this.currentPlaylist.id}].concat(this.currentPlaylist.build_jobs))},"build-job:update"(t){t.playlist_id===this.currentPlaylist.id&&yt(this.currentPlaylist.build_jobs,{id:t.build_job_id,status:t.status})},"build-job:delete"(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=ht(this.currentPlaylist.build_jobs,{id:t.build_job_id}))}}},head(){return this.isTVShow?{title:this.tvShowPageTitle}:{title:this.shortPageTitle}}},mt={class:"playlists page fixed-page dark"},vt={class:"columns"},St={class:"flexrow top-section"},wt={key:1,class:"filler"},Et={class:"flexrow"},kt={key:1,class:"playlists"},Tt={key:0,class:"flexrow"},bt={class:"ml05"},Ct={class:"playlist-date"},Mt={key:1,class:"has-text-centered"},At={key:3,class:"pa1"},Lt={key:0,class:"playlist-column no-selection"},Dt={key:0,class:"flexcolumn xyz-in",xyz:"fade stagger"},xt={class:"has-text-centered"},Ft={class:"playlist-infos flexrow"},Bt={key:0},qt={key:1},Vt={key:1,class:"playlist-column no-selection has-text-centered"},jt={key:0},Nt={class:"empty-explaination"},Rt={key:2,class:"playlist-column column"},Ut={key:0},Yt={class:"addition-header"},Ht={class:"flexrow"},Ot={class:"flexrow"},It=["disabled"],Wt=["disabled"],zt=["disabled"],Gt=["disabled"],Xt=["disabled"],Kt={key:1,ref:"entityListContent"},Zt={key:0},Jt={key:0,class:"entity-group-title"},Qt={class:"addition-entities"},$t=["onDragstart","onClick"],te={key:0,class:"entity-loading-spinner"},ee={class:"playlisted-shot-name"},ie={key:1},se={class:"addition-entities"},le=["onDragstart","onClick"],ae={key:0,class:"entity-loading-spinner"},ne=["title"],re={class:"playlisted-shot-name"},de={key:2},oe={key:0,class:"entity-group-title"},he=["onClick"],ye={class:"addition-entities"},ce=["onDragstart","onClick"],ue={key:0,class:"entity-loading-spinner"},pe=["title"],ge={class:"playlisted-shot-name"};function _e(t,e,l,o,a,i){const N=p("combobox-task-type"),T=p("button-simple"),R=p("combobox"),U=p("plus-icon"),v=p("light-entity-thumbnail"),x=p("router-link"),f=p("spinner"),Y=p("error-text"),H=p("task-type-name"),O=p("playlist-player"),I=p("page-subtitle"),W=p("x-icon"),z=p("search-field"),G=p("edit-playlist-modal"),X=p("build-filter-modal");return n(),r("div",mt,[d("div",vt,[d("div",{ref:"playlistList",class:g({"playlist-list-column":!0,column:!0,toggled:a.isListToggled}),onScrollPassive:e[4]||(e[4]=(...s)=>i.onPlaylistListScroll&&i.onPlaylistListScroll(...s))},[d("div",St,[a.isListToggled?c("",!0):(n(),_(N,{key:0,class:"flexrow-item selector mb1","task-type-list":i.taskTypeList,label:t.$t("playlists.filter_task_type"),thin:!0,modelValue:a.taskTypeId,"onUpdate:modelValue":e[0]||(e[0]=s=>a.taskTypeId=s)},null,8,["task-type-list","label","modelValue"])),a.isListToggled?c("",!0):(n(),r("span",wt)),u(T,{class:"flexrow-item",style:{flex:"0"},icon:a.isListToggled?"right":"left","is-small":"",onClick:e[1]||(e[1]=s=>a.isListToggled=!a.isListToggled)},null,8,["icon"])]),d("div",Et,[a.isListToggled?c("",!0):(n(),_(R,{key:0,class:"flexrow-item mb2",label:t.$t("main.sorted_by"),options:a.sortOptions,"locale-key-prefix":"playlists.fields.",modelValue:a.currentSort,"onUpdate:modelValue":e[2]||(e[2]=s=>a.currentSort=s)},null,8,["label","options","modelValue"]))]),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&!a.isListToggled?(n(),r("button",{class:g({button:!0,"is-loading":a.loading.addPlaylist}),onClick:e[3]||(e[3]=(...s)=>i.showAddModal&&i.showAddModal(...s)),key:"new-playlist-button"},[u(U,{class:"icon is-small"}),b(" "+h(t.$t("playlists.new_playlist")),1)],2)):c("",!0),a.loading.playlists?(n(),_(f,{key:2,class:"mt2"})):(n(),r("div",kt,[(n(!0),r(P,null,m(t.playlists,s=>(n(),_(x,{key:s.id,to:i.getPlaylistPath(s.id),class:g({"playlist-item":!0,"for-client":s.for_client||!1,selected:s.id===a.currentPlaylist.id})},{default:F(()=>[d("div",{class:"playlist-item-content",style:C(i.playlistElementStyle(s))},[a.isListToggled?(n(),r("div",Mt,[s.first_preview_file_id?(n(),_(v,{key:0,"preview-file-id":s.first_preview_file_id,type:"previews",width:"38px",height:"30px","max-width":"38px","max-height":"30px","empty-width":"38px","empty-height":"30px",title:s.name},null,8,["preview-file-id","title"])):c("",!0)])):(n(),r("div",Tt,[u(v,{class:"playlist-thumbnail","preview-file-id":s.first_preview_file_id,type:"previews",width:"53px",height:"35px","max-width":"53px","max-height":"35px","empty-width":"53px","empty-height":"35px",title:s.name},null,8,["preview-file-id","title"]),d("div",bt,[b(h(s.name)+" ",1),d("span",Ct,h(t.$t("playlists.updated_at"))+" "+h(i.formatDate(s.updated_at)),1)])]))],4)]),_:2},1032,["to","class"]))),128))])),t.playlists.length>=20&&!a.loading.playlists&&a.isMorePlaylists?(n(),r("div",At,[u(T,{class:g({button:!0,"is-loading":a.loading.morePlaylists}),text:t.$t("main.load_more"),onClick:i.onLoadMoreClicked},null,8,["class","text","onClick"])])):c("",!0),a.errors.playlistLoading?(n(),_(Y,{key:4,text:t.$t("playlists.loading_error")},null,8,["text"])):c("",!0)],34),t.playlists.length>0&&!a.currentPlaylist.id&&!a.loading.playlist?(n(),r("div",Lt,[!a.loading.playlists&&!a.loading.playlistsInit?(n(),r("div",Dt,[(n(!0),r(P,null,m(i.lastPlaylists,s=>(n(),_(x,{class:"recent-playlist flexrow-item flexrow",key:"recent-playlist-"+s.id,to:i.getPlaylistPath(s.id)},{default:F(()=>[d("div",xt,[u(v,{class:"playlist-thumbnail","preview-file-id":s.first_preview_file_id,type:"previews",width:"auto",height:"auto","empty-height":"252px"},null,8,["preview-file-id"])]),d("div",Ft,[d("div",null,[d("h3",null,h(s.name),1),a.currentSort==="created_at"?(n(),r("span",Bt,h(t.$t("playlists.created_at"))+" "+h(i.formatDate(s.created_at)),1)):(n(),r("span",qt,h(t.$t("playlists.updated_at"))+" "+h(i.formatDate(s.updated_at)),1))]),e[15]||(e[15]=d("span",{class:"filler"},null,-1)),d("div",null,[s.task_type_id?(n(),_(H,{key:0,"task-type":t.taskTypeMap.get(s.task_type_id)},null,8,["task-type"])):c("",!0)])])]),_:2},1032,["to"]))),128))])):(n(),_(f,{key:1,class:"mt2"}))])):t.playlists.length===0?(n(),r("div",Vt,[!a.loading.playlists&&!a.loading.playlistsInit?(n(),r("div",jt,[d("p",Nt,h(t.$t("playlists.no_playlist")),1),t.isCurrentUserManager||t.isCurrentUserSupervisor?(n(),r("button",{class:g({big:!0,button:!0,"is-loading":a.loading.addPlaylist}),onClick:e[5]||(e[5]=(...s)=>i.showAddModal&&i.showAddModal(...s)),key:"new-playlist-button"},h(t.$t("playlists.new_playlist")),3)):c("",!0)])):(n(),_(f,{key:1,class:"mt2"}))])):(n(),r("div",Rt,[u(O,{ref:"playlist-player",playlist:a.currentPlaylist,entities:a.currentEntitiesList,"is-loading":a.loading.playlist,"is-adding-entity":a.isAddingEntity,"current-entity-type":i.currentEntityType,onEditClicked:i.showEditModal,onShowAddEntities:i.toggleAddEntities,onPreviewChanged:i.onPreviewChanged,onTaskTypeChanged:i.onTaskTypeChanged,onPlaylistDeleted:i.goFirstPlaylist,onRemoveEntity:i.removeEntity,onOrderChange:i.onOrderChange,onAnnotationChanged:i.onAnnotationChanged,onForClientChanged:i.onForClientChanged,onAnnotationsRefreshed:i.onAnnotationsRefreshed,onNewEntityDropped:i.onNewEntityDropped},null,8,["playlist","entities","is-loading","is-adding-entity","current-entity-type","onEditClicked","onShowAddEntities","onPreviewChanged","onTaskTypeChanged","onPlaylistDeleted","onRemoveEntity","onOrderChange","onAnnotationChanged","onForClientChanged","onAnnotationsRefreshed","onNewEntityDropped"]),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&a.isAddingEntity&&!a.loading.playlist?(n(),r("div",Ut,[d("div",Yt,[d("div",Ht,[u(I,{class:"flexrow-item",text:i.addEntitiesText},null,8,["text"]),e[16]||(e[16]=d("span",{class:"filler"},null,-1)),d("a",{class:"close-button",onClick:e[6]||(e[6]=(...s)=>i.toggleAddEntities&&i.toggleAddEntities(...s))},[u(W)])]),d("div",Ot,[u(z,{class:"flexrow-item",ref:"search-field","can-save":!1,onChange:i.onSearchChange,placeholder:i.isAssetPlaylist?"chars mode=wfa":"ex: seq01 anim=wfa"},null,8,["onChange","placeholder"]),u(T,{class:"flexrow-item",title:t.$t("entities.build_filter.title"),icon:"filter",onClick:e[7]||(e[7]=s=>a.modals.isBuildFilterDisplayed=!0)},null,8,["title"]),i.isAddSearchVisible?(n(),r("button",{key:0,class:g({button:!0,"flexrow-item":!0,"add-sequence":!0}),disabled:i.isAdditionLoading,onClick:e[8]||(e[8]=(...s)=>i.addCurrentSelection&&i.addCurrentSelection(...s))},h(t.$t("playlists.add_selection")),9,It)):c("",!0),e[17]||(e[17]=d("span",{class:"filler"},null,-1)),d("button",{class:g({button:!0,"add-sequence":!0,"is-loading":a.loading.addDaily}),disabled:i.isAdditionLoading,onClick:e[9]||(e[9]=(...s)=>i.addDailyPending&&i.addDailyPending(...s))},h(t.$t("playlists.build_daily")),11,Wt),d("button",{class:g({button:!0,"add-sequence":!0,"is-loading":a.loading.addDaily}),disabled:i.isAdditionLoading,onClick:e[10]||(e[10]=(...s)=>i.addAllPending&&i.addAllPending(...s))},h(t.$t("playlists.build_weekly")),11,zt),t.isTVShow&&!i.isAssetPlaylist&&!i.isSequencePlaylist?(n(),r("button",{key:1,class:g({button:!0,"add-sequence":!0,"is-loading":a.loading.addEpisode}),disabled:i.isAdditionLoading,onClick:e[11]||(e[11]=(...s)=>i.addEpisodePending&&i.addEpisodePending(...s))},h(t.$t("playlists.add_episode")),11,Gt)):i.isAssetPlaylist?c("",!0):(n(),r("button",{key:2,class:g({button:!0,"add-sequence":!0,"is-loading":a.loading.addMovie}),disabled:i.isAdditionLoading,onClick:e[12]||(e[12]=(...s)=>i.addMovie&&i.addMovie(...s))},h(t.$t("playlists.add_movie")),11,Xt))])])])):c("",!0),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&a.isAddingEntity?(n(),r("div",{key:1,class:"addition-section",onScrollPassive:e[13]||(e[13]=(...s)=>i.onBodyScroll&&i.onBodyScroll(...s))},[t.isShotsLoading||t.isAssetsLoading?(n(),_(f,{class:"mt2",key:"entity-loader"})):(n(),r("div",Kt,[i.isAssetPlaylist?(n(),r("div",Zt,[(n(!0),r(P,null,m(t.displayedAssetsByType,(s,S)=>(n(),r("div",{key:"asset-type-"+S},[s.length>0?(n(),r("h2",Jt,h(s[0].asset_type_name),1)):c("",!0),d("div",Qt,[(n(!0),r(P,null,m(s.filter(y=>!y.canceled),y=>(n(),r("div",{key:y.id,class:g({"addition-shot":!0,playlisted:a.currentEntitiesMap[y.id]!==void 0}),draggable:"true",onDragstart:w=>i.onEntityDragStart(w,y),onClick:M(w=>i.addEntityToPlaylist(y),["prevent"])},[a.entityLoading[y.id]?(n(),r("div",te,[u(f)])):c("",!0),u(v,{"preview-file-id":y.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("span",ee,h(y.name),1)],42,$t))),128))])]))),128))])):i.isSequencePlaylist?(n(),r("div",ie,[d("div",se,[(n(!0),r(P,null,m(t.displayedSequences.filter(s=>!s.canceled),s=>(n(),r("div",{key:s.id,class:g({"addition-shot":!0,playlisted:t.currentEntities[s.id]!==void 0}),draggable:"true",onDragstart:S=>i.onEntityDragStart(S,s),onClick:M(S=>i.addEntityToPlaylist(s),["prevent"])},[a.entityLoading[s.id]?(n(),r("div",ae,[u(f)])):c("",!0),u(v,{"preview-file-id":s.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("div",null,[a.currentPlaylist.task_type_id?(n(),r("span",{key:0,title:i.getTaskStatus(s).name,style:C({color:i.getTaskStatus(s).color})}," • ",12,ne)):c("",!0),d("span",re,h(s.name),1)])],42,le))),128))])])):(n(),r("div",de,[(n(!0),r(P,null,m(t.displayedShotsBySequence,(s,S)=>(n(),r("div",{key:"sequence-"+S},[s.length>0?(n(),r("h2",oe,[b(h(s[0].sequence_name)+" ",1),t.isCurrentUserManager||t.isCurrentUserSupervisor?(n(),r("button",{class:"button",onClick:y=>i.addSequence(s),key:"add-sequence-button-"+s[0].sequence_id},h(t.$t("playlists.add_sequence")),9,he)):c("",!0)])):c("",!0),d("div",ye,[(n(!0),r(P,null,m(s.filter(y=>!y.canceled),y=>(n(),r("div",{key:y.id},[d("div",{class:g({"addition-shot":!0,playlisted:a.currentEntitiesMap[y.id]!==void 0}),draggable:"true",onDragstart:w=>i.onEntityDragStart(w,y),onClick:M(w=>i.addEntityToPlaylist(y),["prevent"])},[a.entityLoading[y.id]?(n(),r("div",ue,[u(f)])):c("",!0),u(v,{"preview-file-id":y.preview_file_id,width:"150px",height:"100px"},null,8,["preview-file-id"]),d("div",null,[a.currentPlaylist.task_type_id?(n(),r("span",{key:0,title:i.getTaskStatus(y).name,style:C({color:i.getTaskStatus(y).color})}," • ",12,pe)):c("",!0),d("span",ge,h(y.name),1)])],42,ce)]))),128))])]))),128))]))],512))],32)):c("",!0)]))]),u(G,{ref:"edit-playlist-modal",active:a.modals.isEditDisplayed,"is-loading":a.loading.editPlaylist,"is-error":a.errors.editPlaylist,"playlist-to-edit":a.playlistToEdit,"task-type-id":a.taskTypeId,onCancel:i.hideEditModal,onConfirm:i.confirmEditPlaylist},null,8,["active","is-loading","is-error","playlist-to-edit","task-type-id","onCancel","onConfirm"]),u(X,{ref:"build-filter-modal",active:a.modals.isBuildFilterDisplayed,"entity-type":i.currentEntityType,onConfirm:i.confirmBuildFilter,onCancel:e[14]||(e[14]=s=>a.modals.isBuildFilterDisplayed=!1)},null,8,["active","entity-type","onConfirm"])])}const Pe=j(Pt,[["render",_e],["__scopeId","data-v-13fb310e"]]);export{Pe as default};
//# sourceMappingURL=Playlist-11H2Ua30.js.map
