import{_ as V,U as B,M as z,b as U,r as d,q as I,o as s,c as n,d as h,t as f,I as _,k as D,f as m,g as y,h as u,H as S,n as k,bD as H,W,a as J,p as P,F as q,e as M,i as p,w}from"./index-DF-DoQlt.js";import{s as R}from"./string-B0Tq569e.js";import{C as K}from"./ConfirmModal-BIIMruUl.js";import{B as Q}from"./BooleanField-r8LThAuD.js";import{C as X}from"./Combobox-A6pnhVs3.js";import{C as A}from"./ComboboxDepartment-Cjj8YvK6.js";import{M as L}from"./ModalFooter-Chk0SGv-.js";import{T as N}from"./TextField-BKWlN2Ov.js";import{C as Y}from"./ColorField-ByrVYH4e.js";import{T as Z,P as $,F as ee}from"./trash-2-Clb81WsB.js";import{C as re}from"./chevron-up-C5NMcayJ.js";const oe={name:"edit-search-filter-modal",mixins:[z],components:{BooleanField:Q,Combobox:X,ComboboxDepartment:A,ModalFooter:L,PeopleName:B,TextField:N},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isGroupEnabled:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},searchQueryToEdit:{type:Object,default:()=>{}},groupOptions:{type:Array,default:()=>[]}},emits:["cancel","confirm"],data(){return{form:{id:null,name:"",search_filter_group_id:null,search_query:"",is_shared:"false"}}},computed:{...U(["currentProduction","isCurrentUserManager","personMap"]),allowedGroups(){return this.groupOptions.filter(e=>e.is_shared===(this.form.is_shared==="true")||e.value===null)}},methods:{runConfirmation(e){if(!this.form.name.length){this.$refs.nameField.focus();return}if(!e||e.keyCode===13||!e.keyCode){const r={id:this.searchQueryToEdit.id,...this.form,is_shared:this.form.is_shared==="true"};this.$emit("confirm",r)}}},watch:{searchQueryToEdit(){this.searchQueryToEdit?.id?this.form={id:this.searchQueryToEdit.id,name:this.searchQueryToEdit.name,search_filter_group_id:this.searchQueryToEdit.search_filter_group_id,search_query:this.searchQueryToEdit.search_query,is_shared:this.searchQueryToEdit.is_shared?"true":"false",department_id:this.searchQueryToEdit.department_id}:this.form={id:null,name:"",search_filter_group_id:null,search_query:"",is_shared:"false",department_id:null}},active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)}}},te={class:"modal-content"},ie={class:"box"},se={class:"title"},ne={key:0,class:"mt2"};function le(e,r,a,G,o,i){const C=d("text-field"),E=d("boolean-field"),T=d("combobox-department"),F=d("combobox"),g=d("people-name"),v=d("modal-footer"),b=I("focus");return s(),n("div",{class:k({modal:!0,"is-active":a.active})},[h("div",{class:"modal-background",onClick:r[0]||(r[0]=l=>e.$emit("cancel"))}),h("div",te,[h("div",ie,[h("h1",se,f(e.$t("main.search_query_edit")),1),h("form",{onSubmit:r[7]||(r[7]=_(()=>{},["prevent"]))},[D(m(C,{ref:"nameField",label:e.$t("assets.fields.name"),modelValue:o.form.name,"onUpdate:modelValue":r[1]||(r[1]=l=>o.form.name=l),modelModifiers:{trim:!0},onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),[[b]]),m(C,{label:e.$t("main.search_query"),modelValue:o.form.search_query,"onUpdate:modelValue":r[2]||(r[2]=l=>o.form.search_query=l),modelModifiers:{trim:!0},onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),e.isCurrentUserManager&&e.currentProduction?(s(),y(E,{key:0,label:e.$t("main.is_shared"),modelValue:o.form.is_shared,"onUpdate:modelValue":r[3]||(r[3]=l=>o.form.is_shared=l),onClick:r[4]||(r[4]=l=>o.form.search_filter_group_id=null)},null,8,["label","modelValue"])):u("",!0),o.form.is_shared==="true"?(s(),y(T,{key:1,class:"mt2",label:e.$t("main.department"),top:!0,modelValue:o.form.department_id,"onUpdate:modelValue":r[5]||(r[5]=l=>o.form.department_id=l)},null,8,["label","modelValue"])):u("",!0),a.isGroupEnabled&&i.allowedGroups.length>1?(s(),y(F,{key:2,class:"mt2",label:e.$t("main.filter_group"),options:i.allowedGroups,modelValue:o.form.search_filter_group_id,"onUpdate:modelValue":r[6]||(r[6]=l=>o.form.search_filter_group_id=l)},null,8,["label","options","modelValue"])):u("",!0)],32),a.searchQueryToEdit?.id?(s(),n("div",ne,[S(f(e.$t("main.created_by"))+": ",1),m(g,{person:e.personMap.get(a.searchQueryToEdit.person_id)},null,8,["person"])])):u("",!0),m(v,{"error-text":e.$t("main.search_query_edit_error"),"is-error":a.isError,"is-loading":a.isLoading,onConfirm:i.runConfirmation,onCancel:r[8]||(r[8]=l=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const ae=V(oe,[["render",le]]),de={name:"edit-search-filter-group-modal",mixins:[z],components:{BooleanField:Q,ColorField:Y,ComboboxDepartment:A,ModalFooter:L,PeopleName:B,TextField:N},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},groupToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{color:"",name:"",is_shared:"false"}}},computed:{...U(["currentProduction","isCurrentUserManager","personMap"])},methods:{runConfirmation(e){if(!this.form.name.length){this.$refs.nameField.focus();return}if(!e||e.keyCode===13||!e.keyCode){const r={...this.form,is_shared:this.form.is_shared==="true"};this.$emit("confirm",r)}}},watch:{groupToEdit(){const{id:e,color:r="",name:a="",is_shared:G=!1,department_id:o=null}=this.groupToEdit?.id?this.groupToEdit:{};this.form={id:e,color:r,name:a,is_shared:G?"true":"false",department_id:o}},active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)}}},me={class:"modal-content"},ue={class:"box"},ce={key:0,class:"title"},he={key:1,class:"title"},fe={key:2,class:"mt2"};function pe(e,r,a,G,o,i){const C=d("text-field"),E=d("color-field"),T=d("boolean-field"),F=d("combobox-department"),g=d("people-name"),v=d("modal-footer"),b=I("focus");return s(),n("div",{class:k({modal:!0,"is-active":a.active})},[h("div",{class:"modal-background",onClick:r[0]||(r[0]=l=>e.$emit("cancel"))}),h("div",me,[h("div",ue,[a.groupToEdit.id?(s(),n("h1",ce,f(e.$t("main.filter_group_edit"))+' "'+f(a.groupToEdit.name)+'" ',1)):(s(),n("h1",he,f(e.$t("main.filter_group_add")),1)),h("form",{onSubmit:r[5]||(r[5]=_(()=>{},["prevent"]))},[D(m(C,{ref:"nameField",label:e.$t("assets.fields.name"),modelValue:o.form.name,"onUpdate:modelValue":r[1]||(r[1]=l=>o.form.name=l),modelModifiers:{trim:!0},onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),[[b]]),m(E,{label:e.$t("main.color"),modelValue:o.form.color,"onUpdate:modelValue":r[2]||(r[2]=l=>o.form.color=l)},null,8,["label","modelValue"]),e.isCurrentUserManager&&e.currentProduction?(s(),y(T,{key:0,class:"mt1",label:e.$t("main.is_shared"),modelValue:o.form.is_shared,"onUpdate:modelValue":r[3]||(r[3]=l=>o.form.is_shared=l)},null,8,["label","modelValue"])):u("",!0),o.form.is_shared==="true"?(s(),y(F,{key:1,class:"mt2",label:e.$t("main.department"),modelValue:o.form.department_id,"onUpdate:modelValue":r[4]||(r[4]=l=>o.form.department_id=l),top:!0},null,8,["label","modelValue"])):u("",!0)],32),a.groupToEdit?.id?(s(),n("div",fe,[S(f(e.$t("main.created_by"))+": ",1),m(g,{person:e.personMap.get(a.groupToEdit.person_id)},null,8,["person"])])):u("",!0),m(v,{"error-text":e.$t("main.filter_group_error"),"is-error":a.isError,"is-loading":a.isLoading,onConfirm:i.runConfirmation,onCancel:r[6]||(r[6]=l=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const _e=V(de,[["render",pe]]),ge={name:"search-query-list",components:{ChevronDownIcon:W,ChevronUpIcon:re,ConfirmModal:K,Edit2Icon:H,EditSearchFilterModal:ae,EditSearchFilterGroupModal:_e,FolderPlusIcon:ee,PencilIcon:$,Trash2Icon:Z},props:{queries:{type:Array,default:()=>[]},groups:{type:Array,default:()=>[]},isGroupEnabled:{type:Boolean,default:!1},type:{type:String,required:!0}},emits:["change-search","remove-search"],data(){return{groupToEdit:{},groupToRemove:{},isEditing:!1,queryPaths:{},searchQueryToEdit:{},searchQueryToRemove:{},errors:{edit:!1,group:!1,remove:!1},loading:{edit:!1,group:!1,remove:!1},modals:{edit:!1,group:!1,remove:!1},toggleGroupId:null}},mounted(){this.$nextTick(()=>{this.setQueryPaths()})},computed:{...U(["currentProduction","departmentMap","isCurrentUserClient","isCurrentUserManager","personMap"]),sortedFilters(){const e=this.queries.filter(r=>!this.isCurrentUserClient||this.isCurrentUserClient&&!r.is_shared);return P(e)},userFilters(){return this.sortedFilters.filter(e=>!e.search_filter_group_id).sort((e,r)=>e.is_shared&&!r.is_shared?-1:!e.is_shared&&r.is_shared?1:0)},userFilterGroups(){const e=this.groups.filter(r=>!this.isCurrentUserClient||this.isCurrentUserClient&&!r.is_shared);return P(e).map(r=>({...r,queries:this.sortedFilters.filter(a=>a.search_filter_group_id===r.id)}))},groupOptions(){return[{label:"",value:null},...this.userFilterGroups.map(e=>({label:e.name,value:e.id,is_shared:e.is_shared}))]},removeText(){return this.searchQueryToRemove.id?this.$t("main.remove_search_query",{name:this.searchQueryToRemove.name}):this.$t("main.remove_search_filter_group",{name:this.groupToRemove.name})}},methods:{...J(["removeAssetSearchFilterGroup","removeBreakdownSearchFilterGroup","removeShotSearchFilterGroup","saveAssetSearchFilterGroup","saveBreakdownSearchFilterGroup","saveShotSearchFilterGroup","updateSearchFilter","updateSearchFilterGroup"]),setQueryPaths(){this.queries.forEach(e=>{this.queryPaths[e.id]=this.queryRoute(e)})},queryRoute(e){const r=this.$route;return{...r,query:{...r.query,search:e.search_query}}},changeSearch(e){this.$emit("change-search",e)},editGroup(e={}){this.groupToEdit=e,this.modals.group=!0},editSearch(e){this.searchQueryToEdit=e,this.modals.edit=!0},async confirmEditFilterGroup(e){try{this.loading.group=!0,this.errors.group=!1,e.project_id=this.currentProduction?this.currentProduction.id:null,e.id?await this.updateSearchFilterGroup(e):await this[`save${R.capitalize(this.type)}SearchFilterGroup`](e),this.modals.group=!1}catch(r){console.error(r),this.errors.group=!0}finally{this.loading.group=!1}},async confirmEditSearch(e){try{this.loading.edit=!0,this.errors.edit=!1,e.project_id=this.currentProduction?this.currentProduction.id:null,await this.updateSearchFilter(e),this.modals.edit=!1}catch(r){console.error(r),this.errors.edit=!0}finally{this.loading.edit=!1}},closeFilterGroupModal(){this.modals.group=!1},confirmRemoveSearch(e){this.searchQueryToRemove=e,this.groupToRemove={},this.modals.remove=!0},removeSearch(){this.searchQueryToRemove.id?this.$emit("remove-search",this.searchQueryToRemove):this.removeGroup(),this.modals.remove=!1,this.searchQueryToRemove={},this.groupToRemove={}},confirmRemoveGroup(e){this.groupToRemove=e,this.searchQueryToRemove={},this.modals.remove=!0},async removeGroup(){try{await this[`remove${R.capitalize(this.type)}SearchFilterGroup`](this.groupToRemove),this.modals.remove=!1}catch(e){console.error(e),this.errors.remove=!0}finally{this.loading.remove=!1}},toggleFilterGroup(e){this.toggleGroupId=this.toggleGroupId!==e.id?e.id:null},getSearchQueryTitle(e){if(!e.is_shared)return;const r=this.personMap.get(e.person_id);return this.$t("main.shared_by",{name:r?.full_name})},getDepartment(e){return this.departmentMap.get(e.department_id)}},watch:{"queries.length"(){this.$nextTick(()=>{this.setQueryPaths()})},$route(){this.setQueryPaths()}}},ve={class:"search-queries"},ye=["title"],Ce=["title"],be=["onClick"],ke={class:"group-header"},Ee=["title"],Te=["onClick"],Fe=["onClick"],Ge={key:0,class:"tag empty"},Se=["title"],qe=["onClick"],Me=["onClick"],Ve=["title"],Ue=["title"],Pe=["onClick"],we=["onClick"];function Re(e,r,a,G,o,i){const C=d("folder-plus-icon"),E=d("pencil-icon"),T=d("chevron-down-icon"),F=d("chevron-up-icon"),g=d("edit2-icon"),v=d("trash2-icon"),b=d("router-link"),l=d("confirm-modal"),O=d("edit-search-filter-modal"),j=d("edit-search-filter-group-modal");return s(),n("div",ve,[a.isGroupEnabled?(s(),n("span",{key:0,class:"tag folder mr1",onClick:r[0]||(r[0]=t=>i.editGroup()),title:e.$t("main.filter_group_add")},[m(C,{size:12})],8,ye)):u("",!0),i.userFilters.length>0||a.isGroupEnabled&&i.userFilterGroups.length>0?(s(),n("span",{key:1,class:k(["tag folder mr1",{active:o.isEditing}]),onClick:r[1]||(r[1]=t=>o.isEditing=!o.isEditing),title:e.$t("main.edit_mode_on")},[m(E,{size:12})],10,Ce)):u("",!0),a.isGroupEnabled?(s(!0),n(q,{key:2},M(i.userFilterGroups,t=>(s(),n("span",{class:k(["tag group",{open:o.toggleGroupId===t.id,"is-shared":t.is_shared,"is-editing":o.isEditing}]),key:`group-${t.id}`,style:p({backgroundColor:`${t.color}23`}),onClick:c=>i.toggleFilterGroup(t)},[h("div",ke,[t.is_shared&&t.department_id?(s(),n("span",{key:0,class:"dot",style:p({borderColor:i.getDepartment(t).color}),title:i.getDepartment(t).name},null,12,Ee)):u("",!0),h("span",null,f(t.name),1),o.toggleGroupId!==t.id?(s(),y(T,{key:1,class:"chevron ml05",size:12})):(s(),y(F,{key:2,class:"chevron ml05",size:12})),!t.is_shared||e.isCurrentUserManager?(s(),n("button",{key:3,class:"edit",style:p({backgroundColor:`${t.color}53`}),onClick:_(c=>i.editGroup(t),["stop"])},[m(g,{size:8})],12,Te)):u("",!0),!t.queries.length&&(!t.is_shared||e.isCurrentUserManager)?(s(),n("button",{key:4,class:"del",style:p({backgroundColor:`${t.color}53`}),onClick:_(c=>i.confirmRemoveGroup(t),["stop"])},[m(v,{size:8})],12,Fe)):u("",!0)]),o.toggleGroupId===t.id?(s(),n("div",{key:0,ref_for:!0,ref:`group-${t.id}`,class:"group-list"},[t.queries.length?(s(!0),n(q,{key:1},M(t.queries,c=>(s(),n("div",{class:k(["tag",{"is-shared":c.is_shared,"is-editing":o.isEditing}]),key:c.id,style:p({backgroundColor:`${t.color}23`}),title:i.getSearchQueryTitle(c)},[m(b,{class:"flexrow filter-name",to:o.queryPaths[c.id]||{name:"open-productions"}},{default:w(()=>[S(f(c.name),1)]),_:2},1032,["to"]),!c.is_shared||e.isCurrentUserManager?(s(),n("button",{key:0,class:"edit",style:p({backgroundColor:`${t.color}53`}),onClick:_(x=>i.editSearch(c),["stop"])},[m(g,{size:8})],12,qe)):u("",!0),!c.is_shared||e.isCurrentUserManager?(s(),n("button",{key:1,class:"del",style:p({backgroundColor:`${t.color}53`}),onClick:_(x=>i.confirmRemoveSearch(c),["stop"])},[m(v,{size:8})],12,Me)):u("",!0)],14,Se))),128)):(s(),n("span",Ge,[h("em",null,f(e.$t("main.filter_group_empty")),1)]))],512)):u("",!0)],14,be))),128)):u("",!0),(s(!0),n(q,null,M(i.userFilters,t=>(s(),n("span",{class:k(["tag",{"is-shared":t.is_shared,"is-editing":o.isEditing}]),key:t.id,title:i.getSearchQueryTitle(t)},[m(b,{class:"flexrow filter-name",to:o.queryPaths[t.id]||{name:"open-productions"}},{default:w(()=>[t.is_shared&&t.department_id?(s(),n("span",{key:0,class:"dot",style:p({borderColor:i.getDepartment(t).color}),title:i.getDepartment(t).name},null,12,Ue)):u("",!0),S(" "+f(t.name),1)]),_:2},1032,["to"]),!t.is_shared||e.isCurrentUserManager?(s(),n("button",{key:0,class:"edit",onClick:_(c=>i.editSearch(t),["stop"])},[m(g,{size:8})],8,Pe)):u("",!0),!t.is_shared||e.isCurrentUserManager?(s(),n("button",{key:1,class:"del",onClick:_(c=>i.confirmRemoveSearch(t),["stop"])},[m(v,{size:8})],8,we)):u("",!0)],10,Ve))),128)),m(l,{active:o.modals.remove,"is-loading":o.loading.remove,"is-error":o.errors.remove,text:i.removeText,onCancel:r[2]||(r[2]=t=>o.modals.remove=!1),onConfirm:i.removeSearch},null,8,["active","is-loading","is-error","text","onConfirm"]),m(O,{active:o.modals.edit,"group-options":i.groupOptions,"is-loading":o.loading.edit,"is-error":o.errors.edit,"is-group-enabled":a.isGroupEnabled,"search-query-to-edit":o.searchQueryToEdit,onCancel:r[3]||(r[3]=t=>o.modals.edit=!1),onConfirm:i.confirmEditSearch},null,8,["active","group-options","is-loading","is-error","is-group-enabled","search-query-to-edit","onConfirm"]),m(j,{active:o.modals.group,"is-loading":o.loading.group,"is-error":o.errors.group,"group-to-edit":o.groupToEdit,onCancel:r[4]||(r[4]=t=>o.modals.group=!1),onConfirm:i.confirmEditFilterGroup},null,8,["active","is-loading","is-error","group-to-edit","onConfirm"])])}const He=V(ge,[["render",Re],["__scopeId","data-v-2ad46ce1"]]);export{He as S};
//# sourceMappingURL=SearchQueryList-jldyJweR.js.map
