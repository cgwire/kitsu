{"version":3,"file":"EditAssetModal-CPhWz-DX.js","sources":["../../src/components/modals/EditAssetModal.vue"],"sourcesContent":["<template>\n  <div\n    :class=\"{\n      modal: true,\n      'is-active': active\n    }\"\n  >\n    <div class=\"modal-background\" @click=\"$emit('cancel')\"></div>\n\n    <div class=\"modal-content\">\n      <div class=\"box\">\n        <h1 class=\"title\" v-if=\"assetToEdit && assetToEdit.id\">\n          {{ $t('assets.edit_title') }} {{ assetToEdit.name }}\n        </h1>\n        <h1 class=\"title\" v-else>\n          {{ $t('assets.new_asset') }}\n        </h1>\n\n        <form @submit.prevent>\n          <combobox\n            :label=\"$t('assets.fields.type')\"\n            :options=\"productionAssetTypeOptions\"\n            v-model=\"form.entity_type_id\"\n          />\n          <combobox\n            :label=\"$t('assets.fields.episode')\"\n            :options=\"episodeOptions\"\n            v-model=\"form.source_id\"\n            v-if=\"isTVShow\"\n          />\n          <text-field\n            ref=\"nameField\"\n            :label=\"$t('assets.fields.name')\"\n            v-model.trim=\"form.name\"\n            @enter=\"runConfirmation\"\n            v-focus\n          />\n          <textarea-field\n            ref=\"descriptionField\"\n            :label=\"$t('assets.fields.description')\"\n            v-model=\"form.description\"\n            @keyup.ctrl.enter=\"runConfirmation\"\n            @keyup.meta.enter=\"runConfirmation\"\n          />\n          <text-field\n            ref=\"resolutionField\"\n            :label=\"$t('shots.fields.resolution')\"\n            v-model=\"form.data.resolution\"\n            @enter=\"runConfirmation\"\n          />\n          <template v-if=\"assetToEdit\">\n            <metadata-field\n              :key=\"descriptor.id\"\n              :descriptor=\"descriptor\"\n              :entity=\"assetToEdit\"\n              @enter=\"runConfirmation\"\n              v-model=\"form.data[descriptor.field_name]\"\n              v-for=\"descriptor in assetMetadataDescriptors\"\n            />\n          </template>\n          <combobox-boolean\n            :label=\"$t('assets.fields.shared')\"\n            v-model=\"form.is_shared\"\n            @enter=\"runConfirmation\"\n          />\n        </form>\n\n        <div class=\"has-text-right\">\n          <a\n            :class=\"{\n              button: true,\n              'is-primary': true,\n              'is-loading': isLoadingStay\n            }\"\n            @click=\"confirmAndStayClicked\"\n            v-if=\"!assetToEdit || !assetToEdit.id\"\n          >\n            {{ $t('main.confirmation_and_stay') }}\n          </a>\n          <a\n            :class=\"{\n              button: true,\n              'is-primary': true,\n              'is-loading': isLoading\n            }\"\n            @click=\"confirmClicked\"\n          >\n            {{ $t('main.confirmation') }}\n          </a>\n          <button class=\"button is-link\" @click=\"$emit('cancel')\">\n            {{ $t('main.close') }}\n          </button>\n          <p class=\"error has-text-right info-message\" v-if=\"isError\">\n            {{ $t('assets.edit_fail') }}\n          </p>\n          <p class=\"success has-text-right info-message\" v-if=\"isSuccess\">\n            {{ assetSuccessText }}\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\n\nimport { modalMixin } from '@/components/modals/base_modal'\n\nimport Combobox from '@/components/widgets/Combobox.vue'\nimport ComboboxBoolean from '@/components/widgets/ComboboxBoolean.vue'\nimport MetadataField from '@/components/widgets/MetadataField.vue'\nimport TextField from '@/components/widgets/TextField.vue'\nimport TextareaField from '@/components/widgets/TextareaField.vue'\n\nexport default {\n  name: 'edit-asset-modal',\n\n  mixins: [modalMixin],\n\n  components: {\n    Combobox,\n    ComboboxBoolean,\n    MetadataField,\n    TextField,\n    TextareaField\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    text: {\n      type: String,\n      default: ''\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    isLoadingStay: {\n      type: Boolean,\n      default: false\n    },\n    isSuccess: {\n      type: Boolean,\n      default: false\n    },\n    assetToEdit: {\n      type: Object,\n      default: () => {}\n    }\n  },\n\n  emits: ['cancel', 'confirm', 'confirm-and-stay'],\n\n  data() {\n    return {\n      form: {\n        name: '',\n        description: '',\n        source_id: null,\n        data: {\n          resolution: ''\n        },\n        is_shared: 'false'\n      },\n      assetSuccessText: ''\n    }\n  },\n\n  mounted() {\n    this.resetForm()\n    this.assetSuccessText = ''\n  },\n\n  computed: {\n    ...mapGetters([\n      'assets',\n      'assetCreated',\n      'assetMetadataDescriptors',\n      'assetTypes',\n      'currentProduction',\n      'currentEpisode',\n      'episodes',\n      'isTVShow',\n      'productionAssetTypes',\n      'productionAssetTypeOptions',\n      'openProductions'\n    ]),\n\n    resolution() {\n      return this.assetToEdit.data?.resolution || ''\n    },\n\n    episodeOptions() {\n      const options = this.episodes.map(episode => {\n        return {\n          label: episode.name,\n          value: episode.id\n        }\n      })\n      if (this.currentProduction.production_style !== 'video-game') {\n        options.unshift({\n          label: this.$t('main.main_pack'),\n          value: 'null'\n        })\n      }\n      return options\n    }\n  },\n\n  methods: {\n    runConfirmation() {\n      if (this.form.name.length > 0) {\n        if (this.isEditing()) {\n          this.confirmClicked()\n        } else {\n          this.confirmAndStayClicked()\n        }\n      }\n    },\n\n    focusName() {\n      this.$refs.nameField.focus()\n    },\n\n    confirmAndStayClicked() {\n      this.$emit('confirm-and-stay', {\n        ...this.form,\n        is_shared: this.form.is_shared === 'true'\n      })\n    },\n\n    confirmClicked() {\n      this.$emit('confirm', {\n        ...this.form,\n        is_shared: this.form.is_shared === 'true'\n      })\n    },\n\n    isEditing() {\n      return this.assetToEdit && this.assetToEdit.id\n    },\n\n    getEntityTypeIdDefaultValue() {\n      let entityTypeId = this.assetToEdit.asset_type_id\n      if (!entityTypeId) {\n        entityTypeId = this.productionAssetTypeOptions[0]?.value\n      }\n      const isInOptions = this.productionAssetTypeOptions.some(\n        option => option.value === entityTypeId\n      )\n      if (!isInOptions) {\n        entityTypeId = this.productionAssetTypeOptions[0]?.value\n      }\n      return entityTypeId\n    },\n\n    resetForm() {\n      if (!this.isEditing()) {\n        if (!this.form.entity_type_id && this.productionAssetTypeOptions[0]) {\n          this.form.entity_type_id = this.productionAssetTypeOptions[0].value\n        }\n        if (this.openProductions.length > 0) {\n          this.form.project_id = this.currentProduction\n            ? this.currentProduction.id\n            : ''\n        }\n        this.form.name = ''\n        this.form.description = ''\n        this.form.source_id = this.currentEpisode\n          ? this.currentEpisode.id\n          : null\n        this.form.data = {}\n        this.form.is_shared = 'false'\n      } else {\n        const entityTypeId = this.getEntityTypeIdDefaultValue()\n        this.form = {\n          entity_type_id: entityTypeId,\n          project_id: this.assetToEdit.project_id,\n          name: this.assetToEdit.name,\n          description: this.assetToEdit.description,\n          source_id: this.assetToEdit.source_id || this.assetToEdit.episode_id,\n          data:\n            {\n              ...this.assetToEdit.data,\n              resolution: this.assetToEdit.data.resolution || ''\n            } || {},\n          is_shared: String(this.assetToEdit.is_shared === true)\n        }\n      }\n    }\n  },\n\n  watch: {\n    assetToEdit() {\n      this.resetForm()\n    },\n\n    assetCreated() {\n      if (this.isEditing()) {\n        this.assetSuccessText = this.$t('assets.edit_success', {\n          name: this.assetCreated\n        })\n      } else {\n        this.assetSuccessText = this.$t('assets.new_success', {\n          name: this.assetCreated\n        })\n      }\n    },\n\n    active() {\n      this.assetSuccessText = ''\n      this.resetForm()\n      if (this.active) {\n        setTimeout(() => {\n          this.$refs.nameField.focus()\n        }, 100)\n      }\n    },\n\n    currentProduction() {\n      this.form.entity_type_id = null\n      this.resetForm()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.modal-content .box p.text {\n  margin-bottom: 1em;\n}\n\n.is-danger {\n  color: #ff3860;\n  font-style: italic;\n}\n\n.info-message {\n  margin-top: 1em;\n}\n</style>\n"],"names":["_sfc_main","modalMixin","Combobox","ComboboxBoolean","MetadataField","TextField","TextareaField","mapGetters","options","episode","entityTypeId","option","_hoisted_1","_hoisted_2","_hoisted_5","_createElementBlock","_normalizeClass","$props","_createElementVNode","_ctx","_hoisted_3","_toDisplayString","_hoisted_4","_cache","_withModifiers","_createVNode","_component_combobox","$data","$event","_createBlock","$options","_createCommentVNode","_component_text_field","_component_textarea_field","_withKeys","_openBlock","_Fragment","_renderList","descriptor","_component_metadata_field","_component_combobox_boolean","args","_hoisted_6","_hoisted_7"],"mappings":"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"}