import{o as f,m as r,a as d,n,aa as v,bI as k,B as T,aK as g,O as C,p as w,H as P,w as $,F as x,q as S,bJ as A,bK as m,bL as p,bM as _,i as D,bN as I,aL as B,bO as F,b6 as L,T as E,bc as l,_ as u,b8 as R,bP as b,s as O,k as M,bQ as h,bR as N,c as q}from"./index-s4NHCToL.js";import{B as U}from"./BooleanCell-D4eDuvpy.js";import{B as y}from"./BooleanField-QjUj6eJb.js";import{T as V}from"./TaskStatusCell-Dnzm6KoP.js";import{S as G}from"./StatusAutomationList-B4tecYKw.js";const j={name:"production-backgrounds",components:{BooleanField:y,Combobox:f},data(){return{selectedBackgroundId:null}},computed:{...r(["backgrounds","currentProduction","productionBackgrounds"]),remainingBackgrounds(){return this.backgrounds.filter(({id:e})=>!this.currentProduction.preview_background_files.includes(e))},remainingBackgroundsOptions(){return this.remainingBackgrounds.map(e=>({label:e.name,value:e.id}))}},methods:{...d(["addBackgroundToProduction","removeBackgroundFromProduction","setDefaultBackgroundToProduction"]),addBackground(){this.addBackgroundToProduction(this.selectedBackgroundId)},removeBackground(e){this.removeBackgroundFromProduction(e)},resetSelection(){var e;this.selectedBackgroundId=((e=this.remainingBackgrounds[0])==null?void 0:e.id)||""},isGlobalDefaultBackground(e){return e.is_default&&this.isCurrentDefaultBackground(e)},isCurrentDefaultBackground(e){const t=this.currentProduction.default_preview_background_file_id;return t?e.id===t:e.is_default},setDefaultBackground(e,t){this.setDefaultBackgroundToProduction(t?e.id:null)}},watch:{remainingBackgrounds:{immediate:!0,handler(){this.resetSelection()}}}};var K=function(){var a,o;var t=this,s=t._self._c;return s("div",{staticClass:"production-backgrounds"},[(a=t.remainingBackgrounds)!=null&&a.length?s("div",{staticClass:"flexrow mt1 mb1"},[s("combobox",{staticClass:"flexrow-item mb0",attrs:{options:t.remainingBackgroundsOptions},model:{value:t.selectedBackgroundId,callback:function(i){t.selectedBackgroundId=i},expression:"selectedBackgroundId"}}),s("button",{staticClass:"button flexrow-item",on:{click:t.addBackground}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1):t._e(),(o=t.currentProduction.preview_background_files)!=null&&o.length?s("table",{staticClass:"datatable"},[s("thead",{staticClass:"datatable-head"},[s("tr",[s("th",{staticClass:"name"},[t._v(t._s(t.$t("backgrounds.fields.name")))]),s("th",{staticClass:"is-default"},[t._v(" "+t._s(t.$t("backgrounds.fields.is_default"))+" ")]),s("th",{staticClass:"actions"})])]),s("tbody",{staticClass:"datatable-body"},t._l(t.productionBackgrounds,function(i){return s("tr",{key:i.id,staticClass:"datatable-row"},[s("td",{staticClass:"name"},[s("span",{staticClass:"flexrow"},[s("a",{staticClass:"thumbnail-wrapper thumbnail-picture entity-thumbnail flexrow-item",attrs:{href:i.url,target:"_blank"}},[s("img",{attrs:{src:i.thumbnail,alt:i.name,width:"100",height:"67"}})]),t._v(" "+t._s(i.name)+" ")])]),s("td",{staticClass:"is-default"},[s("boolean-field",{staticClass:"ml05 mb0",attrs:{disabled:t.isGlobalDefaultBackground(i),label:t.$t("backgrounds.fields.is_default"),value:String(t.isCurrentDefaultBackground(i))},on:{click:function(c){return t.setDefaultBackground(i,c==="true")}}})],1),s("td",[s("button",{staticClass:"button",on:{click:function(c){return t.removeBackground(i.id)}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])])}),0)]):s("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")])])},H=[],z=n(j,K,H,!1,null,"26d2c20c",null,null);const J=z.exports,Q={name:"production-board",components:{BooleanField:y,ValidationTag:v},data(){return{availableRoles:["user","vendor","supervisor","manager","admin"]}},computed:{...r(["currentProduction","productionTaskStatuses"]),sortedProductionTaskStatuses(){return k([...this.productionTaskStatuses],this.currentProduction)}},methods:{...d(["editTaskStatusLink","loadContext"]),getActiveRoles(e){var t;return((t=this.currentProduction.task_statuses_link[e.id])==null?void 0:t.roles_for_board)||[]},isActiveRole(e,t){return this.getActiveRoles(e).includes(t)},async updateRolesForBoard(e,t,s=!0){const a=[...this.getActiveRoles(e)];t.forEach(i=>{s&&!this.isActiveRole(e,i)?a.push(i):!s&&this.isActiveRole(e,i)&&a.splice(a.indexOf(i),1)});const o={...this.currentProduction.task_statuses_link[e.id],roles_for_board:a,project_id:this.currentProduction.id,task_status_id:e.id};await this.editTaskStatusLink(o),await this.loadContext()}}};var Y=function(){var a;var t=this,s=t._self._c;return s("div",{staticClass:"production-board"},[(a=t.currentProduction.task_statuses)!=null&&a.length?s("table",{staticClass:"datatable"},[s("thead",[s("tr",[s("th",{staticClass:"th-name"},[t._v(t._s(t.$t("task_status.fields.name")))]),s("th",{staticClass:"th-short-name"},[t._v(" "+t._s(t.$t("task_status.fields.short_name"))+" ")]),s("th",{staticClass:"th-roles"},[t._v(" "+t._s(t.$t("board.settings.visible"))+" ")])])]),s("tbody",{staticClass:"datatable-body"},[t._l(t.sortedProductionTaskStatuses,function(o){return[o?s("tr",{key:o.id,staticClass:"datatable-row task-status"},[s("td",[t._v(t._s(o.name))]),s("td",{staticClass:"name"},[s("validation-tag",{attrs:{"is-static":!0,task:{task_status_id:o.id}}})],1),s("td",{staticClass:"roles"},[t._l(t.availableRoles,function(i){return s("boolean-field",{key:`${o.id}-${i}`,staticClass:"role-field",attrs:{label:t.$t(`people.role.${i}`),value:String(t.isActiveRole(o,i))},on:{click:c=>t.updateRolesForBoard(o,[i],c==="true")}})}),t.getActiveRoles(o).length<t.availableRoles.length?s("button",{staticClass:"button",on:{click:function(i){return t.updateRolesForBoard(o,t.availableRoles)}}},[t._v(" "+t._s(t.$t("board.settings.select_all"))+" ")]):s("button",{staticClass:"button",on:{click:function(i){return t.updateRolesForBoard(o,t.availableRoles,!1)}}},[t._v(" "+t._s(t.$t("board.settings.unselect_all"))+" ")])],2)]):t._e()]})],2)]):s("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")])])},W=[],X=n(Q,Y,W,!1,null,"1b4c1d60",null,null);const Z=X.exports,tt={name:"production-brief",components:{ButtonSimple:T,TextareaField:g},data(){return{brief:"",isEditing:!1,isLoading:!1,errors:{editBrief:!1}}},computed:{...r(["currentProduction"]),textarea(){return this.$refs.textarea}},mounted(){this.currentProduction&&(this.brief=this.currentProduction.description)},methods:{...d(["editProduction","setProduction"]),isEmpty(e){return!e||e.length===0},openEditing(){this.isEditing=!0,this.$nextTick(()=>{this.textarea.focus()})},async editBrief(){this.isLoading=!0;try{await this.editProduction({id:this.currentProduction.id,description:this.brief})}catch{this.errors.editBrief=!0,this.isLoading=!1;return}this.isEditing=!1,this.isLoading=!1},compileMarkdown(e){return C(e)}}};var st=function(){var t=this,s=t._self._c;return s("div",{staticClass:"brief"},[t.isEditing?s("div",{staticClass:"box has-text-right"},[s("textarea-field",{ref:"textarea",staticClass:"editor",attrs:{"input-class":"textarea"},on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")||!a.ctrlKey?null:t.editBrief.apply(null,arguments)}},model:{value:t.brief,callback:function(a){t.brief=a},expression:"brief"}}),t.errors.editBrief?s("p",{staticClass:"error mt1 has-text-right"},[t._v(" "+t._s(t.$t("productions.brief.edit.errorText"))+" ")]):t._e(),s("p",[s("button-simple",{attrs:{"is-primary":!0,"is-loading":t.isLoading,disabled:t.isLoading,text:t.$t("main.save")},on:{click:t.editBrief}})],1)],1):s("div",{staticClass:"box",on:{dblclick:t.openEditing}},[t.isEmpty(t.currentProduction.description)?s("div",[s("p",[t._v(t._s(t.$t("productions.brief.empty")))])]):s("div",{staticClass:"content",domProps:{innerHTML:t._s(t.compileMarkdown(t.currentProduction.description))}})])])},et=[],at=n(tt,st,et,!1,null,"4ce95d6f",null,null);const it=at.exports,ot={name:"production-parameters",components:{ComboboxBoolean:w,ComboboxStyled:P,DateField:$,FileUpload:x,TextField:S,ButtonSimple:T},data(){return{formData:null,isLoading:!1,isError:!1,isLocalTVShow:!1,productionTypeOptions:A,homepageOptions:m,form:{name:"",start_date:new Date,end_date:new Date,nb_episodes:0,episode_span:0,fps:"",max_retakes:0,is_clients_isolated:"false",is_preview_download_allowed:"false",is_set_preview_automated:"false",ratio:"",resolution:"",production_type:"short"}}},computed:{...r(["currentProduction","productionAvatarFormData","productionStatus","isTVShow"])},mounted(){this.resetForm()},watch:{currentProduction:{handler(){this.resetForm(),this.updateTvShowRelatedDatas(this.isTVShow)},deep:!0},"form.production_type"(e){this.updateTvShowRelatedDatas(e==="tvshow")}},methods:{...d(["editProduction","storeProductionPicture","uploadProductionAvatar"]),onFileSelected(e){this.formData=e,this.storeProductionPicture(e)},isEmpty(e){return!e||e.length===0},runConfirmation(){this.$emit("confirm",this.form)},updateTvShowRelatedDatas(e){this.isLocalTVShow=e,e&&this.currentProduction?(this.form.nb_episodes=this.currentProduction.nb_episodes,this.form.episode_span=this.currentProduction.episode_span):(this.form.nb_episodes=0,this.form.episode_span=0)},resetForm(){this.currentProduction?this.form={name:this.currentProduction.name,start_date:p(this.currentProduction.start_date).toDate(),end_date:p(this.currentProduction.end_date).toDate(),production_type:this.currentProduction.production_type||"short",episode_span:this.currentProduction.episode_span,fps:this.currentProduction.fps,max_retakes:this.currentProduction.max_retakes,nb_episodes:this.currentProduction.nb_episodes,is_clients_isolated:this.currentProduction.is_clients_isolated?"true":"false",is_preview_download_allowed:this.currentProduction.is_preview_download_allowed?"true":"false",is_set_preview_automated:this.currentProduction.is_set_preview_automated?"true":"false",ratio:this.currentProduction.ratio,resolution:this.currentProduction.resolution,homepage:this.currentProduction.homepage}:this.form={name:"",start_date:new Date,end_date:new Date,production_type:"short",nb_episodes:0,episode_span:0,max_retakes:0,is_clients_isolated:"false",is_preview_download_allowed:"false",is_set_preview_automated:"false",fps:"",ratio:"",resolution:"",homepage:m[0].value}},async editParameters(){this.isLoading=!0;try{await this.editProduction({id:this.currentProduction.id,...this.form,start_date:_(this.form.start_date),end_date:_(this.form.end_date)}),this.productionAvatarFormData&&await this.uploadProductionAvatar(this.currentProduction.id)}catch{this.isLoading=!1,this.isError=!0;return}this.isLoading=!1}}};var rt=function(){var t=this,s=t._self._c;return s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-one-third box"},[s("form",{staticClass:"form",on:{submit:function(a){a.preventDefault()}}},[s("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("productions.fields.name")},on:{enter:t.runConfirmation},model:{value:t.form.name,callback:function(a){t.$set(t.form,"name",a)},expression:"form.name"}}),s("div",{staticClass:"columns"},[s("div",{staticClass:"mr1"},[s("date-field",{ref:"startDateField",staticClass:"mb0",attrs:{label:t.$t("productions.fields.start_date"),"short-date":!0},model:{value:t.form.start_date,callback:function(a){t.$set(t.form,"start_date",a)},expression:"form.start_date"}})],1),s("div",[s("date-field",{ref:"endDateField",staticClass:"mb0",attrs:{label:t.$t("productions.fields.end_date"),"short-date":!0},model:{value:t.form.end_date,callback:function(a){t.$set(t.form,"end_date",a)},expression:"form.end_date"}})],1)]),s("combobox-styled",{ref:"productionTypeField",staticClass:"mb2",attrs:{"locale-key-prefix":"productions.type.",label:t.$t("productions.fields.type"),options:t.productionTypeOptions},on:{enter:t.runConfirmation},model:{value:t.form.production_type,callback:function(a){t.$set(t.form,"production_type",a)},expression:"form.production_type"}}),t.currentProduction&&t.currentProduction.id?s("combobox-styled",{ref:"homepage",staticClass:"mb2",attrs:{"locale-key-prefix":"productions.homepage.",label:t.$t("productions.fields.homepage"),options:t.homepageOptions},on:{enter:t.runConfirmation},model:{value:t.form.homepage,callback:function(a){t.$set(t.form,"homepage",a)},expression:"form.homepage"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("text-field",{ref:"fpsField",attrs:{type:"number",max:60,step:.001,label:t.$t("productions.fields.fps")},on:{enter:t.runConfirmation},model:{value:t.form.fps,callback:function(a){t.$set(t.form,"fps",a)},expression:"form.fps"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("text-field",{ref:"ratioField",attrs:{label:t.$t("productions.fields.ratio")},on:{enter:t.runConfirmation},model:{value:t.form.ratio,callback:function(a){t.$set(t.form,"ratio",a)},expression:"form.ratio"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("text-field",{ref:"resolutionField",attrs:{label:t.$t("productions.fields.resolution")},on:{enter:t.runConfirmation},model:{value:t.form.resolution,callback:function(a){t.$set(t.form,"resolution",a)},expression:"form.resolution"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("combobox-boolean",{ref:"isClientsIsolatedField",attrs:{label:t.$t("productions.fields.is_clients_isolated")},on:{enter:t.runConfirmation},model:{value:t.form.is_clients_isolated,callback:function(a){t.$set(t.form,"is_clients_isolated",a)},expression:"form.is_clients_isolated"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("combobox-boolean",{ref:"isPreviewDownloadAllowed",attrs:{label:t.$t("productions.fields.is_preview_download_allowed")},on:{enter:t.runConfirmation},model:{value:t.form.is_preview_download_allowed,callback:function(a){t.$set(t.form,"is_preview_download_allowed",a)},expression:"form.is_preview_download_allowed"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("combobox-boolean",{ref:"isSetPreviewAutomated",attrs:{label:t.$t("productions.fields.is_set_preview_automated")},on:{enter:t.runConfirmation},model:{value:t.form.is_set_preview_automated,callback:function(a){t.$set(t.form,"is_set_preview_automated",a)},expression:"form.is_set_preview_automated"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("text-field",{ref:"maxRetakesField",attrs:{type:"number",step:1,label:t.$t("productions.fields.max_retakes")},on:{enter:t.runConfirmation},model:{value:t.form.max_retakes,callback:function(a){t.$set(t.form,"max_retakes",a)},expression:"form.max_retakes"}}):t._e(),t.currentProduction&&t.currentProduction.id?s("div",[s("label",{staticClass:"label"},[t._v(t._s(t.$t("productions.picture")))]),s("file-upload",{ref:"fileField",attrs:{"is-primary":!1,label:t.$t("main.csv.upload_file"),accept:".png,.jpg,.jpeg"},on:{fileselected:t.onFileSelected}})],1):t._e(),t.isError?s("p",{staticClass:"error mt1"},[t._v(" "+t._s(t.$t("productions.edit_error"))+" ")]):t._e(),s("div",{staticClass:"has-text-right mt2"},[s("button-simple",{class:{"is-loading":t.isLoading},attrs:{"is-primary":!0,disabled:t.isLoading,text:t.$t("main.save")},on:{click:t.editParameters}})],1)],1)])])},nt=[],dt=n(ot,rt,nt,!1,null,"1225637b",null,null);const ut=dt.exports,lt={name:"status-automation-item",components:{TaskStatusCell:V,TaskTypeName:D},props:{statusAutomation:{type:Object,default:null},productionId:{type:String,default:null},deletable:{type:Boolean,default:!1}},computed:{...r(["isCurrentUserClient","getTaskStatus","getTaskType"]),statusAutomationPath(){const e={name:"status-automation",params:{production_id:this.productionId,status_automation_id:this.statusAutomation.id,type:I(this.statusAutomation.for_entity)}};return(this.statusAutomation.episode_id||this.$route.params.episode_id)&&(e.name="episode-status-automation",e.params.episode_id=this.statusAutomation.episode_id||this.$route.params.episode_id),e}},methods:{...d([])}};var ct=function(){var t=this,s=t._self._c;return s("div",{staticClass:"status-automation flexrow"},[s("span",{staticClass:"flexrow-item entity-type"},[t._v(" "+t._s(t.statusAutomation.entity_type)+" ")]),s("span",{staticClass:"in-task-type flexrow-item"},[s("task-type-name",{staticClass:"in-task-type flexrow-item",attrs:{"task-type":t.getTaskType(t.statusAutomation.in_task_type_id)}})],1),s("span",{staticClass:"in-task-status flexrow-item"},[t.statusAutomation.in_field_type!=="ready_for"?s("task-status-cell",{attrs:{entry:t.getTaskStatus(t.statusAutomation.in_task_status_id)}}):t._e()],1),s("span",{staticClass:"flexrow-item trigger-type"},[t._v(" changes "+t._s(t.statusAutomation.out_field_type==="ready_for"?"ready for to":"task status for")+" ")]),s("span",{staticClass:"out-task-type flexrow-item"},[s("task-type-name",{attrs:{"task-type":t.getTaskType(t.statusAutomation.out_task_type_id)}})],1),t.statusAutomation.out_field_type==="status"?s("span",{staticClass:"flexrow-item"},[t._v(" to ")]):t._e(),s("span",{staticClass:"out-task-status flexrow-item"},[t.statusAutomation.out_field_type==="status"?s("task-status-cell",{attrs:{entry:t.getTaskStatus(t.statusAutomation.out_task_status_id)}}):t._e()],1)])},mt=[],pt=n(lt,ct,mt,!1,null,"79c39393",null,null);const _t=pt.exports,ht={name:"combobox-status-automation",components:{ChevronDownIcon:B,ComboboxMask:F,StatusAutomationItem:_t},data(){return{showStatusAutomationsList:!1}},props:{label:{default:"",type:String},statusAutomationsList:{default:()=>[],type:Array},value:{default:"",type:String},narrow:{default:!1,type:Boolean},withMargin:{default:!0,type:Boolean},addPlaceholder:{default:!1,type:Boolean}},mounted(){this.selectedStatusAutomation=this.statusAutomation},computed:{...r(["isDarkTheme","statusAutomationMap","getTaskStatus","getTaskType"]),currentStatusAutomation(){return this.value?this.statusAutomationMap.get(this.value):this.addPlaceholder?{short_name:"+ status",color:"#999"}:this.statusAutomationsList[0]}},methods:{selectStatusAutomation(e){this.$emit("input",e.id),this.showStatusAutomationsList=!1},backgroundColor(e){return(!e||e.is_default)&&!this.isDarkTheme?"#ECECEC":(!e||e.is_default)&&this.isDarkTheme?"#5F626A":this.isDarkTheme?L.darkenColor(e.color):e.color},color(e){return!e||!e.is_default||this.isDarkTheme?"white":"#333"},toggleStatusAutomationsList(){this.showStatusAutomationsList=!this.showStatusAutomationsList}}};var ft=function(){var t=this,s=t._self._c;return s("div",{class:{field:t.withMargin,"field--narrow":t.narrow}},[t.label.length>0?s("label",{staticClass:"label"},[t._v(" "+t._s(t.label)+" ")]):t._e(),s("div",{staticClass:"status-automation-combo"},[s("div",{staticClass:"flexrow",on:{click:t.toggleStatusAutomationsList}},[s("div",{staticClass:"selected-status-automation-line flexrow-item"},[t.currentStatusAutomation?s("status-automation-item",{attrs:{"status-automation":t.currentStatusAutomation}}):t._e()],1),s("chevron-down-icon",{staticClass:"down-icon flexrow-item"})],1),t.showStatusAutomationsList?s("div",{ref:"select",staticClass:"select-input"},t._l(t.statusAutomationsList,function(a){return s("div",{key:a.id,staticClass:"status-automation-line",on:{click:function(o){return t.selectStatusAutomation(a)}}},[a?s("status-automation-item",{attrs:{"status-automation":a}}):t._e()],1)}),0):t._e()]),s("combobox-mask",{attrs:{displayed:t.showStatusAutomationsList},on:{click:t.toggleStatusAutomationsList}})],1)},vt=[],kt=n(ht,ft,vt,!1,null,"abc19517",null,null);const Tt=kt.exports,bt={name:"production-status-automations",components:{ComboboxStatusAutomation:Tt,StatusAutomationList:G},data(){return{statusAutomations:[],statusAutomationId:""}},mounted(){this.remainingStatusAutomations.length>0&&(this.statusAutomationId=this.remainingStatusAutomations[0].id)},computed:{...r(["currentProduction","productionStatusAutomations","statusAutomationMap","remainingStatusAutomations"])},methods:{...d(["addStatusAutomationToProduction"]),isEmpty(e){return!e||e.length===0},addStatusAutomation(){this.addStatusAutomationToProduction(this.statusAutomationId),this.remainingStatusAutomations.length>0?this.statusAutomationId=this.remainingStatusAutomations[0].id:this.statusAutomationId=""}},watch:{}};var yt=function(){var t=this,s=t._self._c;return s("div",{staticClass:"columns"},[s("div",{staticClass:"column"},[t.remainingStatusAutomations.length>0?[t.remainingStatusAutomations?s("div",{staticClass:"flexrow mt1 mb1 add-status-automation"},[s("combobox-status-automation",{staticClass:"flexrow-item selector",attrs:{"status-automations-list":t.remainingStatusAutomations},model:{value:t.statusAutomationId,callback:function(a){t.statusAutomationId=a},expression:"statusAutomationId"}}),s("button",{staticClass:"button flexrow-item",on:{click:t.addStatusAutomation}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1):t._e()]:t._e(),t.isEmpty(t.productionStatusAutomations)?s("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_automation_list"))+" ")]):t._e(),t.isEmpty(t.productionStatusAutomations)?t._e():s("status-automation-list",{attrs:{entries:t.productionStatusAutomations}})],2)])},gt=[],Ct=n(bt,yt,gt,!1,null,"490cd373",null,null);const wt=Ct.exports,Pt={name:"production-task-type",components:{TaskTypeCell:E},props:{taskType:{required:!0,type:Object},scheduleItem:{required:!0,type:Object}},data(){return{startDate:null,endDate:null,silent:!0}},computed:{...r(["currentProduction","getTaskTypePriority"]),productionTimeRange(){return{to:l(this.currentProduction.start_date).toDate(),from:l(this.currentProduction.end_date).toDate()}},endDateTimeRange(){return{to:this.startDate,from:l(this.currentProduction.end_date).toDate()}}},mounted(){this.startDate=l(this.scheduleItem.start_date).toDate(),this.endDate=l(this.scheduleItem.end_date).toDate(),this.$nextTick(()=>{this.silent=!1})},methods:{...d([])},watch:{startDate(){if(this.silent)return;const e=u(this.startDate);let t=u(this.endDate);this.silent=!0,t.isBefore(e)&&(t=e.clone().add(1,"days"),this.endDate=t.toDate());const s={...this.scheduleItem};s.startDate=e,s.endDate=t,this.$emit("date-changed",s),this.$nextTick(()=>{this.silent=!1})},endDate(){if(this.silent)return;let e=u(this.startDate);const t=u(this.endDate);this.silent=!0,t.isBefore(e)&&(e=t.clone().add(-1,"days"),this.startDate=e.toDate());const s={...this.scheduleItem};s.startDate=e,s.endDate=t,this.$emit("date-changed",s),this.$nextTick(()=>{this.silent=!1})},scheduleItem(){this.silent=!0,this.startDate=l(this.scheduleItem.start_date).toDate(),this.endDate=l(this.scheduleItem.end_date).toDate(),this.$nextTick(()=>{this.silent=!1})}}};var $t=function(){var t=this,s=t._self._c;return s("tr",{key:t.taskType.id,staticClass:"datatable-row"},[s("task-type-cell",{attrs:{"task-type":t.taskType}}),s("td",{staticClass:"remove"},[s("button",{staticClass:"button",on:{click:function(a){return t.$emit("remove",{scheduleItem:t.scheduleItem,taskType:t.taskType})}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])],1)},xt=[],St=n(Pt,$t,xt,!1,null,"a1edccb9",null,null);const At=St.exports,Dt={name:"production-task-types",components:{ComboboxTaskType:R,draggable:b,ProductionTaskType:At},data(){return{assetTaskTypes:{list:[]},editTaskTypes:{list:[]},episode_span:0,episodeTaskTypes:{list:[]},sequenceTaskTypes:{list:[]},shotTaskTypes:{list:[]},taskTypeId:"",loading:{episode_span:!1,scheduleTimeUpdate:!1,scheduleTimeDelete:!1},errors:{episode_span:!1,scheduleTimeUpdate:!1,delete:!1}}},mounted(){this.remainingTaskTypes.length>0&&(this.taskTypeId=this.remainingTaskTypes[0].id),this.resetDisplayedTaskTypes(),this.currentProduction&&(this.episode_span=this.currentProduction.episode_span,this.loadAllScheduleItems(this.currentProduction).then(()=>{this.resetDisplayedTaskTypes()}).catch(e=>{console.error(e)}))},computed:{...r(["currentProduction","currentScheduleItems","productionTaskTypes","productionAssetTaskTypes","productionShotTaskTypes","productionEditTaskTypes","productionSequenceTaskTypes","productionEpisodeTaskTypes","taskStatusMap","taskTypeMap","taskTypes","isTVShow"]),remainingTaskTypes(){return O(this.taskTypes.filter(e=>!this.currentProduction.task_types.includes(e.id)))},isAssetsOnly(){return this.currentProduction.production_type==="assets"},isShotsOnly(){return this.currentProduction.production_type==="shots"},taskTypeGroups(){let e=[];return this.isShotsOnly||e.push(this.assetTaskTypes),this.isAssetsOnly||(e=e.concat([this.shotTaskTypes,this.editTaskTypes,this.sequenceTaskTypes,this.episodeTaskTypes])),e}},methods:{...d(["addTaskTypeToProduction","createScheduleItem","deleteScheduleItem","editProduction","editTaskTypeLink","loadAllScheduleItems","loadContext","removeTaskTypeFromProduction","saveScheduleItem"]),isEmpty(e){return!e||e.length===0},resetDisplayedTaskTypes(){["Asset","Shot","Sequence","Episode","Edit"].forEach(e=>{const t=this[`production${e}TaskTypes`];let s=M([...t],this.currentProduction);s=s.map(a=>({taskType:a,scheduleItem:this.getScheduleItemForTaskType(a)})),this[`${e.toLowerCase()}TaskTypes`]={title:this.$t(`${e.toLowerCase()}s.title`),list:s}})},getScheduleItemForTaskType(e){return this.currentScheduleItems.find(s=>s.task_type_id===e.id)||{start_date:h(u()),end_date:h(u())}},async addTaskType(){await this.addTaskTypeToProduction({taskTypeId:this.taskTypeId,priority:this.assetTaskTypes.length}),await this.createScheduleItem({startDate:u(),endDate:u(),project_id:this.currentProduction.id,task_type_id:this.taskTypeId}),this.remainingTaskTypes.length>0?this.taskTypeId=this.remainingTaskTypes[0].id:this.taskTypeId="",this.resetDisplayedTaskTypes()},async removeTaskType({taskType:e,scheduleItem:t}){this.errors.delete=!1;try{await this.removeTaskTypeFromProduction(e.id),t!==null&&(this.loading.scheduleTimeDelete=!0,await this.deleteScheduleItem(t),this.loading.scheduleTimeDelete=!1)}catch{this.errors.delete=!0,this.loading.scheduleTimeDelete=!1;return}await this.$nextTick(),this.remainingTaskTypes.length>0&&(this.taskTypeId=this.remainingTaskTypes[0].id),this.resetDisplayedTaskTypes()},async editEpisodeSpan(){this.loading.episode_span=!0,this.errors.episode_span=!1;try{await this.editProduction({id:this.currentProduction.id,episode_span:this.episode_span})}catch(e){this.errors.episode_span=!0,console.error(e)}this.loading.episode_span=!1},async onDateChanged(e){this.errors.scheduleTimeUpdate=!1;try{await this.saveScheduleItem(e)}catch(t){console.error(t),this.errors.scheduleTimeUpdate=!0}},async savePriorities(e){const t=new Date().getTime();this.lastCall=this.lastCall||0,t-this.lastCall>1e3&&!this.isSaving?(this.lastCall=t,this.isSaving=!0,await N.runPromiseAsSeries(e.map(async s=>await this.editTaskTypeLink(s))),this.isSaving=!1,this.newSaveCall&&await this.savePriorities(e),setTimeout(()=>{this.$store.commit("SORT_VALIDATION_COLUMNS",this.taskTypeMap)},100)):this.newSaveCall=!0},async updatePriorities(e){const t=[];e.forEach((s,a)=>{a+=1;const o={projectId:this.currentProduction.id,taskTypeId:s.taskType.id,priority:a};t.push(o)}),await this.savePriorities(t),await this.loadContext()}},watch:{currentProduction:{handler(){this.episode_span=this.currentProduction.episode_span,this.loadAllScheduleItems(this.currentProduction),this.resetDisplayedTaskTypes()},deep:!0}}};var It=function(){var t=this,s=t._self._c;return s("div",{staticClass:"columns"},[s("div",{staticClass:"column"},[t.remainingTaskTypes.length>0?[s("div",{staticClass:"flexrow mt1 mb1 add-task-type"},[s("combobox-task-type",{staticClass:"flexrow-item selector",attrs:{"task-type-list":t.remainingTaskTypes},model:{value:t.taskTypeId,callback:function(a){t.taskTypeId=a},expression:"taskTypeId"}}),s("button",{staticClass:"button flexrow-item",attrs:{disabled:t.loading.scheduleTimeDelete},on:{click:t.addTaskType}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1)]:t._e(),t.errors.delete||t.errors.scheduleTimeUpdate?s("p",{staticClass:"error mt1 mb1"},[t._v(" "+t._s(t.$t("productions.edit_error"))+" ")]):t._e(),t.isEmpty(t.currentProduction.task_types)?s("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")]):t._l(t.taskTypeGroups,function(a,o){return s("div",{key:o},[s("h2",{staticClass:"section-title"},[t._v(" "+t._s(a.title)+" ")]),a.list.length>0?s("table",{staticClass:"datatable list"},[s("draggable",{staticClass:"datatable-body",attrs:{draggable:".task-type",tag:"tbody"},on:{end:function(i){return t.updatePriorities(a.list)}},model:{value:a.list,callback:function(i){t.$set(a,"list",i)},expression:"taskListObject.list"}},t._l(a.list,function(i){return s("production-task-type",{key:i.taskType.id,staticClass:"task-type",attrs:{"task-type":i.taskType,"schedule-item":i.scheduleItem},on:{"date-changed":t.onDateChanged,remove:t.removeTaskType}})}),1)],1):t._e(),a.list.length===0?s("p",{staticClass:"empty"},[t._v(" "+t._s(t.$t("task_types.no_task_types"))+" ")]):t._e()])})],2)])},Bt=[],Ft=n(Dt,It,Bt,!1,null,"6e34192e",null,null);const Lt=Ft.exports,Et={name:"production-settings",components:{BooleanCell:U,Combobox:f,ComboboxStatus:q,draggable:b,ProductionBackgrounds:J,ProductionBoard:Z,ProductionBrief:it,ProductionParameters:ut,ProductionStatusAutomations:wt,ProductionTaskTypes:Lt,ValidationTag:v},data(){return{activeTab:"parameters",assetTypeId:"",taskStatusId:""}},mounted(){this.remainingAssetTypes.length>0&&(this.assetTypeId=this.remainingAssetTypes[0].value),this.remainingTaskStatuses.length>0&&(this.taskStatusId=this.remainingTaskStatuses[0].id),this.$route.query.tab&&(this.activeTab=this.$route.query.tab)},computed:{...r(["assetTypeMap","currentProduction","assetTypes","productionAssetTypes","productionTaskTypes","productionTaskStatuses","productionStatusAutomations","taskStatus","taskStatusMap","taskTypeMap","taskTypes","isTVShow"]),remainingAssetTypes(){return this.assetTypes.filter(e=>!this.currentProduction.asset_types.includes(e.id)).map(e=>({label:e.name,value:e.id}))},remainingTaskStatuses(){return this.taskStatus.filter(e=>!this.currentProduction.task_statuses.includes(e.id)&&!e.for_concept)},sortedProductionTaskStatuses(){return k(this.productionTaskStatuses,this.currentProduction)}},methods:{...d(["addAssetTypeToProduction","addTaskStatusToProduction","editTaskStatusLink","loadContext","removeAssetTypeFromProduction","removeTaskStatusFromProduction"]),isEmpty(e){return!e||e.length===0},isActiveTab(e){return this.activeTab===e},addAssetType(){this.addAssetTypeToProduction(this.assetTypeId),this.remainingAssetTypes.length>0&&(this.assetTypeId=this.remainingAssetTypes[0].value)},removeAssetType(e){this.removeAssetTypeFromProduction(e)},addTaskStatus(){this.addTaskStatusToProduction(this.taskStatusId),this.remainingTaskStatuses.length>0?this.taskStatusId=this.remainingTaskStatuses[0].id:this.taskStatusId=""},async removeTaskStatus(e){await this.removeTaskStatusFromProduction(e),await this.$nextTick(),this.remainingTaskStatuses.length>0&&(this.taskStatusId=this.remainingTaskStatuses[0].id)},getBooleanTranslation(e){return e?this.$t("main.yes"):this.$t("main.no")},async updateTaskStatusPriority(e,t){const s=[...this.productionTaskStatuses],a=s[e];s.splice(e,1),s.splice(t,0,a),await this.updateTaskStatusPriorities(s)},async updateTaskStatusPriorities(e){const t=e.map((s,a)=>({...this.currentProduction.task_statuses_link[s.id],priority:a+1,project_id:this.currentProduction.id,task_status_id:s.id}));for(const s of t)await this.editTaskStatusLink(s);await this.loadContext()}},watch:{activeTab(){this.$route.query.tab!==this.activeTab&&this.$router.push({query:{tab:this.activeTab}})}},metaInfo(){return{title:`${this.currentProduction.name} | ${this.$t("settings.title")} - Kitsu`}}};var Rt=function(){var t=this,s=t._self._c;return s("div",{staticClass:"production-settings fixed-page"},[s("div",{staticClass:"wrapper"},[s("div",{staticClass:"tabs"},[s("ul",[s("li",{class:{"is-active":t.isActiveTab("parameters")}},[s("a",{on:{click:function(a){t.activeTab="parameters"}}},[t._v(" "+t._s(t.$t("productions.parameters.title"))+" ")])]),s("li",{class:{"is-active":t.isActiveTab("brief")}},[s("a",{on:{click:function(a){t.activeTab="brief"}}},[t._v(" "+t._s(t.$t("productions.brief.title"))+" ")])]),s("li",{class:{"is-active":t.isActiveTab("taskStatus")}},[s("a",{on:{click:function(a){t.activeTab="taskStatus"}}},[t._v(" "+t._s(t.$t("task_status.title"))+" ")])]),s("li",{class:{"is-active":t.isActiveTab("board")}},[s("a",{on:{click:function(a){t.activeTab="board"}}},[t._v(" "+t._s(t.$t("board.settings.title"))+" ")])]),s("li",{class:{"is-active":t.isActiveTab("taskTypes")}},[s("a",{on:{click:function(a){t.activeTab="taskTypes"}}},[t._v(" "+t._s(t.$t("task_types.title"))+" ")])]),s("li",{class:{"is-active":t.isActiveTab("assetTypes")}},[s("a",{on:{click:function(a){t.activeTab="assetTypes"}}},[t._v(" "+t._s(t.$t("asset_types.title"))+" ")])]),s("li",{class:{"is-active":t.isActiveTab("statusAutomations")}},[s("a",{on:{click:function(a){t.activeTab="statusAutomations"}}},[t._v(" "+t._s(t.$t("status_automations.title"))+" ")])]),s("li",{class:{"is-active":t.isActiveTab("backgrounds")}},[s("a",{on:{click:function(a){t.activeTab="backgrounds"}}},[t._v(" "+t._s(t.$t("backgrounds.title"))+" ")])])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("parameters"),expression:"isActiveTab('parameters')"}],staticClass:"tab"},[s("production-parameters")],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("brief"),expression:"isActiveTab('brief')"}],staticClass:"tab"},[s("production-brief")],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("assetTypes"),expression:"isActiveTab('assetTypes')"}],staticClass:"tab"},[s("div",{staticClass:"flexrow mt1 mb1 add-asset-type"},[s("combobox",{staticClass:"flexrow-item",attrs:{options:t.remainingAssetTypes},model:{value:t.assetTypeId,callback:function(a){t.assetTypeId=a},expression:"assetTypeId"}}),s("button",{staticClass:"button flexrow-item",on:{click:t.addAssetType}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1),t.isEmpty(t.currentProduction.asset_types)?s("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")]):s("table",{staticClass:"datatable list"},[s("tbody",{staticClass:"datatable-body"},t._l(t.productionAssetTypes,function(a){return s("tr",{key:a.id,staticClass:"datatable-row"},[s("td",{staticClass:"name"},[t._v(t._s(a.name))]),s("td",[s("button",{staticClass:"button",on:{click:function(o){return t.removeAssetType(a.id)}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])])}),0)])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("taskTypes"),expression:"isActiveTab('taskTypes')"}],staticClass:"tab"},[s("production-task-types")],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("taskStatus"),expression:"isActiveTab('taskStatus')"}],staticClass:"tab"},[t.isEmpty(t.remainingTaskStatuses)?t._e():s("div",{staticClass:"flexrow mt1 mb1 add-task-status"},[s("combobox-status",{staticClass:"flexrow-item selector",attrs:{"task-status-list":t.remainingTaskStatuses},model:{value:t.taskStatusId,callback:function(a){t.taskStatusId=a},expression:"taskStatusId"}}),s("button",{staticClass:"button flexrow-item",on:{click:t.addTaskStatus}},[t._v(" "+t._s(t.$t("main.add"))+" ")])],1),t.isEmpty(t.currentProduction.task_statuses)?s("div",{staticClass:"box"},[t._v(" "+t._s(t.$t("settings.production.empty_list"))+" ")]):s("table",{staticClass:"datatable"},[s("thead",[s("tr",[s("th",{staticClass:"th-name"},[t._v(t._s(t.$t("task_status.fields.name")))]),s("th",{staticClass:"th-short-name"},[t._v(" "+t._s(t.$t("task_status.fields.short_name"))+" ")]),s("th",{staticClass:"th-bool"},[t._v(t._s(t.$t("task_status.fields.is_done")))]),s("th",{staticClass:"th-bool"},[t._v(t._s(t.$t("task_status.fields.is_retake")))]),s("th",{staticClass:"th-bool"},[t._v(" "+t._s(t.$t("task_status.fields.is_artist_allowed"))+" ")]),s("th",{staticClass:"th-bool"},[t._v(" "+t._s(t.$t("task_status.fields.is_client_allowed"))+" ")])])]),s("draggable",{staticClass:"datatable-body",attrs:{draggable:".task-status",tag:"tbody",value:t.sortedProductionTaskStatuses},on:{end:function(a){return t.updateTaskStatusPriority(a.oldIndex,a.newIndex)}}},[t._l(t.sortedProductionTaskStatuses,function(a){return[a?s("tr",{key:a.id,staticClass:"datatable-row task-status"},[s("td",[t._v(" "+t._s(a.name)+" ")]),s("td",{staticClass:"name"},[s("validation-tag",{attrs:{"is-static":!0,task:{task_status_id:a.id}}})],1),s("boolean-cell",{attrs:{value:a.is_done}}),s("boolean-cell",{attrs:{value:a.is_retake}}),s("boolean-cell",{attrs:{value:a.is_artist_allowed}}),s("boolean-cell",{attrs:{value:a.is_client_allowed}}),s("td",[s("button",{staticClass:"button",on:{click:function(o){return t.removeTaskStatus(a.id)}}},[t._v(" "+t._s(t.$t("main.remove"))+" ")])])],1):t._e()]})],2)],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("board"),expression:"isActiveTab('board')"}],staticClass:"tab"},[s("production-board")],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("statusAutomations"),expression:"isActiveTab('statusAutomations')"}],staticClass:"tab"},[s("production-status-automations")],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isActiveTab("backgrounds"),expression:"isActiveTab('backgrounds')"}],staticClass:"tab"},[s("production-backgrounds")],1)])])},Ot=[],Mt=n(Et,Rt,Ot,!1,null,"90813007",null,null);const jt=Mt.exports;export{jt as default};
//# sourceMappingURL=ProductionSettings-Dc3VMdVd.js.map
