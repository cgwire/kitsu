import{_ as y,T as g,a5 as w,a6 as E,cK as S,z as $,r as c,c as b,o as _,e as i,f as l,t as d,w as D,a8 as P,d as v,m as q,a as L,d8 as N,aa as x,k as T,ab as B,ac as V}from"./index-BsDo8rDw.js";import{L as A}from"./ListPageHeader-BPEwk2ux.js";import{R as U}from"./RouteTabs-DwX_Mb3g.js";import{B as I}from"./BooleanCell-B7rYVYxd.js";import{T as M}from"./TaskStatusCell-CPOxiFyC.js";const H={name:"task-status-list",mixins:[$],components:{BooleanCell:I,draggable:S,HelpCircleIcon:E,RowActionsCell:w,TableInfo:g,TaskStatusCell:M},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked","update-priorities"],data(){return{taskStatuses:[]}},mounted(){this.taskStatuses=this.entries},computed:{},methods:{async updateTaskStatusPriorities(){const t=this.taskStatuses.map((s,r)=>({id:s.id,priority:r+1}));this.$emit("update-priorities",t)}},watch:{entries(){this.taskStatuses=this.entries}}},R={class:"data-list"},K={class:"datatable-wrapper"},z={class:"datatable"},F={class:"datatable-head"},G={scope:"col",class:"name"},Q={scope:"col",class:"short-name"},j={scope:"col",class:"is-default"},J={scope:"col",class:"is-wip"},O={scope:"col",class:"is-done"},W={scope:"col",class:"is-retake"},X={scope:"col",class:"is-artist-allowed"},Y={scope:"col",class:"is-client-allowed"},Z={scope:"col",class:"is-feedback-request"},tt={class:"datatable-row task-status"},et={class:"name"},st=["title"],it={class:"has-text-centered nb-task-status"};function at(t,s,r,o,e,n){const k=c("help-circle-icon"),h=c("task-status-cell"),u=c("boolean-cell"),m=c("row-actions-cell"),f=c("draggable"),p=c("table-info");return _(),b("div",R,[i("div",K,[i("table",z,[i("thead",F,[i("tr",null,[i("th",G,d(t.$t("task_status.fields.name")),1),i("th",Q,d(t.$t("task_status.fields.short_name")),1),i("th",j,d(t.$t("task_status.fields.is_default")),1),i("th",J,d(t.$t("task_status.fields.is_wip")),1),i("th",O,d(t.$t("task_status.fields.is_done")),1),i("th",W,d(t.$t("task_status.fields.is_retake")),1),i("th",X,d(t.$t("task_status.fields.is_artist_allowed")),1),i("th",Y,d(t.$t("task_status.fields.is_client_allowed")),1),i("th",Z,d(t.$t("task_status.fields.is_feedback_request")),1),s[1]||(s[1]=i("th",{scope:"col",class:"actions"},null,-1))])]),l(f,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:n.updateTaskStatusPriorities,modelValue:e.taskStatuses,"onUpdate:modelValue":s[0]||(s[0]=a=>e.taskStatuses=a)},{item:D(({element:a})=>[i("tr",tt,[i("td",et,[P(d(a.name)+" ",1),a.description?(_(),b("span",{key:0,title:a.description},[l(k,{class:"icon is-small"})],8,st)):v("",!0)]),l(h,{class:"short-name",entry:a},null,8,["entry"]),l(u,{class:"is-default",value:a.is_default},null,8,["value"]),l(u,{class:"is-wip",value:a.is_wip},null,8,["value"]),l(u,{class:"is-done",value:a.is_done},null,8,["value"]),l(u,{class:"is-retake",value:a.is_retake},null,8,["value"]),l(u,{class:"is-artist-allowed",value:a.is_artist_allowed},null,8,["value"]),l(u,{class:"is-client-allowed",value:a.is_client_allowed},null,8,["value"]),l(u,{class:"is-feedback-request",value:a.is_feedback_request},null,8,["value"]),l(m,{"hide-delete":a.is_default===!0||a.for_concept,onEditClicked:C=>t.$emit("edit-clicked",a),onDeleteClicked:C=>t.$emit("delete-clicked",a)},null,8,["hide-delete","onEditClicked","onDeleteClicked"])])]),_:1},8,["onEnd","modelValue"])])]),l(p,{"is-loading":r.isLoading,"is-error":r.isError},null,8,["is-loading","is-error"]),i("p",it,d(r.entries.length)+" "+d(t.$tc("task_status.number",r.entries.length)),1)])}const lt=y(H,[["render",at],["__scopeId","data-v-0ad95398"]]),ot={name:"task-status",components:{DeleteModal:x,EditTaskStatusModal:N,ListPageHeader:A,RouteTabs:U,TaskStatusList:lt},data(){return{activeTab:"active",entityTab:"entities",entityTabs:[{name:"entities",label:this.$t("entities.title")},{name:"concepts",label:this.$t("concepts.title")}],taskStatusToDelete:null,taskStatusToEdit:{color:"#000000"},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"entities"},computed:{...L(["archivedTaskStatus","taskStatus"]),isActiveTab(){return this.activeTab==="active"},activeTaskStatuses(){return this.isActiveTab?this.taskStatus:this.archivedTaskStatus},taskStatusList(){return this.activeTaskStatuses.filter(t=>!t.for_concept).sort((t,s)=>t.priority-s.priority)},conceptStatusList(){return this.activeTaskStatuses.filter(t=>t.for_concept).sort((t,s)=>t.priority-s.priority)}},methods:{...q(["deleteTaskStatus","updateTaskStatusPriority"]),async updatePriorities(t){for(const s of t)await this.updateTaskStatusPriority(s)},confirmEditTaskStatus(t){const s=!(this.taskStatusToEdit&&this.taskStatusToEdit.id);let r="newTaskStatus";s||(r="saveTaskStatus",t.id=this.taskStatusToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(r,t).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(o=>{console.error(o),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteTaskStatus(){this.loading.del=!0,this.errors.del=!1,this.deleteTaskStatus(this.taskStatusToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(t=>{console.error(t),this.loading.del=!1,this.errors.del=!0})},deleteText(){const t=this.taskStatusToDelete;return t?this.$t("task_status.delete_text",{name:t.name}):""},onExportClicked(){const t=B.slugify(this.$t("task_status.title")),r=[[this.$t("main.type"),this.$t("task_status.fields.name"),this.$t("task_status.fields.short_name"),this.$t("task_status.fields.description"),this.$t("task_status.fields.color"),this.$t("task_status.fields.is_default"),this.$t("task_status.fields.is_wip"),this.$t("task_status.fields.is_done"),this.$t("task_status.fields.is_retake"),this.$t("task_status.fields.is_artist_allowed"),this.$t("task_status.fields.is_client_allowed"),this.$t("task_status.fields.is_feedback_request")]].concat(this.taskStatus.map(o=>[o.type,o.name,o.short_name,o.description,o.color,o.is_default,o.is_wip,o.is_done,o.is_retake,o.is_artist_allowed,o.is_client_allowed,o.is_feedback_request]));V.buildCsvFile(t,r)},onNewClicked(){this.taskStatusToEdit={color:"#000000"},this.modals.edit=!0},onEditClicked(t){this.taskStatusToEdit=t,this.modals.edit=!0},onDeleteClicked(t){this.taskStatusToDelete=t,this.modals.del=!0}},watch:{"$route.query"(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"entities"}},head(){return{title:`${this.$t("task_status.title")} - Kitsu`}}},nt={class:"task-status page fixed-page"},rt={class:"column"};function dt(t,s,r,o,e,n){const k=c("list-page-header"),h=c("route-tabs"),u=c("task-status-list"),m=c("edit-task-status-modal"),f=c("delete-modal");return _(),b("div",nt,[l(k,{title:t.$t("task_status.library_title"),"new-entry-label":t.$t("task_status.new_task_status"),"is-exportable":n.isActiveTab,onExportClicked:n.onExportClicked,onNewClicked:n.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),l(h,{class:"mt2","active-tab":e.activeTab,tabs:e.tabs},null,8,["active-tab","tabs"]),l(h,{"active-tab":e.entityTab,tabs:e.entityTabs,"route-key":"entity"},null,8,["active-tab","tabs"]),i("div",rt,[e.entityTab==="entities"?(_(),T(u,{key:0,entries:n.taskStatusList,"is-loading":e.loading.list,"is-error":e.errors.list,onEditClicked:n.onEditClicked,onDeleteClicked:n.onDeleteClicked,onUpdatePriorities:n.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"])):v("",!0),e.entityTab==="concepts"?(_(),T(u,{key:1,entries:n.conceptStatusList,"is-loading":e.loading.list,"is-error":e.errors.list,onEditClicked:n.onEditClicked,onDeleteClicked:n.onDeleteClicked,onUpdatePriorities:n.updatePriorities},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked","onUpdatePriorities"])):v("",!0)]),l(m,{active:e.modals.edit,"is-loading":e.loading.edit,"is-error":e.errors.edit,"task-status-to-edit":e.taskStatusToEdit,onCancel:s[0]||(s[0]=p=>e.modals.edit=!1),onConfirm:n.confirmEditTaskStatus},null,8,["active","is-loading","is-error","task-status-to-edit","onConfirm"]),l(f,{active:e.modals.del,"is-loading":e.loading.del,"is-error":e.errors.del,text:n.deleteText(),"error-text":t.$t("task_status.delete_error"),onCancel:s[1]||(s[1]=p=>e.modals.del=!1),onConfirm:n.confirmDeleteTaskStatus},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const mt=y(ot,[["render",dt],["__scopeId","data-v-8fac3395"]]);export{mt as default};
//# sourceMappingURL=TaskStatus-CpmMUoiX.js.map
