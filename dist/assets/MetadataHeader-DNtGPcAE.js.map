{"version":3,"file":"MetadataHeader-DNtGPcAE.js","sources":["../../src/components/mixins/selection.js","../../src/components/cells/MetadataHeader.vue"],"sourcesContent":["export const selectionListMixin = {\n  data() {\n    return {\n      shiftKeyPressed: false\n    }\n  },\n\n  methods: {\n    onKeyUp(event) {\n      this.shiftKeyPressed = event.shiftKey\n    },\n\n    onKeyDown(event) {\n      this.shiftKeyPressed = event.shiftKey\n      const lastSelection = this.lastSelection\n        ? this.lastSelection\n        : { x: 0, y: 0 }\n      const i = lastSelection.x\n      const j = lastSelection.y\n      let validationCell = null\n      if (event.altKey && [37, 38, 39, 40].includes(event.keyCode)) {\n        if (event.keyCode === 37) {\n          validationCell = this.select(i, j - 1)\n        } else if (event.keyCode === 38) {\n          validationCell = this.select(i - 1, j)\n        } else if (event.keyCode === 39) {\n          validationCell = this.select(i, j + 1)\n        } else if (event.keyCode === 40) {\n          validationCell = this.select(i + 1, j)\n        }\n        this.scrollToValidationCell(validationCell)\n        this.stopEvent(event)\n      }\n    },\n\n    stopEvent(e) {\n      if (!e) e = window.event\n      e.stopPropagation()\n      e.cancelBubble = true\n      e.returnValue = false\n    },\n\n    setScrollPosition(scrollPosition) {\n      if (this.$refs.body) {\n        this.$refs.body.scrollTop = scrollPosition\n      }\n    },\n\n    setScrollLeftPosition(scrollPosition) {\n      if (this.$refs.body) {\n        this.$refs.body.scrollLeft = scrollPosition\n      }\n    },\n\n    select(i, j) {\n      const validationCell = this.$refs[`validation-${i}-${j}`]?.[0]\n      validationCell?.$el.click()\n      return validationCell\n    },\n\n    scrollToValidationCell(validationCell) {\n      if (validationCell && this.nbSelectedTasks > 0) {\n        this.$nextTick(() => {\n          const margin = 20\n          const headers = document.querySelectorAll(\n            '.datatable-head .datatable-row-header'\n          )\n          let stickyHeaderWidth = 0\n          headers.forEach(h => {\n            stickyHeaderWidth += h.offsetWidth\n          })\n          const rect = validationCell.$el.getBoundingClientRect()\n          const listRect = this.$refs.body.getBoundingClientRect()\n          const isBelow = rect.bottom > listRect.bottom - margin\n          const isAbove = rect.top < listRect.top + margin\n          const isRight = rect.x + rect.width > listRect.width\n          const isLeft = rect.x < stickyHeaderWidth + margin\n\n          if (isBelow) {\n            const scrollingRequired = rect.bottom - listRect.bottom + margin\n            this.setScrollPosition(\n              this.$refs.body.scrollTop + scrollingRequired\n            )\n          } else if (isAbove) {\n            const scrollingRequired = listRect.top - rect.top + 2 * margin\n            this.setScrollPosition(\n              this.$refs.body.scrollTop - scrollingRequired\n            )\n          }\n\n          if (isRight) {\n            const scrollingRequired = rect.right - listRect.right + margin\n            this.setScrollLeftPosition(\n              this.$refs.body.scrollLeft + scrollingRequired\n            )\n          } else if (isLeft) {\n            const scrollingRequired = stickyHeaderWidth - rect.left + 2 * margin\n            this.setScrollLeftPosition(\n              this.$refs.body.scrollLeft - scrollingRequired\n            )\n          }\n        })\n      }\n    }\n  }\n}\n","<template>\n  <th\n    scope=\"col\"\n    class=\"metadata-descriptor\"\n    :class=\"{ 'datatable-row-header': isStick }\"\n    :style=\"{ left }\"\n  >\n    <div class=\"flexrow metadata-wrapper-header\">\n      <department-name\n        :key=\"department.id\"\n        :department=\"department\"\n        no-padding\n        only-dot\n        v-for=\"department in currentDepartments\"\n      />\n      <span\n        class=\"flexrow-item ellipsis descriptor-name\"\n        :title=\"descriptor.name\"\n      >\n        {{ descriptor.name }}\n      </span>\n\n      <span\n        class=\"metadata-menu-button header-icon pointer\"\n        @click=\"$emit('show-metadata-header-menu', $event)\"\n        v-if=\"!noMenu\"\n      >\n        <chevron-down-icon :size=\"14\" />\n      </span>\n    </div>\n  </th>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\nimport { ChevronDownIcon } from 'lucide-vue-next'\n\nimport DepartmentName from '@/components/widgets/DepartmentName.vue'\n\nexport default {\n  name: 'metadata-header',\n\n  props: {\n    descriptor: Object,\n    isStick: {\n      type: Boolean,\n      default: false\n    },\n    left: {\n      type: String,\n      default: '0px'\n    },\n    noMenu: {\n      type: Boolean,\n      default: false\n    }\n  },\n\n  components: {\n    ChevronDownIcon,\n    DepartmentName\n  },\n\n  emits: ['show-metadata-header-menu'],\n\n  computed: {\n    ...mapGetters(['departmentMap']),\n\n    currentDepartments() {\n      const departemts = this.descriptor.departments || []\n      return departemts.map(departmentId =>\n        this.departmentMap.get(departmentId)\n      )\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\nth.metadata-descriptor {\n  min-width: 120px;\n  max-width: 120px;\n  width: 120px;\n  overflow-wrap: break-word;\n  hyphens: auto;\n}\n\n.metadata-wrapper-header {\n  position: relative;\n}\n\n.metadata-menu-button {\n  background: var(--background-alt);\n  border-radius: 50%;\n  height: 16px;\n  width: 16px;\n  padding: 1px;\n  position: absolute;\n  right: 0;\n}\n</style>\n"],"names":["selectionListMixin","event","lastSelection","i","j","validationCell","scrollPosition","headers","stickyHeaderWidth","h","rect","listRect","isBelow","isAbove","isRight","isLeft","scrollingRequired","_sfc_main","ChevronDownIcon","DepartmentName","mapGetters","departmentId","_hoisted_1","_hoisted_2","_createElementBlock","_normalizeClass","$props","_normalizeStyle","_createElementVNode","_openBlock","_Fragment","_renderList","$options","department","_createBlock","_component_department_name","_createCommentVNode","_cache","$event","_ctx","_createVNode","_component_chevron_down_icon"],"mappings":"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"}