import{_,r,o as v,c as g,d as s,t as m,f as n,al as u,am as h,an as S,ao as b,ap as y,aq as x,a as I,b as z,m as p}from"./index-Dw-uod2x.js";import{C as k}from"./ComboboxNumber-CFsoz7te.js";import{D as P}from"./DateField-BoSZf4Hb.js";import{S as V}from"./Schedule-BRfI1kcB.js";import"./dom-tO7tlkHV.js";import"./format-fMWuo47O.js";import"./DepartmentName-kmEXEkam.js";import"./ModalFooter-Dmgqo0ae.js";import"./TextField-EpYNDuEI.js";import"./list-chevrons-up-down-CP19ULh5.js";import"./briefcase-RN42S3yy.js";const w={name:"main-schedule",components:{ComboboxNumber:k,DateField:P,Schedule:V},data(){return{endDate:p().add(6,"months"),scheduleItems:[],startDate:p(),selectedStartDate:null,selectedEndDate:null,zoomLevel:0,zoomOptions:[{label:this.$t("main.week"),value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3}],loading:{schedule:!1},errors:{schedule:!1}}},mounted(){let e=parseInt(this.$route.query.zoom);e=isNaN(e)?1:e,this.zoomLevel=Math.min(Math.max(e,0),3),this.init()},computed:{...z(["openProductions","taskTypeMap","user"])},methods:{...I(["editProduction","loadScheduleItems","saveScheduleItem"]),init(){this.openProductions.length&&(this.scheduleItems=this.convertScheduleItems(this.openProductions),this.startDate=y(this.scheduleItems),this.endDate=x(this.scheduleItems),this.selectedStartDate=this.startDate.toDate(),this.selectedEndDate=this.endDate.toDate())},convertScheduleItems(e){return e.map(t=>{const o=u(t.start_date),d=h(o,t.end_date);return{...t,avatar:t.type==="Project",color:t.color||b.fromString(t.name,!0),startDate:o,endDate:d,expanded:!1,loading:!1,editable:!0,route:S(t.id),children:[]}})},convertTaskTypeScheduleItems(e){return e.map(t=>{const o=u(t.start_date),d=h(o,t.end_date),a=this.taskTypeMap.get(t.task_type_id);return{...t,name:a.name,color:a.color,startDate:o,endDate:d,expanded:!1,loading:!1,editable:!0,children:[]}})},expandProductionElement(e){e.expanded?e.expanded=!1:(e.loading=!0,e.expanded=!0,this.loadScheduleItems(e).then(t=>{t=this.convertTaskTypeScheduleItems(t),e.children=t,e.loading=!1}))},onScheduleItemChanged(e){e.type!=="Project"?this.saveScheduleItem(e):this.editProduction({id:e.id,start_date:e.startDate.format("YYYY-MM-DD"),end_date:e.endDate.format("YYYY-MM-DD")})},updateRoute({zoom:e}){const t={...this.$route.query};e!==void 0&&(t.zoom=String(e)),JSON.stringify(t)!==JSON.stringify(this.$route.query)&&this.$router.push({query:t})}},watch:{zoomLevel(e){this.updateRoute({zoom:e})}},head(){return{title:`${this.$t("schedule.title_main")} - Kitsu`}}},M={class:"columns fixed-page"},Y={class:"column main-column"},C={class:"flexrow project-dates"},E={class:"flexrow-item"},L={class:"label"},N={class:"flexrow-item field"},T={class:"label"};function q(e,t,o,d,a,i){const c=r("date-field"),f=r("combobox-number"),D=r("schedule");return v(),g("div",M,[s("div",Y,[s("div",C,[s("div",E,[s("label",L,m(e.$t("main.start_date")),1),n(c,{"week-days-disabled":"",modelValue:a.selectedStartDate,"onUpdate:modelValue":t[0]||(t[0]=l=>a.selectedStartDate=l)},null,8,["modelValue"])]),s("div",N,[s("label",T,m(e.$t("main.end_date")),1),n(c,{"week-days-disabled":"",modelValue:a.selectedEndDate,"onUpdate:modelValue":t[1]||(t[1]=l=>a.selectedEndDate=l)},null,8,["modelValue"])]),n(f,{class:"flexrow-item zoom-level",label:e.$t("schedule.zoom_level"),options:a.zoomOptions,modelValue:a.zoomLevel,"onUpdate:modelValue":t[2]||(t[2]=l=>a.zoomLevel=l)},null,8,["label","options","modelValue"])]),n(D,{"end-date":a.endDate,hierarchy:a.scheduleItems,"is-loading":a.loading.schedule,"is-error":a.errors.schedule,"start-date":a.startDate,"zoom-level":a.zoomLevel,"hide-man-days":!0,"with-milestones":!1,onItemChanged:i.onScheduleItemChanged,onRootElementExpanded:i.expandProductionElement},null,8,["end-date","hierarchy","is-loading","is-error","start-date","zoom-level","onItemChanged","onRootElementExpanded"])])])}const Q=_(w,[["render",q],["__scopeId","data-v-52a9f586"]]);export{Q as default};
//# sourceMappingURL=MainSchedule-CL502YFr.js.map
