import{_,T as p,a4 as E,r as n,c as m,o as c,e as i,f as d,t as u,F as C,g as T,a7 as B,ac as w,ad as y,ae as $,af as F,ag as x,ah as D,ai as V,d as v,k as L,n as N,m as M,a as S,a9 as U}from"./index-C9eTF2EQ.js";import{B as q}from"./BooleanCell-go_sLrlR.js";import{L as A}from"./ListPageHeader-CMgvF3Wc.js";import{R as I}from"./RouteTabs-BSitokqt.js";const R={name:"background-list",props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{BooleanCell:q,RowActionsCell:E,TableInfo:p},emits:["delete-clicked","edit-clicked"]},j={class:"data-list"},z={class:"datatable-wrapper"},G={class:"datatable"},H={class:"datatable-head"},K={scope:"col",class:"name"},O={scope:"col",class:"is-default"},P={class:"datatable-body"},J={class:"name"},Q={class:"flexrow"},W=["href"],X=["src","alt"],Y={class:"has-text-centered"};function Z(e,t,l,k,o,a){const f=n("boolean-cell"),b=n("row-actions-cell"),g=n("table-info");return c(),m("div",j,[i("div",z,[i("table",G,[i("thead",H,[i("tr",null,[i("th",K,u(e.$t("backgrounds.fields.name")),1),i("th",O,u(e.$t("backgrounds.fields.is_default")),1),t[0]||(t[0]=i("th",{scope:"col",class:"actions"},null,-1))])]),i("tbody",P,[(c(!0),m(C,null,T(l.entries,s=>(c(),m("tr",{class:"datatable-row",key:s.id},[i("td",J,[i("span",Q,[i("a",{href:s.url,target:"_blank",class:"thumbnail-wrapper thumbnail-picture entity-thumbnail flexrow-item"},[i("img",{src:s.thumbnail,alt:s.name,width:"100",height:"67"},null,8,X)],8,W),B(" "+u(s.name),1)])]),d(f,{class:"is-default",value:s.is_default},null,8,["value"]),d(b,{"hide-delete":s.is_default===!0,onEditClicked:h=>e.$emit("edit-clicked",s),onDeleteClicked:h=>e.$emit("delete-clicked",s)},null,8,["hide-delete","onEditClicked","onDeleteClicked"])]))),128))])])]),d(g,{"is-loading":l.isLoading,"is-error":l.isError},null,8,["is-loading","is-error"]),i("p",Y,u(l.entries.length)+" "+u(e.$tc("backgrounds.number",l.entries.length)),1)])}const ee=_(R,[["render",Z],["__scopeId","data-v-1450c13a"]]),te={name:"edit-background-modal",mixins:[D],components:{BooleanField:x,ComboboxBoolean:F,FileUpload:$,ModalFooter:y,TextField:w},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},backgroundToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{file:null,name:"",is_default:"false",archived:"false"}}},computed:{isEditing(){return this.backgroundToEdit?.id}},methods:{confirmClicked(){if(!(!this.isEditing&&!this.form.file)){if(!this.form.name){this.$refs.nameField.focus();return}this.$emit("confirm",{...this.form,is_default:this.form.is_default==="true",archived:this.form.archived==="true"})}},onFileSelected(e){const t=e.get("file");this.form.file=e,this.form.name.length||(this.form.name=t.name.slice(0,-4)),this.$nextTick(()=>{this.$refs.nameField.focus()})},resetForm(){this.backgroundToEdit&&(this.form={file:null,name:this.backgroundToEdit.name||"",is_default:String(this.backgroundToEdit.is_default||!1),archived:String(this.backgroundToEdit.archived||!1)},this.$refs.fileUpload?.reset())}},watch:{backgroundToEdit(){this.resetForm()},active(){this.active&&this.resetForm()}}},oe={class:"modal-content"},ie={class:"box"},ae={key:0,class:"title"},le={key:1,class:"title"},se={key:0,class:"field"},ne={class:"label"};function de(e,t,l,k,o,a){const f=n("file-upload"),b=n("text-field"),g=n("boolean-field"),s=n("combobox-boolean"),h=n("modal-footer");return c(),m("div",{class:N({modal:!0,"is-active":l.active})},[i("div",{class:"modal-background",onClick:t[0]||(t[0]=r=>e.$emit("cancel"))}),i("div",oe,[i("div",ie,[a.isEditing?(c(),m("h1",ae,u(e.$t("backgrounds.edit_background"))+" "+u(l.backgroundToEdit.name),1)):(c(),m("h1",le,u(e.$t("backgrounds.new_background")),1)),i("form",{onSubmit:t[4]||(t[4]=V(()=>{},["prevent"]))},[a.isEditing?v("",!0):(c(),m("div",se,[i("label",ne,u(e.$t("backgrounds.fields.file")),1),d(f,{ref:"fileUpload",label:e.$t("main.select_file"),accept:".hdr","is-primary":!1,onFileselected:a.onFileSelected},null,8,["label","onFileselected"])])),d(b,{ref:"nameField","input-class":"task-status-name",label:e.$t("backgrounds.fields.name"),maxlength:40,onEnter:a.confirmClicked,modelValue:o.form.name,"onUpdate:modelValue":t[1]||(t[1]=r=>o.form.name=r),modelModifiers:{trim:!0}},null,8,["label","onEnter","modelValue"]),d(g,{"is-field":"",label:e.$t("backgrounds.fields.is_default"),onEnter:a.confirmClicked,modelValue:o.form.is_default,"onUpdate:modelValue":t[2]||(t[2]=r=>o.form.is_default=r)},null,8,["label","onEnter","modelValue"]),a.isEditing?(c(),L(s,{key:1,label:e.$t("main.archived"),onEnter:a.confirmClicked,modelValue:o.form.archived,"onUpdate:modelValue":t[3]||(t[3]=r=>o.form.archived=r)},null,8,["label","onEnter","modelValue"])):v("",!0)],32),d(h,{"error-text":e.$t("backgrounds.create_error"),"is-error":l.isError,"is-loading":l.isLoading,onConfirm:a.confirmClicked,onCancel:t[5]||(t[5]=r=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const re=_(te,[["render",de],["__scopeId","data-v-ad2abf5d"]]),ce={name:"backgrounds",components:{BackgroundList:ee,DeleteModal:U,EditBackgroundModal:re,ListPageHeader:A,RouteTabs:I},data(){return{activeTab:"active",backgroundToEdit:{},backgroundToDelete:{},modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}]}},mounted(){this.activeTab=this.$route.query.tab||"active"},computed:{...S(["archivedBackgrounds","backgrounds"]),backgroundsList(){return this.activeTab==="active"?this.backgrounds:this.archivedBackgrounds}},methods:{...M(["deleteBackground"]),confirmEditBackground(e){const t=!this.backgroundToEdit?.id;let l="newBackground";t||(l="saveBackground",e.id=this.backgroundToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(l,e).then(()=>{this.modals.edit=!1}).catch(k=>{console.error(k),this.errors.edit=!0}).finally(()=>{this.loading.edit=!1})},confirmDeleteBackground(){this.loading.del=!0,this.errors.del=!1,this.deleteBackground(this.backgroundToDelete).then(()=>{this.modals.del=!1}).catch(e=>{console.error(e),this.errors.del=!0}).finally(()=>{this.loading.del=!1})},deleteText(){const e=this.backgroundToDelete;return e?this.$t("backgrounds.delete_text",{name:e.name}):""},onNewClicked(){this.backgroundToEdit={},this.modals.edit=!0},onEditClicked(e){this.backgroundToEdit=e,this.modals.edit=!0},onDeleteClicked(e){this.backgroundToDelete=e,this.modals.del=!0}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("backgrounds.title")} - Kitsu`}}},ue={class:"backgrounds page fixed-page"};function me(e,t,l,k,o,a){const f=n("list-page-header"),b=n("route-tabs"),g=n("background-list"),s=n("edit-background-modal"),h=n("delete-modal");return c(),m("div",ue,[d(f,{title:e.$t("backgrounds.library_title"),"new-entry-label":e.$t("backgrounds.new_background"),"is-exportable":!1,onNewClicked:a.onNewClicked},null,8,["title","new-entry-label","onNewClicked"]),d(b,{class:"mt2","active-tab":o.activeTab,tabs:o.tabs},null,8,["active-tab","tabs"]),d(g,{entries:a.backgroundsList,"is-loading":o.loading.list,"is-error":o.errors.list,onEditClicked:a.onEditClicked,onDeleteClicked:a.onDeleteClicked},null,8,["entries","is-loading","is-error","onEditClicked","onDeleteClicked"]),d(s,{active:o.modals.edit,"is-loading":o.loading.edit,"is-error":o.errors.edit,"background-to-edit":o.backgroundToEdit,onCancel:t[0]||(t[0]=r=>o.modals.edit=!1),onConfirm:a.confirmEditBackground},null,8,["active","is-loading","is-error","background-to-edit","onConfirm"]),d(h,{active:o.modals.del,"is-loading":o.loading.del,"is-error":o.errors.del,text:a.deleteText(),"error-text":e.$t("backgrounds.delete_error"),onCancel:t[1]||(t[1]=r=>o.modals.del=!1),onConfirm:a.confirmDeleteBackground},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const ke=_(ce,[["render",me]]);export{ke as default};
//# sourceMappingURL=Backgrounds-DvbYXS9S.js.map
