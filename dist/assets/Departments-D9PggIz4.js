import{_ as T,aO as $,aP as S,aE as L,c as l,o as r,e as n,t as d,F as I,g,n as D,f,ay as H,T as V,a4 as q,r as h,d as C,G as x,ac as B,ad as F,af as N,aQ as j,ah as A,j as U,ai as M,l as O,k as y,m as R,a as z,a9 as G,aa as P,ab as K}from"./index-bqLtaTTG.js";import{L as Q}from"./ListPageHeader-BPC3vGLb.js";import{R as J}from"./RouteTabs-UkiWMUph.js";const W={class:"columns"},X={class:"column column-departments"},Y={class:"label"},Z={class:"element-list"},ee=["onClick"],te={class:"column column-middle"},ie={class:"label"},se={class:"element-list"},ne={key:0},ae={key:1},re=["onClick"],de={class:"item-info"},le={class:"column column-hardware"},oe={class:"label"},me={class:"element-list"},ce=["onClick"],he={__name:"DepartmentLinks",props:{items:{type:Array,required:!0},linkedItems:{type:Object,required:!0}},emits:["link-item","unlink-item"],setup(e,{emit:t}){const a=$(),k=e,i=t,s=S(null),v=L(()=>a.getters.departments),_=L(()=>k.linkedItems[s.value?.id]||[]),m=L(()=>{const o=_.value.map(b=>b.id);return k.items.filter(b=>!o.includes(b.id))}),p=o=>{s.value=s.value===o?null:o},w=o=>{s.value&&i("link-item",{departmentId:s.value.id,itemId:o.id})},u=o=>{s.value&&i("unlink-item",{departmentId:s.value.id,itemId:o.id})};return(o,b)=>(r(),l("div",W,[n("div",X,[n("label",Y,d(o.$t("departments.title")),1),n("ul",Z,[(r(!0),l(I,null,g(v.value,c=>(r(),l("li",{class:D({selected:s.value&&s.value.id===c.id}),key:c.id,onClick:E=>p(c)},[f(H,{department:c},null,8,["department"])],10,ee))),128))])]),n("div",te,[n("label",ie,d(o.$t("departments.linked_items")),1),n("ul",se,[s.value===null?(r(),l("li",ne,d(o.$t("departments.select_department")),1)):e.linkedItems.length===0?(r(),l("li",ae,d(o.$t("departments.no_items_linked")),1)):(r(!0),l(I,{key:2},g(_.value,c=>(r(),l("li",{key:c.id,onClick:E=>u(c)},[n("div",de,d(c.name),1)],8,re))),128))])]),n("div",le,[n("label",oe,d(o.$t("departments.available_items")),1),n("ul",me,[(r(!0),l(I,null,g(m.value,c=>(r(),l("li",{key:c.id,onClick:E=>w(c)},d(c.name),9,ce))),128))])])]))}},pe=T(he,[["__scopeId","data-v-1469b819"]]),ue={name:"department-list",emits:["delete-clicked","edit-clicked"],components:{RowActionsCell:q,TableInfo:V},props:{entries:{type:Array,required:!0},isLoading:{type:Boolean,required:!0},isError:{type:Boolean,required:!0},linkedHardwareItems:{type:Object,required:!0},linkedSoftwareLicenses:{type:Object,required:!0}}},fe={class:"data-list"},ke={class:"datatable-wrapper"},_e={class:"datatable"},ve={class:"datatable-head"},we={scope:"col",class:"name"},be={scope:"col"},Ie={scope:"col"},ge={scope:"col"},Ce={key:0,class:"datatable-body"},Te={class:"name"},Le={class:"color"},ye={class:"items"},Ee={class:"items"},De={class:"has-text-centered nb-asset-types"};function $e(e,t,a,k,i,s){const v=h("row-actions-cell"),_=h("table-info");return r(),l("div",fe,[n("div",ke,[n("table",_e,[n("thead",ve,[n("tr",null,[n("th",we,d(e.$t("departments.fields.name")),1),n("th",be,d(e.$t("departments.fields.color")),1),n("th",Ie,d(e.$t("departments.hardware_used_by_artists")),1),n("th",ge,d(e.$t("departments.software_used_by_artists")),1),t[0]||(t[0]=n("th",{scope:"col",class:"actions"},null,-1))])]),a.entries.length>0?(r(),l("tbody",Ce,[(r(!0),l(I,null,g(a.entries,m=>(r(),l("tr",{class:"datatable-row",key:m.id},[n("td",Te,d(m.name),1),n("td",Le,[n("div",null,[n("span",{style:x({background:m.color})},null,4)])]),n("td",ye,d(a.linkedHardwareItems[m.id]?.map(p=>p.name).join(", ")),1),n("td",Ee,d(a.linkedSoftwareLicenses[m.id]?.map(p=>p.name).join(", ")),1),f(v,{onEditClicked:p=>e.$emit("edit-clicked",m),onDeleteClicked:p=>e.$emit("delete-clicked",m)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):C("",!0)])]),f(_,{"is-loading":a.isLoading,"is-error":a.isError},null,8,["is-loading","is-error"]),n("p",De,d(a.entries.length)+" "+d(e.$tc("departments.number",a.entries.length)),1)])}const Se=T(ue,[["render",$e],["__scopeId","data-v-23ebe73e"]]),He={name:"edit-departments-modal",mixins:[A],components:{ColorField:j,ComboboxBoolean:N,ModalFooter:F,TextField:B},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},departmentToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm"],data(){return{form:{id:null,name:"",color:"",archived:"false"}}},computed:{isEditing(){return this.departmentToEdit?.id}},methods:{runConfirmation(){this.$emit("confirm",this.form)}},watch:{active(){this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},departmentToEdit(){this.isEditing?this.form={id:this.departmentToEdit.id,name:this.departmentToEdit.name,color:this.departmentToEdit.color,archived:String(this.departmentToEdit.archived===!0)}:this.form={id:null,name:"",color:"",archived:"false"}}}},Ve={class:"modal-content"},qe={class:"box"},xe={key:0,class:"title"},Be={key:1,class:"title"};function Fe(e,t,a,k,i,s){const v=h("text-field"),_=h("color-field"),m=h("combobox-boolean"),p=h("modal-footer"),w=U("focus");return r(),l("div",{class:D(["modal",{"is-active":a.active}])},[n("div",{class:"modal-background",onClick:t[0]||(t[0]=u=>e.$emit("cancel"))}),n("div",Ve,[n("div",qe,[s.isEditing?(r(),l("h1",xe,d(e.$t("departments.edit_title"))+" "+d(a.departmentToEdit.name),1)):(r(),l("h1",Be,d(e.$t("departments.new_departments")),1)),n("form",{onSubmit:t[4]||(t[4]=M(()=>{},["prevent"]))},[O(f(v,{ref:"nameField",label:e.$t("departments.fields.name"),maxlength:30,modelValue:i.form.name,"onUpdate:modelValue":t[1]||(t[1]=u=>i.form.name=u)},null,8,["label","modelValue"]),[[w]]),f(_,{label:e.$t("departments.fields.color"),modelValue:i.form.color,"onUpdate:modelValue":t[2]||(t[2]=u=>i.form.color=u)},null,8,["label","modelValue"]),s.isEditing?(r(),y(m,{key:0,label:e.$t("main.archived"),onEnter:s.runConfirmation,modelValue:i.form.archived,"onUpdate:modelValue":t[3]||(t[3]=u=>i.form.archived=u)},null,8,["label","onEnter","modelValue"])):C("",!0)],32),f(p,{"error-text":e.$t("departments.create_error"),"is-error":a.isError,"is-loading":a.isLoading,onConfirm:s.runConfirmation,onCancel:t[5]||(t[5]=u=>e.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const Ne=T(He,[["render",Fe],["__scopeId","data-v-2977a63b"]]),je={name:"departments",components:{DeleteModal:G,DepartmentLinks:pe,DepartmentList:Se,EditDepartmentsModal:Ne,ListPageHeader:Q,RouteTabs:J},data(){return{activeTab:"active",departmentToEdit:null,departmentToDelete:null,linkedHardwareItems:{},linkedSoftwareLicenses:{},errors:{departments:!1,edit:!1,del:!1},loading:{departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")},{name:"linked-hardware",label:this.$t("departments.linked_hardware")},{name:"linked-software",label:this.$t("departments.linked_software")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.loading.departments=!0,this.errors.departments=!1;try{await this.loadDepartments(),await this.loadHardwareItems(),await this.loadSoftwareLicenses(),this.linkedHardwareItems=await this.loadLinkedHardwareItems(),this.linkedSoftwareLicenses=await this.loadLinkedSoftwareLicenses()}catch(e){console.error(e),this.errors.departments=!0}this.loading.departments=!1},computed:{...z(["departments","archivedDepartments","hardwareItems","softwareLicenses"]),isActiveTab(){return this.activeTab==="active"},departmentList(){return this.isActiveTab?this.departments:this.archivedDepartments},deleteText(){return this.departmentToDelete?this.$t("departments.delete_text",{name:this.departmentToDelete.name}):""},linkedItems(){return this.activeTab==="linked-hardware"?this.linkedHardwareItems:this.linkedSoftwareLicenses},items(){return this.activeTab==="linked-hardware"?this.hardwareItems:this.softwareLicenses}},methods:{...R(["deleteDepartment","linkHardwareItem","linkSoftwareLicense","loadDepartments","loadHardwareItems","loadSoftwareLicenses","loadLinkedHardwareItems","loadLinkedSoftwareLicenses","unlinkHardwareItem","unlinkSoftwareLicense"]),onExportClicked(){const e=P.slugify(this.$t("departments.title")),a=[[this.$t("main.type"),this.$t("departments.fields.name"),this.$t("departments.fields.color")]].concat(this.departments.map(k=>[k.type,k.name,k.color]));K.buildCsvFile(e,a)},onNewClicked(){this.departmentToEdit={name:"",color:"#999999"},this.modals.edit=!0},onEditClicked(e){this.departmentToEdit=e,this.modals.edit=!0},confirmEditDepartment(e){let t="newDepartment";this.departmentToEdit&&this.departmentToEdit.id&&(t="editDepartment",e.id=this.departmentToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(()=>{this.loading.edit=!1,this.errors.edit=!0})},onDeleteClicked(e){this.departmentToDelete=e,this.modals.del=!0},async confirmDeleteDepartment(){this.loading.del=!0,this.errors.del=!1;try{await this.deleteDepartment(this.departmentToDelete),this.loading.del=!1,this.modals.del=!1}catch{this.loading.del=!1,this.errors.del=!0}},onLinkItem(e){if(this.activeTab==="linked-hardware"){this.linkHardwareItem({hardwareItemId:e.itemId,departmentId:e.departmentId});const t=this.hardwareItems.find(a=>a.id===e.itemId);this.linkedHardwareItems[e.departmentId]||(this.linkedHardwareItems[e.departmentId]=[]),this.linkedHardwareItems[e.departmentId].push(t)}else if(this.activeTab==="linked-software"){this.linkSoftwareLicense({softwareLicenseId:e.itemId,departmentId:e.departmentId});const t=this.softwareLicenses.find(a=>a.id===e.itemId);this.linkedSoftwareLicenses[e.departmentId]||(this.linkedSoftwareLicenses[e.departmentId]=[]),this.linkedSoftwareLicenses[e.departmentId].push(t)}},onUnlinkItem(e){this.activeTab==="linked-hardware"?(this.unlinkHardwareItem({hardwareItemId:e.itemId,departmentId:e.departmentId}),this.linkedHardwareItems[e.departmentId]=this.linkedHardwareItems[e.departmentId].filter(t=>t.id!==e.itemId)):this.activeTab==="linked-software"&&(this.unlinkSoftwareLicense({softwareLicenseId:e.itemId,departmentId:e.departmentId}),this.linkedSoftwareLicenses[e.departmentId]=this.linkedSoftwareLicenses[e.departmentId].filter(t=>t.id!==e.itemId))}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},head(){return{title:`${this.$t("departments.title")} - Kitsu`}}},Ae={class:"departments page fixed-page"};function Ue(e,t,a,k,i,s){const v=h("list-page-header"),_=h("route-tabs"),m=h("department-list"),p=h("department-links"),w=h("edit-departments-modal"),u=h("delete-modal");return r(),l("div",Ae,[f(v,{title:e.$t("departments.title"),"new-entry-label":e.$t("departments.new_departments"),"is-exportable":s.isActiveTab,onExportClicked:s.onExportClicked,onNewClicked:s.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),f(_,{class:"tabs","active-tab":i.activeTab,tabs:i.tabs},null,8,["active-tab","tabs"]),i.activeTab==="active"||i.activeTab==="archived"?(r(),y(m,{key:0,class:"department-list",entries:s.departmentList,"is-loading":i.loading.departments,"is-error":i.errors.departments,"linked-hardware-items":i.linkedHardwareItems,"linked-software-licenses":i.linkedSoftwareLicenses,onEditClicked:s.onEditClicked,onDeleteClicked:s.onDeleteClicked},null,8,["entries","is-loading","is-error","linked-hardware-items","linked-software-licenses","onEditClicked","onDeleteClicked"])):C("",!0),i.activeTab==="linked-hardware"||i.activeTab==="linked-software"?(r(),y(p,{key:1,type:i.activeTab,"linked-items":s.linkedItems,items:s.items,onLinkItem:s.onLinkItem,onUnlinkItem:s.onUnlinkItem},null,8,["type","linked-items","items","onLinkItem","onUnlinkItem"])):C("",!0),f(w,{active:i.modals.edit,"is-loading":i.loading.edit,"is-error":i.errors.edit,"department-to-edit":i.departmentToEdit,onCancel:t[0]||(t[0]=o=>i.modals.edit=!1),onConfirm:s.confirmEditDepartment},null,8,["active","is-loading","is-error","department-to-edit","onConfirm"]),f(u,{active:i.modals.del,"is-loading":i.loading.del,"is-error":i.errors.del,text:s.deleteText,"error-text":e.$t("departments.delete_error"),onCancel:t[1]||(t[1]=o=>i.modals.del=!1),onConfirm:s.confirmDeleteDepartment},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const ze=T(je,[["render",Ue],["__scopeId","data-v-94de533a"]]);export{ze as default};
//# sourceMappingURL=Departments-D9PggIz4.js.map
