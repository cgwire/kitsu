import{_ as V,m as v,a as C,bG as x,bH as B,H as M,I as P,K as E,J as j,C as G,b as O,B as U,r as n,c as f,o as p,e as d,d as u,f as r,k,l as D,a1 as F,t as h,a3 as _,bI as N,p as c,bJ as K,A,M as H,bK as J}from"./index-DKuAAOtP.js";const q={name:"my-checks",components:{ButtonSimple:U,Combobox:O,ComboboxProduction:G,ComboboxStatus:j,ComboboxTaskType:E,PeopleField:P,TaskInfo:M,TodosList:B,ViewPlaylistModal:x},data(){return{currentFilter:"all_tasks",currentSort:"priority",episodeId:"",isLoading:!1,isLoadingError:!1,isPlaylist:!1,filterOptions:["all_tasks","due_this_week"].map(e=>({label:e,value:e})),person:{},productionId:"",productionList:[],selectionGrid:{},sortOptions:["entity_name","priority","due_date","estimation","last_comment_date"].map(e=>({label:e,value:e})),taskStatusId:"",taskTypeId:"",taskStatusList:[],taskTypeList:[],tasksToCheck:[]}},mounted(){this.isLoading=!0,this.clearSelectedTasks(),this.loadTasksToCheck().then(e=>{e&&(e.forEach(J),this.buildSelectionGrid(e),this.resetProductionList(e),this.resetTaskTypeList(e),this.resetTaskStatusList(e),this.tasksToCheck=e,this.isLoading=!1)}).catch(e=>{console.error(e)})},computed:{...C(["nbSelectedTasks","personMap","productionMap","selectedTasks","taskStatusMap","taskTypeMap"]),nbTasksToCheck(){return this.sortedTasks.filter(e=>this.taskStatusMap.get(e.task_status_id).is_feedback_request).length},assignees(){const e=[],t={};return this.tasksToCheck.forEach(l=>{l.assignees.forEach(o=>{t[o]||(e.push(this.personMap.get(o)),t[o]=!0)})}),H(e)},episodeOptions(){const e=[],t={};return this.productionId?this.productionMap.get(this.productionId).production_type!=="tvshow"?[]:(this.tasksToCheck.filter(o=>o.project_id===this.productionId).forEach(o=>{o.episode_id&&!t[o.episode_id]&&o.entity_type_name==="Shot"&&(t[o.episode_id]=!0,e.push({label:o.episode_name,value:o.episode_id}))}),[{label:this.$t("main.all"),value:"all"}].concat(e.sort((o,s)=>o.label.localeCompare(s.label,void 0,{numeric:!0})))):[]},filteredTasks(){let e=this.currentFilter==="all_tasks"?[...this.tasksToCheck]:this.tasksToCheck.filter(t=>{const l=K(t.due_date);return A().startOf("week").isSame(l,"week")});return this.productionId!==""&&(e=e.filter(t=>t.project_id===this.productionId)),this.taskTypeId!==""&&(e=e.filter(t=>t.task_type_id===this.taskTypeId)),this.taskStatusId!==""&&(e=e.filter(t=>t.task_status_id===this.taskStatusId)),this.person&&this.person.id&&(e=e.filter(t=>t.assignees.includes(this.person.id))),this.productionId&&this.episodeId&&this.episodeId!=="all"&&(e=e.filter(t=>t.episode_id===this.episodeId)),e},sortedTasks(){const e=this.currentSort==="entity_name",t=this.currentSort==="priority",l=this.currentSort==="due_date",o=[...this.filteredTasks];return e?o.sort(c("project_name").thenBy("task_type_name").thenBy("full_entity_name")):t?o.sort(c("priority",-1).thenBy((s,a)=>s.due_date?a.due_date?s.due_date.localeCompare(a.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):l?o.sort(c((s,a)=>s.due_date?a.due_date?s.due_date.localeCompare(a.due_date):-1:1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name")):o.sort(c(this.currentSort,-1).thenBy("project_name").thenBy("task_type_name").thenBy("entity_name"))}},methods:{...v(["clearSelectedTasks","loadTasksToCheck"]),buildSelectionGrid(e){this.selectionGrid=N(e.length,1)},resetProductionList(e=[]){const t={},l=[];e.forEach(o=>{t[o.project_id]||(t[o.project_id]=!0,l.push(this.productionMap.get(o.project_id)))}),this.productionList=[{id:"",name:this.$t("main.all")}].concat(_(l))},resetTaskTypeList(e){const t={},l=[];e.forEach(o=>{t[o.task_type_id]||(t[o.task_type_id]=!0,l.push(this.taskTypeMap.get(o.task_type_id)))}),this.taskTypeList=[{id:"",color:"#999",name:this.$t("news.all")}].concat(_(l))},resetTaskStatusList(e){const t={},l=[];e.forEach(o=>{t[o.task_status_id]||(t[o.task_status_id]=!0,l.push(this.taskStatusMap.get(o.task_status_id)))}),this.taskStatusList=[{id:"",color:"#999",name:this.$t("news.all"),short_name:this.$t("news.all")}].concat(_(l))}},watch:{productionId(){this.episodeId=""},nbSelectedTasks(){this.nbSelectedTasks===0&&this.buildSelectionGrid(this.sortedTasks)}},head(){return{title:`${this.$t("tasks.my_checks")} - Kitsu`}}},z={class:"columns fixed-page"},Q={class:"column main-column"},R={class:"todos page"},W={class:"flexrow"},X={class:"field flexrow-item selector"},Y={class:"label person-label"},Z={class:"flexrow"},$={class:"title mt1 flexrow-item filler"},ee={key:0,class:"column side-column"};function te(e,t,l,o,s,a){const y=n("combobox-production"),m=n("combobox"),b=n("combobox-task-type"),T=n("combobox-status"),S=n("people-field"),I=n("button-simple"),g=n("todos-list"),w=n("task-info"),L=n("view-playlist-modal");return p(),f("div",z,[d("div",Q,[d("div",R,[d("div",W,[s.productionList.length>0?(p(),k(y,{key:0,class:"flexrow-item",label:e.$t("main.production"),"production-list":s.productionList,modelValue:s.productionId,"onUpdate:modelValue":t[0]||(t[0]=i=>s.productionId=i)},null,8,["label","production-list","modelValue"])):u("",!0),a.episodeOptions.length>0?D((p(),k(m,{key:1,class:"flexrow-item",label:e.$t("shots.fields.episode"),options:a.episodeOptions,modelValue:s.episodeId,"onUpdate:modelValue":t[1]||(t[1]=i=>s.episodeId=i)},null,8,["label","options","modelValue"])),[[F,s.productionId]]):u("",!0),s.taskTypeList.length>0?(p(),k(b,{key:2,class:"flexrow-item selector",label:e.$t("news.task_type"),"task-type-list":s.taskTypeList,modelValue:s.taskTypeId,"onUpdate:modelValue":t[2]||(t[2]=i=>s.taskTypeId=i)},null,8,["label","task-type-list","modelValue"])):u("",!0),r(T,{class:"flexrow-item selector",label:e.$t("news.task_status"),"task-status-list":s.taskStatusList,modelValue:s.taskStatusId,"onUpdate:modelValue":t[3]||(t[3]=i=>s.taskStatusId=i)},null,8,["label","task-status-list","modelValue"]),d("div",X,[d("label",Y,h(e.$t("main.person")),1),r(S,{people:a.assignees,small:"",modelValue:s.person,"onUpdate:modelValue":t[4]||(t[4]=i=>s.person=i)},null,8,["people","modelValue"])]),r(m,{class:"flexrow-item",label:e.$t("main.show"),options:s.filterOptions,"locale-key-prefix":"tasks.",modelValue:s.currentFilter,"onUpdate:modelValue":t[5]||(t[5]=i=>s.currentFilter=i)},null,8,["label","options","modelValue"]),r(m,{class:"flexrow-item",label:e.$t("main.sorted_by"),options:s.sortOptions,"locale-key-prefix":"tasks.fields.",modelValue:s.currentSort,"onUpdate:modelValue":t[6]||(t[6]=i=>s.currentSort=i)},null,8,["label","options","modelValue"])]),d("div",Z,[d("h1",$,h(a.nbTasksToCheck)+" "+h(e.$tc("my_checks.title",a.nbTasksToCheck)),1),r(I,{class:"flexrow-item",onClick:t[7]||(t[7]=i=>s.isPlaylist=!0),text:e.$t("tasks.build_playlist")},null,8,["text"])]),r(g,{tasks:a.sortedTasks,"is-loading":s.isLoading,"is-error":s.isLoadingError,"selection-grid":s.selectionGrid,"is-to-check":!0},null,8,["tasks","is-loading","is-error","selection-grid"])])]),e.nbSelectedTasks===1?(p(),f("div",ee,[r(w,{task:e.selectedTasks.values().next().value},null,8,["task"])])):u("",!0),r(L,{active:s.isPlaylist,"task-ids":a.sortedTasks.map(i=>i.id),onCancel:t[8]||(t[8]=i=>s.isPlaylist=!1)},null,8,["active","task-ids"])])}const oe=V(q,[["render",te],["__scopeId","data-v-95a5b5c9"]]);export{oe as default};
//# sourceMappingURL=MyChecks-DcYkIaDb.js.map
