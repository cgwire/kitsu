{"version":3,"mappings":"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","names":["drafts","taskId","text","taskMixin","task","shot","draft","comment","attachmentFilesToDelete","newAttachmentFiles","attachment","err","_sfc_main","modalMixin","EditPlaylistModal","PlaylistPlayer","mapGetters","type","assetStore","shotStore","sequenceStore","mapActions","entity","previewFileId","previousPreviewFileId","preview","additions","deletions","updates","localPreview","entities","entityMap","previewFileGroups","previewFiles","previewFile","entityInfo","playlistEntity","DEFAULT_NB_FRAMES_PICTURE","form","newPlaylist","playlist","playlistToSave","_hoisted_2","_createElementBlock","_normalizeClass","$props","_createElementVNode","_ctx","_hoisted_1","$options","_createCommentVNode","_createBlock","_component_playlist_player","$data","_createVNode","_component_edit_playlist_modal","_cache","$event","__webpack_modules__","__unused_webpack_module","exports","sfc","props","target","key","val","module","properties","isBrowser","isFirefox","getCaretCoordinates","element","position","options","debug","el","div","style","computed","isInput","prop","span","coordinates","__webpack_exports__","__webpack_require__","addStylesClient","listToStyles","parentId","list","styles","newStyles","i","item","id","css","media","sourceMap","part","hasDocument","stylesInDom","head","singletonElement","singletonCounter","isProduction","noop","ssrIdKey","isOldIE","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","j","addStyle","parts","createStyleElement","styleElement","obj","update","remove","styleIndex","applyToSingletonTag","applyToTag","newObj","replaceText","textStore","index","replacement","cssNode","childNodes","__unused_webpack_exports","content","add","__WEBPACK_DEFAULT_EXPORT__","_node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__","_node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default","_node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__","_node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default","___CSS_LOADER_EXPORT___","cssWithMappingToString","needLayer","modules","dedupe","supports","layer","alreadyImportedModules","k","_k","__webpack_module_cache__","moduleId","cachedModule","getter","definition","entry_lib","currentScript","src","scrollIntoView","t","scrollParent","r","o","scrollIntoViewElement","diff","applyRange","range","selection","getRange","getAtAndIndex","ats","at","a","b","getOffset","offset","parent","closest","predicate","getPrecedingRange","external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject","require$$0","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","render","args","exportHelper","script","At","name","chunk","suffix","cur","x","y","wrap","scrollLeft","scrollTop","left","top","value","oldValue","v","nameKey","ev","e","ch","last","c","atItems","members","deleteMatch","itemName","atwho","keep","avoidEmail","allowSpaces","showUnique","show","prev","filterMatch","matched","fn","rect","curEl","d","nextCur","node","cut","html","newElement","secondPart","customsEmbedded","start","curItem","template","textarea_caret","textarea_caret_default","atEnd","ta","end","newEnd","CheckSquareIcon","ClockIcon","SquareIcon","entry","entryRef","formatFrame","_openBlock","_Fragment","_renderList","_component_check_square_icon","_component_square_icon","_toDisplayString","_component_clock_icon","_withKeys","_withModifiers","REVISION_NUMBER_REGEX","AtTa","AddAttachmentModal","ButtonSimple","Checklist","ConfirmModal","ComboboxStatus","EmojiButton","PeopleAvatar","TaskTypeName","ToggleButton","preferences","production","evt","strings","reset","attachments","checklist","taskStatusId","revision","link","force","replaceTimeWithTimecode","textarea","caretPosition","rgxMatches","taskStatus","event","forms","files","attach","fileUrl","getDownloadAttachmentPath","response","fileBlob","formData","option_at","input","emoji","values","taskTypeOptions","taskType","teamOptions","person","departmentId","department","_hoisted_8","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_17","_hoisted_18","_hoisted_20","_hoisted_21","_component_at_ta","_withCtx","_createTextVNode","_normalizeStyle","_component_task_type_name","_component_people_avatar","_hoisted_7","_component_checklist","_hoisted_9","_hoisted_10","_hoisted_15","_hoisted_16","_hoisted_19","_component_emoji_button","_component_button_simple","_component_combobox_status","_component_toggle_button","_hoisted_22","_hoisted_23","_component_add_attachment_modal","_component_confirm_modal","AlertTriangleIcon","FileUpload","f","ref","_component_file_upload","_component_alert_triangle_icon","domMixin","ChevronDownIcon","CopyIcon","CommentMenu","LinkIcon","PaperclipIcon","PeopleName","ThumbsUpIcon","ValidationTag","route","pluralizeEntityType","personList","personId","sortByName","p","map","parseDate","stringHelpers","date","formatDate","moment","now","data","status","renderComment","error","reply","_hoisted_24","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_34","_hoisted_35","_hoisted_37","_hoisted_38","_hoisted_36","_component_validation_tag","_component_people_name","_hoisted_39","_component_chevron_down_icon","_component_comment_menu","_component_copy_icon","_component_paperclip_icon","replyComment","_hoisted_25","_component_thumbs_up_icon","_hoisted_31","_hoisted_32","_hoisted_33","_component_router_link","_component_link_icon","ModalFooter","TextField","XIcon","result","attachmentFiles","_vModelText","_component_text_field","_component_x_icon","_component_modal_footer","DownloadIcon","ObjectViewer","PdfViewer","PictureViewer","SoundViewer","Spinner","VideoViewer","previewId","extension","formatTime","time","duration","animationName","dimensions","frameNumber","canvasDimensions","canvas","frame","video","context","rate","volume","_component_spinner","_component_video_viewer","_component_picture_viewer","_component_object_viewer","_component_sound_viewer","_component_pdf_viewer","_component_download_icon","LightEntityThumbnail","previewIndex","_component_light_entity_thumbnail","TaskInfo","__vitePreload","lastIndex","annotationMixin","fullScreenMixin","ArrowUpRightIcon","BrowsingBar","ButtonSound","ColorPicker","Combobox","ComboboxStyled","GlobeIcon","PencilPicker","PreviewViewer","RevisionPreview","SpeedButton","defineAsyncComponent","VideoProgress","localPreferences","previews","margin","bigHeight","taskTypeId","defaultFlag","background","versionRevision","floorToFrame","roundToFrame","annotationTime","width","height","markRaw","fabric","brush","PSBrush","promise","taskTypeIds","taskTypeOption","option","enabled","defaultId","annotation","annotations","currentTime","filename","resolve","reject","blob","file","scaleRatio","tmpSource","tmpCanvas","section","episodeId","getEntityPath","concept","playlistModal","animation","previousIndex","newIndex","updatedAt","clickarea","_vShow","_component_preview_viewer","_component_task_info","_component_video_progress","_component_combobox_styled","_component_button_sound","_component_speed_button","_component_combobox","_Transition","_withDirectives","_component_color_picker","_component_pencil_picker","_component_globe_icon","_component_arrow_up_right_icon","_component_browsing_bar","_component_revision_preview"],"ignoreList":[3],"sources":["../../src/lib/drafts.js","../../src/components/mixins/task.js","../../src/components/modals/ViewPlaylistModal.vue","../../node_modules/vue-at/dist/vue-at-textarea.js","../../src/components/widgets/Checklist.vue","../../src/components/widgets/AddComment.vue","../../src/components/modals/AddPreviewModal.vue","../../src/components/widgets/CommentMenu.vue","../../src/components/widgets/Comment.vue","../../src/components/modals/EditCommentModal.vue","../../src/components/previews/BrowsingBar.vue","../../src/components/previews/PreviewViewer.vue","../../src/components/previews/RevisionPreview.vue","../../src/components/previews/PreviewPlayer.vue"],"sourcesContent":["const drafts = {\n  setTaskDraft(taskId, text) {\n    return localStorage.setItem('draft-' + taskId, text)\n  },\n\n  getTaskDraft(taskId) {\n    return localStorage.getItem('draft-' + taskId)\n  },\n\n  clearTaskDraft(taskId) {\n    return localStorage.removeItem('draft-' + taskId)\n  }\n}\n\nexport default drafts\n","import drafts from '@/lib/drafts'\n\n/*\n * Helpers to display task information\n */\nexport const taskMixin = {\n  computed: {\n    currentFps() {\n      const task = this.getTask()\n      if (!task) return 25\n      return parseInt(this.productionMap.get(task.project_id)?.fps) || 25\n    },\n\n    entityFrames() {\n      const task = this.getTask()\n      if (!task || !task.entity) return 0\n      const shot = this.shotMap.get(task.entity.id)\n      if (!shot || !shot.nb_frames) return 0\n\n      return shot.nb_frames\n    }\n  },\n\n  methods: {\n    getTask() {\n      return this.currentTask || this.task\n    },\n\n    getComments() {\n      return this.currentTaskComments || this.taskComments\n    },\n\n    resetComments() {\n      this.taskComments = this.getTaskComments(this.task.id)\n    },\n\n    resetModals() {\n      if (this.$refs['add-preview-modal']) {\n        this.$refs['add-preview-modal'].reset()\n      }\n      if (this.$refs['add-comment-image-modal']) {\n        this.$refs['add-comment-image-modal'].reset()\n      }\n    },\n\n    resetDraft() {\n      const task = this.getTask()\n      if (task && this.$refs['add-comment']) {\n        const draft = drafts.getTaskDraft(task.id)\n        if (draft) {\n          this.$refs['add-comment'].text = draft\n        } else {\n          this.$refs['add-comment'].text = ''\n        }\n      }\n    },\n\n    confirmEditTaskComment(comment) {\n      this.loading.editComment = true\n      this.errors.editComment = false\n      const attachmentFilesToDelete = comment.attachmentFilesToDelete || []\n      const newAttachmentFiles = comment.newAttachmentFiles || []\n      delete comment.attachmentFilesToDelete\n      delete comment.newAttachmentFiles\n      Promise.all(\n        attachmentFilesToDelete\n          .map(attachment => {\n            return { attachment, comment: this.commentToEdit }\n          })\n          .map(this.deleteAttachment)\n      )\n        .then(comment =>\n          this.addAttachmentToComment({\n            comment: this.commentToEdit,\n            files: newAttachmentFiles\n          })\n        )\n        .then(() =>\n          this.editTaskComment({\n            taskId: this.getTask().id,\n            comment\n          })\n        )\n        .then(() => {\n          this.$nextTick(() => {\n            this.resetComments()\n          })\n          this.loading.editComment = false\n          this.modals.editComment = false\n        })\n        .catch(err => {\n          console.error(err)\n          this.loading.editComment = false\n          this.errors.editComment = true\n        })\n    }\n  }\n}\n","<template>\n  <div\n    id=\"temp-playlist-modal\"\n    :class=\"{\n      dark: true,\n      modal: true,\n      'is-active': active\n    }\"\n  >\n    <div class=\"modal-background\" @click=\"$emit('cancel')\"></div>\n    <div class=\"modal-content wide xyz-in\" xyz=\"fade\">\n      <div class=\"box\">\n        <playlist-player\n          ref=\"playlist-player\"\n          :playlist=\"currentPlaylist\"\n          :entities=\"currentEntities\"\n          :is-loading=\"isLoading\"\n          :temp-mode=\"true\"\n          :current-entity-type=\"currentEntityType\"\n          @save-clicked=\"onSaveClicked\"\n          @annotation-changed=\"onAnnotationChanged\"\n          @annotations-refreshed=\"onAnnotationsRefreshed\"\n          @preview-changed=\"onPreviewChanged\"\n          v-if=\"!isPlaylistPage\"\n        />\n      </div>\n    </div>\n\n    <edit-playlist-modal\n      :active=\"modals.edit\"\n      :is-loading=\"loading.edit\"\n      :is-error=\"errors.edit\"\n      :playlist-to-edit=\"playlistToEdit\"\n      :type-disabled=\"true\"\n      @confirm=\"savePlaylist\"\n      @cancel=\"modals.edit = false\"\n    />\n  </div>\n</template>\n\n<script>\n/*\n * This component is aimed at displaying a temporary playlist from any view. It\n * is used in entity list to display playlists from the selection.\n */\n\nimport { mapActions, mapGetters } from 'vuex'\nimport { DEFAULT_NB_FRAMES_PICTURE } from '@/lib/playlist'\n\nimport { modalMixin } from '@/components/modals/base_modal'\n\nimport EditPlaylistModal from '@/components/modals/EditPlaylistModal.vue'\nimport PlaylistPlayer from '@/components/pages/playlists/PlaylistPlayer.vue'\n\nimport assetStore from '@/store/modules/assets'\nimport shotStore from '@/store/modules/shots'\nimport sequenceStore from '@/store/modules/sequences'\n\nexport default {\n  name: 'view-playlist-modal',\n\n  mixins: [modalMixin],\n\n  components: {\n    EditPlaylistModal,\n    PlaylistPlayer\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    taskIds: {\n      type: Array\n    },\n    sort: {\n      type: Boolean,\n      default: false\n    }\n  },\n\n  emits: ['cancel'],\n\n  data() {\n    return {\n      previewFileMap: new Map(),\n      previewFileEntityMap: new Map(),\n      currentEntities: [],\n      currentPlaylist: {\n        id: 'temp',\n        name: 'Temporary playlist',\n        shots: [],\n        for_entity: 'shot'\n      },\n      errors: {\n        edit: false\n      },\n      loading: {\n        edit: false\n      },\n      modals: {\n        edit: false\n      },\n      playlistToEdit: {},\n      isLoading: false\n    }\n  },\n\n  computed: {\n    ...mapGetters([\n      'currentEpisode',\n      'currentProduction',\n      'isTVShow',\n      'selectedTasks',\n      'taskMap'\n    ]),\n\n    currentTaskIds() {\n      return this.taskIds || Array.from(this.selectedTasks.keys())\n    },\n\n    isPlaylistPage() {\n      return this.$route.path.indexOf('playlist') > 0\n    },\n\n    playlistPlayer() {\n      return this.$refs['playlist-player']\n    },\n\n    isAssetPlaylist() {\n      return this.currentEntityType === 'asset'\n    },\n\n    isSequencePlaylist() {\n      return this.currentEntityType === 'sequence'\n    },\n\n    isShotPlaylist() {\n      return this.currentEntityType === 'shot'\n    },\n\n    currentEntityType() {\n      let type = 'shot'\n      if (this.$route.path.indexOf('asset') > 0) type = 'asset'\n      if (this.$route.path.indexOf('sequence') > 0) type = 'sequence'\n      return type\n    },\n\n    assetMap() {\n      return assetStore.cache.assetMap\n    },\n\n    shotMap() {\n      return shotStore.cache.shotMap\n    },\n\n    sequenceMap() {\n      return sequenceStore.cache.sequenceMap\n    },\n\n    frameDuration() {\n      return Math.round((1 / this.fps) * 10000) / 10000\n    },\n\n    fps() {\n      return parseFloat(this.currentProduction?.fps) || 25\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'changePlaylistPreview',\n      'editPlaylist',\n      'loadPlaylists',\n      'loadTempPlaylist',\n      'newPlaylist',\n      'updatePreviewAnnotation'\n    ]),\n\n    /* When a preview is modified, the change is persisted */\n    async onPreviewChanged({ entity, previewFileId, previousPreviewFileId }) {\n      await this.changePlaylistPreview({\n        playlist: this.currentPlaylist,\n        entity,\n        previewFileId,\n        previousPreviewFileId,\n        remote: false\n      })\n    },\n\n    onAnnotationChanged({ preview, additions, deletions, updates }) {\n      const taskId = preview.task_id\n      this.updatePreviewAnnotation({\n        taskId,\n        preview,\n        additions,\n        deletions,\n        updates\n      })\n    },\n\n    onAnnotationsRefreshed(preview) {\n      const entity = this.previewFileEntityMap.get(preview.id)\n      const localPreview = this.previewFileMap.get(preview.id)\n      if (entity) {\n        entity.preview_file_annotations = preview.annotations\n      }\n      if (localPreview) {\n        localPreview.annotations = preview.annotations\n      }\n    },\n\n    setupEntities(entities) {\n      const entityMap = {}\n      entities.forEach(entity => {\n        this.previewFileEntityMap.set(entity.preview_file_id, entity)\n        const previewFileGroups = Object.values(entity.preview_files)\n        this.convertEntityToPlaylistFormat(entity)\n        previewFileGroups.forEach(previewFiles => {\n          previewFiles.forEach(previewFile => {\n            this.previewFileMap.set(previewFile.id, previewFile)\n          })\n        })\n        entityMap[entity.id + '-' + entity.preview_file_id] = entity\n      })\n      this.$store.commit('SET_PLAYLIST_ENTRY_MAP', entityMap)\n      this.currentPlaylist.shots = Object.values(entityMap)\n      this.currentEntities = Object.values(entityMap)\n    },\n\n    convertEntityToPlaylistFormat(entityInfo) {\n      let entity\n      if (this.isAssetPlaylist) {\n        entity = this.assetMap.get(entityInfo.id)\n      } else if (this.isSequencePlaylist) {\n        entity = this.sequenceMap.get(entityInfo.id)\n        if (this.currentEpisode) {\n          entity.episode_name = this.currentEpisode.name\n        }\n      } else {\n        entity = this.shotMap.get(entityInfo.id)\n      }\n      if (entity) {\n        const playlistEntity = {\n          id: entityInfo.id,\n          name: entity.name,\n          nb_frames:\n            entityInfo.nb_frames ||\n            entity.nb_frames ||\n            DEFAULT_NB_FRAMES_PICTURE,\n          parent_name:\n            entity.sequence_name ||\n            entity.episode_name ||\n            entity.asset_type_name,\n          preview_files: entityInfo.preview_files,\n          preview_file_id: entityInfo.preview_file_id || entity.preview_file_id,\n          preview_file_extension:\n            entityInfo.preview_file_extension || entity.preview_file_extension,\n          preview_file_revision:\n            entityInfo.preview_file_revision || entity.preview_file_revision,\n          preview_file_width:\n            entityInfo.preview_file_width || entity.preview_file_width,\n          preview_file_height:\n            entityInfo.preview_file_height || entity.preview_file_height,\n          preview_file_duration:\n            entityInfo.preview_file_duration || entity.preview_file_duration,\n          preview_file_task_id:\n            entityInfo.task_id ||\n            entityInfo.preview_file_task_id ||\n            entity.preview_file_task_id,\n          preview_file_annotations:\n            entityInfo.preview_file_annotations ||\n            entity.preview_file_annotations,\n          preview_file_previews:\n            entityInfo.preview_file_previews || entity.preview_file_previews,\n          preview_nb_frames:\n            entityInfo.nb_frames ||\n            entity.nb_frames ||\n            DEFAULT_NB_FRAMES_PICTURE\n        }\n        Object.assign(entityInfo, playlistEntity)\n        this.previewFileEntityMap.set(\n          playlistEntity.preview_file_id,\n          playlistEntity\n        )\n        const previews = playlistEntity.preview_file_previews || []\n        previews.forEach(preview => {\n          preview.duration = entity.preview_file_duration\n          this.previewFileMap.set(preview.id, preview)\n        })\n        return playlistEntity\n      } else {\n        return entityInfo\n      }\n    },\n\n    onSaveClicked() {\n      this.errors.editPlaylist = false\n      this.playlistToEdit = {\n        for_entity: this.currentEntityType\n      }\n      this.modals.edit = true\n    },\n\n    async savePlaylist(form) {\n      const newPlaylist = {\n        name: form.name,\n        production_id: this.currentProduction.id,\n        for_client: form.for_client,\n        for_entity: form.for_entity,\n        is_for_all: form.is_for_all,\n        task_type_id: form.task_type_id\n      }\n      if (this.isTVShow && this.currentEpisode) {\n        newPlaylist.episode_id = this.currentEpisode.id\n      }\n      this.errors.edit = false\n      this.loading.edit = true\n      try {\n        const playlist = await this.newPlaylist(newPlaylist)\n        Object.assign(this.currentPlaylist, {\n          id: playlist.id,\n          name: playlist.name,\n          for_client: playlist.for_client,\n          for_entity: playlist.for_entity,\n          is_for_all: playlist.is_for_all\n        })\n        const playlistToSave = { ...this.currentPlaylist }\n        playlistToSave.shots = this.currentPlaylist.shots.map(shot => {\n          return {\n            entity_id: shot.id,\n            preview_file_id: shot.preview_file_id\n          }\n        })\n        await this.editPlaylist({\n          data: playlistToSave\n        })\n        this.modals.edit = false\n        this.loadPlaylists({})\n      } catch (err) {\n        console.error(err)\n        this.errors.edit = true\n        this.loading.edit = false\n      }\n    }\n  },\n\n  watch: {\n    active() {\n      if (this.active) {\n        this.currentEntities = []\n        this.previewFileMap = new Map()\n        this.previewFileEntityMap = new Map()\n        this.isLoading = true\n        this.loadTempPlaylist({ taskIds: this.currentTaskIds, sort: this.sort })\n          .then(entities => {\n            this.currentPlaylist.for_entity = this.currentEntityType\n            this.setupEntities(entities)\n            this.isLoading = false\n          })\n          .catch(console.error)\n      } else {\n        this.playlistPlayer.pause()\n        this.playlistPlayer.clearCanvas()\n        this.currentEntities = []\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.modal-content {\n  max-height: calc(100vh - 75px);\n  top: 28px;\n  overflow-x: hidden;\n}\n.modal-content .box {\n  padding: 1em;\n}\n\n.modal-content.wide {\n  overflow: hidden;\n  height: 100%;\n  margin: 1em;\n  width: 100%;\n\n  .box {\n    background: #3d4048;\n    padding-bottom: 0;\n  }\n}\n</style>\n","/******/ (() => { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ 349:\n/***/ ((__unused_webpack_module, exports) => {\n\n\"use strict\";\nvar __webpack_unused_export__;\n\n__webpack_unused_export__ = ({ value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.A = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n\n\n/***/ }),\n\n/***/ 431:\n/***/ ((module) => {\n\n/* jshint browser: true */\n\n(function () {\n\n// We'll copy the properties below into the mirror div.\n// Note that some browsers, such as Firefox, do not concatenate properties\n// into their shorthand (e.g. padding-top, padding-bottom etc. -> padding),\n// so we have to list every single property explicitly.\nvar properties = [\n  'direction',  // RTL support\n  'boxSizing',\n  'width',  // on Chrome and IE, exclude the scrollbar, so the mirror div wraps exactly as the textarea does\n  'height',\n  'overflowX',\n  'overflowY',  // copy the scrollbar for IE\n\n  'borderTopWidth',\n  'borderRightWidth',\n  'borderBottomWidth',\n  'borderLeftWidth',\n  'borderStyle',\n\n  'paddingTop',\n  'paddingRight',\n  'paddingBottom',\n  'paddingLeft',\n\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/font\n  'fontStyle',\n  'fontVariant',\n  'fontWeight',\n  'fontStretch',\n  'fontSize',\n  'fontSizeAdjust',\n  'lineHeight',\n  'fontFamily',\n\n  'textAlign',\n  'textTransform',\n  'textIndent',\n  'textDecoration',  // might not make a difference, but better be safe\n\n  'letterSpacing',\n  'wordSpacing',\n\n  'tabSize',\n  'MozTabSize'\n\n];\n\nvar isBrowser = (typeof window !== 'undefined');\nvar isFirefox = (isBrowser && window.mozInnerScreenX != null);\n\nfunction getCaretCoordinates(element, position, options) {\n  if (!isBrowser) {\n    throw new Error('textarea-caret-position#getCaretCoordinates should only be called in a browser');\n  }\n\n  var debug = options && options.debug || false;\n  if (debug) {\n    var el = document.querySelector('#input-textarea-caret-position-mirror-div');\n    if (el) el.parentNode.removeChild(el);\n  }\n\n  // The mirror div will replicate the textarea's style\n  var div = document.createElement('div');\n  div.id = 'input-textarea-caret-position-mirror-div';\n  document.body.appendChild(div);\n\n  var style = div.style;\n  var computed = window.getComputedStyle ? window.getComputedStyle(element) : element.currentStyle;  // currentStyle for IE < 9\n  var isInput = element.nodeName === 'INPUT';\n\n  // Default textarea styles\n  style.whiteSpace = 'pre-wrap';\n  if (!isInput)\n    style.wordWrap = 'break-word';  // only for textarea-s\n\n  // Position off-screen\n  style.position = 'absolute';  // required to return coordinates properly\n  if (!debug)\n    style.visibility = 'hidden';  // not 'display: none' because we want rendering\n\n  // Transfer the element's properties to the div\n  properties.forEach(function (prop) {\n    if (isInput && prop === 'lineHeight') {\n      // Special case for <input>s because text is rendered centered and line height may be != height\n      style.lineHeight = computed.height;\n    } else {\n      style[prop] = computed[prop];\n    }\n  });\n\n  if (isFirefox) {\n    // Firefox lies about the overflow property for textareas: https://bugzilla.mozilla.org/show_bug.cgi?id=984275\n    if (element.scrollHeight > parseInt(computed.height))\n      style.overflowY = 'scroll';\n  } else {\n    style.overflow = 'hidden';  // for Chrome to not render a scrollbar; IE keeps overflowY = 'scroll'\n  }\n\n  div.textContent = element.value.substring(0, position);\n  // The second special handling for input type=\"text\" vs textarea:\n  // spaces need to be replaced with non-breaking spaces - http://stackoverflow.com/a/13402035/1269037\n  if (isInput)\n    div.textContent = div.textContent.replace(/\\s/g, '\\u00a0');\n\n  var span = document.createElement('span');\n  // Wrapping must be replicated *exactly*, including when a long word gets\n  // onto the next line, with whitespace at the end of the line before (#7).\n  // The  *only* reliable way to do that is to copy the *entire* rest of the\n  // textarea's content into the <span> created at the caret position.\n  // For inputs, just '.' would be enough, but no need to bother.\n  span.textContent = element.value.substring(position) || '.';  // || because a completely empty faux span doesn't render at all\n  div.appendChild(span);\n\n  var coordinates = {\n    top: span.offsetTop + parseInt(computed['borderTopWidth']),\n    left: span.offsetLeft + parseInt(computed['borderLeftWidth']),\n    height: parseInt(computed['lineHeight'])\n  };\n\n  if (debug) {\n    span.style.backgroundColor = '#aaa';\n  } else {\n    document.body.removeChild(div);\n  }\n\n  return coordinates;\n}\n\nif ( true && typeof module.exports != 'undefined') {\n  module.exports = getCaretCoordinates;\n} else if(isBrowser) {\n  window.getCaretCoordinates = getCaretCoordinates;\n}\n\n}());\n\n\n/***/ }),\n\n/***/ 434:\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  A: () => (/* binding */ addStylesClient)\n});\n\n;// ./node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js\n/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nfunction listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n\n;// ./node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\n\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nfunction addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n\n\n/***/ }),\n\n/***/ 498:\n/***/ ((module) => {\n\n\"use strict\";\n\n\nmodule.exports = function (i) {\n  return i[1];\n};\n\n/***/ }),\n\n/***/ 666:\n/***/ ((module, __unused_webpack_exports, __webpack_require__) => {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(846);\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = (__webpack_require__(434)/* [\"default\"] */ .A)\nvar update = add(\"63f4e38b\", content, true, {\"sourceMap\":false,\"shadowMode\":false});\n\n/***/ }),\n\n/***/ 846:\n/***/ ((module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(498);\n/* harmony import */ var _node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(859);\n/* harmony import */ var _node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_pnpm_css_loader_6_11_0_webpack_5_100_2_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.atwho-view{color:#000;border-radius:3px;box-shadow:0 0 5px rgba(0,0,0,.1);min-width:120px;z-index:11110!important}.atwho-ul{list-style:none}.atwho-li{display:block}.atwho-view{border-radius:6px;box-shadow:0 0 10px 0 hsla(211,9%,44%,.5)}.atwho-ul{max-height:135px;padding:0;margin:0}.atwho-li{box-sizing:border-box;height:27px;padding:0 12px;white-space:nowrap;display:flex;align-items:center}.atwho-li span{overflow:hidden;text-overflow:ellipsis}.atwho-cur{background:#5bb8ff;color:#fff}.atwho-wrap{position:relative}.atwho-panel{position:absolute}.atwho-inner{position:relative}.atwho-view{position:absolute;bottom:0;left:-.8em;cursor:default;background-color:hsla(0,0%,100%,.94);min-width:140px;max-width:180px;max-height:200px;overflow-y:auto}.atwho-view::-webkit-scrollbar{width:11px;height:11px}.atwho-view::-webkit-scrollbar-track{background-color:#f5f5f5}.atwho-view::-webkit-scrollbar-thumb{min-height:36px;border:2px solid transparent;border-top:3px solid transparent;border-bottom:3px solid transparent;background-clip:padding-box;border-radius:7px;background-color:#c4c4c4}`, \"\"]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n/***/ }),\n\n/***/ 859:\n/***/ ((module) => {\n\n\"use strict\";\n\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/compat get default export */\n/******/ \t(() => {\n/******/ \t\t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t\t__webpack_require__.n = (module) => {\n/******/ \t\t\tvar getter = module && module.__esModule ?\n/******/ \t\t\t\t() => (module['default']) :\n/******/ \t\t\t\t() => (module);\n/******/ \t\t\t__webpack_require__.d(getter, { a: getter });\n/******/ \t\t\treturn getter;\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/publicPath */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.p = \"\";\n/******/ \t})();\n/******/ \t\n/************************************************************************/\nvar __webpack_exports__ = {};\n// This entry needs to be wrapped in an IIFE because it needs to be in strict mode.\n(() => {\n\"use strict\";\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"default\": () => (/* binding */ entry_lib)\n});\n\n;// ./node_modules/.pnpm/@vue+cli-service@5.0.8_@vue+compiler-sfc@3.5.17_lodash@4.17.21_sass-loader@13.3.3_sass@_0bb98e6b6d9a938580bb8c4d4068b1d0/node_modules/@vue/cli-service/lib/commands/build/setPublicPath.js\n/* eslint-disable no-var */\n// This file is imported into lib/wc client bundles.\n\nif (typeof window !== 'undefined') {\n  var currentScript = window.document.currentScript\n  if (false) // removed by dead control flow\n{ var getCurrentScript; }\n\n  var src = currentScript && currentScript.src.match(/(.+\\/)[^/]+\\.js(\\?.*)?$/)\n  if (src) {\n    __webpack_require__.p = src[1] // eslint-disable-line\n  }\n}\n\n// Indicate to webpack that this file can be concatenated\n/* harmony default export */ const setPublicPath = (null);\n\n;// ./src/util.js\n// Scrolling The Selection Into View\n// http://roysharon.com/blog/37\nfunction scrollIntoView (t, scrollParent) {\n  if (typeof (t) !== 'object') return\n\n  if (t.getRangeAt) {\n    // we have a Selection object\n    if (t.rangeCount === 0) return\n    t = t.getRangeAt(0)\n  }\n\n  if (t.cloneRange) {\n    // we have a Range object\n    let r = t.cloneRange() // do not modify the source range\n    r.collapse(true) // collapse to start\n    t = r.startContainer\n    // if start is an element, then startOffset is the child number\n    // in which the range starts\n    if (t.nodeType === 1) t = t.childNodes[r.startOffset]\n  }\n  if (!t) return\n\n  // if t is not an element node, then we need to skip back until we find the\n  // previous element with which we can call scrollIntoView()\n  let o = t\n  while (o && o.nodeType !== 1) o = o.previousSibling\n  t = o || t.parentNode\n  if (t) scrollIntoViewElement(t, scrollParent)\n}\n\n// bug report: https://github.com/vuejs/awesome-vue/pull/1028\n// https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoViewIfNeeded\nfunction scrollIntoViewElement (el, scrollParent) {\n  if (el.scrollIntoViewIfNeeded) {\n    el.scrollIntoViewIfNeeded(false) // alignToCenter=false\n  } else {\n    // should not use `el.scrollIntoView(false)` // alignToTop=false\n    // bug report: https://stackoverflow.com/questions/11039885/scrollintoview-causing-the-whole-page-to-move\n    scrollParent = scrollParent || el.parentElement\n    const diff = el.offsetTop - scrollParent.scrollTop\n    if (diff < 0 || diff > scrollParent.offsetHeight - el.offsetHeight) {\n      scrollParent.scrollTop = el.offsetTop\n    }\n  }\n}\n\nfunction applyRange (range) {\n  const selection = window.getSelection()\n  if (selection) { // \n    selection.removeAllRanges()\n    selection.addRange(range)\n  }\n}\nfunction getRange () {\n  const selection = window.getSelection()\n  if (selection && selection.rangeCount > 0) {\n    return selection.getRangeAt(0)\n  }\n}\n\nfunction getAtAndIndex (text, ats) {\n  return ats.map((at) => {\n    return { at, index: text.lastIndexOf(at) }\n  }).reduce((a, b) => {\n    return a.index > b.index ? a : b\n  })\n}\n\n/* eslint-disable */\n// http://stackoverflow.com/questions/26747240/plain-javascript-replication-to-offset-and-position\nfunction getOffset(element, target) {\n    // var element = document.getElementById(element),\n    //     target  = target ? document.getElementById(target) : window;\n    target = target || window\n    var offset = {top: element.offsetTop, left: element.offsetLeft},\n        parent = element.offsetParent;\n    while (parent != null && parent != target) {\n       offset.left += parent.offsetLeft;\n       offset.top  += parent.offsetTop;\n       parent = parent.offsetParent;\n    }\n    return offset;\n}\n// http://stackoverflow.com/questions/3972014/get-caret-position-in-contenteditable-div\nfunction closest (el, predicate) {\n  /* eslint-disable */\n  do if (predicate(el)) return el;\n  while (el = el && el.parentNode);\n}\n// http://stackoverflow.com/questions/15157435/get-last-character-before-caret-position-in-javascript\n//  \"+++@\" range (endContainer, 0)\n// stackoverflowbug\nfunction getPrecedingRange() {\n  const r = getRange()\n  if (r) {\n    const range = r.cloneRange()\n    range.collapse(true)\n    // var el = closest(range.endContainer, d => d.contentEditable)\n    // range.setStart(el, 0)\n    range.setStart(range.endContainer, 0)\n    return range\n  }\n}\n/* eslint-enable */\n\n;// external {\"commonjs\":\"vue\",\"commonjs2\":\"vue\",\"root\":\"Vue\"}\nconst external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject = require(\"vue\");\n;// ./node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.17_vue@3.5.17_webpack@5.100.2/node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[2]!./node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.17_vue@3.5.17_webpack@5.100.2/node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/AtTemplate.vue?vue&type=template&id=e31ae89a\n\n\nconst _hoisted_1 = { class: \"atwho-inner\" }\nconst _hoisted_2 = { class: \"atwho-view\" }\nconst _hoisted_3 = { class: \"atwho-ul\" }\nconst _hoisted_4 = [\"data-index\"]\nconst _hoisted_5 = [\"textContent\"]\nconst _hoisted_6 = { ref: \"embeddedItem\" }\n\nfunction render(_ctx, _cache) {\n  return ((0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.openBlock)(), (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementBlock)(\"div\", {\n    ref: \"wrap\",\n    class: \"atwho-wrap\",\n    onCompositionstart: _cache[2] || (_cache[2] = (...args) => (_ctx.handleCompositionStart && _ctx.handleCompositionStart(...args))),\n    onCompositionend: _cache[3] || (_cache[3] = (...args) => (_ctx.handleCompositionEnd && _ctx.handleCompositionEnd(...args))),\n    onInput: _cache[4] || (_cache[4] = $event => (_ctx.handleInput())),\n    onKeydownCapture: _cache[5] || (_cache[5] = (...args) => (_ctx.handleKeyDown && _ctx.handleKeyDown(...args)))\n  }, [\n    (_ctx.atwho)\n      ? ((0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.openBlock)(), (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementBlock)(\"div\", {\n          key: 0,\n          class: \"atwho-panel\",\n          style: (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.normalizeStyle)(_ctx.style)\n        }, [\n          (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementVNode)(\"div\", _hoisted_1, [\n            (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementVNode)(\"div\", _hoisted_2, [\n              (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementVNode)(\"ul\", _hoisted_3, [\n                ((0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.openBlock)(true), (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementBlock)(external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.Fragment, null, (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.renderList)(_ctx.atwho.list, (item, index) => {\n                  return ((0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.openBlock)(), (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementBlock)(\"li\", {\n                    class: (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.normalizeClass)([\"atwho-li\", _ctx.isCur(index) && 'atwho-cur']),\n                    key: index,\n                    \"data-index\": index,\n                    onMouseenter: _cache[0] || (_cache[0] = (...args) => (_ctx.handleItemHover && _ctx.handleItemHover(...args))),\n                    onClick: _cache[1] || (_cache[1] = (...args) => (_ctx.handleItemClick && _ctx.handleItemClick(...args)))\n                  }, [\n                    (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.renderSlot)(_ctx.$slots, \"item\", { item: item }, () => [\n                      (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementVNode)(\"span\", {\n                        textContent: (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.toDisplayString)(_ctx.itemName(item))\n                      }, null, 8, _hoisted_5)\n                    ])\n                  ], 42, _hoisted_4))\n                }), 128))\n              ])\n            ])\n          ])\n        ], 4))\n      : (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createCommentVNode)(\"\", true),\n    (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.withDirectives)((0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.createElementVNode)(\"span\", _hoisted_6, [\n      (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.renderSlot)(_ctx.$slots, \"embeddedItem\", { current: _ctx.currentItem })\n    ], 512), [\n      [external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.vShow, false]\n    ]),\n    (0,external_commonjs_vue_commonjs2_vue_root_Vue_namespaceObject.renderSlot)(_ctx.$slots, \"default\")\n  ], 544))\n}\n;// ./src/AtTemplate.vue?vue&type=template&id=e31ae89a\n\n// EXTERNAL MODULE: ./node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/index.js??clonedRuleSet-22.use[0]!./node_modules/.pnpm/css-loader@6.11.0_webpack@5.100.2/node_modules/css-loader/dist/cjs.js??clonedRuleSet-22.use[1]!./node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.17_vue@3.5.17_webpack@5.100.2/node_modules/vue-loader/dist/stylePostLoader.js!./node_modules/.pnpm/postcss-loader@6.2.1_postcss@8.5.6_webpack@5.100.2/node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[2]!./node_modules/.pnpm/postcss-loader@6.2.1_postcss@8.5.6_webpack@5.100.2/node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-22.use[3]!./node_modules/.pnpm/sass-loader@13.3.3_sass@1.89.2_webpack@5.100.2/node_modules/sass-loader/dist/cjs.js??clonedRuleSet-22.use[4]!./src/At.scss?vue&type=style&index=0&lang=scss&external\nvar Atvue_type_style_index_0_lang_scss_external = __webpack_require__(666);\n;// ./src/At.scss?vue&type=style&index=0&lang=scss&external\n\n// EXTERNAL MODULE: ./node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.17_vue@3.5.17_webpack@5.100.2/node_modules/vue-loader/dist/exportHelper.js\nvar exportHelper = __webpack_require__(349);\n;// ./src/AtTemplate.vue\n\nconst script = {}\n\n;\n\n\nconst __exports__ = /*#__PURE__*/(0,exportHelper/* default */.A)(script, [['render',render]])\n\n/* harmony default export */ const AtTemplate = (__exports__);\n;// ./node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.17_vue@3.5.17_webpack@5.100.2/node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/At.vue?vue&type=script&lang=js\n\n\n\n\n/* harmony default export */ const Atvue_type_script_lang_js = ({\n  name: 'VueAt',\n  mixins: [AtTemplate],\n  emits: ['update:value', 'at', 'insert'],\n  props: {\n    value: {\n      type: String, // value not required\n      default: null\n    },\n    at: {\n      type: String,\n      default: null\n    },\n    ats: {\n      type: Array,\n      default: () => ['@']\n    },\n    suffix: {\n      type: String,\n      default: ' '\n    },\n    loop: {\n      type: Boolean,\n      default: true\n    },\n    allowSpaces: {\n      type: Boolean,\n      default: true\n    },\n    tabSelect: {\n      type: Boolean,\n      default: false\n    },\n    avoidEmail: {\n      type: Boolean,\n      default: true\n    },\n    showUnique: {\n      type: Boolean,\n      default: true\n    },\n    hoverSelect: {\n      type: Boolean,\n      default: true\n    },\n    members: {\n      type: Array,\n      default: () => []\n    },\n    nameKey: {\n      type: String,\n      default: ''\n    },\n    filterMatch: {\n      type: Function,\n      default: (name, chunk, at) => {\n        // match at lower-case\n        return name.toLowerCase()\n          .indexOf(chunk.toLowerCase()) > -1\n      }\n    },\n    deleteMatch: {\n      type: Function,\n      default: (name, chunk, suffix) => {\n        return chunk === name + suffix\n      }\n    },\n    scrollRef: {\n      type: String,\n      default: ''\n    }\n  },\n\n  data () {\n    return {\n      // at[v-model] mode should be on only when\n      // initial :value/v-model is present (not nil)\n      bindsValue: this.value != null,\n      customsEmbedded: false,\n      hasComposition: false,\n      atwho: null\n    }\n  },\n  computed: {\n    atItems () {\n      return this.at ? [this.at] : this.ats\n    },\n\n    currentItem () {\n      if (this.atwho) {\n        return this.atwho.list[this.atwho.cur]\n      }\n      return ''\n    },\n\n    style () {\n      if (this.atwho) {\n        const { list, cur, x, y } = this.atwho\n        const { wrap } = this.$refs\n        if (wrap) {\n          const offset = getOffset(wrap)\n          const scrollLeft = this.scrollRef ? document.querySelector(this.scrollRef).scrollLeft : 0\n          const scrollTop = this.scrollRef ? document.querySelector(this.scrollRef).scrollTop : 0\n          const left = x + scrollLeft + window.pageXOffset - offset.left + 'px'\n          const top = y + scrollTop + window.pageYOffset - offset.top + 'px'\n          return { left, top }\n        }\n      }\n      return null\n    }\n  },\n  watch: {\n    'atwho.cur' (index) {\n      if (index != null) { // cur index exists\n        this.$nextTick(() => {\n          this.scrollToCur()\n        })\n      }\n    },\n    members () {\n      this.handleInput(true)\n    },\n    value (value, oldValue) {\n      if (this.bindsValue) {\n        this.handleValueUpdate(value)\n      }\n    }\n  },\n  mounted () {\n    // vue3 migration.5\n    // [Vue warn]: (deprecation INSTANCE_SCOPED_SLOTS) vm.$scopedSlots has been removed. Use vm.$slots instead.\n    // Details: https://v3-migration.vuejs.org/breaking-changes/slots-unification.html\n    if (this.$slots.embeddedItem) {\n      this.customsEmbedded = true\n    }\n    if (this.bindsValue) {\n      this.handleValueUpdate(this.value)\n    }\n  },\n\n  methods: {\n    itemName (v) {\n      const { nameKey } = this\n      return nameKey ? v[nameKey] : v\n    },\n    isCur (index) {\n      return index === this.atwho.cur\n    },\n    handleValueUpdate (value) {\n      const el = this.$el.querySelector('[contenteditable]')\n      if (value !== el.innerHTML) { // avoid range reset\n        el.innerHTML = value\n        this.dispatchInput()\n      }\n    },\n    dispatchInput () {\n      let el = this.$el.querySelector('[contenteditable]')\n      let ev = new Event('input', { bubbles: true })\n      el.dispatchEvent(ev)\n    },\n\n    handleItemHover (e) {\n      if (this.hoverSelect) {\n        this.selectByMouse(e)\n      }\n    },\n    handleItemClick (e) {\n      this.selectByMouse(e)\n      this.insertItem()\n    },\n    handleDelete (e) {\n      const range = getPrecedingRange()\n      if (range) {\n        // fixme: Very bad code from me\n        if (this.customsEmbedded && range.endOffset >= 1) {\n          let a = range.endContainer.childNodes[range.endOffset] ||\n            range.endContainer.childNodes[range.endOffset - 1]\n          if (!a || a.nodeType === Node.TEXT_NODE && !/^\\s?$/.test(a.data)) {\n            return\n          } else if (a.nodeType === Node.TEXT_NODE) {\n            if (a.previousSibling) a = a.previousSibling\n          } else {\n            if (a.previousElementSibling) a = a.previousElementSibling\n          }\n          let ch = [].slice.call(a.childNodes)\n          ch = [].reverse.call(ch)\n          ch.unshift(a)\n          let last\n          ;[].some.call(ch, c => {\n            if (c.getAttribute && c.getAttribute('data-at-embedded') != null) {\n              last = c\n              return true\n            }\n          })\n          if (last) {\n            e.preventDefault()\n            e.stopPropagation()\n            const r = getRange()\n            if (r) {\n              r.setStartBefore(last)\n              r.deleteContents()\n              applyRange(r)\n              this.handleInput()\n            }\n          }\n          return\n        }\n\n        const { atItems, members, suffix, deleteMatch, itemName } = this\n        const text = range.toString()\n        const { at, index } = getAtAndIndex(text, atItems)\n\n        if (index > -1) {\n          const chunk = text.slice(index + at.length)\n          const has = members.some(v => {\n            const name = itemName(v)\n            return deleteMatch(name, chunk, suffix)\n          })\n          if (has) {\n            e.preventDefault()\n            e.stopPropagation()\n            const r = getRange()\n            if (r) {\n              r.setStart(r.endContainer, index)\n              r.deleteContents()\n              applyRange(r)\n              this.handleInput()\n            }\n          }\n        }\n      }\n    },\n    handleKeyDown (e) {\n      const { atwho } = this\n      if (atwho) {\n        if (e.keyCode === 38 || e.keyCode === 40) { // /\n          if (!(e.metaKey || e.ctrlKey)) {\n            e.preventDefault()\n            e.stopPropagation()\n            this.selectByKeyboard(e)\n          }\n          return\n        }\n        if (e.keyCode === 13 || (this.tabSelect && e.keyCode === 9)) { // enter or tab\n          e.preventDefault()\n          e.stopPropagation()\n          this.insertItem()\n          return\n        }\n        if (e.keyCode === 27) { // esc\n          this.closePanel()\n          return\n        }\n      }\n\n      // ie ie9~11 editableinput keydown textarea\n      //  ie9 textareadeleteinput\n      const isValid = e.keyCode >= 48 && e.keyCode <= 90 || e.keyCode === 8\n      if (isValid) {\n        setTimeout(() => {\n          this.handleInput()\n        }, 50)\n      }\n\n      if (e.keyCode === 8) {\n        this.handleDelete(e)\n      }\n    },\n\n    // compositionStart -> input -> compositionEnd\n    handleCompositionStart () {\n      this.hasComposition = true\n    },\n    handleCompositionEnd () {\n      this.hasComposition = false\n      this.handleInput()\n    },\n    handleInput (keep) {\n      if (this.hasComposition) return\n      const el = this.$el.querySelector('[contenteditable]')\n\n      // vue3 migration.2.1\n      // https://vuejs.org/guide/components/events.html#usage-with-v-model\n      // https://laracasts.com/discuss/channels/vue/how-do-emit-to-v-model-in-vue-3\n      // this.$emit('input', el.innerHTML)\n      this.$emit('update:value', el.innerHTML)\n\n      const range = getPrecedingRange()\n      if (range) {\n        const { atItems, avoidEmail, allowSpaces, showUnique } = this\n\n        let show = true\n        const text = range.toString()\n\n        const { at, index } = getAtAndIndex(text, atItems)\n\n        if (index < 0) show = false\n        const prev = text[index - 1]\n\n        const chunk = text.slice(index + at.length, text.length)\n\n        if (avoidEmail) {\n          //  \n          //  \n          if (/^[a-z0-9]$/i.test(prev)) show = false\n        }\n\n        if (!allowSpaces && /\\s/.test(chunk)) {\n          show = false\n        }\n\n        // chunk `@ `\n        if (/^\\s/.test(chunk)) show = false\n\n        if (!show) {\n          this.closePanel()\n        } else {\n          const { members, filterMatch, itemName } = this\n          if (!keep && chunk) { // fixme: should be consistent with AtTextarea.vue\n            this.$emit('at', chunk)\n          }\n          const matched = members.filter(v => {\n            const name = itemName(v)\n            return filterMatch(name, chunk, at, v)\n          })\n\n          show = false\n          if (matched.length) {\n            show = true\n            if (!showUnique) {\n              let item = matched[0]\n              if (chunk === itemName(item)) {\n                show = false\n              }\n            }\n          }\n\n          if (show) {\n            this.openPanel(matched, range, index, at)\n          } else {\n            this.closePanel()\n          }\n        }\n      }\n    },\n\n    closePanel () {\n      if (this.atwho) {\n        this.atwho = null\n      }\n    },\n    openPanel (list, range, offset, at) {\n      const fn = () => {\n        const r = range.cloneRange()\n        r.setStart(r.endContainer, offset + at.length) // @\n        // todo:  \n        const rect = r.getClientRects()[0]\n        this.atwho = {\n          range,\n          offset,\n          list,\n          x: rect.left,\n          y: rect.top - 4,\n          cur: 0 // todo: \n        }\n      }\n      if (this.atwho) {\n        fn()\n      } else { //   \n        setTimeout(fn, 10)\n      }\n    },\n\n    scrollToCur () {\n      // vue3 migration.6\n      // fix: [Vue warn]: Missing ref owner context. ref cannot be used on hoisted vnodes.\n      // A vnode with ref must be created inside the render function.\n      // at selectByMouse\n      // at handleItemHover\n      // const curEl = this.$refs.cur[0]\n      let { wrap } = this.$refs\n      let { cur } = this.atwho\n      const curEl = wrap.querySelector(`.atwho-li[data-index=\"${cur}\"]`)\n\n      const scrollParent = curEl.parentElement.parentElement // .atwho-view\n      scrollIntoView(curEl, scrollParent)\n    },\n    selectByMouse (e) {\n      const el = closest(e.target, d => {\n        return d.getAttribute('data-index')\n      })\n      const cur = +el.getAttribute('data-index')\n      this.atwho = {\n        ...this.atwho,\n        cur\n      }\n    },\n    selectByKeyboard (e) {\n      const offset = e.keyCode === 38 ? -1 : 1\n      const { cur, list } = this.atwho\n      const nextCur = this.loop\n        ? (cur + offset + list.length) % list.length\n        : Math.max(0, Math.min(cur + offset, list.length - 1))\n      this.atwho = {\n        ...this.atwho,\n        cur: nextCur\n      }\n    },\n\n    // todo: \n    insertText (text, r) {\n      r.deleteContents()\n      const node = r.endContainer\n      if (node.nodeType === Node.TEXT_NODE) {\n        const cut = r.endOffset\n        node.data = node.data.slice(0, cut) +\n          text + node.data.slice(cut)\n        r.setEnd(node, cut + text.length)\n      } else {\n        const t = document.createTextNode(text)\n        r.insertNode(t)\n        r.setEndAfter(t)\n      }\n      r.collapse(false) // IE\n      applyRange(r)\n      this.dispatchInput()\n    },\n\n    insertHtml (html, r) {\n      r.deleteContents()\n      const node = r.endContainer\n      const newElement = document.createElement('span')\n\n      // Seems `contentediable=false` should includes spaces,\n      // otherwise, caret can't be placed well across them\n      newElement.appendChild(document.createTextNode(' '))\n      newElement.appendChild(this.htmlToElement(html))\n      newElement.appendChild(document.createTextNode(' '))\n      newElement.setAttribute('data-at-embedded', '')\n      newElement.setAttribute('contenteditable', false)\n\n      if (node.nodeType === Node.TEXT_NODE) {\n        const cut = r.endOffset\n        let secondPart = node.splitText(cut)\n        node.parentNode.insertBefore(newElement, secondPart)\n        r.setEndBefore(secondPart)\n      } else {\n        const t = document.createTextNode(this.suffix)\n        r.insertNode(newElement)\n        r.setEndAfter(newElement)\n        r.insertNode(t)\n        r.setEndAfter(t)\n      }\n      r.collapse(false) // IE\n      applyRange(r)\n    },\n\n    insertItem () {\n      const { range, offset, list, cur } = this.atwho\n      const { suffix, atItems, itemName, customsEmbedded } = this\n      const r = range.cloneRange()\n      const text = range.toString()\n      const { at, index } = getAtAndIndex(text, atItems)\n\n      // Leading `@` is automatically dropped as `customsEmbedded=true`\n      // You can fully custom the output inside the embedded slot\n      const start = customsEmbedded ? index : index + at.length\n      r.setStart(r.endContainer, start)\n\n      // hack:  click focus range\n      applyRange(r)\n      applyRange(r)\n      const curItem = list[cur]\n\n      if (customsEmbedded) {\n        // `suffix` is ignored as `customsEmbedded=true` has to be\n        // wrapped around by spaces\n\n        // vue3 migration.7\n        // fix: Uncaught TypeError: Cannot read properties of undefined (reading 'innerHTML')\n        // at Proxy.insertItem (At.vue?075e:490:1)\n        // at Proxy.handleItemClick (At.vue?075e:184:1)\n        // const html = this.$refs.embeddedItem.firstChild.innerHTML\n        const html = this.$refs.embeddedItem.firstElementChild.innerHTML\n\n        this.insertHtml(html, r)\n      } else {\n        const t = itemName(curItem) + suffix\n        this.insertText(t, r)\n      }\n      scrollIntoView(window.getSelection())\n\n      this.$emit('insert', curItem)\n      this.handleInput()\n\n      // fix safari: use `r` instead of `window.getSelection()`\n      // scrollIntoView(window.getSelection())\n      scrollIntoView(r)\n    },\n    htmlToElement (html) {\n      const template = document.createElement('template')\n      html = html.trim() // Never return a text node of whitespace as the result\n      template.innerHTML = html\n      return template.content.firstChild\n    }\n  }\n});\n\n;// ./src/At.vue?vue&type=script&lang=js\n \n;// ./src/At.vue\n\n\n\nconst At_exports_ = Atvue_type_script_lang_js;\n\n/* harmony default export */ const At = (At_exports_);\n// EXTERNAL MODULE: ./node_modules/.pnpm/textarea-caret@3.1.0/node_modules/textarea-caret/index.js\nvar textarea_caret = __webpack_require__(431);\nvar textarea_caret_default = /*#__PURE__*/__webpack_require__.n(textarea_caret);\n;// ./node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.17_vue@3.5.17_webpack@5.100.2/node_modules/vue-loader/dist/index.js??ruleSet[0].use[0]!./src/AtTextarea.vue?vue&type=script&lang=js\n\n\n\n\n\n/* harmony default export */ const AtTextareavue_type_script_lang_js = ({\n  extends: At,\n  name: 'AtTextarea',\n  emits: ['update:value', 'at', 'insert'],\n  computed: {\n    style () {\n      if (this.atwho) {\n        const { list, cur, x, y } = this.atwho\n        const { wrap } = this.$refs\n        const el = this.$el.querySelector('textarea')\n        if (wrap) {\n          const left = x + el.offsetLeft - el.scrollLeft + 'px'\n          const top = y + el.offsetTop - el.scrollTop + 'px'\n          return { left, top }\n        }\n      }\n      return null\n    }\n  },\n  methods: {\n    handleValueUpdate (value) {\n      const el = this.$el.querySelector('textarea')\n      if (value !== el.value) { // avoid range reset\n        el.value = value\n        this.dispatchInput()\n      }\n    },\n    dispatchInput () {\n      let el = this.$el.querySelector('textarea')\n      let ev = new Event('input', { bubbles: true })\n      el.dispatchEvent(ev)\n    },\n\n    handleDelete (e) {\n      const el = this.$el.querySelector('textarea')\n      // fix https://github.com/fritx/vue-at/issues/139\n      const hasSelection = el.selectionEnd - el.selectionStart > 0\n      if (hasSelection) return\n      const text = el.value.slice(0, el.selectionEnd)\n      if (text) {\n        const { atItems, members, suffix, deleteMatch, itemName } = this\n        const { at, index } = getAtAndIndex(text, atItems)\n        if (index > -1) {\n          const chunk = text.slice(index + at.length)\n          const has = members.some(v => {\n            const name = itemName(v)\n            return deleteMatch(name, chunk, suffix)\n          })\n          if (has) {\n            el.value = el.value.slice(0, index) +\n              el.value.slice(el.selectionEnd - 1)\n            el.selectionStart = index + 1\n            el.selectionEnd = index + 1\n            this.handleInput()\n          }\n        }\n      }\n    },\n\n    handleInput (keep) {\n      if (this.hasComposition) return\n      const el = this.$el.querySelector('textarea')\n\n      // vue3 migration.2.1\n      // https://vuejs.org/guide/components/events.html#usage-with-v-model\n      // https://laracasts.com/discuss/channels/vue/how-do-emit-to-v-model-in-vue-3\n      // this.$emit('input', el.value)\n      this.$emit('update:value', el.value)\n\n      const text = el.value.slice(0, el.selectionEnd)\n      if (text) {\n        const { atItems, avoidEmail, allowSpaces } = this\n        let show = true\n        const { at, index } = getAtAndIndex(text, atItems)\n        if (index < 0) show = false\n        const prev = text[index - 1]\n        const chunk = text.slice(index + at.length, text.length)\n        if (avoidEmail) {\n          //  \n          //  \n          if (/^[a-z0-9]$/i.test(prev)) show = false\n        }\n        if (!allowSpaces && /\\s/.test(chunk)) {\n          show = false\n        }\n\n        // chunk `@ `\n        if (/^\\s/.test(chunk)) show = false\n        if (!show) {\n          this.closePanel()\n        } else {\n          const { members, filterMatch, itemName } = this\n          if (!keep) { // fixme: should be consistent with At.vue\n            this.$emit('at', chunk)\n          }\n          const matched = members.filter(v => {\n            const name = itemName(v)\n            return filterMatch(name, chunk, at, v)\n          })\n          if (matched.length) {\n            this.openPanel(matched, chunk, index, at, keep)\n          } else {\n            this.closePanel()\n          }\n        }\n      } else {\n        this.closePanel()\n      }\n    },\n\n    openPanel (list, chunk, offset, at) {\n      const fn = () => {\n        const el = this.$el.querySelector('textarea')\n        const atEnd = offset + at.length // @\n        const rect = textarea_caret_default()(el, atEnd)\n        this.atwho = {\n          chunk,\n          offset,\n          list,\n          atEnd,\n          x: rect.left,\n          y: rect.top - 4,\n          cur: 0, // todo: \n        }\n      }\n      if (this.atwho) {\n        fn()\n      } else { //   \n        setTimeout(fn, 10)\n      }\n    },\n\n    // todo: \n    insertText (text, ta) {\n      const start = ta.selectionStart\n      const end = ta.selectionEnd\n      ta.value = ta.value.slice(0, start) +\n        text + ta.value.slice(end)\n      const newEnd = start + text.length\n      ta.selectionStart = newEnd\n      ta.selectionEnd = newEnd\n      this.dispatchInput()\n    },\n    insertItem () {\n      const { chunk, offset, list, cur, atEnd } = this.atwho\n      const { suffix, atItems, itemName } = this\n      const el = this.$el.querySelector('textarea')\n      const text = el.value.slice(0, atEnd)\n      const { at, index } = getAtAndIndex(text, atItems)\n      const start = index + at.length // @\n      el.selectionStart = start\n      el.focus() // textareafocus\n      const curItem = list[cur]\n      const t = itemName(curItem) + suffix\n      this.insertText(t, el)\n      this.$emit('insert', curItem)\n      this.handleInput()\n    }\n  }\n});\n\n;// ./src/AtTextarea.vue?vue&type=script&lang=js\n \n;// ./src/AtTextarea.vue\n\n\n\nconst AtTextarea_exports_ = AtTextareavue_type_script_lang_js;\n\n/* harmony default export */ const AtTextarea = (AtTextarea_exports_);\n;// ./node_modules/.pnpm/@vue+cli-service@5.0.8_@vue+compiler-sfc@3.5.17_lodash@4.17.21_sass-loader@13.3.3_sass@_0bb98e6b6d9a938580bb8c4d4068b1d0/node_modules/@vue/cli-service/lib/commands/build/entry-lib.js\n\n\n/* harmony default export */ const entry_lib = (AtTextarea);\n\n\n})();\n\nmodule.exports = __webpack_exports__[\"default\"];\n/******/ })()\n;\n//# sourceMappingURL=vue-at-textarea.common.js.map","<template>\n  <div>\n    <div\n      class=\"checklist-entry\"\n      :class=\"{\n        checked: entry.checked,\n        disabled: !isEditable\n      }\"\n      :key=\"`comment-checklist-${index}`\"\n      v-for=\"(entry, index) in filteredChecklist\"\n    >\n      <span class=\"checklist-checkbox\" @click=\"toggleEntryChecked(entry)\">\n        <check-square-icon class=\"icon\" v-if=\"entry.checked\" />\n        <square-icon class=\"icon\" v-else />\n      </span>\n      <span\n        class=\"frame\"\n        @click=\"\n          $emit('time-code-clicked', {\n            frame: entry.frame,\n            revision: entry.revision\n          })\n        \"\n        v-if=\"entry.frame >= 0\"\n      >\n        v{{ entry.revision }} - {{ formatFrame(entry.frame) }}\n      </span>\n      <span @click=\"setFrame(entry)\" v-if=\"isMoviePreview\">\n        <clock-icon class=\"icon clock\" />\n      </span>\n      <textarea\n        class=\"checklist-text\"\n        :ref=\"`checklist-entry-${index}`\"\n        rows=\"1\"\n        :placeholder=\"$t('comments.task_placeholder')\"\n        @keydown.enter.prevent=\"addChecklistEntry(index)\"\n        @keyup.backspace=\"removeChecklistEntry(index)\"\n        @keyup.up=\"focusPrevious(index)\"\n        @keyup.down=\"focusNext(index)\"\n        :disabled=\"entry.text.length !== 0 && disabled\"\n        v-autosize\n        v-model.trim=\"entry.text\"\n      ></textarea>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { CheckSquareIcon, ClockIcon, SquareIcon } from 'lucide-vue-next'\n\nimport { formatFrame } from '@/lib/video'\n\nexport default {\n  name: 'checklist',\n\n  components: {\n    CheckSquareIcon,\n    ClockIcon,\n    SquareIcon\n  },\n\n  props: {\n    checklist: {\n      default: () => [],\n      type: Array\n    },\n    disabled: {\n      default: false,\n      type: Boolean\n    },\n    frame: {\n      default: -1,\n      type: Number\n    },\n    isEditable: {\n      type: Boolean,\n      default: true\n    },\n    isMoviePreview: {\n      default: false,\n      type: Boolean\n    },\n    revision: {\n      default: -1,\n      type: Number\n    }\n  },\n\n  emits: [\n    'add-item',\n    'emit-change',\n    'insert-item',\n    'remove-task',\n    'time-code-clicked'\n  ],\n\n  computed: {\n    filteredChecklist() {\n      return this.checklist.filter(Boolean) // remove empty entries\n    }\n  },\n\n  methods: {\n    addChecklistEntry(index) {\n      if (index === -1 || index === this.checklist.length - 1) {\n        this.$emit('add-item', {\n          index,\n          text: '',\n          frame: -1,\n          revision: -1,\n          checked: false\n        })\n      } else {\n        this.$emit('insert-item', {\n          index: index + 1,\n          text: '',\n          frame: -1,\n          revision: -1,\n          checked: false\n        })\n      }\n\n      this.$nextTick(() => {\n        this.focusNext(index)\n      })\n    },\n\n    removeChecklistEntry(index) {\n      const entry = this.checklist[index]\n      if (entry.text.length === 0) {\n        this.$emit('remove-task', entry)\n        this.focusPrevious(index)\n      }\n    },\n\n    focusPrevious(index) {\n      if (this.checklist.length > 0) {\n        if (index === 0) index = this.checklist.length\n        index--\n        const entryRef = `checklist-entry-${index}`\n        this.$refs[entryRef][0].focus()\n      }\n    },\n\n    formatFrame,\n\n    focusNext(index) {\n      if (this.checklist.length > 0) {\n        if (index === this.checklist.length - 1) index = -1\n        index++\n        const entryRef = `checklist-entry-${index}`\n        this.$refs[entryRef][0].focus()\n      }\n    },\n\n    setFrame(item) {\n      item.checked = !item.checked\n      item.revision = this.revision\n      item.frame = this.frame\n      item.checked = !item.checked\n      this.$emit('emit-change')\n    },\n\n    toggleEntryChecked(entry) {\n      if (this.isEditable) {\n        entry.checked = !entry.checked\n        this.$emit('emit-change')\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .checklist-entry {\n    .checklist-text {\n      color: $light-grey-light;\n      background: transparent;\n\n      &:active,\n      &:focus,\n      &:hover {\n        background: $dark-grey;\n        border: 1px solid $dark-grey-strong;\n      }\n\n      &:disabled {\n        background: transparent;\n        color: white;\n\n        &:hover {\n          border: 1px solid transparent;\n        }\n      }\n    }\n\n    &.checked .checklist-text {\n      color: $grey;\n    }\n\n    &.disabled {\n      .checklist-checkbox {\n        color: $grey;\n\n        .icon {\n          fill: rgba($grey, 0.15);\n        }\n      }\n    }\n  }\n}\n\n.checklist-entry {\n  color: $grey;\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  margin-bottom: 0.3em;\n\n  .checklist-text {\n    font-size: 0.9em;\n    padding: 0.2em;\n    padding-top: 0;\n    margin-right: 0.5em;\n    margin-top: 4px;\n    width: 100%;\n    min-height: 20px;\n    border: 1px solid transparent;\n    resize: none;\n\n    &:focus,\n    &:active,\n    &:hover {\n      border: 1px solid $light-grey;\n    }\n\n    &:disabled {\n      background-color: white;\n      color: #333;\n\n      &:hover {\n        border: 1px solid transparent;\n      }\n    }\n  }\n\n  &.checked .checklist-text {\n    color: $light-grey-2;\n  }\n\n  &.disabled {\n    .checklist-checkbox {\n      cursor: default;\n      color: $light-grey-2;\n\n      .icon {\n        fill: rgba($light-grey-2, 0.15);\n      }\n    }\n  }\n\n  span {\n    cursor: pointer;\n    padding: 0.2em 0 0 0;\n    margin-right: 0.2em;\n    margin-left: 0;\n\n    .icon {\n      width: 20px;\n    }\n\n    .clock {\n      width: 16px;\n    }\n  }\n\n  .frame {\n    border: 1px solid var(--border-alt);\n    border-radius: 4px;\n    width: 70px;\n    margin-top: 2px;\n    padding: 0 0.2em;\n    text-align: center;\n    white-space: nowrap;\n  }\n}\n</style>\n","<template>\n  <article\n    ref=\"wrapper\"\n    @drop=\"onDrop\"\n    @dragover=\"onDragover\"\n    @dragleave=\"onDragleave\"\n    :class=\"{\n      'add-comment': true,\n      'word-break': true,\n      media: true,\n      'is-dragging': isDragging\n    }\"\n  >\n    <div class=\"media-content\">\n      <div class=\"flexrow tab-row\">\n        <span\n          :class=\"{\n            'flexrow-item': true,\n            filler: true,\n            'has-text-centered': true,\n            active: mode === 'status'\n          }\"\n          @click=\"mode = 'status'\"\n        >\n          {{ $t('tasks.change_status') }}\n        </span>\n        <span\n          :class=\"{\n            'flexrow-item': true,\n            filler: true,\n            'has-text-centered': true,\n            active: mode === 'publish'\n          }\"\n          @click=\"mode = 'publish'\"\n          v-if=\"!isConcept\"\n        >\n          {{ $t('tasks.publish_revision') }}\n        </span>\n      </div>\n\n      <at-ta\n        :ats=\"['#', '@']\"\n        :members=\"[...membersForAts['@'], ...membersForAts['#']]\"\n        name-key=\"full_name\"\n        :limit=\"2\"\n        :filter-match=\"atOptionsFilter\"\n        @update:value=\"onAtTextChanged\"\n        v-if=\"mode === 'status' || showCommentArea\"\n      >\n        <template #item=\"{ item }\">\n          <template v-if=\"item.isTime\">  frame </template>\n          <template v-else-if=\"item.isDepartment\">\n            <span\n              class=\"mr05\"\n              :style=\"{\n                background: item.color,\n                width: '10px',\n                height: '10px',\n                'border-radius': '50%'\n              }\"\n            >\n              &nbsp;\n            </span>\n            {{ item.full_name }}\n          </template>\n          <template v-else-if=\"item.isTaskType\">\n            <task-type-name\n              :task-type=\"{\n                color: item.color,\n                name: item.full_name\n              }\"\n              :is-link=\"false\"\n              thin\n            />\n          </template>\n          <template v-else>\n            <div class=\"flexrow\">\n              <people-avatar\n                class=\"flexrow-item\"\n                :person=\"item\"\n                :size=\"20\"\n                :font-size=\"11\"\n                :is-lazy=\"false\"\n                :is-link=\"false\"\n              />\n              <span class=\"flexrow-item\">\n                {{ item.full_name }}\n              </span>\n            </div>\n          </template>\n        </template>\n        <textarea\n          ref=\"comment-textarea\"\n          class=\"textarea flexrow-item\"\n          :disabled=\"isLoading\"\n          :placeholder=\"$t('comments.add_comment')\"\n          rows=\"2\"\n          @keyup.enter.ctrl=\"\n            runAddComment(\n              text,\n              attachments,\n              checklist,\n              task_status_id,\n              nextRevision,\n              link\n            )\n          \"\n          @keyup.enter.meta=\"\n            runAddComment(\n              text,\n              attachments,\n              checklist,\n              task_status_id,\n              nextRevision,\n              link\n            )\n          \"\n          v-autosize\n          v-focus\n          v-model=\"text\"\n        ></textarea>\n      </at-ta>\n      <div\n        class=\"flexrow link-field\"\n        v-if=\"mode === 'publish' && showLinkField\"\n      >\n        <label class=\"flexrow-item has-text-right\" for=\"input-link\">\n          {{ $t('main.link') }}\n        </label>\n        <input\n          id=\"input-link\"\n          ref=\"input-link\"\n          class=\"input flexrow-item filler preview-link\"\n          placeholder=\"https://...\"\n          type=\"url\"\n          v-model.trim=\"link\"\n        />\n        <span\n          class=\"flexrow-item column preview-delete-link\"\n          @click.prevent=\"toggleLinkField(true)\"\n        >\n          x\n        </span>\n      </div>\n      <div class=\"post-area\">\n        <checklist\n          :checklist=\"checklist\"\n          :frame=\"frame + 1\"\n          :revision=\"revision\"\n          :is-movie-preview=\"isMovie\"\n          @add-item=\"onAddChecklistItem\"\n          @insert-item=\"onInsertChecklistItem\"\n          @remove-task=\"removeTask\"\n          v-if=\"checklist.length > 0\"\n        />\n\n        <div v-if=\"mode === 'publish'\" class=\"post-area mt1\">\n          <div class=\"attachment-title\" v-if=\"previewForms.length > 0\">\n            {{ $t('comments.previews') }}\n          </div>\n          <div\n            :key=\"'preview-' + index\"\n            class=\"preview-file\"\n            v-for=\"(preview, index) in previewForms\"\n          >\n            <div class=\"m0\">\n              {{ shortenText(preview.get('file').name, 40) }}\n              <span @click=\"$emit('remove-preview', preview)\">x</span>\n            </div>\n            <div class=\"progress-wrapper\">\n              <div\n                class=\"progress\"\n                :style=\"{\n                  width: (uploadProgress[preview.get('file').name] || 0) + '%'\n                }\"\n              ></div>\n            </div>\n          </div>\n\n          <div class=\"flexrow preview-section\">\n            <button\n              class=\"button flexrow-item preview-button\"\n              @click=\"$emit('add-preview')\"\n            >\n              {{ $t('comments.add_preview') }}\n            </button>\n          </div>\n          <div class=\"flexrow mt2 mb1\" v-if=\"nextRevision !== undefined\">\n            <label\n              class=\"flexrow-item column has-text-right\"\n              for=\"input-revision\"\n            >\n              {{ $t('tasks.new_revision_number') }}\n            </label>\n            <input\n              id=\"input-revision\"\n              class=\"input flexrow-item column preview-revision\"\n              type=\"number\"\n              :min=\"revision + 1\"\n              pattern=\"[0-9]\"\n              :placeholder=\"revision + 1\"\n              @enter=\"$emit('add-preview')\"\n              v-model.trim=\"nextRevision\"\n            />\n            <span\n              class=\"flexrow-item column preview-delete-revision\"\n              :title=\"$t('tasks.auto_revision')\"\n              @click.prevent=\"nextRevision = undefined\"\n            >\n              x\n            </span>\n          </div>\n        </div>\n\n        <div class=\"attachment-title\" v-if=\"attachments.length > 0\">\n          {{ $t('comments.attachments') }}\n        </div>\n        <div\n          :key=\"'attachment-' + index\"\n          class=\"attachment-file\"\n          v-for=\"(attach, index) in attachments\"\n        >\n          {{ shortenText(attach.get('file').name, 40) }}\n          <span @click=\"removeAttachment(attach)\">x</span>\n        </div>\n\n        <div class=\"flexrow button-row mt1\">\n          <emoji-button @select=\"onSelectEmoji\" v-if=\"mode === 'status'\" />\n          <button-simple\n            :class=\"{\n              'flexrow-item': true,\n              active: attachments.length !== 0\n            }\"\n            icon=\"attach\"\n            :title=\"$t('comments.add_attachment')\"\n            @click=\"onAddCommentAttachmentClicked()\"\n            v-if=\"mode === 'status'\"\n          />\n          <button-simple\n            :class=\"{\n              'flexrow-item': true,\n              active: checklist.length !== 0\n            }\"\n            icon=\"list\"\n            :title=\"$t('comments.add_checklist')\"\n            @click=\"addChecklistEntry(-1)\"\n            v-if=\"mode === 'status'\"\n          />\n          <button-simple\n            :class=\"{\n              'flexrow-item': true,\n              active: showCommentArea\n            }\"\n            icon=\"comment\"\n            :title=\"$t('comments.add_comment')\"\n            @click=\"showCommentArea = !showCommentArea\"\n            v-if=\"mode === 'publish'\"\n          />\n          <button-simple\n            :class=\"{\n              'flexrow-item': true,\n              active: showLinkField\n            }\"\n            icon=\"link\"\n            :title=\"$t('comments.add_link')\"\n            @click=\"toggleLinkField\"\n            v-if=\"mode === 'publish'\"\n          />\n          <div class=\"filler\"></div>\n          <combobox-status\n            class=\"flexrow-item status-selector\"\n            :narrow=\"true\"\n            :color-only=\"true\"\n            :task-status-list=\"taskStatus\"\n            :production-id=\"task.project_id\"\n            v-model=\"task_status_id\"\n          />\n          <button-simple\n            :class=\"{\n              'post-button': true,\n              'flexrow-item': true,\n              'is-loading': isLoading\n            }\"\n            icon=\"send\"\n            :disabled=\"!isValidForm\"\n            :text=\"mode === 'publish' ? $t('tasks.publish') : $t('tasks.post')\"\n            :title=\"\n              mode === 'publish'\n                ? $t('tasks.publish')\n                : $t('comments.post_status')\n            \"\n            @click=\"\n              runAddComment(\n                text,\n                attachments,\n                checklist,\n                task_status_id,\n                nextRevision,\n                link\n              )\n            \"\n          />\n        </div>\n\n        <toggle-button\n          class=\"mb05\"\n          :label=\"$t('comments.add_frame_to_comment')\"\n          v-model=\"isFrameAddition\"\n          v-if=\"isCurrentUserClient && isMovie\"\n        />\n\n        <div class=\"error pull-right\" v-if=\"isError\">\n          <em>{{ $t('comments.error') }}</em>\n        </div>\n        <div class=\"error pull-right\" v-if=\"isMaxRetakesError\">\n          <em>{{ $t('comments.max_retakes_error') }}</em>\n        </div>\n      </div>\n    </div>\n\n    <add-attachment-modal\n      ref=\"add-attachment-modal\"\n      :active=\"modals.addCommentAttachment\"\n      :is-loading=\"loading.addCommentAttachment\"\n      :is-error=\"errors.addCommentAttachment\"\n      :is-movie=\"isMovie\"\n      :title=\"`${task.entity_name} / ${\n        taskTypeMap.get(task.task_type_id).name\n      }`\"\n      @cancel=\"onCloseCommentAttachment\"\n      @confirm=\"addCommentAttachment\"\n      @add-snapshots=\"$emit('annotation-snapshots-requested')\"\n    />\n    <confirm-modal\n      :active=\"modals.confirmFeedbackPublish\"\n      :text=\"$t('comments.confirm_publish')\"\n      :confirm-button-text=\"$t('comments.confirm_publish_button')\"\n      @cancel=\"modals.confirmFeedbackPublish = false\"\n      @confirm=\"\n        () => {\n          modals.confirmFeedbackPublish = false\n          runAddComment(\n            text,\n            attachments,\n            checklist,\n            task_status_id,\n            nextRevision,\n            link,\n            true\n          )\n        }\n      \"\n    />\n  </article>\n</template>\n\n<script>\nimport AtTa from 'vue-at/dist/vue-at-textarea'\nimport { mapGetters } from 'vuex'\n\nimport drafts from '@/lib/drafts'\nimport { remove } from '@/lib/models'\nimport { getDownloadAttachmentPath } from '@/lib/path'\nimport { replaceTimeWithTimecode } from '@/lib/render'\nimport preferences from '@/lib/preferences'\nimport strings from '@/lib/string'\n\nimport AddAttachmentModal from '@/components/modals/AddAttachmentModal.vue'\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\nimport Checklist from '@/components/widgets/Checklist.vue'\nimport ComboboxStatus from '@/components/widgets/ComboboxStatus.vue'\nimport ConfirmModal from '@/components/modals/ConfirmModal.vue'\nimport EmojiButton from '@/components/widgets/EmojiButton.vue'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar.vue'\nimport TaskTypeName from '@/components/widgets/TaskTypeName.vue'\nimport ToggleButton from '@/components/widgets/ToggleButton.vue'\n\nconst REVISION_NUMBER_REGEX = /v(\\d+)/gi\n\nexport default {\n  name: 'add-comment',\n\n  components: {\n    AtTa,\n    AddAttachmentModal,\n    ButtonSimple,\n    Checklist,\n    ConfirmModal,\n    ComboboxStatus,\n    EmojiButton,\n    PeopleAvatar,\n    TaskTypeName,\n    ToggleButton\n  },\n\n  emits: [\n    'add-comment',\n    'add-preview',\n    'annotation-snapshots-requested',\n    'clear-files',\n    'file-drop',\n    'remove-preview'\n  ],\n\n  inject: ['draftComment'],\n\n  data() {\n    return {\n      isFrameAddition: false,\n      membersForAts: { '@': [], '#': [] },\n      isDragging: false,\n      errors: {\n        addCommentAttachment: false\n      },\n      loading: {\n        addCommentAttachment: false\n      },\n      modals: {\n        addCommentAttachment: false,\n        confirmFeedbackPublish: false\n      }\n    }\n  },\n\n  props: {\n    frame: {\n      type: Number,\n      default: 0\n    },\n    isError: {\n      type: Boolean,\n      default: null\n    },\n    isMaxRetakesError: {\n      type: Boolean,\n      default: null\n    },\n    isMovie: {\n      type: Boolean,\n      default: false\n    },\n    isLoading: {\n      type: Boolean,\n      default: null\n    },\n    task: {\n      type: Object,\n      default: () => {}\n    },\n    taskStatus: {\n      type: Array,\n      default: () => []\n    },\n    taskTypes: {\n      type: Array,\n      default: () => []\n    },\n    team: {\n      type: Array,\n      default: () => []\n    },\n    fps: {\n      type: Number,\n      default: 25\n    },\n    revision: {\n      type: Number,\n      default: 1\n    },\n    time: {\n      type: Number,\n      default: 0\n    },\n    previewForms: {\n      type: Array,\n      default: () => []\n    }\n  },\n\n  beforeMount() {\n    if (!this.attachments) {\n      this.attachments = []\n    }\n    if (!this.checklist) {\n      this.checklist = []\n    }\n  },\n\n  mounted() {\n    if (!this.isCurrentUserClient) {\n      this.isFrameAddition = false\n    } else {\n      this.isFrameAddition = preferences.getBoolPreference(\n        'comments:add-frame-when-posting',\n        false\n      )\n    }\n    const production = this.productionMap.get(this.task.project_id)\n    this.mode =\n      production?.is_publish_default_for_artists && this.isCurrentUserArtist\n        ? 'publish'\n        : 'status'\n\n    this.$nextTick(() => {\n      ;[\n        'drag',\n        'dragstart',\n        'dragend',\n        'dragover',\n        'dragenter',\n        'dragleave',\n        'drop'\n      ].forEach(evt => {\n        if (this.$refs.wrapper) {\n          this.$refs.wrapper.addEventListener(evt, e => {\n            e.preventDefault()\n            e.stopPropagation()\n          })\n        }\n      })\n    })\n    window.addEventListener('paste', this.onPaste, false)\n  },\n\n  beforeUnmount() {\n    window.removeEventListener('paste', this.onPaste, false)\n  },\n\n  computed: {\n    ...mapGetters([\n      'departmentMap',\n      'isCurrentUserArtist',\n      'isCurrentUserClient',\n      'productionDepartmentIds',\n      'productionMap',\n      'taskStatusForCurrentUser',\n      'taskStatusMap',\n      'taskTypeMap',\n      'uploadProgress'\n    ]),\n\n    attachments: {\n      get() {\n        return this.draftComment.attachments\n      },\n      set(value) {\n        this.draftComment.attachments = value\n      }\n    },\n\n    checklist: {\n      get() {\n        return this.draftComment.checklist\n      },\n      set(value) {\n        this.draftComment.checklist = value\n      }\n    },\n\n    link: {\n      get() {\n        return this.draftComment.link\n      },\n      set(value) {\n        this.draftComment.link = value\n      }\n    },\n\n    mode: {\n      get() {\n        return this.draftComment.mode\n      },\n      set(value) {\n        this.draftComment.mode = value\n      }\n    },\n\n    nextRevision: {\n      get() {\n        return this.draftComment.nextRevision\n      },\n      set(value) {\n        this.draftComment.nextRevision = value\n      }\n    },\n\n    showCommentArea: {\n      get() {\n        return this.draftComment.showCommentArea\n      },\n      set(value) {\n        this.draftComment.showCommentArea = value\n      }\n    },\n\n    showLinkField: {\n      get() {\n        return this.draftComment.showLinkField\n      },\n      set(value) {\n        this.draftComment.showLinkField = value\n      }\n    },\n\n    task_status_id: {\n      get() {\n        return this.draftComment.task_status_id\n      },\n      set(value) {\n        this.draftComment.task_status_id = value\n      }\n    },\n\n    text: {\n      get() {\n        return this.draftComment.text\n      },\n      set(value) {\n        this.draftComment.text = value\n        drafts.setTaskDraft(this.task.id, this.text)\n      }\n    },\n\n    attachmentModal() {\n      return this.$refs['add-attachment-modal']\n    },\n\n    isConcept() {\n      return this.$route.path.includes('concept')\n    },\n\n    isValidForm() {\n      return Boolean(\n        this.mode === 'status' ||\n        (this.mode === 'publish' &&\n          this.previewForms.length &&\n          (this.nextRevision === undefined ||\n            this.nextRevision > this.revision) &&\n          (!this.showLinkField ||\n            !this.link ||\n            this.$refs['input-link']?.checkValidity()))\n      )\n    }\n  },\n\n  methods: {\n    shortenText: strings.shortenText,\n\n    toggleLinkField(reset = false) {\n      this.showLinkField = !this.showLinkField\n      if (this.showLinkField) {\n        this.$nextTick(() => {\n          this.$refs['input-link']?.focus()\n        })\n      }\n      if (reset) {\n        this.link = null\n      }\n    },\n\n    runAddComment(\n      text,\n      attachments,\n      checklist,\n      taskStatusId,\n      revision,\n      link,\n      force = false\n    ) {\n      if (!this.isValidForm) {\n        return\n      }\n      const taskStatus = this.taskStatusMap.get(this.task_status_id)\n      if (\n        taskStatus.is_feedback_request &&\n        this.previewForms.length === 0 &&\n        !force\n      ) {\n        this.modals.confirmFeedbackPublish = true\n        return\n      }\n\n      if (this.isFrameAddition) {\n        text = '@frame \\n\\n' + text\n        text = replaceTimeWithTimecode(\n          text,\n          this.revision,\n          this.frame + 1,\n          this.fps\n        )\n      }\n\n      this.$store.commit('CLEAR_UPLOAD_PROGRESS')\n      if (this.mode === 'publish') {\n        if (!this.showCommentArea) text = ''\n        attachments = []\n        checklist = []\n      } else {\n        checklist = checklist.filter(item => item.text.length)\n      }\n\n      revision = Number(revision)\n      if (isNaN(revision) || revision < 1) {\n        revision = undefined\n      }\n\n      if (!this.showLinkField) {\n        link = null\n      }\n\n      this.$emit(\n        'add-comment',\n        text,\n        attachments,\n        checklist,\n        taskStatusId,\n        revision,\n        link\n      )\n    },\n\n    reset() {\n      this.text = ''\n      this.link = null\n      this.attachments = []\n      this.checklist = []\n      this.nextRevision = undefined\n    },\n\n    focus() {\n      const textarea = this.$refs['comment-textarea']\n      if (textarea) {\n        textarea.focus()\n        const caretPosition = textarea.value.length\n        textarea.setSelectionRange(caretPosition, caretPosition)\n      }\n    },\n\n    getRevision(form) {\n      if (!form) {\n        return undefined\n      }\n      const file = form.get('file')\n      const rgxMatches = file.name.matchAll(REVISION_NUMBER_REGEX)\n      const revision = Array.from(rgxMatches).pop()?.[1]\n      return revision\n    },\n\n    onAddChecklistItem(item) {\n      delete item.index\n      this.checklist.push(item)\n    },\n\n    onInsertChecklistItem(item) {\n      this.checklist.splice(item.index, 0, item)\n      for (let i = 0; i < this.checklist.length; i++) {\n        this.checklist[i].index = i\n      }\n    },\n\n    resetStatus() {\n      const taskStatus = this.taskStatusMap.get(this.task.task_status_id)\n      if (\n        (!this.isCurrentUserArtist || taskStatus.is_artist_allowed) &&\n        (!this.isCurrentUserClient || taskStatus.is_client_allowed)\n      ) {\n        this.task_status_id = this.task.task_status_id\n      } else {\n        this.task_status_id = this.taskStatusForCurrentUser[0]?.id\n      }\n    },\n\n    onDragover() {\n      this.isDragging = true\n    },\n\n    onDragleave() {\n      this.isDragging = false\n    },\n\n    onDrop(event) {\n      if (event.target.id === 'drop-mask') return\n      if (\n        event.target.parentElement?.className?.indexOf('add-attachment-box') >=\n        0\n      )\n        return\n      if (\n        event.target.parentElement?.className?.indexOf(\n          'add-attachment-buttons'\n        ) >= 0\n      )\n        return\n      if (\n        event.target.parentElement?.className?.indexOf(\n          'attachment-modal-box'\n        ) >= 0\n      )\n        return\n\n      const forms = []\n      for (let i = 0; i < event.dataTransfer.files.length; i++) {\n        const form = new FormData()\n        form.append('file', event.dataTransfer.files[i])\n        forms.push(form)\n      }\n      if (this.mode === 'publish') {\n        this.$emit('file-drop', forms)\n      } else {\n        this.addCommentAttachment(forms)\n      }\n      this.isDragging = false\n    },\n\n    /*\n     * When a file is pasted in the comment area, it adds it to the attachments.\n     */\n    onPaste(event) {\n      if (this.modals.addCommentAttachment) return\n      if (this.$refs['comment-textarea'] !== document.activeElement) return\n      const files = event.clipboardData.files\n      if (files.length > 0) {\n        const form = new FormData()\n        form.append('file', files[0])\n        this.addCommentAttachment([form])\n      }\n    },\n\n    onAddCommentAttachmentClicked() {\n      this.modals.addCommentAttachment = true\n    },\n\n    addCommentAttachment(forms) {\n      this.onCloseCommentAttachment()\n      this.attachments = this.attachments.concat(forms)\n    },\n\n    onCloseCommentAttachment() {\n      this.modals.addCommentAttachment = false\n    },\n\n    removeAttachment(attach) {\n      this.attachments = this.attachments.filter(a => a !== attach)\n    },\n\n    addChecklistEntry(index) {\n      if (index === -1 || index === this.checklist.length - 1) {\n        this.checklist.push({\n          text: '',\n          checked: false\n        })\n      }\n    },\n\n    removeTask(entry) {\n      this.checklist = remove(this.checklist, entry)\n    },\n\n    async setValue(comment) {\n      this.checklist = JSON.parse(JSON.stringify(comment.checklist))\n      this.text = comment.text\n\n      // duplicate attachment files\n      this.attachments = (\n        await Promise.all(\n          comment.attachment_files.map(async attachment => {\n            const fileUrl = getDownloadAttachmentPath(attachment)\n            const response = await fetch(fileUrl)\n            if (!response.ok) return\n            const fileBlob = await response.blob()\n            const formData = new FormData()\n            formData.append('file', fileBlob, attachment.name)\n            return formData\n          })\n        )\n      ).filter(Boolean)\n    },\n\n    atOptionsFilter(name, chunk, at, v) {\n      // filter the list by the given at symbol\n      const option_at = v?.isTaskType ? '#' : '@'\n      // @ for team, # for task type\n      if (at !== option_at) return false\n      // match at lower-case\n      return name?.toLowerCase().indexOf(chunk.toLowerCase()) > -1\n    },\n\n    onAtTextChanged(input) {\n      if (input.includes('@frame')) {\n        this.text = replaceTimeWithTimecode(\n          input,\n          this.revision,\n          this.frame + 1,\n          this.fps\n        )\n      }\n    },\n\n    setAnnotationSnapshots(files) {\n      this.attachmentModal.addFiles(files)\n    },\n\n    showAnnotationLoading() {\n      this.attachmentModal.showAnnotationLoading()\n    },\n\n    hideAnnotationLoading() {\n      this.attachmentModal.hideAnnotationLoading()\n    },\n\n    onSelectEmoji(emoji) {\n      const textarea = this.$refs['comment-textarea']\n      this.text = strings.insertInTextArea(textarea, emoji.i)\n    }\n  },\n\n  watch: {\n    task: {\n      immediate: true,\n      handler() {\n        this.resetStatus()\n        const draft = drafts.getTaskDraft(this.task.id)\n        if (draft) {\n          this.text = draft\n        }\n      }\n    },\n\n    mode() {\n      if (this.mode === 'publish') {\n        this.checklist = []\n        this.attachments = []\n        if (this.text && this.text.length > 0) {\n          this.showCommentArea = true\n        }\n      } else {\n        this.$emit('clear-files')\n      }\n    },\n\n    isFrameAddition(value) {\n      if (this.isCurrentUserClient) {\n        preferences.setPreference('comments:add-frame-when-posting', value)\n      }\n    },\n\n    previewForms: {\n      deep: true,\n      immediate: true,\n      handler() {\n        const form = this.previewForms?.findLast(\n          form => this.getRevision(form) > 0\n        )\n        this.nextRevision = this.getRevision(form)\n      }\n    },\n\n    taskTypes: {\n      deep: true,\n      immediate: true,\n      handler(values) {\n        const taskTypeOptions = values.map(taskType => {\n          return {\n            isTaskType: true,\n            full_name: taskType.name,\n            color: taskType.color,\n            id: taskType.id,\n            url: taskType.url\n          }\n        })\n        taskTypeOptions.push({\n          isTaskType: true,\n          color: '#000',\n          full_name: 'All'\n        })\n        this.membersForAts['#'] = taskTypeOptions\n      }\n    },\n\n    team: {\n      deep: true,\n      immediate: true,\n      handler() {\n        let teamOptions\n        if (this.isCurrentUserClient) {\n          teamOptions = this.team.filter(person =>\n            ['admin', 'manager', 'client'].includes(person.role)\n          )\n        } else {\n          teamOptions = [...this.team]\n        }\n        if (!this.isCurrentUserClient) {\n          teamOptions = teamOptions.concat(\n            this.productionDepartmentIds.map(departmentId => {\n              const department = this.departmentMap.get(departmentId)\n              return {\n                isDepartment: true,\n                full_name: department.name,\n                color: department.color,\n                id: departmentId\n              }\n            })\n          )\n        }\n        teamOptions.push({\n          isTime: true,\n          at: '@',\n          full_name: 'frame'\n        })\n        this.membersForAts['@'] = teamOptions\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@use 'sass:color';\n\n.dark textarea:disabled {\n  background: #555;\n}\n\narticle.add-comment {\n  padding: 0;\n  border-radius: 10px;\n}\n\n.add-comment {\n  border-radius: 5px;\n  background: white;\n  border: 1px solid $light-grey-light;\n  transition: background 0.2s ease;\n\n  textarea {\n    margin: 0;\n    min-height: 57px;\n    max-height: 300px;\n    border-radius: 0;\n\n    &:focus,\n    &:hover,\n    &:active {\n      border-color: var(--border-alt);\n    }\n  }\n}\n\n.post-button-wrapper {\n  margin: 0;\n\n  .button.is-primary {\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n    height: 34px;\n    margin-top: 1px;\n  }\n}\n\n.preview-revision {\n  max-width: 30%;\n}\n\n.preview-delete-link,\n.preview-delete-revision {\n  max-width: 10px;\n  cursor: pointer;\n}\n\n.input {\n  border-radius: 10px;\n  &:invalid {\n    color: $red;\n  }\n}\n\n.mt1 {\n  margin-top: 0.5em;\n}\n\n.is-dragging {\n  background-color: $purple;\n}\n\n.button.is-primary {\n  border-radius: 2em;\n}\n\n.button.active {\n  background: var(--background-selected);\n}\n\n.status-selector {\n  margin: 0;\n}\n\n.preview-button {\n  background: var(--background-alt-2);\n  color: var(--text);\n  margin: 0;\n  text-align: center;\n  width: 100%;\n}\n\n.button-row {\n  padding-bottom: 0.5em;\n\n  .button {\n    border: 0;\n    margin: 0;\n    margin-right: 3px;\n    color: var(--text-alt);\n    padding: 0 10px;\n\n    &:hover {\n      color: var(--text);\n    }\n\n    &.post-button {\n      border: 1px solid var(--border);\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n      padding-right: 1em;\n      &:hover {\n        border: 1px solid var(--border-alt);\n      }\n    }\n  }\n}\n\n.tab-row {\n  color: color.adjust($dark-grey-light, $lightness: 40%);\n  font-size: 0.9em;\n  text-transform: uppercase;\n  margin-top: 5px;\n  margin-bottom: 0;\n\n  span {\n    border-bottom: 1px solid var(--border);\n    cursor: pointer;\n    margin-right: 0;\n    padding-bottom: 0.5em;\n  }\n\n  span.active {\n    color: var(--text);\n    font-weight: 600;\n    // border-bottom: 1px solid $green;\n  }\n}\n\n.attachment-title {\n  margin-left: 3px;\n  margin-top: 6px;\n  color: $grey;\n  font-size: 0.8em;\n  text-transform: uppercase;\n}\n\n.attachment-file {\n  margin-top: 3px;\n  margin-bottom: 3px;\n  margin-left: 3px;\n  margin-right: 3px;\n  padding-bottom: 3px;\n  border-bottom: 1px dashed $light-grey-light;\n\n  span {\n    cursor: pointer;\n    float: right;\n  }\n}\n\n.preview-file {\n  margin-top: 1em;\n  margin-bottom: 3px;\n  margin-left: 3px;\n  margin-right: 3px;\n\n  span {\n    cursor: pointer;\n    float: right;\n  }\n}\n\n.link-field {\n  margin: 1em;\n}\n\n.post-area {\n  position: relative;\n  padding: 0 0.5em 0.2em 0.5em;\n}\n\n.progress-wrapper {\n  border-radius: 5px;\n  background: var(--background-alt);\n  height: 5px;\n  margin-top: 0.3em;\n  margin-bottom: 1em;\n}\n\n.progress {\n  height: 5px;\n  width: 100%;\n  background-color: $light-green;\n}\n\ninput[type='number']::-webkit-outer-spin-button,\ninput[type='number']::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type='number'] {\n  -moz-appearance: textfield;\n}\n</style>\n","<template>\n  <div\n    id=\"add-comment-modal\"\n    :class=\"{\n      modal: true,\n      'is-active': active\n    }\"\n    ref=\"modal\"\n  >\n    <div\n      ref=\"background\"\n      class=\"modal-background\"\n      @click=\"$emit('cancel')\"\n    ></div>\n\n    <div\n      class=\"modal-content\"\n      @dragover=\"onFileDragover\"\n      @dragleave=\"onFileDragLeave\"\n    >\n      <div id=\"modal-content\" class=\"box content\" :class=\"{ dragging: true }\">\n        <div\n          ref=\"dropMask\"\n          id=\"drop-mask\"\n          class=\"drop-mask\"\n          @drop=\"onDrop\"\n          v-if=\"isDraggingFile\"\n        >\n          {{ $t('main.drop_files_here') }}\n        </div>\n        <h2 class=\"subtitle\">{{ title }}</h2>\n        <h1 class=\"title\" v-if=\"isEditing\">\n          {{ $t('tasks.change_preview') }}\n        </h1>\n        <h1 class=\"title\" v-else>\n          {{ isConcept ? $t('concepts.add_concept') : $t('tasks.add_preview') }}\n        </h1>\n\n        <p>\n          {{ $t('tasks.select_preview_file') }}\n        </p>\n\n        <file-upload\n          ref=\"preview-field\"\n          class=\"preview-files-field\"\n          :accept=\"extensions\"\n          :is-primary=\"false\"\n          :label=\"$t('main.select_file')\"\n          :multiple=\"isMultiple\"\n          @fileselected=\"onFileSelected\"\n          hide-file-names\n        />\n\n        <p class=\"error\" v-if=\"isError\">\n          {{\n            isConcept\n              ? $t('concepts.add_concept_error')\n              : $t('tasks.add_preview_error')\n          }}\n        </p>\n\n        <h3 class=\"subtitle has-text-centered\" v-if=\"forms.length > 0\">\n          Selected Files\n        </h3>\n        <div class=\"upload-previews\" v-if=\"forms.length > 0\">\n          <template v-for=\"(form, index) in forms\" :key=\"`preview-${index}`\">\n            <p class=\"preview-name\">\n              {{ form.get('file').name }}\n              <span @click=\"removePreview(form)\">x</span>\n            </p>\n            <img alt=\"uploaded file\" :src=\"getURL(form)\" v-if=\"isImage(form)\" />\n            <video\n              :ref=\"`video-${index}`\"\n              :src=\"getURL(form)\"\n              preload=\"auto\"\n              class=\"is-fullwidth\"\n              autoplay\n              controls\n              loop\n              muted\n              v-else-if=\"isVideo(form)\"\n            />\n            <iframe\n              class=\"is-fullwidth\"\n              frameborder=\"0\"\n              :src=\"getURL(form)\"\n              v-else-if=\"isPdf(form)\"\n            />\n            <hr />\n          </template>\n        </div>\n\n        <div class=\"mt1 message\" v-if=\"message\">\n          <div class=\"message-body\">\n            {{ $t(message) }}\n          </div>\n        </div>\n\n        <p class=\"mb2 mt2 warning-text\" v-if=\"isWrongDuration\">\n          <alert-triangle-icon class=\"icon mr05 warning\" />\n          {{ $t('shots.wrong_file_duration') }}\n        </p>\n\n        <p class=\"has-text-right\">\n          <a\n            :class=\"{\n              button: true,\n              'is-primary': true,\n              'is-loading': isLoading,\n              'is-disabled': forms.length === 0\n            }\"\n            @click=\"$emit('confirm', forms)\"\n          >\n            {{\n              confirmLabel?.length\n                ? confirmLabel\n                : isConcept\n                  ? $t('main.confirmation')\n                  : $t('tasks.add_revision_confirm')\n            }}\n          </a>\n          <button @click=\"$emit('cancel')\" class=\"button is-link\">\n            {{ $t('main.cancel') }}\n          </button>\n        </p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { AlertTriangleIcon } from 'lucide-vue-next'\n\nimport files from '@/lib/files'\n\nimport { modalMixin } from '@/components/modals/base_modal'\nimport FileUpload from '@/components/widgets/FileUpload.vue'\n\nexport default {\n  name: 'add-preview-modal',\n\n  mixins: [modalMixin],\n\n  components: {\n    AlertTriangleIcon,\n    FileUpload\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    confirmLabel: {\n      type: String,\n      default: ''\n    },\n    extensions: {\n      type: String,\n      default: files.ALL_EXTENSIONS_STRING\n    },\n    isConcept: {\n      type: Boolean,\n      default: false\n    },\n    isEditing: {\n      type: Boolean,\n      default: false\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    isMultiple: {\n      type: Boolean,\n      default: true\n    },\n    message: {\n      type: String,\n      default: 'tasks.revision_preview_file'\n    },\n    title: {\n      type: String,\n      default: ''\n    },\n    fps: {\n      type: Number,\n      default: 0\n    },\n    expectedFrames: {\n      type: Number,\n      default: 0\n    }\n  },\n\n  emits: ['cancel', 'confirm', 'fileselected'],\n\n  data() {\n    return {\n      forms: [],\n      isWrongDuration: false,\n      isDraggingFile: false\n    }\n  },\n\n  computed: {\n    previewField() {\n      return this.$refs['preview-field']\n    }\n  },\n\n  methods: {\n    setFiles(files) {\n      this.previewField.filesChange('file', files)\n    },\n\n    onFileSelected(forms) {\n      this.forms = this.isMultiple ? this.forms.concat(forms) : [forms]\n      this.$emit('fileselected', this.forms)\n    },\n\n    reset() {\n      this.previewField?.reset()\n      this.forms = []\n      this.isWrongDuration = false\n    },\n\n    onPaste(event) {\n      if (this.active && event.clipboardData.files) {\n        this.previewField.filesChange('', event.clipboardData.files)\n      }\n    },\n\n    getURL(form) {\n      return window.URL.createObjectURL(form.get('file'))\n    },\n\n    isImage(form) {\n      return form.get('file').type.startsWith('image')\n    },\n\n    isVideo(form) {\n      return form.get('file').type.startsWith('video')\n    },\n\n    isPdf(form) {\n      return form.get('file').type.indexOf('pdf') > 0\n    },\n\n    removePreview(form) {\n      this.forms = this.forms.filter(f => f !== form)\n    },\n\n    onFileDragover(event) {\n      event.preventDefault()\n      event.stopPropagation()\n      this.isDraggingFile = true\n    },\n\n    onFileDragLeave(event) {\n      event.preventDefault()\n      event.stopPropagation()\n      if (event.target.id === 'drop-mask') {\n        this.isDraggingFile = false\n      }\n    },\n\n    onDrag(event) {},\n\n    onDrop(event) {\n      this.previewField.onDrop(event)\n      this.isDraggingFile = false\n      event.preventDefault()\n    }\n  },\n\n  watch: {\n    active() {\n      this.reset()\n    },\n\n    forms: {\n      deep: true,\n      handler() {\n        this.$nextTick(() => {\n          this.isWrongDuration = false\n          if (this.expectedFrames !== 0) {\n            Object.keys(this.$refs).forEach(key => {\n              const ref = this.$refs[key]\n              if (key.startsWith('video-') && ref[0]) {\n                ref[0].onloadedmetadata = () => {\n                  if (!ref[0]) return\n                  const frames = Math.round(ref[0].duration * this.fps)\n                  if (frames !== this.expectedFrames) {\n                    this.isWrongDuration = true\n                  }\n                }\n              }\n            })\n          }\n        })\n      }\n    }\n  },\n\n  mounted() {\n    this.forms = []\n    window.addEventListener('paste', this.onPaste, false)\n  },\n\n  beforeUnmount() {\n    window.removeEventListener('paste', this.onPaste)\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.modal-content {\n  max-height: calc(100vh - 150px);\n}\n\n.modal-content .box p.text {\n  margin-bottom: 1em;\n}\n\n.error {\n  margin-top: 1em;\n}\n\n.description {\n  margin-bottom: 1em;\n}\n\n.is-fullwidth {\n  width: 100%;\n}\n\n.upload-previews {\n  text-align: center;\n  padding: 1.5em;\n  max-height: 40vh;\n  overflow-y: auto;\n}\n\n.subtitle {\n  color: $grey;\n  font-size: 1.2em;\n  margin: 0;\n  margin-bottom: 1em;\n  padding: 0;\n  text-transform: uppercase;\n}\n\n.modal-content .box h1.title {\n  font-weight: 350;\n  font-size: 2.2em;\n  line-height: 1.2em;\n  margin-bottom: 0.5em;\n}\n\nh3 {\n  font-weight: 350;\n  font-size: 1.4em;\n  margin-top: 0.5em;\n  padding: 0;\n}\n\nh3.subtitle {\n  margin-top: 1em;\n  font-weight: 400;\n}\n\n.preview-name span {\n  cursor: pointer;\n  float: right;\n}\n\n.message-body {\n  border-width: 0 0 0 4px;\n}\n\n.preview-files-field {\n  margin: auto;\n}\n\n.box.content {\n  position: relative;\n}\n\n.drop-mask {\n  align-items: center;\n  background: rgba(0.1, 0, 0, 0.5);\n  border-radius: 5px;\n  color: white;\n  display: flex;\n  font-size: 2em;\n  justify-content: center;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 1000;\n}\n</style>\n","<template>\n  <div class=\"comment-menu\">\n    <div @click=\"$emit('pin-clicked')\" v-if=\"isPinnable && !isEmpty\">\n      {{ isPinned ? $t('comments.unpin') : $t('comments.pin') }}\n    </div>\n    <div @click=\"$emit('edit-clicked')\" v-if=\"isEditable\">\n      {{ $t('main.edit') }}\n    </div>\n    <div class=\"error\" @click=\"$emit('delete-clicked')\" v-if=\"isEditable\">\n      {{ $t('main.delete') }}\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'comment-menu',\n\n  props: {\n    isEditable: {\n      type: Boolean,\n      default: true\n    },\n    isEmpty: {\n      type: Boolean,\n      default: false\n    },\n    isPinnable: {\n      type: Boolean,\n      default: true\n    },\n    isPinned: {\n      type: Boolean,\n      default: false\n    }\n  },\n\n  emits: ['delete-clicked', 'edit-clicked', 'pin-clicked']\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark .comment-menu {\n  background-color: $dark-grey-light;\n  box-shadow: 0 2px 6px $dark-grey-light;\n  color: $light-grey-light;\n}\n\n.comment-menu {\n  border-radius: 10px;\n  position: absolute;\n  background: white;\n  width: 118px;\n  box-shadow: 0 2px 6px $light-grey;\n  top: 20px;\n  left: -90px;\n  z-index: 100;\n  overflow: hidden;\n\n  div {\n    cursor: pointer;\n    padding: 0.5em;\n\n    &:hover {\n      background-color: var(--background-alt);\n    }\n  }\n}\n</style>\n","<template>\n  <div>\n    <article\n      class=\"comment\"\n      :class=\"{\n        pinned: comment.pinned\n      }\"\n      :style=\"{\n        'box-shadow': boxShadowStyle\n      }\"\n      v-if=\"!isEmpty\"\n    >\n      <div class=\"content-wrapper full\">\n        <div class=\"flexrow\">\n          <validation-tag\n            class=\"flexrow-item\"\n            :task=\"{ task_status_id: comment.task_status.id }\"\n            :is-static=\"true\"\n            :thin=\"!isChange\"\n          />\n          <people-avatar\n            class=\"flexrow-item\"\n            :size=\"25\"\n            :font-size=\"12\"\n            :person=\"comment.person\"\n            v-if=\"!isCurrentUserClient || isAuthorClient\"\n          />\n          <strong class=\"flexrow-item\">\n            <people-name\n              :person=\"comment.person\"\n              v-if=\"!isCurrentUserClient || isAuthorClient\"\n            />\n          </strong>\n          <div class=\"filler\"></div>\n          <span class=\"flexrow-item date\" :title=\"fullDate\">\n            {{ shortDate }}\n          </span>\n          <div\n            class=\"flexrow-item menu-wrapper\"\n            v-if=\"isPinnable || isEditable\"\n          >\n            <chevron-down-icon class=\"menu-icon\" @click=\"toggleCommentMenu\" />\n            <comment-menu\n              :is-pinnable=\"isPinnable\"\n              :is-pinned=\"comment.pinned\"\n              :is-editable=\"isEditable\"\n              @pin-clicked=\"\n                () => {\n                  $emit('pin-comment', comment)\n                  toggleCommentMenu()\n                }\n              \"\n              @edit-clicked=\"\n                () => {\n                  $emit('edit-comment', comment)\n                  toggleCommentMenu()\n                }\n              \"\n              @delete-clicked=\"\n                () => {\n                  $emit('delete-comment', comment)\n                  toggleCommentMenu()\n                }\n              \"\n              v-if=\"menuVisible\"\n            />\n          </div>\n        </div>\n        <div class=\"flexrow-item comment-content\">\n          <div class=\"content\">\n            <p\n              class=\"client-comment\"\n              v-if=\"isAuthorClient && !isCurrentUserClient\"\n            >\n              {{ $t('comments.comment_from_client') }}\n              <copy-icon\n                class=\"copy-icon\"\n                :size=\"12\"\n                @click=\"$emit('duplicate-comment', comment)\"\n              />\n            </p>\n            <p\n              v-html=\"\n                renderComment(\n                  comment.text,\n                  comment.mentions,\n                  comment.department_mentions || [],\n                  personMap,\n                  departmentMap,\n                  taskTypes,\n                  uniqueClassName\n                )\n              \"\n              class=\"comment-text\"\n              v-if=\"comment.text\"\n            ></p>\n            <checklist\n              class=\"checklist\"\n              :checklist=\"checklist\"\n              :disabled=\"true\"\n              :is-editable=\"isCheckable\"\n              @remove-task=\"removeTask\"\n              @emit-change=\"onChecklistChanged\"\n              @time-code-clicked=\"onChecklistTimecodeClicked\"\n              v-if=\"checklist.length > 0\"\n            />\n            <p v-if=\"comment.attachment_files.length > 0\">\n              <a\n                :href=\"getDownloadAttachmentPath(attachment)\"\n                :key=\"attachment.id\"\n                :title=\"attachment.name\"\n                target=\"_blank\"\n                v-for=\"attachment in pictureAttachments\"\n              >\n                <img\n                  class=\"attachment\"\n                  :src=\"getDownloadAttachmentPath(attachment)\"\n                />\n              </a>\n              <a\n                :href=\"getDownloadAttachmentPath(attachment)\"\n                :key=\"attachment.id\"\n                :title=\"attachment.name\"\n                class=\"flexrow\"\n                target=\"_blank\"\n                v-for=\"attachment in fileAttachments\"\n              >\n                <paperclip-icon class=\"flexrow-item attachment-icon icon-1x\" />\n                <span class=\"flexrow-item\">\n                  {{ attachment.name }}\n                </span>\n              </a>\n            </p>\n            <div class=\"replies\">\n              <div\n                :key=\"replyComment.id\"\n                class=\"reply-comment\"\n                v-for=\"replyComment in comment.replies || []\"\n              >\n                <div class=\"flexrow\">\n                  <people-avatar\n                    class=\"flexrow-item\"\n                    :size=\"18\"\n                    :font-size=\"10\"\n                    :person=\"personMap.get(replyComment.person_id)\"\n                  />\n                  <strong class=\"flexrow-item\">\n                    <people-name\n                      :person=\"personMap.get(replyComment.person_id)\"\n                    />\n                  </strong>\n                  <span\n                    class=\"flexrow-item reply-date\"\n                    :title=\"replyFullDate(replyComment.date)\"\n                  >\n                    {{ replyShortDate(replyComment.date) }}\n                  </span>\n                  <span class=\"filler\"> </span>\n                  <span\n                    class=\"flexrow-item reply-delete\"\n                    :title=\"$t('main.delete')\"\n                    @click=\"onDeleteReplyClicked(replyComment)\"\n                    v-if=\"\n                      isCurrentUserAdmin || replyComment.person_id === user.id\n                    \"\n                  >\n                    x\n                  </span>\n                </div>\n                <p\n                  v-html=\"\n                    renderComment(\n                      replyComment.text,\n                      replyComment.mentions || [],\n                      replyComment.department_mentions || [],\n                      personMap,\n                      departmentMap,\n                      taskTypes,\n                      uniqueClassName\n                    )\n                  \"\n                  class=\"comment-text\"\n                ></p>\n\n                <p>\n                  <a\n                    :href=\"getDownloadAttachmentPath(attachment)\"\n                    :key=\"attachment.id\"\n                    :title=\"attachment.name\"\n                    target=\"_blank\"\n                    v-for=\"attachment in replyAttachmentMap.get(replyComment.id)\n                      ?.pictures\"\n                  >\n                    <img\n                      class=\"attachment\"\n                      :src=\"getDownloadAttachmentPath(attachment)\"\n                    />\n                  </a>\n                  <a\n                    :href=\"getDownloadAttachmentPath(attachment)\"\n                    :key=\"attachment.id\"\n                    :title=\"attachment.name\"\n                    class=\"flexrow\"\n                    target=\"_blank\"\n                    v-for=\"attachment in replyAttachmentMap.get(replyComment.id)\n                      ?.files\"\n                  >\n                    <paperclip-icon\n                      class=\"flexrow-item attachment-icon icon-1x\"\n                    />\n                    <span class=\"flexrow-item\">\n                      {{ attachment.name }}\n                    </span>\n                  </a>\n                </p>\n              </div>\n              <div\n                @drop=\"onDrop\"\n                @dragover=\"onDragover\"\n                @dragleave=\"onDragleave\"\n              >\n                <template v-if=\"showReply\">\n                  <at-ta\n                    :ats=\"['#', '@']\"\n                    :members=\"[...membersForAts['@'], ...membersForAts['#']]\"\n                    :filter-match=\"atOptionsFilter\"\n                    name-key=\"full_name\"\n                    :limit=\"2\"\n                    @update:value=\"onAtTextChanged\"\n                  >\n                    <template #item=\"{ item }\">\n                      <template v-if=\"item.isTime\">  frame </template>\n                      <template v-else-if=\"item.isDepartment\">\n                        <span\n                          class=\"mr05\"\n                          :style=\"{\n                            background: item.color,\n                            width: '10px',\n                            height: '10px',\n                            'border-radius': '50%'\n                          }\"\n                        >\n                          &nbsp;\n                        </span>\n                        {{ item.full_name }}\n                      </template>\n                      <template v-else-if=\"item.isTaskType\">\n                        <task-type-name\n                          :task-type=\"{\n                            color: item.color,\n                            name: item.full_name\n                          }\"\n                          :is-link=\"false\"\n                          thin\n                        />\n                      </template>\n                      <template v-else>\n                        <div class=\"flexrow\">\n                          <people-avatar\n                            class=\"flexrow-item\"\n                            :person=\"item\"\n                            :size=\"20\"\n                            :font-size=\"11\"\n                            :is-lazy=\"false\"\n                            :is-link=\"false\"\n                          />\n                          <span class=\"flexrow-item\">\n                            {{ item.full_name }}\n                          </span>\n                        </div>\n                      </template>\n                    </template>\n                    <textarea\n                      ref=\"reply\"\n                      class=\"reply\"\n                      @keyup.ctrl.enter=\"onReplyClicked\"\n                      @dragover=\"onDragover\"\n                      @dragleave=\"onDragleave\"\n                      v-model=\"replyText\"\n                    />\n                  </at-ta>\n                  <div class=\"reply-attachments\">\n                    <div\n                      :key=\"'attachment-' + index\"\n                      class=\"attachment-file\"\n                      v-for=\"(attach, index) in replyAttachments\"\n                    >\n                      {{ shortenText(attach.get('file').name, 40) }}\n                      <span @click=\"removeReplyAttachment(attach)\">x</span>\n                    </div>\n                  </div>\n                  <div class=\"flexrow ml05\">\n                    <emoji-button\n                      class=\"ml05 flexrow-item\"\n                      @select=\"onSelectEmoji\"\n                    />\n                    <button-simple\n                      class=\"flexrow-item attachment-button\"\n                      icon=\"attach\"\n                      :title=\"$t('comments.add_attachment')\"\n                      @click=\"modals.addAttachment = true\"\n                    />\n                    <span class=\"filler\"></span>\n                    <button-simple\n                      class=\"reply-button\"\n                      :text=\"$t('main.reply')\"\n                      :is-loading=\"isReplyLoading\"\n                      @click=\"onReplyClicked\"\n                    />\n                  </div>\n                </template>\n              </div>\n            </div>\n\n            <div\n              class=\"flexrow\"\n              :title=\"isLikedBy\"\n              v-if=\"\n                comment.text.length > 0 ||\n                comment.previews.length > 0 ||\n                comment.attachment_files.length > 0\n              \"\n            >\n              <button\n                class=\"like-button flexrow-item\"\n                :class=\"{\n                  'like-button--empty': comment.like === undefined\n                }\"\n                type=\"button\"\n                @click=\"acknowledgeComment(comment)\"\n              >\n                <thumbs-up-icon class=\"icon-1x\" />\n                <span>{{ comment.acknowledgements.length }}</span>\n              </button>\n              <span class=\"filler\"></span>\n              <span\n                class=\"flexrow-item reply-button\"\n                @click=\"showReplyWidget\"\n                v-if=\"!showReply && isReplyable\"\n              >\n                {{ $t('main.reply') }}\n              </span>\n            </div>\n            <div class=\"pinned-text\" v-if=\"comment.pinned\">\n              {{ $t('comments.pinned') }}\n            </div>\n            <div\n              class=\"edited-text\"\n              v-if=\"\n                comment.editor_id && comment.editor_id !== comment.person_id\n              \"\n            >\n              {{\n                $t('comments.edited_by', {\n                  name: personMap.get(comment.editor_id)?.full_name\n                })\n              }}\n            </div>\n          </div>\n        </div>\n      </div>\n      <div\n        class=\"flexrow content-wrapper preview-info\"\n        v-if=\"comment.previews.length > 0 && !isConcept\"\n      >\n        <router-link class=\"round-name revision\" :to=\"previewRoute\">\n          {{\n            comment.pinned\n              ? $t('comments.pinned_revision')\n              : $t('comments.revision')\n          }}\n          {{ comment.previews[0].revision }}\n        </router-link>\n        <a\n          class=\"preview-link button\"\n          :href=\"comment.links[0]\"\n          :title=\"$t('playlists.actions.open_link')\"\n          target=\"_blank\"\n          v-if=\"!isCurrentUserArtist && comment.links?.[0]?.length\"\n        >\n          <link-icon class=\"icon is-small\" />\n        </a>\n        <span\n          class=\"flexrow-item preview-status\"\n          :class=\"{ pointer: isCurrentUserManager }\"\n          :title=\"comment.previews[0].validation_status\"\n          :data-status=\"comment.previews[0].validation_status\"\n          @click=\"changePreviewValidationStatus(comment.previews)\"\n        ></span>\n      </div>\n    </article>\n    <div class=\"empty-comment\" v-else>\n      <div class=\"flexrow content-wrapper\">\n        <validation-tag\n          class=\"flexrow-item\"\n          :task=\"{ task_status_id: comment.task_status.id }\"\n          :is-static=\"true\"\n          :thin=\"!isChange\"\n        />\n        <people-avatar\n          class=\"flexrow-item\"\n          :person=\"comment.person\"\n          :size=\"25\"\n          :font-size=\"12\"\n        />\n        <people-name class=\"flexrow-item\" :person=\"comment.person\" />\n        <span class=\"filler\"> </span>\n        <span class=\"flexrow-item date\" :title=\"fullDate\">\n          {{ shortDate }}\n        </span>\n        <div class=\"flexrow-item menu-wrapper\" v-if=\"isPinnable || isEditable\">\n          <chevron-down-icon class=\"menu-icon\" @click=\"toggleCommentMenu\" />\n          <comment-menu\n            :is-pinnable=\"isPinnable\"\n            :is-editable=\"isEditable\"\n            :is-empty=\"true\"\n            @pin-clicked=\"\n              () => {\n                $emit('pin-comment', comment)\n                toggleCommentMenu()\n              }\n            \"\n            @edit-clicked=\"\n              () => {\n                $emit('edit-comment', comment)\n                toggleCommentMenu()\n              }\n            \"\n            @delete-clicked=\"\n              () => {\n                $emit('delete-comment', comment)\n                toggleCommentMenu()\n              }\n            \"\n            v-if=\"menuVisible\"\n          />\n        </div>\n      </div>\n    </div>\n    <add-attachment-modal\n      ref=\"add-attachment-modal\"\n      :active=\"modals.addAttachment\"\n      :title=\"$t('comments.add_attachment_to_reply')\"\n      @cancel=\"modals.addAttachment = false\"\n      @confirm=\"addAttachmentToReply\"\n      v-if=\"modals.addAttachment\"\n    />\n  </div>\n</template>\n\n<script>\nimport AtTa from 'vue-at/dist/vue-at-textarea'\nimport moment from 'moment'\nimport { mapActions, mapGetters } from 'vuex'\nimport {\n  ChevronDownIcon,\n  CopyIcon,\n  LinkIcon,\n  PaperclipIcon,\n  ThumbsUpIcon\n} from 'lucide-vue-next'\n\nimport files from '@/lib/files'\nimport { remove } from '@/lib/models'\nimport { getDownloadAttachmentPath, pluralizeEntityType } from '@/lib/path'\nimport { renderComment, replaceTimeWithTimecode } from '@/lib/render'\nimport { sortByName } from '@/lib/sorting'\nimport { formatDate, parseDate } from '@/lib/time'\nimport stringHelpers from '@/lib/string'\n\nimport { domMixin } from '@/components/mixins/dom'\n\nimport AddAttachmentModal from '@/components/modals/AddAttachmentModal.vue'\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\nimport CommentMenu from '@/components/widgets/CommentMenu.vue'\nimport Checklist from '@/components/widgets/Checklist.vue'\nimport EmojiButton from '@/components/widgets/EmojiButton.vue'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar.vue'\nimport PeopleName from '@/components/widgets/PeopleName.vue'\nimport TaskTypeName from '@/components/widgets/TaskTypeName.vue'\nimport ValidationTag from '@/components/widgets/ValidationTag.vue'\n\nexport default {\n  name: 'comment',\n\n  mixins: [domMixin],\n\n  components: {\n    AtTa,\n    AddAttachmentModal,\n    ButtonSimple,\n    Checklist,\n    ChevronDownIcon,\n    CopyIcon,\n    CommentMenu,\n    EmojiButton,\n    LinkIcon,\n    PaperclipIcon,\n    PeopleAvatar,\n    PeopleName,\n    ThumbsUpIcon,\n    ValidationTag,\n    TaskTypeName\n  },\n\n  data() {\n    return {\n      membersForAts: { '@': [], '#': [] },\n      checklist: [],\n      isReplyLoading: false,\n      menuVisible: false,\n      modals: {\n        addAttachment: false\n      },\n      replyAttachments: [],\n      replyText: '',\n      showReply: false,\n      uniqueClassName: (Math.random() + 1).toString(36).substring(2)\n    }\n  },\n\n  emits: [\n    'ack-comment',\n    'checklist-updated',\n    'delete-comment',\n    'duplicate-comment',\n    'edit-comment',\n    'pin-comment',\n    'time-code-clicked'\n  ],\n\n  props: {\n    comment: {\n      type: Object,\n      default: () => {}\n    },\n    frame: {\n      type: Number,\n      default: 0\n    },\n    fps: {\n      type: Number,\n      default: 25\n    },\n    isChange: {\n      type: Boolean,\n      default: false\n    },\n    isCheckable: {\n      type: Boolean,\n      default: false\n    },\n    isEditable: {\n      type: Boolean,\n      default: false\n    },\n    isPinnable: {\n      type: Boolean,\n      default: false\n    },\n    isReplyable: {\n      type: Boolean,\n      default: false\n    },\n    taskTypes: {\n      type: Array,\n      default: () => []\n    },\n    team: {\n      type: Array,\n      default: () => []\n    },\n    task: {\n      type: Object,\n      default: null\n    },\n    revision: {\n      type: Number,\n      default: 1\n    }\n  },\n\n  mounted() {\n    if (this.comment.checklist) {\n      this.$options.silent = true\n      this.checklist = [...this.comment.checklist]\n      this.$nextTick().then(() => {\n        this.$options.silent = false\n      })\n    }\n    Array.from(document.getElementsByClassName(this.uniqueClassName)).forEach(\n      element => {\n        element.addEventListener('click', this.timeCodeClicked)\n      }\n    )\n    window.addEventListener('paste', this.onPaste, false)\n  },\n\n  beforeUnmount() {\n    Array.from(document.getElementsByClassName(this.uniqueClassName)).forEach(\n      element => {\n        element.removeEventListener('click', this.timeCodeClicked)\n      }\n    )\n    window.removeEventListener('paste', this.onPaste, false)\n  },\n\n  computed: {\n    ...mapGetters([\n      'departmentMap',\n      'isCurrentUserAdmin',\n      'isCurrentUserArtist',\n      'isCurrentUserClient',\n      'isCurrentUserManager',\n      'personMap',\n      'productionDepartmentIds',\n      'taskTypeMap',\n      'user'\n    ]),\n\n    isConcept() {\n      return this.$route.path.includes('concept')\n    },\n\n    isEmpty() {\n      return (\n        this.comment.text.length === 0 &&\n        (!this.comment.checklist || this.comment.checklist.length === 0) &&\n        this.comment.attachment_files.length === 0 &&\n        this.comment.previews.length === 0\n      )\n    },\n\n    previewRoute() {\n      let route = {\n        name: 'task',\n        params: {\n          task_id: this.comment.object_id,\n          production_id: this.task.project_id\n        }\n      }\n      if (this.comment.previews.length > 0) {\n        route = {\n          name: 'task-preview',\n          params: {\n            task_id: this.comment.object_id,\n            preview_id: this.comment.previews[0].id,\n            production_id: this.task.project_id\n          }\n        }\n      }\n      if (this.task.episode_id) {\n        route.name = `episode-${route.name}`\n        route.params.episode_id = this.task.episode_id\n      } else if (this.task.entity && this.task.entity.episode_id) {\n        route.name = `episode-${route.name}`\n        route.params.episode_id = this.task.entity.episode_id\n      }\n      const taskType = this.taskTypeMap.get(this.task.task_type_id)\n      route.params.type = pluralizeEntityType(taskType.for_entity)\n      return route\n    },\n\n    isLikedBy() {\n      const personList = this.comment.acknowledgements.map(personId =>\n        this.personMap.get(personId)\n      )\n      return sortByName(personList)\n        .map(p => p.name)\n        .join(', ')\n    },\n\n    commentAttachments() {\n      return this.comment.attachment_files.filter(\n        attachment => !attachment.reply_id\n      )\n    },\n\n    pictureAttachments() {\n      return this.commentAttachments\n        .filter(attachment =>\n          files.IMG_EXTENSIONS.includes(attachment.extension)\n        )\n        .sort((a, b) =>\n          a.name.localeCompare(b.name, undefined, {\n            numeric: true\n          })\n        )\n    },\n\n    fileAttachments() {\n      return this.commentAttachments.filter(\n        attachment => !files.IMG_EXTENSIONS.includes(attachment.extension)\n      )\n    },\n\n    replyAttachmentMap() {\n      const map = new Map()\n      this.comment.attachment_files.forEach(attachment => {\n        if (attachment.reply_id) {\n          if (!map.has(attachment.reply_id)) {\n            map.set(attachment.reply_id, {\n              pictures: [],\n              files: []\n            })\n          }\n          if (files.IMG_EXTENSIONS.includes(attachment.extension)) {\n            map.get(attachment.reply_id).pictures.push(attachment)\n          } else {\n            map.get(attachment.reply_id).files.push(attachment)\n          }\n        }\n      })\n      return map\n    },\n\n    commentDate() {\n      return parseDate(this.comment.created_at)\n    },\n\n    fullDate() {\n      return this.commentDate\n        .tz(this.user.timezone)\n        .format('YYYY-MM-DD HH:mm:ss')\n    },\n\n    shortDate() {\n      return this.renderDate(this.commentDate)\n    },\n\n    boxShadowStyle() {\n      const status = this.comment.task_status\n      return `0 0 3px 2px ${status.color}1F`\n    },\n\n    isAuthorClient() {\n      return this.personMap.get(this.comment.person_id)?.role === 'client'\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'deleteReply',\n      'replyToComment',\n      'updatePreviewFileValidationStatus'\n    ]),\n\n    shortenText: stringHelpers.shortenText,\n\n    formatDate(date) {\n      return formatDate(date)\n    },\n\n    replyFullDate(date) {\n      return moment(parseDate(date))\n        .tz(this.user.timezone)\n        .format('YYYY-MM-DD HH:mm:ss')\n    },\n\n    replyShortDate(date) {\n      return this.renderDate(parseDate(date))\n    },\n\n    renderDate(date) {\n      date = moment(date)\n      if (moment().isSame(date, 'd')) {\n        return date.tz(this.user.timezone).format('HH:mm')\n      } else {\n        return date.tz(this.user.timezone).format('MM/DD')\n      }\n    },\n\n    getPath(name) {\n      const route = {\n        name,\n        params: {\n          task_id: this.comment.object_id,\n          comment_id: this.comment.id\n        }\n      }\n      if (this.$route.params.episode_id) {\n        route.name = `episode-${route.name}`\n        route.params.episode_id = this.$route.params.episode_id\n      }\n      return route\n    },\n\n    getDownloadAttachmentPath,\n\n    toggleCommentMenu() {\n      this.menuVisible = !this.menuVisible\n    },\n\n    addChecklistEntry() {\n      this.$options.silent = true\n      this.checklist.push({\n        text: '',\n        checked: false\n      })\n      this.$nextTick().then(() => {\n        this.$options.silent = false\n      })\n    },\n\n    removeTask(entry) {\n      this.checklist = remove(this.checklist, entry)\n    },\n\n    onChecklistChanged() {\n      const now = new Date().getTime()\n      this.lastCall = this.lastCall || 0\n      if (now - this.lastCall > 1000) {\n        this.lastCall = now\n        const comment = {\n          id: this.comment.id,\n          checklist: this.checklist.filter(item => item.text?.length)\n        }\n        this.$emit('checklist-updated', comment)\n      }\n    },\n\n    acknowledgeComment(comment) {\n      this.$emit('ack-comment', comment)\n    },\n\n    timeCodeClicked(event) {\n      const data = { ...event.target.dataset }\n      data.frame = data.frame - 1\n      this.pauseEvent(event)\n      this.$emit('time-code-clicked', data)\n    },\n\n    onChecklistTimecodeClicked(data) {\n      this.$emit('time-code-clicked', {\n        versionRevision: data.revision,\n        frame: data.frame - 1\n      })\n    },\n\n    setFrame(data) {\n      this.$emit('time-code-clicked', {\n        versionRevision: data.revision,\n        frame: data.frame - 1\n      })\n    },\n\n    changePreviewValidationStatus(previewFiles) {\n      if (!this.isCurrentUserManager) {\n        return\n      }\n      const statusMap = {\n        validated: 'rejected',\n        rejected: 'neutral',\n        neutral: 'validated'\n      }\n      const status = statusMap[previewFiles[0].validation_status] || 'validated'\n      previewFiles.forEach(previewFile => {\n        this.updatePreviewFileValidationStatus({ previewFile, status })\n      })\n    },\n\n    renderComment,\n\n    showReplyWidget() {\n      this.showReply = true\n      this.$nextTick(() => {\n        this.$refs.reply?.focus()\n      })\n    },\n\n    onDrop(event) {\n      event.preventDefault()\n      const files = event.dataTransfer.files\n      if (files.length > 0) {\n        const form = new FormData()\n        form.append('file', files[0])\n        this.addAttachmentToReply([form])\n      }\n    },\n\n    onDragover(event) {\n      event.preventDefault()\n    },\n\n    onDragleave(event) {\n      event.preventDefault()\n    },\n\n    onReplyClicked() {\n      this.isReplyLoading = true\n      this.replyToComment({\n        comment: this.comment,\n        text: this.replyText,\n        attachments: this.replyAttachments\n      })\n        .then(() => {\n          this.isReplyLoading = false\n          this.replyText = ''\n          this.showReply = false\n          this.replyAttachments = []\n        })\n        .catch(error => {\n          console.error(error)\n          this.isReplyLoading = false\n        })\n    },\n\n    onDeleteReplyClicked(reply) {\n      this.deleteReply({ comment: this.comment, reply })\n        .then(() => {\n          this.isReplyLoading = false\n        })\n        .catch(console.error)\n    },\n\n    atOptionsFilter(name, chunk, at, v) {\n      // filter the list by the given at symbol\n      const option_at = v?.isTaskType ? '#' : '@'\n      // @ for team, # for task type\n      if (at !== option_at) return false\n      // match at lower-case\n      return name?.toLowerCase().indexOf(chunk.toLowerCase()) > -1\n    },\n\n    onAtTextChanged(input) {\n      if (input.includes('@frame')) {\n        this.replyText = replaceTimeWithTimecode(\n          input,\n          this.revision,\n          this.frame + 1,\n          this.fps\n        )\n      }\n    },\n\n    onSelectEmoji(emoji) {\n      const textarea = this.$refs['reply']\n      this.replyText = stringHelpers.insertInTextArea(textarea, emoji.i)\n    },\n\n    addAttachmentToReply(files) {\n      this.modals.addAttachment = false\n      this.replyAttachments = this.replyAttachments.concat(files)\n    },\n\n    removeReplyAttachment(attachment) {\n      this.replyAttachments = this.replyAttachments.filter(\n        a => a !== attachment\n      )\n    },\n\n    onPaste(event) {\n      if (this.modals.addAttachment || !this.showReply) return\n      if (this.$refs['reply'] !== document.activeElement) return\n      const files = event.clipboardData.files\n      if (files.length > 0) {\n        const form = new FormData()\n        form.append('file', files[0])\n        this.addAttachmentToReply([form])\n      }\n    }\n  },\n\n  watch: {\n    'comment.checklist'() {\n      this.$options.silent = true\n      this.checklist = [...this.comment.checklist]\n      this.$nextTick().then(() => {\n        this.$options.silent = false\n      })\n    },\n\n    checklist() {\n      if (!this.$options.silent) {\n        this.onChecklistChanged()\n      }\n    },\n    taskTypes: {\n      deep: true,\n      immediate: true,\n      handler(values) {\n        const taskTypeOptions = values.map(taskType => {\n          return {\n            isTaskType: true,\n            full_name: taskType.name,\n            color: taskType.color,\n            id: taskType.id,\n            url: taskType.url\n          }\n        })\n        taskTypeOptions.push({\n          isTaskType: true,\n          color: '#000',\n          full_name: 'All'\n        })\n        this.membersForAts['#'] = taskTypeOptions\n      }\n    },\n\n    team: {\n      deep: true,\n      immediate: true,\n      handler() {\n        let teamOptions\n        if (this.isCurrentUserClient) {\n          teamOptions = this.team.filter(person =>\n            ['admin', 'manager', 'client'].includes(person.role)\n          )\n        } else {\n          teamOptions = [...this.team]\n        }\n        if (!this.isCurrentUserClient) {\n          teamOptions = teamOptions.concat(\n            this.productionDepartmentIds.map(departmentId => {\n              const department = this.departmentMap.get(departmentId)\n              return {\n                isDepartment: true,\n                full_name: department.name,\n                color: department.color,\n                id: departmentId\n              }\n            })\n          )\n        }\n        teamOptions.push({\n          isTime: true,\n          full_name: 'frame'\n        })\n        this.membersForAts['@'] = teamOptions\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@use 'sass:color';\n\n.dark {\n  .comment-text {\n    color: $white-grey;\n  }\n  .comment-footer {\n    color: $grey;\n  }\n\n  .content .client-comment {\n    background: #c4677b;\n    color: white;\n  }\n\n  .add-checklist {\n    background: $dark-grey-lighter;\n  }\n\n  .comment {\n    background: $dark-grey-lightmore;\n  }\n\n  .like-button {\n    color: white;\n  }\n}\n\narticle.comment {\n  background: white;\n  border-radius: 10px;\n  padding: 0;\n  margin: 1em 0;\n  word-wrap: anywhere;\n  hyphens: auto;\n}\n\n.media {\n  padding: 0.6em;\n}\n\n.content .comment-person {\n  min-height: 40px;\n  margin-bottom: 0;\n}\n\n.comment-date {\n  color: $grey;\n  margin-left: 0.5em;\n  flex: 1;\n}\n\n.content {\n  .comment-text {\n    margin-top: 0.5rem;\n    margin-bottom: 0;\n    padding: 0.2em 0.1em;\n    word-break: break-word;\n    hyphens: auto;\n    hyphenate-limit-chars: 8 6 2;\n  }\n  .comment-footer {\n    color: $grey;\n  }\n}\n\n.checklist {\n  margin-top: 0.5em;\n}\n\n.menu-icon {\n  width: 20px;\n  cursor: pointer;\n  color: $light-grey;\n}\n\n.menu-wrapper {\n  position: relative;\n}\n\n.pinned {\n  border: 2px solid var(--border-alt);\n  transform: scale(1.02);\n}\n\n.edited-text,\n.pinned-text {\n  font-size: 0.8em;\n  text-align: right;\n  color: $light-grey;\n}\n\n.add-checklist {\n  background: $white-grey-light;\n  color: $grey;\n  text-transform: uppercase;\n  cursor: pointer;\n  font-size: 0.8em;\n  padding: 0.5em;\n}\n\n.content .client-comment {\n  border-radius: 4px;\n  background: color.adjust($red, $lightness: 80%);\n  color: color.adjust($red, $lightness: -30%, $saturation: -20%);\n  font-size: 0.8em;\n  margin-top: 0.4em;\n  margin-bottom: 0;\n  padding: 0.5em 0.2em;\n  text-align: center;\n  text-transform: uppercase;\n}\n\n.round-name {\n  border-radius: 1em;\n  font-size: 0.8em;\n  margin: 0;\n  margin-right: 0.5em;\n  min-width: 55px;\n  padding: 0.4em;\n  text-transform: uppercase;\n  text-align: center;\n\n  &.revision {\n    width: 100%;\n    font-weight: bold;\n    border: 1px solid $purple-strong;\n    color: $purple-strong;\n  }\n}\n\n.flexrow {\n  align-items: center;\n}\n\n.comment-left {\n  display: flex;\n  flex-direction: column;\n  padding: 0.5em 0 0.5em 0.5em;\n}\n\n.like-button {\n  align-items: center;\n  background-color: transparent;\n  color: inherit;\n  cursor: pointer;\n  display: inline-flex;\n  margin: 0;\n  padding: 0.3rem 0;\n\n  span {\n    margin-left: 0.3em;\n  }\n}\n\n.like-button--empty {\n  opacity: 0.5;\n\n  &:hover,\n  &:focus {\n    opacity: 1;\n  }\n}\n\n.comment-content {\n  padding: 0;\n}\n\n.infos {\n  display: flex;\n  align-items: center;\n}\n\n.content-wrapper {\n  padding: 0.5em;\n\n  &.full {\n    border-left: 1px solid transparent;\n  }\n}\n\n.date {\n  font-size: 0.8em;\n  margin-right: 0.5em;\n  white-space: nowrap;\n}\n\n.preview-info {\n  margin-top: 0;\n  padding-top: 0;\n\n  .date {\n    margin-right: 26px;\n  }\n}\n\np {\n  margin: 0;\n}\n\n.attachment {\n  display: block;\n  text-align: center;\n  margin: 0.4em auto;\n}\n\n.attachment-icon {\n  margin: 0.6em;\n}\n\n.copy-icon {\n  cursor: pointer;\n  margin-left: 0.5em;\n}\n\n.congrats-picture {\n  max-width: 300px;\n  max-height: 300px;\n}\n\n.reply-button {\n  border-radius: 5px;\n  color: var(--text);\n  cursor: pointer;\n  font-size: 0.8em;\n  padding: 0 0.5em;\n  text-align: right;\n}\n\ntextarea.reply {\n  border: 1px solid var(--border);\n  border-radius: 5px;\n  color: var(--text-strong);\n  font-size: 0.9em;\n  margin-top: 0.5em;\n  margin-left: 0.5em;\n  padding: 0.5em;\n  width: calc(100% - 0.5em);\n}\n\n.replies {\n  padding-bottom: 0.5em;\n  margin-right: 0.2em;\n}\n\n.reply-comment {\n  border-left: 3px solid var(--border);\n  border-bottom: 1px dashed var(--border);\n  font-size: 0.9em;\n  margin-left: 0.5em;\n  padding-left: 0.8em;\n  padding-top: 0.8em;\n  padding-bottom: 0.4em;\n\n  &:last-child {\n    border-bottom: 1px solid var(--border);\n  }\n\n  &:hover {\n    .reply-delete {\n      opacity: 1;\n    }\n  }\n\n  .reply-date {\n    padding-top: 1px;\n    font-size: 0.8em;\n    color: var(--text);\n  }\n}\n\n.reply-delete {\n  color: $grey;\n  cursor: pointer;\n  margin-top: -2px;\n  margin-right: 0;\n  opacity: 0;\n}\n\n.preview-link {\n  border: 0;\n  margin: 0;\n  margin-right: 0.5em;\n  color: var(--text-alt);\n  padding: 0 10px;\n\n  &:hover {\n    color: var(--text);\n  }\n}\n\n.preview-status {\n  background: #aaa;\n  border: 2px solid $grey;\n  border-radius: 50%;\n  height: 20px;\n  min-width: 20px;\n  transition: background 0.3s ease;\n  width: 20px;\n\n  &[data-status='validated'] {\n    background: $light-green;\n  }\n  &[data-status='rejected'] {\n    background: $red;\n  }\n}\n\n.reply-attachments {\n  margin-bottom: 10px;\n}\n\n.attachment-button {\n  border: 0;\n}\n\n.attachment-file {\n  margin-top: 3px;\n  margin-bottom: 3px;\n  margin-left: 9px;\n  margin-right: 3px;\n  padding-bottom: 3px;\n  border-bottom: 1px dashed $light-grey-light;\n  color: var(--text);\n\n  span {\n    cursor: pointer;\n    float: right;\n  }\n}\n\n@media screen and (max-width: 768px) {\n  .flexrow {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n}\n</style>\n","<template>\n  <div\n    :class=\"{\n      modal: true,\n      'is-active': active\n    }\"\n  >\n    <div class=\"modal-background\" @click=\"$emit('cancel')\"></div>\n\n    <div class=\"modal-content\">\n      <div class=\"box\">\n        <h1 class=\"title\" v-if=\"commentToEdit && commentToEdit.id\">\n          {{ $t('comments.edit_title') }}\n        </h1>\n\n        <form @submit.prevent>\n          <combobox-status\n            :label=\"$t('task_status.title')\"\n            :task-status-list=\"taskStatuses\"\n            v-model=\"form.task_status_id\"\n          />\n\n          <div class=\"field\">\n            <label class=\"label\">\n              {{ $t('comments.text') }}\n            </label>\n            <at-ta\n              :ats=\"['#', '@']\"\n              :members=\"[...membersForAts['@'], ...membersForAts['#']]\"\n              name-key=\"full_name\"\n              limit=\"2\"\n              :filter-match=\"atOptionsFilter\"\n              @update:value=\"onAtTextChanged\"\n            >\n              <template #item=\"{ item }\">\n                <template v-if=\"item.isTime\">  frame </template>\n                <template v-else-if=\"item.isDepartment\">\n                  <span\n                    class=\"mr05\"\n                    :style=\"{\n                      background: item.color,\n                      width: '10px',\n                      height: '10px',\n                      'border-radius': '50%'\n                    }\"\n                  >\n                    &nbsp;\n                  </span>\n                  {{ item.full_name }}\n                </template>\n                <template v-else-if=\"item.isTaskType\">\n                  <task-type-name\n                    :task-type=\"{\n                      color: item.color,\n                      name: item.full_name\n                    }\"\n                    :is-link=\"false\"\n                    thin\n                  />\n                </template>\n                <template v-else>\n                  <div class=\"flexrow\">\n                    <people-avatar\n                      class=\"flexrow-item\"\n                      :person=\"item\"\n                      :size=\"20\"\n                    />\n                    <span class=\"flexrow-item\">\n                      {{ item.full_name }}\n                    </span>\n                  </div>\n                </template>\n              </template>\n\n              <textarea\n                class=\"input\"\n                ref=\"textField\"\n                v-model=\"form.text\"\n                @keyup.ctrl=\"runConfirmation\"\n                @keyup.meta=\"runConfirmation\"\n                v-focus\n              >\n              </textarea>\n            </at-ta>\n          </div>\n          <text-field\n            ref=\"input-link\"\n            :label=\"$t('main.link')\"\n            placeholder=\"https://...\"\n            type=\"url\"\n            @enter=\"runConfirmation\"\n            v-model.trim=\"form.link\"\n            v-if=\"isPreviewsComment\"\n          />\n          <label class=\"label\">\n            {{ $t('comments.checklist') }}\n          </label>\n          <checklist\n            class=\"comment-checklist\"\n            :checklist=\"\n              form.checklist.length\n                ? form.checklist\n                : [{ checked: false, text: '' }]\n            \"\n            @add-item=\"onAddChecklistItem\"\n            @insert-item=\"onInsertChecklistItem\"\n            @remove-task=\"removeTask\"\n          />\n          <label class=\"label\">\n            {{ $t('comments.attachments') }}\n          </label>\n          <div\n            class=\"attachments\"\n            v-if=\"commentToEdit && (form.attachment_files || []).length > 0\"\n          >\n            <div\n              :key=\"'attachment-' + index\"\n              class=\"attachment-file\"\n              v-for=\"(attachment, index) in form.attachment_files\"\n            >\n              {{ attachment.name }}\n              <span @click=\"removeAttachment(attachment)\">\n                <x-icon :size=\"12\" />\n              </span>\n            </div>\n          </div>\n          <div v-else>\n            {{ $t('comments.no_attachments') }}\n          </div>\n        </form>\n        <label class=\"label mt2\">\n          {{ $t('comments.attachments_to_add') }}\n        </label>\n        <div class=\"new-attachments\">\n          <div\n            :key=\"'new-attachment-' + index\"\n            class=\"attachment-file\"\n            v-for=\"(attachment, index) in attachmentFiles\"\n          >\n            {{ attachment.get('file').name }}\n            <span @click=\"removeNewAttachment(attachment)\">x</span>\n          </div>\n        </div>\n\n        <div>\n          <file-upload\n            ref=\"file-field\"\n            class=\"flexrow-item\"\n            :accept=\"extensions\"\n            :is-primary=\"false\"\n            :label=\"$t('main.select_file')\"\n            :multiple=\"true\"\n            @fileselected=\"onFileSelected\"\n            hide-file-names\n          />\n        </div>\n        <modal-footer\n          :error-text=\"$t('comments.edit_error')\"\n          :is-disabled=\"!isValidForm\"\n          :is-error=\"isError\"\n          :is-loading=\"isLoading\"\n          @confirm=\"runConfirmation\"\n          @cancel=\"$emit('cancel')\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { XIcon } from 'lucide-vue-next'\nimport AtTa from 'vue-at/dist/vue-at-textarea'\nimport { mapGetters } from 'vuex'\n\nimport files from '@/lib/files'\nimport { remove } from '@/lib/models'\nimport { replaceTimeWithTimecode } from '@/lib/render'\n\nimport { modalMixin } from '@/components/modals/base_modal'\n\nimport Checklist from '@/components/widgets/Checklist.vue'\nimport ComboboxStatus from '@/components/widgets/ComboboxStatus.vue'\nimport FileUpload from '@/components/widgets/FileUpload.vue'\nimport ModalFooter from '@/components/modals/ModalFooter.vue'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar.vue'\nimport TextField from '@/components/widgets/TextField.vue'\nimport TaskTypeName from '@/components/widgets/TaskTypeName.vue'\n\nexport default {\n  name: 'edit-comment-modal',\n\n  mixins: [modalMixin],\n\n  components: {\n    AtTa,\n    Checklist,\n    ComboboxStatus,\n    FileUpload,\n    ModalFooter,\n    PeopleAvatar,\n    TaskTypeName,\n    TextField,\n    XIcon\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    frame: {\n      type: Number,\n      default: 0\n    },\n    commentToEdit: {\n      type: Object,\n      default: () => {}\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    taskTypes: {\n      type: Array,\n      default: () => []\n    },\n    team: {\n      type: Array,\n      default: () => []\n    },\n    fps: {\n      type: Number,\n      default: 25\n    },\n    revision: {\n      type: Number,\n      default: 1\n    }\n  },\n\n  emits: ['cancel', 'confirm'],\n\n  data() {\n    return {\n      membersForAts: { '@': [], '#': [] },\n      attachmentFiles: [],\n      extensions: files.ALL_EXTENSIONS_STRING,\n      form: {\n        text: '',\n        task_status_id: null,\n        checklist: [{ checked: false, text: '' }],\n        link: null\n      }\n    }\n  },\n\n  computed: {\n    ...mapGetters([\n      'departmentMap',\n      'getTaskStatusForCurrentUser',\n      'isCurrentUserClient',\n      'productionDepartmentIds',\n      'taskStatusForCurrentUser'\n    ]),\n\n    taskStatuses() {\n      return this.isConceptTask\n        ? this.getTaskStatusForCurrentUser(null, true)\n        : this.taskStatusForCurrentUser.filter(status => !status.for_concept)\n    },\n\n    isConceptTask() {\n      return this.$route.path.includes('concept')\n    },\n\n    isPreviewsComment() {\n      return this.commentToEdit?.previews?.length > 0\n    },\n\n    isValidForm() {\n      return Boolean(\n        !this.isPreviewsComment ||\n        !this.form.link ||\n        this.$refs['input-link']?.checkValidity()\n      )\n    }\n  },\n\n  methods: {\n    runConfirmation(event) {\n      if (!event || event.keyCode === 13 || !event.keyCode) {\n        const result = {\n          id: this.commentToEdit.id,\n          text: this.form.text,\n          task_status_id: this.form.task_status_id,\n          checklist: this.form.checklist.filter(item => item.text.length),\n          newAttachmentFiles: this.attachmentFiles,\n          attachmentFilesToDelete: this.attachmentFilesToDelete,\n          links: this.form.link ? [this.form.link] : null\n        }\n        this.$emit('confirm', result)\n      }\n    },\n\n    removeTask(entry) {\n      this.form.checklist = [...remove(this.form.checklist, entry)]\n    },\n\n    removeAttachment(attachment) {\n      this.form.attachment_files = remove(\n        this.form.attachment_files,\n        attachment\n      )\n      this.attachmentFilesToDelete.push(attachment)\n    },\n\n    removeNewAttachment(attachment) {\n      this.attachmentFiles = remove(this.attachmentFiles, attachment)\n    },\n\n    onFileSelected(attachmentFiles) {\n      this.attachmentFiles = attachmentFiles\n    },\n\n    reset() {\n      this.attachmentFiles = []\n      this.attachmentFilesToDelete = []\n      if (this.commentToEdit && this.commentToEdit.id) {\n        this.form = {\n          text: this.commentToEdit.text,\n          task_status_id: this.commentToEdit.task_status_id,\n          checklist: [...this.commentToEdit.checklist],\n          attachment_files: [...this.commentToEdit.attachment_files],\n          link: this.commentToEdit.links?.[0]\n        }\n        if (this.form.checklist.length === 0) {\n          this.form.checklist = [{ checked: false, text: '' }]\n        }\n      } else {\n        this.form = {\n          text: '',\n          task_status_id: null,\n          checklist: [{ checked: false, text: '' }],\n          attachment_files: [],\n          link: null\n        }\n      }\n    },\n\n    onAddChecklistItem(item) {\n      delete item.index\n      this.form.checklist.push(item)\n    },\n\n    onInsertChecklistItem(item) {\n      this.form.checklist.splice(item.index, 0, item)\n      for (let i = 0; i < this.form.checklist.length; i++) {\n        this.form.checklist[i].index = i\n      }\n    },\n\n    atOptionsFilter(name, chunk, at, v) {\n      // filter the list by the given at symbol\n      const option_at = v?.isTaskType ? '#' : '@'\n      // @ for team, # for task type\n      if (at !== option_at) return false\n      // match at lower-case\n      return name?.toLowerCase().indexOf(chunk.toLowerCase()) > -1\n    },\n\n    onAtTextChanged(input) {\n      if (input.includes('@frame')) {\n        this.form.text = replaceTimeWithTimecode(\n          input,\n          this.revision,\n          this.frame + 1,\n          this.fps\n        )\n      }\n    }\n  },\n\n  watch: {\n    commentToEdit() {\n      this.reset()\n    },\n\n    active() {\n      if (this.active) {\n        setTimeout(() => {\n          this.reset()\n          this.$refs.textField.focus()\n        }, 100)\n      }\n    },\n\n    taskTypes: {\n      deep: true,\n      immediate: true,\n      handler(values) {\n        const taskTypeOptions = values.map(taskType => {\n          return {\n            isTaskType: true,\n            full_name: taskType.name,\n            color: taskType.color,\n            id: taskType.id,\n            url: taskType.url\n          }\n        })\n        taskTypeOptions.push({\n          isTaskType: true,\n          color: '#000',\n          full_name: 'All'\n        })\n        this.membersForAts['#'] = taskTypeOptions\n      }\n    },\n\n    team: {\n      deep: true,\n      immediate: true,\n      handler() {\n        let teamOptions\n        if (this.isCurrentUserClient) {\n          teamOptions = [\n            this.team.filter(person =>\n              ['admin', 'manager', 'supervisor', 'client'].includes(person.role)\n            )\n          ]\n        } else {\n          teamOptions = [...this.team]\n        }\n        teamOptions = teamOptions.concat(\n          this.productionDepartmentIds.map(departmentId => {\n            const department = this.departmentMap.get(departmentId)\n            return {\n              isDepartment: true,\n              full_name: department.name,\n              color: department.color,\n              id: departmentId\n            }\n          })\n        )\n        teamOptions.push({\n          isTime: true,\n          full_name: 'frame'\n        })\n        this.membersForAts['@'] = teamOptions\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.is-danger {\n  color: #ff3860;\n  font-style: italic;\n}\n\ntextarea {\n  min-height: 8em;\n  padding: 0.5em;\n}\n\n.comment-checklist {\n  overflow-y: auto;\n  max-height: 200px;\n  margin-bottom: 2em;\n}\n\n.label.mt2 {\n  margin-top: 2em;\n}\n\n.new-attachments {\n  max-height: 200px;\n  margin-bottom: 1em;\n  overflow-y: auto;\n  padding-right: 1em;\n}\n\n.attachment-file {\n  margin-top: 3px;\n  margin-bottom: 3px;\n  margin-left: 3px;\n  margin-right: 3px;\n  padding-bottom: 3px;\n  border-bottom: 1px dashed $light-grey-light;\n\n  span {\n    cursor: pointer;\n    float: right;\n  }\n}\n</style>\n","<template>\n  <div class=\"left flexrow\">\n    <button-simple\n      class=\"flexrow-item\"\n      icon=\"left\"\n      :title=\"$t('playlists.actions.files_previous')\"\n      @click=\"$emit('previous-clicked')\"\n      v-if=\"isBigDisplay || !isMovie\"\n    />\n\n    <span\n      class=\"flexrow-item bar-element current-index\"\n      :title=\"$t('playlists.actions.files_position')\"\n      @click=\"$emit('current-index-clicked')\"\n      v-if=\"isBigDisplay || !isMovie\"\n    >\n      {{ currentIndex }}\n      <template v-if=\"fullScreen || !isMovie\">/ {{ previews.length }}</template>\n    </span>\n\n    <button-simple\n      class=\"flexrow-item\"\n      icon=\"right\"\n      :title=\"$t('playlists.actions.files_next')\"\n      @click=\"$emit('next-clicked')\"\n      v-if=\"isBigDisplay || !isMovie\"\n    />\n\n    <button-simple\n      class=\"flexrow-item\"\n      icon=\"plus\"\n      :title=\"$t('playlists.actions.files_add')\"\n      @click=\"$emit('add-preview-clicked')\"\n      v-if=\"(isAssigned || !readOnly) && !fullScreen\"\n    />\n\n    <button-simple\n      class=\"flexrow-item\"\n      icon=\"trash\"\n      :title=\"$t('playlists.actions.files_delete')\"\n      @click=\"$emit('remove-preview-clicked')\"\n      v-if=\"!readOnly && !fullScreen && !light\"\n    />\n\n    <div class=\"separator\" v-if=\"isBigDisplay\"></div>\n  </div>\n</template>\n\n<script>\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\n\nexport default {\n  name: 'browsing-bar',\n\n  components: {\n    ButtonSimple\n  },\n\n  props: {\n    currentIndex: {\n      type: Number,\n      default: 0\n    },\n    fullScreen: {\n      type: Boolean,\n      default: false\n    },\n    isAssigned: {\n      type: Boolean,\n      default: false\n    },\n    light: {\n      type: Boolean,\n      default: false\n    },\n    previews: {\n      type: Array,\n      default: () => []\n    },\n    readOnly: {\n      type: Boolean,\n      default: false\n    }\n  },\n\n  emits: [\n    'add-preview-clicked',\n    'current-index-clicked',\n    'next-clicked',\n    'previous-clicked',\n    'remove-preview-clicked'\n  ],\n\n  computed: {\n    isBigDisplay() {\n      return (!this.light || this.fullScreen) && this.previews.length > 1\n    },\n\n    isMovie() {\n      return this.previews[this.currentIndex - 1]?.extension === 'mp4'\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.error {\n  margin-top: 1em;\n}\n\n.buttons .button {\n  background: $dark-grey-2;\n  border-radius: 0;\n  color: $light-grey-2;\n  border: 0;\n  margin: 0;\n  transition: all 0.3s ease;\n\n  &:first-child {\n    border-bottom-left-radius: 5px;\n  }\n\n  &:hover {\n    border-radius: 5px;\n    transform: scale(1.2);\n  }\n}\n\n.buttons .button.active,\n.buttons .button:hover {\n  color: var(--background-selectable);\n}\n\n.bar-element {\n  color: $light-grey;\n  padding-left: 1em;\n}\n\n.current-index {\n  cursor: pointer;\n  white-space: nowrap;\n}\n</style>\n","<template>\n  <div\n    ref=\"container\"\n    class=\"preview-viewer dark\"\n    :style=\"{\n      maxHeight: isFullScreen ? `calc(100vh - ${marginBottom}px)` : null\n    }\"\n  >\n    <div\n      class=\"center status-message\"\n      :style=\"{ height: defaultHeight + 'px' }\"\n      v-if=\"isBroken\"\n    >\n      <p>{{ $t('preview.broken') }}</p>\n    </div>\n\n    <div\n      class=\"center status-message\"\n      :style=\"{ height: defaultHeight + 'px' }\"\n      :title=\"$t('preview.processing')\"\n      v-if=\"isProcessing\"\n    >\n      <spinner :is-processing=\"true\" />\n    </div>\n\n    <video-viewer\n      ref=\"video-viewer\"\n      class=\"video-viewer\"\n      :name=\"name\"\n      :big=\"isBig\"\n      :default-height=\"defaultHeight\"\n      :full-screen=\"isFullScreen\"\n      :is-comparing=\"isComparing\"\n      :is-comparison-overlay=\"isComparisonOverlay\"\n      :is-hd=\"isHd\"\n      :is-muted=\"isMuted\"\n      :is-repeating=\"isRepeating\"\n      :light=\"isLight\"\n      :current-frame=\"currentFrame\"\n      :nb-frames=\"nbFrames\"\n      :panzoom=\"true\"\n      :preview=\"preview\"\n      @duration-changed=\"duration => $emit('duration-changed', duration)\"\n      @frame-update=\"frameNumber => $emit('frame-update', frameNumber)\"\n      @play-ended=\"$emit('play-ended')\"\n      @size-changed=\"onVideoSizeChanged\"\n      @video-end=\"$emit('video-end')\"\n      @video-loaded=\"$emit('video-loaded')\"\n      v-show=\"isMovie\"\n    />\n\n    <picture-viewer\n      ref=\"picture-viewer\"\n      :big=\"isBig\"\n      :default-height=\"defaultHeight\"\n      :full-screen=\"isFullScreen\"\n      :is-comparing=\"isComparing\"\n      :light=\"isLight\"\n      :margin-bottom=\"marginBottom\"\n      :panzoom=\"true\"\n      :preview=\"preview\"\n      @size-changed=\"onPictureSizeChanged\"\n      v-show=\"isPicture\"\n    />\n\n    <object-viewer\n      ref=\"object-viewer\"\n      class=\"model-viewer\"\n      :background-url=\"backgroundUrl\"\n      :default-height=\"defaultHeight\"\n      :empty=\"!is3DModel\"\n      :full-screen=\"isFullScreen\"\n      :is-environment-skybox=\"isEnvironmentSkybox\"\n      :is-wireframe=\"isWireframe\"\n      :light=\"isLight\"\n      :preview-url=\"originalPath\"\n      @model-loaded=\"$emit('model-loaded')\"\n      v-if=\"is3DModel\"\n    />\n\n    <sound-viewer\n      ref=\"sound-viewer\"\n      class=\"sound-viewer\"\n      :file-name=\"fileTitle\"\n      :preview-url=\"isSound ? originalPath : ''\"\n      @play-ended=\"$emit('play-ended')\"\n      v-show=\"isSound\"\n    />\n\n    <pdf-viewer\n      :preview=\"preview\"\n      :default-height=\"defaultHeight\"\n      v-if=\"isPdf\"\n    />\n\n    <div class=\"center\" :style=\"{ height: defaultHeight + 'px' }\" v-if=\"isFile\">\n      <a\n        class=\"button mt2\"\n        ref=\"preview-file\"\n        :href=\"originalDlPath\"\n        :title=\"fileTitle\"\n      >\n        <download-icon class=\"icon\" />\n        <span class=\"text\" :title=\"fileTitle\">\n          {{ $t('tasks.download_pdf_file', { extension }) }}\n        </span>\n      </a>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { DownloadIcon } from 'lucide-vue-next'\n\nimport { formatFrame, formatTime } from '@/lib/video'\nimport { domMixin } from '@/components/mixins/dom'\n\nimport ObjectViewer from '@/components/previews/ObjectViewer.vue'\nimport PdfViewer from '@/components/previews/PdfViewer.vue'\nimport PictureViewer from '@/components/previews/PictureViewer.vue'\nimport SoundViewer from '@/components/previews/SoundViewer.vue'\nimport Spinner from '@/components/widgets/Spinner.vue'\nimport VideoViewer from '@/components/previews/VideoViewer.vue'\n\nexport default {\n  name: 'preview-viewer',\n\n  mixins: [domMixin],\n\n  components: {\n    DownloadIcon,\n    ObjectViewer,\n    PdfViewer,\n    PictureViewer,\n    SoundViewer,\n    Spinner,\n    VideoViewer\n  },\n\n  props: {\n    name: {\n      type: String,\n      default: ''\n    },\n    defaultHeight: {\n      type: Number,\n      default: 0\n    },\n    currentFrame: {\n      type: Number,\n      default: 0\n    },\n    marginBottom: {\n      type: Number,\n      default: 0\n    },\n    nbFrames: {\n      type: Number,\n      default: 0\n    },\n    isBig: {\n      type: Boolean,\n      default: false\n    },\n    isComparing: {\n      type: Boolean,\n      default: false\n    },\n    isEnvironmentSkybox: {\n      type: Boolean,\n      default: false\n    },\n    isFullScreen: {\n      type: Boolean,\n      default: false\n    },\n    isHd: {\n      type: Boolean,\n      default: false\n    },\n    isComparisonOverlay: {\n      type: Boolean,\n      default: false\n    },\n    isLight: {\n      type: Boolean,\n      default: false\n    },\n    isMuted: {\n      type: Boolean,\n      default: false\n    },\n    isObjectBackground: {\n      type: Boolean,\n      default: false\n    },\n    isRepeating: {\n      type: Boolean,\n      default: false\n    },\n    isWireframe: {\n      type: Boolean,\n      default: false\n    },\n    objectBackgroundUrl: {\n      type: String,\n      default: ''\n    },\n    preview: {\n      type: Object,\n      default: () => {}\n    }\n  },\n\n  emits: [\n    'duration-changed',\n    'frame-update',\n    'model-loaded',\n    'play-ended',\n    'size-changed',\n    'video-end',\n    'video-loaded'\n  ],\n\n  computed: {\n    // Elements\n\n    container() {\n      return this.$refs.container\n    },\n\n    videoViewer() {\n      return this.$refs['video-viewer']\n    },\n\n    pictureViewer() {\n      return this.$refs['picture-viewer']\n    },\n\n    soundViewer() {\n      return this.$refs['sound-viewer']\n    },\n\n    objectViewer() {\n      return this.$refs['object-viewer']\n    },\n\n    //  Utils\n\n    backgroundUrl() {\n      return this.isObjectBackground ? this.objectBackgroundUrl : undefined\n    },\n\n    fileTitle() {\n      return this.preview\n        ? this.preview.original_name + '.' + this.preview.extension\n        : ''\n    },\n\n    extension() {\n      return this.preview ? this.preview.extension : ''\n    },\n\n    status() {\n      return this.preview && this.preview.status ? this.preview.status : 'ready'\n    },\n\n    isBroken() {\n      return this.status === 'broken'\n    },\n\n    isProcessing() {\n      return this.status === 'processing'\n    },\n\n    isReady() {\n      return this.status === 'ready'\n    },\n\n    isMovie() {\n      return this.isReady && this.extension === 'mp4'\n    },\n\n    isPdf() {\n      return this.isReady && this.extension === 'pdf'\n    },\n\n    isPicture() {\n      return (\n        this.isReady && ['gif', 'png', 'jpg', 'jpeg'].includes(this.extension)\n      )\n    },\n\n    is3DModel() {\n      return this.isReady && ['glb', 'gltf'].includes(this.extension)\n    },\n\n    isSound() {\n      return this.isReady && ['wav', 'mp3'].includes(this.extension)\n    },\n\n    isFile() {\n      return (\n        this.isReady &&\n        !this.isPicture &&\n        !this.isMovie &&\n        !this.is3DModel &&\n        !this.isSound &&\n        !this.isPdf\n      )\n    },\n\n    originalPath() {\n      if (this.preview) {\n        const previewId = this.preview.id\n        const extension = this.extension ? this.extension : 'png'\n        const type = this.isMovie ? 'movies' : 'pictures'\n        return `/api/${type}/originals/preview-files/${previewId}.${extension}`\n      } else {\n        return ''\n      }\n    },\n\n    originalDlPath() {\n      if (this.preview) {\n        const type = this.isMovie ? 'movies' : 'pictures'\n        return `/api/${type}/originals/preview-files/${this.preview.id}/download`\n      } else {\n        return ''\n      }\n    }\n  },\n\n  methods: {\n    formatFrame,\n    formatTime,\n\n    // Video\n\n    resetVideo() {\n      if (this.videoViewer) this.videoViewer.mountVideo()\n    },\n\n    updateTime(time) {\n      this.currentTimeRaw = time\n      this.currentTime = this.formatTime(this.currentTimeRaw)\n    },\n\n    changeMaxDuration(duration) {\n      if (duration) {\n        this.maxDuration = this.formatTime(duration)\n        this.videoDuration = duration\n      } else {\n        this.maxDuration = '00:00.000'\n        this.videoDuration = 0\n      }\n    },\n\n    play() {\n      this.isPlaying = true\n      this.isDrawing = false\n      if (this.videoViewer) {\n        this.videoViewer.play()\n      }\n      if (this.isSound) {\n        this.soundViewer.play()\n      }\n    },\n\n    pause() {\n      this.isPlaying = false\n      if (this.videoViewer) this.videoViewer.pause()\n      if (this.isSound) {\n        this.soundViewer.pause()\n      }\n    },\n\n    playModelAnimation(animationName) {\n      this.objectViewer.play(animationName)\n    },\n\n    pauseModelAnimation() {\n      this.objectViewer.pause()\n    },\n\n    goPreviousFrame() {\n      return this.videoViewer.goPreviousFrame()\n    },\n\n    goNextFrame() {\n      return this.videoViewer.goNextFrame()\n    },\n\n    onPlayPauseClicked() {\n      if (!this.isPlaying) {\n        this.play()\n      } else {\n        this.pause()\n      }\n    },\n\n    get3DAnimations() {\n      return this.$refs['object-viewer'].getAnimations()\n    },\n\n    // Sizing\n\n    getNaturalDimensions() {\n      if (this.isMovie) {\n        return this.videoViewer.getNaturalDimensions()\n      } else {\n        return this.pictureViewer.getNaturalDimensions()\n      }\n    },\n\n    getDimensions() {\n      const dimensions = { width: 0, height: 0 }\n      if (this.container) {\n        dimensions.width = this.container.offsetWidth\n        dimensions.height = this.container.offsetHeight\n      }\n      return dimensions\n    },\n\n    resize() {\n      if (this.isPicture) this.pictureViewer?.resetPicture()\n      else if (this.isMovie) this.videoViewer?.mountVideo()\n      else if (this.isSound) this.soundViewer?.redraw()\n    },\n\n    setCurrentFrame(frameNumber) {\n      this.videoViewer.setCurrentFrame(frameNumber)\n    },\n\n    onPictureSizeChanged(dimensions) {\n      dimensions.source = 'picture'\n      this.$emit('size-changed', dimensions)\n    },\n\n    onVideoSizeChanged(dimensions) {\n      dimensions.source = 'movie'\n      this.$emit('size-changed', dimensions)\n    },\n\n    // To use when you don't want to handle back pressure and rounding\n    setCurrentTimeRaw(time) {\n      this.videoViewer.setCurrentTimeRaw(time)\n    },\n\n    getCurrentTimeRaw() {\n      return this.isMovie ? this.videoViewer.currentTimeRaw : 0\n    },\n\n    // Loupe\n\n    showLoupe() {\n      this.pictureViewer.showLoupe()\n    },\n\n    hideLoupe() {\n      this.pictureViewer.hideLoupe()\n    },\n\n    updateLoupePosition(event, canvasDimensions) {\n      this.pictureViewer.updateLoupePosition(event, canvasDimensions)\n    },\n\n    extractFrame(canvas, frame) {\n      this.videoViewer.setCurrentFrame(frame)\n      const video = this.videoViewer.video\n      const context = canvas.getContext('2d')\n      const dimensions = this.videoViewer.getNaturalDimensions()\n      canvas.width = dimensions.width\n      canvas.height = dimensions.height\n      context.clearRect(0, 0, canvas.width, canvas.height)\n      context.drawImage(video, 0, 0, canvas.width, canvas.height)\n    },\n\n    resetZoom() {\n      if (this.pictureViewer) {\n        this.pictureViewer.resetPanZoom()\n      }\n      if (this.videoViewer) {\n        this.videoViewer.resetPanZoom()\n      }\n    },\n\n    pauseZoom() {\n      if (this.pictureViewer) {\n        this.pictureViewer.pausePanZoom()\n      }\n      if (this.videoViewer) {\n        this.videoViewer.pausePanZoom()\n      }\n    },\n\n    resumeZoom() {\n      if (this.pictureViewer) {\n        this.pictureViewer.resumePanZoom()\n      }\n      if (this.videoViewer) {\n        this.videoViewer.resumePanZoom()\n      }\n    },\n\n    setSpeed(rate) {\n      if (this.videoViewer) {\n        this.videoViewer.setSpeed(rate)\n      }\n    },\n\n    setVolume(volume) {\n      if (this.videoViewer) {\n        this.videoViewer.setVolume(volume)\n      }\n    }\n  },\n\n  watch: {\n    preview() {\n      if (this.isMovie) {\n        this.pause()\n        this.maxDuration = '00:00.000'\n      } else if (this.isPicture) {\n        this.pause()\n        setTimeout(() => {\n          if (this.pictureViewer) this.pictureViewer.resetPicture()\n        }, 10)\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.annotation-movie {\n  margin: auto;\n  width: 100%;\n}\n\n.time-indicator {\n  color: $light-grey;\n  padding-left: 0.8em;\n  margin-right: 0;\n}\n\n.video-viewer {\n  width: 100%;\n  text-align: center;\n  background: #36393f;\n}\n\n.buttons {\n  background: #36393f;\n  height: 32px;\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n\n.buttons .button:first-child {\n  border-bottom-left-radius: 5px;\n}\n.buttons .button:last-child {\n  border-bottom-right-radius: 5px;\n}\n\n.buttons .button {\n  background: transparent;\n  border-radius: 0;\n  color: #bbb;\n  border: 0;\n  margin: 0;\n  transition: all 0.3s ease;\n}\n\n.buttons .button.active,\n.buttons .button:hover {\n  color: #43b581;\n}\n\n.buttons .button:hover {\n  border-radius: 5px;\n  transform: scale(1.2);\n}\n\n.comparison-combobox {\n  margin-bottom: 0;\n}\n\n.buttons .comparison-button {\n  margin-left: 1em;\n}\n\n.previous-preview-file {\n  padding: 1px 8px;\n  margin-right: 0.4em;\n  border: 1px solid $grey;\n  border-radius: 50%;\n  cursor: pointer;\n  color: $grey;\n}\n\n.current-preview-file {\n  padding: 1px 8px;\n  margin-right: 0.4em;\n  border: 1px solid $grey;\n  border-radius: 50%;\n  cursor: pointer;\n  color: white;\n  background: $purple-strong;\n  transition: 0.3s background ease;\n}\n\n.annotation-tools {\n  align-items: stretch;\n  display: flex;\n  height: 33px;\n  background: $dark-grey;\n}\n\n.slide-enter-active {\n  transition: all 0.3s ease;\n}\n\n.slide-leave-active {\n  transition: all 0.3s ease;\n}\n\n.slide-enter,\n.slide-leave-to {\n  transform: translateX(100%);\n}\n\n.buttons .button.ml1 {\n  margin-left: 1em;\n}\n\n.video-viewer {\n  background: $dark-grey-stronger;\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n\n.center {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.status-message {\n  color: $white;\n}\n\n.preview-viewer {\n  background: $dark-grey-light;\n  display: flex;\n  flex-direction: column;\n  border-radius: 5px;\n  min-height: 200px;\n\n  .preview {\n    position: relative;\n    align-items: center;\n    background: black;\n    // box-shadow: inset 4px 2px 20px 4px #000A;\n    display: flex;\n    flex: 1;\n    justify-content: center;\n\n    .button {\n      padding: 1.5em;\n      transition: background 0.3s ease;\n\n      &:hover {\n        background: $dark-grey-lightest;\n      }\n    }\n  }\n}\n</style>\n","<template>\n  <div class=\"wrapper\">\n    <div\n      class=\"revision-preview\"\n      :class=\"{ selected: isSelected }\"\n      draggable=\"true\"\n      @click.prevent=\"onSelected\"\n      @dragstart=\"onPreviewDragStart($event, index)\"\n    >\n      <light-entity-thumbnail\n        width=\"150px\"\n        height=\"103px\"\n        :preview-file-id=\"previewFile.id\"\n        v-if=\"hasThumbnail\"\n      />\n      <span :title=\"originalName\" v-else> .{{ previewFile.extension }} </span>\n    </div>\n    <div\n      ref=\"drop-area\"\n      class=\"drop-area\"\n      @dragover=\"onDragover\"\n      @dragleave=\"onDragleave\"\n      @drop=\"onDropped\"\n    ></div>\n  </div>\n</template>\n\n<script>\n/*\n * Widget to display a preview listed in a revision. It allows to select a\n * given file for current revision.\n * It fires events about drag'n'drop reordering too.\n */\nimport LightEntityThumbnail from '@/components/widgets/LightEntityThumbnail.vue'\n\nexport default {\n  name: 'revision-preview',\n\n  components: {\n    LightEntityThumbnail\n  },\n\n  props: {\n    index: {\n      required: true,\n      type: Number\n    },\n    isSelected: {\n      default: false,\n      type: Boolean\n    },\n    previewFile: {\n      required: true,\n      type: Object\n    }\n  },\n\n  emits: ['preview-dropped', 'selected'],\n\n  computed: {\n    dropArea() {\n      return this.$refs['drop-area']\n    },\n\n    hasThumbnail() {\n      return ['mp4', 'png'].includes(this.previewFile.extension)\n    },\n\n    originalName() {\n      return `${this.previewFile.original_name}.${this.previewFile.extension}`\n    }\n  },\n\n  methods: {\n    onSelected() {\n      this.$emit('selected', this.index)\n    },\n\n    onPreviewDragStart(event, previewIndex) {\n      event.dataTransfer.setData('previewIndex', previewIndex)\n    },\n\n    onDragleave() {\n      this.dropArea.style.background = 'transparent'\n      this.dropArea.style.width = '15px'\n    },\n\n    onDragover(event) {\n      event.preventDefault()\n      this.dropArea.style.width = '60px'\n    },\n\n    onDropped(event) {\n      this.dropArea.style.background = 'transparent'\n      this.dropArea.style.width = '15px'\n      this.$emit('preview-dropped', {\n        previousIndex: event.dataTransfer.getData('previewIndex'),\n        newIndex: this.index\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.wrapper {\n  display: flex;\n  align-items: stretch;\n}\n\n.drop-area {\n  width: 15px;\n  transition: width 0.3s ease;\n}\n\n.revision-preview {\n  border-top: 3px solid transparent;\n  border-radius: 5px;\n  border: 3px solid transparent;\n  box-shadow: 2px 2px 2px $dark-grey-strong;\n  background: $dark-grey-lighter;\n  height: 109px;\n  min-width: 150px;\n  position: relative;\n  cursor: pointer;\n  margin: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  &.selected {\n    border: 3px solid $green;\n  }\n\n  img {\n    border-radius: 5px;\n    margin: 0;\n  }\n\n  span {\n    text-align: center;\n    font-weight: bold;\n    color: $white-grey;\n  }\n}\n</style>\n","<template>\n  <div ref=\"container\" class=\"preview-player dark\" tabindex=\"-1\">\n    <div class=\"preview filler\">\n      <div class=\"flexrow filler\">\n        <div class=\"preview-container filler\" ref=\"preview-container\">\n          <div\n            class=\"canvas-wrapper\"\n            ref=\"canvas-wrapper\"\n            oncontextmenu=\"return false\"\n            @click=\"onCanvasClicked\"\n            v-show=\"!isZoomPan && isAnnotationsDisplayed\"\n          >\n            <canvas ref=\"annotation-canvas\" class=\"canvas\" :id=\"canvasId\">\n            </canvas>\n          </div>\n          <div\n            class=\"canvas-comparison-wrapper\"\n            ref=\"canvas-comparison-wrapper\"\n            oncontextmenu=\"return false\"\n            @click=\"onCanvasClicked\"\n            v-show=\"\n              !isZoomPan &&\n              isAnnotationsDisplayed &&\n              isComparing &&\n              previewToCompare &&\n              !isComparisonOverlay\n            \"\n          >\n            <canvas\n              ref=\"annotation-canvas-comparison\"\n              class=\"canvas\"\n              :id=\"`${canvasId}-comparison`\"\n            >\n            </canvas>\n          </div>\n          <div class=\"viewers\">\n            <preview-viewer\n              ref=\"preview-viewer\"\n              class=\"preview-viewer\"\n              :current-frame=\"currentFrame\"\n              :default-height=\"defaultHeight\"\n              :is-big=\"big\"\n              :is-comparing=\"isComparing && isComparisonEnabled\"\n              :is-comparison-overlay=\"isComparisonOverlay\"\n              :is-environment-skybox=\"isEnvironmentSkybox\"\n              :is-full-screen=\"fullScreen\"\n              :is-hd=\"isHd\"\n              :is-light=\"light\"\n              :is-muted=\"isMuted\"\n              :is-object-background=\"isObjectBackground\"\n              :is-repeating=\"isRepeating\"\n              :is-wireframe=\"isWireframe\"\n              :margin-bottom=\"marginBottom\"\n              name=\"main\"\n              :nb-frames=\"nbFrames\"\n              :object-background-url=\"objectBackgroundUrl\"\n              :preview=\"currentPreview\"\n              :style=\"{\n                position: isComparisonOverlay ? 'absolute' : 'static'\n              }\"\n              @duration-changed=\"changeMaxDuration\"\n              @frame-update=\"setVideoFrameContext\"\n              @model-loaded=\"onModelLoaded\"\n              @play-ended=\"pause\"\n              @size-changed=\"fixCanvasSize\"\n              @video-end=\"onVideoEnd\"\n              @video-loaded=\"onVideoLoaded\"\n            />\n\n            <preview-viewer\n              ref=\"comparison-preview-viewer\"\n              class=\"comparison-preview-viewer\"\n              name=\"comparison-preview-viewer\"\n              :current-frame=\"currentFrame\"\n              :default-height=\"defaultHeight\"\n              :is-big=\"big\"\n              :is-comparing=\"isComparing && isComparisonEnabled\"\n              :is-full-screen=\"fullScreen\"\n              :is-light=\"light\"\n              :is-hd=\"isHd\"\n              :is-muted=\"true\"\n              :is-repeating=\"isRepeating\"\n              :margin-bottom=\"marginBottom\"\n              :preview=\"comparisonPreview\"\n              :style=\"{\n                opacity: overlayOpacity\n              }\"\n              @size-changed=\"fixCanvasComparisonSize\"\n              @video-loaded=\"syncComparisonViewer\"\n              v-show=\"isComparing && previewToCompare\"\n            />\n          </div>\n        </div>\n\n        <task-info\n          ref=\"task-info-player\"\n          class=\"flexrow-item task-info-column\"\n          :current-frame=\"currentFrame\"\n          :current-parent-preview=\"currentPreview\"\n          :entity-type=\"entityType\"\n          :extendable=\"false\"\n          :is-preview=\"false\"\n          :player=\"this\"\n          :root=\"false\"\n          :silent=\"isCommentsHidden\"\n          :task=\"task\"\n          @comment-added=\"$emit('comment-added')\"\n          @time-code-clicked=\"timeCodeClicked\"\n          v-show=\"!isCommentsHidden\"\n          v-if=\"!readOnly\"\n        />\n      </div>\n    </div>\n    <div class=\"button-bar\" ref=\"button-bar\">\n      <video-progress\n        ref=\"progress\"\n        class=\"video-progress pull-bottom\"\n        :annotations=\"annotations\"\n        :comparison-annotations=\"comparisonAnnotations\"\n        :frame-duration=\"frameDuration\"\n        :is-full-screen=\"fullScreen\"\n        :movie-dimensions=\"movieDimensions\"\n        :nb-frames=\"nbFrames\"\n        :width=\"width\"\n        :handle-in=\"-1\"\n        :handle-out=\"-1\"\n        :preview-id=\"isMovie && currentPreview ? currentPreview.id : ''\"\n        @start-scrub=\"$refs['button-bar'].classList.add('unselectable')\"\n        @end-scrub=\"$refs['button-bar'].classList.remove('unselectable')\"\n        @progress-changed=\"onProgressChanged\"\n        v-show=\"isMovie\"\n      />\n\n      <div class=\"buttons flexrow pull-bottom\" ref=\"buttons\">\n        <div class=\"left flexrow\" v-if=\"isMovie || isSound || is3DAnimation\">\n          <button-simple\n            class=\"flexrow-item\"\n            :title=\"$t('playlists.actions.play')\"\n            icon=\"play\"\n            @click=\"onPlayPauseClicked\"\n            v-if=\"!isPlaying\"\n          />\n          <button-simple\n            class=\"flexrow-item\"\n            :title=\"$t('playlists.actions.pause')\"\n            icon=\"pause\"\n            @click=\"onPlayPauseClicked\"\n            v-else\n          />\n\n          <combobox-styled\n            class=\"flexrow-item\"\n            :options=\"available3DAnimations\"\n            :is-dark=\"true\"\n            :thin=\"true\"\n            v-model=\"current3DAnimation\"\n            v-if=\"is3DAnimation\"\n          />\n        </div>\n\n        <div class=\"left flexrow\" v-if=\"isMovie\">\n          <button-simple\n            :active=\"isRepeating\"\n            :title=\"$t('playlists.actions.looping')\"\n            icon=\"repeat\"\n            @click=\"onRepeatClicked\"\n            v-if=\"!light || fullScreen\"\n          />\n          <button-simple\n            class=\"flexrow-item\"\n            :title=\"\n              $t('playlists.actions.' + (isHd ? 'switch_ld' : 'switch_hd'))\n            \"\n            :text=\"isHd ? 'HD' : 'LD'\"\n            @click=\"isHd = !isHd\"\n            v-if=\"(!light || fullScreen) && isMovie\"\n          />\n\n          <button-sound\n            class=\"flexrow-item\"\n            @change-sound=\"onToggleSoundClicked\"\n            v-model:muted=\"isMuted\"\n            v-model:volume=\"volume\"\n          />\n\n          <speed-button class=\"flexrow-item\" v-model=\"speed\" v-if=\"isMovie\" />\n\n          <span\n            class=\"flexrow-item time-indicator\"\n            :title=\"$t('playlists.actions.current_time')\"\n          >\n            {{ currentTime }}\n          </span>\n          <span class=\"flexrow-item time-indicator\" v-if=\"fullScreen\"> / </span>\n          <span\n            class=\"flexrow-item time-indicator\"\n            :title=\"$t('playlists.actions.max_duration')\"\n            v-if=\"fullScreen\"\n          >\n            {{ maxDuration }}\n          </span>\n\n          <div\n            class=\"flexrow-item time-indicator mr1\"\n            :title=\"$t('playlists.actions.frame_number')\"\n          >\n            <span> ({{ currentFrameLabel }}</span\n            ><span v-if=\"!light || fullScreen\"> / </span\n            ><span v-if=\"!light || fullScreen\">{{\n              (nbFrames + '').padStart(3, '0')\n            }}</span\n            >)\n          </div>\n        </div>\n\n        <div class=\"flexrow flexrow-item\" v-if=\"!isConcept\">\n          <button-simple\n            :class=\"{ ml1: isMovie || isSound }\"\n            :active=\"isComparing\"\n            icon=\"compare\"\n            :title=\"$t('playlists.actions.split_screen')\"\n            @click=\"onCompareClicked\"\n            v-if=\"taskTypeOptions.length > 0 && isComparisonEnabled\"\n          />\n\n          <combobox\n            class=\"comparison-combobox dark\"\n            :options=\"taskTypeOptions\"\n            :is-dark=\"true\"\n            :thin=\"true\"\n            v-model=\"taskTypeId\"\n            v-if=\"isComparing && (!light || isComparisonEnabled)\"\n          />\n          <combobox\n            class=\"comparison-combobox dark\"\n            :options=\"previewFileOptions\"\n            :is-dark=\"true\"\n            :thin=\"true\"\n            v-model=\"previewToCompareId\"\n            v-if=\"isComparing && (!light || isComparisonEnabled)\"\n          />\n          <combobox\n            class=\"comparison-combobox\"\n            :options=\"comparisonModeOptions\"\n            :is-dark=\"true\"\n            :thin=\"true\"\n            v-model=\"comparisonMode\"\n            v-if=\"isComparing && (!light || isComparisonEnabled)\"\n          />\n          <div\n            class=\"flexrow flexrow-item comparison-list\"\n            v-if=\"\n              isComparing &&\n              (!light || isComparisonEnabled) &&\n              comparisonPreviewLength > 0\n            \"\n          >\n            <button-simple\n              class=\"button playlist-button flexrow-item\"\n              icon=\"left\"\n              @click=\"onPreviousComparisonClicked\"\n            />\n            <span class=\"flexrow-item comparison-index\">\n              {{ comparisonPreviewIndex + 1 }} /\n              {{ comparisonPreviewLength }}\n            </span>\n            <button-simple\n              class=\"button playlist-button flexrow-item\"\n              icon=\"right\"\n              @click=\"onNextComparisonClicked\"\n            />\n          </div>\n        </div>\n\n        <div class=\"filler\"></div>\n\n        <div class=\"entity-name mr1\" v-if=\"fullScreen && task\">\n          {{ task.entity_name }}\n        </div>\n\n        <div class=\"separator\" v-if=\"fullScreen\"></div>\n\n        <div class=\"flexrow\">\n          <div class=\"flexrow\" v-if=\"isMovie || isPicture\">\n            <button-simple\n              class=\"flexrow-item\"\n              icon=\"undo\"\n              :title=\"$t('playlists.actions.annotation_undo')\"\n              v-if=\"!readOnly && fullScreen && !isConcept\"\n              @click=\"undoLastAction\"\n            />\n\n            <button-simple\n              class=\"flexrow-item flexrow-item\"\n              :title=\"$t('playlists.actions.annotation_redo')\"\n              icon=\"redo\"\n              v-if=\"!readOnly && fullScreen && !isConcept\"\n              @click=\"redoLastAction\"\n            />\n\n            <button-simple\n              class=\"flexrow-item\"\n              icon=\"delete\"\n              :title=\"$t('playlists.actions.annotation_delete')\"\n              @click=\"onDeleteClicked\"\n              v-if=\"!readOnly && fullScreen && !isConcept\"\n            />\n\n            <transition name=\"slide\">\n              <div\n                class=\"annotation-tools\"\n                v-show=\"isTyping && (!light || fullScreen)\"\n              >\n                <color-picker\n                  :color=\"textColor\"\n                  @toggle-palette=\"onPickTextColor\"\n                  @change=\"onChangeTextColor\"\n                />\n              </div>\n            </transition>\n\n            <button-simple\n              class=\"flexrow-item\"\n              icon=\"type\"\n              :active=\"isTyping\"\n              :title=\"$t('playlists.actions.annotation_text')\"\n              @click=\"onTypeClicked\"\n              v-if=\"!readOnly && (!light || fullScreen) && !isConcept\"\n            />\n\n            <transition name=\"slide\">\n              <div\n                class=\"annotation-tools\"\n                v-show=\"isDrawing && (!light || fullScreen)\"\n              >\n                <pencil-picker\n                  :pencil=\"pencilWidth\"\n                  :sizes=\"pencilPalette\"\n                  @toggle-palette=\"onPickPencilWidth\"\n                  @change=\"onChangePencilWidth\"\n                />\n                <color-picker\n                  :color=\"pencilColor\"\n                  @toggle-palette=\"onPickPencilColor\"\n                  @change=\"onChangePencilColor\"\n                />\n              </div>\n            </transition>\n\n            <button-simple\n              class=\"flexrow-item\"\n              icon=\"pencil\"\n              :active=\"isDrawing\"\n              :title=\"$t('playlists.actions.annotation_draw')\"\n              @click=\"onPencilAnnotateClicked\"\n              v-if=\"!readOnly && (!light || fullScreen) && !isConcept\"\n            />\n\n            <button-simple\n              icon=\"pen\"\n              :title=\"$t('playlists.actions.toggle_annotations')\"\n              :active=\"isAnnotationsDisplayed\"\n              @click=\"onAnnotationDisplayedClicked\"\n              v-if=\"\n                (isPicture || isMovie) && (!light || fullScreen) && !isConcept\n              \"\n            />\n\n            <button-simple\n              class=\"flexrow-item\"\n              icon=\"loupe\"\n              :active=\"isZoomPan\"\n              :title=\"$t('playlists.actions.annotation_zoom_pan')\"\n              @click=\"onZoomPanClicked\"\n              v-if=\"(!light || fullScreen) && !isConcept\"\n            />\n\n            <button-simple\n              class=\"button playlist-button flexrow-item\"\n              icon=\"comment\"\n              :active=\"!isCommentsHidden\"\n              :title=\"$t('playlists.actions.comments')\"\n              @click=\"onCommentClicked\"\n              v-if=\"!readOnly && fullScreen\"\n            />\n          </div>\n\n          <div class=\"flexrow\" v-if=\"is3DModel\">\n            <combobox-styled\n              class=\"background-combo mr05\"\n              :active=\"Boolean(currentBackground)\"\n              :disabled=\"!productionBackgrounds.length\"\n              :is-compact=\"\n                (light && !fullScreen) || !productionBackgrounds.length\n              \"\n              is-reversed\n              keep-order\n              thin\n              :options=\"backgroundOptions\"\n              @change=\"onObjectBackgroundSelected()\"\n              v-if=\"backgroundOptions.length > 0\"\n              v-model=\"currentBackground\"\n            >\n              <template #icon>\n                <globe-icon class=\"icon is-small mr05\" />\n              </template>\n            </combobox-styled>\n            <button-simple\n              class=\"flexrow-item\"\n              :active=\"isObjectBackground && isEnvironmentSkybox\"\n              :disabled=\"!objectBackgroundUrl || !isObjectBackground\"\n              icon=\"image\"\n              :title=\"$t('playlists.actions.toggle_environment_skybox')\"\n              @click=\"isEnvironmentSkybox = !isEnvironmentSkybox\"\n              v-if=\"!light || (fullScreen && backgroundOptions.length > 0)\"\n            />\n            <button-simple\n              class=\"flexrow-item\"\n              :active=\"isWireframe\"\n              icon=\"box\"\n              :title=\"$t('playlists.actions.toggle_wireframe')\"\n              @click=\"isWireframe = !isWireframe\"\n            />\n          </div>\n\n          <div\n            class=\"separator\"\n            v-if=\"!readOnly && fullScreen && isPicture\"\n          ></div>\n\n          <a\n            class=\"button flexrow-item\"\n            :href=\"originalPath\"\n            :title=\"$t('playlists.actions.see_original_file')\"\n            target=\"blank\"\n            v-if=\"!readOnly && isPicture\"\n          >\n            <arrow-up-right-icon class=\"icon is-small\" />\n          </a>\n\n          <div\n            class=\"separator\"\n            v-if=\"\n              !fullScreen ||\n              (fullScreen &&\n                (previews.length > 1 || lastPreviewFiles.length > 1))\n            \"\n          ></div>\n\n          <browsing-bar\n            :current-index=\"currentIndex\"\n            :previews=\"previews\"\n            :read-only=\"readOnly\"\n            :light=\"light\"\n            :full-screen=\"fullScreen\"\n            :is-assigned=\"isAssigned\"\n            @add-preview-clicked=\"$emit('add-extra-preview')\"\n            @next-clicked=\"onNextClicked\"\n            @previous-clicked=\"onPreviousClicked\"\n            @remove-preview-clicked=\"onRemovePreviewClicked\"\n            @current-index-clicked=\"toggleIsOrdering\"\n            v-if=\"currentPreview && !isConcept\"\n          />\n\n          <div\n            class=\"flexrow\"\n            v-if=\"fullScreen && !isConcept && lastPreviewFileOptions.length\"\n          >\n            <combobox-styled\n              class=\"preview-combo flexrow-item\"\n              :options=\"lastPreviewFileOptions\"\n              is-reversed\n              is-preview\n              thin\n              :model-value=\"currentPreview?.id\"\n              @update:model-value=\"changeCurrentPreviewFile\"\n            />\n          </div>\n\n          <div\n            class=\"separator\"\n            v-if=\"lastPreviewFiles.length > 1 && fullScreen\"\n          ></div>\n\n          <a\n            class=\"button flexrow-item\"\n            :href=\"link\"\n            :title=\"$t('playlists.actions.open_link')\"\n            target=\"_blank\"\n            v-if=\"!isCurrentUserArtist && link?.length\"\n          >\n            <link-icon class=\"icon is-small\" />\n          </a>\n\n          <a\n            class=\"button flexrow-item\"\n            :href=\"originalDlPath\"\n            :title=\"$t('playlists.actions.download_file')\"\n            v-if=\"\n              !isCurrentUserArtist ||\n              currentProduction?.is_preview_download_allowed\n            \"\n          >\n            <download-icon class=\"icon is-small\" />\n          </a>\n\n          <button-simple\n            class=\"flexrow-item\"\n            :title=\"$t('playlists.actions.fullscreen')\"\n            icon=\"maximize\"\n            v-if=\"isFullScreenEnabled\"\n            @click=\"onFullscreenClicked\"\n          />\n        </div>\n      </div>\n    </div>\n\n    <div class=\"flexrow\" v-if=\"isConcept && conceptLinkedEntities.length\">\n      <ul class=\"tags\">\n        <li\n          class=\"tag\"\n          :key=\"entity.id\"\n          v-for=\"entity in conceptLinkedEntities\"\n        >\n          <router-link :to=\"entityPath(entity, 'asset')\">\n            {{ entity.name }}\n          </router-link>\n        </li>\n      </ul>\n    </div>\n\n    <div\n      class=\"flexrow revision-previews\"\n      ref=\"revision-previews\"\n      @wheel=\"onSubPreviewsWheel\"\n      v-if=\"isOrdering\"\n    >\n      <div\n        class=\"flexrow-item revision-preview\"\n        :key=\"preview.id\"\n        v-for=\"(preview, index) in previews\"\n      >\n        <revision-preview\n          :preview-file=\"preview\"\n          :index=\"index\"\n          :is-selected=\"currentPreview.id === preview.id\"\n          @selected=\"onRevisionPreviewSelected(index + 1)\"\n          @preview-dropped=\"onRevisionPreviewDropped\"\n        />\n      </div>\n    </div>\n\n    <!-- used only for picture saving purpose, it is not displayed -->\n    <canvas id=\"annotation-snapshot\" ref=\"annotation-snapshot\"> </canvas>\n    <canvas id=\"resize-annotation-canvas\" ref=\"resize-annotation-canvas\">\n    </canvas>\n    <!-- end -->\n  </div>\n</template>\n\n<script>\nimport { fabric } from 'fabric'\nimport { PSBrush } from 'fabricjs-psbrush'\n\nimport {\n  ArrowUpRightIcon,\n  DownloadIcon,\n  GlobeIcon,\n  LinkIcon\n} from 'lucide-vue-next'\nimport { defineAsyncComponent, markRaw } from 'vue'\nimport { mapGetters, mapActions } from 'vuex'\n\nimport {\n  formatFrame,\n  formatTime,\n  roundToFrame,\n  floorToFrame\n} from '@/lib/video'\nimport { getEntityPath } from '@/lib/path'\nimport localPreferences from '@/lib/preferences'\n\nimport { annotationMixin } from '@/components/mixins/annotation'\nimport { fullScreenMixin } from '@/components/mixins/fullscreen'\nimport { domMixin } from '@/components/mixins/dom'\n\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\nimport ButtonSound from '@/components/widgets/ButtonSound.vue'\nimport BrowsingBar from '@/components/previews/BrowsingBar.vue'\nimport ColorPicker from '@/components/widgets/ColorPicker.vue'\nimport Combobox from '@/components/widgets/Combobox.vue'\nimport ComboboxStyled from '@/components/widgets/ComboboxStyled.vue'\nimport PencilPicker from '@/components/widgets/PencilPicker.vue'\nimport PreviewViewer from '@/components/previews/PreviewViewer.vue'\nimport RevisionPreview from '@/components/previews/RevisionPreview.vue'\nimport SpeedButton from '@/components/widgets/SpeedButton.vue'\nconst TaskInfo = () => import('@/components/sides/TaskInfo.vue')\nimport VideoProgress from '@/components/previews/VideoProgress.vue'\n\nlet lastIndex = 1\n\nexport default {\n  name: 'preview-player',\n\n  mixins: [annotationMixin, domMixin, fullScreenMixin],\n\n  components: {\n    ArrowUpRightIcon,\n    BrowsingBar,\n    ButtonSimple,\n    ButtonSound,\n    ColorPicker,\n    Combobox,\n    ComboboxStyled,\n    DownloadIcon,\n    GlobeIcon,\n    LinkIcon,\n    PencilPicker,\n    PreviewViewer,\n    RevisionPreview,\n    SpeedButton,\n    TaskInfo: defineAsyncComponent(TaskInfo),\n    VideoProgress\n  },\n\n  props: {\n    canvasId: {\n      type: String,\n      default: 'annotation-canvas'\n    },\n    big: {\n      type: Boolean,\n      default: false\n    },\n    entityPreviewFiles: {\n      type: Object,\n      default: () => {}\n    },\n    isAssigned: {\n      type: Boolean,\n      default: false\n    },\n    lastPreviewFiles: {\n      type: Array,\n      default: () => []\n    },\n    light: {\n      type: Boolean,\n      default: false\n    },\n    link: {\n      type: String\n    },\n    readOnly: {\n      type: Boolean,\n      default: false\n    },\n    previews: {\n      type: Array,\n      default: () => []\n    },\n    task: {\n      type: Object,\n      default: () => {}\n    },\n    taskTypeMap: {\n      type: Map,\n      default: () => new Map()\n    },\n    extraWide: {\n      type: Boolean,\n      default: false\n    },\n    entityType: {\n      type: String\n    }\n  },\n\n  emits: [\n    'add-extra-preview',\n    'add-preview',\n    'change-current-preview',\n    'comment-added',\n    'frame-updated',\n    'previews-order-changed',\n    'remove-extra-preview'\n  ],\n\n  data() {\n    return {\n      annotations: [],\n      availableAnimations: [],\n      comparisonPreviewIndex: 0,\n      current3DAnimation: null,\n      currentFrame: 0,\n      currentIndex: 1,\n      fullScreen: false,\n      currentBackground: null,\n      currentTime: '00:00:00:00',\n      currentTimeRaw: 0,\n      is3DAnimation: false,\n      isObjectBackground: false,\n      isAnnotationsDisplayed: true,\n      isEnvironmentSkybox: false,\n      isCommentsHidden: true,\n      isComparing: false,\n      isDrawing: false,\n      isHd: false,\n      isLoading: false,\n      isMuted: false,\n      isPlaying: false,\n      isOrdering: true,\n      isRepeating: false,\n      isTyping: false,\n      isWireframe: false,\n      isZoomPan: false,\n      maxDuration: '00:00:00:00',\n      movieDimensions: {\n        width: 1920,\n        height: 1080\n      },\n      objectBackgroundUrl: null,\n      pencil: 'big',\n      pencilPalette: ['big', 'medium', 'small'],\n      previewToCompare: null,\n      previewToCompareId: null,\n      speed: 3,\n      taskTypeId: this.entityPreviewFIles\n        ? Object.keys(this.entityPreviewFiles)[0]\n        : null,\n      textColor: '#ff3860',\n      videoDuration: 0,\n      volume: 50,\n      width: 0,\n      comparisonMode: 'sidebyside',\n      comparisonModeOptions: [\n        {\n          label: this.$t('playlists.actions.side_by_side'),\n          value: 'sidebyside'\n        },\n        {\n          label: `${this.$t('playlists.actions.overlay')} 0%`,\n          value: 'overlay0'\n        },\n        {\n          label: `${this.$t('playlists.actions.overlay')} 25%`,\n          value: 'overlay25'\n        },\n        {\n          label: `${this.$t('playlists.actions.overlay')} 50%`,\n          value: 'overlay50'\n        },\n        {\n          label: `${this.$t('playlists.actions.overlay')} 75%`,\n          value: 'overlay75'\n        },\n        {\n          label: `${this.$t('playlists.actions.overlay')} 100%`,\n          value: 'overlay100'\n        }\n      ]\n    }\n  },\n\n  mounted() {\n    this.configureEvents()\n    this.setupFabricCanvas()\n    this.reloadAnnotations()\n    if (this.isPicture) this.loadAnnotation()\n    this.resetPreviewFileMap()\n    this.initPreferences()\n    if (this.isSound || this.is3DModel || this.isFile) {\n      // hide canvas\n      this.fixCanvasSize({ width: 0, height: 0, left: 0, top: 0 })\n    }\n    new ResizeObserver(this.comparisonViewer.resize).observe(this.container)\n\n    if (this.is3DModel) {\n      this.currentBackground =\n        this.productionBackgrounds.find(this.isDefaultBackground) || null\n      this.onObjectBackgroundSelected()\n    }\n    this.resetPencilConfiguration()\n    if (this.isMuted) {\n      this.previewViewer.setVolume(0)\n    } else {\n      this.volume =\n        localPreferences.getPreference('player:volume') || this.volume\n      this.previewViewer.setVolume(this.volume)\n    }\n  },\n\n  beforeUnmount() {\n    this.endAnnotationSaving()\n    this.removeEvents()\n  },\n\n  computed: {\n    ...mapGetters([\n      'assetMap',\n      'getProductionBackgrounds',\n      'isCurrentUserArtist',\n      'isTVShow',\n      'organisation',\n      'productionMap',\n      'selectedConcepts',\n      'user'\n    ]),\n\n    comparisonPreview() {\n      if (\n        this.previewToCompare?.previews.length > 0 &&\n        this.comparisonPreviewIndex > 0\n      ) {\n        return this.previewToCompare.previews[this.comparisonPreviewIndex - 1]\n      }\n      return this.previewToCompare\n    },\n\n    comparisonPreviewLength() {\n      if (this.previewToCompare) {\n        const previews = this.previewToCompare.previews\n        return previews ? previews.length + 1 : 0\n      } else {\n        return 0\n      }\n    },\n\n    // Elements\n\n    container() {\n      return this.$refs.container\n    },\n\n    comparisonAnnotations() {\n      return this.previewToCompare && this.isComparing\n        ? this.previewToCompare.annotations\n        : []\n    },\n\n    comparisonViewer() {\n      return this.$refs['comparison-preview-viewer']\n    },\n\n    canvasWrapper() {\n      return this.$refs['canvas-wrapper']\n    },\n\n    canvasComparisonWrapper() {\n      return this.$refs['canvas-comparison-wrapper']\n    },\n\n    previewViewer() {\n      return this.$refs['preview-viewer']\n    },\n\n    previewContainer() {\n      return this.$refs['preview-container']\n    },\n\n    commentContainer() {\n      return this.$refs['task-info-player']\n    },\n\n    progress() {\n      return this.$refs.progress\n    },\n\n    // Utils\n\n    currentFrameLabel() {\n      const frame = Math.min(this.nbFrames, this.currentFrame)\n      return formatFrame(frame + 1)\n    },\n\n    currentPreview() {\n      if (\n        this.previews &&\n        this.previews.length > 0 &&\n        this.currentIndex - 1 < this.previews.length\n      ) {\n        return this.previews[this.currentIndex - 1]\n      } else {\n        return {}\n      }\n    },\n\n    currentProduction() {\n      return this.productionMap.get(this.task.project_id)\n    },\n\n    marginBottom() {\n      let margin = 32 // buttons bar\n      if (this.isMovie) margin += 28 // progress bar\n      if (this.isOrdering) margin += 140 // ordering menu\n      return margin\n    },\n\n    defaultHeight() {\n      if (this.fullScreen) {\n        return screen.height - this.marginBottom\n      } else {\n        let bigHeight = screen.height > 800 ? 470 : 300\n        if (this.isMovie) bigHeight = screen.height > 800 ? 442 : 272\n        return screen.width > 1300 && (!this.light || this.big)\n          ? bigHeight\n          : 200\n      }\n    },\n\n    fps() {\n      return parseFloat(this.currentProduction?.fps) || 25\n    },\n\n    frameDuration() {\n      return Math.round((1 / this.fps) * 10000) / 10000\n    },\n\n    extension() {\n      return this.currentPreview ? this.currentPreview.extension : ''\n    },\n\n    isConcept() {\n      return this.entityType === 'Concept'\n    },\n\n    isPicture() {\n      return ['gif', 'png', 'jpg', 'jpeg'].includes(this.extension)\n    },\n\n    isMovie() {\n      return this.extension === 'mp4'\n    },\n\n    is3DModel() {\n      return ['glb', 'gltf'].includes(this.extension)\n    },\n\n    isSound() {\n      return ['mp3', 'wav'].includes(this.extension)\n    },\n\n    isPdf() {\n      return this.extension === 'pdf'\n    },\n\n    isFile() {\n      return !this.isPicture && !this.isMovie // && !this.is3DModel && !this.isPdf\n    },\n\n    isFullScreenEnabled() {\n      return !!(\n        document.fullscreenEnabled ||\n        document.mozFullScreenEnabled ||\n        document.msFullscreenEnabled ||\n        document.webkitSupportsFullscreen ||\n        document.webkitFullscreenEnabled ||\n        document.createElement('video').webkitRequestFullScreen\n      )\n    },\n\n    originalPath() {\n      if (this.currentPreview) {\n        const previewId = this.currentPreview.id\n        const extension = this.extension ? this.extension : 'png'\n        const type = this.isMovie ? 'movies' : 'pictures'\n        return `/api/${type}/originals/preview-files/${previewId}.${extension}`\n      } else {\n        return ''\n      }\n    },\n\n    originalDlPath() {\n      if (this.currentPreview) {\n        const type = this.isMovie ? 'movies' : 'pictures'\n        return (\n          `/api/${type}/originals/preview-files/` +\n          `${this.currentPreview.id}/download`\n        )\n      } else {\n        return ''\n      }\n    },\n\n    taskTypeOptions() {\n      if (!this.entityPreviewFiles) return []\n      const taskTypeIds = Object.keys(this.entityPreviewFiles)\n      return taskTypeIds\n        .filter(taskTypeId => {\n          const previewFiles = this.entityPreviewFiles[taskTypeId].filter(p =>\n            ['mp4', 'png'].includes(p.extension)\n          )\n          return previewFiles.length > 0 && this.taskTypeMap.get(taskTypeId)\n        })\n        .map(taskTypeId => {\n          const taskType = this.taskTypeMap.get(taskTypeId)\n          return {\n            label: taskType.name,\n            value: taskType.id\n          }\n        })\n    },\n\n    lastPreviewFileOptions() {\n      if (!this.lastPreviewFiles) return []\n      return [...this.lastPreviewFiles]\n        .sort((a, b) => b.revision - a.revision)\n        .map(preview => ({\n          value: preview.id,\n          label: `v${preview.revision}`,\n          validation_status: preview.validation_status\n        }))\n    },\n\n    previewFileOptions() {\n      if (!this.entityPreviewFiles) return []\n      const previewFiles = this.entityPreviewFiles[this.taskTypeId]\n      if (previewFiles && previewFiles.length > 0) {\n        return previewFiles.map(previewFile => {\n          return {\n            label: `v${previewFile.revision}`,\n            value: previewFile.id\n          }\n        })\n      } else {\n        return []\n      }\n    },\n\n    isComparisonEnabled() {\n      return this.fullScreen || this.extraWide\n    },\n\n    nbFrames() {\n      const duration =\n        this.currentPreview && this.currentPreview.duration\n          ? this.currentPreview.duration\n          : this.videoDuration\n      return Math.round(duration * this.fps)\n    },\n\n    isComparisonOverlay() {\n      return this.comparisonMode !== 'sidebyside' && this.isComparing\n    },\n\n    overlayOpacity() {\n      if (this.isComparing && this.isComparisonOverlay) {\n        switch (this.comparisonMode) {\n          case 'overlay0':\n            return 0\n          case 'overlay25':\n            return 0.25\n          case 'overlay50':\n            return 0.5\n          case 'overlay75':\n            return 0.75\n          case 'overlay100':\n            return 1\n          default:\n            return 1\n        }\n      } else {\n        return 1\n      }\n    },\n\n    backgroundOptions() {\n      const defaultFlag = this.$t('playlists.actions.default')\n      return [\n        {\n          label: this.$t('playlists.actions.select_background'),\n          value: null,\n          placeholder: true\n        },\n        ...this.productionBackgrounds.map(background => ({\n          value: background,\n          label: background.name,\n          optionLabel:\n            background.name +\n            (this.isDefaultBackground(background) ? ` (${defaultFlag})` : '')\n        }))\n      ]\n    },\n\n    productionBackgrounds() {\n      return this.getProductionBackgrounds(this.task?.project_id)\n    },\n\n    currentConcept() {\n      return this.selectedConcepts.values().next().value\n    },\n\n    conceptLinkedEntities() {\n      return this.getLinkedEntities(this.currentConcept)\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'editConcept',\n      'refreshPreview',\n      'updateRevisionPreviewPosition'\n    ]),\n    formatFrame,\n    formatTime,\n\n    isCurrentRevision(previewFile) {\n      return previewFile.revision === this.currentPreview.revision\n    },\n\n    getRevisionTitle(previewFile) {\n      return (\n        `${this.$t('playlists.actions.display_revision')}` +\n        ` ${previewFile.revision}`\n      )\n    },\n\n    setVideoFrameContext(frame) {\n      frame = Math.min(frame, this.nbFrames - 1)\n      if (this.currentFrame !== frame) {\n        const time = frame * this.frameDuration\n        this.currentFrame = frame\n        this.currentTimeRaw = time\n        this.currentTime = this.formatTime(time, this.fps)\n        this.progress.updateProgressBar(frame)\n        this.$emit('frame-updated', frame)\n\n        if (!this.isPlaying) {\n          this.syncComparisonViewer()\n        }\n        if (!this.isPlaying) this.loadAnnotation()\n      }\n    },\n\n    onSubPreviewsWheel(event) {\n      const isMouseWheelY = !event.deltaX\n      if (isMouseWheelY) {\n        event.preventDefault()\n        this.$refs['revision-previews'].scrollLeft += event.deltaY\n      }\n    },\n\n    // Video progress\n\n    setCurrentFrame(frame) {\n      if (this.currentFrame !== frame) {\n        this.setVideoFrameContext(frame)\n        this.previewViewer.setCurrentFrame(frame)\n      }\n    },\n\n    initPreferences() {\n      this.isRepeating = localPreferences.getBoolPreference('player:repeating')\n      this.isMuted = localPreferences.getBoolPreference('player:muted')\n      this.isHd = Boolean(this.organisation.hd_by_default)\n      this.isOrdering =\n        this.previews.length > 1 &&\n        localPreferences.getPreference('player:ordering') !== 'false'\n    },\n\n    toggleIsOrdering() {\n      this.isOrdering = !this.isOrdering\n      localPreferences.setPreference('player:ordering', this.isOrdering)\n    },\n\n    focus() {\n      this.$refs.container.focus()\n    },\n\n    timeCodeClicked({ versionRevision, frame }) {\n      const preview = this.lastPreviewFiles.find(\n        p => p.revision === parseInt(versionRevision)\n      )\n      if (!preview) return\n      this.changeCurrentPreview(preview)\n      setTimeout(() => {\n        this.setCurrentFrame(frame)\n      }, 20)\n    },\n\n    // Video\n\n    configureVideo() {\n      this.isPlaying = false\n      this.isRepeating = false\n    },\n\n    changeMaxDuration(duration) {\n      if (duration) {\n        const isChromium = !!window.chrome\n        if (isChromium) {\n          // Chromium has a bug with the video duration\n          // https://bugs.chromium.org/p/chromium/issues/detail?id=642012\n          duration += 0.001\n        }\n        if (this.currentPreview.duration) {\n          duration = this.currentPreview.duration\n        }\n        duration = floorToFrame(duration, this.fps)\n        this.videoDuration = duration\n        this.maxDuration = this.formatTime(\n          this.videoDuration - this.frameDuration,\n          this.fps\n        )\n      } else {\n        this.maxDuration = '00:00:00:00'\n        this.videoDuration = 0\n      }\n    },\n\n    getCurrentTime() {\n      if (!this.isMovie) return 0\n      const time = roundToFrame(this.currentTimeRaw, this.fps)\n      return Number(time.toPrecision(4))\n    },\n\n    getCurrentFrame() {\n      if (this.currentFrame) {\n        return this.currentFrame + 1 //match offset in player.js\n      } else {\n        const time = roundToFrame(this.currentTimeRaw, this.fps) || 0\n        return Math.round(time / this.frameDuration) + 1 //match offset in player.js\n      }\n    },\n\n    play() {\n      this.isPlaying = true\n      this.isDrawing = false\n      if (this.previewViewer) {\n        if (this.is3DModel) {\n          this.previewViewer.playModelAnimation(this.current3DAnimation)\n        } else {\n          this.clearCanvas()\n          if (this.currentFrame >= this.nbFrames - 1) {\n            this.previewViewer.setCurrentFrame(0)\n            this.comparisonViewer.setCurrentFrame(0)\n          }\n          this.previewViewer.play()\n          if (this.comparisonViewer && this.isComparing) {\n            this.comparisonViewer.play()\n          }\n        }\n      }\n    },\n\n    pause() {\n      if (this.isPlaying) {\n        this.isPlaying = false\n        if (this.is3DModel) {\n          this.previewViewer.pauseModelAnimation()\n        } else {\n          if (this.previewViewer) this.previewViewer.pause()\n          if (this.comparisonViewer) this.comparisonViewer.pause()\n          this.$nextTick(() => {\n            this.syncComparisonViewer()\n          })\n        }\n      }\n    },\n\n    goPreviousFrame() {\n      this.clearCanvas()\n      this.previewViewer.goPreviousFrame()\n      this.syncComparisonViewer()\n    },\n\n    goNextFrame() {\n      this.clearCanvas()\n      this.previewViewer.goNextFrame()\n      this.syncComparisonViewer()\n    },\n\n    goPreviousDrawing() {\n      const time = this.getPreviousAnnotationTime(this.currentTimeRaw)\n      this.jumpToAnnotationFrame(time)\n    },\n\n    goNextDrawing() {\n      const time = this.getNextAnnotationTime(this.currentTimeRaw)\n      this.jumpToAnnotationFrame(time)\n    },\n\n    jumpToAnnotationFrame(time) {\n      if (time) {\n        const annotationTime = time.frame - 1\n        this.clearCanvas()\n        this.setCurrentFrame(annotationTime)\n        this.syncComparisonViewer()\n      }\n    },\n\n    syncComparisonViewer() {\n      if (this.comparisonViewer && this.isComparing) {\n        this.comparisonViewer.setCurrentFrame(this.currentFrame)\n      }\n    },\n\n    onProgressChanged(frame) {\n      this.reloadAnnotations()\n      if (this.currentFrame !== frame) {\n        this.clearCanvas()\n        this.setCurrentFrame(frame)\n      }\n    },\n\n    onVideoEnd() {\n      this.isPlaying = false\n      if (this.isRepeating) {\n        this.setCurrentFrame(0)\n        this.syncComparisonViewer()\n        this.$nextTick(() => {\n          this.play()\n        })\n      }\n    },\n\n    onPlayPauseClicked() {\n      this.clearFocus()\n      if (!this.isPlaying) {\n        this.play()\n      } else {\n        this.pause()\n      }\n    },\n\n    onRepeatClicked() {\n      this.clearFocus()\n      this.isRepeating = !this.isRepeating\n      localPreferences.setPreference('player:repeating', this.isRepeating)\n    },\n\n    onToggleSoundClicked() {\n      this.clearFocus()\n      this.isMuted = !this.isMuted\n      localPreferences.setPreference('player:muted', this.isMuted)\n    },\n\n    // Sizing\n\n    getDimensions() {\n      const dimensions = { width: 0, height: 0 }\n      if (this.previewContainer) {\n        dimensions.width = this.previewContainer.offsetWidth\n        dimensions.height = this.previewContainer.offsetHeight\n      }\n      return dimensions\n    },\n\n    setupFabricCanvas() {\n      const dimensions = this.getDimensions()\n      const width = dimensions.width\n      const height = dimensions.height\n\n      // Use markRaw() to avoid reactivity on Fabric Canvas\n      this.fabricCanvas = markRaw(\n        new fabric.Canvas(this.canvasId, {\n          fireRightClick: true,\n          width,\n          height,\n          enablePointerEvents: true\n        })\n      )\n      const brush = new PSBrush(this.fabricCanvas)\n      brush.width = 20 // Set default brush width\n      brush.color = '#000' // Set default color\n      brush.disableTouch = true // Disable touch input\n      brush.disableMouse = true\n      brush.pressureManager.fallback = 0.5 // Fallback value for mouse/touch\n      this.fabricCanvas.freeDrawingBrush = brush\n      this.fabricCanvasComparison = new fabric.StaticCanvas(\n        this.canvasId + '-comparison'\n      )\n      this.configureCanvas()\n    },\n\n    fixCanvasSize(dimensions) {\n      if (!this.fabricCanvas) return\n      if (this.isPicture && dimensions.source === 'movie') return\n      if (this.isMovie && dimensions.source === 'picture') return\n      const { height, left, top, width } = dimensions\n      this.canvasWrapper.style.top = top + 'px'\n      this.canvasWrapper.style.left = left + 'px'\n      this.canvasWrapper.style.width = width + 'px'\n      this.canvasWrapper.style.height = height + 'px'\n      if (\n        this.fabricCanvas.width !== width ||\n        this.fabricCanvas.height !== height\n      ) {\n        this.fabricCanvas.setDimensions({ width, height })\n      }\n      this.refreshCanvas()\n    },\n\n    fixCanvasComparisonSize(dimensions) {\n      if (!this.fabricCanvasComparison) {\n        return\n      }\n      const { height, left, top, width } = dimensions\n      this.canvasComparisonWrapper.style.top = top + 'px'\n      this.canvasComparisonWrapper.style.left =\n        this.getDimensions().width / 2 + left + 'px'\n      this.canvasComparisonWrapper.style.width = width + 'px'\n      this.canvasComparisonWrapper.style.height = height + 'px'\n      if (\n        this.fabricCanvasComparison.width !== width ||\n        this.fabricCanvasComparison.height !== height\n      ) {\n        this.fabricCanvasComparison.setDimensions({ width, height })\n      }\n      this.refreshCanvas()\n    },\n\n    // Screen\n\n    setFullScreen() {\n      this.endAnnotationSaving()\n      const promise = this.documentSetFullScreen(this.container)\n      Promise.resolve(promise).finally(() => {\n        this.fullScreen = true\n      })\n      this.$nextTick(() => {\n        // Needed to avoid fullscreen button to be called with space bar.\n        this.clearFocus()\n      })\n    },\n\n    exitFullScreen() {\n      this.endAnnotationSaving()\n      const promise = this.documentExitFullScreen()\n      Promise.resolve(promise).finally(() => {\n        this.fullScreen = false\n        this.$nextTick(() => {\n          this.previewViewer?.resize()\n          this.comparisonViewer?.resize()\n        })\n      })\n      this.isComparing = false\n      this.isCommentsHidden = true\n      this.$nextTick(() => {\n        // Needed to avoid fullscreen button to be called with space bar.\n        this.clearFocus()\n        this.previewViewer?.resize()\n        this.comparisonViewer?.resize()\n        this.triggerResize()\n      })\n    },\n\n    onFullscreenClicked() {\n      if (this.fullScreen) {\n        this.removeTypeArea()\n        this.exitFullScreen()\n      } else {\n        this.addTypeArea()\n        this.setFullScreen()\n      }\n    },\n\n    onFullScreenChange() {\n      if (this.fullScreen && !this.isFullScreen()) {\n        this.isComparing = false\n        this.fullScreen = false\n        this.isCommentsHidden = true\n        this.endAnnotationSaving()\n        this.$nextTick(() => {\n          this.previewViewer?.resize()\n          this.comparisonViewer?.resize()\n          this.clearFocus()\n          this.$nextTick(() => {\n            this.loadAnnotation()\n          })\n        })\n      }\n      // fix edge cases on toggling fullscreen\n      setTimeout(() => {\n        this.previewViewer?.resize()\n        this.comparisonViewer?.resize()\n      }, 500)\n    },\n\n    // Comparison\n\n    onCompareClicked() {\n      this.clearFocus()\n      if (this.isComparing) {\n        this.isComparing = false\n      } else {\n        this.isComparing = true\n        this.taskTypeId = this.taskTypeOptions[0].value\n        this.previewToCompareId = ''\n        this.$nextTick(() => {\n          this.previewToCompareId = this.previewFileOptions[0].value\n        })\n        this.isDrawing = false\n      }\n    },\n\n    setDefaultComparisonTaskType() {\n      if (!this.entityPreviewFiles) return ''\n      const taskTypeIds = Object.keys(this.entityPreviewFiles)\n      if (taskTypeIds && taskTypeIds.length > 0) {\n        const taskTypeOption = this.taskTypeOptions.find(option => {\n          return (\n            this.entityPreviewFiles[option.value].findIndex(\n              p => p.id === this.currentPreview.id\n            ) >= 0\n          )\n        })\n        if (taskTypeOption) {\n          this.taskTypeId = taskTypeOption.value\n        } else if (this.taskTypeOptions.length > 0) {\n          this.taskTypeId = this.taskTypeOptions[0].value\n        }\n\n        if (this.taskTypeId) this.setDefaultComparisonPreview()\n      } else {\n        this.previewToCompareId = null\n      }\n    },\n\n    setDefaultComparisonPreview() {\n      if (!this.entityPreviewFiles) return ''\n      let previewFiles = this.entityPreviewFiles[this.taskTypeId]\n      if (previewFiles) {\n        previewFiles = previewFiles.filter(p => p.id !== this.currentPreview.id)\n        if (previewFiles.length > 0) {\n          this.previewToCompareId = previewFiles[0].id\n        } else {\n          this.previewToCompareId = null\n        }\n      } else {\n        this.previewToCompareId = null\n      }\n    },\n\n    onPreviousComparisonClicked() {\n      const index = this.comparisonPreviewIndex - 1\n      this.comparisonPreviewIndex =\n        index < 0 ? this.comparisonPreviewLength - 1 : index\n    },\n\n    onNextComparisonClicked() {\n      const index = this.comparisonPreviewIndex + 1\n      this.comparisonPreviewIndex =\n        index > this.comparisonPreviewLength - 1 ? 0 : index\n    },\n\n    resetPreviewFileMap() {\n      this.previewFileMap = {}\n      if (this.entityPreviewFiles) {\n        const previewFiles = this.entityPreviewFiles[this.taskTypeId]\n        if (previewFiles) {\n          previewFiles.forEach(previewFile => {\n            this.previewFileMap[previewFile.id] = previewFile\n          })\n        }\n      }\n    },\n\n    onZoomPanClicked() {\n      if (!this.isZoomPan) {\n        this.isDrawing = false\n        this.isAnnotationsDisplayed = false\n        this.isZoomPan = true\n      } else {\n        this.isZoomPan = false\n        this.isAnnotationsDisplayed = true\n      }\n    },\n\n    onObjectBackgroundSelected() {\n      this.objectBackgroundUrl = this.currentBackground?.url\n      const enabled = Boolean(this.objectBackgroundUrl)\n      this.isObjectBackground = enabled\n      this.isEnvironmentSkybox = enabled\n    },\n\n    isDefaultBackground(background) {\n      const defaultId =\n        this.currentProduction?.default_preview_background_file_id\n      return defaultId ? background.id === defaultId : background.is_default\n    },\n\n    setPlayerSpeed(rate) {\n      this.previewViewer.setSpeed(rate)\n      this.comparisonViewer.setSpeed(rate)\n    },\n\n    // Annotations\n\n    triggerResize() {\n      window.dispatchEvent(new Event('resize'))\n    },\n\n    onDeleteClicked() {\n      this.clearFocus()\n      this.deleteSelection()\n    },\n\n    onPencilAnnotateClicked() {\n      this.clearFocus()\n      if (this.isDrawing) {\n        this.isDrawing = false\n      } else {\n        this._resetColor()\n        this._resetPencil()\n        this.isTyping = false\n        this.isDrawing = true\n      }\n    },\n\n    onTypeClicked() {\n      this.clearFocus()\n      if (this.isTyping) {\n        this.isTyping = false\n      } else {\n        this.isDrawing = false\n        this.isTyping = true\n      }\n    },\n\n    refreshCanvas() {\n      this.clearCanvas()\n      if (this.annotations.length > 0) {\n        if (this.isMovie) {\n          this.loadAnnotation()\n        } else if (this.isPicture) {\n          this.loadAnnotation()\n        }\n      }\n    },\n\n    getAnnotation(time) {\n      if (this.isMovie) {\n        time = roundToFrame(time, this.fps)\n        return this.annotations.find(annotation => {\n          return (\n            roundToFrame(annotation.time, this.fps) < time + 0.0001 &&\n            roundToFrame(annotation.time, this.fps) > time - 0.0001\n          )\n        })\n      } else if (this.isPicture) {\n        return this.annotations.find(annotation => annotation.time === 0)\n      }\n    },\n\n    getSortedAnnotations() {\n      const annotations = this.annotations\n      annotations.sort((a, b) => a.time - b.time)\n      return annotations\n    },\n\n    getNextAnnotationTime(time) {\n      const annotations = this.getSortedAnnotations()\n      if (this.isMovie) {\n        time = roundToFrame(time, this.fps)\n        return annotations.find(annotation => {\n          return roundToFrame(annotation.time, this.fps) > time + 0.0001\n        })\n      } else if (this.isPicture) {\n        return annotations.find(annotation => annotation.time === 0)\n      }\n    },\n\n    getPreviousAnnotationTime(time) {\n      const annotations = this.getSortedAnnotations()\n      if (this.isMovie) {\n        time = roundToFrame(time, this.fps)\n        return annotations.findLast(annotation => {\n          return (\n            roundToFrame(annotation.time, this.fps) <\n            time - 1 / this.fps + 0.0001\n          )\n        })\n      } else if (this.isPicture) {\n        return annotations.find(annotation => annotation.time === 0)\n      }\n    },\n\n    onAnnotationDisplayedClicked() {\n      this.clearFocus()\n      this.isAnnotationsDisplayed = !this.isAnnotationsDisplayed\n      this.isZoomPan = false\n      this.previewViewer.resetZoom()\n      this.comparisonViewer.resetZoom()\n    },\n\n    saveAnnotations() {\n      let currentTime = 0\n      if (this.isMovie) {\n        currentTime = this.currentFrame * this.frameDuration\n        currentTime = roundToFrame(currentTime, this.fps)\n        currentTime = Number(currentTime.toPrecision(4))\n      }\n      const annotation = this.getAnnotation(currentTime)\n      const annotations = this.getNewAnnotations(\n        currentTime,\n        this.currentFrame,\n        annotation\n      )\n\n      if (!this.readOnly) {\n        const preview = this.currentPreview\n        if (!this.notSaved) {\n          this.startAnnotationSaving(preview, annotations)\n        }\n      }\n    },\n\n    loadAnnotation(annotation) {\n      let currentTime = 0\n      if (!annotation) {\n        if (this.isMovie) {\n          currentTime = this.currentFrame * this.frameDuration\n        }\n        annotation = this.getAnnotation(currentTime)\n        if (!annotation) {\n          if (!this.isMovie) {\n            console.warn('Annotations are malformed or empty.')\n          }\n          if (this.isComparing && !this.isComparisonOverlay) {\n            this.loadComparisonAnnotation(currentTime)\n          }\n          return\n        }\n      }\n      if (!this.fabricCanvas) this.setupFabricCanvas()\n      if (this.isMovie && this.previewViewer && this.isPlaying) {\n        this.previewViewer.pause()\n      }\n      this.clearCanvas()\n      this.loadSingleAnnotation(annotation)\n      if (this.isComparing && !this.isComparisonOverlay) {\n        this.loadComparisonAnnotation(currentTime)\n      }\n    },\n\n    loadComparisonAnnotation(time) {\n      this.fabricCanvasComparison.clear()\n      this.previewToCompare = this.previewFileMap[this.previewToCompareId]\n      let annotations = []\n      if (this.previewToCompare && this.previewToCompare.annotations) {\n        annotations = this.previewToCompare.annotations\n      }\n      let annotation = null\n      if (this.isMovie) {\n        annotation = annotations.find(annotation => annotation.time === time)\n      } else if (this.isPicture) {\n        annotation = annotations.find(annotation => annotation.time === 0)\n      }\n      if (annotation) {\n        this.loadSingleAnnotationComparison(annotation)\n      }\n    },\n\n    reloadAnnotations() {\n      this.annotations = []\n      if (this.currentPreview.annotations) {\n        const annotations = []\n        if (this.currentPreview.annotations.forEach) {\n          this.currentPreview.annotations.forEach(a => {\n            if (a.time >= 0) {\n              annotations.push({ ...a })\n            }\n          })\n        }\n        this.annotations =\n          annotations.sort((a, b) => {\n            return a.time < b.time\n          }) || []\n      } else {\n        this.annotations = []\n      }\n      return this.annotations\n    },\n\n    getFileFromCanvas(canvas, filename) {\n      return new Promise((resolve, reject) => {\n        canvas.toBlob(blob => {\n          const file = new File([blob], filename, {\n            type: 'image/png',\n            lastModified: new Date().getTime()\n          })\n          return resolve(file)\n        })\n      })\n    },\n\n    extractVideoFrame(canvas, frame) {\n      return new Promise(resolve => {\n        this.setCurrentFrame(frame)\n        this.$nextTick(() => {\n          setTimeout(() => {\n            this.previewViewer.extractFrame(canvas, frame)\n            resolve()\n          }, 500)\n        })\n      })\n    },\n\n    copyAnnotationCanvas(canvas, annotation) {\n      return new Promise(resolve => {\n        this.clearCanvas()\n        this.loadSingleAnnotation(annotation)\n        setTimeout(() => {\n          const context = canvas.getContext('2d')\n          const scaleRatio = canvas.width / this.fabricCanvas.width\n          const tmpSource = document.getElementById('resize-annotation-canvas')\n          const tmpCanvas = new fabric.Canvas('resize-annotation-canvas', {\n            width: canvas.width,\n            height: canvas.height\n          })\n          this.fabricCanvas.getObjects().find(obj => {\n            if (obj._objects) {\n              obj._objects.forEach(obj => {\n                tmpCanvas.add(obj)\n                obj.strokeWidth = obj.strokeWidth / scaleRatio\n              })\n            } else {\n              tmpCanvas.add(obj)\n              obj.strokeWidth = obj.strokeWidth / scaleRatio\n            }\n          })\n          tmpCanvas.setZoom(scaleRatio)\n          setTimeout(() => {\n            context.drawImage(tmpSource, 0, 0, canvas.width, canvas.height)\n            setTimeout(() => {\n              tmpCanvas.dispose()\n            }, 100)\n            return resolve()\n          }, 100)\n        }, 100)\n      })\n    },\n\n    async extractAnnotationSnapshots() {\n      const files = []\n      const annotations = this.annotations.sort((a, b) => {\n        return parseInt(b.frame) < parseInt(a.frame) ? 1 : -1\n      })\n      let index = 1\n      for (const annotation of annotations) {\n        const canvas = document.getElementById('annotation-snapshot')\n        const filename = `annotation ${index}.png`\n        const frame =\n          roundToFrame(annotation.time, this.fps) / this.frameDuration\n        await this.extractVideoFrame(canvas, frame)\n        await this.copyAnnotationCanvas(canvas, annotation)\n        const file = await this.getFileFromCanvas(canvas, filename)\n        files.push(file)\n        index++\n      }\n      this.previewViewer.setCurrentFrame(this.currentFrame - 1)\n      this.$nextTick(() => {\n        this.clearCanvas()\n      })\n      return files\n    },\n\n    // Concepts\n\n    entityPath(entity, section) {\n      const episodeId = this.isTVShow ? entity.episode_id || 'main' : null\n      return getEntityPath(\n        entity.id,\n        this.currentProduction.id,\n        section,\n        episodeId\n      )\n    },\n\n    getLinkedEntities(concept) {\n      return concept.entity_concept_links\n        .map(id => this.assetMap.get(id))\n        .filter(Boolean)\n    },\n\n    onRemoveLink(link) {\n      const concept = {\n        id: this.currentConcept.id,\n        entity_concept_links: this.currentConcept.entity_concept_links.filter(\n          id => id !== link.id\n        )\n      }\n      this.editConcept(concept)\n    },\n\n    // Events\n\n    onKeyDown(event) {\n      const PREVANNKEY = ','\n      const NEXTANNKEY = '.'\n      const OKEY = 'o'\n\n      if (!['INPUT', 'TEXTAREA'].includes(event.target.tagName)) {\n        if (event.keyCode === 46 || event.keyCode === 8) {\n          this.deleteSelection()\n        } else if (event.keyCode === 37) {\n          // arrow left\n          this.goPreviousFrame()\n        } else if (event.keyCode === 39) {\n          // arrow right\n          this.goNextFrame()\n        } else if (event.keyCode === 32) {\n          // space\n          let styles\n          const playlistModal = document.getElementById('temp-playlist-modal')\n          if (playlistModal) styles = window.getComputedStyle(playlistModal)\n          if (!styles || (styles && styles.display === 'none')) {\n            this.onPlayPauseClicked()\n            this.pauseEvent(event)\n          }\n          return false\n        } else if (event.key === NEXTANNKEY) {\n          this.goNextDrawing()\n        } else if (event.key === PREVANNKEY) {\n          this.goPreviousDrawing()\n        } else if (event.keyCode === 68) {\n          // d\n          this.container.focus()\n          this.pauseEvent(event)\n          this.onPencilAnnotateClicked()\n        } else if ((event.ctrlKey || event.metaKey) && event.keyCode === 90) {\n          // ctrl + z\n          this.undoLastAction()\n        } else if (event.altKey && event.keyCode === 82) {\n          // alt + r\n          this.redoLastAction()\n        } else if (event.altKey && event.keyCode === 74) {\n          // alt+j\n          this.onPreviousClicked()\n        } else if (event.altKey && event.keyCode === 75) {\n          // alt+k\n          this.onNextClicked()\n        } else if ((event.ctrlKey || event.metaKey) && event.keyCode === 67) {\n          // ctrl + c\n          this.copyAnnotations()\n        } else if ((event.ctrlKey || event.metaKey) && event.keyCode === 86) {\n          // ctrl + v\n          this.pasteAnnotations()\n        } else if (event.altKey && event.key === OKEY) {\n          event.preventDefault()\n          event.stopPropagation()\n          this.toggleFullOverlayComparison()\n        } else if (event.code === 'Escape') {\n          // Esc\n          if (this.fullScreen) {\n            this.onFullScreenChange()\n          }\n        }\n      }\n    },\n\n    async toggleFullOverlayComparison() {\n      if (!this.isComparing) {\n        this.isComparing = true\n        await this.$nextTick()\n        await this.$nextTick()\n      }\n      this.$nextTick(() => {\n        if (this.comparisonMode === 'overlay100') {\n          this.comparisonMode = 'overlay0'\n        } else {\n          this.comparisonMode = 'overlay100'\n        }\n      })\n    },\n\n    onCommentClicked() {\n      const height = this.previewContainer.offsetHeight\n      this.isCommentsHidden = !this.isCommentsHidden\n      if (!this.isCommentsHidden) {\n        this.commentContainer.$el.style.height = `${height}px`\n        this.commentContainer.focusCommentTextarea()\n      }\n      this.endAnnotationSaving()\n      this.$nextTick(() => {\n        this.previewViewer.resize()\n        this.comparisonViewer.resize()\n        this.loadAnnotation()\n      })\n    },\n\n    onModelLoaded() {\n      this.is3DAnimation = this.previewViewer.get3DAnimations().length > 0\n      if (this.is3DAnimation) {\n        this.available3DAnimations = this.previewViewer\n          .get3DAnimations()\n          .map(animation => ({\n            label: animation,\n            value: animation\n          }))\n        this.current3DAnimation = this.available3DAnimations[0].value\n        this.isPlaying = true\n        this.previewViewer.playModelAnimation(this.current3DAnimation)\n      }\n    },\n\n    onVideoLoaded() {\n      if (this.isMovie) {\n        this.movieDimensions = {\n          width: this.currentPreview.width,\n          height: this.currentPreview.height\n        }\n        this.setCurrentFrame(0)\n        this.progress.updateProgressBar(0)\n      }\n    },\n\n    configureEvents() {\n      window.addEventListener('keydown', this.onKeyDown, false)\n      window.addEventListener('beforeunload', this.onWindowsClosed)\n      this.container.addEventListener(\n        'fullscreenchange',\n        this.onFullScreenChange,\n        false\n      )\n      this.container.addEventListener(\n        'mozfullscreenchange',\n        this.onFullScreenChange,\n        false\n      )\n      this.container.addEventListener(\n        'MSFullscreenChange',\n        this.onFullScreenChange,\n        false\n      )\n      this.container.addEventListener(\n        'webkitfullscreenchange',\n        this.onFullScreenChange,\n        false\n      )\n    },\n\n    removeEvents() {\n      window.removeEventListener('keydown', this.onKeyDown)\n      window.removeEventListener('beforeunload', this.onWindowsClosed)\n      this.container.removeEventListener(\n        'fullscreenchange',\n        this.onFullScreenChange,\n        false\n      )\n      this.container.removeEventListener(\n        'mozfullscreenchange',\n        this.onFullScreenChange,\n        false\n      )\n      this.container.removeEventListener(\n        'MSFullscreenChange',\n        this.onFullScreenChange,\n        false\n      )\n      this.container.removeEventListener(\n        'webkitfullscreenchange',\n        this.onFullScreenChange,\n        false\n      )\n    },\n\n    // Browsing\n\n    changeCurrentPreviewFile(previewFileId) {\n      const previewFile = this.lastPreviewFiles.find(\n        previewFile => previewFile.id === previewFileId\n      )\n      this.changeCurrentPreview(previewFile)\n    },\n\n    changeCurrentPreview(previewFile) {\n      this.$emit('change-current-preview', previewFile)\n    },\n\n    onAddPreviewClicked() {\n      this.$emit('add-preview')\n    },\n\n    onRemovePreviewClicked() {\n      this.$emit('remove-extra-preview', this.currentPreview)\n    },\n\n    onPreviousClicked() {\n      if (this.currentIndex > 1) {\n        this.currentIndex--\n      } else {\n        this.currentIndex = this.previews.length\n      }\n    },\n\n    onNextClicked() {\n      if (this.currentIndex < this.previews.length) {\n        this.currentIndex++\n      } else {\n        this.currentIndex = 1\n      }\n    },\n\n    displayFirst() {\n      if (this.currentIndex > 1) this.currentIndex = 1\n    },\n\n    displayLast() {\n      this.currentIndex = this.previews.length\n    },\n\n    // Loupe\n\n    onCanvasMouseMoved(event) {\n      if (this.isPicture && this.$options.loupe) {\n        const width = this.canvasWrapper.style.width\n        const height = this.canvasWrapper.style.height\n        this.previewViewer.updateLoupePosition(event, { width, height })\n      } else if (this.isMovie && this.$options.scrubbing) {\n        const x = this.getClientX(event.e)\n        if (x - this.$options.scrubStartX < 0) {\n          this.goPreviousFrame()\n        } else {\n          this.goNextFrame()\n        }\n        this.$options.scrubStartX = x\n      }\n    },\n\n    onCanvasClicked(event) {\n      if (event.button > 1 && this.isPicture && this.fullScreen) {\n        this.$options.loupe = true\n        this.previewViewer.showLoupe()\n        const width = this.canvasWrapper.style.width\n        const height = this.canvasWrapper.style.height\n        this.previewViewer.updateLoupePosition(event, { width, height })\n      } else if (event.button > 1 && this.isMovie) {\n        this.$options.scrubbing = true\n        this.$options.scrubStartX = this.getClientX(event)\n        this.$options.scrubStartTime = Number(this.currentTimeRaw)\n      }\n      return false\n    },\n\n    onCanvasReleased(event) {\n      if (this.isPicture && this.$options.loupe) {\n        this.previewViewer.hideLoupe()\n        this.$options.loupe = false\n      } else if (this.isMovie && this.$options.scrubbing) {\n        this.$options.scrubbing = false\n      }\n      return false\n    },\n\n    // Revision previews\n\n    onRevisionPreviewSelected(index) {\n      this.currentIndex = index\n    },\n\n    onRevisionPreviewDropped({ previousIndex, newIndex }) {\n      const preview = this.previews[previousIndex]\n      this.updateRevisionPreviewPosition({\n        previousIndex,\n        newIndex,\n        revision: this.currentPreview.revision,\n        taskId: this.currentPreview.task_id,\n        previewId: preview.id\n      }).catch(console.error)\n      this.$emit('previews-order-changed')\n      this.$nextTick(() => {\n        this.currentIndex = newIndex + 1\n      })\n    },\n\n    isValidPreviewModification(previewId, updatedAt) {\n      return (\n        !this.notSaved &&\n        this.currentPreview &&\n        previewId === this.currentPreview.id &&\n        !this.isWriting(updatedAt)\n      )\n    }\n  },\n\n  watch: {\n    current3DAnimation() {\n      if (this.is3DModel) {\n        this.isPlaying = true\n        this.previewViewer.playModelAnimation(this.current3DAnimation)\n      }\n    },\n\n    currentPreview() {\n      this.endAnnotationSaving()\n      this.reloadAnnotations()\n      this.isComparing = false\n      if (this.isMovie) {\n        this.configureVideo()\n        this.pause()\n        this.maxDuration = '00:00:00:00'\n        this.isDrawing = false\n        setTimeout(() => {\n          if (this.previewViewer) {\n            this.movieDimensions = this.previewViewer.getNaturalDimensions()\n            this.previewViewer.resize()\n            this.comparisonViewer.resize()\n          }\n        }, 500)\n      } else if (this.isPicture) {\n        this.pause()\n        this.isDrawing = false\n        this.refreshCanvas()\n        setTimeout(() => {\n          this.previewViewer?.resize()\n          this.comparisonViewer?.resize()\n        }, 500)\n      } else if (this.is3DModel) {\n        this.fixCanvasSize({ width: 0, height: 0, left: 0, top: 0 })\n        this.previewViewer?.resize()\n      } else if (this.isSound || this.isFile) {\n        // hide canvas\n        this.fixCanvasSize({ width: 0, height: 0, left: 0, top: 0 })\n      }\n      this.$nextTick(() => {\n        if (this.previewViewer && this.previewViewer.isBroken) {\n          this.clearCanvas()\n        }\n      })\n      this.setDefaultComparisonTaskType()\n      this.isOrdering =\n        this.previews.length > 1 &&\n        localPreferences.getPreference('player:ordering') !== 'false'\n    },\n\n    'currentPreview.revision'() {\n      this.endAnnotationSaving()\n      this.currentIndex = lastIndex <= this.previews.length ? lastIndex || 1 : 1\n    },\n\n    currentIndex() {\n      lastIndex = this.currentIndex\n    },\n\n    previewToCompare() {\n      this.comparisonPreviewIndex = 0\n      this.$nextTick(() => {\n        this.previewViewer.resize()\n        this.comparisonViewer.resize()\n      })\n    },\n\n    previewToCompareId() {\n      this.$nextTick(() => {\n        if (this.comparisonViewer) this.comparisonViewer.pause()\n        this.previewToCompare = this.previewFileMap[this.previewToCompareId]\n        if (this.isComparing) {\n          this.setCurrentFrame(this.currentFrame - 1)\n          setTimeout(() => {\n            this.syncComparisonViewer()\n          }, 200)\n          this.pause()\n          if (this.isMovie) {\n            this.loadComparisonAnnotation(this.currentTime)\n          } else if (this.isPicture) {\n            this.loadComparisonAnnotation(0)\n          }\n        }\n      })\n    },\n\n    taskTypeId() {\n      this.resetPreviewFileMap()\n      this.setDefaultComparisonPreview()\n    },\n\n    isComparing() {\n      this.endAnnotationSaving()\n      if (!this.isComparing) {\n        if (this.comparisonViewer) this.comparisonViewer.pause()\n        this.taskTypeId = ''\n        this.previewToCompareId = ''\n      }\n      this.$nextTick(() => {\n        this.previewViewer.resize()\n        this.comparisonViewer.resize()\n        this.previewViewer.resetZoom()\n        this.comparisonViewer.resetZoom()\n      })\n    },\n\n    light() {\n      this.endAnnotationSaving()\n      this.previewViewer.resize()\n      this.comparisonViewer.resize()\n    },\n\n    extraWide() {\n      this.endAnnotationSaving()\n      this.previewViewer.resize()\n      this.comparisonViewer.resize()\n    },\n\n    isDrawing() {\n      if (this.fabricCanvas) {\n        this.fabricCanvas.isDrawingMode = this.isDrawing\n      } else this.endAnnotationSaving()\n\n      if (this.isDrawing) {\n        this.isAnnotationsDisplayed = true\n        this.isZoomPan = false\n      }\n    },\n\n    isOrdering() {\n      this.$nextTick(() => {\n        this.previewViewer.resize()\n        this.comparisonViewer.resize()\n      })\n    },\n\n    isTyping() {\n      if (this.isTyping) {\n        this.isAnnotationsDisplayed = true\n      }\n      const clickarea =\n        this.canvasWrapper.getElementsByClassName('upper-canvas')[0]\n      if (this.isTyping && clickarea) {\n        clickarea.addEventListener('dblclick', this.addText)\n      } else {\n        clickarea.removeEventListener('dblclick', this.addText)\n      }\n    },\n\n    isAnnotationsDisplayed() {\n      if (this.isAnnotationsDisplayed) {\n        this.$nextTick(() => {\n          this.previewViewer.resetZoom()\n          this.comparisonViewer.resetZoom()\n        })\n      }\n      if (!this.isAnnotationsDisplayed) {\n        this.isDrawing = false\n      }\n    },\n\n    isComparisonOverlay() {\n      this.$nextTick(() => {\n        this.previewViewer.resize()\n        this.comparisonViewer.resize()\n      })\n    },\n\n    isZoomPan() {\n      if (this.isZoomPan) {\n        this.previewViewer.resumeZoom()\n      } else {\n        this.previewViewer.pauseZoom()\n      }\n    },\n\n    speed() {\n      const rates = [0.25, 0.5, 1, 1.5, 2]\n      const rate = rates[this.speed - 1]\n      this.setPlayerSpeed(rate)\n    },\n\n    volume() {\n      this.previewViewer.setVolume(this.volume)\n      localPreferences.setPreference('player:volume', this.volume)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .preview-player {\n    box-shadow: 0 0 4px #0008;\n  }\n}\n\n.loading-background {\n  width: 100%;\n  height: 100%;\n  background: black;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n}\n\n.spinner {\n  margin: auto;\n}\n\n.annotation-movie {\n  margin: auto;\n  width: 100%;\n}\n\n.time-indicator {\n  color: $light-grey;\n  padding-left: 0.8em;\n  margin-right: 0;\n}\n\n.preview-viewer {\n  width: 100%;\n  text-align: center;\n  background: #36393f;\n}\n\n.buttons {\n  background: $dark-grey-2;\n  height: 32px;\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n\n.buttons .button:first-child {\n  border-bottom-left-radius: 5px;\n}\n.buttons .button:last-child {\n  border-bottom-right-radius: 5px;\n}\n\n.buttons .button {\n  background: $dark-grey-2;\n  border-radius: 0;\n  color: $light-grey-2;\n  border: 0;\n  margin: 0;\n  transition: all 0.3s ease;\n}\n\n.buttons .background-combo {\n  max-width: 300px;\n\n  :deep(.combo) {\n    max-width: 100%;\n  }\n}\n\n.buttons .button.active,\n.buttons .background-combo.active .icon {\n  color: var(--background-selectable);\n}\n\n.buttons .button:hover {\n  border-radius: 5px;\n  transform: scale(1.2);\n}\n\n.comparison-combobox {\n  margin-bottom: 0;\n}\n\n.buttons .comparison-button {\n  margin-left: 1em;\n}\n\n.previous-preview-file {\n  padding: 1px 8px;\n  margin-right: 0.4em;\n  border: 1px solid $grey;\n  border-radius: 50%;\n  cursor: pointer;\n  color: $grey;\n}\n\n.current-preview-file {\n  padding: 1px 8px;\n  margin-right: 0.4em;\n  border: 1px solid $grey;\n  border-radius: 50%;\n  cursor: pointer;\n  color: white;\n  background: $purple-strong;\n  transition: 0.3s background ease;\n}\n\n.annotation-tools {\n  align-items: stretch;\n  display: flex;\n  height: 33px;\n  background: $dark-grey;\n}\n\n.slide-enter-active {\n  transition: all 0.3s ease;\n}\n\n.slide-leave-active {\n  transition: all 0.3s ease;\n}\n\n.slide-enter,\n.slide-leave-to {\n  transform: translateX(100%);\n}\n\n.buttons .button.ml1 {\n  margin-left: 1em;\n}\n\n.preview-viewer {\n  background: $dark-grey-stronger;\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n\n.canvas-wrapper {\n  position: absolute;\n  width: 100%;\n  left: 0;\n  z-index: 500;\n}\n.canvas-comparison-wrapper {\n  position: absolute;\n  width: 100%;\n  left: 0;\n  z-index: 5;\n}\n\n.center {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.preview-player {\n  background: $dark-grey-light;\n  display: flex;\n  flex-direction: column;\n  border-radius: 5px;\n  box-shadow: 0 0 4px #0007;\n  min-height: 200px;\n\n  .preview {\n    position: relative;\n    align-items: flex-start;\n    background: black;\n    display: flex;\n    justify-content: center;\n\n    .button {\n      padding: 1.5em;\n      transition: background 0.3s ease;\n\n      &:hover {\n        background: $dark-grey-lightest;\n      }\n    }\n  }\n}\n\n.revision-previews {\n  overflow-x: auto;\n  height: 140px;\n  padding-left: 10px;\n  padding-top: 10px;\n  box-shadow: inset 0 0 10px 1px #0008;\n  align-items: flex-start;\n\n  .flexrow-item.revision-preview {\n    margin-right: 0;\n  }\n}\n\n.preview-viewer,\n.comparison-preview-viewer {\n  flex: 1 1 0;\n  overflow: hidden;\n}\n\n.preview-viewer {\n  z-index: 1;\n}\n\n.comparison-preview-viewer {\n  z-index: 2;\n}\n\n.separator {\n  background: $dark-grey-2;\n}\n\n.entity-name {\n  color: $light-grey;\n}\n\n.task-info-column {\n  min-width: 450px;\n  max-width: 450px;\n  overflow-y: auto;\n  height: 90vh;\n}\n\n.preview-container {\n  position: relative;\n}\n\n.viewers {\n  display: flex;\n}\n\n.tags {\n  display: inline-flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  padding: 1rem;\n  margin-left: 0;\n  font-weight: 500;\n  letter-spacing: 1px;\n\n  .tag {\n    transition: transform 0.1s linear;\n\n    a {\n      display: inline-flex;\n      gap: 1em;\n      line-height: normal;\n    }\n\n    .action {\n      border-radius: 50%;\n      display: none;\n      height: 14px;\n      width: 14px;\n      line-height: 8px;\n    }\n\n    &:hover {\n      transform: scale(1.1);\n\n      .action {\n        display: inline-block;\n      }\n    }\n  }\n}\n\n#resize-annotation-canvas,\n#annotation-snapshot {\n  display: none;\n}\n</style>\n"],"file":"PreviewPlayer-Dm_ANgjQ.js"}