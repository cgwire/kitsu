import{_ as v,b as C,r as n,o as p,c as h,d as a,t as c,h as T,f as d,c8 as w,w as g,g as D,K as $,a as P}from"./index-C2m_IhNF.js";import{c as S}from"./csv-cx9HGs3n.js";import{s as b}from"./string-B0Tq569e.js";import{D as N}from"./DeleteModal-CaB_X4-T.js";import{E as A}from"./EditTaskTypeModal-CH0Ouw_v.js";import{L as B}from"./ListPageHeader-DapWf1hA.js";import{R as q}from"./RouteTabs-DR7d4lYQ.js";import{d as x}from"./vuedraggable.umd-CN5ywgj8.js";import{B as L}from"./BooleanCell-TtuCU3Va.js";import{D as V}from"./DepartmentName-C_7ZW05X.js";import{R as M}from"./RowActionsCell-CrYLK_aO.js";import{T as R}from"./TableInfo-B2X54z7i.js";import{T as I}from"./TaskTypeCell-DM2gnWrD.js";import"./BooleanField-BK_C2MOf.js";import"./check-_fRnDsm9.js";import"./ComboboxBoolean-DJwCfClJ.js";import"./Combobox-DQpIQydI.js";import"./ComboboxSimple-DU0Ahozo.js";import"./ComboboxDepartment-whRm-Bo0.js";import"./ColorField--VnpcHkf.js";import"./ModalFooter-BJ98b-60.js";import"./TextField-p_HJuEKt.js";import"./TextareaField-Bd7jnoYr.js";import"./PageTitle-DzrTLr4-.js";import"./vue.esm-bundler-Cb2j4MJL.js";import"./trash-B-JGLDKP.js";import"./refresh-cw-wbk7FbQb.js";import"./TaskTypeName-bEgQZfX7.js";const K={name:"task-type-list",components:{draggable:x,BooleanCell:L,DepartmentName:V,RowActionsCell:M,TableInfo:R,TaskTypeCell:I},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["delete-clicked","edit-clicked","update-priorities"],data(){return{items:[]}},computed:{...C(["getDepartment"])},methods:{updatePriority(){const e=this.items,t=[];e.forEach((i,l)=>{l+=1;const s={id:i.id,name:i.name,priority:String(l)};i.priority=l,t.push(s)}),this.$emit("update-priorities",t)},isEmpty(e){return e==null||e===""}},watch:{entries:{deep:!0,immediate:!0,handler(){this.items=JSON.parse(JSON.stringify(this.entries))}}}},U={class:"data-list"},H={class:"datatable-wrapper"},J={class:"datatable"},O={key:0,class:"datatable-head"},z={scope:"col",class:"department"},F={scope:"col",class:"name"},G={scope:"col",class:"short_name"},Y={scope:"col",class:"allow-timelog"},j={scope:"col",class:"description"},Q={class:"datatable-row tasktype-item"},W={class:"department"},X={class:"short_name"},Z={class:"empty"},ee={scope:"rowgroup",colspan:"6"},te={class:"text"},se={key:0,class:"has-text-centered nb-task-types"};function ie(e,t,i,l,s,o){const y=n("department-name"),m=n("task-type-cell"),_=n("boolean-cell"),k=n("row-actions-cell"),f=n("draggable"),u=n("table-info");return p(),h("div",U,[a("div",H,[a("table",J,[i.entries.length>0?(p(),h("thead",O,[a("tr",null,[a("th",z,c(e.$t("task_types.fields.department")),1),a("th",F,c(e.$t("task_types.fields.name")),1),a("th",G,c(e.$t("task_types.fields.short_name")),1),a("th",Y,c(e.$t("task_types.fields.allow_timelog")),1),a("th",j,c(e.$t("task_types.fields.description")),1),t[1]||(t[1]=a("th",{scope:"col",class:"actions"},null,-1))])])):T("",!0),d(f,{class:"datatable-body","item-key":"id",tag:"tbody",onEnd:o.updatePriority,modelValue:s.items,"onUpdate:modelValue":t[0]||(t[0]=r=>s.items=r)},w({item:g(({element:r})=>[a("tr",Q,[a("td",W,[o.isEmpty(r.department_id)?T("",!0):(p(),D(y,{key:0,department:e.getDepartment(r.department_id)},null,8,["department"]))]),d(m,{class:"name","task-type":r},null,8,["task-type"]),a("td",X,c(r.short_name),1),d(_,{class:"allow-timelog",value:r.allow_timelog},null,8,["value"]),a("td",null,c(r.description),1),d(k,{"task-type-id":r.id,onDeleteClicked:E=>e.$emit("delete-clicked",r),onEditClicked:E=>e.$emit("edit-clicked",r)},null,8,["task-type-id","onDeleteClicked","onEditClicked"])])]),_:2},[i.entries.length?void 0:{name:"footer",fn:g(()=>[a("tr",Z,[a("th",ee,[a("span",te,c(e.$t("task_types.no_task_types")),1)])])]),key:"0"}]),1032,["onEnd","modelValue"])])]),d(u,{"is-loading":i.isLoading,"is-error":i.isError},null,8,["is-loading","is-error"]),i.entries.length>0?(p(),h("p",se,c(i.entries.length)+" "+c(e.$tc("task_types.number",i.entries.length)),1)):T("",!0)])}const ae=v(K,[["render",ie],["__scopeId","data-v-2c1e7ea8"]]),oe={name:"task-types",components:{DeleteModal:N,EditTaskTypeModal:A,ListPageHeader:B,RouteTabs:q,TaskTypeList:ae},data(){return{activeTab:"active",entityTab:"assets",errors:{taskTypes:!1,departments:!1,edit:!1,del:!1},loading:{taskTypes:!1,departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}],entityTabs:[{name:"assets",label:this.$t("assets.title")},{name:"shots",label:this.$t("shots.title")},{name:"sequences",label:this.$t("sequences.title")},{name:"episodes",label:this.$t("episodes.title")},{name:"edits",label:this.$t("edits.title")}],taskTypeToDelete:{color:"#999999"},taskTypeToEdit:null}},computed:{...C(["archivedTaskTypes","departmentMap","taskTypes"]),forEntity(){return b.capitalize(this.entityTab.substring(0,this.entityTab.length-1))},isActiveTab(){return this.activeTab==="active"},listTaskTypes(){const e=this.isActiveTab?this.taskTypes:this.archivedTaskTypes,t=this.entityTab.substring(0,this.entityTab.length-1);return e.filter(i=>i.for_entity.toLowerCase()===t)}},mounted(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"assets",this.loading.taskTypes=!0,this.errors.taskTypes=!1,this.loading.departments=!0,this.errors.departments=!1,this.loadDepartments().then(()=>{this.loading.departments=!1}).catch(e=>{console.error(e),this.loading.departments=!1,this.errors.departments=!0}),this.loadTaskTypes().then(()=>{this.loading.taskTypes=!1}).catch(e=>{console.error(e),this.loading.taskTypes=!1,this.errors.taskTypes=!0})},methods:{...P(["editTaskType","deleteTaskType","loadTaskTypes","loadDepartments"]),confirmEditTaskType(e){let t="newTaskType";this.taskTypeToEdit&&this.taskTypeToEdit.id&&(t="editTaskType",e.id=this.taskTypeToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,e).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(i=>{console.error(i),this.loading.edit=!1,this.errors.edit=!0})},updatePriorities(e){e.forEach(t=>{this.$store.commit("EDIT_TASK_TYPE_END",t)}),this.savePriorities(e)},savePriorities(e){const t=new Date().getTime();this.lastCall=this.lastCall||0,t-this.lastCall>1e3&&!this.isSaving?(this.lastCall=t,this.isSaving=!0,$.runPromiseMapAsSeries(e,this.editTaskType).then(()=>{this.isSaving=!1,this.newSaveCall&&this.savePriorities(e)})):this.newSaveCall=!0},confirmDeleteTaskType(){this.loading.del=!0,this.errors.del=!1,this.deleteTaskType(this.taskTypeToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},deleteText(){const e=this.taskTypeToDelete;return e?this.$t("task_types.delete_text",{name:e.name}):""},onDeleteClicked(e){this.taskTypeToDelete=e,this.modals.del=!0},onEditClicked(e){this.taskTypeToEdit=e,this.modals.edit=!0},onExportClicked(){const e=b.slugify(this.$t("task_types.title")),i=[[this.$t("main.type"),this.$t("task_types.fields.dedicated_to"),this.$t("task_types.fields.department"),this.$t("task_types.fields.name"),this.$t("task_types.fields.description"),this.$t("task_types.fields.color"),this.$t("task_types.fields.allow_timelog")]].concat(this.taskTypes.map(l=>[l.type,l.for_entity,this.departmentMap.get(l.department_id)?.name,l.name,l.description,l.color,l.allow_timelog]));S.buildCsvFile(e,i)},onNewClicked(){this.taskTypeToEdit={color:"#999999"},this.modals.edit=!0}},watch:{"$route.query"(){this.activeTab=this.$route.query.tab||"active",this.entityTab=this.$route.query.entity||"assets"}},head(){return{title:`${this.$t("task_types.title")} - Kitsu`}}},le={class:"task-types page fixed-page"};function re(e,t,i,l,s,o){const y=n("list-page-header"),m=n("route-tabs"),_=n("task-type-list"),k=n("edit-task-type-modal"),f=n("delete-modal");return p(),h("div",le,[d(y,{title:e.$t("task_types.library_title"),"new-entry-label":e.$t("task_types.new_task_type"),"is-exportable":o.isActiveTab,onExportClicked:o.onExportClicked,onNewClicked:o.onNewClicked},null,8,["title","new-entry-label","is-exportable","onExportClicked","onNewClicked"]),d(m,{class:"mt2","active-tab":s.activeTab,tabs:s.tabs},null,8,["active-tab","tabs"]),d(m,{"active-tab":s.entityTab,tabs:s.entityTabs,"route-key":"entity"},null,8,["active-tab","tabs"]),d(_,{entries:o.listTaskTypes,"is-loading":s.loading.taskTypes||s.loading.departments,"is-error":s.errors.taskTypes||s.errors.departments,onUpdatePriorities:o.updatePriorities,onEditClicked:o.onEditClicked,onDeleteClicked:o.onDeleteClicked},null,8,["entries","is-loading","is-error","onUpdatePriorities","onEditClicked","onDeleteClicked"]),d(k,{active:s.modals.edit,"for-entity":o.forEntity,"is-loading":s.loading.edit,"is-error":s.errors.edit,"task-type-to-edit":s.taskTypeToEdit,onCancel:t[0]||(t[0]=u=>s.modals.edit=!1),onConfirm:o.confirmEditTaskType},null,8,["active","for-entity","is-loading","is-error","task-type-to-edit","onConfirm"]),d(f,{active:s.modals.del,"is-loading":s.loading.del,"is-error":s.errors.del,text:o.deleteText(),"error-text":e.$t("task_types.delete_error"),onCancel:t[1]||(t[1]=u=>s.modals.del=!1),onConfirm:o.confirmDeleteTaskType},null,8,["active","is-loading","is-error","text","error-text","onConfirm"])])}const Ve=v(oe,[["render",re]]);export{Ve as default};
//# sourceMappingURL=TaskTypes-B8_kykSx.js.map
