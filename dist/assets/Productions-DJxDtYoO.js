import{_ as v,aP as M,c5 as V,bQ as O,c6 as B,c7 as L,r as p,o as r,l as h,w as $,c as m,e as s,p as P,d as g,t as i,a4 as j,am as F,ae as I,a6 as U,a8 as A,c8 as T,c9 as N,m as w,k as R,a9 as x,n as q,f as u,s as H,X as z,F as b,g as E,A as D,v as Y,a1 as G,T as K,B as Q,an as W,P as X,b as J}from"./index-a83mlrHR.js";import{U as Z}from"./upload-B8viYZ_L.js";const tt={name:"button-link",components:{DownloadIcon:M,EditIcon:V,PlusIcon:O,RotateCcwIcon:B,TrashIcon:L,UploadIcon:Z},props:{text:{default:"",type:String},title:{default:"",type:String},path:{default:"",type:[String,Object]},icon:{default:"",type:String},isResponsive:{default:!1,type:Boolean}}},ot={key:0,class:"icon is-small"};function et(t,e,o,k,a,n){const _=p("plus-icon"),d=p("download-icon"),f=p("upload-icon"),y=p("edit-icon"),l=p("trash-icon"),c=p("rotate-ccw-icon"),S=p("router-link");return r(),h(S,{class:"button",title:o.title,to:o.path},{default:$(()=>{var C;return[(C=o.icon)!=null&&C.startsWith("fa")?(r(),m("span",ot,[s("i",{class:P(`fa ${o.icon}`)},null,2)])):o.icon==="plus"?(r(),h(_,{key:1,class:"icon is-small"})):o.icon==="download"?(r(),h(d,{key:2,class:"icon is-small"})):o.icon==="upload"?(r(),h(f,{key:3,class:"icon is-small"})):o.icon==="edit"?(r(),h(y,{key:4,class:"icon is-small"})):o.icon==="delete"?(r(),h(l,{key:5,class:"icon is-small"})):o.icon==="restore"?(r(),h(c,{key:6,class:"icon is-small"})):g("",!0),o.text?(r(),m("span",{key:7,class:P(["text",{"is-hidden-touch":o.isResponsive}])},i(o.text),3)):g("",!0)]}),_:1},8,["title","to"])}const st=v(tt,[["render",et]]),it={name:"edit-production-modal",mixins:[j],components:{ComboboxStyled:F,FileUpload:I,ModalFooter:U,TextField:A},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},productionToEdit:{type:Object,required:!0}},emits:["cancel","confirm","fileselected"],data(){return{form:{},formData:null,productionStyleOptions:T,productionTypeOptions:N}},computed:{...w(["productionStatusOptions"])},methods:{runConfirmation(){this.$emit("confirm",this.form)},onFileSelected(t){this.formData=t,this.$emit("fileselected",t)},resetForm(){this.form={name:this.productionToEdit.name,code:this.productionToEdit.code,project_status_id:this.productionToEdit.project_status_id,production_type:this.productionToEdit.production_type||"short",production_style:this.productionToEdit.production_style||"2d3d",fps:this.productionToEdit.fps,ratio:this.productionToEdit.ratio,resolution:this.productionToEdit.resolution}}},watch:{productionToEdit:{immediate:!0,handler(){this.resetForm()}}}},nt={class:"modal-content"},at={class:"box"},lt={class:"title"},dt={class:"label"};function rt(t,e,o,k,a,n){const _=p("text-field"),d=p("combobox-styled"),f=p("file-upload"),y=p("modal-footer"),l=R("focus");return r(),m("div",{class:P(["modal",{"is-active":o.active}])},[s("div",{class:"modal-background",onClick:e[0]||(e[0]=c=>t.$emit("cancel"))}),s("div",nt,[s("div",at,[s("h1",lt,i(t.$t("productions.edit_title"))+" "+i(o.productionToEdit.name),1),s("form",{onSubmit:e[9]||(e[9]=x(()=>{},["prevent"]))},[q(u(_,{label:t.$t("productions.fields.name"),onEnter:n.runConfirmation,modelValue:a.form.name,"onUpdate:modelValue":e[1]||(e[1]=c=>a.form.name=c)},null,8,["label","onEnter","modelValue"]),[[l]]),u(_,{label:t.$t("productions.fields.code"),onEnter:n.runConfirmation,modelValue:a.form.code,"onUpdate:modelValue":e[2]||(e[2]=c=>a.form.code=c)},null,8,["label","onEnter","modelValue"]),u(d,{class:"field",label:t.$t("productions.fields.status"),"locale-key-prefix":"productions.status.",options:t.productionStatusOptions,modelValue:a.form.project_status_id,"onUpdate:modelValue":e[3]||(e[3]=c=>a.form.project_status_id=c)},null,8,["label","options","modelValue"]),u(d,{class:"field",label:t.$t("productions.fields.type"),"locale-key-prefix":"productions.type.",options:a.productionTypeOptions,modelValue:a.form.production_type,"onUpdate:modelValue":e[4]||(e[4]=c=>a.form.production_type=c)},null,8,["label","options","modelValue"]),u(d,{class:"field",label:t.$t("productions.fields.style"),"locale-key-prefix":"productions.style.",options:a.productionStyleOptions,modelValue:a.form.production_style,"onUpdate:modelValue":e[5]||(e[5]=c=>a.form.production_style=c)},null,8,["label","options","modelValue"]),u(_,{label:t.$t("productions.fields.fps"),type:"number",max:60,step:.001,onEnter:n.runConfirmation,modelValue:a.form.fps,"onUpdate:modelValue":e[6]||(e[6]=c=>a.form.fps=c)},null,8,["label","onEnter","modelValue"]),u(_,{label:t.$t("productions.fields.ratio"),onEnter:n.runConfirmation,modelValue:a.form.ratio,"onUpdate:modelValue":e[7]||(e[7]=c=>a.form.ratio=c)},null,8,["label","onEnter","modelValue"]),u(_,{label:t.$t("productions.fields.resolution"),onEnter:n.runConfirmation,modelValue:a.form.resolution,"onUpdate:modelValue":e[8]||(e[8]=c=>a.form.resolution=c)},null,8,["label","onEnter","modelValue"]),s("div",null,[s("label",dt,i(t.$t("productions.picture")),1),u(f,{label:t.$t("main.csv.upload_file"),accept:".png,.jpg,.jpeg",onFileselected:n.onFileSelected},null,8,["label","onFileselected"])])],32),u(y,{"error-text":t.$t("productions.edit_error"),"is-error":o.isError,"is-loading":o.isLoading,onConfirm:n.runConfirmation,onCancel:e[10]||(e[10]=c=>t.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const ct=v(it,[["render",rt],["__scopeId","data-v-4a475e00"]]),ut={name:"production-stats",mixins:[H],components:{TaskTypeName:z},props:{stats:{type:Object,default:()=>{}}},data(){return{expanded:!1}},computed:{...w(["taskStatusMap","taskTypeMap"]),expandable(){var t;return((t=this.stats.task_types)==null?void 0:t.length)>0},statusIds(){return Object.keys(this.statsByStatus).sort((t,e)=>this.taskStatusMap.get(t).priority<this.taskStatusMap.get(e).priority)},taskTypes(){const t={Asset:1,Shot:2,Sequence:3,Episode:4,Edit:5,Concept:6};return Object.keys(this.taskTypeStatsMap).map(e=>this.taskTypeMap.get(e)).sort((e,o)=>e.for_entity!==o.for_entity?t[e.for_entity]>t[o.for_entity]:e.priority>o.priority)},taskTypeStatsMap(){var e;const t={};return(e=this.stats.task_types)==null||e.forEach(o=>{t[o.task_type_id]||(t[o.task_type_id]={task_type_id:o.task_type_id,amount:0,amount_done:0,total_duration:0,total_estimation:0,task_statuses:[]}),t[o.task_type_id].amount+=o.amount,t[o.task_type_id].amount_done+=o.amount_done,t[o.task_type_id].total_duration+=o.total_duration,t[o.task_type_id].total_estimation+=o.total_estimation,t[o.task_type_id].task_statuses.push(o)}),t},statsByStatus(){var e;const t={};return(e=this.stats.task_types)==null||e.forEach(o=>{t[o.task_status_id]||(t[o.task_status_id]=0),t[o.task_status_id]+=o.amount}),t}},methods:{expandStats(){this.expandable&&(this.expanded=!this.expanded)},sortStatuses(t){return t.sort((e,o)=>this.taskStatusMap.get(e.task_status_id).priority<this.taskStatusMap.get(o.task_status_id).priority)}}},pt={class:"nb-tasks"},mt={class:"tag"},_t={class:"tag"},ft={class:"color-wrapper"},ht=["title"],yt={key:0,class:"task-type-stats"},kt={class:"task-type-wrapper flexrow-item"},bt={class:"task-type-wrapper flexrow-item"},gt={class:"task-type-wrapper flexrow-item"},Et={class:"color-wrapper flexrow-item"},vt=["title"];function Pt(t,e,o,k,a,n){const _=p("task-type-name");return r(),m("div",{class:P(["project-stats",{expandable:n.expandable}]),onClick:e[0]||(e[0]=(...d)=>n.expandStats&&n.expandStats(...d))},[s("div",pt,[s("span",mt,i(o.stats.amount_done||0)+" "+i(t.$t("tasks.done"))+" / "+i(o.stats.amount||0)+" "+i(t.$t("tasks.tasks")),1),s("span",_t,i(t.formatDuration(o.stats.total_duration))+" "+i(t.isDurationInHours()?t.$tc("main.hours_spent",t.formatDuration(o.stats.total_duration)):t.$tc("main.days_spent",t.formatDuration(o.stats.total_duration)))+" / "+i(t.formatDuration(o.stats.total_estimation))+" "+i(t.isDurationInHours()?t.$tc("main.hours_estimated",t.formatDuration(o.stats.total_estimation)):t.$tc("main.days_estimated",t.formatDuration(o.stats.total_estimation))),1)]),s("div",ft,[(r(!0),m(b,null,E(n.statusIds,d=>(r(),m("div",{class:"stat",style:D({backgroundColor:t.taskStatusMap.get(d).color,width:`${n.statsByStatus[d]/o.stats.amount*100}%`}),key:d,title:`${t.taskStatusMap.get(d).name} - ${n.statsByStatus[d]} tasks`},null,12,ht))),128))]),a.expanded?(r(),m("div",yt,[(r(!0),m(b,null,E(n.taskTypes,d=>(r(),m("div",{class:"flexrow task-type-stat",key:d.id},[s("div",kt,[u(_,{class:"flexrow-item task-type-name","task-type":d},null,8,["task-type"])]),s("div",bt,i(n.taskTypeStatsMap[d.id].amount_done)+" / "+i(n.taskTypeStatsMap[d.id].amount)+" "+i(t.$t("tasks.tasks")),1),s("div",gt,i(t.formatDuration(n.taskTypeStatsMap[d.id].total_duration))+" / "+i(t.formatDuration(n.taskTypeStatsMap[d.id].total_estimation))+" "+i(t.$tc("main.days")),1),s("div",Et,[(r(!0),m(b,null,E(n.sortStatuses(n.taskTypeStatsMap[d.id].task_statuses),f=>(r(),m("div",{class:"stat",style:D({backgroundColor:t.taskStatusMap.get(f.task_status_id).color,width:`${n.statsByStatus[f.task_status_id]/n.taskTypeStatsMap[d.id].amount*100}%`}),key:d.id+f.task_status_id,title:`${t.taskStatusMap.get(f.task_status_id).name} - ${f.amount} tasks`},null,12,vt))),128))])]))),128))])):g("",!0)],2)}const wt=v(ut,[["render",Pt],["__scopeId","data-v-548d64df"]]),St={name:"production-list",props:{entries:{type:Array,default:()=>[]},productionStats:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{ProductionNameCell:Y,ProductionStats:wt,RowActionsCell:G,TableInfo:K},emits:["delete-clicked","edit-clicked"],computed:{...w(["openProductions","lastProductionScreen"]),closedProductions(){return this.entries.filter(t=>t.project_status_name==="Closed")},productionStatsMap(){return this.productionStats}},methods:{getStatusLocale(t){return{Active:"productions.status.open",Open:"productions.status.open",Closed:"productions.status.closed"}[t]},getProductionStyleLabel(t){var e;return(e=T.find(o=>o.value===t))==null?void 0:e.label}}},Ct={class:"data-list"},Dt={class:"datatable-wrapper"},Tt={class:"datatable multi-section"},Mt={class:"datatable-head"},Vt={scope:"col",class:"name datatable-row-header"},Ot={scope:"col",class:"code"},Bt={scope:"col",class:"type"},Lt={scope:"col",class:"style"},$t={scope:"col",class:"fps"},jt={scope:"col",class:"ratio"},Ft={scope:"col",class:"resolution"},It={class:"datatable-body"},Ut={class:"datatable-type-header"},At={scope:"rowgroup",colspan:"6"},Nt={class:"datatable-row-header"},Rt={class:"datatable-row"},xt={class:"name datatable-row-header",scope:"row"},qt={class:"code"},Ht={class:"type"},zt={class:"style"},Yt={class:"fps"},Gt={class:"ratio"},Kt={class:"resolution"},Qt={key:0,class:"datatable-row"},Wt={colspan:7,class:"datatable-row-stats"},Xt={key:0},Jt={class:"datatable-type-header"},Zt={scope:"rowgroup",colspan:"6"},to={class:"datatable-row-header"},oo={class:"name datatable-row-header",scope:"row"},eo={class:"code"},so={class:"type"},io={class:"style"},no={class:"fps"},ao={class:"ratio"},lo={class:"resolution"},ro={class:"has-text-centered nb-productions"};function co(t,e,o,k,a,n){const _=p("production-name-cell"),d=p("row-actions-cell"),f=p("production-stats"),y=p("table-info");return r(),m("div",Ct,[s("div",Dt,[s("table",Tt,[s("thead",Mt,[s("tr",null,[s("th",Vt,i(t.$t("productions.fields.name")),1),s("th",Ot,i(t.$t("productions.fields.code")),1),s("th",Bt,i(t.$t("productions.fields.type")),1),s("th",Lt,i(t.$t("productions.fields.style")),1),s("th",$t,i(t.$t("productions.fields.fps")),1),s("th",jt,i(t.$t("productions.fields.ratio")),1),s("th",Ft,i(t.$t("productions.fields.resolution")),1),e[0]||(e[0]=s("th",{scope:"col",class:"actions"},null,-1))])]),s("tbody",It,[s("tr",Ut,[s("th",At,[s("span",Nt,i(t.$t("productions.status.open")),1)])]),(r(!0),m(b,null,E(t.openProductions,l=>(r(),m(b,{key:l.id},[s("tr",Rt,[s("th",xt,[u(_,{"with-avatar":!0,entry:l,"last-production-screen":t.lastProductionScreen},null,8,["entry","last-production-screen"])]),s("td",qt,i(l.code),1),s("td",Ht,i(t.$t(`productions.type.${l.production_type||"short"}`)),1),s("td",zt,i(t.$t(`productions.style.${n.getProductionStyleLabel(l.production_style)||"2d3d"}`)),1),s("td",Yt,i(l.fps),1),s("td",Gt,i(l.ratio),1),s("td",Kt,i(l.resolution),1),u(d,{"entry-id":l.id,onEditClicked:c=>t.$emit("edit-clicked",l),"hide-delete":!0},null,8,["entry-id","onEditClicked"])]),Object.keys(o.productionStats).length>0?(r(),m("tr",Qt,[s("td",Wt,[u(f,{stats:n.productionStatsMap[l.id]||{}},null,8,["stats"])])])):g("",!0)],64))),128))]),n.closedProductions.length>0?(r(),m("tbody",Xt,[s("tr",Jt,[s("th",Zt,[s("span",to,i(t.$t("productions.status.closed")),1)])]),(r(!0),m(b,null,E(n.closedProductions,l=>(r(),m("tr",{class:"datatable-row",key:l.id},[s("th",oo,[u(_,{"with-avatar":!0,entry:l,"last-production-screen":t.lastProductionScreen,"is-link":!1},null,8,["entry","last-production-screen"])]),s("td",eo,i(l.code),1),s("td",so,i(t.$t(`productions.type.${l.production_type||"short"}`)),1),s("td",io,i(t.$t(`productions.style.${n.getProductionStyleLabel(l.production_style)||"2d3d"}`)),1),s("td",no,i(l.fps),1),s("td",ao,i(l.ratio),1),s("td",lo,i(l.resolution),1),u(d,{"entry-id":l.id,onEditClicked:c=>t.$emit("edit-clicked",l),onDeleteClicked:c=>t.$emit("delete-clicked",l)},null,8,["entry-id","onEditClicked","onDeleteClicked"])]))),128))])):g("",!0)])]),u(y,{"is-loading":o.isLoading,"is-error":o.isError},null,8,["is-loading","is-error"]),s("p",ro,i(o.entries.length)+" "+i(t.$tc("productions.number",o.entries.length)),1)])}const uo=v(St,[["render",co],["__scopeId","data-v-975712f3"]]),po={name:"productions",components:{ButtonLink:st,ButtonSimple:Q,HardDeleteModal:W,EditProductionModal:ct,PageTitle:X,ProductionList:uo},data(){return{errors:{del:!1,edit:!1},loading:{del:!1,edit:!1,stats:!1},modals:{isEditDisplayed:!1,isDeleteDisplayed:!1},productionStats:{},productionToDelete:null,productionToEdit:null}},computed:{...w(["isProductionsLoading","isProductionsLoadingError","productionAvatarFormData","productions"]),currentLockText(){var t;return((t=this.productionToDelete)==null?void 0:t.name)||""}},async created(){await this.loadProductions()},methods:{...J(["deleteProduction","loadProductions","loadProductionStats","storeProductionPicture","uploadProductionAvatar"]),confirmEditProduction(t){let e="newProduction";const o=this.productionToEdit&&this.productionToEdit.id;o&&(e="editProduction",t.id=this.productionToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(e,t).then(()=>o&&this.productionAvatarFormData?this.uploadProductionAvatar(t.id):Promise.resolve()).then(()=>{this.modals.isEditDisplayed=!1,this.loading.edit=!1}).catch(k=>{console.error(k),this.loading.edit=!1,this.errors.edit=!0})},confirmDeleteProduction(){this.loading.del=!0,this.errors.del=!1,this.deleteProduction(this.productionToDelete).then(()=>{this.modals.isDeleteDisplayed=!1,this.loading.del=!1}).catch(t=>{console.error(t),this.errors.del=!0,this.loading.del=!1})},deleteText(){const t=this.productionToDelete;return t?this.$t("productions.delete_text",{name:t.name}):""},onEditClicked(t){this.productionToEdit=t,this.modals.isEditDisplayed=!0},onDeleteClicked(t){this.productionToDelete=t,this.modals.isDeleteDisplayed=!0},onProductionPictureSelected(t){this.storeProductionPicture(t)},async reloadStats(){this.loading.stats=!0,this.productionStats=await this.loadProductionStats(),this.loading.stats=!1}},head(){return{title:`${this.$t("productions.title")} - Kitsu`}}},mo={class:"productions page fixed-page"},_o={class:"flexrow page-header"};function fo(t,e,o,k,a,n){const _=p("page-title"),d=p("button-simple"),f=p("button-link"),y=p("production-list"),l=p("edit-production-modal"),c=p("hard-delete-modal");return r(),m("div",mo,[s("div",_o,[u(_,{class:"filler",text:t.$t("productions.title")},null,8,["text"]),u(d,{class:"flexrow-item",text:t.$t("productions.load_stats"),"is-loading":a.loading.stats,onClick:n.reloadStats},null,8,["text","is-loading","onClick"]),u(f,{class:"flexrow-item",text:t.$t("productions.new_production"),icon:"plus",path:{name:"new-production"}},null,8,["text"])]),u(y,{entries:t.productions,"production-stats":a.productionStats,"is-loading":t.isProductionsLoading,"is-error":t.isProductionsLoadingError,onDeleteClicked:n.onDeleteClicked,onEditClicked:n.onEditClicked},null,8,["entries","production-stats","is-loading","is-error","onDeleteClicked","onEditClicked"]),a.modals.isEditDisplayed?(r(),h(l,{key:0,active:"","is-loading":a.loading.edit,"is-error":a.errors.edit,"production-to-edit":a.productionToEdit,onCancel:e[0]||(e[0]=S=>a.modals.isEditDisplayed=!1),onFileselected:n.onProductionPictureSelected,onConfirm:n.confirmEditProduction},null,8,["is-loading","is-error","production-to-edit","onFileselected","onConfirm"])):g("",!0),u(c,{active:a.modals.isDeleteDisplayed,"is-loading":a.loading.del,"is-error":a.errors.del,text:n.deleteText(),"error-text":t.$t("productions.delete_error"),"lock-text":n.currentLockText,onCancel:e[1]||(e[1]=S=>a.modals.isDeleteDisplayed=!1),onConfirm:n.confirmDeleteProduction},null,8,["active","is-loading","is-error","text","error-text","lock-text","onConfirm"])])}const ko=v(po,[["render",fo]]);export{ko as default};
//# sourceMappingURL=Productions-DJxDtYoO.js.map
