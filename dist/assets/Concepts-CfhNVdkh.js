import{_ as b,B as T,r as n,o as l,c as d,d as a,h as m,f as c,t as u,g as F,F as D,e as w,n as x,a as M,p as B,u as V,s as I,l as A,b as E}from"./index-Dw-uod2x.js";import{s as P}from"./search-CWIHq9c3.js";import{d as L}from"./dom-tO7tlkHV.js";import{f as N}from"./EmojiButton-BTNSPSu1.js";import{A as Q}from"./PreviewPlayer-Dm_ANgjQ.js";import{C as O}from"./Combobox-Z_ENhFXj.js";import{C as U}from"./ComboboxStatus-DknHLATL.js";import{C as G}from"./ConceptCard-Djt1l46Z.js";import{P as K}from"./PeopleField-Dk8dxPgh.js";import{S as q}from"./SearchField-B9agWdMK.js";import{T as z}from"./TableInfo-BOYXFWEz.js";import R from"./TaskInfo-r8aZr1NT.js";import"./FileUpload-Cng9V_As.js";import"./PlaylistPlayer-B4BWqUJa.js";import"./ComboboxSimple-Vf48mrbl.js";import"./ComboboxTaskType-DmSe2PuZ.js";import"./TaskTypeName-CzX-aVdj.js";import"./ModalFooter-Dmgqo0ae.js";import"./TextField-EpYNDuEI.js";import"./video-Yn96Kb74.js";import"./clipboard-CQqgyZ_h.js";import"./ComboboxStyled-DrFBZe-s.js";import"./DeleteModal-D5nitPJZ.js";import"./index-C15PprjC.js";import"./BaseModal-CUMx-WEe.js";import"./ComboboxDepartment-DQ8ZI2WM.js";import"./DepartmentName-kmEXEkam.js";import"./ComboboxStudio-D4rrWH2h.js";import"./play-qfd1WDm6.js";import"./render-GdzifLjz.js";import"./string-B0Tq569e.js";import"./ConfirmModal-DnlSFX-8.js";import"./triangle-alert-D6jyW-fK.js";import"./ValidationTag-Dmpl-p74.js";import"./thumbs-up-Dziai4S2.js";import"./copy-C1lXCnZO.js";import"./vue.esm-bundler-44hZGVEk.js";import"./VideoViewer-C7DK8vtH.js";import"./EntityPreview-B9hRFvM0.js";import"./eye-ByTwqQRj.js";import"./csv-Dt0ViJ8m.js";import"./BuildFilterModal-AsQyG_6U.js";import"./ComboboxBoolean-DeubScUy.js";import"./DeleteEntities-DujJJYkA.js";import"./HardDeleteModal-BWVmHjcR.js";import"./corner-right-up-ZAfxlICJ.js";const X={name:"concepts",mixins:[P,L],components:{AddPreviewModal:Q,ButtonSimple:T,Combobox:O,ComboboxStatus:U,ConceptCard:G,PeopleField:K,SearchField:q,TableInfo:z,TaskInfo:R},data(){return{imgExtensions:N.IMG_EXTENSIONS_STRING,isDraggingFile:!1,loading:{addingConcept:!1,loadingConcepts:!1,savingSearch:!1},errors:{addingConcept:!1,loadingConcepts:!1},filters:{entityType:null,publisher:null,sortBy:"created_at",taskStatusId:null},form:{file:null},modals:{addConcept:!1},conceptSearchQueries:[{id:"filter-test-1",list_type:"concept",name:"test",search_query:"test"}]}},mounted(){},computed:{...E(["concepts","currentProduction","isDarkTheme","isTVShow","personMap","selectedConcepts","taskStatusMap"]),assetMap(){return A.cache.assetMap},publishers(){const e=new Map;return this.filteredConcepts.forEach(t=>{const i=t.created_by;if(!e.has(i)){const p=this.personMap.get(i);p&&e.set(i,p)}}),I([...e.values()])},currentTask(){return this.currentConcept?.tasks?.[0]},currentConcept(){return this.selectedConcepts.size===1?this.selectedConcepts.values().next().value:null},entityTypeOptions(){const e={label:this.$t("main.all"),value:null},t=["assets","shots","sequences","edits","episodes"].map(i=>({label:this.$t(`${i}.title`),value:i}));return[e].concat(t)},sortByOptions(){return["created_at","updated_at","last_comment_date"].map(e=>({label:e,value:e}))},filteredConcepts(){let e=[...this.concepts];return this.filters.taskStatusId&&(e=e.filter(t=>t.tasks[0].task_status_id===this.filters.taskStatusId)),this.filters.publisher&&(e=e.filter(t=>t.created_by===this.filters.publisher.id)),this.filters.entityType&&(e=e.filter(t=>t.tags?.some(i=>i.type===this.filters.entityType))),e.sort(V.firstBy(this.filters.sortBy,-1).thenBy("created_at",-1))},searchField(){return this.$refs["search-field"]},taskStatusList(){const e={id:null,color:"#999",name:this.$t("main.all"),short_name:this.$t("main.all")},t=B(Array.from(this.taskStatusMap.values()).filter(i=>i.for_concept));return[e].concat(t)}},methods:{...M(["addSelectedConcepts","addSelectedTask","clearSelectedConcepts","clearSelectedTasks","loadAssets","loadConcepts","newConcepts","setCurrentEpisode"]),setConceptSearch:e=>Promise.resolve(),saveConceptSearch:e=>Promise.resolve(),removeConceptSearch:e=>Promise.resolve(),setSearch(e){this.searchField.setValue(e)},onSearchChange(){const e=this.searchField.getValue()||"";e?.length!==1&&this.setConceptSearch(e),this.setSearchInUrl()},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveConceptSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeConceptSearch(e).catch(t=>{t&&console.error(t)})},async refreshConcepts(){this.loading.loadingConcepts=!0;try{this.isTVShow&&this.setCurrentEpisode("all"),await this.loadAssets({all:!0}),await this.loadConcepts()}catch(e){console.error(e),this.errors.loadingConcepts=!0}finally{this.loading.loadingConcepts=!1}},isSelected(e){return this.selectedConcepts.has(e.id)},onSelectConcept(e,t=!1){const i=t?new Map(this.selectedConcepts):new Map;t&&this.isSelected(e)||!t&&e===this.currentConcept?i.delete(e.id):i.set(e.id,e),this.clearSelectedConcepts(),this.addSelectedConcepts(i),this.clearSelectedTasks(),this.currentTask&&this.addSelectedTask(this.currentTask)},openAddConceptModal(){this.modals.addConcept=!0},closeAddConceptModal(){this.modals.addConcept=!1},async confirmAddConceptModal(e){this.loading.addingConcept=!0;try{await this.newConcepts(e),this.closeAddConceptModal()}catch(t){console.error(t),this.errors.addingConcept=!0}finally{this.loading.addingConcept=!1}},reset(){this.clearSelectedConcepts(),this.clearSelectedTasks(),this.refreshConcepts()},onFileDrop(e){this.pauseEvent(e);const t=e.dataTransfer.files;this.modals.addConcept=!0,this.isDraggingFile=!1,this.$nextTick(()=>{this.$refs["add-preview-modal"].setFiles(t)})},onFileDragover(e){this.pauseEvent(e),this.isDraggingFile=!0},onFileDragLeave(){this.isDraggingFile=!1}},watch:{currentProduction:{immediate:!0,handler(){const e=this.$route.params.production_id;this.currentProduction?.id===e&&this.reset()}}},socket:{events:{"task:status-changed"(e){const t=this.concepts.find(i=>i.tasks[0].id===e.task_id);t&&(t.tasks[0].task_status_id=e.new_task_status_id)}}},head(){return{title:`${this.currentProduction.name} | ${this.$t("concepts.title")} - Kitsu`}}},j={class:"fixed-page columns"},H={class:"column main-column"},J={class:"concepts page"},W={class:"page-header"},Y={class:"filters"},Z={class:"field"},$={class:"label"},ee={class:"items"},te=["onClick"],se={key:2,class:"has-text-centered mb1 mt1 empty-concepts"},oe={class:"footer mb2"},ie={class:"column side-column"};function re(e,t,i,p,r,s){n("search-field");const f=n("combobox-status"),C=n("people-field"),g=n("combobox"),_=n("table-info"),y=n("concept-card"),k=n("button-simple"),S=n("add-preview-modal"),v=n("task-info");return l(),d("div",j,[a("div",H,[a("div",J,[a("div",W,[a("div",Y,[m("",!0),c(f,{label:e.$t("main.status"),"task-status-list":s.taskStatusList,modelValue:r.filters.taskStatusId,"onUpdate:modelValue":t[0]||(t[0]=o=>r.filters.taskStatusId=o)},null,8,["label","task-status-list","modelValue"]),a("span",Z,[a("label",$,u(e.$t("concepts.fields.publisher")),1),c(C,{small:"",people:s.publishers,modelValue:r.filters.publisher,"onUpdate:modelValue":t[1]||(t[1]=o=>r.filters.publisher=o)},null,8,["people","modelValue"])]),m("",!0),c(g,{class:"right",label:e.$t("main.sorted_by"),"locale-key-prefix":"concepts.fields.",options:s.sortByOptions,modelValue:r.filters.sortBy,"onUpdate:modelValue":t[3]||(t[3]=o=>r.filters.sortBy=o)},null,8,["label","options","modelValue"])])]),r.loading.loadingConcepts||r.errors.loadingConcepts?(l(),F(_,{key:0,"is-loading":r.loading.loadingConcepts,"is-error":r.errors.loadingConcepts},null,8,["is-loading","is-error"])):s.filteredConcepts?.length?(l(),d("div",{key:1,ref:"concept-list",class:"concept-list pb1",onDragover:t[7]||(t[7]=(...o)=>s.onFileDragover&&s.onFileDragover(...o))},[r.isDraggingFile?(l(),d("div",{key:0,class:"drop-mask",onDrop:t[4]||(t[4]=(...o)=>s.onFileDrop&&s.onFileDrop(...o)),onDragover:t[5]||(t[5]=(...o)=>s.onFileDragover&&s.onFileDragover(...o)),onDragleave:t[6]||(t[6]=(...o)=>s.onFileDragLeave&&s.onFileDragLeave(...o))},u(e.$t("concepts.drop_new_concepts")),33)):m("",!0),a("ul",ee,[(l(!0),d(D,null,w(s.filteredConcepts,o=>(l(),d("li",{class:x(["item",{"selected-item":s.isSelected(o)}]),key:o.id,onClick:h=>s.onSelectConcept(o,h.ctrlKey||h.metaKey)},[c(y,{concept:o},null,8,["concept"])],10,te))),128))])],544)):(l(),d("div",se,[a("strong",null,u(e.$t("concepts.empty")),1)])),a("div",oe,[c(k,{class:"upload-button",disabled:r.loading.loadingConcepts,text:e.$t("concepts.add_new_concept"),onClick:s.openAddConceptModal},null,8,["disabled","text","onClick"])])])]),c(S,{ref:"add-preview-modal",active:r.modals.addConcept,extensions:r.imgExtensions,"is-concept":"","is-error":r.errors.addingConcept,"is-loading":r.loading.addingConcept,message:"",onCancel:s.closeAddConceptModal,onConfirm:s.confirmAddConceptModal},null,8,["active","extensions","is-error","is-loading","onCancel","onConfirm"]),a("div",ie,[c(v,{"entity-type":"Concept",task:s.currentTask,"with-actions":""},null,8,["task"])])])}const Ze=b(X,[["render",re],["__scopeId","data-v-549c84ff"]]);export{Ze as default};
//# sourceMappingURL=Concepts-CfhNVdkh.js.map
