import{_ as C,ae as w,af as v,b as L,r as p,o as a,c as r,d as o,t as n,F as m,e as S,i as T,g,w as M,H as A,h as u,f as c,B as P,J as V,a as E}from"./index-DF-DoQlt.js";import{c as D}from"./csv-IlynXFQz.js";import{s as B}from"./string-B0Tq569e.js";import{s as x}from"./search-CWIHq9c3.js";import{C as U}from"./Combobox-A6pnhVs3.js";import{e as F}from"./entity_list-D-byES5y.js";import{S as N}from"./StatsCell-roFO7v77.js";import{T as Y}from"./TableInfo-D6xnVb4C.js";import{_ as k}from"./empty_asset-CsDXgViP.js";import{S as H}from"./SearchField-BdP8lRoc.js";const O={name:"production-asset-type-list",mixins:[F],props:{displayMode:{type:String,default:"pie"},entries:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},assetTypeStats:{type:Object,default:()=>{}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]}},components:{StatsCell:N,TableInfo:Y},computed:{...L(["assetTypeSearchText","currentEpisode","currentProduction","displayedAssetTypesLength","isCurrentUserClient","isTVShow","taskTypeMap"]),isEmptyList(){return this.entries&&this.entries.length===0&&!this.isLoading&&!this.isError&&(!this.assetTypeSearchText||this.assetTypeSearchText.length===0)}},methods:{chartColors(s,t){return v(this.assetTypeStats,s,t)},chartData(s,t){return w(this.assetTypeStats,s,t)},isStats(s,t){return this.assetTypeStats[s]&&this.assetTypeStats[s][t]},onHeaderScroll(s,t){this.$refs.tableWrapper.scrollLeft=t.scrollLeft},taskTypePath(s){const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:s,type:"assets"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t}}},j={class:"data-list"},z={class:"datatable"},G={class:"datatable-head"},J={scope:"col",class:"name datatable-row-header"},K={scope:"col",class:"validation"},Q=["title"],R={key:0,class:"datatable-body"},W={key:0,class:"all-line datatable-row"},q={scope:"row",class:"name datatable-row-header"},X={scope:"row",class:"name datatable-row-header"},Z={key:1},$={key:0,class:"has-text-centered"},I={class:"info"},ss={key:1,class:"has-text-centered"},ts={class:"info"},es={key:2,class:"has-text-centered nb-asset-types"};function as(s,t,l,b,h,i){const _=p("router-link"),y=p("stats-cell"),f=p("table-info");return a(),r("div",j,[o("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:t[0]||(t[0]=(...e)=>s.onBodyScroll&&s.onBodyScroll(...e))},[o("table",z,[o("thead",G,[o("tr",null,[o("th",J,n(s.$t("asset_types.fields.name")),1),o("th",K,n(s.$t("main.all")),1),l.isLoading?u("",!0):(a(!0),r(m,{key:0},S(l.validationColumns,e=>(a(),r("th",{scope:"col",class:"validation validation-cell",key:e},[o("div",{class:"flexrow validation-content",style:T(s.getValidationStyle(e))},[s.isCurrentUserClient?(a(),r("span",{key:1,class:"flexrow-item ellipsis",title:s.taskTypeMap.get(e).name},n(s.taskTypeMap.get(e).name),9,Q)):(a(),g(_,{key:0,class:"flexrow-item ellipsis",title:s.taskTypeMap.get(e).name,to:i.taskTypePath(e)},{default:M(()=>[A(n(s.taskTypeMap.get(e).name),1)]),_:2},1032,["title","to"]))],4)]))),128)),t[1]||(t[1]=o("th",{scope:"col",class:"actions"},null,-1))])]),l.isLoading?u("",!0):(a(),r("tbody",R,[l.showAll&&!i.isEmptyList?(a(),r("tr",W,[o("th",q,n(s.$t("asset_types.all_asset_types")),1),c(y,{colors:i.chartColors("all","all"),data:i.chartData("all","all"),"display-mode":l.displayMode},null,8,["colors","data","display-mode"]),(a(!0),r(m,null,S(l.validationColumns,e=>(a(),g(y,{style:T(s.getValidationStyle(e)),key:"all-"+e,colors:i.chartColors("all",e),data:i.chartData("all",e),"display-mode":l.displayMode},null,8,["style","colors","data","display-mode"]))),128)),t[2]||(t[2]=o("td",{class:"actions"},null,-1))])):u("",!0),(a(!0),r(m,null,S(l.entries,e=>(a(),r("tr",{class:"datatable-row",key:e.id},[o("td",X,n(e.name),1),i.isStats(e.id,"all")?(a(),g(y,{key:0,colors:i.chartColors(e.id,"all"),data:i.chartData(e.id,"all"),"display-mode":l.displayMode},null,8,["colors","data","display-mode"])):(a(),r("td",Z)),(a(!0),r(m,null,S(l.validationColumns,d=>(a(),r(m,{key:e.id+"-"+d},[i.isStats(e.id,d)?(a(),g(y,{key:e.id+d,style:T(s.getValidationStyle(d)),colors:i.chartColors(e.id,d),data:i.chartData(e.id,d),"display-mode":l.displayMode},null,8,["style","colors","data","display-mode"])):(a(),r("td",{key:1,style:T(s.getValidationStyle(d))},null,4))],64))),128)),t[3]||(t[3]=o("td",{class:"actions"},null,-1))]))),128))]))])],544),c(f,{"is-loading":l.isLoading,"is-error":l.isError},null,8,["is-loading","is-error"]),i.isEmptyList&&!s.isCurrentUserClient&&!l.isLoading?(a(),r("div",$,[t[4]||(t[4]=o("p",{class:"info"},[o("img",{src:k})],-1)),o("p",I,n(s.$t("assets.empty_list")),1)])):u("",!0),i.isEmptyList&&s.isCurrentUserClient&&!l.isLoading?(a(),r("div",ss,[t[5]||(t[5]=o("p",{class:"info"},[o("img",{src:k})],-1)),o("p",ts,n(s.$t("assets.empty_list_client")),1)])):u("",!0),!i.isEmptyList&&!l.isLoading?(a(),r("p",es,n(s.displayedAssetTypesLength)+" "+n(s.$tc("asset_types.number",s.displayedAssetTypesLength)),1)):u("",!0)])}const is=C(O,[["render",as],["__scopeId","data-v-c75590b4"]]),os={name:"production-asset-types",mixins:[x],components:{ButtonSimple:P,Combobox:U,ProductionAssetTypeList:is,SearchField:H},data(){return{initialLoading:!0,displayMode:"pie",displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}]}},computed:{...L(["assetTypeMap","assetTypeStats","assetTypeSearchText","assetTypeListScrollPosition","assetValidationColumns","currentEpisode","currentProduction","displayedAssetTypes","isAssetsLoading","isAssetsLoadingError","isTVShow","taskStatusMap","taskTypeMap"]),searchField(){return this.$refs["asset-type-search-field"]}},mounted(){this.setDefaultSearchText(),this.setDefaultListScrollPosition(),setTimeout(()=>{this.reset()},100)},methods:{...E(["computeAssetTypeStats","initAssetTypes","loadAssets","setAssetTypeSearch","setAssetTypeListScrollPosition","setLastProductionScreen"]),setDefaultSearchText(){this.assetTypeSearchText&&this.$refs["asset-type-search-field"].setValue(this.assetTypeSearchText)},setDefaultListScrollPosition(){this.$refs["asset-type-list"].setScrollPosition(this.assetTypeListScrollPosition)},onSearchChange(){const s=this.$refs["asset-type-search-field"]?.getValue();this.setAssetTypeSearch(s),this.setSearchInUrl(s)},saveScrollPosition(s){this.setAssetTypeListScrollPosition(s)},exportStatisticsToCsv(){const s=[V().format("YYYYMMDD"),this.currentProduction.name,"asset_types","statistics"];this.currentEpisode&&s.splice(2,0,this.currentEpisode.name);const t=B.slugify(s.join("_"));D.generateStatReports(t,this.assetTypeStats,this.taskTypeMap,this.taskStatusMap,this.assetTypeMap,this.countMode,this.currentProduction)},reset(){this.initialLoading=!0,this.loadAssets().then(()=>{this.computeAssetTypeStats(),this.setAssetTypeListScrollPosition(0),this.initialLoading=!1,this.setSearchFromUrl(),this.onSearchChange()})}},watch:{currentProduction(){this.isTVShow||this.reset()},currentEpisode(){this.isTVShow&&this.reset()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("asset_types.production_title")} - Kitsu`}}},ls={class:"asset-types page fixed-page"},rs={class:"asset-type-list-header page-header flexrow"};function ns(s,t,l,b,h,i){const _=p("search-field"),y=p("combobox"),f=p("button-simple"),e=p("production-asset-type-list");return a(),r("div",ls,[o("div",rs,[c(_,{class:"flexrow-item mt1",ref:"asset-type-search-field",onChange:i.onSearchChange,placeholder:"ex: chars, agent327"},null,8,["onChange"]),c(y,{class:"mb0 flexrow-item",label:s.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:h.displayModeOptions,modelValue:h.displayMode,"onUpdate:modelValue":t[0]||(t[0]=d=>h.displayMode=d)},null,8,["label","options","modelValue"]),t[1]||(t[1]=o("span",{class:"filler"},null,-1)),c(f,{class:"flexrow-item",icon:"refresh",title:s.$t("main.reload"),onClick:i.reset},null,8,["title","onClick"]),c(f,{class:"flexrow-item",icon:"download",onClick:i.exportStatisticsToCsv},null,8,["onClick"])]),c(e,{ref:"asset-type-list",entries:s.displayedAssetTypes,"is-loading":s.isAssetsLoading||h.initialLoading,"is-error":s.isAssetsLoadingError,"validation-columns":s.assetValidationColumns,"asset-type-stats":s.assetTypeStats,"display-mode":h.displayMode,"show-all":!s.assetTypeSearchText,onScroll:i.saveScrollPosition},null,8,["entries","is-loading","is-error","validation-columns","asset-type-stats","display-mode","show-all","onScroll"])])}const gs=C(os,[["render",ns]]);export{gs as default};
//# sourceMappingURL=ProductionAssetTypes-XZEoU6sS.js.map
