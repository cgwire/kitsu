import{l as d,o as m,p as c,c as f,b8 as p,M as T,m as l,n as r,t as h,a as _,u as y,v as k}from"./index-jDY-gGts.js";import{L as v}from"./ListPageHeader-BZm25myS.js";import{R as b}from"./RouteTabs-CQ0N22S3.js";import{S as E}from"./StatusAutomationList-B53a_eDx.js";import"./TaskStatusCell-DqtX3ipx.js";const $={name:"edit-status-automation-modal",mixins:[d],components:{Combobox:m,ComboboxBoolean:c,ComboboxStatus:f,ComboboxTaskType:p,ModalFooter:T},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},statusAutomationToEdit:{type:Object,default:()=>{}},taskStatus:{type:Object,default:()=>{}}},data(){return{entityTypeOptions:[{label:"asset",value:"asset"},{label:"shot",value:"shot"}],fieldTypeOptions:[{label:"status",value:"status"},{label:"ready_for",value:"ready_for"}],form:{entityType:"asset",outFieldType:"status",inEntityTaskTypes:[],outEntityTaskTypes:[],inTaskTypeId:"",outTaskTypeId:"",inTaskStatusId:"",outTaskStatusId:""}}},computed:{...l(["statusAutomations","statusAutomationsStatusOptions","assetTaskTypes","shotTaskTypes","taskStatuses"]),taskStatusList(){return this.taskStatuses.filter(s=>!s.for_concept)},isEditing(){var s;return(s=this.statusAutomationToEdit)==null?void 0:s.id}},methods:{confirmClicked(){this.$emit("confirm",this.form)},setTaskTypes(s){s==="asset"?(this.form.inEntityTaskTypes=this.assetTaskTypes,this.form.outFieldType==="status"?this.form.outEntityTaskTypes=this.assetTaskTypes:this.form.outEntityTaskTypes=this.shotTaskTypes):s==="shot"&&(this.form.inEntityTaskTypes=this.shotTaskTypes,this.form.outFieldType="status",this.form.outEntityTaskTypes=this.shotTaskTypes)}},watch:{statusAutomationToEdit(){if(this.statusAutomationToEdit){let s=[];this.form.entityType==="asset"?s=this.assetTaskTypes:this.form.entityType==="shot"&&(s=this.shotTaskTypes),this.form={entityType:this.isEditing?this.statusAutomationToEdit.entity_type:"asset",inEntityTaskTypes:s,outEntityTaskTypes:s,inTaskTypeId:this.isEditing?this.statusAutomationToEdit.in_task_type_id:s[0].id,inTaskStatusId:this.isEditing?this.statusAutomationToEdit.in_task_status_id:this.taskStatusList[0].id,outFieldType:this.isEditing?this.statusAutomationToEdit.out_field_type:"status",outTaskTypeId:this.isEditing?this.statusAutomationToEdit.out_task_type_id:s[1].id,outTaskStatusId:this.isEditing?this.statusAutomationToEdit.out_task_status_id:this.taskStatusList[1].id,archived:this.isEditing?String(this.statusAutomationToEdit.archived===!0):"false"}}},"form.entityType":function(s){this.setTaskTypes(s),this.isEditing||(this.form.inTaskTypeId=this.form.inEntityTaskTypes[0].id,this.form.inTaskStatusId=this.taskStatusList[0].id,this.form.outTaskTypeId=this.form.outEntityTaskTypes[1].id,this.form.outTaskStatusId=this.taskStatusList[1].id)},"form.outFieldType":function(s){s==="ready_for"?(this.form.outEntityTaskTypes=this.shotTaskTypes,this.form.outTaskTypeId=this.shotTaskTypes[1].id):s==="status"&&(this.setTaskTypes(this.form.entityType),this.form.outTaskTypeId=this.form.outEntityTaskTypes[1].id)}}};var S=function(){var t=this,a=t._self._c;return a("div",{class:{modal:!0,"is-active":t.active}},[a("div",{staticClass:"modal-background",on:{click:function(e){return t.$emit("cancel")}}}),a("div",{staticClass:"modal-content"},[a("div",{staticClass:"box"},[t.isEditing?a("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("status_automations.edit_title"))+" ")]):a("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("status_automations.new_status_automation"))+" ")]),a("form",{on:{submit:function(e){e.preventDefault()}}},[a("h3",{staticClass:"subtitle"},[t._v(t._s(t.$t("status_automations.entity_title")))]),t.isEditing?a("span",{staticClass:"entity-type-name"},[t._v(" "+t._s(t.form.entityType)+" ")]):a("combobox",{attrs:{label:t.$t("status_automations.fields.entity_type"),options:t.entityTypeOptions,"locale-key-prefix":"status_automations.entity_types."},on:{enter:t.confirmClicked},model:{value:t.form.entityType,callback:function(e){t.$set(t.form,"entityType",e)},expression:"form.entityType"}}),a("h2",{staticClass:"subtitle"},[t._v(t._s(t.$t("status_automations.in_title")))]),a("div",{staticClass:"flexrow"},[a("combobox-task-type",{staticClass:"flexrow-item",attrs:{label:t.$t("status_automations.fields.in_task_type"),"task-type-list":t.form.inEntityTaskTypes},on:{enter:t.confirmClicked},model:{value:t.form.inTaskTypeId,callback:function(e){t.$set(t.form,"inTaskTypeId",e)},expression:"form.inTaskTypeId"}}),a("combobox-status",{staticClass:"flexrow-item",attrs:{label:t.$t("status_automations.fields.in_task_status"),"task-status-list":t.taskStatusList},on:{enter:t.confirmClicked},model:{value:t.form.inTaskStatusId,callback:function(e){t.$set(t.form,"inTaskStatusId",e)},expression:"form.inTaskStatusId"}})],1),a("h2",{staticClass:"subtitle"},[t._v(t._s(t.$t("status_automations.out_title")))]),a("div",{staticClass:"flexrow"},[!t.isEditing&&t.form.entityType==="asset"?a("combobox",{staticClass:"flexrow-item margin-fix",attrs:{label:t.$t("status_automations.fields.out_field_type"),options:t.fieldTypeOptions,"locale-key-prefix":"status_automations.field_types."},on:{enter:t.confirmClicked},model:{value:t.form.outFieldType,callback:function(e){t.$set(t.form,"outFieldType",e)},expression:"form.outFieldType"}}):t._e(),t.isEditing&&t.form.outFieldType==="ready_for"?a("span",{staticClass:"flexrow-item"},[t._v(" "+t._s(t.$t("status_automations.field_types.ready_for"))+" ")]):t._e(),a("combobox-task-type",{staticClass:"flexrow-item",attrs:{label:t.$t("status_automations.fields.out_task_type"),"task-type-list":t.form.outEntityTaskTypes,"open-top":!0},on:{enter:t.confirmClicked},model:{value:t.form.outTaskTypeId,callback:function(e){t.$set(t.form,"outTaskTypeId",e)},expression:"form.outTaskTypeId"}}),t.form.outFieldType==="status"?a("combobox-status",{staticClass:"flexrow-item",attrs:{label:t.$t("status_automations.fields.out_task_status"),"task-status-list":t.taskStatusList,"open-top":!0},on:{enter:t.confirmClicked},model:{value:t.form.outTaskStatusId,callback:function(e){t.$set(t.form,"outTaskStatusId",e)},expression:"form.outTaskStatusId"}}):t._e()],1),t.isEditing?a("combobox-boolean",{attrs:{label:t.$t("main.archived")},on:{enter:t.confirmClicked},model:{value:t.form.archived,callback:function(e){t.$set(t.form,"archived",e)},expression:"form.archived"}}):t._e()],1),a("modal-footer",{attrs:{"error-text":t.$t("status_automations.create_error"),"is-error":t.isError},on:{confirm:t.confirmClicked,cancel:function(e){return t.$emit("cancel")}}})],1)])])},x=[],g=r($,S,x,!1,null,"0637d34f",null,null);const A=g.exports,C={name:"status-automations",components:{DeleteModal:h,EditStatusAutomationModal:A,ListPageHeader:v,RouteTabs:b,StatusAutomationList:E},data(){return{activeTab:"active",modals:{edit:!1,del:!1},loading:{edit:!1,del:!1,list:!1},errors:{edit:!1,del:!1,list:!1},tabs:[{name:"active",label:this.$t("main.active")},{name:"archived",label:this.$t("main.archived")}],statusAutomationToDelete:null,statusAutomationToEdit:null}},computed:{...l(["statusAutomations","archivedStatusAutomations","taskStatusMap","taskTypeMap"]),isActiveTab(){return this.activeTab==="active"},statusAutomationsList(){return this.isActiveTab?this.statusAutomations:this.archivedStatusAutomations},deleteText(){const s=this.statusAutomationToDelete;return s?this.$t("custom_actions.delete_text",{name:s.name}):""}},created(){this.activeTab=this.$route.query.tab||"active",this.loading.list=!0,this.errors.list=!1,this.loadStatusAutomations(s=>{this.loading.list=!1,s&&(this.errors.list=!0)})},methods:{..._(["deleteStatusAutomation","editStatusAutomation","loadTaskStatuses","loadStatusAutomations","newStatusAutomation"]),confirmEditStatusAutomation(s){let t="newStatusAutomation";this.statusAutomationToEdit&&this.statusAutomationToEdit.id&&(t="editStatusAutomation",s.id=this.statusAutomationToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this[t](s).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(a=>{console.error(a),this.errors.edit=!0,this.loading.edit=!1})},confirmDeleteStatusAutomation(){this.loading.del=!0,this.errors.del=!1,this.deleteStatusAutomation(this.statusAutomationToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(s=>{console.error(s),this.errors.del=!0,this.loading.del=!1})},onExportClicked(){const s=y.slugify(this.$t("status_automations.title")),a=[[this.$t("main.type"),this.$t("status_automations.fields.entity_type"),this.$t("status_automations.fields.in_task_type"),this.$t("status_automations.fields.in_task_status"),this.$t("status_automations.fields.out_field_type"),this.$t("status_automations.fields.out_task_type"),this.$t("status_automations.fields.out_task_status")]].concat(this.statusAutomations.map(e=>{var i,o,n,u;return[e.type,e.entity_type,(i=this.taskTypeMap.get(e.in_task_type_id))==null?void 0:i.name,(o=this.taskStatusMap.get(e.in_task_status_id))==null?void 0:o.short_name,e.out_field_type==="ready_for"?this.$t("status_automations.change_ready_for"):this.$t("status_automations.change_status"),(n=this.taskTypeMap.get(e.out_task_type_id))==null?void 0:n.name,e.out_field_type==="status"?(u=this.taskStatusMap.get(e.out_task_status_id))==null?void 0:u.short_name:void 0]}));k.buildCsvFile(s,a)},onNewClicked(){this.statusAutomationToEdit={},this.errors.edit=!1,this.modals.edit=!0},onEditClicked(s){this.statusAutomationToEdit=s,this.errors.edit=!1,this.modals.edit=!0},onDeleteClicked(s){this.statusAutomationToDelete=s,this.errors.del=!1,this.modals.del=!0}},watch:{$route(){this.activeTab=this.$route.query.tab||"active"}},metaInfo(){return{title:`${this.$t("status_automations.title")} - Kitsu`}}};var I=function(){var t=this,a=t._self._c;return a("div",{staticClass:"status-automations page fixed-page"},[a("list-page-header",{attrs:{title:t.$t("status_automations.title"),"new-entry-label":t.$t("status_automations.new_status_automation"),"is-exportable":t.isActiveTab},on:{"export-clicked":t.onExportClicked,"new-clicked":t.onNewClicked}}),a("route-tabs",{staticClass:"mt2",attrs:{"active-tab":t.activeTab,tabs:t.tabs,"route-name":"status-automations"}}),a("status-automation-list",{staticClass:"status-automation-list",attrs:{entries:t.statusAutomationsList,"is-editable":!0,"is-loading":t.loading.list,"is-error":t.errors.list},on:{"edit-clicked":t.onEditClicked,"delete-clicked":t.onDeleteClicked}}),a("edit-status-automation-modal",{attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"status-automation-to-edit":t.statusAutomationToEdit},on:{cancel:function(e){t.modals.edit=!1},confirm:t.confirmEditStatusAutomation}}),a("delete-modal",{attrs:{active:t.modals.del,"is-loading":t.loading.del,"is-error":t.errors.del,text:t.deleteText,"error-text":t.$t("status_automations.delete_error")},on:{cancel:function(e){t.modals.del=!1},confirm:t.confirmDeleteStatusAutomation}})],1)},w=[],F=r(C,I,w,!1,null,"5a2341a6",null,null);const R=F.exports;export{R as default};
//# sourceMappingURL=StatusAutomations-B3SFKT8_.js.map
