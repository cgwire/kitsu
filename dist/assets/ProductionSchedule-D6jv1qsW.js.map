{"version":3,"mappings":"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","names":["props","__props","emit","__emit","useI18n","form","reactive","errors","versionCombobox","ref","nameField","isEditing","computed","isValidForm","modalTitle","fromVersionOptions","version","firstBy","validateName","name","runConfirmation","data","onMounted","DEFAULT_MODE","DEFAULT_VERSION","DEFAULT_ZOOM","_sfc_main","formatListMixin","ButtonSimple","Checkbox","ChevronDownIcon","ChevronRightIcon","Combobox","ComboboxNumber","ComboboxTaskType","ConfirmModal","DateField","EditScheduleVersionModal","GripVerticalIcon","HardDeleteModal","ListRestartIcon","PeopleAvatar","PeopleName","Schedule","Spinner","TrashIcon","TextField","XIcon","moment","mapGetters","startDate","parseSimpleDate","endDate","nbDays","getBusinessDays","nbEntities","sum","entity","nbAssignees","assetStore","assetTypeStore","taskType","person","shotStore","taskTypeStore","sortPeople","personId","options","fromScheduleVersion","types","item","type","mapActions","mode","zoom","query","scheduleItems","scheduleStartDate","parseDate","scheduleEndDate","path","getTaskTypeSchedulePath","sortTaskTypeScheduleItems","o","taskTypeElement","scheduleItem","refreshScheduleCallBack","expanded","resetAssignments","loadScheduleItems","parameters","children","childrenById","child","tasks","versionedTasks","versionedTaskMap","versionedTask","task","versioned","tasksByType","people","assigneeId","entityTypeItem","addBusinessDays","minutesToDays","assetType","sortEntitiesByUserName","keyA","keyB","sortTasksByEntityName","a","b","items","sortedChildren","key","sortByName","entityTypeId","byAssignee","assignee","err","daysOff","minDate","maxDate","parentElement","element","taskTypeId","selectedEntityType","asset","shotsBySequence","shot","acc","sequenceId","shots","entityType","selection","start_date","end_date","today","event","taskEstimation","cumulatedTasks","nextAssigneeIndex","nextStartDate","t","taskStartDate","taskEndDate","taskAssignee","due_date","getDatesFromStartDate","daysToMinutes","id","scheduleVersion","versionId","newVersion","expandAll","ExcelJS","__vitePreload","__vite_default__","n","workbook","sheet","header","dates","headerRow","cell","datesColumn","startRowLevel1","endRowLevel1","row","start","end","color","color2","colors","startRowLevel2","endRowLevel2","i","startRowLevel3","endRowLevel3","isAssigned","getDayOffRange","dayOff","index","date","duration","startIndex","endIndex","ajustColumnWidth","columnIndex","minWidth","maxWidth","column","maxLength","cellValue","buffer","filename","value","release","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_7","_hoisted_8","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_20","_hoisted_21","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_28","_hoisted_29","_hoisted_31","_hoisted_33","_hoisted_34","_hoisted_36","_hoisted_39","_hoisted_40","_hoisted_42","_hoisted_43","_openBlock","_createElementBlock","_Fragment","_createElementVNode","_createVNode","_component_date_field","_ctx","$data","_cache","$event","_component_combobox_number","$options","_createBlock","_component_combobox","_createCommentVNode","_hoisted_6","_toDisplayString","_component_button_simple","_hoisted_9","_component_schedule","_hoisted_10","args","_component_x_icon","_component_combobox_task_type","_hoisted_14","_component_spinner","_hoisted_22","_withModifiers","_renderList","_normalizeStyle","_hoisted_27","_hoisted_26","_createTextVNode","_component_list_restart_icon","_hoisted_32","_component_people_avatar","_component_people_name","_hoisted_30","_component_checkbox","_hoisted_35","_component_text_field","_component_trash_icon","_hoisted_37","_hoisted_38","_hoisted_41","_hoisted_15","_component_grip_vertical_icon","_component_chevron_down_icon","_component_chevron_right_icon","_hoisted_19","_component_edit_schedule_version_modal","_component_hard_delete_modal","_component_confirm_modal"],"ignoreList":[],"sources":["../../src/components/modals/EditScheduleVersionModal.vue","../../src/components/pages/ProductionSchedule.vue"],"sourcesContent":["<template>\n  <base-modal active :title=\"modalTitle\" @cancel=\"$emit('cancel')\">\n    <form @submit.prevent>\n      <combobox\n        ref=\"versionCombobox\"\n        :label=\"$t('schedule.fields.create_from_version')\"\n        :options=\"fromVersionOptions\"\n        v-model=\"form.version\"\n        v-if=\"!isEditing\"\n      />\n      <text-field\n        ref=\"nameField\"\n        :label=\"$t('schedule.fields.name')\"\n        :error-text=\"$t('schedule.edit_version_exist')\"\n        :errored=\"errors.name\"\n        :maxlength=\"20\"\n        @enter=\"runConfirmation\"\n        @update:model-value=\"validateName\"\n        v-model.trim=\"form.name\"\n      />\n      <combobox-boolean\n        :label=\"$t('schedule.fields.locked')\"\n        v-model=\"form.locked\"\n        v-if=\"isEditing\"\n      />\n    </form>\n    <modal-footer\n      :error-text=\"$t('schedule.edit_version_error')\"\n      :is-error=\"isError\"\n      :is-loading=\"isLoading\"\n      :is-disabled=\"!isValidForm\"\n      @confirm=\"runConfirmation\"\n      @cancel=\"$emit('cancel')\"\n    />\n  </base-modal>\n</template>\n\n<script setup>\nimport { ref, computed, reactive, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport { firstBy } from 'thenby'\n\nimport BaseModal from '@/components/modals/BaseModal.vue'\nimport Combobox from '@/components/widgets/Combobox.vue'\nimport ComboboxBoolean from '@/components/widgets/ComboboxBoolean.vue'\nimport ModalFooter from '@/components/modals/ModalFooter.vue'\nimport TextField from '@/components/widgets/TextField.vue'\n\nconst props = defineProps({\n  isError: {\n    type: Boolean,\n    default: false\n  },\n  isLoading: {\n    type: Boolean,\n    default: false\n  },\n  scheduleVersionToEdit: {\n    type: Object,\n    required: true\n  },\n  version: {\n    type: String,\n    required: true\n  },\n  versionOptions: {\n    type: Array,\n    required: true\n  }\n})\n\nconst emit = defineEmits(['cancel', 'confirm'])\n\nconst { t } = useI18n()\n\nconst form = reactive({\n  id: null,\n  name: '',\n  locked: 'false',\n  version: props.version || ''\n})\n\nconst errors = reactive({\n  name: false\n})\n\nconst versionCombobox = ref(null)\nconst nameField = ref(null)\n\nconst isEditing = computed(() => Boolean(props.scheduleVersionToEdit?.id))\n\nconst isValidForm = computed(() => Boolean(form.name) && !errors.name)\n\nconst modalTitle = computed(() =>\n  isEditing.value ? t('schedule.edit_version') : t('schedule.create_version')\n)\n\nconst fromVersionOptions = computed(() => [\n  {\n    label: t('schedule.fields.new'),\n    value: 'new',\n    separator: true\n  },\n  {\n    label: `${t('schedule.versions.from')} ${t('schedule.versions.reference')}`,\n    value: 'ref',\n    separator: true\n  },\n  ...props.versionOptions\n    .filter(version => !version.canceled)\n    .sort(firstBy('created_at'))\n    .map(version => ({\n      label: `${t('schedule.versions.from')} ${version.name}`,\n      value: version.id\n    }))\n])\n\nfunction validateName(name) {\n  errors.name = false\n  if (!name || props.scheduleVersionToEdit.name === name) {\n    return\n  }\n  const nameAlreadyExist = props.versionOptions\n    .map(version => version.name)\n    .includes(name)\n\n  if (nameAlreadyExist) {\n    errors.name = true\n  }\n}\n\nfunction runConfirmation() {\n  if (!isValidForm.value) {\n    return\n  }\n  const data = {\n    id: props.scheduleVersionToEdit.id ?? null,\n    name: form.name,\n    locked: form.locked === 'true',\n    version: form.version\n  }\n  emit('confirm', data)\n}\n\nonMounted(() => {\n  form.id = props.scheduleVersionToEdit.id || null\n  form.name = props.scheduleVersionToEdit.name || ''\n  form.locked = props.scheduleVersionToEdit.locked ? 'true' : 'false'\n  form.version = props.version || 'new'\n\n  if (isEditing.value) {\n    nameField.value?.focus()\n  } else {\n    versionCombobox.value?.focus()\n  }\n})\n</script>\n","<template>\n  <div class=\"columns fixed-page\">\n    <div class=\"column main-column\">\n      <div class=\"flexrow project-dates\">\n        <div class=\"flexrow-item\">\n          <date-field\n            :can-delete=\"false\"\n            :label=\"$t('main.start_date')\"\n            utc\n            v-model=\"selectedStartDate\"\n          />\n        </div>\n        <div class=\"flexrow-item\">\n          <date-field\n            :can-delete=\"false\"\n            :label=\"$t('main.end_date')\"\n            utc\n            v-model=\"selectedEndDate\"\n          />\n        </div>\n        <combobox-number\n          class=\"flexrow-item zoom-level nowrap\"\n          :label=\"$t('schedule.zoom_level')\"\n          :options=\"zoomOptions\"\n          v-model=\"zoomLevel\"\n          @update:model-value=\"onZoomLevelChanged\"\n        />\n        <combobox\n          class=\"flexrow-item\"\n          :label=\"$t('main.entities')\"\n          v-model=\"entityType\"\n          :options=\"entityTypeOptions\"\n          @update:model-value=\"onEntityTypeChanged\"\n          v-if=\"availableEntityTypes.length > 1\"\n        />\n        <combobox\n          class=\"flexrow-item ml1\"\n          :label=\"$t('schedule.mode')\"\n          v-model=\"mode\"\n          :options=\"modeOptions\"\n          @update:model-value=\"onModeChanged\"\n        />\n        <div class=\"flexrow-item ml1\" v-if=\"mode === 'prev'\">\n          <label class=\"label\">\n            {{ $t('schedule.version') }}\n          </label>\n          <div class=\"flexrow\">\n            <combobox\n              class=\"flexrow-item\"\n              v-model=\"version\"\n              :options=\"versionOptions\"\n              @update:model-value=\"onVersionChanged\"\n            />\n            <button-simple\n              class=\"ml05\"\n              icon=\"calendar-plus\"\n              :title=\"$t('schedule.new_version')\"\n              @click=\"openEditScheduleVersion()\"\n            />\n            <button-simple\n              class=\"ml05\"\n              :disabled=\"version === 'ref'\"\n              icon=\"pencil\"\n              :title=\"$t('schedule.edit_version')\"\n              @click=\"openEditScheduleVersion(currentVersion)\"\n            />\n            <button-simple\n              class=\"ml05\"\n              :disabled=\"version === 'ref'\"\n              icon=\"trash\"\n              :title=\"$t('schedule.delete_version')\"\n              @click=\"openDeleteScheduleVersion(version)\"\n            />\n          </div>\n        </div>\n        <div class=\"filler\"></div>\n        <div class=\"flexrow\" style=\"margin-top: 23px\">\n          <button-simple\n            class=\"flexrow-item\"\n            :disabled=\"loading.exportSchedule || loading.expandSchedule\"\n            icon=\"export\"\n            :is-loading=\"loading.exportSchedule\"\n            :title=\"$t('schedule.export')\"\n            @click=\"exportSchedule()\"\n          />\n          <button-simple\n            class=\"flexrow-item\"\n            :disabled=\"version === 'ref'\"\n            icon=\"save\"\n            :text=\"$t('schedule.apply_to_prod')\"\n            @click=\"modals.applyScheduleVersion = true\"\n            v-if=\"!isTVShow && mode === 'prev'\"\n          />\n          <button-simple\n            class=\"flexrow-item\"\n            icon=\"clock\"\n            :text=\"$t('schedule.today')\"\n            @click=\"scrollScheduleToToday\"\n          />\n          <button-simple\n            :active=\"isSidePanelOpen && assignments.type !== 'task'\"\n            class=\"flexrow-item\"\n            :disabled=\"isLockedSchedule\"\n            icon=\"list\"\n            :text=\"$t('menu.assign_tasks')\"\n            @click=\"toggleSidePanel\"\n            v-if=\"!isTVShow\"\n          />\n        </div>\n      </div>\n\n      <schedule\n        ref=\"schedule\"\n        :start-date=\"startDate\"\n        :end-date=\"endDate\"\n        :hierarchy=\"filteredScheduleItems\"\n        :zoom-level=\"zoomLevel\"\n        :is-loading=\"loading.schedule\"\n        :is-error=\"errors.schedule\"\n        is-estimation-linked\n        hide-man-days\n        :multiline=\"isTVShow\"\n        :reassignable=\"!isLockedSchedule\"\n        show-expand-all\n        :subchildren=\"!isTVShow\"\n        :type=\"mode\"\n        @expand-all=\"onScheduleExpandAll\"\n        @item-assign=\"onScheduleItemAssigned\"\n        @item-changed=\"onScheduleItemChanged\"\n        @item-drop=\"onScheduleItemDropped\"\n        @item-selected=\"selectTaskTypeElement\"\n        @item-unassign=\"onScheduleItemUnassigned\"\n        @root-element-expanded=\"expandTaskTypeElement\"\n        @root-element-selected=\"selectParentElement\"\n        @task-selected=\"selectTaskElement\"\n        @task-unselected=\"closeSidePanel()\"\n      />\n    </div>\n\n    <div\n      class=\"column side-column\"\n      v-if=\"isSidePanelOpen && !isLockedSchedule && !isTVShow\"\n    >\n      <div class=\"side\">\n        <a class=\"close-button\" @click=\"toggleSidePanel\">\n          <x-icon class=\"align-middle\" :size=\"16\" />\n        </a>\n        <h2 class=\"mt1\">\n          {{\n            assignments.type === 'task'\n              ? $t('schedule.edit_task')\n              : $t('menu.assign_tasks')\n          }}\n        </h2>\n        <div class=\"details\">\n          <combobox-task-type\n            class=\"mb05\"\n            add-placeholder\n            :placeholder=\"$t('schedule.select_task_type')\"\n            :label=\"$t('news.task_type')\"\n            :task-type-list=\"availableTaskTypes\"\n            :model-value=\"selectedTaskType?.task_type_id\"\n            @update:model-value=\"onSelectTaskType\"\n          />\n          <button-simple\n            class=\"mt2 mb05\"\n            icon=\"user-check\"\n            :is-on=\"assignments.assigned\"\n            :title=\"$t('schedule.show_assigned')\"\n            @click=\"assignments.assigned = !assignments.assigned\"\n            v-if=\"\n              !assignments.loading &&\n              assignments.entityTypes?.length &&\n              !assignments.type\n            \"\n          />\n        </div>\n        <div class=\"mt2\" v-if=\"assignments.loading\">\n          <spinner class=\"mauto\" :size=\"20\" />\n        </div>\n        <ul class=\"assignments parent mt1\" v-else-if=\"!assignments.type\">\n          <li\n            :key=\"entityType.id\"\n            v-for=\"entityType in assignments.entityTypes\"\n          >\n            <div\n              class=\"assignment-item\"\n              draggable=\"true\"\n              @dragstart=\"\n                onAssignmentItemDragStart($event, entityType, selectedTaskType)\n              \"\n              @click=\"onAssignmentItemSelected(entityType)\"\n            >\n              <grip-vertical-icon class=\"icon\" />\n              <span class=\"name\">\n                {{ entityType.name }}\n                ({{ filteredAssignments(entityType.children).length }})\n              </span>\n              <span\n                class=\"expand\"\n                @click.stop=\"entityType.expanded = !entityType.expanded\"\n              >\n                <chevron-right-icon v-if=\"!entityType.expanded\" />\n                <chevron-down-icon v-else />\n              </span>\n            </div>\n            <ul class=\"assignments children\" v-if=\"entityType.expanded\">\n              <li\n                :key=\"child.id\"\n                v-for=\"child in filteredAssignments(entityType.children)\"\n              >\n                <div\n                  class=\"assignment-item\"\n                  draggable=\"true\"\n                  @dragstart=\"\n                    onAssignmentItemDragStart(\n                      $event,\n                      { ...entityType, children: [child] },\n                      selectedTaskType\n                    )\n                  \"\n                  @click=\"\n                    onAssignmentItemSelected({\n                      ...entityType,\n                      children: [child]\n                    })\n                  \"\n                >\n                  <grip-vertical-icon class=\"icon\" />\n                  <span class=\"name\">{{ child.name }}</span>\n                </div>\n              </li>\n            </ul>\n          </li>\n        </ul>\n        <div class=\"assignments mt1\" v-else>\n          <form class=\"mt1\" @submit.prevent=\"submitAssignments()\">\n            <div class=\"flexrow\">\n              <div class=\"flexrow-item\">\n                <date-field\n                  :can-delete=\"false\"\n                  :disabled=\"assignments.type !== 'entity'\"\n                  :label=\"$t('main.start_date')\"\n                  utc\n                  v-model=\"assignments.startDate\"\n                />\n              </div>\n              <div class=\"flexrow-item\">\n                <date-field\n                  :can-delete=\"false\"\n                  :disabled=\"assignments.type !== 'entity'\"\n                  :label=\"$t('main.end_date')\"\n                  utc\n                  v-model=\"assignments.endDate\"\n                />\n              </div>\n            </div>\n            <div :key=\"item.id\" v-for=\"item in draggedEntities\">\n              <div\n                class=\"dragged-type\"\n                :style=\"{\n                  background: selectedTaskType.color\n                }\"\n              >\n                {{ item.name }}\n              </div>\n              <div v-if=\"!item.children.length\">\n                {{ $t('schedule.no_entity') }}\n              </div>\n              <ul class=\"dragged-items\" v-else>\n                <li\n                  class=\"dragged-item\"\n                  :key=\"child.id\"\n                  :style=\"{\n                    background: `color-mix(in srgb, ${selectedTaskType.color} 40%, transparent)`,\n                    'border-left': `4px solid ${selectedTaskType.color}`\n                  }\"\n                  v-for=\"child in item.children\"\n                >\n                  {{ item.name }} / {{ child.name }}\n                </li>\n              </ul>\n              <hr />\n            </div>\n            <table class=\"assignees\">\n              <thead>\n                <tr>\n                  <td>\n                    {{ $t('schedule.assign') }}\n                    <a\n                      class=\"reset-assignees\"\n                      :title=\"$t('schedule.reset_list')\"\n                      @click=\"assignments.excludes = []\"\n                      v-if=\"assignments.excludes.length\"\n                    >\n                      <list-restart-icon\n                        class=\"align-middle\"\n                        :size=\"18\"\n                        :stroke-width=\"1.5\"\n                      />\n                    </a>\n                  </td>\n                </tr>\n              </thead>\n              <tbody v-if=\"!availablePersons.length\">\n                <tr>\n                  <td class=\"has-text-centered\">\n                    {{ $t('schedule.no_assignee') }}\n                  </td>\n                </tr>\n              </tbody>\n              <tbody v-else>\n                <tr :key=\"person.id\" v-for=\"person in availablePersons\">\n                  <td class=\"assignee\">\n                    <div class=\"person\">\n                      <people-avatar\n                        :is-link=\"false\"\n                        :font-size=\"14\"\n                        :person=\"person\"\n                        :size=\"28\"\n                      />\n                      <people-name :person=\"person\" />\n                    </div>\n                    <button-simple\n                      class=\"is-small\"\n                      icon=\"minus\"\n                      :title=\"\n                        $t('main.avatar.unassign', {\n                          personName: person.name\n                        })\n                      \"\n                      type=\"button\"\n                      @click=\"removeFromAssignments(person)\"\n                    />\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            <checkbox\n              class=\"pa05\"\n              :disabled=\"!availablePersons.length\"\n              :label=\"$t('schedule.force_unassign')\"\n              :toggle=\"true\"\n              v-model=\"assignments.unassign\"\n              v-if=\"assignments.type === 'entity'\"\n            />\n            <div class=\"flexrow mt2\" v-if=\"assignments.type === 'entity'\">\n              <label class=\"mr05\">\n                {{ $t('schedule.forced_daily_quotas') }}\n              </label>\n              <text-field\n                class=\"mb0 daily-quotas\"\n                input-class=\" is-small\"\n                :step=\"0.01\"\n                type=\"number\"\n                v-model=\"assignments.forcedDailyQuota\"\n              />\n              <a\n                class=\"reset-quotas ml05\"\n                @click=\"assignments.forcedDailyQuota = null\"\n                v-if=\"assignments.forcedDailyQuota\"\n              >\n                <trash-icon class=\"align-middle\" :size=\"14\" />\n              </a>\n            </div>\n            <div class=\"mt2\" v-if=\"assignments.type === 'entity'\">\n              {{ $t('schedule.estimated_daily_quotas') }}\n              {{ estimatedDailyQuota.toFixed(2) }}\n            </div>\n            <div class=\"flexrow mt2\" v-if=\"assignments.type === 'task'\">\n              <div class=\"flexrow-item\">\n                <date-field\n                  :can-delete=\"false\"\n                  :label=\"$t('main.start_date')\"\n                  utc\n                  :with-margin=\"false\"\n                  v-model=\"assignments.task.startDate\"\n                />\n              </div>\n              <div class=\"flexrow-item\">\n                <date-field\n                  :can-delete=\"false\"\n                  disabled\n                  :label=\"$t('main.end_date')\"\n                  utc\n                  :with-margin=\"false\"\n                  v-model=\"assignments.task.endDate\"\n                />\n              </div>\n            </div>\n            <div class=\"flexrow mt2\" v-if=\"assignments.type === 'task'\">\n              <text-field\n                class=\"mb0 estimation mr05\"\n                input-class=\" thin\"\n                :label=\"$t('main.estimation')\"\n                :step=\"0.01\"\n                placeholder=\"0.00\"\n                type=\"number\"\n                :unit-label=\"$t('schedule.md')\"\n                v-model=\"assignments.task.estimation\"\n              />\n            </div>\n            <div class=\"mt2 has-text-right\">\n              <template v-if=\"assignments.type === 'entity'\">\n                <button-simple\n                  :disabled=\"!hasDraggedEntities || !availablePersons.length\"\n                  :is-loading=\"assignments.saving\"\n                  is-primary\n                  :text=\"$t('main.apply')\"\n                  type=\"submit\"\n                />\n                <button\n                  class=\"button is-link ml05\"\n                  :disabled=\"assignments.saving\"\n                  :text=\"$t('main.back')\"\n                  type=\"button\"\n                  @click=\"assignments.type = null\"\n                >\n                  {{ $t('main.back') }}\n                </button>\n              </template>\n              <template v-if=\"assignments.type === 'task'\">\n                <button-simple\n                  :disabled=\"!assignments.task.estimation\"\n                  :is-loading=\"assignments.saving\"\n                  is-primary\n                  :text=\"$t('main.apply')\"\n                  type=\"submit\"\n                />\n                <button class=\"button is-link ml05\" @click=\"closeSidePanel()\">\n                  {{ $t('main.cancel') }}\n                </button>\n              </template>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <edit-schedule-version-modal\n    :schedule-version-to-edit=\"scheduleVersionToEdit\"\n    :version=\"version\"\n    :version-options=\"scheduleVersions\"\n    :is-loading=\"loading.editScheduleVersion\"\n    :is-error=\"errors.editScheduleVersion\"\n    @cancel=\"modals.editScheduleVersion = false\"\n    @confirm=\"editVersion\"\n    v-if=\"modals.editScheduleVersion\"\n  />\n\n  <hard-delete-modal\n    active\n    :error-text=\"$t('schedule.delete_version_error')\"\n    :is-loading=\"loading.delete\"\n    :is-error=\"errors.deleteScheduleVersion\"\n    :lock-text=\"scheduleVersionToEdit?.name\"\n    :text=\"\n      $t('schedule.delete_version_message', {\n        name: scheduleVersionToEdit?.name\n      })\n    \"\n    @cancel=\"modals.deleteScheduleVersion = false\"\n    @confirm=\"deleteVersion(scheduleVersionToEdit)\"\n    v-if=\"modals.deleteScheduleVersion\"\n  />\n\n  <confirm-modal\n    active\n    :text=\"$t('schedule.apply_to_prod_confirm')\"\n    :error-text=\"$t('schedule.apply_to_prod_error')\"\n    :is-loading=\"loading.applyScheduleVersion\"\n    :is-error=\"errors.applyScheduleVersion\"\n    @cancel=\"modals.applyScheduleVersion = false\"\n    @confirm=\"applyToProduction()\"\n    v-if=\"modals.applyScheduleVersion\"\n  />\n</template>\n\n<script>\n/*\n * Page to manage the schedule of the big steps of the production. It allows\n * to set milestones too.\n */\n\nimport {\n  ChevronDownIcon,\n  ChevronRightIcon,\n  GripVerticalIcon,\n  ListRestartIcon,\n  TrashIcon,\n  XIcon\n} from 'lucide-vue-next'\nimport moment from 'moment-timezone'\nimport { firstBy } from 'thenby'\nimport { mapGetters, mapActions } from 'vuex'\n\nimport colors from '@/lib/colors'\nimport { getTaskTypeSchedulePath } from '@/lib/path'\nimport {\n  sortByName,\n  sortPeople,\n  sortTaskTypeScheduleItems\n} from '@/lib/sorting'\nimport {\n  addBusinessDays,\n  daysToMinutes,\n  getBusinessDays,\n  getDatesFromStartDate,\n  getDayOffRange,\n  minutesToDays,\n  parseDate,\n  parseSimpleDate\n} from '@/lib/time'\n\nimport { formatListMixin } from '@/components/mixins/format'\n\nimport ButtonSimple from '@/components/widgets/ButtonSimple.vue'\nimport Checkbox from '@/components/widgets/Checkbox.vue'\nimport Combobox from '@/components/widgets/Combobox.vue'\nimport ComboboxNumber from '@/components/widgets/ComboboxNumber.vue'\nimport ComboboxTaskType from '@/components/widgets/ComboboxTaskType.vue'\nimport ConfirmModal from '@/components/modals/ConfirmModal.vue'\nimport DateField from '@/components/widgets/DateField.vue'\nimport EditScheduleVersionModal from '@/components/modals/EditScheduleVersionModal.vue'\nimport HardDeleteModal from '@/components/modals/HardDeleteModal.vue'\nimport PeopleAvatar from '@/components/widgets/PeopleAvatar.vue'\nimport PeopleName from '@/components/widgets/PeopleName.vue'\nimport Schedule from '@/components/widgets/Schedule.vue'\nimport Spinner from '@/components/widgets/Spinner.vue'\nimport TextField from '@/components/widgets/TextField.vue'\n\nimport assetStore from '@/store/modules/assets'\nimport assetTypeStore from '@/store/modules/assettypes'\nimport shotStore from '@/store/modules/shots'\nimport taskTypeStore from '@/store/modules/tasktypes'\n\nexport const DEFAULT_MODE = 'prev'\nexport const DEFAULT_VERSION = 'ref'\nexport const DEFAULT_ZOOM = 1\n\nexport default {\n  name: 'production-schedule',\n\n  mixins: [formatListMixin],\n\n  components: {\n    ButtonSimple,\n    Checkbox,\n    ChevronDownIcon,\n    ChevronRightIcon,\n    Combobox,\n    ComboboxNumber,\n    ComboboxTaskType,\n    ConfirmModal,\n    DateField,\n    EditScheduleVersionModal,\n    GripVerticalIcon,\n    HardDeleteModal,\n    ListRestartIcon,\n    PeopleAvatar,\n    PeopleName,\n    Schedule,\n    Spinner,\n    TrashIcon,\n    TextField,\n    XIcon\n  },\n\n  data() {\n    return {\n      assignments: {\n        assigned: false,\n        entityTypes: null,\n        excludes: [],\n        forcedDailyQuota: null,\n        loading: false,\n        saving: false,\n        startDate: null,\n        endDate: null,\n        task: {},\n        type: null,\n        unassign: false\n      },\n      availableTaskTypes: [],\n      daysOffByPerson: {},\n      draggedEntities: [],\n      endDate: moment().add(6, 'months').endOf('day'),\n      entityType: null,\n      isSidePanelOpen: false,\n      scheduleItems: [],\n      startDate: moment().startOf('day'),\n      selectedStartDate: null,\n      selectedEndDate: null,\n      selectedTaskType: null,\n      zoomLevel: DEFAULT_ZOOM,\n      zoomOptions: [\n        { label: this.$t('main.week'), value: 0 },\n        { label: '1', value: 1 },\n        { label: '2', value: 2 },\n        { label: '3', value: 3 }\n      ],\n      mode: DEFAULT_MODE,\n      modeOptions: [\n        { label: this.$t('schedule.mode_prev'), value: 'prev' },\n        { label: this.$t('schedule.mode_real'), value: 'real' }\n      ],\n      scheduleVersionToEdit: {},\n      version: DEFAULT_VERSION,\n      loading: {\n        schedule: false,\n        editScheduleVersion: false,\n        applyScheduleVersion: false,\n        expandSchedule: false,\n        exportSchedule: false\n      },\n      errors: {\n        schedule: false,\n        editScheduleVersion: false,\n        deleteScheduleVersion: false,\n        applyScheduleVersion: false\n      },\n      modals: {\n        editScheduleVersion: false,\n        deleteScheduleVersion: false,\n        applyScheduleVersion: false\n      }\n    }\n  },\n\n  mounted() {\n    this.reset()\n  },\n\n  computed: {\n    ...mapGetters([\n      'currentEpisode',\n      'currentProduction',\n      'isCurrentUserManager',\n      'isCurrentUserSupervisor',\n      'isTVShow',\n      'organisation',\n      'personMap',\n      'productionAssetTypes',\n      'scheduleVersions',\n      'user'\n    ]),\n\n    estimatedDailyQuota() {\n      const startDate = parseSimpleDate(this.assignments.startDate)\n      const endDate = parseSimpleDate(this.assignments.endDate)\n      const nbDays = getBusinessDays(startDate, endDate)\n      const nbEntities = this.draggedEntities.reduce(\n        (sum, entity) => sum + (entity.children?.length ?? 0),\n        0\n      )\n      const nbAssignees = this.availablePersons.length\n\n      return nbDays && nbAssignees ? nbEntities / nbDays / nbAssignees : 0\n    },\n\n    assetMap() {\n      return assetStore.cache.assetMap\n    },\n\n    assets() {\n      return assetStore.cache.assets\n    },\n\n    assetTypeMap() {\n      return assetTypeStore.cache.assetTypeMap\n    },\n\n    availablePersons() {\n      const taskType = this.taskTypeMap.get(this.selectedTaskType.task_type_id)\n      return this.team.filter(\n        person =>\n          !this.assignments.excludes.includes(person.id) &&\n          person.role !== 'client' &&\n          (['admin', 'manager'].includes(person.role) ||\n            !person.departments.length ||\n            person.departments.includes(taskType?.department_id))\n      )\n    },\n\n    currentVersion() {\n      return this.scheduleVersions.find(version => version.id === this.version)\n    },\n\n    hasDraggedEntities() {\n      return this.draggedEntities.some(entity => entity.children.length)\n    },\n\n    isLockedSchedule() {\n      return (\n        this.mode === 'real' ||\n        this.currentVersion?.locked ||\n        !this.isCurrentUserManager\n      )\n    },\n\n    shotMap() {\n      return shotStore.cache.shotMap\n    },\n\n    shots() {\n      return shotStore.cache.shots\n    },\n\n    taskTypeMap() {\n      return taskTypeStore.cache.taskTypeMap\n    },\n\n    team() {\n      return sortPeople(\n        this.currentProduction.team\n          .map(personId => this.personMap.get(personId))\n          .filter(person => person && !person.is_bot)\n      )\n    },\n\n    isVersioned() {\n      return this.mode === 'prev' && this.version !== 'ref'\n    },\n\n    versionOptions() {\n      const options = this.scheduleVersions\n        .filter(version => !version.canceled)\n        .sort(firstBy('created_at'))\n        .map(version => ({\n          label: version.locked\n            ? `${version.name} (${this.$t('schedule.versions.locked')})`\n            : version.name,\n          value: version.id\n        }))\n\n      const fromScheduleVersion = this.scheduleVersions.find(\n        version =>\n          version.id === this.currentProduction.from_schedule_version_id\n      )\n      const referenceVersion = {\n        label: fromScheduleVersion\n          ? `${this.$t('schedule.versions.reference')} (${this.$t('schedule.versions.from')} ${fromScheduleVersion.name})`\n          : this.$t('schedule.versions.reference'),\n        value: DEFAULT_VERSION,\n        separator: true\n      }\n\n      return [referenceVersion, ...options]\n    },\n\n    availableEntityTypes() {\n      const types = new Set()\n      this.scheduleItems.forEach(item => {\n        const taskType = this.taskTypeMap.get(item.task_type_id)\n        if (taskType?.for_entity) {\n          types.add(taskType.for_entity)\n        }\n      })\n      return Array.from(types).sort()\n    },\n\n    entityTypeOptions() {\n      const options = [{ label: this.$t('main.all'), value: null }]\n      this.availableEntityTypes.forEach(type => {\n        options.push({ label: type, value: type })\n      })\n      return options\n    },\n\n    filteredScheduleItems() {\n      if (!this.entityType) {\n        return this.scheduleItems\n      }\n      return this.scheduleItems.filter(item => {\n        const taskType = this.taskTypeMap.get(item.task_type_id)\n        return taskType && taskType.for_entity === this.entityType\n      })\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'applyScheduleVersionToProduction',\n      'assignSelectedTasks',\n      'createScheduleVersion',\n      'createScheduleVersionedTask',\n      'deleteScheduleVersion',\n      'editProduction',\n      'loadAssets',\n      'loadAssetTypeScheduleItems',\n      'loadEpisodeScheduleItems',\n      'loadProductionDaysOff',\n      'loadScheduleItems',\n      'loadScheduleVersions',\n      'loadSequenceScheduleItems',\n      'loadShots',\n      'loadTasks',\n      'loadTasksFromScheduleVersion',\n      'saveScheduleItem',\n      'unassignPersonFromTask',\n      'unassignSelectedTasks',\n      'updateScheduleVersion',\n      'updateScheduleVersionedTask',\n      'updateTask'\n    ]),\n\n    updateRoute({ mode, type, version, zoom }) {\n      const query = { ...this.$route.query }\n\n      if (mode !== undefined) {\n        query.mode = mode || undefined\n      }\n      if (type !== undefined) {\n        query.type = type || undefined\n      }\n      if (version !== undefined) {\n        query.version = version || undefined\n      }\n      if (zoom !== undefined) {\n        query.zoom = String(zoom)\n      }\n\n      if (JSON.stringify(query) !== JSON.stringify(this.$route.query)) {\n        this.$router.push({ query })\n      }\n    },\n\n    async loadData() {\n      this.loading.schedule = true\n      this.availableTaskTypes = []\n\n      await this.loadScheduleVersions(this.currentProduction)\n\n      return this.loadScheduleItems(this.currentProduction)\n        .then(scheduleItems => {\n          const scheduleStartDate = parseDate(this.selectedStartDate)\n          const scheduleEndDate = parseDate(this.selectedEndDate)\n          scheduleItems = scheduleItems.map(item => {\n            const taskType = this.taskTypeMap.get(item.task_type_id)\n            let startDate, endDate\n            if (item.start_date) {\n              startDate = parseDate(item.start_date)\n            } else {\n              startDate = moment()\n            }\n            if (startDate.isSameOrAfter(scheduleEndDate)) {\n              startDate = scheduleEndDate.clone().add(-1, 'days')\n            }\n\n            if (startDate.isBefore(scheduleStartDate)) {\n              startDate = scheduleStartDate.clone()\n            }\n\n            if (item.end_date) {\n              endDate = parseDate(item.end_date)\n            } else {\n              endDate = startDate.clone().add(1, 'days')\n            }\n            if (endDate.isSameOrAfter(scheduleEndDate)) {\n              endDate = scheduleEndDate.clone()\n            }\n\n            const path = getTaskTypeSchedulePath(\n              taskType.id,\n              this.currentProduction.id,\n              this.currentEpisode ? this.currentEpisode.id : null,\n              taskType.for_entity\n            )\n\n            return {\n              ...item,\n              color: taskType.color,\n              for_entity: taskType.for_entity,\n              name: `${taskType.for_entity} / ${taskType.name}`,\n              priority: taskType.priority,\n              startDate,\n              endDate,\n              editable: this.isInDepartment(taskType) && !this.isLockedSchedule,\n              expanded: false,\n              loading: false,\n              route:\n                taskType.for_entity === 'Shot' && this.isTVShow ? null : path,\n              children: []\n            }\n          })\n          this.scheduleItems = sortTaskTypeScheduleItems(\n            scheduleItems,\n            this.currentProduction,\n            this.taskTypeMap\n          )\n\n          this.availableTaskTypes = this.scheduleItems.map(item => ({\n            ...this.taskTypeMap.get(item.task_type_id),\n            name: item.name\n          }))\n        })\n        .finally(() => {\n          this.loading.schedule = false\n        })\n    },\n\n    async reset() {\n      this.closeSidePanel()\n\n      if (this.currentProduction.start_date) {\n        this.startDate = parseDate(this.currentProduction.start_date)\n      }\n      if (this.currentProduction.end_date) {\n        this.endDate = parseDate(this.currentProduction.end_date)\n      }\n      this.selectedStartDate = this.startDate.toDate()\n      this.selectedEndDate = this.endDate.toDate()\n\n      await this.loadData()\n\n      const mode = this.$route.query.mode\n      const type = this.$route.query.type\n      const version = this.$route.query.version\n      const zoom = Number(this.$route.query.zoom)\n\n      this.mode = this.modeOptions.map(o => o.value).includes(mode)\n        ? mode\n        : DEFAULT_MODE\n      this.entityType = this.entityTypeOptions.map(o => o.value).includes(type)\n        ? type\n        : null\n      this.version = this.versionOptions.map(o => o.value).includes(version)\n        ? version\n        : DEFAULT_VERSION\n      this.zoomLevel = this.zoomOptions.map(o => o.value).includes(zoom)\n        ? zoom\n        : DEFAULT_ZOOM\n    },\n\n    convertScheduleItems(taskTypeElement, scheduleItems) {\n      return scheduleItems.map(item => {\n        let startDate\n        if (item.start_date) {\n          startDate = parseDate(item.start_date)\n        } else {\n          startDate = moment()\n        }\n        if (startDate.isBefore(this.startDate)) {\n          startDate = this.startDate.clone()\n        }\n        if (startDate.isAfter(this.endDate)) {\n          startDate = this.endDate.clone()\n        }\n        let endDate\n        if (item.end_date) {\n          endDate = parseDate(item.end_date)\n        } else {\n          endDate = startDate.clone().add(1, 'days')\n        }\n        if (endDate.isBefore(startDate)) {\n          endDate = startDate.clone().add(1, 'days')\n        }\n        if (endDate.isAfter(this.endDate)) {\n          endDate = this.endDate.clone()\n        }\n        const scheduleItem = {\n          ...item,\n          startDate,\n          endDate,\n          expanded: false,\n          loading: false,\n          editable:\n            this.isInDepartment(this.taskTypeMap.get(item.task_type_id)) &&\n            !this.isLockedSchedule,\n          children: [],\n          parentElement: taskTypeElement\n        }\n        if (this.isTVShow) {\n          scheduleItem.route = getTaskTypeSchedulePath(\n            item.task_type_id,\n            this.currentProduction.id,\n            item.object_id,\n            taskTypeElement.for_entity\n          )\n        }\n        return scheduleItem\n      })\n    },\n\n    async expandTaskTypeElement(\n      taskTypeElement,\n      refreshScheduleCallBack = null,\n      expanded = false,\n      resetAssignments = true\n    ) {\n      taskTypeElement.expanded = expanded || !taskTypeElement.expanded\n\n      if (taskTypeElement.expanded) {\n        try {\n          taskTypeElement.loading = true\n\n          this.selectedTaskType = !this.isTVShow ? taskTypeElement : null\n          this.assignments.loading = resetAssignments\n\n          taskTypeElement.children = []\n          taskTypeElement.people = {}\n          taskTypeElement.entitiesByType = {}\n\n          const loadScheduleItems = this.isTVShow\n            ? ['Asset', 'Shot'].includes(taskTypeElement.for_entity)\n              ? this.loadEpisodeScheduleItems\n              : this.loadSequenceScheduleItems\n            : taskTypeElement.for_entity === 'Shot'\n              ? this.loadSequenceScheduleItems\n              : taskTypeElement.for_entity === 'Sequence'\n                ? this.loadSequenceScheduleItems\n                : this.loadAssetTypeScheduleItems\n          const parameters = {\n            production: this.currentProduction,\n            taskType: this.taskTypeMap.get(taskTypeElement.task_type_id)\n          }\n          const scheduleItems = await loadScheduleItems(parameters)\n\n          let children = this.convertScheduleItems(\n            taskTypeElement,\n            scheduleItems\n          )\n          const childrenById = new Map(\n            children.map(child => [child.object_id, child])\n          )\n\n          if (this.isTVShow) {\n            taskTypeElement.children = children\n          } else {\n            // load entities\n            if (taskTypeElement.for_entity === 'Asset') {\n              await this.loadAssets({ withShared: false, withTasks: false })\n            }\n            if (taskTypeElement.for_entity === 'Shot') {\n              await this.loadShots()\n            }\n\n            let tasks = await this.loadTasks({\n              project_id: this.currentProduction.id,\n              task_type_id: taskTypeElement.task_type_id,\n              relations: 'true'\n            })\n\n            // Update tasks for versioned schedules\n            if (this.isVersioned) {\n              const taskType = this.taskTypeMap.get(\n                taskTypeElement.task_type_id\n              )\n              const versionedTasks = await this.loadTasksFromScheduleVersion({\n                version: { id: this.version },\n                taskType\n              })\n              const versionedTaskMap = new Map(\n                versionedTasks.map(versionedTask => [\n                  versionedTask.task_id,\n                  versionedTask\n                ])\n              )\n              tasks = tasks\n                .map(task => {\n                  const versioned = versionedTaskMap.get(task.id)\n                  if (!versioned?.start_date) {\n                    return null\n                  }\n                  return {\n                    ...task,\n                    versionedTaskId: versioned.id,\n                    start_date: versioned.start_date,\n                    due_date: versioned.due_date,\n                    estimation: versioned.estimation,\n                    assignees: versioned.assignees\n                  }\n                })\n                .filter(Boolean)\n            }\n\n            this.daysOffByPerson = await this.loadProductionDaysOff({\n              startDate: this.startDate.format('YYYY-MM-DD'),\n              endDate: this.endDate.format('YYYY-MM-DD')\n            }).catch(\n              () => ({}) // fallback if not allowed to fetch days off\n            )\n\n            // group tasks by entity type and assignee\n            const tasksByType = {}\n            const people = {}\n            tasks.forEach(task => {\n              if (!task.start_date) {\n                return\n              }\n\n              // link entity to task\n              if (taskTypeElement.for_entity === 'Asset') {\n                task.entity = this.assetMap.get(task.entity_id)\n                task.entity_type_id = task.entity.asset_type_id\n              } else if (taskTypeElement.for_entity === 'Shot') {\n                task.entity = this.shotMap.get(task.entity_id)\n                task.entity_type_id = task.entity.sequence_id\n              } else {\n                task.entity_type_id = taskTypeElement.for_entity\n              }\n              if (task.entity?.canceled) {\n                return\n              }\n\n              if (!tasksByType[task.entity_type_id]) {\n                tasksByType[task.entity_type_id] = {}\n              }\n\n              if (!task.assignees.length) {\n                task.assignees = ['unassigned']\n              }\n\n              task.assignees.forEach(assigneeId => {\n                const entityTypeItem = childrenById.get(task.entity_type_id)\n\n                // populate task with start and end dates\n\n                let startDate\n                if (this.mode === 'real') {\n                  if (!task.real_start_date) {\n                    return\n                  }\n                  startDate = parseDate(task.real_start_date)\n                } else {\n                  startDate = parseDate(task.start_date)\n                }\n                if (startDate.isAfter(this.endDate)) {\n                  return\n                }\n                if (startDate.isBefore(entityTypeItem.startDate)) {\n                  entityTypeItem.startDate = startDate.clone()\n                }\n                task.startDate = startDate\n\n                let endDate\n                if (this.mode === 'real') {\n                  endDate = task.done_date\n                    ? parseDate(task.done_date)\n                    : moment.tz()\n                } else if (task.due_date) {\n                  endDate = parseDate(task.due_date)\n                } else if (task.end_date) {\n                  endDate = parseDate(task.end_date)\n                } else if (task.estimation) {\n                  endDate = addBusinessDays(\n                    task.startDate,\n                    Math.ceil(\n                      minutesToDays(this.organisation, task.estimation)\n                    ) - 1,\n                    this.daysOffByPerson[assigneeId]\n                  )\n                }\n                if (!endDate || endDate.isBefore(startDate)) {\n                  const nbDays = startDate.isoWeekday() === 5 ? 3 : 1\n                  endDate = startDate.clone().add(nbDays, 'days')\n                }\n                if (!endDate.isSameOrAfter(startDate)) {\n                  const nbDays = startDate.isoWeekday() === 5 ? 3 : 1\n                  endDate = startDate.clone().add(nbDays, 'days')\n                }\n                if (endDate.isBefore(this.startDate)) {\n                  return\n                }\n                if (endDate.isAfter(entityTypeItem.endDate)) {\n                  entityTypeItem.endDate = endDate.clone()\n                }\n                task.endDate = endDate\n\n                if (!tasksByType[task.entity_type_id][assigneeId]) {\n                  tasksByType[task.entity_type_id][assigneeId] = []\n                  people[assigneeId] =\n                    assigneeId !== 'unassigned'\n                      ? {\n                          ...this.personMap.get(assigneeId),\n                          daysOff: this.daysOffByPerson[assigneeId]\n                        }\n                      : {\n                          id: assigneeId,\n                          avatar: false,\n                          color: '#888',\n                          full_name: this.$t('main.unassigned')\n                        }\n                }\n\n                task.editable = !this.isLockedSchedule\n                task.unresizable = false\n                task.parentElement = entityTypeItem\n\n                tasksByType[task.entity_type_id][assigneeId].push(task)\n              })\n            })\n\n            if (taskTypeElement.for_entity === 'Asset') {\n              // filtering following custom asset types workflow\n              children = children.filter(item => {\n                const assetType = this.assetTypeMap.get(item.object_id)\n                return (\n                  assetType &&\n                  (!assetType.task_types.length ||\n                    assetType.task_types.includes(taskTypeElement.task_type_id))\n                )\n              })\n            }\n\n            // sort grouped tasks\n            const sortEntitiesByUserName = ([keyA], [keyB]) => {\n              if (keyA === 'unassigned') return 1\n              if (keyB === 'unassigned') return -1\n              return people[keyA].full_name.localeCompare(\n                people[keyB].full_name\n              )\n            }\n            const sortTasksByEntityName = (a, b) =>\n              a.entity?.name.localeCompare(b.entity?.name, undefined, {\n                numeric: true\n              })\n            children.forEach(child => {\n              const items = tasksByType[child.object_id] || {}\n              const sortedChildren = new Map(\n                Object.entries(items)\n                  .sort(sortEntitiesByUserName)\n                  .map(([key, tasks]) => [\n                    key,\n                    tasks.sort(sortTasksByEntityName)\n                  ])\n              )\n\n              child.children = sortedChildren\n            })\n\n            taskTypeElement.children = sortByName(children)\n            taskTypeElement.people = people\n\n            // group all assigned entities by type\n            taskTypeElement.entitiesByType = Object.fromEntries(\n              Object.entries(tasksByType).map(([entityTypeId, byAssignee]) => [\n                entityTypeId,\n                Object.entries(byAssignee)\n                  .flatMap(([assignee, items]) =>\n                    assignee !== 'unassigned'\n                      ? items.map(item => item.entity_id)\n                      : undefined\n                  )\n                  .filter(Boolean)\n              ])\n            )\n          }\n        } catch (err) {\n          console.error(err)\n          taskTypeElement.children = []\n          taskTypeElement.people = []\n        } finally {\n          taskTypeElement.loading = false\n        }\n\n        if (refreshScheduleCallBack) {\n          refreshScheduleCallBack(taskTypeElement)\n        }\n\n        this.selectTaskTypeElement(taskTypeElement, null, resetAssignments)\n      }\n    },\n\n    filteredAssignments(items) {\n      return this.assignments.assigned\n        ? items\n        : items.filter(item => !item.assigned)\n    },\n\n    saveTaskChanged(task) {\n      if (this.isVersioned) {\n        return this.updateScheduleVersionedTask({\n          id: task.versionedTaskId,\n          estimation: task.estimation,\n          startDate: task.startDate.format('YYYY-MM-DD'),\n          dueDate: task.endDate.format('YYYY-MM-DD'),\n          assignees: task.assignees\n        })\n      } else {\n        return this.updateTask({\n          taskId: task.id,\n          data: {\n            estimation: task.estimation,\n            start_date: task.startDate.format('YYYY-MM-DD'),\n            due_date: task.endDate.format('YYYY-MM-DD')\n          }\n        })\n      }\n    },\n\n    async onScheduleItemChanged(item) {\n      if (item.type === 'Task') {\n        // update dates with weekends and days off\n        const daysOff = item.assignees\n          .flatMap(assigneeId => this.daysOffByPerson[assigneeId])\n          .filter(Boolean)\n        item.startDate = addBusinessDays(item.startDate, 0, daysOff)\n        item.endDate = addBusinessDays(\n          item.startDate,\n          Math.ceil(minutesToDays(this.organisation, item.estimation)) - 1,\n          daysOff\n        )\n        // update parents\n        if (item.startDate.isBefore(item.parentElement.startDate)) {\n          item.parentElement.startDate = item.startDate.clone()\n          this.updateScheduleItem(item.parentElement)\n          if (\n            item.parentElement.startDate.isBefore(\n              item.parentElement.parentElement.startDate\n            )\n          ) {\n            item.parentElement.parentElement.startDate =\n              item.parentElement.startDate.clone()\n            this.updateScheduleItem(item.parentElement.parentElement)\n          }\n        }\n        if (item.endDate.isAfter(item.parentElement.endDate)) {\n          item.parentElement.endDate = item.endDate.clone()\n          this.updateScheduleItem(item.parentElement)\n          if (\n            item.parentElement.endDate.isAfter(\n              item.parentElement.parentElement.endDate\n            )\n          ) {\n            item.parentElement.parentElement.endDate =\n              item.parentElement.endDate.clone()\n            this.updateScheduleItem(item.parentElement.parentElement)\n          }\n        }\n        await this.saveTaskChanged(item)\n        return\n      }\n\n      if (item.startDate && item.endDate && item.parentElement) {\n        item.parentElement.startDate = this.getMinDate(item.parentElement)\n        item.parentElement.endDate = this.getMaxDate(item.parentElement)\n        if (!this.isVersioned) {\n          this.saveScheduleItem(item.parentElement)\n        }\n      } else if (!item.parentElement) {\n        const minDate = this.getMinDate(item)\n        const maxDate = this.getMaxDate(item)\n        if (item.startDate.isAfter(minDate)) {\n          item.startDate = minDate\n        }\n        if (item.endDate.isBefore(maxDate)) {\n          item.endDate = maxDate\n        }\n      }\n\n      await this.updateScheduleItem(item)\n    },\n\n    async updateScheduleItem(item) {\n      const scheduleItem = this.scheduleItems.find(\n        scheduleItem => scheduleItem === item\n      )\n      if (scheduleItem) {\n        scheduleItem.startDate = item.startDate\n        scheduleItem.start_date = item.startDate.format('YYYY-MM-DD')\n        scheduleItem.endDate = item.endDate\n        scheduleItem.end_date = item.endDate.format('YYYY-MM-DD')\n      }\n      if (!this.isVersioned) {\n        await this.saveScheduleItem(item)\n      }\n    },\n\n    getMinDate(parentElement) {\n      let minDate = this.endDate.clone()\n      parentElement.children.forEach(item => {\n        if (item.startDate && item.startDate.isBefore(minDate)) {\n          minDate = item.startDate\n        }\n      })\n      return minDate.clone()\n    },\n\n    getMaxDate(parentElement) {\n      let maxDate = this.startDate.clone()\n      parentElement.children.forEach(item => {\n        if (item.endDate && item.endDate.isAfter(maxDate)) {\n          maxDate = item.endDate\n        }\n      })\n      return maxDate.clone()\n    },\n\n    isInDepartment(taskType) {\n      if (this.isCurrentUserManager) {\n        return true\n      } else if (this.isCurrentUserSupervisor) {\n        if (this.user.departments.length === 0) {\n          return true\n        } else {\n          return (\n            taskType.department_id &&\n            this.user.departments.includes(taskType.department_id)\n          )\n        }\n      } else {\n        return false\n      }\n    },\n\n    scrollScheduleToToday() {\n      this.$refs.schedule?.scrollToToday()\n    },\n\n    resetSidePanel() {\n      this.assignments = {\n        ...this.assignments,\n        entityTypes: null,\n        excludes: [],\n        forcedDailyQuota: null,\n        loading: false,\n        saving: false,\n        startDate: null,\n        endDate: null,\n        task: {},\n        type: null,\n        unassign: false\n      }\n    },\n\n    toggleSidePanel() {\n      if (this.isSidePanelOpen && this.assignments.type === 'task') {\n        this.assignments.type = null\n        this.isSidePanelOpen = false\n      }\n\n      this.isSidePanelOpen = !this.isSidePanelOpen\n\n      if (\n        this.isSidePanelOpen &&\n        this.assignments.type !== 'task' &&\n        !this.assignments.entityTypes &&\n        this.selectedTaskType\n      ) {\n        this.selectTaskTypeElement(this.selectedTaskType)\n      }\n    },\n\n    selectParentElement(element) {\n      if (!element.expanded) {\n        this.expandTaskTypeElement(element, () => {\n          this.$refs.schedule?.refreshItemPositions(element)\n        })\n      } else {\n        this.selectTaskTypeElement(element)\n      }\n    },\n\n    onSelectTaskType(taskTypeId) {\n      this.selectedTaskType = this.scheduleItems.find(\n        item => item.task_type_id === taskTypeId\n      )\n      // refresh schedule\n      this.expandTaskTypeElement(\n        this.selectedTaskType,\n        () => {\n          this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)\n        },\n        true,\n        false\n      )\n    },\n\n    async selectTaskTypeElement(\n      taskType,\n      selectedEntityType = undefined,\n      resetAssignments = true\n    ) {\n      if (this.isTVShow) {\n        return\n      }\n\n      this.selectedTaskType = taskType\n\n      if (resetAssignments) {\n        this.resetSidePanel()\n      }\n\n      this.assignments.loading = true\n\n      // load tasks\n      const tasks = await this.loadTasks({\n        project_id: this.currentProduction.id,\n        task_type_id: this.selectedTaskType.task_type_id,\n        relations: 'true'\n      })\n\n      // load entity types\n      if (taskType.for_entity === 'Asset') {\n        await this.loadAssets({ withShared: false, withTasks: false })\n\n        this.assignments.entityTypes = this.productionAssetTypes\n          .filter(assetType => {\n            // filtering following custom asset types workflow\n            return (\n              !assetType.task_types.length ||\n              assetType.task_types.includes(taskType.task_type_id)\n            )\n          })\n          .map(assetType => {\n            return {\n              id: assetType.id,\n              name: assetType.name,\n              for_entity: taskType.for_entity,\n              expanded: assetType.id === selectedEntityType?.object_id,\n              entity_type_id: assetType.id,\n              children: this.assets\n                .filter(\n                  asset =>\n                    asset.asset_type_id === assetType.id &&\n                    !asset.canceled &&\n                    !asset.shared &&\n                    tasks.some(task => task.entity_id === asset.id)\n                )\n                .map(asset => ({\n                  ...asset,\n                  assigned: taskType.entitiesByType[assetType.id]?.includes(\n                    asset.id\n                  )\n                }))\n            }\n          })\n      } else if (taskType.for_entity === 'Shot') {\n        await this.loadShots()\n\n        const shotsBySequence = this.shots\n          .filter(shot => tasks.some(task => task.entity_id === shot.id))\n          .reduce((acc, shot) => {\n            if (!acc[shot.parent_id]) {\n              acc[shot.parent_id] = []\n            }\n            shot.assigned = taskType.entitiesByType[shot.parent_id]?.includes(\n              shot.id\n            )\n            acc[shot.parent_id].push(shot)\n            return acc\n          }, {})\n\n        this.assignments.entityTypes = Object.keys(shotsBySequence).map(\n          sequenceId => {\n            const shots = shotsBySequence[sequenceId]\n            return {\n              id: sequenceId,\n              name: shots[0].sequence_name,\n              for_entity: taskType.for_entity,\n              expanded: sequenceId === selectedEntityType?.object_id,\n              children: shots\n            }\n          }\n        )\n      }\n      this.assignments.loading = false\n    },\n\n    selectTaskElement(taskType, entityType, task, selection) {\n      if (selection.length !== 1) {\n        this.closeSidePanel()\n        return\n      }\n\n      this.resetSidePanel()\n\n      this.isSidePanelOpen = true\n      this.selectedTaskType = taskType\n      this.draggedEntities = [{ ...entityType, children: [{ ...task.entity }] }]\n\n      this.assignments.type = 'task'\n\n      const start_date = taskType.start_date\n      const end_date = parseDate(start_date).isAfter(taskType.end_date)\n        ? start_date\n        : taskType.end_date\n      this.assignments.startDate = start_date\n      this.assignments.endDate = end_date\n      this.assignments.task = {\n        ...task,\n        estimation: minutesToDays(this.organisation, task.estimation),\n        startDate: task.startDate.format('YYYY-MM-DD'),\n        endDate: task.endDate.format('YYYY-MM-DD')\n      }\n      this.assignments.excludes = this.team\n        .filter(person => !task.assignees.includes(person.id))\n        .map(person => person.id)\n      this.assignments.unassign = true\n    },\n\n    closeSidePanel() {\n      this.isSidePanelOpen = false\n      this.resetSidePanel()\n    },\n\n    onAssignmentItemSelected(item) {\n      const today = moment().utc().toDate()\n      this.assignments.type = 'entity'\n      this.assignments.startDate = item.start_date || today\n      this.assignments.endDate = item.end_date || today\n\n      item.children = this.filteredAssignments(item.children)\n      this.draggedEntities = [item]\n    },\n\n    onAssignmentItemDragStart(event, item, type) {\n      event.stopPropagation()\n      event.dataTransfer.dropEffect = 'move'\n      event.dataTransfer.effectAllowed = 'move'\n      event.dataTransfer.setData(`task-type-${type.task_type_id}`, true) // use for hack on drag over (must be lowercase)\n      event.dataTransfer.setData('taskTypeId', type.task_type_id)\n      event.dataTransfer.setData('entityId', item.id)\n\n      item.children = this.filteredAssignments(item.children)\n      this.draggedEntities = [item]\n    },\n\n    onScheduleItemDropped(event, item) {\n      this.assignments.type = 'entity'\n      const start_date = event.start_date || item.start_date\n      const end_date = parseDate(start_date).isAfter(item.end_date)\n        ? start_date\n        : item.end_date\n      this.assignments.startDate = start_date\n      this.assignments.endDate = end_date\n    },\n\n    removeFromAssignments(person) {\n      this.assignments.excludes.push(person.id)\n    },\n\n    submitAssignments() {\n      if (this.assignments.type === 'entity') {\n        this.saveAssignments()\n      } else if (this.assignments.type === 'task') {\n        this.saveTask()\n      }\n    },\n\n    async saveAssignments() {\n      this.assignments.saving = true\n\n      // load tasks\n      const tasks = await this.loadTasks({\n        project_id: this.currentProduction.id,\n        task_type_id: this.selectedTaskType.task_type_id,\n        relations: 'true'\n      })\n\n      const dailyQuota =\n        this.assignments.forcedDailyQuota ?? this.estimatedDailyQuota\n      const taskEstimation = 1 / dailyQuota\n\n      // assign each selected entity to each selected assignee\n      for (const taskType of this.draggedEntities) {\n        const startDate = parseDate(this.assignments.startDate)\n        const endDate = parseDate(this.assignments.endDate)\n\n        let cumulatedTasks = 0\n        let nextAssigneeIndex = 0\n        let nextStartDate = startDate.clone()\n\n        // distribute the task assignments according to the daily quotas, the task type duration and people's availability.\n        for (const entity of taskType.children) {\n          const task = tasks.find(task => task.entity_id === entity.id)\n          if (!task) {\n            continue // no task found for this entity\n          }\n\n          let versionedTask\n          if (this.isVersioned) {\n            const versionedTasks = await this.loadTasksFromScheduleVersion({\n              version: { id: this.version },\n              taskType: { id: task.task_type_id }\n            })\n            versionedTask = versionedTasks.find(t => t.task_id === task.id) ?? {\n              taskId: task.id,\n              version: this.version,\n              assignees: []\n            }\n            task.versionedTaskId = versionedTask.id\n          }\n\n          if (this.assignments.unassign) {\n            if (this.isVersioned) {\n              versionedTask.assignees = []\n            } else {\n              await this.unassignSelectedTasks({ taskIds: [task.id] })\n            }\n          }\n\n          cumulatedTasks++\n\n          let taskStartDate = nextStartDate\n          let taskEndDate = null\n          while (nextAssigneeIndex < this.availablePersons.length) {\n            const taskAssignee = this.availablePersons[nextAssigneeIndex]\n\n            taskStartDate = addBusinessDays(\n              taskStartDate,\n              0,\n              this.daysOffByPerson[taskAssignee.id]\n            )\n\n            const { due_date } = getDatesFromStartDate(\n              this.organisation,\n              startDate,\n              taskEndDate,\n              cumulatedTasks * taskEstimation,\n              this.daysOffByPerson[taskAssignee.id]\n            )\n            taskEndDate = parseDate(due_date)\n\n            if (taskEndDate.isAfter(endDate)) {\n              // try to assign the task to the next available person\n              nextAssigneeIndex++\n              cumulatedTasks = 1\n              taskStartDate = startDate.clone()\n              taskEndDate = null\n            } else {\n              if (this.isVersioned) {\n                versionedTask.startDate = taskStartDate.format('YYYY-MM-DD')\n                versionedTask.dueDate = taskEndDate.format('YYYY-MM-DD')\n                versionedTask.estimation = daysToMinutes(\n                  this.organisation,\n                  taskEstimation\n                )\n                versionedTask.assignees.push(taskAssignee.id)\n\n                // save versioned task\n                if (!versionedTask.id) {\n                  await this.createScheduleVersionedTask(versionedTask)\n                } else {\n                  await this.updateScheduleVersionedTask(versionedTask)\n                }\n              } else {\n                await Promise.all([\n                  // assign task to the current assignee\n                  this.assignSelectedTasks({\n                    personId: taskAssignee.id,\n                    taskIds: [task.id]\n                  }),\n                  // save task dates & estimation\n                  this.updateTask({\n                    taskId: task.id,\n                    data: {\n                      estimation: daysToMinutes(\n                        this.organisation,\n                        taskEstimation\n                      ),\n                      start_date: taskStartDate.format('YYYY-MM-DD'),\n                      due_date: taskEndDate.format('YYYY-MM-DD')\n                    }\n                  })\n                ])\n              }\n              // set next start date\n              if ((cumulatedTasks * taskEstimation) % 1 !== 0) {\n                nextStartDate = taskEndDate.clone()\n              } else {\n                nextStartDate = taskEndDate.clone().add(1, 'days')\n              }\n              break // jump to next task\n            }\n          }\n        }\n\n        // refresh schedule\n        this.expandTaskTypeElement(\n          this.selectedTaskType,\n          () => {\n            this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)\n          },\n          true,\n          false\n        )\n      }\n\n      this.assignments.saving = false\n    },\n\n    async saveTask() {\n      this.assignments.saving = true\n      try {\n        const task = {\n          ...this.assignments.task,\n          startDate: parseDate(this.assignments.task.startDate),\n          endDate: parseDate(this.assignments.task.endDate),\n          estimation: daysToMinutes(\n            this.organisation,\n            this.assignments.task.estimation\n          ),\n          assignees: this.availablePersons.map(person => person.id)\n        }\n        // update task and assignments\n        await this.onScheduleItemChanged(task)\n        if (!this.isVersioned) {\n          await this.unassignSelectedTasks({ taskIds: [task.id] })\n          await Promise.all(\n            task.assignees.map(personId =>\n              this.assignSelectedTasks({\n                personId,\n                taskIds: [task.id]\n              })\n            )\n          )\n        }\n        // refresh task in side panel\n        this.assignments.task.startDate = task.startDate.format('YYYY-MM-DD')\n        this.assignments.task.endDate = task.endDate.format('YYYY-MM-DD')\n        // refresh schedule\n        this.expandTaskTypeElement(\n          this.selectedTaskType,\n          () => {\n            this.$refs.schedule?.refreshItemPositions(this.selectedTaskType)\n          },\n          true,\n          false\n        )\n      } catch (err) {\n        console.error(err)\n      } finally {\n        this.assignments.saving = false\n      }\n    },\n\n    async onScheduleExpandAll() {\n      if (this.loading.expandSchedule) return\n\n      this.loading.expandSchedule = true\n      if (!this.expandAll) {\n        await this.expandAllScheduleItems()\n      } else {\n        this.collapseAllScheduleItems()\n      }\n      this.expandAll = !this.expandAll\n      this.loading.expandSchedule = false\n    },\n\n    async onScheduleItemAssigned(task, personId) {\n      // update task to refresh the schedule\n      task.assignees.push(personId)\n      task.parentElement.children.get(personId).push(task)\n\n      // save change\n      if (this.isVersioned) {\n        return this.updateScheduleVersionedTask({\n          id: task.versionedTaskId,\n          assignees: task.assignees\n        })\n      } else {\n        await this.assignSelectedTasks({\n          personId,\n          taskIds: [task.id]\n        })\n      }\n    },\n\n    async onScheduleItemUnassigned(task, personId) {\n      // update task to refresh the schedule\n      task.assignees = task.assignees.filter(id => id !== personId)\n      const tasks = task.parentElement.children.get(personId)\n      tasks.splice(tasks.indexOf(task), 1)\n\n      // save change\n      if (this.isVersioned) {\n        return this.updateScheduleVersionedTask({\n          id: task.versionedTaskId,\n          assignees: task.assignees\n        })\n      } else {\n        await this.unassignPersonFromTask({\n          person: { id: personId },\n          task\n        })\n      }\n    },\n\n    onZoomLevelChanged(zoom) {\n      this.updateRoute({ zoom })\n    },\n\n    onEntityTypeChanged(type) {\n      this.updateRoute({ type })\n    },\n\n    onModeChanged(mode) {\n      this.updateRoute({ mode })\n      this.closeSidePanel()\n      this.refreshSchedule()\n    },\n\n    onVersionChanged(version) {\n      this.updateRoute({ version })\n      this.closeSidePanel()\n      this.refreshSchedule()\n    },\n\n    refreshSchedule() {\n      this.scheduleItems.forEach(item => {\n        if (!item.expanded) {\n          return\n        }\n        // refresh schedule\n        this.expandTaskTypeElement(\n          item,\n          () => {\n            this.$refs.schedule?.refreshItemPositions(item)\n          },\n          true,\n          false\n        )\n      })\n    },\n\n    openEditScheduleVersion(scheduleVersion = {}) {\n      this.scheduleVersionToEdit = scheduleVersion\n      this.modals.editScheduleVersion = true\n    },\n\n    openDeleteScheduleVersion(versionId) {\n      this.scheduleVersionToEdit = this.scheduleVersions.find(\n        ({ id }) => id === versionId\n      )\n      this.modals.deleteScheduleVersion = true\n    },\n\n    async editVersion(version) {\n      this.modals.editScheduleVersion = false\n      if (!version.id) {\n        const newVersion = await this.createScheduleVersion({\n          production: this.currentProduction,\n          version\n        })\n        this.version = newVersion.id\n        this.onVersionChanged(this.version)\n      } else {\n        await this.updateScheduleVersion(version)\n      }\n      this.scheduleVersionToEdit = {}\n    },\n\n    async deleteVersion(version) {\n      this.modals.deleteScheduleVersion = false\n      await this.deleteScheduleVersion(version)\n      if (this.version === version.id) {\n        this.version = DEFAULT_VERSION\n        this.onVersionChanged(this.version)\n      }\n      this.scheduleVersionToEdit = {}\n    },\n\n    async applyToProduction() {\n      this.loading.applyScheduleVersion = true\n      this.errors.applyScheduleVersion = false\n      try {\n        await this.applyScheduleVersionToProduction(this.version)\n        this.modals.applyScheduleVersion = false\n      } catch (err) {\n        console.error(err)\n        this.errors.applyScheduleVersion = true\n      } finally {\n        this.loading.applyScheduleVersion = false\n      }\n      // refresh version list\n      await this.loadScheduleVersions(this.currentProduction)\n    },\n\n    async expandAllScheduleItems() {\n      // run sequentially to avoid overloading the server\n      for (const element of this.scheduleItems) {\n        if (!element.expanded) {\n          await this.expandTaskTypeElement(\n            element,\n            () => {\n              this.$refs.schedule?.refreshItemPositions(element)\n            },\n            true,\n            false\n          )\n        }\n      }\n    },\n\n    collapseAllScheduleItems() {\n      this.scheduleItems.forEach(element => {\n        element.expanded = false\n      })\n    },\n\n    async exportSchedule(expandAll = true) {\n      this.loading.exportSchedule = true\n\n      try {\n        if (expandAll) {\n          await this.expandAllScheduleItems()\n        }\n\n        const data = this.$refs.schedule?.exportData()\n\n        const ExcelJS = (await import('exceljs')).default\n        const workbook = new ExcelJS.Workbook()\n        const sheet = workbook.addWorksheet(this.$t('schedule.title'))\n\n        // init header\n        const header = ['', 'Task Type', 'Entity', 'Assignee', 'Description']\n        const dates = data.header.map(item => item.format('YYYY-MM-DD'))\n        const headerRow = sheet.addRow([...header, ...dates])\n\n        headerRow.font = { bold: true }\n        headerRow.eachCell(cell => {\n          cell.fill = {\n            type: 'pattern',\n            pattern: 'solid',\n            fgColor: { argb: 'FFDDDDDD' } // grey light\n          }\n          cell.border = {\n            bottom: { style: 'thin' }\n          }\n        })\n        const datesColumn = header.length + 1\n\n        // level 1: Task Types\n        let startRowLevel1 = 2\n        let endRowLevel1 = null\n        data.hierarchy.forEach(item => {\n          endRowLevel1 = startRowLevel1\n\n          const row = sheet.addRow([null, item.name])\n          row.getCell(1).fill = {\n            type: 'pattern',\n            pattern: 'solid',\n            fgColor: { argb: item.color.slice(1) }\n          }\n          row.getCell(2).alignment = { vertical: 'top' }\n          row.getCell(2).note =\n            `${item.name}\\n${item.start_date} - ${item.end_date}`\n          row.height = 30\n\n          // fill timebar\n          const start = dates.indexOf(item.start_date)\n          const end = dates.indexOf(item.end_date)\n          const color = item.color.slice(1)\n          const color2 = colors.lightenColor(item.color, 0.2).hex().slice(1)\n          for (let i = start; i > -1 && i <= end; i++) {\n            const cell = row.getCell(5 + i)\n            cell.fill = {\n              type: 'pattern',\n              pattern: 'solid',\n              fgColor: { argb: color }\n            }\n          }\n\n          endRowLevel1++\n\n          // level 2: Entity Types\n          let startRowLevel2 = endRowLevel1\n          let endRowLevel2 = null\n          item.children.forEach(type => {\n            endRowLevel2 = startRowLevel2\n\n            const row = sheet.addRow([null, null, type.name, ''])\n            row.getCell(3).alignment = { vertical: 'top' }\n            row.getCell(3).note =\n              `${type.name}\\n${type.start_date} - ${type.end_date}`\n\n            // fill timebar\n            const start = dates.indexOf(type.start_date)\n            const end = dates.indexOf(type.end_date)\n            for (let i = start; i > -1 && i <= end; i++) {\n              const cell = row.getCell(datesColumn + i)\n              cell.fill = {\n                type: 'pattern',\n                pattern: 'solid',\n                fgColor: { argb: color2 }\n              }\n            }\n\n            endRowLevel1++\n            endRowLevel2++\n\n            // level 3: Persons\n            let startRowLevel3 = endRowLevel2\n            let endRowLevel3 = null\n            type.children.forEach((tasks, assigneeId) => {\n              endRowLevel3 = startRowLevel3\n              const isAssigned = assigneeId !== 'unassigned'\n\n              const assignee = isAssigned\n                ? this.personMap.get(assigneeId)\n                : {\n                    id: assigneeId,\n                    avatar: false,\n                    color: '#888',\n                    full_name: this.$t('main.unassigned')\n                  }\n\n              const row = sheet.addRow([\n                null,\n                null,\n                null,\n                assignee.full_name,\n                isAssigned ? this.$t('days_off.title') : null\n              ])\n              row.getCell(4).alignment = { vertical: 'top' }\n              row.getCell(5).alignment = { vertical: 'middle' }\n\n              // fill days off\n              const daysOff = getDayOffRange(this.daysOffByPerson[assigneeId])\n              daysOff.forEach(dayOff => {\n                const index = dates.findIndex(date => date === dayOff.date)\n                if (index !== -1) {\n                  const cell = row.getCell(datesColumn + index)\n                  cell.note = `${this.$t('days_off.title')}\\n${dayOff.description}`\n                  cell.fill = {\n                    type: 'pattern',\n                    pattern: 'solid',\n                    fgColor: { argb: 'FFAAAAAA' } // grey dark\n                  }\n                }\n              })\n\n              endRowLevel1++\n              endRowLevel2++\n              endRowLevel3++\n\n              // level 4: Tasks\n              tasks.forEach(task => {\n                const duration =\n                  this.mode === 'real'\n                    ? this.formatDuration(task.duration)\n                    : this.formatDuration(task.estimation)\n\n                const row = sheet.addRow([\n                  null,\n                  null,\n                  null,\n                  null,\n                  `${task.entity.name} (${duration}md)`\n                ])\n\n                // fill task timebar\n                const start_date = task.startDate.format('YYYY-MM-DD')\n                const end_date = task.endDate.format('YYYY-MM-DD')\n                const startIndex = dates.indexOf(start_date)\n                const endIndex = dates.indexOf(end_date)\n                for (let i = startIndex; i > -1 && i <= endIndex; i++) {\n                  const cell = row.getCell(datesColumn + i)\n                  cell.note = `${task.entity.name}\\n${start_date} - ${end_date}\\n${duration} ${this.$t('schedule.md')}`\n                  cell.fill = {\n                    type: 'pattern',\n                    pattern: 'solid',\n                    fgColor: { argb: color }\n                  }\n                }\n\n                endRowLevel1++\n                endRowLevel2++\n                endRowLevel3++\n              })\n\n              // group cells of level 3\n              sheet.mergeCells(startRowLevel3, 4, endRowLevel3 - 1, 4)\n\n              startRowLevel3 = endRowLevel3\n            })\n\n            // group cells of level 2\n            sheet.mergeCells(startRowLevel2, 3, endRowLevel2 - 1, 3)\n\n            startRowLevel2 = endRowLevel2\n          })\n\n          // group cells of level 1\n          sheet.mergeCells(startRowLevel1, 1, endRowLevel1 - 1, 1)\n          sheet.mergeCells(startRowLevel1, 2, endRowLevel1 - 1, 2)\n\n          // stylize borders\n          sheet.getRow(endRowLevel1 - 1).border = {\n            bottom: {\n              style: 'medium',\n              color: { argb: color }\n            }\n          }\n\n          startRowLevel1 = endRowLevel1\n        })\n\n        // customize columns size\n        sheet.getColumn(1).width = 5\n        for (let i = 0; i < dates.length; i++) {\n          sheet.getColumn(header.length + 1 + i).width = 10\n        }\n        const ajustColumnWidth = (\n          columnIndex,\n          minWidth = 10,\n          maxWidth = 100\n        ) => {\n          const column = sheet.getColumn(columnIndex)\n          let maxLength = minWidth\n          column.eachCell({ includeEmpty: false }, cell => {\n            const cellValue = cell.value ? cell.value.toString() : ''\n            if (cellValue.length > maxLength) {\n              maxLength = cellValue.length\n            }\n          })\n          column.width = Math.min(maxLength, maxWidth)\n        }\n        ajustColumnWidth(2) // task type\n        ajustColumnWidth(3) // entity\n        ajustColumnWidth(4) // assignee\n        ajustColumnWidth(5) // description\n\n        // generate an XLSX file\n        const buffer = await workbook.xlsx.writeBuffer()\n        const filename = `Kitsu - ${this.currentProduction.name} - ${this.$t('schedule.title')}`\n        const mode = this.modeOptions.find(\n          ({ value }) => value === this.mode\n        )?.label\n        const version = this.versionOptions.find(\n          ({ value }) => value === this.version\n        )?.label\n        const release = this.isVersioned ? `${mode} - ${version}` : mode\n        const FileSaver = await import('file-saver')\n        FileSaver.saveAs(new Blob([buffer]), `${filename} (${release}).xlsx`)\n      } catch (err) {\n        console.error(err)\n        alert(this.$t('schedule.export_error'))\n      } finally {\n        this.loading.exportSchedule = false\n      }\n    }\n  },\n\n  watch: {\n    selectedStartDate() {\n      this.startDate = parseDate(this.selectedStartDate)\n      const start_date = this.startDate.format('YYYY-MM-DD')\n      if (\n        this.currentProduction.start_date &&\n        this.currentProduction.start_date !== start_date\n      ) {\n        this.editProduction({\n          ...this.currentProduction,\n          start_date\n        })\n      }\n    },\n\n    selectedEndDate() {\n      this.endDate = parseDate(this.selectedEndDate)\n      const end_date = this.endDate.format('YYYY-MM-DD')\n      if (\n        this.currentProduction.end_date &&\n        this.currentProduction.end_date !== end_date\n      ) {\n        this.editProduction({\n          ...this.currentProduction,\n          end_date\n        })\n      }\n    },\n\n    currentProduction(value) {\n      if (!value) return\n      this.reset()\n    }\n  },\n\n  head() {\n    return {\n      title: `${this.currentProduction.name} | ${this.$t('schedule.title')} - Kitsu`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .project-dates {\n    color: $white-grey;\n    border-bottom: 1px solid $grey;\n  }\n}\n\n.project-dates {\n  border-bottom: 1px solid $white-grey;\n  padding-bottom: 1em;\n\n  .field {\n    padding-bottom: 0;\n    margin-bottom: 0;\n  }\n}\n\n.fixed-page {\n  padding: 1em;\n  padding-top: 90px;\n  padding-left: 2em;\n}\n\n.main-column {\n  display: flex;\n  border: 0;\n  overflow: hidden;\n  flex-direction: column;\n}\n\n.zoom-level {\n  margin-top: -10px;\n}\n\n.ml2 {\n  margin-left: 2em;\n}\n\n.side-column {\n  position: relative;\n  top: -30px;\n  right: -14px;\n  height: calc(100% + 44px);\n  margin-top: 0;\n  padding: 0 1em 1em 1em;\n  background: var(--background-alt);\n  min-height: 100%;\n\n  .close-button {\n    position: absolute;\n    right: 1em;\n  }\n\n  .details {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n}\n\n.assignments {\n  list-style-type: none;\n  margin-left: 0;\n\n  .assignment-item {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: var(--background-selectable);\n    border: 1px solid $grey;\n    margin-top: -1px;\n    padding: 1em 1em 1em 0.5em;\n    cursor: pointer;\n\n    .icon {\n      color: $grey;\n      margin-right: 0.5em;\n      cursor: grab;\n    }\n\n    .name {\n      flex: 1;\n    }\n\n    .expand {\n      cursor: pointer;\n      opacity: 0.5;\n      height: 24px;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n  }\n\n  // odd/event items background\n  &.parent {\n    $alt-background: color-mix(\n      in srgb,\n      var(--background-selectable) 70%,\n      white 30%\n    );\n    > li:nth-child(odd) {\n      > .assignment-item {\n        background: $alt-background;\n      }\n      .assignments.children {\n        > li:nth-child(even) > .assignment-item {\n          background: $alt-background;\n        }\n      }\n    }\n    > li:nth-child(even) {\n      .assignments.children {\n        > li:nth-child(odd) > .assignment-item {\n          background: $alt-background;\n        }\n      }\n    }\n  }\n\n  &.children {\n    margin-left: 2em;\n  }\n\n  .dragged-type {\n    font-size: 12px;\n    font-weight: 600;\n    padding: 5px;\n    margin-bottom: 1em;\n    border-radius: 0.2em;\n    text-align: center;\n  }\n\n  .dragged-items {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.5em;\n    list-style: none;\n    margin: 0;\n  }\n\n  .dragged-item {\n    padding: 0 0.7em;\n    border-radius: 0.2em;\n  }\n\n  .assignees {\n    .reset-assignees {\n      position: absolute;\n      right: 1.5em;\n      opacity: 0.5;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n    td {\n      padding: 0.5em;\n    }\n    tbody {\n      background: var(--background);\n\n      tr {\n        border: 1px solid var(--border);\n      }\n    }\n    .assignee {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n    .person {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n    }\n  }\n\n  .daily-quotas {\n    width: 50px;\n  }\n  .reset-quotas {\n    opacity: 0.5;\n\n    &:hover {\n      opacity: 1;\n    }\n  }\n\n  .estimation {\n    :deep(.input) {\n      font-size: 1rem;\n      padding: 0 1rem;\n      width: 90px;\n    }\n  }\n}\n</style>\n"],"file":"ProductionSchedule-D6jv1qsW.js"}