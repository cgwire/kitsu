import{_ as E,ce as T,cf as M,bU as V,cg as O,b0 as L,r as p,k as h,o as r,w as B,c as m,d as b,e,n as v,t as i,a as P,ac as $,ad as j,ae as F,ap as U,ah as I,ch as A,ci as D,j as N,f as u,ai as R,l as q,O as x,z,F as k,g,G as C,T as H,a4 as G,v as Y,m as K,h as W,ao as J,B as Q}from"./index-bqLtaTTG.js";import{U as X}from"./upload-B3-TR_S4.js";const Z={name:"button-link",components:{DownloadIcon:L,EditIcon:O,PlusIcon:V,RotateCcwIcon:M,TrashIcon:T,UploadIcon:X},props:{text:{type:String},title:{type:String},path:{required:!0,type:[String,Object]},icon:{type:String},isResponsive:{default:!1,type:Boolean}}},tt={key:0,class:"icon is-small"};function ot(t,o,s,w,a,n){const _=p("plus-icon"),l=p("download-icon"),f=p("upload-icon"),y=p("edit-icon"),d=p("trash-icon"),c=p("rotate-ccw-icon"),S=p("router-link");return r(),h(S,{class:"button",title:s.title,to:s.path},{default:B(()=>[s.icon?.startsWith("fa")?(r(),m("span",tt,[e("i",{class:v(`fa ${s.icon}`)},null,2)])):s.icon==="plus"?(r(),h(_,{key:1,class:"icon is-small"})):s.icon==="download"?(r(),h(l,{key:2,class:"icon is-small"})):s.icon==="upload"?(r(),h(f,{key:3,class:"icon is-small"})):s.icon==="edit"?(r(),h(y,{key:4,class:"icon is-small"})):s.icon==="delete"?(r(),h(d,{key:5,class:"icon is-small"})):s.icon==="restore"?(r(),h(c,{key:6,class:"icon is-small"})):b("",!0),s.text?(r(),m("span",{key:7,class:v({"is-hidden-touch":s.isResponsive})},i(s.text),3)):b("",!0)]),_:1},8,["title","to"])}const et=E(Z,[["render",ot]]),st={name:"edit-production-modal",mixins:[I],components:{ComboboxStyled:U,FileUpload:F,ModalFooter:j,TextField:$},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},productionToEdit:{type:Object,required:!0}},emits:["cancel","confirm","fileselected"],data(){return{form:{},formData:null,productionStyleOptions:D,productionTypeOptions:A}},computed:{...P(["productionStatusOptions"])},methods:{runConfirmation(){this.$emit("confirm",this.form)},onFileSelected(t){this.formData=t,this.$emit("fileselected",t)},resetForm(){this.form={name:this.productionToEdit.name,code:this.productionToEdit.code,project_status_id:this.productionToEdit.project_status_id,production_type:this.productionToEdit.production_type||"short",production_style:this.productionToEdit.production_style||"2d3d",fps:this.productionToEdit.fps,ratio:this.productionToEdit.ratio,resolution:this.productionToEdit.resolution}}},watch:{productionToEdit:{immediate:!0,handler(){this.resetForm()}}}},it={class:"modal-content"},nt={class:"box"},at={class:"title"},lt={class:"label"};function dt(t,o,s,w,a,n){const _=p("text-field"),l=p("combobox-styled"),f=p("file-upload"),y=p("modal-footer"),d=N("focus");return r(),m("div",{class:v(["modal",{"is-active":s.active}])},[e("div",{class:"modal-background",onClick:o[0]||(o[0]=c=>t.$emit("cancel"))}),e("div",it,[e("div",nt,[e("h1",at,i(t.$t("productions.edit_title"))+" "+i(s.productionToEdit.name),1),e("form",{onSubmit:o[9]||(o[9]=R(()=>{},["prevent"]))},[q(u(_,{label:t.$t("productions.fields.name"),onEnter:n.runConfirmation,modelValue:a.form.name,"onUpdate:modelValue":o[1]||(o[1]=c=>a.form.name=c)},null,8,["label","onEnter","modelValue"]),[[d]]),u(_,{label:t.$t("productions.fields.code"),onEnter:n.runConfirmation,modelValue:a.form.code,"onUpdate:modelValue":o[2]||(o[2]=c=>a.form.code=c)},null,8,["label","onEnter","modelValue"]),u(l,{class:"field",label:t.$t("productions.fields.status"),"locale-key-prefix":"productions.status.",options:t.productionStatusOptions,modelValue:a.form.project_status_id,"onUpdate:modelValue":o[3]||(o[3]=c=>a.form.project_status_id=c)},null,8,["label","options","modelValue"]),u(l,{class:"field",label:t.$t("productions.fields.type"),"locale-key-prefix":"productions.type.",options:a.productionTypeOptions,modelValue:a.form.production_type,"onUpdate:modelValue":o[4]||(o[4]=c=>a.form.production_type=c)},null,8,["label","options","modelValue"]),u(l,{class:"field",label:t.$t("productions.fields.style"),"locale-key-prefix":"productions.style.",options:a.productionStyleOptions,modelValue:a.form.production_style,"onUpdate:modelValue":o[5]||(o[5]=c=>a.form.production_style=c)},null,8,["label","options","modelValue"]),u(_,{label:t.$t("productions.fields.fps"),type:"number",max:60,step:.001,onEnter:n.runConfirmation,modelValue:a.form.fps,"onUpdate:modelValue":o[6]||(o[6]=c=>a.form.fps=c)},null,8,["label","onEnter","modelValue"]),u(_,{label:t.$t("productions.fields.ratio"),onEnter:n.runConfirmation,modelValue:a.form.ratio,"onUpdate:modelValue":o[7]||(o[7]=c=>a.form.ratio=c)},null,8,["label","onEnter","modelValue"]),u(_,{label:t.$t("productions.fields.resolution"),onEnter:n.runConfirmation,modelValue:a.form.resolution,"onUpdate:modelValue":o[8]||(o[8]=c=>a.form.resolution=c)},null,8,["label","onEnter","modelValue"]),e("div",null,[e("label",lt,i(t.$t("productions.picture")),1),u(f,{label:t.$t("main.csv.upload_file"),accept:".png,.jpg,.jpeg",onFileselected:n.onFileSelected},null,8,["label","onFileselected"])])],32),u(y,{"error-text":t.$t("productions.edit_error"),"is-error":s.isError,"is-loading":s.isLoading,onConfirm:n.runConfirmation,onCancel:o[10]||(o[10]=c=>t.$emit("cancel"))},null,8,["error-text","is-error","is-loading","onConfirm"])])])],2)}const rt=E(st,[["render",dt],["__scopeId","data-v-4a475e00"]]),ct={name:"production-stats",mixins:[z],components:{TaskTypeName:x},props:{stats:{type:Object,default:()=>{}}},data(){return{expanded:!1}},computed:{...P(["taskStatusMap","taskTypeMap"]),expandable(){return this.stats.task_types?.length>0},statusIds(){return Object.keys(this.statsByStatus).sort((t,o)=>this.taskStatusMap.get(t).priority<this.taskStatusMap.get(o).priority)},taskTypes(){const t={Asset:1,Shot:2,Sequence:3,Episode:4,Edit:5,Concept:6};return Object.keys(this.taskTypeStatsMap).map(o=>this.taskTypeMap.get(o)).sort((o,s)=>o.for_entity!==s.for_entity?t[o.for_entity]>t[s.for_entity]:o.priority>s.priority)},taskTypeStatsMap(){const t={};return this.stats.task_types?.forEach(o=>{t[o.task_type_id]||(t[o.task_type_id]={task_type_id:o.task_type_id,amount:0,amount_done:0,total_duration:0,total_estimation:0,task_statuses:[]}),t[o.task_type_id].amount+=o.amount,t[o.task_type_id].amount_done+=o.amount_done,t[o.task_type_id].total_duration+=o.total_duration,t[o.task_type_id].total_estimation+=o.total_estimation,t[o.task_type_id].task_statuses.push(o)}),t},statsByStatus(){const t={};return this.stats.task_types?.forEach(o=>{t[o.task_status_id]||(t[o.task_status_id]=0),t[o.task_status_id]+=o.amount}),t}},methods:{expandStats(){this.expandable&&(this.expanded=!this.expanded)},sortStatuses(t){return t.sort((o,s)=>this.taskStatusMap.get(o.task_status_id).priority<this.taskStatusMap.get(s.task_status_id).priority)}}},ut={class:"nb-tasks"},pt={class:"tag"},mt={class:"tag"},_t={class:"color-wrapper"},ft=["title"],ht={key:0,class:"task-type-stats"},yt={class:"task-type-wrapper flexrow-item"},kt={class:"task-type-wrapper flexrow-item"},bt={class:"task-type-wrapper flexrow-item"},gt={class:"color-wrapper flexrow-item"},Et=["title"];function wt(t,o,s,w,a,n){const _=p("task-type-name");return r(),m("div",{class:v(["project-stats",{expandable:n.expandable}]),onClick:o[0]||(o[0]=(...l)=>n.expandStats&&n.expandStats(...l))},[e("div",ut,[e("span",pt,i(s.stats.amount_done||0)+" "+i(t.$t("tasks.done"))+" / "+i(s.stats.amount||0)+" "+i(t.$t("tasks.tasks")),1),e("span",mt,i(t.formatDuration(s.stats.total_duration))+" "+i(t.isDurationInHours?t.$tc("main.hours_spent",t.formatDuration(s.stats.total_duration)):t.$tc("main.days_spent",t.formatDuration(s.stats.total_duration)))+" / "+i(t.formatDuration(s.stats.total_estimation))+" "+i(t.isDurationInHours?t.$tc("main.hours_estimated",t.formatDuration(s.stats.total_estimation)):t.$tc("main.days_estimated",t.formatDuration(s.stats.total_estimation))),1)]),e("div",_t,[(r(!0),m(k,null,g(n.statusIds,l=>(r(),m("div",{class:"stat",style:C({backgroundColor:t.taskStatusMap.get(l).color,width:`${n.statsByStatus[l]/s.stats.amount*100}%`}),key:l,title:`${t.taskStatusMap.get(l).name} - ${n.statsByStatus[l]} tasks`},null,12,ft))),128))]),a.expanded?(r(),m("div",ht,[(r(!0),m(k,null,g(n.taskTypes,l=>(r(),m("div",{class:"flexrow task-type-stat",key:l.id},[e("div",yt,[u(_,{class:"flexrow-item task-type-name","task-type":l},null,8,["task-type"])]),e("div",kt,i(n.taskTypeStatsMap[l.id].amount_done)+" / "+i(n.taskTypeStatsMap[l.id].amount)+" "+i(t.$t("tasks.tasks")),1),e("div",bt,i(t.formatDuration(n.taskTypeStatsMap[l.id].total_duration))+" / "+i(t.formatDuration(n.taskTypeStatsMap[l.id].total_estimation))+" "+i(t.$tc("main.days")),1),e("div",gt,[(r(!0),m(k,null,g(n.sortStatuses(n.taskTypeStatsMap[l.id].task_statuses),f=>(r(),m("div",{class:"stat",style:C({backgroundColor:t.taskStatusMap.get(f.task_status_id).color,width:`${f.amount/n.taskTypeStatsMap[l.id].amount*100}%`}),key:l.id+f.task_status_id,title:`${t.taskStatusMap.get(f.task_status_id).name} - ${f.amount} tasks`},null,12,Et))),128))])]))),128))])):b("",!0)],2)}const vt=E(ct,[["render",wt],["__scopeId","data-v-d8348b84"]]),Pt={name:"production-list",props:{entries:{type:Array,default:()=>[]},productionStats:{type:Object,default:()=>{}},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},components:{ProductionNameCell:Y,ProductionStats:vt,RowActionsCell:G,TableInfo:H},emits:["delete-clicked","edit-clicked"],computed:{...P(["openProductions","lastProductionScreen"]),closedProductions(){return this.entries.filter(t=>t.project_status_name==="Closed")},productionStatsMap(){return this.productionStats}},methods:{getStatusLocale(t){return{Active:"productions.status.open",Open:"productions.status.open",Closed:"productions.status.closed"}[t]},getProductionStyleLabel(t){return D.find(o=>o.value===t)?.label}}},St={class:"data-list"},Ct={class:"datatable-wrapper"},Dt={class:"datatable multi-section"},Tt={class:"datatable-head"},Mt={scope:"col",class:"name datatable-row-header"},Vt={scope:"col",class:"code"},Ot={scope:"col",class:"type"},Lt={scope:"col",class:"style"},Bt={scope:"col",class:"fps"},$t={scope:"col",class:"ratio"},jt={scope:"col",class:"resolution"},Ft={class:"datatable-body"},Ut={class:"datatable-type-header"},It={scope:"rowgroup",colspan:"6"},At={class:"datatable-row-header"},Nt={class:"datatable-row"},Rt={class:"name datatable-row-header",scope:"row"},qt={class:"code"},xt={class:"type"},zt={class:"style"},Ht={class:"fps"},Gt={class:"ratio"},Yt={class:"resolution"},Kt={key:0,class:"datatable-row"},Wt={colspan:7,class:"datatable-row-stats"},Jt={key:0},Qt={class:"datatable-type-header"},Xt={scope:"rowgroup",colspan:"6"},Zt={class:"datatable-row-header"},to={class:"name datatable-row-header",scope:"row"},oo={class:"code"},eo={class:"type"},so={class:"style"},io={class:"fps"},no={class:"ratio"},ao={class:"resolution"},lo={class:"has-text-centered nb-productions"};function ro(t,o,s,w,a,n){const _=p("production-name-cell"),l=p("row-actions-cell"),f=p("production-stats"),y=p("table-info");return r(),m("div",St,[e("div",Ct,[e("table",Dt,[e("thead",Tt,[e("tr",null,[e("th",Mt,i(t.$t("productions.fields.name")),1),e("th",Vt,i(t.$t("productions.fields.code")),1),e("th",Ot,i(t.$t("productions.fields.type")),1),e("th",Lt,i(t.$t("productions.fields.style")),1),e("th",Bt,i(t.$t("productions.fields.fps")),1),e("th",$t,i(t.$t("productions.fields.ratio")),1),e("th",jt,i(t.$t("productions.fields.resolution")),1),o[0]||(o[0]=e("th",{scope:"col",class:"actions"},null,-1))])]),e("tbody",Ft,[e("tr",Ut,[e("th",It,[e("span",At,i(t.$t("productions.status.open")),1)])]),(r(!0),m(k,null,g(t.openProductions,d=>(r(),m(k,{key:d.id},[e("tr",Nt,[e("th",Rt,[u(_,{"with-avatar":!0,entry:d,"last-production-screen":t.lastProductionScreen},null,8,["entry","last-production-screen"])]),e("td",qt,i(d.code),1),e("td",xt,i(t.$t(`productions.type.${d.production_type||"short"}`)),1),e("td",zt,i(t.$t(`productions.style.${n.getProductionStyleLabel(d.production_style)||"2d3d"}`)),1),e("td",Ht,i(d.fps),1),e("td",Gt,i(d.ratio),1),e("td",Yt,i(d.resolution),1),u(l,{onEditClicked:c=>t.$emit("edit-clicked",d),"hide-delete":!0},null,8,["onEditClicked"])]),Object.keys(s.productionStats).length>0?(r(),m("tr",Kt,[e("td",Wt,[u(f,{stats:n.productionStatsMap[d.id]||{}},null,8,["stats"])])])):b("",!0)],64))),128))]),n.closedProductions.length>0?(r(),m("tbody",Jt,[e("tr",Qt,[e("th",Xt,[e("span",Zt,i(t.$t("productions.status.closed")),1)])]),(r(!0),m(k,null,g(n.closedProductions,d=>(r(),m("tr",{class:"datatable-row",key:d.id},[e("th",to,[u(_,{"with-avatar":!0,entry:d,"last-production-screen":t.lastProductionScreen,"is-link":!1},null,8,["entry","last-production-screen"])]),e("td",oo,i(d.code),1),e("td",eo,i(t.$t(`productions.type.${d.production_type||"short"}`)),1),e("td",so,i(t.$t(`productions.style.${n.getProductionStyleLabel(d.production_style)||"2d3d"}`)),1),e("td",io,i(d.fps),1),e("td",no,i(d.ratio),1),e("td",ao,i(d.resolution),1),u(l,{onEditClicked:c=>t.$emit("edit-clicked",d),onDeleteClicked:c=>t.$emit("delete-clicked",d)},null,8,["onEditClicked","onDeleteClicked"])]))),128))])):b("",!0)])]),u(y,{"is-loading":s.isLoading,"is-error":s.isError},null,8,["is-loading","is-error"]),e("p",lo,i(s.entries.length)+" "+i(t.$tc("productions.number",s.entries.length)),1)])}const co=E(Pt,[["render",ro],["__scopeId","data-v-0e83ca9d"]]),uo={name:"productions",components:{ButtonLink:et,ButtonSimple:Q,HardDeleteModal:J,EditProductionModal:rt,PageTitle:W,ProductionList:co},data(){return{errors:{del:!1,edit:!1},loading:{del:!1,edit:!1,stats:!1},modals:{isEditDisplayed:!1,isDeleteDisplayed:!1},productionStats:{},productionToDelete:null,productionToEdit:null}},computed:{...P(["isProductionsLoading","isProductionsLoadingError","productionAvatarFormData","productions"]),currentLockText(){return this.productionToDelete?.name||""}},async created(){await this.loadProductions()},methods:{...K(["deleteProduction","editProduction","loadProductions","loadProductionStats","storeProductionPicture","uploadProductionAvatar"]),async confirmEditProduction(t){this.loading.edit=!0,this.errors.edit=!1;try{this.productionAvatarFormData&&await this.uploadProductionAvatar(this.productionToEdit.id),await this.editProduction({...t,id:this.productionToEdit.id}),this.modals.isEditDisplayed=!1}catch(o){console.error(o),this.errors.edit=!0}this.loading.edit=!1},confirmDeleteProduction(){this.loading.del=!0,this.errors.del=!1,this.deleteProduction(this.productionToDelete).then(()=>{this.modals.isDeleteDisplayed=!1,this.loading.del=!1}).catch(t=>{console.error(t),this.errors.del=!0,this.loading.del=!1})},deleteText(){const t=this.productionToDelete;return t?this.$t("productions.delete_text",{name:t.name}):""},onEditClicked(t){this.storeProductionPicture(null),this.productionToEdit=t,this.modals.isEditDisplayed=!0},onDeleteClicked(t){this.productionToDelete=t,this.modals.isDeleteDisplayed=!0},onProductionPictureSelected(t){this.storeProductionPicture(t)},async reloadStats(){this.loading.stats=!0,this.productionStats=await this.loadProductionStats(),this.loading.stats=!1}},head(){return{title:`${this.$t("productions.title")} - Kitsu`}}},po={class:"productions page fixed-page"},mo={class:"flexrow page-header"};function _o(t,o,s,w,a,n){const _=p("page-title"),l=p("button-simple"),f=p("button-link"),y=p("production-list"),d=p("edit-production-modal"),c=p("hard-delete-modal");return r(),m("div",po,[e("div",mo,[u(_,{class:"filler",text:t.$t("productions.title")},null,8,["text"]),u(l,{class:"flexrow-item",text:t.$t("productions.load_stats"),"is-loading":a.loading.stats,onClick:n.reloadStats},null,8,["text","is-loading","onClick"]),u(f,{class:"flexrow-item",text:t.$t("productions.new_production"),icon:"plus",path:{name:"new-production"}},null,8,["text"])]),u(y,{entries:t.productions,"production-stats":a.productionStats,"is-loading":t.isProductionsLoading,"is-error":t.isProductionsLoadingError,onDeleteClicked:n.onDeleteClicked,onEditClicked:n.onEditClicked},null,8,["entries","production-stats","is-loading","is-error","onDeleteClicked","onEditClicked"]),a.modals.isEditDisplayed?(r(),h(d,{key:0,active:"","is-loading":a.loading.edit,"is-error":a.errors.edit,"production-to-edit":a.productionToEdit,onCancel:o[0]||(o[0]=S=>a.modals.isEditDisplayed=!1),onFileselected:n.onProductionPictureSelected,onConfirm:n.confirmEditProduction},null,8,["is-loading","is-error","production-to-edit","onFileselected","onConfirm"])):b("",!0),u(c,{active:a.modals.isDeleteDisplayed,"is-loading":a.loading.del,"is-error":a.errors.del,text:n.deleteText(),"error-text":t.$t("productions.delete_error"),"lock-text":n.currentLockText,onCancel:o[1]||(o[1]=S=>a.modals.isDeleteDisplayed=!1),onConfirm:n.confirmDeleteProduction},null,8,["active","is-loading","is-error","text","error-text","lock-text","onConfirm"])])}const yo=E(uo,[["render",_o]]);export{yo as default};
//# sourceMappingURL=Productions-XfIi2K8D.js.map
