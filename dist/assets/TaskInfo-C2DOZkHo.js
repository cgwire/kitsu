import{_ as z,r as k,o as n,g as w,aE as H,S as X,aM as Z,N as G,B as $,K as V,a as Y,l as ee,b as J,c as a,d as o,n as p,t as u,h as d,f as m,k as q,a4 as te,O as W,I as D,w as M,H as _,aN as se,F as C,e as P,R as ie,x as j,J as re,a7 as N,aO as ne,aP as ae,an as oe,s as le,q as de,a8 as ce}from"./index-DF-DoQlt.js";import{c as me}from"./csv-IlynXFQz.js";import{V as ue,P as he,E as ke,C as fe,A as pe,a as ve,t as we,d as Ce}from"./PreviewPlayer-Bpr7Jn1C.js";import{g as ye}from"./render-DYxr_jus.js";import{s as ge}from"./string-B0Tq569e.js";import{d as _e}from"./dom-tO7tlkHV.js";import{B as Se}from"./BuildFilterModal-C18AF9bI.js";import{C as Pe}from"./Combobox-A6pnhVs3.js";import{C as be}from"./ComboboxStatus-CBgYMSHg.js";import{C as Q}from"./ComboboxStyled-BlKJF8gk.js";import{D as Te}from"./DeleteEntities-5LkT8YiQ.js";import{P as Ee}from"./PeopleField-BoranyvF.js";import{S as Ae}from"./SearchField-BdP8lRoc.js";import{C as xe,a as Ve}from"./corner-right-up-xDF204hE.js";import{S as Me}from"./thumbs-up-UCZcudrF.js";import{D as De}from"./DeleteModal-DwXK5r5w.js";import{T as Ie}from"./TaskTypeName-C0px4urt.js";import"./PlaylistPlayer-ByYDRf10.js";import"./ComboboxSimple-B2TmvsnK.js";import"./ComboboxTaskType-C7Rz0ksS.js";import"./ModalFooter-Chk0SGv-.js";import"./TextField-BKWlN2Ov.js";import"./video-Yn96Kb74.js";import"./clipboard-CQqgyZ_h.js";import"./index-Bnig1aiX.js";import"./BaseModal-D3KB-h7q.js";import"./ComboboxDepartment-Cjj8YvK6.js";import"./DepartmentName-DCchDYyW.js";import"./ComboboxStudio-D3qg68ZP.js";import"./play-DUQ3D5JY.js";import"./EmojiButton-CJhEAvTS.js";import"./FileUpload-GCzHM4-i.js";import"./ConfirmModal-BIIMruUl.js";import"./triangle-alert-CW28Rlrw.js";import"./ValidationTag-Cx26FfxH.js";import"./copy-DgQ7ppWI.js";import"./vue.esm-bundler-pS9-uSLU.js";import"./VideoViewer-B89y-Tko.js";import"./ComboboxBoolean-DT116Lfu.js";import"./HardDeleteModal-BLE4oONO.js";const Fe=e=>{if(!e?.length)return[];const[s,...r]=e,c=r.map(i=>new Set(i));return s.filter(i=>c.every(t=>t.has(i)))},Be={name:"combobox-model",components:{Combobox:Pe},props:{label:{default:"",type:String},modelValue:{default:()=>{},type:Object},models:{default:()=>[],type:Array},disabled:{default:!1,type:Boolean}},emits:["enter","update:modelValue"],data(){return{currentModelId:"",modelMap:{},modelOptions:[]}},mounted(){this.reset()},methods:{emitValue(e){this.currentModelId=e;const s=this.modelMap[this.currentModelId];this.$emit("update:modelValue",s)},emitEnter(e){this.currentModelId=e;const s=this.modelMap[this.currentModelId];this.$emit("enter",s)},reset(){this.models.length>0&&(this.currentModelId=this.models.find(e=>e.id===this.modelValue.id)??this.models[0].id,this.modelMap={},this.modelOptions=this.models.map(e=>({label:e.name,value:e.id})),this.models.forEach(e=>{this.modelMap[e.id]=e}))}},watch:{models(){this.reset()}}};function Ue(e,s,r,c,i,t){const h=k("combobox");return n(),w(h,{label:r.label,disabled:r.disabled,options:i.modelOptions,"model-value":i.currentModelId,"onUpdate:modelValue":t.emitValue,onEnter:t.emitEnter},null,8,["label","disabled","options","model-value","onUpdate:modelValue","onEnter"])}const Oe=z(Be,[["render",Ue]]),Re={name:"action-panel",props:{isMoviePreview:{type:Boolean,default:!1},isSetFrameThumbnailLoading:{type:Boolean,default:!1},productionId:{type:String,default:null},team:{type:Array,default:()=>[]}},components:{BuildFilterModal:Se,ButtonSimple:$,CheckSquareIcon:Me,ComboboxModel:Oe,ComboboxStatus:be,ComboboxStyled:Q,DeleteEntities:Te,KitsuIcon:G,LinkIcon:Z,PeopleField:Ee,PlayCircleIcon:xe,SearchField:Ae,Spinner:X,ViewPlaylistModal:ue,XIcon:H},emits:["export-task","set-frame-thumbnail"],data(){return{availableTaskStatuses:[],customAction:{},customActions:[],isUseCurrentFrame:!1,person:null,priority:"0",selectedBar:"",taskStatusId:"",statusComment:"",modals:{buildFilter:!1,playlist:!1},priorityOptions:[{label:this.$t("tasks.priority.normal"),value:"0"},{label:this.$t("tasks.priority.high"),value:"1"},{label:this.$t("tasks.priority.very_high"),value:"2"},{label:this.$t("tasks.priority.emergency"),value:"3"}],loading:{assignation:!1,assetDeletion:!1,changePriority:!1,changeStatus:!1,conceptDeletion:!1,editDeletion:!1,episodeDeletion:!1,taskCreation:!1,taskDeletion:!1,setThumbnails:!1,shotDeletion:!1,links:!1,tasksSubscription:!1},errors:{assetDeletion:!1,taskDeletion:!1,conceptDeletion:!1,editDeletion:!1,episodeDeletion:!1,shotDeletion:!1}}},mounted(){this.customAction=this.defaultCustomAction},beforeUnmount(){window.removeEventListener("keydown",this.onKeyDown)},computed:{...J(["assetsByType","currentProduction","getCustomActionsByType","isCurrentUserArtist","isCurrentUserClient","isCurrentUserManager","isCurrentUserSupervisor","isShowAssignations","nbSelectedTasks","nbSelectedValidations","productionMap","selectedAssets","selectedConcepts","selectedEdits","selectedShots","selectedTasks","taskMap","taskStatusForCurrentUser","taskTypeMap","user"]),assetMap(){return ee.cache.assetMap},minimized(){return this.selectedBar===""},currentUrl(){return this.$route.path},currentHost(){return window.location.host},currentEntityType(){return this.isCurrentViewAsset?"asset":this.isCurrentViewShot?"shot":this.isCurrentViewSequence?"sequence":this.isCurrentViewEdit?"edit":"episode"},currentConcept(){return this.selectedConcepts.values().next().value},conceptLinkedEntities(){return this.getLinkedEntities(this.currentConcept)},currentTeam(){const e=this.isCurrentUserSupervisor&&this.user.departments.length>0;return this.team.filter(s=>s?.is_bot?!1:e?s.departments.length===0||s.departments.some(r=>this.user.departments.includes(r)):!0)},defaultCustomAction(){return this.customActions?.[0]??{}},isTaskSelection(){return this.nbSelectedTasks>0},isEntitySelection(){return this.selectedAssets.size>0||this.selectedShots.size>0||this.selectedEdits.size>0},nbSelectedAssets(){return this.selectedAssets.size},nbSelectedShots(){return this.selectedShots.size},nbSelectedEdits(){return this.selectedEdits.size},nbSelectedConcepts(){return this.selectedConcepts.size},allAssetsCanceled(){return Array.from(this.selectedAssets.values()).every(e=>e.canceled)},allShotsCanceled(){return Array.from(this.selectedShots.values()).every(s=>s.canceled)},allEditsCanceled(){return Array.from(this.selectedEdits.values()).every(e=>e.canceled)},isHidden(){return this.nbSelectedTasks===0&&this.nbSelectedValidations===0&&this.nbSelectedAssets===0&&this.nbSelectedShots===0&&this.nbSelectedEdits===0&&this.nbSelectedConcepts===0||!(this.isCurrentViewAsset||this.isCurrentViewTodos||this.isCurrentViewShot||this.isCurrentViewEpisode||this.isCurrentViewSequence||this.isCurrentViewEdit||this.isCurrentViewConcept)},isConceptPublisher(){return this.currentConcept?.created_by===this.user.id},isCurrentViewSingleEntity(){return["asset","shot","edit","episode","sequence","episode-asset","episode-shot","episode-edit","episode-sequence"].includes(this.$route.name)},isCurrentViewAsset(){return this.$route.path.includes("asset")&&!this.$route.params.shot_id},isCurrentViewShot(){return this.$route.path.includes("shot")&&!this.$route.params.shot_id},isCurrentViewEdit(){return this.$route.path.includes("edit")&&!this.$route.params.edit_id},isCurrentViewConcept(){return this.$route.path.includes("concept")},isCurrentViewTodos(){return this.$route.path.includes("my-tasks")||this.$route.path.includes("people/")},isCurrentViewPerson(){return this.$route.path.includes("people/")},isCurrentViewTaskType(){return this.$route.path.includes("task-type")},isCurrentViewEntity(){return this.isCurrentViewAsset||this.isCurrentViewShot||this.isCurrentViewEdit||this.isCurrentViewSequence||this.isCurrentViewEpisode},isCurrentViewEpisode(){return!(this.isCurrentViewAsset||this.isCurrentViewShot||this.isCurrentViewEdit)&&this.$route.path.includes("episodes")},isCurrentViewSequence(){return!(this.isCurrentViewAsset||this.isCurrentViewShot||this.isCurrentViewEdit)&&this.$route.path.includes("sequences")},selectedPersonId(){return this.person?this.person.id:null},selectedTaskIds(){return Array.from(this.selectedTasks.keys())},isInDepartment(){return this.selectedTaskIds.every(e=>{const s=this.taskMap.get(e);if(s){const r=this.taskTypeMap.get(s.task_type_id);return r.department_id&&this.user.departments.includes(r.department_id)}else return!0})},isSupervisorInDepartment(){return this.isCurrentUserSupervisor&&(this.user.departments.length===0||this.isInDepartment)},storagePrefix(){let e="todos-";return(this.isCurrentViewAsset||this.isCurrentViewShot||this.isCurrentViewEdit)&&(e="entities-"),this.isCurrentViewConcept&&(e="concepts-"),this.isCurrentViewTaskType&&(e="tasks-"),e},availableLinksByType(){return[...this.assetsByType].map(r=>{if(!r.length)return;const c=r.filter(i=>!this.conceptLinkedEntities.some(t=>t.id===i.id)).map(i=>({id:i.id,name:i.name}));return{type:r[0].asset_type_name,links:c}}).filter(Boolean)}},methods:{...Y(["assignSelectedTasks","changeSelectedTaskStatus","changeSelectedPriorities","clearSelectedAssets","clearSelectedShots","clearSelectedEdits","clearSelectedConcepts","clearSelectedTasks","createSelectedTasks","deleteSelectedAssets","deleteSelectedShots","deleteSelectedTasks","deleteSelectedEdits","deleteSelectedEpisodes","deleteSelectedConcepts","editConcept","loadAssets","postCustomAction","setAssetSearch","setLastTaskPreview","subscribeToTask","unassignPersonFromTask","unassignSelectedTasks","unsubscribeFromTask"]),getLinkedEntities(e){return e.entity_concept_links.map(s=>this.assetMap.get(s)).filter(Boolean)},confirmTaskStatusChange(){this.loading.changeStatus=!0,this.taskStatusId||(this.taskStatusId=this.availableTaskStatuses[0].id),this.changeSelectedTaskStatus({taskStatusId:this.taskStatusId,comment:this.statusComment}).then(()=>{this.statusComment="",this.loading.changeStatus=!1}).catch(e=>{console.error(e),this.loading.changeStatus=!1})},async confirmAssign(){if(this.selectedPersonId||this.isInDepartment){const e=this.isCurrentUserManager||this.isCurrentUserSupervisor?this.selectedPersonId:this.user.id;this.loading.assignation=!0;try{await this.assignSelectedTasks({personId:e}),this.$refs["assignation-field"]?.clear()}catch(s){console.error(s)}finally{this.loading.assignation=!1}}},clearAssignation(){const e=this.isCurrentUserArtist?this.user:this.person;e&&(this.loading.assignation=!0,V.runPromiseAsSeries(Array.from(this.selectedTasks.values()).map(s=>this.unassignPersonFromTask({task:s,person:e}))).then(()=>{this.loading.assignation=!1}).catch(console.error))},clearAllAssignations(){return this.loading.assignation=!0,this.unassignSelectedTasks({}).then(()=>{this.loading.assignation=!1}).catch(console.error)},async confirmPriorityChange(){this.loading.changePriority=!0,await this.changeSelectedPriorities({priority:Number(this.priority)}),this.loading.changePriority=!1},confirmTaskCreation(){const e=this.$route.path.includes("shots")?"shots":this.$route.path.includes("assets")?"assets":this.$route.path.includes("edits")?"edits":"episodes";this.loading.taskCreation=!0,this.createSelectedTasks({type:e,projectId:this.productionId}).then(()=>{this.loading.taskCreation=!1}).catch(s=>{this.loading.taskCreation=!1,console.error(s)})},confirmTaskDeletion(){this.loading.taskDeletion=!0,this.errors.taskDeletion=!1,this.deleteSelectedTasks().then(()=>{this.loading.taskDeletion=!1,this.clearSelectedTasks()}).catch(e=>{console.error(e),this.loading.taskDeletion=!1,this.errors.taskDeletion=!0})},confirmAssetDeletion(){this.loading.deleteAsset=!0,this.errors.deleteAsset=!1,this.deleteSelectedAssets().then(()=>{this.loading.deleteAsset=!1,this.clearSelectedAssets()}).catch(e=>{console.error(e),this.loading.deleteAsset=!1,this.errors.deleteAsset=!0})},confirmShotDeletion(){this.loading.deleteShot=!0,this.errors.deleteShot=!1,this.deleteSelectedShots().then(()=>{this.loading.deleteShot=!1,this.clearSelectedShots()}).catch(e=>{console.error(e),this.loading.deleteShot=!1,this.errors.deleteShot=!0})},confirmEditDeletion(){this.loading.deleteEdit=!0,this.errors.deleteEdit=!1,this.deleteSelectedEdits().then(()=>{this.loading.deleteEdit=!1,this.clearSelectedEdits()}).catch(e=>{console.error(e),this.loading.deleteEdit=!1,this.errors.deleteEdit=!0})},confirmConceptDeletion(){this.loading.deleteConcept=!0,this.errors.deleteConcept=!1,this.deleteSelectedConcepts().then(()=>{this.loading.deleteConcept=!1,this.clearSelectedConcepts()}).catch(e=>{console.error(e),this.loading.deleteConcept=!1,this.errors.deleteConcept=!0})},confirmPlaylistGeneration(){this.modals.playlist=!0,this.selectedBar=""},confirmTasksSubscription(){this.loading.tasksSubscription=!0,V.runPromiseAsSeries(Array.from(this.selectedTasks.values()).map(e=>this.subscribeToTask(e.id))).then(()=>{this.loading.tasksSubscription=!1}).catch(e=>{console.error(e),this.loading.tasksSubscription=!1,this.errors.tasksSubscription=!1})},confirmTasksUnsubscription(){this.loading.tasksSubscription=!0,V.runPromiseAsSeries(Array.from(this.selectedTasks.values()).map(e=>this.unsubscribeFromTask(e.id))).then(()=>{this.loading.tasksSubscription=!1}).catch(e=>{console.error(e),this.loading.tasksSubscription=!1,this.errors.tasksSubscription=!1})},hidePlaylistModal(){this.modals.playlist=!1},confirmSetThumbnailsFromTasks(){this.loading.setThumbnails=!0,this.nbSelectedTasks===1?(this.$emit("set-frame-thumbnail",this.isMoviePreview&&this.isUseCurrentFrame),this.loading.setThumbnails=!1):V.runPromiseAsSeries(Array.from(this.selectedTasks.values()).map(e=>this.setLastTaskPreview(e.id))).then(()=>{this.loading.setThumbnails=!1})},runCustomAction(){this.postCustomAction({data:{entitytype:this.currentEntityType,originurl:this.currentUrl,originserver:this.currentHost,selection:this.selectedTaskIds,productionid:this.productionId,userid:this.user.id,useremail:this.user.email},url:this.customAction.url})},onKeyDown(e){e.keyCode===27&&(this.modals.playlist||this.$store.commit("CLEAR_SELECTED_TASKS"))},clearSelection(){this.clearSelectedAssets(),this.clearSelectedShots(),this.clearSelectedTasks(),this.clearSelectedEdits(),this.clearSelectedConcepts()},selectBar(e){localStorage.setItem(`${this.storagePrefix}-selected-bar`,e),this.selectedBar!==e?this.selectedBar=e:this.selectedBar=""},autoChooseSelectBar(){if(this.isHidden)window.removeEventListener("keydown",this.onKeyDown);else{if(window.addEventListener("keydown",this.onKeyDown),this.isCurrentViewAsset&&this.nbSelectedAssets>0){this.selectedBar="delete-assets";return}if(this.isCurrentViewShot&&this.nbSelectedShots>0){this.selectedBar="delete-shots";return}if(this.isCurrentViewEdit&&this.nbSelectedEdits>0){this.selectedBar="delete-edits";return}if(this.isCurrentViewConcept&&this.nbSelectedConcepts>1){this.selectedBar="delete-concepts";return}this.nbSelectedTasks===1&&(this.selectedBar="");const e=localStorage.getItem(`${this.storagePrefix}-selected-bar`);e?this.selectedBar=e:(this.isCurrentViewAsset||this.isCurrentViewShot||this.isCurrentViewEdit)&&(this.selectedBar="change-status")}},setAvailableStatuses(){let e;if(this.selectedTasks.size===0)e=[];else if(this.isCurrentViewTodos){const s=Array.from(this.selectedTasks.values()).map(c=>this.productionMap.get(c.project_id)?.task_statuses).filter(Boolean),r=new Set(Fe(s));e=this.taskStatusForCurrentUser.filter(c=>r.has(c.id))}else e=this.taskStatusForCurrentUser;e=e.filter(s=>!!s.for_concept===this.isCurrentViewConcept),this.availableTaskStatuses=e},onRemoveLink(e){const s={id:this.currentConcept.id,entity_concept_links:this.currentConcept.entity_concept_links.filter(r=>r!==e.id)};this.editConcept(s)},confirmBuildFilter(e){this.modals.buildFilter=!1,this.$refs["entity-search-field"].setValue(e),this.onEntitySearchChange(e)},onEntitySearchChange(e){this.setAssetSearch(e)},onSelectLink(e){const s={id:this.currentConcept.id,entity_concept_links:[...this.currentConcept.entity_concept_links].concat(e.id)};this.editConcept(s)}},watch:{nbSelectedAssets(){this.autoChooseSelectBar(),this.nbSelectedAssets>0&&this.clearSelectedTasks()},nbSelectedShots(){this.autoChooseSelectBar(),this.nbSelectedShots>0&&this.clearSelectedTasks()},nbSelectedEdits(){this.autoChooseSelectBar(),this.nbSelectedEdits>0&&this.clearSelectedTasks()},nbSelectedConcepts(){this.autoChooseSelectBar(),this.nbSelectedConcepts>1&&this.clearSelectedTasks()},isHidden(){this.autoChooseSelectBar()},nbSelectedTasks:{immediate:!0,handler(){if(this.nbSelectedTasks>0){this.setAvailableStatuses();const e={Asset:!1,Shot:!1,Sequence:!1,Edit:!1,Episode:!1};this.selectedTasks.forEach(s=>{const r=this.taskTypeMap.get(s.task_type_id);e[r?.for_entity]=!0}),this.customActions=this.getCustomActionsByType(e.Asset,e.Shot,e.Sequence,e.Edit,e.Episode),this.customActions.length>0&&(this.customAction.url&&this.customActions.findIndex(r=>r.id===this.customAction.id)>=0||(this.customAction=this.customActions[0])),this.nbSelectedTasks===1?(this.lastSelectedBar=this.selectedBar,this.selectedBar):this.lastSelectedBar&&(this.selectedBar,this.lastSelectedBar)}}},$route(e,s){e.name!==s.name&&this.nbSelectedTasks>0&&this.clearSelectedTasks()}}},Le={class:"action-topbar unselectable"},qe={class:"menu flexrow"},ze=["title"],We=["title"],je=["title"],Ne=["title"],Ke=["title"],He=["title"],Xe={key:6,class:"menu-separator"},Ge=["title"],Ye={key:8,class:"menu-separator"},Je=["title"],Qe=["title"],Ze={key:11,class:"menu-separator"},$e=["title"],et=["title"],tt=["title"],st=["title"],it=["title"],rt=["title"],nt=["title"],at={key:0,class:"flexrow action-bar"},ot={key:0,class:"flexcolumn is-wide"},lt={class:"flexrow mb05"},dt={class:"flexrow-item change-status-item"},ct={class:"flexrow-item is-wide"},mt=["placeholder"],ut={class:"flexrow-item is-wide"},ht={key:1,class:"flexcolumn flexrow-item is-wide"},kt={key:0,class:"mb05"},ft={key:1,class:"mb05"},pt={key:2,class:"flexrow-item mt1 mb1"},vt={key:3,class:"flexrow-item is-wide"},wt={class:"flexrow-item mb05 disclaimer"},Ct={key:4,class:"flexrow-item is-wide flexrow"},yt={class:"mauto flexrow"},gt={key:5,class:"flexrow-item hide-small-screen"},_t={key:6,class:"flexrow-item"},St={key:2,class:"flexcolumn filler"},Pt={class:"flexrow-item flexrow priority-combobox mb05"},bt={class:"flexrow-item"},Tt={class:"flexrow-item is-wide"},Et={key:3,class:"flexrow is-wide"},At={key:4,class:"flexrow-item is-wide"},xt={key:1},Vt={key:0,class:"is-inline-block mt05 pointer"},Mt={key:5,class:"flexcolumn filler"},Dt={key:0},It={class:"flexrow-item"},Ft={key:1,class:"flexrow-item is-wide"},Bt={key:2,class:"has-text-centered"},Ut={key:6,class:"flexrow-item is-wide"},Ot={key:7,class:"flexrow-item is-wide"},Rt={class:"mb05"},Lt={class:"tags mb05"},qt={key:0},zt=["onClick"],Wt={key:8,class:"flexrow-item is-wide"},jt={key:9,class:"flexcolumn filler"},Nt={class:"flexrow-item custom-action-combobox is-wide"},Kt={class:"flexrow mt05"},Ht={key:0,class:"flexrow-item is-wide"},Xt=["action"],Gt=["value"],Yt=["value"],Jt=["value"],Qt=["value"],Zt=["value"],$t=["value"],es=["value"],ts={class:"button is-wide",type:"submit"},ss={key:1,class:"flexrow-item is-wide"},is={key:10,class:"flexrow-item is-wide"},rs={key:11,class:"flexrow-item is-wide"},ns={key:12,class:"flexrow-item is-wide"},as={key:13,class:"flexrow-item is-wide"},os={key:14,class:"flexrow-item is-wide"},ls={key:0,class:"flexrow-item is-wide pa1"},ds={ref:"asset-list",class:"concept-links"},cs={class:"subtitle"},ms={class:"flexrow mb2"},us={key:1,class:"link-list"},hs={class:"link-type"},ks={class:"subtitle"},fs={class:"tags"},ps=["onClick"];function vs(e,s,r,c,i,t){const h=k("kitsu-icon"),v=k("link-icon"),T=k("check-square-icon"),y=k("play-circle-icon"),S=k("x-icon"),I=k("combobox-status"),F=k("people-field"),E=k("spinner"),B=k("router-link"),U=k("combobox-styled"),g=k("delete-entities"),O=k("combobox-model"),R=k("search-field"),A=k("button-simple"),L=k("build-filter-modal"),x=k("view-playlist-modal");return n(),a("div",null,[o("div",Le,[o("div",qe,[(e.isCurrentUserManager||t.isSupervisorInDepartment||t.isInDepartment||t.isCurrentViewTodos)&&!t.isEntitySelection&&!t.isCurrentViewConcept&&t.isTaskSelection?(n(),a("div",{key:0,class:p(["menu-item status-item",{active:i.selectedBar==="change-status"}]),title:e.$t("menu.change_status"),onClick:s[0]||(s[0]=l=>t.selectBar("change-status"))},u(e.$t("main.status")),11,ze)):d("",!0),(t.isCurrentViewSingleEntity||t.isCurrentViewEntity)&&(e.isCurrentUserManager||t.isSupervisorInDepartment||t.isInDepartment||t.isCurrentViewSingleEntity)&&!t.isEntitySelection&&t.isTaskSelection&&!e.isCurrentUserArtist?(n(),a("div",{key:1,class:p(["menu-item",{active:i.selectedBar==="assignation"}]),title:e.$t("menu.assign_tasks"),onClick:s[1]||(s[1]=l=>t.selectBar("assignation"))},[m(h,{name:"user-check",active:i.selectedBar==="assignation",title:e.$t("menu.assign_tasks")},null,8,["active","title"])],10,We)):d("",!0),(t.isCurrentViewSingleEntity||t.isCurrentViewEntity||t.isCurrentViewPerson||t.isCurrentViewSingleEntity)&&(e.isCurrentUserManager||t.isSupervisorInDepartment)&&!t.isEntitySelection&&t.isTaskSelection?(n(),a("div",{key:2,class:p(["menu-item",{active:i.selectedBar==="priorities"}]),title:e.$t("menu.change_priority"),onClick:s[2]||(s[2]=l=>t.selectBar("priorities"))},[m(h,{name:"priority",active:i.selectedBar==="priorities",title:e.$t("menu.change_priority")},null,8,["active","title"])],10,je)):d("",!0),t.isTaskSelection&&!e.isCurrentUserArtist&&!t.isCurrentViewConcept?(n(),a("div",{key:3,class:p(["menu-item",{active:i.selectedBar==="thumbnails"}]),title:e.$t("menu.set_thumbnails"),onClick:s[3]||(s[3]=l=>t.selectBar("thumbnails"))},[m(h,{name:"add-thumbnail",active:i.selectedBar==="thumbnails",title:e.$t("menu.set_thumbnails")},null,8,["active","title"])],10,Ne)):d("",!0),t.isTaskSelection&&!t.isCurrentViewSingleEntity&&!t.isCurrentViewTodos&&!t.isCurrentViewConcept?(n(),a("div",{key:4,class:p(["menu-item",{active:i.selectedBar==="subscribe"}]),title:e.$t("menu.subscribe"),onClick:s[4]||(s[4]=l=>t.selectBar("subscribe"))},[m(h,{name:"watch",active:i.selectedBar==="subscribe",title:e.$t("menu.subscribe")},null,8,["active","title"])],10,Ke)):d("",!0),t.isCurrentViewConcept&&(e.isCurrentUserManager||t.isConceptPublisher)&&t.isTaskSelection?(n(),a("div",{key:5,class:p(["menu-item ml05",{active:i.selectedBar==="edit-concepts"}]),title:e.$t("menu.edit_concepts"),onClick:s[5]||(s[5]=l=>t.selectBar("edit-concepts"))},[m(v)],10,He)):d("",!0),!t.isEntitySelection&&t.isTaskSelection&&e.nbSelectedTasks>1?(n(),a("div",Xe)):d("",!0),(t.isCurrentViewAsset||t.isCurrentViewShot||t.isCurrentViewSequence||t.isCurrentViewTodos||t.isCurrentViewTaskType)&&!t.isEntitySelection&&!t.isCurrentViewSingleEntity&&t.isTaskSelection&&e.nbSelectedTasks>0?(n(),a("div",{key:7,class:p(["menu-item",{active:i.selectedBar==="playlists"}]),title:e.$t("menu.generate_playlist"),onClick:s[6]||(s[6]=l=>t.selectBar("playlists"))},[m(h,{name:"playlists",active:i.selectedBar==="playlists",title:e.$t("menu.generate_playlist")},null,8,["active","title"])],10,Ge)):d("",!0),(t.isCurrentViewAsset||t.isCurrentViewShot||t.isCurrentViewTaskType)&&!t.isEntitySelection&&!t.isCurrentViewSingleEntity&&t.isTaskSelection&&e.isCurrentUserManager?(n(),a("div",Ye)):d("",!0),t.isCurrentViewEntity&&!t.isCurrentViewTaskType&&e.isCurrentUserManager&&!t.isEntitySelection&&e.nbSelectedTasks!==1?(n(),a("div",{key:9,class:p(["menu-item",{active:i.selectedBar==="create-tasks"}]),title:e.$t("menu.create_tasks"),onClick:s[7]||(s[7]=l=>t.selectBar("create-tasks"))},[m(T)],10,Je)):d("",!0),t.isCurrentViewEntity&&e.isCurrentUserManager&&!t.isEntitySelection&&!t.isCurrentViewSingleEntity&&t.isTaskSelection?(n(),a("div",{key:10,class:p(["menu-item",{active:i.selectedBar==="delete-tasks"}]),title:e.$t("menu.delete_tasks"),onClick:s[8]||(s[8]=l=>t.selectBar("delete-tasks"))},[m(h,{name:"trash",active:i.selectedBar==="delete-tasks",title:e.$t("menu.delete_tasks")},null,8,["active","title"])],10,Qe)):d("",!0),!t.isEntitySelection&&t.isTaskSelection&&!t.isCurrentViewConcept&&i.customActions?.length?(n(),a("div",Ze)):d("",!0),!t.isEntitySelection&&t.isTaskSelection&&!t.isCurrentViewConcept&&i.customActions?.length?(n(),a("div",{key:12,class:p(["menu-item",{active:i.selectedBar==="custom-actions"}]),title:e.$t("menu.run_custom_action"),onClick:s[9]||(s[9]=l=>t.selectBar("custom-actions"))},[m(y)],10,$e)):d("",!0),t.isCurrentViewAsset&&e.isCurrentUserManager&&!t.isTaskSelection?(n(),a("div",{key:13,class:p(["menu-item",{active:i.selectedBar==="delete-assets"}]),title:e.$t("menu.delete_assets"),onClick:s[10]||(s[10]=l=>t.selectBar("delete-assets"))},[m(h,{name:"trash",title:e.$t("menu.delete_assets")},null,8,["title"])],10,et)):d("",!0),t.isCurrentViewShot&&e.isCurrentUserManager&&!t.isTaskSelection?(n(),a("div",{key:14,class:p(["menu-item",{active:i.selectedBar==="delete-shots"}]),title:e.$t("menu.delete_shots"),onClick:s[11]||(s[11]=l=>t.selectBar("delete-shots"))},[m(h,{name:"trash",title:e.$t("menu.delete_shots")},null,8,["title"])],10,tt)):d("",!0),t.isCurrentViewEdit&&e.isCurrentUserManager&&!t.isTaskSelection?(n(),a("div",{key:15,class:p(["menu-item",{active:i.selectedBar==="delete-edits"}]),title:e.$t("menu.delete_edits"),onClick:s[12]||(s[12]=l=>t.selectBar("delete-edits"))},[m(h,{name:"trash",title:e.$t("menu.delete_edits")},null,8,["title"])],10,st)):d("",!0),t.isCurrentViewConcept&&(e.isCurrentUserManager||t.isConceptPublisher)?(n(),a("div",{key:16,class:p(["menu-item",{active:i.selectedBar==="delete-concepts"}]),title:e.$t("menu.delete_concepts"),onClick:s[13]||(s[13]=l=>t.selectBar("delete-concepts"))},[m(h,{name:"trash",title:e.$t("menu.delete_concepts")},null,8,["title"])],10,it)):d("",!0),s[39]||(s[39]=o("div",{class:"filler"},null,-1)),t.isTaskSelection&&!t.isEntitySelection&&e.nbSelectedTasks===1&&!e.isCurrentUserClient?(n(),a("div",{key:17,class:"menu-item",title:e.$t("main.csv.export_file"),onClick:s[14]||(s[14]=l=>e.$emit("export-task"))},[m(h,{name:"export",title:e.$t("main.csv.export_file")},null,8,["title"])],8,rt)):d("",!0),o("div",{class:"menu-item mr05",title:e.$t("main.clear_selection"),onClick:s[15]||(s[15]=(...l)=>t.clearSelection&&t.clearSelection(...l))},[m(S,{size:16})],8,nt)]),i.selectedBar&&!t.minimized?(n(),a("div",at,[i.selectedBar==="change-status"?(n(),a("div",ot,[o("div",lt,[o("div",dt,[m(I,{"with-margin":!1,"task-status-list":i.availableTaskStatuses,modelValue:i.taskStatusId,"onUpdate:modelValue":s[16]||(s[16]=l=>i.taskStatusId=l)},null,8,["task-status-list","modelValue"])]),o("div",ct,[q(o("textarea",{class:"comment-text input w100",type:"text",placeholder:e.$t("comments.add_comment"),onKeyup:[s[17]||(s[17]=W(D((...l)=>t.confirmTaskStatusChange&&t.confirmTaskStatusChange(...l),["ctrl"]),["enter"])),s[18]||(s[18]=W(D((...l)=>t.confirmTaskStatusChange&&t.confirmTaskStatusChange(...l),["meta"]),["enter"]))],"onUpdate:modelValue":s[19]||(s[19]=l=>i.statusComment=l)},null,40,mt),[[te,i.statusComment]])])]),o("div",ut,[o("button",{class:p(["button confirm-button is-wide",{"is-loading":i.loading.changeStatus}]),onClick:s[20]||(s[20]=(...l)=>t.confirmTaskStatusChange&&t.confirmTaskStatusChange(...l))},u(e.$tc("tasks.change_task_status",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks})),3)])])):d("",!0),i.selectedBar==="assignation"?(n(),a("div",ht,[e.isCurrentUserArtist?(n(),a("div",kt,u(e.$tc("tasks.to_myself")),1)):e.isCurrentUserManager||e.isCurrentUserSupervisor?(n(),a("div",ft,[m(F,{class:"is-wide assignation-field",ref:"assignation-field",people:t.currentTeam,placeholder:e.$t("tasks.assign_explaination"),wide:"",modelValue:i.person,"onUpdate:modelValue":s[21]||(s[21]=l=>i.person=l)},null,8,["people","placeholder","modelValue"])])):d("",!0),i.loading.assignation?(n(),a("div",pt,[m(E,{size:20,class:"spinner"})])):d("",!0),i.loading.assignation?d("",!0):(n(),a("div",vt,[o("button",{class:"button confirm-button is-wide",onClick:s[22]||(s[22]=(...l)=>t.confirmAssign&&t.confirmAssign(...l))},u(e.$tc("tasks.assign",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks})),1)])),o("div",wt,[m(B,{to:{name:"team",params:{production_id:e.currentProduction.id}},target:"_blank"},{default:M(()=>[_(u(e.$t("tasks.assignation_disclaimer")),1)]),_:1},8,["to"])]),!i.loading.assignation&&(e.isCurrentUserManager||t.isSupervisorInDepartment)?(n(),a("div",Ct,[o("div",yt,[o("button",{class:"button is-link clear-assignation-button filler",onClick:s[23]||(s[23]=(...l)=>t.clearAssignation&&t.clearAssignation(...l))},u(e.$t("tasks.clear_assignations")),1),_(" "+u(e.$t("main.or"))+" ",1),o("button",{class:"button is-link clear-assignation-button",onClick:s[24]||(s[24]=(...l)=>t.clearAllAssignations&&t.clearAllAssignations(...l))},u(e.$t("tasks.clear_all_assignations")),1)])])):!i.loading.assignation&&e.isCurrentUserArtist?(n(),a("div",gt,[o("button",{class:"button is-link clear-assignation-button hide-small-screen",onClick:s[25]||(s[25]=(...l)=>t.clearAssignation&&t.clearAssignation(...l))},u(e.$t("tasks.clear_own_assignations")),1)])):d("",!0),e.isShowAssignations?d("",!0):(n(),a("div",_t,u(e.$t("tasks.assignation_warning")),1))])):d("",!0),i.selectedBar==="priorities"?(n(),a("div",St,[o("div",Pt,[o("div",bt,u(e.$t("tasks.change_priority_to")),1),m(U,{class:"flexrow-item","is-thin":"",options:i.priorityOptions,modelValue:i.priority,"onUpdate:modelValue":s[26]||(s[26]=l=>i.priority=l)},null,8,["options","modelValue"])]),o("div",Tt,[o("button",{class:p(["button confirm-button is-wide",{"is-loading":i.loading.changePriority}]),onClick:s[27]||(s[27]=(...l)=>t.confirmPriorityChange&&t.confirmPriorityChange(...l))},u(e.$tc("tasks.change_priority",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks})),3)])])):d("",!0),i.selectedBar==="create-tasks"?(n(),a("div",Et,[e.nbSelectedTasks!==1?(n(),a("button",{key:0,class:p(["button confirm-button is-wide",{"is-loading":i.loading.taskCreation}]),onClick:s[28]||(s[28]=(...l)=>t.confirmTaskCreation&&t.confirmTaskCreation(...l))},u(e.$t("tasks.create_for_selection")),3)):d("",!0)])):d("",!0),i.selectedBar==="thumbnails"?(n(),a("div",At,[e.nbSelectedTasks>1?(n(),a("button",{key:0,class:p(["button confirm-button is-wide",{"is-loading":i.loading.setThumbnails}]),onClick:s[29]||(s[29]=(...l)=>t.confirmSetThumbnailsFromTasks&&t.confirmSetThumbnailsFromTasks(...l))},u(e.$tc("tasks.set_thumbnails_from_tasks",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks})),3)):(n(),a("div",xt,[o("button",{class:p(["button confirm-button is-wide",{"is-loading":i.loading.setThumbnails||r.isSetFrameThumbnailLoading}]),onClick:s[30]||(s[30]=(...l)=>t.confirmSetThumbnailsFromTasks&&t.confirmSetThumbnailsFromTasks(...l))},u(e.$t("tasks.set_preview")),3),r.isMoviePreview?(n(),a("label",Vt,[q(o("input",{class:"mr02",type:"checkbox","onUpdate:modelValue":s[31]||(s[31]=l=>i.isUseCurrentFrame=l)},null,512),[[se,i.isUseCurrentFrame]]),_(" "+u(e.$t("tasks.use_current_frame")),1)])):d("",!0)]))])):d("",!0),i.selectedBar==="subscribe"?(n(),a("div",Mt,[i.loading.tasksSubscription?(n(),a("div",Dt,[o("div",It,[m(E,{size:20,class:"spinner"})]),s[40]||(s[40]=o("div",{class:"flexrow-item"},"Â ",-1))])):d("",!0),i.loading.tasksSubscription?d("",!0):(n(),a("div",Ft,[o("button",{class:"button confirm-button is-wide",onClick:s[32]||(s[32]=(...l)=>t.confirmTasksSubscription&&t.confirmTasksSubscription(...l))},u(e.$tc("tasks.subscribe_to_tasks",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks})),1)])),i.loading.tasksSubscription?d("",!0):(n(),a("div",Bt,[o("button",{class:"button is-link filler",onClick:s[33]||(s[33]=(...l)=>t.confirmTasksUnsubscription&&t.confirmTasksUnsubscription(...l))},u(e.$t("tasks.unsubscribe_notifications")),1)]))])):d("",!0),i.selectedBar==="playlists"?(n(),a("div",Ut,[o("button",{class:"button confirm-button is-wide",onClick:s[34]||(s[34]=(...l)=>t.confirmPlaylistGeneration&&t.confirmPlaylistGeneration(...l))},u(e.$t("playlists.create_for_selection")),1)])):d("",!0),i.selectedBar==="edit-concepts"?(n(),a("div",Ot,[o("h3",Rt,u(e.$t("concepts.actions.title")),1),o("ul",Lt,[t.conceptLinkedEntities.length?(n(!0),a(C,{key:1},P(t.conceptLinkedEntities,l=>(n(),a("li",{key:l.id,class:"tag",onClick:f=>t.onRemoveLink(l)},u(l.name),9,zt))),128)):(n(),a("li",qt,[o("em",null,u(e.$t("concepts.actions.empty")),1)]))])])):d("",!0),i.selectedBar==="delete-tasks"?(n(),a("div",Wt,[m(g,{"error-text":e.$t("tasks.delete_for_selection_error"),"is-loading":i.loading.taskDeletion,"is-error":i.errors.taskDeletion,"require-hard-delete-confirmation":!0,"hard-delete-lock-text":e.$t("tasks.delete_for_selection_hard_lock_text"),"hard-delete-text":e.$t("tasks.delete_for_selection_hard_text"),text:e.$tc("tasks.delete_for_selection",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks}),onConfirm:t.confirmTaskDeletion},null,8,["error-text","is-loading","is-error","hard-delete-lock-text","hard-delete-text","text","onConfirm"])])):d("",!0),i.selectedBar==="custom-actions"?(n(),a("div",jt,[o("div",Nt,[m(O,{class:"is-wide",models:i.customActions,modelValue:i.customAction,"onUpdate:modelValue":s[35]||(s[35]=l=>i.customAction=l)},null,8,["models","modelValue"])]),o("div",Kt,[i.customAction&&!i.customAction.is_ajax?(n(),a("div",Ht,[o("form",{target:"_blank",method:"POST",action:i.customAction.url},[o("input",{type:"hidden",id:"personid",name:"personid",value:e.user.id},null,8,Gt),o("input",{type:"hidden",id:"personemail",name:"personemail",value:e.user.email},null,8,Yt),o("input",{type:"hidden",id:"projectid",name:"projectid",value:r.productionId},null,8,Jt),o("input",{type:"hidden",id:"currentpath",name:"currentpath",value:t.currentUrl},null,8,Qt),o("input",{type:"hidden",id:"currentserver",name:"currentserver",value:t.currentHost},null,8,Zt),o("input",{type:"hidden",id:"selection",name:"selection",value:t.selectedTaskIds},null,8,$t),o("input",{type:"hidden",id:"entitytype",name:"entitytype",value:t.currentEntityType},null,8,es),o("button",ts,u(e.$tc("custom_actions.run_for_selection",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks})),1)],8,Xt)])):(n(),a("div",ss,[o("button",{class:"button is-wide",onClick:s[36]||(s[36]=(...l)=>t.runCustomAction&&t.runCustomAction(...l))},u(e.$tc("custom_actions.run_for_selection",e.nbSelectedTasks,{nbSelectedTasks:e.nbSelectedTasks})),1)]))])])):d("",!0),i.selectedBar==="delete-assets"?(n(),a("div",is,[m(g,{"error-text":e.$t("assets.multiple_delete_error"),"is-loading":i.loading.assetDeletion,"is-error":i.errors.assetDeletion,text:e.$tc("assets.delete_for_selection",t.nbSelectedAssets,{nbSelectedAssets:t.nbSelectedAssets}),"require-hard-delete-confirmation":t.allAssetsCanceled,"hard-delete-lock-text":e.$tc("assets.delete_for_selection_hard_lock_text"),"hard-delete-text":e.$tc("assets.delete_for_selection_hard_text"),onConfirm:t.confirmAssetDeletion},null,8,["error-text","is-loading","is-error","text","require-hard-delete-confirmation","hard-delete-lock-text","hard-delete-text","onConfirm"])])):d("",!0),i.selectedBar==="delete-shots"?(n(),a("div",rs,[m(g,{"error-text":e.$t("shots.multiple_delete_error"),"is-loading":i.loading.shotDeletion,"is-error":i.errors.deleteShot,text:e.$tc("shots.delete_for_selection",t.nbSelectedShots,{nbSelectedShots:t.nbSelectedShots}),"require-hard-delete-confirmation":t.allShotsCanceled,"hard-delete-lock-text":e.$t("shots.delete_for_selection_hard_lock_text"),"hard-delete-text":e.$t("shots.delete_for_selection_hard_text"),onConfirm:t.confirmShotDeletion},null,8,["error-text","is-loading","is-error","text","require-hard-delete-confirmation","hard-delete-lock-text","hard-delete-text","onConfirm"])])):d("",!0),i.selectedBar==="delete-edits"?(n(),a("div",ns,[m(g,{"error-text":e.$t("edits.multiple_delete_error"),"is-loading":i.loading.editDeletion,"is-error":i.errors.deleteEdit,text:e.$tc("edits.delete_for_selection",t.nbSelectedEdits,{nbSelectedEdits:t.nbSelectedEdits}),"require-hard-delete-confirmation":t.allEditsCanceled,"hard-delete-lock-text":e.$t("edits.delete_for_selection_hard_lock_text"),"hard-delete-text":e.$t("edits.delete_for_selection_hard_text"),onConfirm:t.confirmEditDeletion},null,8,["error-text","is-loading","is-error","text","require-hard-delete-confirmation","hard-delete-lock-text","hard-delete-text","onConfirm"])])):d("",!0),i.selectedBar==="delete-episodes"?(n(),a("div",as,[m(g,{"error-text":e.$t("episodes.multiple_delete_error"),"is-loading":i.loading.episodeDeletion,"is-error":i.errors.deleteEpisode,text:e.$tc("episodes.delete_for_selection",e.nbSelectedEpisodes,{nbSelectedEpisodes:e.nbSelectedEpisodes}),"require-hard-delete-confirmation":!0,onConfirm:e.confirmEpisodeDeletion},null,8,["error-text","is-loading","is-error","text","onConfirm"])])):d("",!0),i.selectedBar==="delete-concepts"?(n(),a("div",os,[m(g,{"error-text":e.$t("concepts.multiple_delete_error"),"is-loading":i.loading.episodeDeletion,"is-error":i.errors.deleteEpisode,text:e.$tc("concepts.delete_for_selection",t.nbSelectedConcepts,{nbSelectedConcepts:t.nbSelectedConcepts}),"require-hard-delete-confirmation":!0,"hard-delete-lock-text":e.$t("concepts.delete_for_selection_hard_lock_text"),"hard-delete-text":e.$t("concepts.delete_for_selection_hard_text"),onConfirm:t.confirmConceptDeletion},null,8,["error-text","is-loading","is-error","text","hard-delete-lock-text","hard-delete-text","onConfirm"])])):d("",!0)])):d("",!0)]),i.selectedBar==="edit-concepts"?(n(),a("div",ls,[o("div",ds,[o("h2",cs,u(e.$t("concepts.add_links")),1),o("div",ms,[m(R,{ref:"entity-search-field",onChange:t.onEntitySearchChange},null,8,["onChange"]),m(A,{class:"flexrow-item",title:e.$t("entities.build_filter.title"),icon:"filter",onClick:s[37]||(s[37]=l=>i.modals.buildFilter=!0)},null,8,["title"])]),i.loading.links?(n(),w(E,{key:0})):(n(),a("div",us,[(n(!0),a(C,null,P(t.availableLinksByType,(l,f)=>(n(),a("ul",{class:"link-types",key:`link-types-${f}`},[o("li",hs,[o("h4",ks,u(l.type),1),o("ul",fs,[(n(!0),a(C,null,P(l.links,b=>(n(),a("li",{class:"tag",key:b.id,onClick:ti=>t.onSelectLink(b)},u(b.name),9,ps))),128))])])]))),128))]))],512)])):d("",!0),t.isCurrentViewConcept?(n(),w(L,{key:1,active:i.modals.buildFilter,onConfirm:t.confirmBuildFilter,onCancel:s[38]||(s[38]=l=>i.modals.buildFilter=!1)},null,8,["active","onConfirm"])):d("",!0),m(x,{active:i.modals.playlist,"task-ids":t.selectedTaskIds,sort:"",onCancel:t.hidePlaylistModal},null,8,["active","task-ids","onCancel"])])}const ws=z(Re,[["render",vs],["__scopeId","data-v-ba025742"]]),K=400,Cs={name:"task-info",mixins:[_e,we],components:{ActionPanel:ws,AddComment:ve,AddPreviewModal:pe,ComboboxStyled:Q,Comment:fe,CornerRightUpIcon:Ve,DeleteModal:De,EditCommentModal:ke,KitsuIcon:G,PeopleAvatar:ie,PreviewPlayer:he,Spinner:X,TaskTypeName:Ie,XIcon:H},props:{currentFrame:{type:Number,default:0},currentParentPreview:{type:Object,default:null},entityType:{type:String,default:"Asset"},extendable:{type:Boolean,default:!0},isLoading:{type:Boolean,default:!0},isPreview:{type:Boolean,default:!0},silent:{type:Boolean,default:!1},showAssignees:{type:Boolean,default:!1},task:{type:Object,default:()=>{}},withActions:{type:Boolean,default:!1},player:{type:Object,default:null},root:{type:Boolean,default:!0}},emits:["comment-added","task-removed","time-code-clicked"],provide(){return this.root?{draftComment:this.draftComment}:{}},data(){return{draftComment:{},addExtraPreviewFormData:null,animOn:!1,previewForms:[],currentFrameRaw:0,currentPreviewIndex:0,currentPreviewPath:"",currentPreviewDlPath:"",currentTask:null,commentToEdit:null,isWide:!1,isExtraWide:!1,otherPreviews:[],panelWidth:800,selectedEpisodes:null,selectedSequences:null,taskComments:[],taskPreviews:[],domEvents:[["mousemove",this.onExtendMove],["touchmove",this.onExtendMove],["mouseup",this.onExtendUp],["mouseleave",this.onExtendUp],["touchend",this.onExtendUp],["touchcancel",this.onExtendUp]],errors:{addComment:!1,addCommentMaxRetakes:!1,addPreview:!1,addExtraPreview:!1,editComment:!1,deleteComment:!1,confirmDeleteTaskPreview:!1,task:!1},loading:{addComment:!1,addPreview:!1,addExtraPreview:!1,editComment:!1,deleteComment:!1,confirmDeleteTaskPreview:!1,task:!1,setFrameThumbnail:!1},modals:{addPreview:!1,addExtraPreview:!1,editComment:!1,deleteComment:!1,deleteExtraPreview:!1}}},mounted(){if(this.sideColumnParent){const e=j.getIntPreference("task:panel-width",K);this.setWidth(e),this.refreshPreviewPlay()}},beforeUnmount(){this.removeEvents(this.domEvents)},computed:{...J(["currentEpisode","currentProduction","getTaskComment","getTaskComments","getTaskPreviews","getTaskStatusForCurrentUser","isCurrentUserArtist","isCurrentUserClient","isCurrentUserManager","isCurrentUserSupervisor","isSavingCommentPreview","isSingleEpisode","isTVShow","nbSelectedTasks","personMap","productionMap","selectedAssets","selectedConcepts","selectedEdits","selectedShots","selectedTasks","shotMap","nbSelectedValidations","taskEntityPreviews","taskMap","taskTypeMap","user"]),sideColumnParent(){if(this.$el.parentElement.classList.contains("side-column"))return this.$el.parentElement},nbSelectedEntities(){return this.selectedEntities?.size||0},selectedEntities(){return this[`selected${this.entityType}s`]},currentProductionId(){return this.task?.project_id||this.currentProduction?.id},currentTeam(){if(!this.task)return[];const e=this.productionMap.get(this.task.project_id);return e?.team?le(e.team.map(s=>this.personMap.get(s)).filter(Boolean)):[]},currentTaskTypes(){if(!this.task||!this.currentProduction)return[];const e=this.currentProduction.task_types,r=this.taskTypeMap.get(this.task.task_type_id).for_entity,c=r.toLowerCase()+"s",i={};for(const h of this.taskMap){const v=h[1];v.entity_id===this.task.entity_id&&(i[v.task_type_id]=v)}return e.map(h=>this.taskTypeMap.get(h)).filter(h=>h?.for_entity===r).filter(h=>i[h.id]).map(h=>{const v=i[h.id];return v&&(h.url=`/productions/${v.project_id}/episodes/${v.episode_id||"all"}/${c}/tasks/${v.id}`),h})},title(){return this.task?`${this.task.full_entity_name||this.task.entity_name}`:this.$t("main.loading")},isAssigned(){return this.task?.assignees.some(e=>e===this.user.id)??!1},isCommentingAllowed(){return this.task&&(this.isAssigned||this.isCurrentUserClient||this.isDepartmentSupervisor||this.isCurrentUserManager)},isConceptTask(){return this.entityType==="Concept"},isDepartmentSupervisor(){return this.isCurrentUserSupervisor?this.user.departments.length===0?!0:this.user.departments.includes(this.currentTaskType?.department_id):!1},isPreviewPlayerReadOnly(){if(this.task){if(this.isCurrentUserManager||this.isCurrentUserClient)return!1;if(this.isCurrentUserSupervisor)return this.user.departments.length===0?!1:!this.user.departments.includes(this.currentTaskType?.department_id)}return!0},isSetThumbnailAllowed(){return this.currentPreviewId&&this.task&&this.task.entity&&this.currentPreviewId!==this.task.entity.preview_file_id&&this.extension!=="gif"},currentTaskType(){return this.taskTypeMap.get(this.task?.task_type_id)},currentPreview(){const e=this.currentPreviewIndex;return this.taskPreviews&&this.taskPreviews.length>0?this.taskPreviews[e]:null},currentPreviewComment(){return this.taskComments.find(e=>e.previews?.some(s=>s.revision===this.currentRevision))},currentPreviewId(){const e=this.currentPreviewIndex;return this.taskPreviews&&this.taskPreviews.length>0&&this.taskPreviews[e]?this.taskPreviews[e].id:null},currentFps(){return parseInt(this.productionMap.get(this.task.project_id)?.fps)||25},currentRevision(){return this.currentParentPreview&&this.currentParentPreview.revision?this.currentParentPreview.revision:this.currentPreview?this.currentPreview.revision:0},extension(){const e=this.currentPreviewIndex;return this.taskPreviews&&this.taskPreviews.length>0?this.taskPreviews[e].extension:""},isStandardPreview(){return this.taskPreviews&&this.taskPreviews.length>0&&["ai","blend","ma","mb","pdf","psd","rar","ae","fla","flv","swf","zip"].includes(this.extension)},isMoviePreview(){return this.taskPreviews&&this.taskPreviews.length>0&&this.extension==="mp4"},isPicturePreview(){return this.taskPreviews&&this.taskPreviews.length>0&&["png","gif"].includes(this.extension)},is3DModelPreview(){return this.taskPreviews&&this.taskPreviews.length>0&&this.extension==="obj"},moviePath(){return`/api/movies/originals/preview-files/${this.currentPreview.id}.mp4`},taskStatuses(){return this.getTaskStatusForCurrentUser(this.task.project_id,this.isConceptTask)},taskTypeStyle(){return ye(this.task)},taskPath(){return oe(this.task,null,this.isTVShow,this.currentEpisode,this.taskTypeMap)},taskEntityPath(){const e=this.$route.params.episode_id;return ae(this.task,e)},previewOptions(){return this.taskPreviews?[...this.taskPreviews].sort((e,s)=>s.revision-e.revision).map(e=>({value:e.id,label:`v${e.revision}`,validation_status:e.validation_status})):[]},selectedTasksToDisplay(){return ne(Array.from(this.selectedTasks.values()),this.taskTypeMap)}},methods:{...Y(["addAttachmentToComment","ackComment","addCommentExtraPreview","commentTask","commentTaskWithPreview","deleteAttachment","deleteTaskComment","deleteTaskPreview","editTaskComment","loadComment","loadPreviewFileFormData","loadTask","loadTaskComments","loadTaskSubscribed","refreshPreview","pinComment","refreshComment","removeSelectedTask","setPreview","subscribeToTask","unsubscribeFromTask","updatePreviewAnnotation"]),loadTaskData(){this.task&&(this.loading.task=!0,this.errors.task=!1,this.loadTaskComments({taskId:this.task.id,entityId:this.task.entity_id}).then(()=>{this.loading.task=!1,this.reset()}).catch(e=>{console.error(e),this.errors.task=!0}))},addComment(e,s,r,c,i=void 0,t=void 0){this.animOn=!0,this.$nextTick(()=>{let h=this.currentParentPreview?this.currentParentPreview:this.currentPreview;h=this.taskPreviews.find(y=>y.id===h.id);const v={taskId:this.task.id,taskStatusId:c,attachment:s,checklist:r,comment:e,links:t?[t]:null,revision:i},T=this.previewForms.length>0?"commentTaskWithPreview":"commentTask";this.loading.addComment=!0,this.errors.addComment=!1,this.errors.addCommentMaxRetakes=!1,this.$store.dispatch(T,v).then(()=>{Ce.clearTaskDraft(this.task.id),this.$refs["add-comment"]?.reset(),this.reset(),this.loading.addComment=!1,this.$emit("comment-added")}).catch(y=>{console.error(y);const S=y.body?.message?.includes("retake")??!1;this.errors.addComment=!S,this.errors.addCommentMaxRetakes=S,this.loading.addComment=!1})})},reset({keepPreviewFiles:e=!1}={}){this.resetModals(),e||this.clearPreviewFiles(),this.task&&(this.taskComments=this.getTaskComments(this.task.id),this.taskPreviews=this.getTaskPreviews(this.task.id),this.setOtherPreviews(),this.currentPreviewPath=this.getOriginalPath(),this.currentPreviewDlPath=this.getOriginalDlPath(),this.resetDraft(),this.$nextTick(()=>{this.$refs["preview-player"]?.focus()}))},focusCommentTextarea(){this.$refs["add-comment"]?.focus()},getOriginalPath(){const e=this.currentPreviewId,s=this.extension?this.extension:"png";return`/api/pictures/originals/preview-files/${e}.${s}`},getOriginalDlPath(){return`/api/pictures/originals/preview-files/${this.currentPreviewId}/download`},setOtherPreviews(){return this.taskPreviews&&(this.otherPreviews=this.taskPreviews.filter(e=>e.id!==this.currentPreviewId&&e.extension==="mp4")),this.otherPreviews},selectFile(e){this.previewForms=this.previewForms.concat(e),this.loadPreviewFileFormData(this.previewForms)},onPreviewFormRemoved(e){this.previewForms=this.previewForms.filter(s=>s!==e),this.loadPreviewFileFormData(this.previewForms)},clearPreviewFiles(){this.previewForms=[],this.loadPreviewFileFormData(this.previewForms),this.$store.commit("CLEAR_UPLOAD_PROGRESS")},createExtraPreview(e){this.selectFile(e),this.errors.addExtraPreview=!1,this.loading.addExtraPreview=!0;const s=this.taskComments.find(r=>r.previews.find(c=>c.id===this.currentPreviewId));this.addCommentExtraPreview({taskId:this.task.id,commentId:s?.id,previewId:this.currentPreviewId}).then(()=>{this.loading.addExtraPreview=!1,this.$refs["add-extra-preview-modal"].reset(),this.reset(),setTimeout(()=>{this.$refs["preview-player"].displayLast()},0),this.modals.addExtraPreview=!1}).catch(r=>{console.error(r),this.loading.addExtraPreview=!1,this.errors.addExtraPreview=!0})},onPreviewAdded(e){const s=e.task_id,r=e.comment_id,c=e.preview_file_id,i=e.revision,t=e.extension,h=this.getTaskComment(s,r);this.task&&s===this.task.id&&h&&(h.previews.length===0||h.previews[0].id!==c)&&(this.$store.commit("ADD_PREVIEW_END",{preview:{id:c,revision:i,extension:t},taskId:s,commentId:r,comment:h}),this.reset({keepPreviewFiles:!0}))},onPreviewsOrderChange(){this.taskPreviews=this.getTaskPreviews(this.task.id),this.setOtherPreviews(),this.currentPreviewPath=this.getOriginalPath(),this.currentPreviewDlPath=this.getOriginalDlPath()},onAnnotationChanged({preview:e,additions:s,deletions:r,updates:c}){let i=this.task?this.task.id:this.previousTaskId;i=i||e.task_id,i&&this.updatePreviewAnnotation({taskId:i,preview:e,additions:s,deletions:r,updates:c})},onAddPreviewClicked(){this.modals.addPreview=!0},onAddExtraPreview(){this.clearPreviewFiles(),this.modals.addExtraPreview=!0},onRemoveExtraPreview(e){this.currentExtraPreviewId=e.id,this.modals.deleteExtraPreview=!0},onCommentAdded(){this.taskComments=this.getTaskComments(this.task.id)},onCancelRemoveExtraPreview(){this.modals.deleteExtraPreview=!1},closeAddPreviewModal(){this.modals.addPreview=!1},confirmAddPreviewModal(e){this.selectFile(e),this.closeAddPreviewModal()},onCloseExtraPreview(){this.modals.addExtraPreview=!1},onPreviewChanged(e){this.currentPreviewIndex=this.taskPreviews.findIndex(s=>s.id===e),this.currentPreviewPath=this.getOriginalPath(),this.currentPreviewDlPath=this.getOriginalDlPath()},changeCurrentPreview(e){const s=this.taskPreviews.findIndex(r=>r.id===e.id);(s||s===0)&&(this.currentPreviewIndex=s,this.currentPreviewPath=this.getOriginalPath(),this.currentPreviewDlPath=this.getOriginalDlPath())},setCurrentPreviewAsEntityThumbnail(e){const r=this.$refs["preview-player"].currentPreview.id;this.setPreview({taskId:this.task.id,entityId:this.task.entity_id,previewId:r,frame:e}).finally(()=>{this.loading.setFrameThumbnail=!1})},onAckComment(e){this.ackComment(e)},onDuplicateComment(e){this.$refs["add-comment"].setValue(e)},onPinComment(e){this.pinComment(e)},onEditComment(e){this.commentToEdit=e,this.modals.editComment=!0},onDeleteComment(e){this.commentToEdit=e,this.modals.deleteComment=!0},onCancelEditComment(){this.modals.editComment=!1},onCancelDeleteComment(){this.modals.deleteComment=!1},isClientFromSameStudio(e){return this.isCurrentUserClient&&this.user.studio_id===e.studio_id&&e.role==="client"},async saveComment(e){try{await this.editTaskComment({taskId:this.task.id,comment:e})}catch(s){console.error(s),await this.loadTaskData()}},confirmDeleteTaskComment(){this.animOn=!0,this.loading.deleteComment=!0,this.errors.deleteComment=!1;const e=this.commentToEdit.id;this.deleteTaskComment({taskId:this.task.id,commentId:e}).then(()=>{this.reset(),this.loading.deleteComment=!1,this.modals.deleteComment=!1}).catch(s=>{console.error(s),this.loading.deleteComment=!1,this.errors.deleteComment=!0}).finally(()=>{this.animOn=!1})},getCurrentTaskComments(){return this.getTaskComments(this.task.id)},confirmDeleteTaskPreview(){this.loading.deleteExtraPreview=!0,this.errors.deleteExtraPreview=!1;const e=this.currentExtraPreviewId,s=this.getCurrentTaskComments().find(r=>r.previews.findIndex(c=>c.id===e)>=0);this.$refs["preview-player"].displayFirst(),this.deleteTaskPreview({taskId:this.task.id,commentId:s?.id,previewId:e}).then(()=>{this.loading.deleteExtraPreview=!1,this.modals.deleteExtraPreview=!1}).catch(r=>{console.error(r),this.loading.deleteExtraPreview=!1,this.errors.deleteExtraPreview=!0})},onRemoteAcknowledge(e,s){if(this.task){const r=this.getTaskComment(this.task.id,e.comment_id),c=this.personMap.get(e.person_id);r&&c&&(this.user.id===c.id?(s==="ack"&&!r.acknowledgements.includes(c.id)||s==="unack"&&r.acknowledgements.includes(c.id))&&this.$store.commit("ACK_COMMENT",{comment:r,user:c}):this.$store.commit("ACK_COMMENT",{comment:r,user:c}))}},isStatusChange(e){const s=this.taskComments[e];return e===this.taskComments.length-1||s.task_status_id!==this.taskComments[e+1].task_status_id},timeCodeClicked({versionRevision:e,minutes:s,seconds:r,milliseconds:c,frame:i}){if(!this.isPreview){this.$emit("time-code-clicked",{versionRevision:e,minutes:s,seconds:r,milliseconds:c,frame:i});return}this.changeCurrentPreview(this.taskPreviews.find(t=>t.revision===parseInt(e))),setTimeout(()=>{this.$refs["preview-player"]?.setCurrentFrame(i),this.$refs["preview-player"]?.focus()},20)},onFrameUpdated(e){this.currentFrameRaw=e},async extractAnnotationSnapshots(){let e=this.$refs["preview-player"];e||(e=this.player),this.$refs["add-comment"].showAnnotationLoading();const s=await e.extractAnnotationSnapshots();return this.$refs["add-comment"].hideAnnotationLoading(),this.$refs["add-comment"].setAnnotationSnapshots(s),s},onExportClick(){const e=[re().format("YYYY-MM-DD"),"kitsu",this.productionMap.get(this.task.project_id)?.name,this.task.entity_name.replaceAll(" / ","_"),this.taskTypeMap.get(this.task.task_type_id).name,"comments"],s=ge.slugify(e.join("_")),r=[this.$t("comments.fields.created_at"),this.$t("comments.fields.task_status"),this.$t("comments.fields.person"),this.$t("comments.fields.text"),this.$t("comments.fields.checklist"),this.$t("comments.fields.acknowledgements")],c=[];this.getCurrentTaskComments().forEach(i=>{c.push([N(i.created_at),i.task_status.name,i.person.name,i.text,i.checklist?i.checklist.map(t=>`[${t.checked?"x":" "}] ${t.text}`).join(`
`):"",i.acknowledgements?i.acknowledgements.map(t=>this.personMap.get(t).name).join(","):""]),i.replies&&i.replies.forEach(t=>c.push([N(t.date),"Reply",this.personMap.get(t.person_id).name,t.text]))}),me.buildCsvFile(s,[r].concat(c))},onExtendDown(e){if(!this.sideColumnParent)return;this.lastWidthX=this.getClientX(e);const s=this.sideColumnParent.offsetWidth;this.lastWidth=s,this.addEvents(this.domEvents)},onExtendMove(e){const s=this.lastWidthX-this.getClientX(e);let r=Math.max(this.lastWidth+s,K);r>900&&(r=900),this.setWidth(r),this.refreshPreviewPlay()},onExtendUp(){if(this.removeEvents(this.domEvents),this.refreshPreviewPlay(),this.sideColumnParent){const e=this.sideColumnParent.offsetWidth;j.setPreference("task:panel-width",e)}},setWidth(e){this.sideColumnParent&&(this.sideColumnParent.style["min-width"]=`${e}px`,this.isWide=e>699,this.isExtraWide=e>=900)},onSetCurrentFrameAsThumbnail(e){if(this.$refs["preview-player"]){this.loading.setFrameThumbnail=!0;let s=null;return e&&(s=this.currentFrameRaw+1),this.setCurrentPreviewAsEntityThumbnail(s)}},refreshPreviewPlay(){this.$refs["preview-player"]?.previewViewer?.resize()},removeTaskFromSelection(e){const s={column:{id:e.task_type_id},entity:{id:e.entity_id},task:e};this.removeSelectedTask({task:s}),this.removeSelectedTask({task:e}),this.$emit("task-removed",e)}},watch:{task(){this.clearPreviewFiles(),this.currentPreviewIndex=0,this.silent||this.loadTaskData()},silent:{immediate:!0,handler(){this.silent||this.loadTaskData()}},currentFrame(){this.currentFrameRaw=this.currentFrame}},socket:{events:{"preview-file:add-file"(e){this.onPreviewAdded(e)},"preview-file:update"(e){const s=this.taskComments.find(r=>r.previews&&r.previews.length>0&&r.previews[0].id===e.preview_file_id);s&&this.task&&this.refreshPreview({taskId:this.task.id,previewId:e.preview_file_id}).then(r=>{s.previews[0].validation_status=r.validation_status})},"task:update"(e){const s=this.getTask();s&&e.task_id===s.id&&setTimeout(()=>{const r=this.getTask();r&&e.task_id===r.id&&(this.taskComments=this.getTaskComments(r.id))},1e3)},"comment:new"(e){setTimeout(()=>{this.animOn=!0;const s=this.task?this.getTaskComments(this.task.id):null;this.task&&s&&s.length!==this.taskComments.length&&e.task_id===this.task.id&&!this.loading.task&&(this.taskComments=s,this.taskPreviews=this.getTaskPreviews(this.task.id)),this.animOn=!1},1e3)},"comment:update"(e){const s=e.comment_id;this.isSavingCommentPreview||!this.task&&!this.taskComments.some(({id:r})=>r===s)||this.loadComment({commentId:s}).catch(console.error)},"comment:acknowledge"(e){this.onRemoteAcknowledge(e,"ack")},"comment:unacknowledge"(e){this.onRemoteAcknowledge(e,"unack")},"comment:reply"(e){if(this.task){const s=this.taskComments.find(r=>r.id===e.comment_id);s&&(s.replies||(s.replies=[]),s.replies.find(c=>c.id===e.reply_id)||this.refreshComment({commentId:e.comment_id}).then(c=>{s.replies=c.replies}).catch(console.error))}},"comment:delete"(e){const s=this.getTask();if(this.animOn=!0,s){const c=this.getComments().find(i=>i.id===e.comment_id);c&&(this.$store.commit("REMOVE_TASK_COMMENT",{task:s,comment:c}),this.taskComments=this.getTaskComments(this.task.id),this.taskPreviews=this.getTaskPreviews(this.task.id)),this.animOn=!1}},"comment:delete-reply"(e){if(this.task){const s=this.taskComments.find(r=>r.id===e.comment_id);s&&(s.replies||(s.replies=[]),this.$store.commit("REMOVE_REPLY_FROM_COMMENT",{comment:s,reply:{id:e.reply_id}}))}},"preview-file:annotation-update"(e){const s=this.$refs["preview-player"];if(!s)return;s.isValidPreviewModification(e.preview_file_id,e.updated_at)&&this.refreshPreview({previewId:s.currentPreview.id,taskId:s.currentPreview.task_id}).then(()=>{s.notSaved||(this.taskPreviews=this.getTaskPreviews(this.task.id),s.reloadAnnotations(),s.loadAnnotation())})}},head(){return{title:this.title}}}},ys={class:"side-wrapper"},gs={class:"side task-info"},_s={key:1,class:"multi-selection-info pa1"},Ss={class:"title"},Ps={class:"task-list mt1"},bs={class:"flexrow-item"},Ts=["onClick"],Es={key:0,class:"mt2 selected-task-line"},As={key:0},xs={key:2},Vs={class:"flexrow extra-buttons pa05"},Ms=["title"],Ds={class:"pa1 pb0 pt0"},Is={key:0,class:"flexrow header-title"},Fs={class:"title flexrow-item filler"},Bs={key:0,class:"flexrow"},Us={class:"flexrow-item ml1"},Os={class:"task-columns pa1 pt0",ref:"task-columns"},Rs={key:0,class:"task-column preview-column"},Ls={class:"preview-column-content"},qs={key:0,class:"flexrow"},zs={key:0,class:"preview-list flexrow w100"},Ws={class:"preview"},js={key:1,class:"no-preview"},Ns={class:"task-column comments-column mt1"},Ks={key:1,class:"comments"},Hs={key:2,class:"no-comment"},Xs={key:0,class:"has-text-centered"},Gs={key:3,class:"side task-info pa1"},Ys={class:"title mt2"},Js={class:"pa2 mt1"},Qs={key:4,class:"side task-info empty"},Zs={class:"has-text-centered mb0"},$s={class:"empty-section"};function ei(e,s,r,c,i,t){const h=k("action-panel"),v=k("task-type-name"),T=k("x-icon"),y=k("kitsu-icon"),S=k("router-link"),I=k("people-avatar"),F=k("combobox-styled"),E=k("corner-right-up-icon"),B=k("preview-player"),U=k("add-comment"),g=k("comment"),O=k("XyzTransitionGroup"),R=k("spinner"),A=k("add-preview-modal"),L=k("edit-comment-modal"),x=k("delete-modal"),l=de("xyz");return n(),a("div",ys,[r.extendable?(n(),a("div",{key:0,class:"extend-bar",onMousedown:s[0]||(s[0]=D((...f)=>t.onExtendDown&&t.onExtendDown(...f),["prevent"])),onTouchstart:s[1]||(s[1]=D((...f)=>t.onExtendDown&&t.onExtendDown(...f),["prevent"]))},null,32)):d("",!0),o("div",gs,[r.withActions&&(!t.isConceptTask||e.selectedConcepts.size>0)&&(t.nbSelectedEntities>0||e.nbSelectedTasks>0||e.nbSelectedValidations>0)?(n(),w(h,{key:0,"is-movie-preview":t.isMoviePreview,"is-set-frame-thumbnail-loading":i.loading.setFrameThumbnail,"production-id":t.currentProductionId,team:t.currentTeam,onExportTask:t.onExportClick,onSetFrameThumbnail:t.onSetCurrentFrameAsThumbnail},null,8,["is-movie-preview","is-set-frame-thumbnail-loading","production-id","team","onExportTask","onSetFrameThumbnail"])):d("",!0),r.withActions&&((e.nbSelectedTasks||0)>1||e.nbSelectedValidations>0)?(n(),a("div",_s,[o("h1",Ss,u(e.$tc("tasks.selected_tasks"))+" ("+u(e.nbSelectedTasks)+") ",1),o("div",Ps,[(n(!0),a(C,null,P(t.selectedTasksToDisplay,f=>(n(),a("div",{class:"selected-task-line flexrow",key:f.id},[m(v,{class:"flexrow-item task-type","task-type":e.taskTypeMap.get(f.task_type_id),"production-id":f.project_id},null,8,["task-type","production-id"]),o("span",bs,u(f.entity_name),1),o("span",{class:"flexrow-item pointer",onClick:b=>t.removeTaskFromSelection(f)},[m(T,{size:12})],8,Ts)]))),128)),e.nbSelectedValidations>0?(n(),a("div",Es,[e.nbSelectedTasks>0?(n(),a("span",As,"+")):d("",!0),_(" "+u(e.nbSelectedValidations)+" "+u(e.$tc("tasks.empty_cells_selected",e.nbSelectedValidations)),1)])):d("",!0)])])):r.task?(n(),a("div",xs,[o("div",Vs,[s[3]||(s[3]=o("div",{class:"filler"},null,-1)),!r.withActions&&!e.isCurrentUserClient?(n(),a("div",{key:0,class:"pointer",title:e.$t("main.csv.export_file"),onClick:s[2]||(s[2]=(...f)=>t.onExportClick&&t.onExportClick(...f))},[m(y,{name:"export",title:e.$t("main.csv.export_file")},null,8,["title"])],8,Ms)):d("",!0)]),o("div",Ds,[t.isConceptTask?d("",!0):(n(),a("div",Is,[t.currentTaskType?(n(),w(v,{key:0,class:"flexrow-item task-type mr1","task-type":t.currentTaskType,"production-id":r.task.project_id},null,8,["task-type","production-id"])):d("",!0),o("div",Fs,[e.isCurrentUserClient?(n(),a(C,{key:1},[_(u(t.title),1)],64)):(n(),w(S,{key:0,to:t.taskEntityPath},{default:M(()=>[_(u(t.title),1)]),_:1},8,["to"]))])]))]),r.showAssignees&&r.task.assignees.length>0?(n(),a("div",Bs,[o("span",Us,u(e.$t("tasks.fields.assignees"))+": ",1),(n(!0),a(C,null,P(r.task.assignees,f=>(n(),w(I,{key:`assignee-${f}`,class:"flexrow-item","font-size":14,person:e.personMap.get(f),size:24},null,8,["person"]))),128))])):d("",!0),o("div",Os,[r.isPreview?(n(),a("div",Rs,[o("div",Ls,[t.isConceptTask?d("",!0):(n(),a("div",qs,[t.previewOptions.length>0?(n(),a("div",zs,[m(F,{class:"preview-combo flexrow-item",options:t.previewOptions,"is-preview":"",thin:"","model-value":t.previewOptions[i.currentPreviewIndex]?.value,"onUpdate:modelValue":t.onPreviewChanged},null,8,["options","model-value","onUpdate:modelValue"])])):d("",!0),s[4]||(s[4]=o("div",{class:"filler"},null,-1)),o("div",null,[m(S,{class:"history-button flexrow-item",to:t.taskPath},{default:M(()=>[m(E,{size:12})]),_:1},8,["to"])])])),o("div",Ws,[i.taskPreviews&&i.taskPreviews.length>0?(n(),w(B,{key:0,"entity-preview-files":e.taskEntityPreviews,"entity-type":r.entityType,"extra-wide":i.isExtraWide,"is-assigned":t.isAssigned,"last-preview-files":i.taskPreviews,light:!i.isWide,link:t.currentPreviewComment?.links?.[0],previews:t.currentPreview?t.currentPreview.previews:[],"read-only":t.isPreviewPlayerReadOnly,task:r.task,"task-type-map":e.taskTypeMap,onAnnotationChanged:t.onAnnotationChanged,onChangeCurrentPreview:t.changeCurrentPreview,onAddExtraPreview:t.onAddExtraPreview,onRemoveExtraPreview:t.onRemoveExtraPreview,onPreviewsOrderChange:t.onPreviewsOrderChange,onCommentAdded:t.onCommentAdded,onFrameUpdated:t.onFrameUpdated,ref:"preview-player"},null,8,["entity-preview-files","entity-type","extra-wide","is-assigned","last-preview-files","light","link","previews","read-only","task","task-type-map","onAnnotationChanged","onChangeCurrentPreview","onAddExtraPreview","onRemoveExtraPreview","onPreviewsOrderChange","onCommentAdded","onFrameUpdated"])):d("",!0),!i.taskPreviews||i.taskPreviews.length===0?(n(),a("div",js,[o("em",null,u(e.$t("tasks.no_preview")),1)])):d("",!0)])])])):d("",!0),o("div",Ns,[o("div",null,[o("div",null,[t.isCommentingAllowed?(n(),w(U,{key:0,ref:"add-comment",team:t.currentTeam,"task-types":t.currentTaskTypes,task:r.task,"task-status":t.taskStatuses,"is-loading":i.loading.addComment,"preview-forms":i.previewForms,"is-error":i.errors.addComment,"is-max-retakes-error":i.errors.addCommentMaxRetakes,fps:t.currentFps,frame:r.currentFrame||i.currentFrameRaw,revision:t.currentRevision,"is-movie":t.isMoviePreview,onAddComment:t.addComment,onAddPreview:t.onAddPreviewClicked,onFileDrop:t.selectFile,onClearFiles:t.clearPreviewFiles,onRemovePreview:t.onPreviewFormRemoved,onAnnotationSnapshotsRequested:t.extractAnnotationSnapshots},null,8,["team","task-types","task","task-status","is-loading","preview-forms","is-error","is-max-retakes-error","fps","frame","revision","is-movie","onAddComment","onAddPreview","onFileDrop","onClearFiles","onRemovePreview","onAnnotationSnapshotsRequested"])):d("",!0),i.taskComments&&i.taskComments.length>0&&!i.loading.task?(n(),a("div",Ks,[q((n(),w(O,{appear:""},{default:M(()=>[(n(!0),a(C,null,P(i.taskComments,(f,b)=>(n(),w(g,{key:`comment-${f.id}`,comment:f,fps:t.currentFps,frame:r.currentFrame||i.currentFrameRaw,"is-change":t.isStatusChange(b),"is-checkable":e.user.id===f.person?.id||e.isCurrentUserArtist&&t.isAssigned||t.isDepartmentSupervisor||e.isCurrentUserManager,"is-editable":e.user.id===f.person?.id||e.isCurrentUserManager,"is-pinnable":t.isDepartmentSupervisor||e.isCurrentUserManager,"is-replyable":e.user.id===f.person?.id||t.isAssigned||t.isDepartmentSupervisor||e.isCurrentUserManager||t.isClientFromSameStudio(f.person),revision:t.currentRevision,task:r.task,team:t.currentTeam,"task-types":t.currentTaskTypes,onAckComment:t.onAckComment,onDuplicateComment:t.onDuplicateComment,onPinComment:t.onPinComment,onEditComment:t.onEditComment,onDeleteComment:t.onDeleteComment,onChecklistUpdated:t.saveComment,onTimeCodeClicked:t.timeCodeClicked},null,8,["comment","fps","frame","is-change","is-checkable","is-editable","is-pinnable","is-replyable","revision","task","team","task-types","onAckComment","onDuplicateComment","onPinComment","onEditComment","onDeleteComment","onChecklistUpdated","onTimeCodeClicked"]))),128))]),_:1})),[[l,{fade:i.animOn,up:i.animOn,"flip-up":i.animOn}]])])):i.loading.task?d("",!0):(n(),a("div",Hs,[o("em",null,u(e.$t("tasks.no_comment")),1)]))])]),i.loading.task?(n(),a("div",Xs,[m(R)])):d("",!0)])],512),m(A,{ref:"add-preview-modal",active:i.modals.addPreview,"is-loading":i.loading.addPreview,"is-error":i.errors.addPreview,"expected-frames":e.entityFrames,fps:t.currentFps,onCancel:t.closeAddPreviewModal,onConfirm:t.confirmAddPreviewModal},null,8,["active","is-loading","is-error","expected-frames","fps","onCancel","onConfirm"]),m(A,{ref:"add-extra-preview-modal",active:i.modals.addExtraPreview,"is-loading":i.loading.addExtraPreview,"is-error":i.errors.addExtraPreview,"form-data":i.addExtraPreviewFormData,message:"",onCancel:t.onCloseExtraPreview,onConfirm:t.createExtraPreview},null,8,["active","is-loading","is-error","form-data","onCancel","onConfirm"]),m(L,{active:i.modals.editComment,"comment-to-edit":i.commentToEdit,fps:t.currentFps,frame:r.currentFrame||i.currentFrameRaw,"is-loading":i.loading.editComment,"is-error":i.errors.editComment,revision:t.currentRevision,team:t.currentTeam,"task-types":t.currentTaskTypes,onConfirm:e.confirmEditTaskComment,onCancel:t.onCancelEditComment},null,8,["active","comment-to-edit","fps","frame","is-loading","is-error","revision","team","task-types","onConfirm","onCancel"]),m(x,{active:i.modals.deleteComment,"is-loading":i.loading.deleteComment,"is-error":i.errors.deleteComment,text:e.$t("tasks.delete_comment"),"error-text":e.$t("tasks.delete_comment_error"),onConfirm:t.confirmDeleteTaskComment,onCancel:t.onCancelDeleteComment},null,8,["active","is-loading","is-error","text","error-text","onConfirm","onCancel"]),m(x,{active:i.modals.deleteExtraPreview,"is-loading":i.loading.deleteExtraPreview,"is-error":i.errors.deleteExtraPreview,text:e.$t("tasks.delete_preview"),"error-text":e.$t("tasks.delete_preview_error"),onCancel:t.onCancelRemoveExtraPreview,onConfirm:t.confirmDeleteTaskPreview},null,8,["active","is-loading","is-error","text","error-text","onCancel","onConfirm"])])):t.nbSelectedEntities>0?(n(),a("div",Gs,[o("h1",Ys,u(e.$tc("tasks.selected_entities")),1),o("div",Js,[(n(!0),a(C,null,P(Array.from(t.selectedEntities.values()),f=>(n(),a("div",{class:"entity-line",key:f.id},[o("span",{class:p({canceled:f.canceled})},u(f.full_name),3)]))),128))])])):(n(),a("div",Qs,[o("div",Zs,[r.entityType==="Concept"?(n(),a(C,{key:0},[_(u(e.$t("concepts.no_concept_selected")),1)],64)):(n(),a(C,{key:1},[_(u(e.$t("tasks.no_task_selected")),1)],64))]),s[5]||(s[5]=o("hr",{class:"no-selection-separator"},null,-1)),o("div",$s,[ce(e.$slots,"default",{},void 0,!0)])]))])])}const Wi=z(Cs,[["render",ei],["__scopeId","data-v-1e805d77"]]);export{Wi as default};
//# sourceMappingURL=TaskInfo-C2DOZkHo.js.map
