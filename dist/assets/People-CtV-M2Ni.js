import{j as c,B as m,k as h,M as _,m as l,g as n,b9 as g,n as d,o as u,ba as f,y as b,h as C,T as $,N as w,x,az as y,I as E,aj as k,z as P,A as D,V as F,r as p}from"./index-kofpwtlj.js";import{B as T}from"./ButtonHrefLink-jSjiRB0K.js";import{D as I}from"./DepartmentNamesCell-DU70I9hQ.js";import{P as L}from"./PeopleNameCell-jwBOCt18.js";const S={name:"build-people-filter-modal",mixins:[c],components:{ButtonSimple:m,Combobox:h,ModalFooter:_},props:{active:{type:Boolean,default:!1}},data(){return{general:{operatorOptions:[{label:"equal",value:"="},{label:"not_equal",value:"=-"},{label:"in",value:"in"}],unionOptions:[{label:"union_and",value:"and"},{label:"union_or",value:"or"}]},departmentFilters:{values:[]},union:"and"}},mounted(){this.reset(),this.setFiltersFromCurrentQuery()},computed:{...l(["peopleSearchText","peopleSearchText","departmentMap","departments"]),departmentsOptions(){return this.departments.map(s=>({label:s.name,value:s.id}))}},methods:{...n([]),applyFilter(){const s=this.buildFilter();this.$emit("confirm",s)},buildFilter(){let s="";return s=this.applyDepartmentChoice(s),s=this.applyUnionChoice(s),s.trim()},addDepartmentFilter(){const s={operator:"=",values:[this.departments[0].id]};return this.departmentFilters.values.push(s),s},addInDepartmentFilter(s){s.values.push(this.departments[0].name)},removeDepartmentFilter(s){this.departmentFilters.values=this.departmentFilters.values.filter(e=>e!==s)},applyDepartmentChoice(s){return this.departmentFilters.values.forEach(e=>{let t="=[";e.operator==="=-"&&(t="=[-");const i=e.values.map(a=>this.departmentMap.get(a)?this.departmentMap.get(a).name:this.departments[0].name).join(",");s+=` department${t}${i}]`}),s},applyUnionChoice(s){return this.union==="or"&&(s=` +(${s.trim()})`),s},setFiltersFromCurrentQuery(){if(!this.peopleSearchText)return;this.departmentFilters.values=[];const s=g({entryIndex:[],departments:this.departments,persons:[],query:this.peopleSearchText});s.forEach(e=>{this.setFiltersFromDepartmentQuery(e)}),s.union&&this.setUnion()},setFiltersFromDepartmentQuery(s){let e="=";s.values.length>1?e="in":s.excluding&&(e="=-"),this.departmentFilters.values.push({operator:e,values:s.values.map(t=>t.id)})},setUnion(){this.union="or"},onDepartmentOperatorChanged(s){s.operator!=="in"&&(s.values=[s.values[0]])},reset(){this.departmentFilters.values=[{operator:"=",values:this.departments.length>0?[this.departments[0].id]:[]}]}},watch:{active(){this.active&&(this.reset(),this.setFiltersFromCurrentQuery())}}};var A=function(){var e=this,t=e._self._c;return t("div",{class:{modal:!0,"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:function(i){return e.$emit("cancel")}}}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box content"},[t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("entities.build_filter.title"))+" ")]),t("h3",{staticClass:"subtitle"},[e._v(" "+e._s(e.$t("entities.build_filter.department"))+" ")]),e._l(e.departmentFilters.values,function(i,a){return t("div",{key:"task-type-"+a,staticClass:"flexrow department-filter"},[t("combobox",{staticClass:"flexrow-item",attrs:{options:e.general.operatorOptions,"locale-key-prefix":"entities.build_filter."},on:{input:function(r){return e.onDepartmentOperatorChanged(i)}},model:{value:i.operator,callback:function(r){e.$set(i,"operator",r)},expression:"departmentFilter.operator"}}),t("div",{staticClass:"flexrow-item flexrow value-column"},[e._l(i.values,function(r,o){return t("div",{key:`department-${o}`},[t("combobox",{staticClass:"flexrow-item",attrs:{options:e.departmentsOptions},model:{value:i.values[o],callback:function(v){e.$set(i.values,o,v)},expression:"departmentFilter.values[index]"}})],1)}),i.operator==="in"?t("button-simple",{staticClass:"mt05",attrs:{icon:"plus"},on:{click:function(r){return e.addInDepartmentFilter(i)}}}):e._e()],2)],1)}),t("modal-footer",{attrs:{"error-text":e.$t("entities.thumbnails.error")},on:{confirm:e.applyFilter,cancel:function(i){return e.$emit("cancel")}}})],2)])])},M=[],R=d(S,A,M,!1,null,"680dffb8",null,null);const B=R.exports,V={name:"change-password-modal",mixins:[c],props:{active:{type:Boolean,default:!1},person:{type:Object,default:()=>{}}},data(){return{form:{password:"",password2:""},isLoading:!1,isError:!1,isErrorDisableTwoFactorAuthentication:!1,isValid:!0}},components:{TextField:u},computed:{...l([])},methods:{...n(["changePasswordPerson","disableTwoFactorAuthenticationPerson"]),confirmClicked(){this.isErrorDisableTwoFactorAuthentication=!1,this.isError=!1,this.isLoading=!0,this.changePasswordPerson({person:this.person,form:this.form}).then(()=>{this.$emit("confirm")}).catch(s=>{s.isValidPassword===!1?this.isValid=!1:this.isError=!0}).finally(()=>{this.isLoading=!1})},disableTwoFactorAuthenticationClicked(){this.isErrorDisableTwoFactorAuthentication=!1,this.isError=!1,this.isLoading=!0,this.disableTwoFactorAuthenticationPerson(this.person).catch(()=>{this.isErrorDisableTwoFactorAuthentication=!0}).finally(()=>{this.isLoading=!1})},resetForm(){this.person&&(this.form={password:"",password2:""},this.isLoading=!1,this.isError=!1,this.isErrorDisableTwoFactorAuthentication=!1,this.isValid=!0)}},watch:{person(){this.resetForm()},active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs["first-password"].focus()},100))}}};var O=function(){var e=this,t=e._self._c;return t("div",{class:{modal:!0,"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:function(i){return e.$emit("cancel")}}}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box"},[t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("people.change_password_for"))+" "+e._s(e.person.name)+" ")]),t("form",{on:{submit:function(i){i.preventDefault()}}},[t("text-field",{ref:"first-password",attrs:{disabled:e.person.is_generated_from_ldap,label:e.$t("people.fields.password"),type:"password"},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.password,callback:function(i){e.$set(e.form,"password",i)},expression:"form.password"}}),t("text-field",{attrs:{disabled:e.person.is_generated_from_ldap,label:e.$t("people.fields.password_2"),type:"password"},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.password2,callback:function(i){e.$set(e.form,"password2",i)},expression:"form.password2"}})],1),t("div",{staticClass:"flexrow"},[t("button",{class:{button:!0,"is-primary":!0,"flexrow-item":!0,"is-loading":e.isLoading},attrs:{disabled:e.person.is_generated_from_ldap},on:{click:e.confirmClicked}},[e._v(" "+e._s(e.$t("profile.change_password.button"))+" ")]),t("button",{class:{button:!0,"flexrow-item":!0,"is-loading":e.isLoading,"is-warning":!0},attrs:{disabled:!(e.person.totp_enabled||e.person.email_otp_enabled)},on:{click:e.disableTwoFactorAuthenticationClicked}},[e._v(" "+e._s(e.$t("people.disable_2FA"))+" ")]),t("div",{staticClass:"filler"}),t("button",{staticClass:"button is-link flexrow-item",on:{click:function(i){return e.$emit("cancel")}}},[e._v(" "+e._s(e.$t("main.cancel"))+" ")])]),e.isValid?e._e():t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("profile.change_password.unvalid"))+" ")]),e.isError?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.change_password_error"))+" ")]):e._e(),e.isErrorDisableTwoFactorAuthentication?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.disable_2FA_error"))+" ")]):e._e()])])])},U=[],N=d(V,O,U,!1,null,"ab00d0de",null,null);const Q=N.exports,q={name:"edit-person-modal",mixins:[c],props:{active:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCreateInviteLoading:{type:Boolean,default:!1},isInviteLoading:{type:Boolean,default:!1},isInvitationSuccess:{type:Boolean,default:!1},isInvitationError:{type:Boolean,default:!1},isUserLimitError:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},personToEdit:{type:Object,default:()=>{}}},data(){return{activeOptions:[{label:this.$t("main.yes"),value:"true"},{label:this.$t("main.no"),value:"false"}],isValidEmail:!1,form:{first_name:"",last_name:"",email:"",phone:"",role:"user",active:"true",departments:[]},roleOptions:[{label:"user",value:"user"},{label:"supervisor",value:"supervisor"},{label:"manager",value:"manager"},{label:"client",value:"client"},{label:"vendor",value:"vendor"},{label:"admin",value:"admin"}],selectedDepartment:null}},components:{TextField:u,Combobox:h,ComboboxDepartment:f,DepartmentName:b},computed:{...l(["departments","departmentMap","isCurrentUserAdmin","people"]),selectableDepartments(){return this.departments.filter(s=>this.form.departments.findIndex(e=>e===s.id)===-1)},isCreating(){return this.personToEdit.id===void 0},personName(){return this.personToEdit!==void 0?this.personToEdit.first_name+" "+this.personToEdit.last_name:""}},methods:{...n([]),createAndInvite(){this.$emit("confirm-invite",this.form)},invite(){this.$emit("invite",this.form)},confirmClicked(){const s={...this.form};s.active=this.form.active==="true"||this.form.active===!0,this.form.email&&this.isValidEmail&&this.$emit("confirm",s)},addDepartment(){this.form.departments.push(this.selectedDepartment),this.selectedDepartment=null},removeDepartment(s){const e=this.form.departments.indexOf(s);e>=0&&this.form.departments.splice(e,1)},resetForm(){this.personToEdit?this.form={first_name:this.personToEdit.first_name,last_name:this.personToEdit.last_name,phone:this.personToEdit.phone,email:this.personToEdit.email,role:this.personToEdit.role,active:!this.personToEdit.id||this.personToEdit.active?"true":"false",departments:this.personToEdit.departments||[]}:this.form={first_name:"",last_name:"",email:"",phone:"",role:"user",active:"true",departments:[]},this.checkEmailValidity()},checkEmailValidity(){const s=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,e=this.people.some(t=>t.email===this.form.email&&(!this.personToEdit||this.personToEdit.email!==t.email));this.isValidEmail=this.form.email&&s.test(this.form.email)&&!e}},watch:{personToEdit(){this.resetForm()},active(){this.active&&(this.resetForm(),setTimeout(()=>{this.$refs["name-field"].focus()},100))},"form.email"(){this.checkEmailValidity()}}};var j=function(){var e=this,t=e._self._c;return t("div",{class:{modal:!0,"is-active":e.active}},[t("div",{staticClass:"modal-background",on:{click:function(i){return e.$emit("cancel")}}}),t("div",{staticClass:"modal-content"},[t("div",{staticClass:"box"},[e.personToEdit.id!==void 0?t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("people.edit_title"))+" "+e._s(e.personName)+" ")]):t("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("people.new_person"))+" ")]),t("form",{on:{submit:function(i){i.preventDefault()}}},[t("text-field",{ref:"name-field",attrs:{label:e.$t("people.fields.first_name"),disabled:e.personToEdit.is_generated_from_ldap},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.first_name,callback:function(i){e.$set(e.form,"first_name",i)},expression:"form.first_name"}}),t("text-field",{attrs:{label:e.$t("people.fields.last_name"),disabled:e.personToEdit.is_generated_from_ldap},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.last_name,callback:function(i){e.$set(e.form,"last_name",i)},expression:"form.last_name"}}),t("text-field",{attrs:{type:"email",errored:e.form.email&&!e.isValidEmail,label:e.$t("people.fields.email"),disabled:e.personToEdit.is_generated_from_ldap},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.email,callback:function(i){e.$set(e.form,"email",i)},expression:"form.email"}}),t("text-field",{attrs:{label:e.$t("people.fields.phone")},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.phone,callback:function(i){e.$set(e.form,"phone",i)},expression:"form.phone"}}),t("div",{staticClass:"departments field"},[t("label",{staticClass:"label"},[e._v(e._s(e.$t("people.fields.departments")))]),e.form.departments&&e.form.departments.length===0?t("p",{staticClass:"empty mb1"},[e._v(" "+e._s(e.$t("people.departments_empty"))+" ")]):e._e(),e._l(e.form.departments,function(i){return t("div",{key:i,staticClass:"department-element mb1 mt05",on:{click:function(a){return e.removeDepartment(i)}}},[i?t("department-name",{attrs:{department:e.departmentMap.get(i)}}):e._e()],1)}),t("div",{staticClass:"flexrow"},[e.selectableDepartments.length>0?t("combobox-department",{staticClass:"flexrow-item",attrs:{"selectable-departments":e.selectableDepartments},on:{enter:e.confirmClicked},model:{value:e.selectedDepartment,callback:function(i){e.selectedDepartment=i},expression:"selectedDepartment"}}):e._e(),e.selectableDepartments.length>0?t("button",{staticClass:"button is-success flexrow-item",class:{"is-disabled":e.selectedDepartment===null},on:{click:e.addDepartment}},[e._v(" "+e._s(e.$t("main.add"))+" ")]):e._e()],1)],2),t("combobox",{attrs:{label:e.$t("people.fields.role"),options:e.roleOptions,localeKeyPrefix:"people.role."},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.role,callback:function(i){e.$set(e.form,"role",i)},expression:"form.role"}}),t("combobox",{attrs:{label:e.$t("people.fields.active"),options:e.activeOptions,disabled:e.personToEdit.is_generated_from_ldap},on:{enter:function(i){return e.confirmClicked()}},model:{value:e.form.active,callback:function(i){e.$set(e.form,"active",i)},expression:"form.active"}})],1),t("div",{staticClass:"flexrow"},[!e.isCreating&&e.isCurrentUserAdmin?t("button",{class:{button:!0,"flexrow-item":!0,"is-loading":e.isInviteLoading},attrs:{disabled:!e.isValidEmail},on:{click:e.invite}},[e._v(" "+e._s(e.$t("people.invite"))+" ")]):e._e(),t("div",{staticClass:"filler"}),e.isCreating&&e.isCurrentUserAdmin?t("button",{class:{button:!0,"is-primary":!0,"flexrow-item":!0,"is-loading":e.isCreateInviteLoading},attrs:{disabled:!e.isValidEmail},on:{click:e.createAndInvite}},[e._v(" "+e._s(e.$t("people.create_invite"))+" ")]):e._e(),t("a",{class:{button:!0,"is-primary":!0,"flexrow-item":!0,"is-loading":e.isLoading},attrs:{disabled:!e.isValidEmail},on:{click:e.confirmClicked}},[e._v(" "+e._s(e.isCreating?e.$t("people.create"):e.$t("people.confirm_edit"))+" ")]),t("button",{staticClass:"button is-link flexrow-item",on:{click:function(i){return e.$emit("cancel")}}},[e._v(" "+e._s(e.$t("main.cancel"))+" ")])]),e.isInvitationSuccess?t("div",{staticClass:"success has-text-right mt1"},[e._v(" "+e._s(e.$t("people.invite_success"))+" ")]):e._e(),e.isInvitationError?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.invite_error"))+" ")]):e._e(),e.isUserLimitError?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.user_limit_error"))+" ")]):e._e(),e.isError?t("div",{staticClass:"error has-text-right mt1"},[e._v(" "+e._s(e.$t("people.create_error"))+" ")]):e._e()])])])},z=[],K=d(q,j,z,!1,null,"4ff6777a",null,null);const H=K.exports,Z={name:"people-list",components:{DepartmentNamesCell:I,PeopleNameCell:L,RowActionsCell:C,TableInfo:$},props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},computed:{...l(["departmentMap","isCurrentUserAdmin"]),activePeople(){return this.entries.filter(s=>s.active)},unactivePeople(){return this.entries.filter(s=>!s.active)}},methods:{...n([]),taskColor(s){return s<1||s>4?"red":""},onBodyScroll(s,e){this.$refs.body.style.left=`-${e.scrollLeft}px`}}};var G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"data-list"},[t("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onBodyScroll,expression:"onBodyScroll"}],ref:"body",staticClass:"datatable-wrapper"},[t("table",{staticClass:"datatable multi-section"},[t("thead",{staticClass:"datatable-head"},[t("tr",[t("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.name"))+" ")]),t("th",{staticClass:"email",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.email"))+" ")]),t("th",{staticClass:"phone",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.phone"))+" ")]),t("th",{staticClass:"role",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.role"))+" ")]),t("th",{staticClass:"departments",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.departments"))+" ")]),t("th",{staticClass:"actions",attrs:{scope:"col"}})])]),e.activePeople.length>0?t("tbody",{staticClass:"datatable-body"},[t("tr",{staticClass:"datatable-type-header"},[t("th",{attrs:{scope:"rowgroup",colspan:"5"}},[t("span",{staticClass:"datatable-row-header"},[e._v(e._s(e.$t("people.active")))])])]),e._l(e.activePeople,function(i){return t("tr",{key:i.id,staticClass:"datatable-row"},[t("people-name-cell",{staticClass:"name datatable-row-header",attrs:{person:i}}),t("td",{staticClass:"email"},[e._v(e._s(i.email))]),t("td",{staticClass:"phone"},[e._v(e._s(i.phone))]),t("td",{staticClass:"role"},[e._v(e._s(e.$t("people.role."+i.role)))]),t("department-names-cell",{staticClass:"departments",attrs:{departments:i.departments}}),e.isCurrentUserAdmin?t("row-actions-cell",{attrs:{"entry-id":i.id,"hide-delete":!0,"hide-change-password":!1},on:{"edit-clicked":function(a){return e.$emit("edit-clicked",i)},"change-password-clicked":function(a){return e.$emit("change-password-clicked",i)}}}):t("td",{staticClass:"actions"})],1)})],2):e._e(),e.unactivePeople.length>0?t("tbody",{staticClass:"datatable-body"},[t("tr",{staticClass:"datatable-type-header"},[t("th",{attrs:{scope:"rowgroup",colspan:"5"}},[t("span",{staticClass:"datatable-row-header"},[e._v(" "+e._s(e.$t("people.unactive"))+" ")])])]),e._l(e.unactivePeople,function(i){return t("tr",{key:i.id,staticClass:"datatable-row"},[t("people-name-cell",{staticClass:"name datatable-row-header",attrs:{person:i}}),t("td",{staticClass:"email"},[e._v(e._s(i.email))]),t("td",{staticClass:"phone"},[e._v(e._s(i.phone))]),t("td",{staticClass:"role"},[e._v(e._s(e.$t("people.role."+i.role)))]),t("department-names-cell",{staticClass:"departments",attrs:{departments:i.departments}}),e.isCurrentUserAdmin?t("row-actions-cell",{attrs:{"entry-id":i.id,"hide-change-password":!0},on:{"edit-clicked":function(a){return e.$emit("edit-clicked",i)},"delete-clicked":function(a){return e.$emit("delete-clicked",i)}}}):t("td",{staticClass:"actions"})],1)})],2):e._e()])]),t("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),e.isLoading?e._e():t("p",{staticClass:"has-text-centered footer-info"},[e._v(" "+e._s(e.entries.length)+" "+e._s(e.$tc("people.persons",e.entries.length))+" ("+e._s(e.activePeople.length)+" "+e._s(e.$tc("people.active_persons",e.activePeople.length))+") ")])],1)},J=[],W=d(Z,G,J,!1,null,"59135cc5",null,null);const X=W.exports,Y={name:"people",mixins:[w],components:{BuildPeopleFilterModal:B,ButtonHrefLink:T,ButtonSimple:m,ChangePasswordModal:Q,ComboboxStyled:x,ComboboxDepartment:f,EditPersonModal:H,HardDeleteModal:y,ImportModal:E,PageTitle:k,PeopleList:X,ImportRenderModal:P,SearchField:D,SearchQueryList:F},data(){return{csvColumns:["First Name","Last Name"],optionalCsvColumns:["Phone","Role"],dataMatchers:["Email"],role:"all",roleOptions:[{label:"all",value:"all"},{label:"admin",value:"admin"},{label:"client",value:"client"},{label:"manager",value:"manager"},{label:"supervisor",value:"supervisor"},{label:"user",value:"user"},{label:"vendor",value:"vendor"}],errors:{del:!1,edit:!1,invite:!1},loading:{createAndInvite:!1,edit:!1,del:!1,invite:!1,savingSearch:!1},modals:{edit:!1,del:!1,changePassword:!1,importModal:!1,isImportRenderDisplayed:!1,isBuildFilterDisplayed:!1},parsedCSV:[],personToDelete:{},personToEdit:{role:"user"},personToChangePassword:{},selectedDepartment:"",success:{invite:!1}}},mounted(){this.role=this.$route.query.role||"all",this.selectedDepartment=this.$route.query.department||"",this.loadPeople(()=>{this.setSearchFromUrl(),this.onSearchChange()})},watch:{"modals.edit"(){this.modals.edit&&(this.loading.createAndInvite=!1,this.errors.edit=!1,this.errors.invite=!1,this.errors.userLimit=!1,this.loading.edit=!1,this.loading.invite=!1,this.success.invite=!1)},selectedDepartment(){this.updateRoute()},role(){this.updateRoute()}},computed:{...l(["displayedPeople","isCurrentUserAdmin","isPeopleLoading","isPeopleLoadingError","isImportPeopleModalShown","isImportPeopleLoading","isImportPeopleLoadingError","peopleSearchQueries","personCsvFormData"]),currentPeople(){let s=this.role==="all"?this.displayedPeople:this.displayedPeople.filter(e=>e.role===this.role);return this.selectedDepartment&&(s=s.filter(e=>e.departments.includes(this.selectedDepartment))),s},deleteText(){var e;const s=(e=this.personToDelete)==null?void 0:e.full_name;return s?this.$t("people.delete_text",{personName:s}):""},filteredPeople(){const s={};return this.displayedPeople.forEach(e=>{const t=e.email;s[t]=!0}),s},searchField(){return this.$refs["people-search-field"]}},methods:{...n(["editPerson","deletePeople","invitePerson","loadPeople","loadDepartments","newPerson","newPersonAndInvite","removePeopleSearch","savePeopleSearch","setPeopleSearch","uploadPersonFile"]),renderImport(s,e){this.loading.importing=!0,this.errors.importing=!1,this.formData=s,e==="file"&&(s=s.get("file")),p.processCSV(s).then(t=>{this.parsedCSV=t,this.hideImportModal(),this.loading.importing=!1,this.showImportRenderModal()})},uploadImportFile(s,e){const t=new FormData,i="import.csv",a=p.turnEntriesToCsvString(s),r=new File([a],i,{type:"text/csv"});t.append("file",r),this.loading.importing=!0,this.errors.importing=!1,this.$store.commit("PERSON_CSV_FILE_SELECTED",t),this.uploadPersonFile(e).then(()=>{this.$store.dispatch("loadPeople"),this.hideImportRenderModal()}).catch(o=>{console.error(o),this.loading.importing=!1,this.errors.importing=!0})},resetImport(){this.errors.importing=!1,this.hideImportRenderModal(),this.$store.commit("PERSON_CSV_FILE_SELECTED",null),this.$refs["import-modal"].reset(),this.showImportModal()},confirmEditPeople(s){let e="editPerson";this.personToEdit.id===void 0?e="newPerson":s.id=this.personToEdit.id,this.loading.edit=!0,this.errors.edit=!1,this.errors.userLimit=!1,this[e](s).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(t=>{t.body&&t.body.message&&t.body.message.indexOf("limit")>0?this.errors.userLimit=!0:this.errors.edit=!0,this.loading.edit=!1})},confirmCreateAndInvite(s){this.loading.createAndInvite=!0,this.errors.edit=!1,this.errors.userLimit=!1,this.newPersonAndInvite(s).then(()=>{this.loading.createAndInvite=!1,this.modals.edit=!1}).catch(e=>{e.body&&e.body.message&&e.body.message.indexOf("limit")>0?this.errors.userLimit=!0:this.errors.edit=!0,this.errors.edit=!0,this.loading.createAndInvite=!1}),this.onSearchChange()},confirmInvite(s){s.id=this.personToEdit.id,this.loading.invite=!0,this.errors.invite=!1,this.invitePerson(s).then(()=>{this.loading.invite=!1,this.success.invite=!0}).catch(e=>{console.error(e),this.loading.invite=!1,this.success.invite=!1,this.errors.invite=!0}),this.onSearchChange()},confirmDeletePeople(){this.loading.del=!0,this.errors.del=!1,this.deletePeople(this.personToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(s=>{console.error(s),this.loading.del=!1,this.errors.del=!0})},onSearchChange(){if(!this.searchField)return;const s=this.searchField.getValue();s.length!==1&&(this.setPeopleSearch(s),this.updateRoute())},onDeleteClicked(s){this.personToDelete=s,this.modals.del=!0},onEditClicked(s){this.errors.invite=!1,this.success.invite=!1,this.personToEdit=s,this.modals.edit=!0},onChangePasswordClicked(s){this.personToChangePassword=s,this.modals.changePassword=!0},onNewClicked(){this.errors.invite=!1,this.success.invite=!1,this.personToEdit={role:"user"},this.modals.edit=!0},showImportModal(){this.modals.importModal=!0},hideImportModal(){this.modals.importModal=!1},showImportRenderModal(){this.modals.isImportRenderDisplayed=!0},hideImportRenderModal(){this.modals.isImportRenderDisplayed=!1},saveSearchQuery(s){this.loading.savingSearch||(this.loading.savingSearch=!0,this.savePeopleSearch(s).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(s){this.removePeopleSearch(s).catch(console.error)},confirmBuildFilter(s){this.modals.isBuildFilterDisplayed=!1,this.searchField.setValue(s),this.onSearchChange()},updateRoute(){const s=this.searchField.getValue(),e=this.selectedDepartment,t=this.role;this.$router.push({query:{search:s,department:e,role:t}})}},metaInfo(){return{title:`${this.$t("people.title")} - Kitsu`}}};var ee=function(){var e=this,t=e._self._c;return t("div",{staticClass:"people page fixed-page"},[t("div",{staticClass:"flexrow page-header"},[t("page-title",{staticClass:"flexrow-item filler",attrs:{text:e.$t("people.title")}}),e.isCurrentUserAdmin?t("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("main.csv.import_file"),"is-responsive":!0,icon:"upload"},on:{click:e.showImportModal}}):e._e(),t("button-href-link",{staticClass:"flexrow-item",attrs:{title:e.$t("main.csv.export_file"),icon:"download",path:"/api/export/csv/persons.csv"}}),e.isCurrentUserAdmin?t("button-simple",{staticClass:"flexrow-item",attrs:{text:e.$t("people.new_person"),"is-responsive":!0,icon:"plus"},on:{click:e.onNewClicked}}):e._e()],1),t("div",{staticClass:"flexrow search-options"},[t("search-field",{ref:"people-search-field",staticClass:"search flexrow-item",attrs:{"can-save":!0,placeholder:"ex: John Doe"},on:{change:e.onSearchChange,save:e.saveSearchQuery}}),t("combobox-department",{staticClass:"combobox-department flexrow-item",attrs:{label:e.$t("main.department")},model:{value:e.selectedDepartment,callback:function(i){e.selectedDepartment=i},expression:"selectedDepartment"}}),t("combobox-styled",{staticClass:"flexrow-item",attrs:{label:e.$t("people.fields.role"),options:e.roleOptions,"locale-key-prefix":"people.role.","no-margin":""},model:{value:e.role,callback:function(i){e.role=i},expression:"role"}})],1),t("div",{staticClass:"query-list"},[e.isPeopleLoading?e._e():t("search-query-list",{attrs:{queries:e.peopleSearchQueries,type:"people"},on:{"change-search":e.changeSearch,"remove-search":e.removeSearchQuery}})],1),t("people-list",{attrs:{entries:e.currentPeople,"is-loading":e.isPeopleLoading,"is-error":e.isPeopleLoadingError},on:{"edit-clicked":e.onEditClicked,"delete-clicked":e.onDeleteClicked,"change-password-clicked":e.onChangePasswordClicked}}),t("import-render-modal",{attrs:{active:e.modals.isImportRenderDisplayed,"is-loading":e.isImportPeopleLoading,"is-error":e.isImportPeopleLoadingError,"parsed-csv":e.parsedCSV,"form-data":e.personCsvFormData,columns:[...e.dataMatchers,...e.csvColumns,...e.optionalCsvColumns],dataMatchers:e.dataMatchers,database:e.filteredPeople},on:{reupload:e.resetImport,cancel:e.hideImportRenderModal,confirm:e.uploadImportFile}}),t("import-modal",{ref:"import-modal",attrs:{active:e.modals.importModal,"is-loading":e.isImportPeopleLoading,"is-error":e.isImportPeopleLoadingError,"form-data":e.personCsvFormData,columns:[...e.dataMatchers,...e.csvColumns],"optional-columns":e.optionalCsvColumns},on:{cancel:e.hideImportModal,confirm:e.renderImport}}),t("edit-person-modal",{attrs:{active:e.modals.edit,"is-create-invite-loading":e.loading.createAndInvite,"is-error":e.errors.edit,"is-invite-loading":e.loading.invite,"is-invitation-success":e.success.invite,"is-invitation-error":e.errors.invite,"is-loading":e.loading.edit,"is-user-limit-error":e.errors.userLimit,"person-to-edit":e.personToEdit},on:{cancel:function(i){e.modals.edit=!1},confirm:e.confirmEditPeople,"confirm-invite":e.confirmCreateAndInvite,invite:e.confirmInvite}}),t("change-password-modal",{attrs:{active:e.modals.changePassword,person:e.personToChangePassword},on:{cancel:function(i){e.modals.changePassword=!1},confirm:function(i){e.modals.changePassword=!1}}}),t("hard-delete-modal",{attrs:{active:e.modals.del,"error-text":e.$t("people.delete_error"),"is-loading":e.loading.del,"is-error":e.errors.del,"lock-text":e.personToDelete?e.personToDelete.full_name:"",text:e.deleteText},on:{cancel:function(i){e.modals.del=!1},confirm:e.confirmDeletePeople}}),t("build-people-filter-modal",{ref:"build-filter-modal",attrs:{active:e.modals.isBuildFilterDisplayed},on:{cancel:function(i){e.modals.isBuildFilterDisplayed=!1},confirm:e.confirmBuildFilter}})],1)},te=[],se=d(Y,ee,te,!1,null,"eb85aa66",null,null);const le=se.exports;export{le as default};
//# sourceMappingURL=People-CtV-M2Ni.js.map
