import{_ as L,a as S,T as C,c8 as B,r as p,c as i,o as n,d as g,f as m,e as h,t as u,F as b,g as M,aG as D,h as U,bW as X,c9 as x,A as c,w as I,m as O,ca as j,bd as V,cb as F,a7 as K,cc as z,cd as G,ce as H,G as P,a8 as k,n as T,k as v,ad as J,S as Z,I as $,cf as ee,L as te,b as se,B as ae,aB as R,ab as oe,cg as re,ac as ne,aE as Q,N as ie}from"./index-53_U9xxi.js";import{R as ue}from"./RouteTabs-BKqWN8rE.js";const le={name:"quota-shot-list",components:{TableInfo:C},props:{shots:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},countMode:{type:String,default:"frames"}},computed:{...S(["currentProduction"])},methods:{getQuota(t){return this.countMode==="seconds"?B(t.nb_frames,this.currentProduction,t):t.nb_frames}}},de={class:"data-list"},he={key:0,class:"details table"};function ce(t,s,e,l,a,o){const _=p("table-info");return n(),i("div",de,[e.isLoading?g("",!0):(n(),i("table",he,[h("thead",null,[h("tr",null,[h("th",null,u(t.$t("quota.details_name")),1),h("th",null,u(e.countMode==="seconds"?t.$t("quota.details_seconds"):t.$t("quota.details_frames")),1),h("th",null,u(t.$t("quota.weight")),1)])]),h("tbody",null,[(n(!0),i(b,null,M(e.shots,f=>(n(),i("tr",{key:`shot-quota-${f.id}`},[h("td",null,u(f.full_name),1),h("td",null,u(o.getQuota(f)),1),h("td",null,u(f.weight),1)]))),128))])])),m(_,{"is-loading":e.isLoading,"is-error":e.isLoadingError},null,8,["is-loading","is-error"])])}const me=L(le,[["render",ce],["__scopeId","data-v-b536c747"]]),pe={name:"people-quota-info",components:{XIcon:X,PageTitle:U,PeopleAvatar:D,QuotaShotList:me},props:{person:{type:Object,default:()=>{}},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},countMode:{type:String,default:"frames"},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},shots:{type:Array,default:()=>[]}},emits:["close"],computed:{...S(["currentEpisode","currentProduction"]),startDay(){return c().day("Monday").year(this.year).week(this.week).date()},endDay(){return c().day("Monday").year(this.year).week(this.week).add(6,"days").date()},weekMonth(){return c().day("Monday").year(this.year).week(this.week).format("MMM")},monthString(){return x(this.month)},isMonthInfo(){return this.$route.path.indexOf("month")>0},isWeekInfo(){return this.$route.path.indexOf("week")>0},isDayInfo(){return this.$route.path.indexOf("day")>0},closeRoute(){if(!this.currentProduction)return{};let t={name:"quota",production_id:this.currentProduction.id};return this.isMonthInfo?t={name:"quota-month",params:{year:this.year}}:this.isWeekInfo?t={name:"quota-week",params:{year:this.year}}:this.isDayInfo&&(t={name:"quota-day",params:{year:this.year,month:this.month}}),this.currentEpisode&&(t.name=`episode-${t.name}`,t.params.episode_id=this.currentEpisode.id),t.query=this.$route.query,t}},methods:{onCloseClicked(){this.$emit("close")}}},ye={class:"people-timesheet-info"},fe={class:"close"},ge={class:"flexrow"},_e={key:0,class:"info-date"},be={key:1,class:"info-date"},Me={key:2,class:"info-date"};function ke(t,s,e,l,a,o){const _=p("x-icon"),f=p("router-link"),w=p("people-avatar"),r=p("page-title"),d=p("quota-shot-list");return n(),i("div",ye,[h("div",fe,[m(f,{class:"close-button",to:o.closeRoute},{default:I(()=>[m(_)]),_:1},8,["to"])]),h("div",ge,[m(w,{class:"flexrow-item",person:e.person,"is-lazy":!1},null,8,["person"]),m(r,{class:"flexrow-item",text:e.person.full_name},null,8,["text"])]),o.isMonthInfo?(n(),i("div",_e,u(o.monthString)+" "+u(e.year),1)):o.isWeekInfo?(n(),i("div",be,u(t.$t("main.week"))+" "+u(e.week)+", "+u(o.startDay)+" - "+u(o.endDay)+" "+u(o.weekMonth)+" "+u(e.year),1)):o.isDayInfo?(n(),i("div",Me,u(e.day)+" "+u(o.monthString)+" "+u(e.year),1)):g("",!0),m(d,{class:"time-spent-list","count-mode":e.countMode,shots:e.shots,"is-loading":e.isLoading,"is-error":e.isLoadingError},null,8,["count-mode","shots","is-loading","is-error"])])}const qe=L(pe,[["render",ke],["__scopeId","data-v-3b034625"]]),ve={name:"quota",components:{PeopleAvatar:D,TableInfo:C},props:{taskTypeId:{type:String,required:!1},personId:{type:String,required:!1},detailLevel:{type:String,required:!0},countMode:{type:String,required:!0},computeMode:{type:String,required:!0},year:{type:Number,default:0},month:{type:Number,default:0},searchText:{type:String,default:""},maxQuota:{default:0}},data(){return{currentMonth:c().month()+1,currentYear:c().year(),currentWeek:c().week(),detailsMap:{},isLoading:!0,isError:!1,personIds:[],quotaMap:{},quotaLength:0,averageColumnX:"12rem"}},mounted(){this.shotMap.size<2?(this.isLoading=!0,setTimeout(()=>{this.loadShots(t=>{t||this.loadData()})},100)):(this.isShotsLoading||(this.isLoading=!1),this.loadData())},computed:{...S(["currentEpisode","currentProduction","isShotsLoading","personMap","shotMap","taskTypeMap"]),monthRange(){return H(this.year,this.currentYear,this.currentMonth)},dayRange(){return G(this.year,this.month,this.currentYear,this.currentMonth)},weekRange(){return z(this.year,this.currentYear,this.currentWeek)},entryIds(){return this.personId?K(Object.keys(this.quotaMap).filter(t=>t!=="total").map(t=>this.taskTypeMap.get(t)),this.currentProduction).map(t=>t.id).concat(["total"]):this.filteredPersonIds},filteredPersonIds(){let t=this.personIds;return this.searchText.length>0&&(t=F(this.personIndex,this.searchText.split(" ")).map(s=>s.id)),t}},methods:{...O(["loadShots","computeQuota","getPeriodDetails"]),episodifyRoute(t){return this.currentEpisode&&V(t,this.currentEpisode.id),t},isWeekend(t,s,e){let l=c(`${t}-${s}-${e}`,"YYYY-MM-DD");return e<10&&(l=c(`${t}-${s}-0${e}`,"YYYY-MM-DD")),[0,6].includes(l.day())},loadData(){(this.taskTypeId||this.personId)&&(this.isLoading=!0,this.computeQuota({taskTypeId:this.taskTypeId,personId:this.personId,detailLevel:this.detailLevel,countMode:this.countMode,computeMode:this.computeMode}).then(t=>{this.quotaMap=t,this.quotaLength=Object.keys(this.quotaMap).length,this.calcAverageColumnX(),this.$nextTick(()=>{this.isLoading=!1})}).catch(t=>{this.quotaMap={},this.quotaLength=0,this.calcAverageColumnX(),this.isLoading=!1,console.error(t)}))},loadDetails(t,s){this.loadShots(e=>{this.isLoading=!0,e?console.error(e):this.taskTypeId&&this.getPeriodDetails({taskTypeId:this.taskTypeId,detailLevel:this.detailLevel,personId:t,dateString:s}).then(l=>{this.detailsMap=l})})},monthToString:x,dateDigit(t){return t.toString().padStart(2,"0")},getQuota(t,s={}){let e="-";if(!t)return e;if(s.day){const l=`${s.year}-${this.dateDigit(s.month)}-${this.dateDigit(s.day)}`;e=this.quotaMap[t].day[this.countMode][l]}else if(s.week){const l=`${s.year}-${s.week}`;e=this.quotaMap[t].week[this.countMode][l]}else{const l=`${s.year}-${this.dateDigit(s.month)}`;e=this.quotaMap[t].month[this.countMode][l]}return this.countMode==="seconds"?e?e.toFixed(2):"-":e||"-"},getQuotaAverage(t,s={}){if(!t)return"-";let e=0,l=0,a;if(this.detailLevel==="day"){const o=`${s.year}-${this.dateDigit(s.month)}`;l=this.quotaMap[t].month[this.countMode][o],a=this.quotaMap[t].day.entries[o]}else if(this.detailLevel==="week"){const o=s.year;l=this.quotaMap[t].year[this.countMode][o],a=this.quotaMap[t].week.entries[o]}else if(this.detailLevel==="month"){const o=s.year;l=this.quotaMap[t].year[this.countMode][o],a=this.quotaMap[t].month.entries[o]}return e=l/a,e?e.toFixed(2):"-"},isDaySelected(t,s,e,l){return this.$route.params.person_id&&this.$route.params.person_id===t&&""+this.$route.params.year==""+s&&""+this.$route.params.month==""+e&&""+this.$route.params.day==""+l},isWeekSelected(t,s,e){return this.$route.params.person_id&&this.$route.params.person_id===t&&""+this.$route.params.year==""+s&&""+this.$route.params.week==""+e},isMonthSelected(t,s,e){return this.$route.params.person_id&&this.$route.params.person_id===t&&""+this.$route.params.year==""+s&&""+this.$route.params.month==""+e},isDayQuotaLow(t,s,e,l){const a=this.getQuota(t,{year:s,month:e,day:l});return a!==null&&this.maxQuota>a},isWeekQuotaLow(t,s,e){return this.maxQuota>this.getQuota(t,{year:s,week:e})},isMonthQuotaLow(t,s,e){return this.maxQuota>this.getQuota(t,{year:s,month:e})},calcAverageColumnX(){this.quotaLength>0&&(this.averageColumnX=`${this.$refs.rowHeaderName.offsetWidth}px`)},resetPersonIds(){const t=Object.keys(this.quotaMap).filter(e=>e!=="total"),s=t.map(e=>this.personMap.get(e));this.personIndex=j(s),this.personIds=t.sort((e,l)=>{const a=this.personMap.get(e).full_name,o=this.personMap.get(l).full_name;return a.localeCompare(o)}).concat(["total"])}},watch:{$route(){document.getElementsByClassName("selected").length===0&&setTimeout(()=>{this.$refs.body.scrollLeft+=380},100)},computeMode(){(this.taskTypeId||this.personId)&&this.loadData()},quotaMap(){this.taskTypeId&&this.resetPersonIds()},taskTypeId(){this.taskTypeId&&this.loadData()},personId(){this.personId&&this.loadData()}}},we={class:"data-list"},Ie={class:"datatable-wrapper",ref:"body"},Le={class:"datatable"},Se={class:"datatable-head"},Te={key:0,class:"datatable-body"},Qe={scope:"row",class:"name datatable-row-header"},xe={key:0,class:"flexrow"},Pe={key:1,class:"flexrow"},Re={key:2,class:"flexrow"},Ce={key:3,class:"flexrow"},De={key:1},Oe={key:2},Ve={key:1},Ne={key:2},Ye={key:1},Ee={key:2},We={key:0,class:"has-text-centered empty-quota"},Ae={class:"info"};function Be(t,s,e,l,a,o){const _=p("people-avatar"),f=p("router-link"),w=p("table-info");return n(),i("div",we,[h("div",Ie,[h("table",Le,[h("thead",Se,[h("tr",null,[h("th",{scope:"col",class:"name datatable-row-header",ref:"rowHeaderName"},u(t.$t("quota.name")),513),h("th",{scope:"col",class:"average datatable-row-header",style:P({left:a.averageColumnX})},u(t.$t("quota.average")),5),e.detailLevel==="month"?(n(!0),i(b,{key:0},M(o.monthRange,r=>(n(),i("th",{scope:"col",key:"month-"+r},u(o.monthToString(r)),1))),128)):e.detailLevel==="week"?(n(!0),i(b,{key:1},M(o.weekRange,r=>(n(),i("th",{scope:"col",key:"week-"+r},u(r),1))),128)):e.detailLevel==="day"?(n(!0),i(b,{key:2},M(o.dayRange,r=>(n(),i("th",{scope:"col",key:"day-"+r},u(r),1))),128)):g("",!0)])]),a.quotaLength>0&&!a.isLoading?(n(),i("tbody",Te,[(n(!0),i(b,null,M(o.entryIds,r=>(n(),i("tr",{key:"name-"+r,class:"datatable-row"},[h("th",Qe,[e.taskTypeId&&r!=="total"?(n(),i("div",xe,[m(_,{size:30,person:t.personMap.get(r)},null,8,["person"]),k(" "+u(t.personMap.get(r).full_name),1)])):e.taskTypeId&&r==="total"?(n(),i("div",Pe,u(t.$t("main.total")),1)):e.personId&&r!=="total"?(n(),i("div",Re,u(t.taskTypeMap.get(r).name),1)):e.personId&&r==="total"?(n(),i("div",Ce,u(t.$t("main.total")),1)):g("",!0)]),h("td",{class:"average datatable-row-header",style:P({left:a.averageColumnX})},[e.detailLevel==="month"||e.detailLevel==="week"?(n(),i(b,{key:0},[k(u(o.getQuotaAverage(r,{year:e.year})),1)],64)):e.detailLevel==="day"?(n(),i(b,{key:1},[k(u(o.getQuotaAverage(r,{year:e.year,month:e.month})),1)],64)):g("",!0)],4),e.detailLevel==="month"?(n(!0),i(b,{key:0},M(o.monthRange,d=>(n(),i("td",{class:T({selected:o.isMonthSelected(r,e.year,d),"quota-low":o.isMonthQuotaLow(r,e.year,d)}),key:"month-"+d},[r!=="total"&&o.getQuota(r,{year:e.year,month:d})?(n(),v(f,{key:0,class:"quota-button",to:o.episodifyRoute({name:"quota-month-person",params:{person_id:e.personId??r,year:e.year,month:d},query:{...t.$route.query,taskTypeId:e.personId?r:null}})},{default:I(()=>[k(u(o.getQuota(r,{year:e.year,month:d})),1)]),_:2},1032,["to"])):r==="total"?(n(),i("span",De,u(o.getQuota(r,{year:e.year,month:d})),1)):(n(),i("span",Oe,"-"))],2))),128)):e.detailLevel==="week"?(n(!0),i(b,{key:1},M(o.weekRange,d=>(n(),i("td",{class:T({selected:o.isWeekSelected(r,e.year,d),"quota-low":o.isWeekQuotaLow(r,e.year,e.month)}),key:"week-"+d},[r!=="total"&&o.getQuota(r,{year:e.year,week:d})?(n(),v(f,{key:0,class:"quota-button",to:o.episodifyRoute({name:"quota-week-person",params:{person_id:e.personId??r,year:e.year,week:d},query:{...t.$route.query,taskTypeId:e.personId?r:null}})},{default:I(()=>[k(u(o.getQuota(r,{year:e.year,week:d})),1)]),_:2},1032,["to"])):r==="total"?(n(),i("span",Ve,u(o.getQuota(r,{year:e.year,week:d})),1)):(n(),i("span",Ne," - "))],2))),128)):e.detailLevel==="day"?(n(!0),i(b,{key:2},M(o.dayRange,d=>(n(),i("td",{class:T({weekend:o.isWeekend(e.year,e.month,d),selected:o.isDaySelected(r,e.year,e.month,d),"quota-low":o.isDayQuotaLow(r,e.year,e.month,d)}),key:"day-"+d},[r!=="total"&&o.getQuota(r,{year:e.year,month:e.month,day:d})?(n(),v(f,{key:0,class:"quota-button",to:o.episodifyRoute({name:"quota-day-person",params:{person_id:e.personId??r,year:e.year,month:e.month,day:d},query:{...t.$route.query,taskTypeId:e.personId?r:null}})},{default:I(()=>[k(u(e.countMode==="seconds"?o.getQuota(r,{year:e.year,month:e.month,day:d}):o.getQuota(r,{year:e.year,month:e.month,day:d})),1)]),_:2},1032,["to"])):r==="total"?(n(),i("span",Ye,u(e.countMode==="seconds"?o.getQuota(r,{year:e.year,month:e.month,day:d}):o.getQuota(r,{year:e.year,month:e.month,day:d})),1)):(n(),i("span",Ee," - "))],2))),128)):g("",!0)]))),128))])):g("",!0)])],512),a.quotaLength===0&&!a.isLoading?(n(),i("div",We,[h("p",Ae,u(t.$t("quota.no_quota")),1)])):g("",!0),m(w,{"is-loading":a.isLoading,"is-error":a.isError},null,8,["is-loading","is-error"])])}const Ue=L(ve,[["render",Be],["__scopeId","data-v-1f201298"]]),q=re.cache.personMap,Xe={name:"production-quota",components:{ButtonSimple:ae,Combobox:se,ComboboxTaskType:te,InfoQuestionMark:ee,PeopleField:$,PeopleQuotaInfo:qe,Quota:Ue,RouteTabs:ue,SearchField:Z,TextField:J},data(){return{activeTab:"tasktypes",tabs:[{name:"tasktypes",label:this.$t("task_types.title")},{name:"persons",label:this.$t("main.people")}],countModeOptions:[{label:this.$t("quota.frames"),value:"frames"},{label:this.$t("quota.seconds"),value:"seconds"},{label:this.$t("quota.count"),value:"count"}],detailLevelOptions:[{label:this.$t("quota.day"),value:"day"},{label:this.$t("quota.week"),value:"week"},{label:this.$t("quota.month"),value:"month"}],computeModeOptions:[{label:this.$t("quota.weighted"),value:"weighted"},{label:this.$t("quota.feedback_date"),value:"feedback"},{label:this.$t("quota.weighted_done"),value:"weighteddone"},{label:this.$t("quota.done_date"),value:"done"}],currentYear:c().year(),currentMonth:c().month()+1,currentWeek:c().week(),currentDay:c().date(),currentPerson:this.getCurrentPerson(),currentMode:"frames",detailLevel:"day",isLoading:!1,isPersonShotsLoading:!1,maxQuota:0,detailLevelString:"day",monthString:`${c().month()+1}`,yearString:`${c().year()}`,params:{countMode:"frames",computeMode:"weighted",person:null,taskTypeId:""},personShots:[],silent:!1,searchText:"",showInfo:!1}},mounted(){this.setCountModeOptions();const t=`quota:${this.currentProduction.id}:params`,s=R.getObjectPreference(t)||{},e={countMode:this.countModeOptions[0].value,computeMode:this.computeModeOptions[0].value,taskTypeId:this.productionShotTaskTypes[0].id};this.activeTab=this.$route.query.tab||"tasktypes",this.params={countMode:this.$route.query.countMode||s.countMode||e.countMode,computeMode:this.$route.query.computeMode||s.computeMode||e.computeMode,taskTypeId:this.$route.query.taskTypeId,person:this.$route.query.personId?q.get(this.$route.query.personId):null},!this.params.taskTypeId&&!this.params.person&&(this.params.taskTypeId=s.taskTypeId||e.taskTypeId),this.resetRouteQuery(),this.loadRoute()},computed:{...S(["currentEpisode","currentProduction","isCurrentUserArtist","isPaperProduction","productionShotTaskTypes","user"]),taskTypeList(){return[...this.productionShotTaskTypes]},teamPersons(){return this.isCurrentUserArtist?[q.get(this.user.id)]:ie(this.currentProduction.team.map(t=>q.get(t)))},yearOptions(){const s=c().year();return Q(2018,s).map(e=>({label:e,value:`${e}`})).reverse()},monthOptions(){const t=`${c().year()}`,s=1,e=c().month()+1;let l=Q(s,12);return t===this.yearString&&(l=Q(s,e)),l.map(a=>({label:x(a),value:`${a}`}))}},methods:{...O(["getPersonQuotaShots","loadShots"]),getCurrentPerson(){const t=this.$route.params.person_id;return q?.get(t)??{}},loadRoute(){const{month:t,year:s,week:e,day:l}=this.$route.params,{countMode:a,taskTypeId:o,computeMode:_}=this.$route.query;this.$route.path.indexOf("week")>0&&(this.detailLevel="week"),this.$route.path.indexOf("month")>0&&(this.detailLevel="month"),this.$route.path.indexOf("day")>0&&(this.detailLevel="day"),this.currentPerson=this.getCurrentPerson(),this.detailLevelString=this.detailLevel,a&&(this.countMode=a,this.currentMode=this.countMode),o&&(this.params.taskTypeId=o),this.$route.query.personId&&(this.params.person=q.get(this.$route.query.personId)),_&&(this.params.computeMode=_),t&&(this.currentMonth=Number(t),this.monthString=`${t}`),s&&(this.currentYear=Number(s),this.yearString=`${s}`),e&&(this.currentWeek=Number(e),this.weekString=`${e}`),l&&(this.currentDay=Number(l)),this.$route.path.indexOf("person")>0?(this.isPersonShotsLoading=!0,this.getPersonQuotaShots({personId:this.currentPerson.id,detailLevel:this.detailLevel,taskTypeId:this.params.taskTypeId,year:s,month:t,week:e,day:l,computeMode:this.params.computeMode}).then(f=>{this.isPersonShotsLoading=!1,this.personShots=f,this.showSideInfo()})):this.hideSideInfo()},showSideInfo(){this.showInfo=!0},hideSideInfo(){this.showInfo=!1},episodifyRoute(t){return this.currentEpisode&&V(t,this.currentEpisode.id),t},exportQuotas(){const t=this.$refs["quota-list"].quotaMap,s=["quotas",this.detailLevel,this.currentYear];this.detailLevel==="day"&&s.push(this.currentMonth);const e=oe.slugify(s.join("_")),l=Object.keys(t).map(a=>q.get(a)).sort((a,o)=>a.full_name.localeCompare(o.full_name,void 0,{numeric:!0}));ne.generateQuotas(e,t,l,this.countMode,this.detailLevel,c().year(),c().month()+1,this.currentYear,this.currentMonth,this.currentWeek)},onSearchChange(t){this.searchText=t},setCountModeOptions(){this.isPaperProduction?(this.countModeOptions=[{label:this.$t("quota.drawings"),value:"drawings"},{label:this.$t("quota.count"),value:"count"}],this.countMode="drawings",this.currentMode=this.params.countMode):(this.countModeOptions=[{label:this.$t("quota.frames"),value:"frames"},{label:this.$t("quota.seconds"),value:"seconds"},{label:this.$t("quota.count"),value:"count"}],this.params.countMode="frames",this.currentMode=this.params.countMode)},resetRouteQuery(){const t=this.getQuery(),s=`quota:${this.currentProduction.id}:params`;R.setObjectPreference(s,this.params),this.$router.push({query:t})},getQuery(){const t=this.activeTab==="tasktypes"?this.params.taskTypeId:void 0;let s=null;const e=this.activeTab==="persons"||this.$route.query.tab==="persons";return e&&this.params.person?s=this.params.person.indexOf:e&&(s=this.teamPersons[0]?.id),{countMode:this.params.countMode,computeMode:this.params.computeMode,tab:this.activeTab||"tasktypes",taskTypeId:t,personId:s||void 0}}},watch:{"params.person"(){this.silent||(this.silent=!0,this.resetRouteQuery(),setTimeout(()=>{this.silent=!1},100))},detailLevelString(){if(this.detailLevel!==this.detailLevelString){const t={name:`quota-${this.detailLevelString}`,params:{year:this.currentYear},query:this.getQuery()};this.detailLevelString==="day"&&(t.params.month=this.currentMonth),this.$router.push(this.episodifyRoute(t))}},yearString(){const t=Number(this.yearString),s=c().month()+1;if(this.currentYear!==t){const e={name:`quota-${this.detailLevelString}`,params:{year:t},query:this.getQuery()};this.detailLevelString==="day"&&(e.params.month=`${Math.min(Number(this.monthString),s)}`),this.$router.push(this.episodifyRoute(e))}},monthString(){if(this.currentMonth!==Number(this.monthString)){const t={name:"quota-day",params:{year:this.currentYear,month:this.monthString},query:this.getQuery()};this.$router.push(this.episodifyRoute(t))}},"params.countMode"(){this.resetRouteQuery(),this.currentMode=this.params.countMode},"params.computeMode"(){this.$route.query.computeMode!==this.params.computeMode&&(this.resetRouteQuery(),this.currentPerson=null)},"params.taskTypeId"(){!this.silent&&this.params.taskTypeId&&(this.silent=!0,this.resetRouteQuery(),setTimeout(()=>{this.silent=!1},100))},currentProduction(){this.setCountModeOptions(),this.isLoading=!0,this.loadShots(()=>{this.resetRouteQuery(),this.loadRoute(),this.isLoading=!1})},currentEpisode(){this.isLoading=!0,this.loadShots(()=>{this.resetRouteQuery(),this.loadRoute(),this.isLoading=!1})},$route(){this.activeTab=this.$route.query.tab||"tasktypes",this.resetRouteQuery(),this.loadRoute()}},head(){return{title:`${this.currentProduction.name} | ${this.$t("quota.title")} - Kitsu`}}},je={class:"columns fixed-page"},Fe={class:"column main-column"},Ke={class:"flexrow filters"},ze={key:0,class:"flexrow-item"},Ge={class:"flexrow mb2 mt0"},He={class:"label flexrow-item"},Je={key:0,class:"column side-column"};function Ze(t,s,e,l,a,o){const _=p("route-tabs"),f=p("combobox-task-type"),w=p("people-field"),r=p("combobox"),d=p("info-question-mark"),N=p("button-simple"),Y=p("search-field"),E=p("text-field"),W=p("quota"),A=p("people-quota-info");return n(),i("div",je,[h("div",Fe,[m(_,{"active-tab":a.activeTab,tabs:a.tabs},null,8,["active-tab","tabs"]),h("div",Ke,[a.activeTab==="tasktypes"?(n(),i("div",ze,[m(f,{class:"flexrow-item",label:t.$t("quota.type_label"),"task-type-list":o.taskTypeList,disabled:!a.params.person,modelValue:a.params.taskTypeId,"onUpdate:modelValue":s[0]||(s[0]=y=>a.params.taskTypeId=y)},null,8,["label","task-type-list","disabled","modelValue"])])):g("",!0),a.activeTab==="persons"?(n(),v(w,{key:1,ref:"person-field",class:"person-field flexrow-item",clearable:!1,disabled:t.isCurrentUserArtist,label:t.$t("main.person"),people:o.teamPersons,modelValue:a.params.person,"onUpdate:modelValue":s[1]||(s[1]=y=>a.params.person=y)},null,8,["disabled","label","people","modelValue"])):g("",!0),m(r,{class:"flexrow-item",label:t.$t("quota.detail_label"),options:a.detailLevelOptions,modelValue:a.detailLevelString,"onUpdate:modelValue":s[2]||(s[2]=y=>a.detailLevelString=y)},null,8,["label","options","modelValue"]),a.detailLevelString==="day"?(n(),v(r,{key:2,class:"flexrow-item",label:t.$t("quota.month_label"),options:o.monthOptions,modelValue:a.monthString,"onUpdate:modelValue":s[3]||(s[3]=y=>a.monthString=y)},null,8,["label","options","modelValue"])):g("",!0),m(r,{class:"flexrow-item",label:t.$t("quota.year_label"),options:o.yearOptions,modelValue:a.yearString,"onUpdate:modelValue":s[4]||(s[4]=y=>a.yearString=y)},null,8,["label","options","modelValue"]),m(r,{class:"flexrow-item",label:t.$t("quota.count_label"),options:a.countModeOptions,modelValue:a.params.countMode,"onUpdate:modelValue":s[5]||(s[5]=y=>a.params.countMode=y)},null,8,["label","options","modelValue"]),m(r,{class:"flexrow-item",label:t.$t("quota.compute_mode"),options:a.computeModeOptions,modelValue:a.params.computeMode,"onUpdate:modelValue":s[6]||(s[6]=y=>a.params.computeMode=y)},null,8,["label","options","modelValue"]),m(d,{class:"mt2 flexrow-item",text:t.$t(`quota.explanation_${a.params.computeMode}`)},null,8,["text"]),s[8]||(s[8]=h("div",{class:"filler"},null,-1)),m(N,{class:"flexrow-item",title:t.$t("quota.export_quotas"),icon:"download",onClick:o.exportQuotas},null,8,["title","onClick"])]),h("div",Ge,[a.activeTab==="tasktypes"?(n(),v(Y,{key:0,ref:"search-field",class:"search-field flexrow-item",onChange:o.onSearchChange},null,8,["onChange"])):g("",!0),h("span",He,u(t.$t("quota.highlight_quotas")),1),m(E,{class:"flexrow-item max-quota-input",type:"number",modelValue:a.maxQuota,"onUpdate:modelValue":s[7]||(s[7]=y=>a.maxQuota=y)},null,8,["modelValue"])]),m(W,{ref:"quota-list","task-type-id":a.activeTab==="tasktypes"?a.params.taskTypeId:null,"person-id":a.activeTab==="persons"&&a.params.person?a.params.person.id:null,"detail-level":a.detailLevelString,year:a.currentYear,month:a.currentMonth,"count-mode":a.params.countMode,"compute-mode":a.params.computeMode,"search-text":a.searchText,"max-quota":a.maxQuota},null,8,["task-type-id","person-id","detail-level","year","month","count-mode","compute-mode","search-text","max-quota"])]),a.showInfo&&a.currentPerson?(n(),i("div",Je,[m(A,{person:a.currentPerson,year:a.currentYear,month:a.currentMonth,week:a.currentWeek,day:a.currentDay,"is-loading":a.isPersonShotsLoading,"is-loading-error":!1,shots:a.personShots,"count-mode":a.params.countMode,onClose:o.hideSideInfo},null,8,["person","year","month","week","day","is-loading","shots","count-mode","onClose"])])):g("",!0)])}const tt=L(Xe,[["render",Ze],["__scopeId","data-v-463080fb"]]);export{tt as default};
//# sourceMappingURL=ProductionQuota-CoGubMOq.js.map
