{"version":3,"file":"Settings-tyGa5YMj.js","sources":["../../src/components/pages/Settings.vue"],"sourcesContent":["<template>\n  <div class=\"settings page\">\n    <div class=\"settings-form\">\n      <form class=\"settings-header\" @submit.prevent>\n        <h2>\n          {{ $t('main.studio') }}\n        </h2>\n        <div class=\"field\">\n          <label class=\"label\">\n            {{ $t('settings.logo') }}\n          </label>\n          <div class=\"logo-wrapper\" v-if=\"form.has_avatar\">\n            <img :src=\"organisationLogoPath\" />\n          </div>\n          <p class=\"no-logo\" v-else>\n            <em>{{ $t('settings.no_logo') }}</em>\n          </p>\n          <p>\n            <button\n              type=\"button\"\n              class=\"button set-logo-button\"\n              @click=\"showAvatarModal\"\n            >\n              {{ $t('settings.set_logo') }}\n            </button>\n          </p>\n          <p v-if=\"form.has_avatar\">\n            <button\n              type=\"button\"\n              class=\"button is-link remove-logo-button\"\n              @click=\"removeAvatar\"\n            >\n              {{ $t('settings.remove_logo') }}\n            </button>\n          </p>\n        </div>\n      </form>\n      <form ref=\"form\" @submit.prevent=\"saveSettings\">\n        <h2>\n          {{ $t('settings.title') }}\n        </h2>\n        <text-field\n          class=\"mt2\"\n          :label=\"$t('settings.fields.name')\"\n          :required=\"true\"\n          v-model.trim=\"form.name\"\n        />\n        <text-field\n          :label=\"$t('settings.fields.hours_by_day')\"\n          :min=\"1\"\n          :max=\"24\"\n          :required=\"true\"\n          type=\"number\"\n          v-model=\"form.hours_by_day\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.use_original_name')\"\n          v-model=\"form.use_original_file_name\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.show_hd_default')\"\n          v-model=\"form.hd_by_default\"\n        />\n        <combobox-boolean\n          :label=\"$t('settings.fields.timesheets_locked')\"\n          v-model=\"form.timesheets_locked\"\n        />\n        <h2>\n          {{ $t('settings.integrations') }}\n        </h2>\n        <text-field\n          :label=\"$t('settings.fields.slack_token')\"\n          v-model.trim=\"form.chat_token_slack\"\n        />\n        <text-field\n          :label=\"$t('settings.fields.discord_token')\"\n          v-model.trim=\"form.chat_token_discord\"\n        />\n        <div class=\"mattermost_integrations\">\n          <text-field\n            :label=\"$t('settings.fields.mattermost_webhook')\"\n            v-model.trim=\"form.chat_webhook_mattermost\"\n          />\n          <div\n            class=\"error has-text-centered\"\n            v-if=\"this.errors.webhook_error === true\"\n          >\n            <em>{{ $t('settings.webhook_error') }}</em>\n          </div>\n        </div>\n        <button\n          class=\"button save-button is-medium\"\n          :class=\"{\n            'is-loading': loading.save\n          }\"\n          :disabled=\"loading.save || !this.$refs.form?.checkValidity()\"\n        >\n          {{ $t('settings.save.button') }}\n        </button>\n        <p class=\"error has-text-centered mt2\" v-if=\"errors.save\">\n          <em>{{ $t('settings.save.error') }}</em>\n        </p>\n      </form>\n    </div>\n\n    <change-avatar-modal\n      :active=\"modals.avatar\"\n      :is-loading=\"loading.saveAvatar\"\n      :is-error=\"errors.saveAvatar\"\n      :title=\"$t('settings.change_logo')\"\n      @confirm=\"uploadAvatarFile\"\n      @cancel=\"hideAvatarModal\"\n    />\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapActions } from 'vuex'\n\nimport ChangeAvatarModal from '@/components/modals/ChangeAvatarModal'\nimport ComboboxBoolean from '@/components/widgets/ComboboxBoolean'\nimport TextField from '@/components/widgets/TextField'\n\nexport default {\n  name: 'settings',\n\n  components: {\n    ChangeAvatarModal,\n    ComboboxBoolean,\n    TextField\n  },\n\n  data() {\n    return {\n      organisationLogoPath: '',\n      form: {\n        chat_token_discord: '',\n        chat_token_slack: '',\n        chat_webhook_mattermost: '',\n        has_avatar: false,\n        hd_by_default: 'false',\n        hours_by_day: 0,\n        name: '',\n        timesheets_locked: 'false',\n        use_original_file_name: 'false'\n      },\n      errors: {\n        save: false,\n        saveAvatar: false,\n        webhook_error: false\n      },\n      loading: {\n        save: false,\n        saveAvatar: false\n      },\n      modals: {\n        avatar: false\n      }\n    }\n  },\n\n  mounted() {\n    this.organisationLogoPath = `/api/pictures/thumbnails/organisations/${this.organisation.id}.png`\n  },\n\n  computed: {\n    ...mapGetters(['organisation'])\n  },\n\n  methods: {\n    ...mapActions([\n      'changeAvatar',\n      'deleteOrganisationLogo',\n      'saveOrganisation',\n      'uploadOrganisationLogo'\n    ]),\n\n    checkWebhook() {\n      if (\n        !this.form.chat_webhook_mattermost ||\n        this.form.chat_webhook_mattermost.match('/hooks/[a-zA-Z0-9]+$')\n      ) {\n        this.errors.webhook_error = false\n        return true\n      } else {\n        this.errors.webhook_error = true\n        return false\n      }\n    },\n\n    hideAvatarModal() {\n      this.modals.avatar = false\n    },\n\n    showAvatarModal() {\n      this.modals.avatar = true\n    },\n\n    saveSettings() {\n      if (this.checkWebhook()) {\n        this.loading.save = true\n        this.errors.save = false\n        this.saveOrganisation(this.form)\n          .catch(err => {\n            console.error(err)\n            this.errors.save = true\n          })\n          .finally(() => {\n            this.loading.save = false\n          })\n      }\n    },\n\n    uploadAvatarFile(formData) {\n      this.loading.saveAvatar = true\n      this.errors.saveAvatar = false\n      this.uploadOrganisationLogo(formData)\n        .then(() => {\n          setTimeout(() => {\n            this.modals.avatar = false\n            const timestamp = Date.now()\n            this.organisationLogoPath = `/api/pictures/thumbnails/organisations/${this.organisation.id}.png?t=${timestamp}`\n          }, 500)\n        })\n        .catch(err => {\n          console.error(err)\n          this.errors.saveAvatar = true\n        })\n        .finally(() => {\n          this.loading.saveAvatar = false\n        })\n    },\n\n    removeAvatar() {\n      this.loading.save = true\n      this.errors.save = false\n      this.deleteOrganisationLogo()\n        .catch(err => {\n          console.error(err)\n          this.errors.save = true\n        })\n        .finally(() => {\n          this.loading.save = false\n        })\n    }\n  },\n\n  watch: {\n    organisation: {\n      immediate: true,\n      handler() {\n        this.form = {\n          chat_token_discord: this.organisation.chat_token_discord,\n          chat_token_slack: this.organisation.chat_token_slack,\n          chat_webhook_mattermost: this.organisation.chat_webhook_mattermost,\n          has_avatar: this.organisation.has_avatar,\n          hd_by_default: this.organisation.hd_by_default ? 'true' : 'false',\n          hours_by_day: this.organisation.hours_by_day,\n          name: this.organisation.name,\n          timesheets_locked: this.organisation.timesheets_locked\n            ? 'true'\n            : 'false',\n          use_original_file_name: this.organisation.use_original_file_name\n            ? 'true'\n            : 'false'\n        }\n      }\n    }\n  },\n\n  metaInfo() {\n    return {\n      title: `${this.$t('settings.title')} - Kitsu`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .settings {\n    background: $dark-grey-2;\n    color: $white-grey;\n  }\n\n  .settings-form {\n    background: $dark-grey-lighter;\n    color: $white-grey;\n  }\n\n  .set-logo-button {\n    background-color: $grey;\n    color: $dark-grey;\n  }\n}\n\n.mattermost_integrations {\n  margin-bottom: 4em;\n  .field {\n    margin-bottom: 0em;\n  }\n}\n\n.settings {\n  background: $white-grey;\n  height: 100%;\n}\n\n.settings-form {\n  background: white;\n  max-width: 500px;\n  margin: auto;\n  margin-top: 2em;\n  margin-bottom: 2em;\n  padding: 2em;\n  box-shadow: rgba(0, 0, 0, 0.15) 0px 1px 4px 2px;\n  border-radius: 1em;\n}\n\ninput,\nselect,\nspan.select {\n  width: 100%;\n}\n\nh2:first-child {\n  margin-top: 0em;\n}\n\n.save-button {\n  background: $green;\n  border-radius: 10px;\n  border-color: $green;\n  color: white;\n  width: 100%;\n}\n\n.save-button:hover {\n  background: $light-green;\n  border-color: $light-green;\n}\n\n.logo-wrapper {\n  padding: 0;\n\n  img {\n    width: 100px;\n  }\n}\n\n.no-logo {\n  margin-bottom: 1em;\n}\n\n.remove-logo-button {\n  margin-top: 0.5rem;\n  font-size: 0.7em;\n}\n</style>\n"],"names":["_sfc_main","ChangeAvatarModal","ComboboxBoolean","TextField","mapGetters","mapActions","err","formData","timestamp"],"mappings":"wHA2HA,MAAAA,EAAA,CACA,KAAA,WAEA,WAAA,CACA,kBAAAC,EACA,gBAAAC,EACA,UAAAC,CACA,EAEA,MAAA,CACA,MAAA,CACA,qBAAA,GACA,KAAA,CACA,mBAAA,GACA,iBAAA,GACA,wBAAA,GACA,WAAA,GACA,cAAA,QACA,aAAA,EACA,KAAA,GACA,kBAAA,QACA,uBAAA,OACA,EACA,OAAA,CACA,KAAA,GACA,WAAA,GACA,cAAA,EACA,EACA,QAAA,CACA,KAAA,GACA,WAAA,EACA,EACA,OAAA,CACA,OAAA,EACA,CACA,CACA,EAEA,SAAA,CACA,KAAA,qBAAA,0CAAA,KAAA,aAAA,EAAA,MACA,EAEA,SAAA,CACA,GAAAC,EAAA,CAAA,cAAA,CAAA,CACA,EAEA,QAAA,CACA,GAAAC,EAAA,CACA,eACA,yBACA,mBACA,wBACA,CAAA,EAEA,cAAA,CACA,MACA,CAAA,KAAA,KAAA,yBACA,KAAA,KAAA,wBAAA,MAAA,sBAAA,GAEA,KAAA,OAAA,cAAA,GACA,KAEA,KAAA,OAAA,cAAA,GACA,GAEA,EAEA,iBAAA,CACA,KAAA,OAAA,OAAA,EACA,EAEA,iBAAA,CACA,KAAA,OAAA,OAAA,EACA,EAEA,cAAA,CACA,KAAA,iBACA,KAAA,QAAA,KAAA,GACA,KAAA,OAAA,KAAA,GACA,KAAA,iBAAA,KAAA,IAAA,EACA,MAAAC,GAAA,CACA,QAAA,MAAAA,CAAA,EACA,KAAA,OAAA,KAAA,EACA,CAAA,EACA,QAAA,IAAA,CACA,KAAA,QAAA,KAAA,EACA,CAAA,EAEA,EAEA,iBAAAC,EAAA,CACA,KAAA,QAAA,WAAA,GACA,KAAA,OAAA,WAAA,GACA,KAAA,uBAAAA,CAAA,EACA,KAAA,IAAA,CACA,WAAA,IAAA,CACA,KAAA,OAAA,OAAA,GACA,MAAAC,EAAA,KAAA,IAAA,EACA,KAAA,qBAAA,0CAAA,KAAA,aAAA,EAAA,UAAAA,CAAA,EACA,EAAA,GAAA,CACA,CAAA,EACA,MAAAF,GAAA,CACA,QAAA,MAAAA,CAAA,EACA,KAAA,OAAA,WAAA,EACA,CAAA,EACA,QAAA,IAAA,CACA,KAAA,QAAA,WAAA,EACA,CAAA,CACA,EAEA,cAAA,CACA,KAAA,QAAA,KAAA,GACA,KAAA,OAAA,KAAA,GACA,KAAA,uBAAA,EACA,MAAAA,GAAA,CACA,QAAA,MAAAA,CAAA,EACA,KAAA,OAAA,KAAA,EACA,CAAA,EACA,QAAA,IAAA,CACA,KAAA,QAAA,KAAA,EACA,CAAA,CACA,CACA,EAEA,MAAA,CACA,aAAA,CACA,UAAA,GACA,SAAA,CACA,KAAA,KAAA,CACA,mBAAA,KAAA,aAAA,mBACA,iBAAA,KAAA,aAAA,iBACA,wBAAA,KAAA,aAAA,wBACA,WAAA,KAAA,aAAA,WACA,cAAA,KAAA,aAAA,cAAA,OAAA,QACA,aAAA,KAAA,aAAA,aACA,KAAA,KAAA,aAAA,KACA,kBAAA,KAAA,aAAA,kBACA,OACA,QACA,uBAAA,KAAA,aAAA,uBACA,OACA,OACA,CACA,CACA,CACA,EAEA,UAAA,CACA,MAAA,CACA,MAAA,GAAA,KAAA,GAAA,gBAAA,CAAA,UACA,CACA,CACA"}