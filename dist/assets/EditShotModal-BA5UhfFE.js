import{_ as y,M as F,a as g,b as v,r as m,q as I,o as l,c as d,d as f,t as u,I as h,f as r,k as q,O as c,g as p,h as E,F as x,e as O,n as M}from"./index-Dw-uod2x.js";import{f as S}from"./format-fMWuo47O.js";import{C as U}from"./Combobox-Z_ENhFXj.js";import{M as P}from"./BuildFilterModal-AsQyG_6U.js";import{M as B}from"./ModalFooter-Dmgqo0ae.js";import{T as w}from"./TextField-EpYNDuEI.js";import{T as z}from"./TextareaField-Cu9GLtzh.js";const D={name:"edit-shot-modal",mixins:[S,F],components:{Combobox:U,MetadataField:P,ModalFooter:B,TextField:w,TextareaField:z},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},shotToEdit:{type:Object,default:()=>{}}},emits:["cancel","confirm","confirm-and-stay"],data(){return{form:{data:{}},shotSuccessText:""}},mounted(){this.resetForm()},computed:{...v(["currentProduction","isPaperProduction","openProductions","sequenceOptions","sequences","shotCreated","shotMetadataDescriptors"]),frameIn(){return this.shotToEdit.data?this.shotToEdit.data.frame_in:""},frameOut(){return this.shotToEdit.data?this.shotToEdit.data.frame_out:""},fps(){return this.shotToEdit.data?this.shotToEdit.data.fps:""},resolution(){return this.shotToEdit.data?this.shotToEdit.data.resolution:""},maxRetakes(){return parseInt(this.shotToEdit.data?.max_retakes)||""}},methods:{...g(["loadSequences"]),runConfirmation(){this.isEditing()?this.confirmClicked():this.confirmAndStayClicked()},confirmAndStayClicked(){this.$emit("confirm-and-stay",this.form)},confirmClicked(){this.$emit("confirm",this.form)},isEditing(){return this.shotToEdit&&this.shotToEdit.id},resetForm(){this.shotSuccessText="",this.isEditing()?this.form={sequence_id:this.shotToEdit.sequence_id,project_id:this.shotToEdit.project_id,name:this.shotToEdit.name,description:this.shotToEdit.description,nb_frames:this.shotToEdit.nb_frames,frameIn:this.frameIn,frameOut:this.frameOut,fps:this.fps,max_retakes:this.maxRetakes,resolution:this.resolution,data:{...this.shotToEdit.data}}:(this.openProductions.length>0&&(this.form.project_id=this.currentProduction?this.currentProduction.id:""),this.sequences.length>0&&(this.form.sequence_id=this.sequences[0].id),this.form.name="",this.form.description="",this.form.nb_frames=0,this.form.data={})}},watch:{active(){this.shotSuccessText="",this.resetForm(),this.sequences.length===0&&this.loadSequences(),this.active&&setTimeout(()=>{this.$refs.nameField.focus()},100)},"form.frameIn"(){const t=this.sanitizeInteger(this.form.frameIn),e=this.sanitizeInteger(this.form.frameOut);t&&e&&e>t&&(this.form.nb_frames=e-t+1)},"form.frameOut"(){const t=this.sanitizeInteger(this.form.frameIn),e=this.sanitizeInteger(this.form.frameOut);t&&e&&e>t&&(this.form.nb_frames=e-t+1)},shotToEdit(){this.resetForm()},shotCreated(){this.isEditing()?this.shotSuccessText=this.$t("shots.edit_success",{name:this.shotCreated}):this.shotSuccessText=this.$t("shots.new_success",{name:this.shotCreated})}}},j={class:"modal-content"},L={class:"box"},A={key:0,class:"title"},K={key:1,class:"title"};function N(t,e,n,R,s,i){const b=m("combobox"),a=m("text-field"),T=m("textarea-field"),V=m("metadata-field"),C=m("modal-footer"),_=I("focus");return l(),d("div",{class:M({modal:!0,"is-active":n.active})},[f("div",{class:"modal-background",onClick:e[0]||(e[0]=o=>t.$emit("cancel"))}),f("div",j,[f("div",L,[n.shotToEdit&&n.shotToEdit.id?(l(),d("h1",A,u(t.$t("shots.edit_title"))+" "+u(n.shotToEdit.name),1)):(l(),d("h1",K,u(t.$t("shots.new_shot")),1)),f("form",{onSubmit:e[10]||(e[10]=h(()=>{},["prevent"]))},[r(b,{label:t.$t("shots.fields.sequence"),options:t.sequenceOptions,modelValue:s.form.sequence_id,"onUpdate:modelValue":e[1]||(e[1]=o=>s.form.sequence_id=o)},null,8,["label","options","modelValue"]),q(r(a,{ref:"nameField",label:t.$t("shots.fields.name"),modelValue:s.form.name,"onUpdate:modelValue":e[2]||(e[2]=o=>s.form.name=o),modelModifiers:{trim:!0},onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),[[_]]),r(T,{ref:"descriptionField",label:t.$t("shots.fields.description"),modelValue:s.form.description,"onUpdate:modelValue":e[3]||(e[3]=o=>s.form.description=o),onKeyup:[c(h(i.runConfirmation,["ctrl"]),["enter"]),c(h(i.runConfirmation,["meta"]),["enter"])]},null,8,["label","modelValue","onKeyup"]),t.isPaperProduction?E("",!0):(l(),p(a,{key:0,ref:"nbFramesField",label:t.$t("shots.fields.nb_frames"),type:"number",modelValue:s.form.nb_frames,"onUpdate:modelValue":e[4]||(e[4]=o=>s.form.nb_frames=o),onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"])),r(a,{ref:"frameInField",label:t.$t("shots.fields.frame_in"),modelValue:s.form.frameIn,"onUpdate:modelValue":e[5]||(e[5]=o=>s.form.frameIn=o),type:"number"},null,8,["label","modelValue"]),r(a,{ref:"frameOutField",label:t.$t("shots.fields.frame_out"),modelValue:s.form.frameOut,"onUpdate:modelValue":e[6]||(e[6]=o=>s.form.frameOut=o),type:"number",onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),r(a,{ref:"fpsField",label:t.$t("shots.fields.fps"),type:"number",max:1e3,step:.001,modelValue:s.form.fps,"onUpdate:modelValue":e[7]||(e[7]=o=>s.form.fps=o),onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),r(a,{ref:"resolutionField",label:t.$t("shots.fields.resolution"),modelValue:s.form.resolution,"onUpdate:modelValue":e[8]||(e[8]=o=>s.form.resolution=o),onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),r(a,{ref:"maxRetakesField",type:"number",label:t.$t("shots.fields.max_retakes"),modelValue:s.form.max_retakes,"onUpdate:modelValue":e[9]||(e[9]=o=>s.form.max_retakes=o),onEnter:i.runConfirmation},null,8,["label","modelValue","onEnter"]),n.shotToEdit?(l(!0),d(x,{key:1},O(t.shotMetadataDescriptors,o=>(l(),p(V,{key:o.id,descriptor:o,entity:n.shotToEdit,onEnter:i.runConfirmation,modelValue:s.form.data[o.field_name],"onUpdate:modelValue":k=>s.form.data[o.field_name]=k},null,8,["descriptor","entity","onEnter","modelValue","onUpdate:modelValue"]))),128)):E("",!0)],32),r(C,{"error-text":t.$t("shots.edit_fail"),"is-loading":n.isLoading,"is-error":n.isError,onConfirm:i.confirmClicked,onCancel:e[11]||(e[11]=o=>t.$emit("cancel"))},null,8,["error-text","is-loading","is-error","onConfirm"])])])],2)}const Z=y(D,[["render",N],["__scopeId","data-v-8228fb1c"]]);export{Z as E};
//# sourceMappingURL=EditShotModal-BA5UhfFE.js.map
