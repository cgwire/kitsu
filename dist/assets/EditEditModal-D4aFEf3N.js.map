{"version":3,"file":"EditEditModal-D4aFEf3N.js","sources":["../../src/components/modals/EditEditModal.vue"],"sourcesContent":["<template>\n  <div\n    :class=\"{\n      modal: true,\n      'is-active': active\n    }\"\n  >\n    <div class=\"modal-background\" @click=\"$emit('cancel')\"></div>\n\n    <div class=\"modal-content\">\n      <div class=\"box\">\n        <h1 class=\"title\" v-if=\"editToEdit && editToEdit.id\">\n          {{ $t('edits.edit_title') }} {{ editToEdit.name }}\n        </h1>\n        <h1 class=\"title\" v-else>\n          {{ $t('edits.new_edit') }}\n        </h1>\n\n        <form @submit.prevent>\n          <combobox\n            :label=\"$t('edits.fields.episode')\"\n            :options=\"episodeOptions\"\n            v-model=\"form.parent_id\"\n            v-if=\"isTVShow\"\n          />\n          <text-field\n            ref=\"nameField\"\n            :label=\"$t('edits.fields.name')\"\n            v-model.trim=\"form.name\"\n            @enter=\"runConfirmation\"\n            v-focus\n          />\n          <text-field\n            ref=\"resolutionField\"\n            :label=\"$t('shots.fields.resolution')\"\n            @enter=\"runConfirmation\"\n            v-model=\"form.data.resolution\"\n          />\n          <textarea-field\n            ref=\"descriptionField\"\n            :label=\"$t('edits.fields.description')\"\n            v-model=\"form.description\"\n            @keyup.ctrl.enter=\"runConfirmation\"\n            @keyup.meta.enter=\"runConfirmation\"\n          />\n          <template v-if=\"editToEdit\">\n            <metadata-field\n              :key=\"descriptor.id\"\n              :descriptor=\"descriptor\"\n              :entity=\"editToEdit\"\n              @enter=\"runConfirmation\"\n              v-model=\"form.data[descriptor.field_name]\"\n              v-for=\"descriptor in editMetadataDescriptors\"\n            />\n          </template>\n        </form>\n\n        <modal-footer\n          :error-text=\"$t('edits.edit_error')\"\n          :is-loading=\"isLoading\"\n          :is-error=\"isError\"\n          @confirm=\"confirmClicked\"\n          @cancel=\"$emit('cancel')\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\n\nimport { modalMixin } from '@/components/modals/base_modal'\n\nimport Combobox from '@/components/widgets/Combobox.vue'\nimport MetadataField from '@/components/widgets/MetadataField.vue'\nimport ModalFooter from '@/components/modals/ModalFooter.vue'\nimport TextField from '@/components/widgets/TextField.vue'\nimport TextareaField from '@/components/widgets/TextareaField.vue'\n\nexport default {\n  name: 'edit-edit-modal',\n\n  mixins: [modalMixin],\n\n  components: {\n    Combobox,\n    MetadataField,\n    ModalFooter,\n    TextField,\n    TextareaField\n  },\n\n  props: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    isError: {\n      type: Boolean,\n      default: false\n    },\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    editToEdit: {\n      type: Object,\n      default: () => {}\n    }\n  },\n\n  emits: ['cancel', 'confirm', 'confirm-and-stay'],\n\n  data() {\n    return {\n      form: {\n        name: '',\n        description: '',\n        parent_id: null,\n        data: {\n          resolution: ''\n        }\n      },\n      editSuccessText: ''\n    }\n  },\n\n  computed: {\n    ...mapGetters([\n      'currentProduction',\n      'currentEpisode',\n      'editCreated',\n      'editMetadataDescriptors',\n      'episodes',\n      'isTVShow',\n      'openProductions'\n    ]),\n\n    episodeOptions() {\n      const options = this.episodes.map(episode => {\n        return {\n          label: episode.name,\n          value: episode.id\n        }\n      })\n      // It might be usefull to allow Edits not linked to any episodes.\n      return [{ label: '-', value: null }].concat(options)\n    }\n  },\n\n  methods: {\n    runConfirmation() {\n      if (this.isEditing()) {\n        this.confirmClicked()\n      } else {\n        this.confirmAndStayClicked()\n      }\n    },\n\n    confirmAndStayClicked() {\n      this.$emit('confirm-and-stay', this.form)\n    },\n\n    confirmClicked() {\n      this.$emit('confirm', this.form)\n    },\n\n    isEditing() {\n      return this.editToEdit && this.editToEdit.id\n    },\n\n    resetForm() {\n      this.editSuccessText = ''\n      if (!this.isEditing()) {\n        if (this.openProductions.length > 0) {\n          this.form.project_id = this.currentProduction\n            ? this.currentProduction.id\n            : ''\n        }\n        this.form.name = ''\n        this.form.description = ''\n        this.form.parent_id = this.currentEpisode\n          ? this.currentEpisode.id\n          : null\n        this.form.data = {\n          resolution: ''\n        }\n      } else {\n        this.form = {\n          project_id: this.editToEdit.project_id,\n          name: this.editToEdit.name,\n          description: this.editToEdit.description,\n          parent_id: this.editToEdit.parent_id,\n          data:\n            {\n              ...this.editToEdit.data,\n              resolution: this.editToEdit.data.resolution || ''\n            } || {}\n        }\n      }\n    }\n  },\n\n  mounted() {\n    this.resetForm()\n  },\n\n  watch: {\n    active() {\n      this.editSuccessText = ''\n      this.resetForm()\n      if (this.active) {\n        setTimeout(() => {\n          this.$refs.nameField.focus()\n        }, 100)\n      }\n    },\n\n    editToEdit() {\n      this.resetForm()\n    },\n\n    editCreated() {\n      if (this.isEditing()) {\n        this.editSuccessText = this.$t('edits.edit_success', {\n          name: this.editCreated\n        })\n      } else {\n        this.editSuccessText = this.$t('edits.new_success', {\n          name: this.editCreated\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.modal-content .box p.text {\n  margin-bottom: 1em;\n}\n.is-danger {\n  color: #ff3860;\n  font-style: italic;\n}\n.title {\n  border-bottom: 2px solid #ddd;\n  padding-bottom: 0.5em;\n  margin-bottom: 1.2em;\n}\n.info-message {\n  margin-top: 1em;\n}\n\n.modal-content {\n  max-height: 80%;\n}\n</style>\n"],"names":["_sfc_main","modalMixin","Combobox","MetadataField","ModalFooter","TextField","TextareaField","mapGetters","options","episode","_hoisted_1","_hoisted_2","_createElementBlock","_normalizeClass","$props","_createElementVNode","_ctx","_hoisted_3","_toDisplayString","_hoisted_4","_cache","_withModifiers","_createBlock","_component_combobox","$options","$data","$event","_createCommentVNode","_createVNode","_component_text_field","_component_textarea_field","_withKeys","_openBlock","_Fragment","_renderList","descriptor","_component_metadata_field","_component_modal_footer"],"mappings":"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"}