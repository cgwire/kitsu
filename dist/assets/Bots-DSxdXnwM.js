import{_ as T,M as D,r as l,o as r,c as h,d as i,t as m,I as A,f as d,H as C,F as V,g as c,w as S,h as u,T as L,n as F,B as U,a as R,b as M}from"./index-DF-DoQlt.js";import{s as N}from"./search-CWIHq9c3.js";import{C as B}from"./ComboboxDepartment-Cjj8YvK6.js";import{C as q}from"./ComboboxStyled-BlKJF8gk.js";import{P as I,E as G,a as O}from"./PeopleList-HMgdSFgD.js";import{H}from"./HardDeleteModal-BLE4oONO.js";import{t as z}from"./time-BX5EcDEd.js";import{D as j}from"./DateField-BBlawoBq.js";import{T as K}from"./TextField-BKWlN2Ov.js";import{E as Q}from"./eye-off-Wrx1vo-w.js";import{E as J}from"./eye-CYjxZyJy.js";import{T as W}from"./triangle-alert-CW28Rlrw.js";import{P as X}from"./PageTitle-CtScP8aV.js";import{R as Y}from"./RouteTabs-9ZMuefrE.js";import{S as Z}from"./SearchField-BdP8lRoc.js";import"./DepartmentName-DCchDYyW.js";import"./Combobox-A6pnhVs3.js";import"./ComboboxStudio-D3qg68ZP.js";import"./grablist-Da7oVI-6.js";import"./dom-tO7tlkHV.js";import"./DepartmentNamesCell-8LpSNQmh.js";import"./copy-DgQ7ppWI.js";import"./shield-check-Buo9knPZ.js";import"./RowActionsCell-DR7b8Q1u.js";import"./trash-DWKk5Pv9.js";import"./refresh-cw-CYYYI9XK.js";import"./TableInfo-D6xnVb4C.js";const $={name:"new-token-modal",mixins:[D,z],components:{AlertTriangleIcon:W,DateField:j,EyeIcon:J,EyeOffIcon:Q,TextField:K},props:{active:{type:Boolean,default:!1},person:{type:Object,default:()=>{}}},emits:["cancel","close","generate-token"],data(){return{form:{expiration_date:null},message:null,visible:!1}},computed:{isValidExpirationDate(){return!this.form.expiration_date||new Date(this.form.expiration_date)>new Date}},methods:{generateToken(){this.$emit("generate-token",{id:this.person.id,expiration_date:this.form.expiration_date})},async copyClicked(){this.message=null,await navigator.clipboard.writeText(this.person.access_token),this.message=this.$t("bots.token_copied"),setTimeout(()=>{this.message=null},5e3)},resetForm(){this.form={expiration_date:this.person.expiration_date},this.message=null,this.visible=!1}},watch:{active(){this.active&&this.resetForm()}}},ee={class:"modal-content"},te={class:"box"},oe={class:"title"},se={class:"mb2 warning-text"},ie={class:"flexrow right"},le=["disabled"],re={class:"mb2 warning-text"},ae={class:"token"},ne={class:"flexrow right"},de={key:0,class:"success has-text-right mr05"},me=["disabled"];function ce(e,t,a,b,o,s){const f=l("alert-triangle-icon"),v=l("date-field"),g=l("text-field"),k=l("eye-off-icon"),_=l("eye-icon");return r(),h("div",{class:F(["modal",{"is-active":a.active}])},[t[8]||(t[8]=i("div",{class:"modal-background"},null,-1)),i("div",ee,[i("div",te,[i("h1",oe,m(e.$t("bots.new_token_title",{name:a.person.full_name})),1),a.person.access_token?(r(),h(V,{key:1},[i("p",re,[d(f,{class:"icon mr05 warning"}),C(" "+m(e.$t("bots.copy_token_warning")),1)]),i("div",ae,[d(g,{ref:"token",disabled:!o.visible,"input-class":" token-input",readonly:!0,type:o.visible?"text":"password","model-value":a.person.access_token},null,8,["disabled","type","model-value"]),o.visible?(r(),c(k,{key:0,class:"icon",onClick:t[4]||(t[4]=n=>o.visible=!1)})):(r(),c(_,{key:1,class:"icon",onClick:t[5]||(t[5]=n=>o.visible=!0)}))]),i("div",ne,[d(L,{name:"fade"},{default:S(()=>[o.message?(r(),h("p",de,m(o.message),1)):u("",!0)]),_:1}),i("button",{class:"button flexrow-item is-primary",onClick:t[6]||(t[6]=(...n)=>s.copyClicked&&s.copyClicked(...n)),disabled:!a.person.access_token},m(e.$t("main.copy")),9,me),i("button",{class:"button flexrow-item is-link",onClick:t[7]||(t[7]=n=>e.$emit("close"))},m(e.$t("main.close")),1)])],64)):(r(),h("form",{key:0,class:"form",onSubmit:t[3]||(t[3]=A(()=>{},["prevent"]))},[i("p",se,[d(f,{class:"icon mr05 warning"}),C(" "+m(e.$t("bots.new_token_warning")),1)]),d(v,{invalid:!s.isValidExpirationDate,label:e.$t("bots.fields.expiration_date"),"min-date":e.today,modelValue:o.form.expiration_date,"onUpdate:modelValue":t[0]||(t[0]=n=>o.form.expiration_date=n)},null,8,["invalid","label","min-date","modelValue"]),i("div",ie,[i("button",{class:"button flexrow-item is-primary",disabled:!s.isValidExpirationDate,onClick:t[1]||(t[1]=(...n)=>s.generateToken&&s.generateToken(...n))},m(e.$t("bots.generate")),9,le),i("button",{class:"button flexrow-item is-link",onClick:t[2]||(t[2]=n=>e.$emit("cancel"))},m(e.$t("main.cancel")),1)])],32))])])],2)}const pe=T($,[["render",ce],["__scopeId","data-v-3bc778f6"]]),ue={name:"bots",mixins:[N],components:{ButtonSimple:U,ComboboxDepartment:B,ComboboxStyled:q,EditAvatarModal:O,EditPersonModal:G,HardDeleteModal:H,NewTokenModal:pe,PageTitle:X,PeopleList:I,RouteTabs:Y,SearchField:Z},data(){return{activeTab:"active",role:"all",roleOptions:[{label:"all",value:"all"},{label:"admin",value:"admin"},{label:"client",value:"client"},{label:"manager",value:"manager"},{label:"supervisor",value:"supervisor"},{label:"user",value:"user"},{label:"vendor",value:"vendor"}],errors:{avatar:!1,del:!1,edit:!1,userLimit:!1},loading:{del:!1,deletingAvatar:!1,edit:!1,updatingAvatar:!1},modals:{avatar:!1,del:!1,edit:!1,newToken:!1},personToDelete:{},personToEdit:{role:"user"},selectedDepartment:"",tabs:[{name:"active",label:this.$t("main.active")},{name:"unactive",label:this.$t("people.unactive")}]}},async mounted(){this.activeTab=this.$route.query.tab||"active",this.role=this.$route.query.role||"all",this.selectedDepartment=this.$route.query.department||"",this.setSearchFromUrl(),await this.loadPeople(),this.onSearchChange()},watch:{"modals.edit"(){this.modals.edit&&(this.errors.edit=!1,this.errors.userLimit=!1,this.loading.edit=!1)},selectedDepartment(){this.updateRoute()},role(){this.updateRoute()},"$route.query.tab"(){this.activeTab=this.$route.query.tab||"active"}},computed:{...M(["displayedPeople","isCurrentUserAdmin","isPeopleLoading","isPeopleLoadingError"]),currentPeople(){let e=this.displayedPeople.filter(t=>t.is_bot);return this.role!=="all"&&(e=e.filter(t=>t.role===this.role)),this.selectedDepartment&&(e=e.filter(t=>t.departments.includes(this.selectedDepartment))),e},deleteText(){const e=this.personToDelete?.full_name;return e?this.$t("people.delete_text",{personName:e}):""},searchField(){return this.$refs["search-field"]},activePeople(){return this.currentPeople.filter(e=>e.active)},unactivePeople(){return this.currentPeople.filter(e=>!e.active)}},methods:{...R(["clearPersonAvatar","deletePeople","editPerson","generateToken","loadPeople","newPerson","setPeopleSearch","uploadPersonAvatar"]),async deleteAvatar(){this.loading.deletingAvatar=!0;try{await this.clearPersonAvatar(this.personToEdit),this.modals.avatar=!1,this.onSearchChange()}catch{this.errors.avatar=!0}this.loading.deletingAvatar=!1},async updateAvatar(e){this.loading.updatingAvatar=!0;try{await this.uploadPersonAvatar({person:this.personToEdit,formData:e}),this.modals.avatar=!1,this.onSearchChange()}catch{this.errors.avatar=!0}this.loading.updatingAvatar=!1},confirmGenerateToken(e){this.generateToken(e).then(t=>{this.updatePersonToEdit(t)}).catch(console.error)},confirmEditPeople(e){let t="editPerson";this.personToEdit.id===void 0?t="newPerson":e.id=this.personToEdit.id,this.loading.edit=!0,this.errors.edit=!1,this.errors.userLimit=!1,this[t](e).then(a=>{this.loading.edit=!1,this.modals.edit=!1,a.access_token?.length&&(this.updatePersonToEdit(a),this.modals.newToken=!0),this.onSearchChange()}).catch(a=>{console.error(a),a.body?.message?.includes("limit")??!1?this.errors.userLimit=!0:this.errors.edit=!0,this.loading.edit=!1})},confirmDeletePeople(){this.loading.del=!0,this.errors.del=!1,this.deletePeople(this.personToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1,this.onSearchChange()}).catch(e=>{console.error(e),this.loading.del=!1,this.errors.del=!0})},onSearchChange(){if(this.searchField){const e=this.searchField.getValue();e?.length!==1&&this.setPeopleSearch(e),this.setSearchInUrl()}this.tabs[0].label=`${this.$t("main.active")} (${this.activePeople.length})`,this.tabs[1].label=`${this.$t("people.unactive")} (${this.unactivePeople.length})`},onAvatarClicked(e){this.updatePersonToEdit(e),this.errors.avatar=!1,this.modals.avatar=!0},onDeleteClicked(e){this.personToDelete=e,this.modals.del=!0},onEditClicked(e){this.updatePersonToEdit(e),this.modals.edit=!0},onRefreshClicked(e){this.updatePersonToEdit(e),this.modals.newToken=!0},onNewClicked(){this.updatePersonToEdit({role:"user"}),this.modals.edit=!0},updatePersonToEdit(e){this.personToEdit={...e,expiration_date:e.expiration_date?new Date(e.expiration_date):null}},updateRoute(){const e=this.searchField.getValue(),t=this.selectedDepartment,a=this.role;this.$router.push({query:{search:e,department:t,role:a}})}},head(){return{title:`${this.$t("bots.title")} - Kitsu`}}},he={class:"bots page fixed-page"},fe={class:"flexrow page-header"},ve={class:"flexrow search-options"},be={key:1,class:"has-text-centered strong"};function ge(e,t,a,b,o,s){const f=l("page-title"),v=l("button-simple"),g=l("search-field"),k=l("combobox-department"),_=l("combobox-styled"),n=l("route-tabs"),y=l("people-list"),w=l("edit-avatar-modal"),x=l("edit-person-modal"),P=l("new-token-modal"),E=l("hard-delete-modal");return r(),h("div",he,[i("div",fe,[d(f,{class:"flexrow-item filler",text:e.$t("bots.title")},null,8,["text"]),e.isCurrentUserAdmin?(r(),c(v,{key:0,class:"flexrow-item",text:e.$t("bots.new_bot"),"is-responsive":!0,icon:"plus",onClick:s.onNewClicked},null,8,["text","onClick"])):u("",!0)]),i("div",ve,[d(g,{ref:"search-field",class:"search flexrow-item",onChange:s.onSearchChange,placeholder:"ex: gazu bot"},null,8,["onChange"]),d(k,{class:"flexrow-item","all-departments-label":"",label:e.$t("main.department"),modelValue:o.selectedDepartment,"onUpdate:modelValue":t[0]||(t[0]=p=>o.selectedDepartment=p)},null,8,["label","modelValue"]),d(_,{class:"flexrow-item",label:e.$t("people.fields.role"),"locale-key-prefix":"people.role.",options:o.roleOptions,modelValue:o.role,"onUpdate:modelValue":t[1]||(t[1]=p=>o.role=p)},null,8,["label","options","modelValue"])]),t[7]||(t[7]=i("div",{class:"query-list"},null,-1)),d(n,{class:"mb0","active-tab":o.activeTab,tabs:o.tabs},null,8,["active-tab","tabs"]),e.isPeopleLoading||s.currentPeople.length>0?(r(),c(y,{key:0,entries:o.activeTab==="active"?s.activePeople:s.unactivePeople,"is-bots":!0,"is-loading":e.isPeopleLoading,"is-error":e.isPeopleLoadingError,onAvatarClicked:s.onAvatarClicked,onDeleteClicked:s.onDeleteClicked,onEditClicked:s.onEditClicked,onRefreshClicked:s.onRefreshClicked},null,8,["entries","is-loading","is-error","onAvatarClicked","onDeleteClicked","onEditClicked","onRefreshClicked"])):(r(),h("div",be,[i("p",null,m(e.$t("bots.no_bot")),1),e.isCurrentUserAdmin?(r(),c(v,{key:0,class:"mt1",text:e.$t("bots.new_bot"),"is-responsive":!0,onClick:s.onNewClicked},null,8,["text","onClick"])):u("",!0)])),o.modals.avatar?(r(),c(w,{key:2,active:"","error-text":e.$t("bots.edit_avatar_error"),"is-deleting":o.loading.deletingAvatar,"is-error":o.errors.avatar,"is-updating":o.loading.updatingAvatar,person:o.personToEdit,onClose:t[2]||(t[2]=p=>o.modals.avatar=!1),onDelete:s.deleteAvatar,onUpdate:s.updateAvatar},null,8,["error-text","is-deleting","is-error","is-updating","person","onDelete","onUpdate"])):u("",!0),o.modals.edit?(r(),c(x,{key:3,active:"","is-bot":!0,"is-error":o.errors.edit,"is-loading":o.loading.edit,"is-user-limit-error":o.errors.userLimit,"person-to-edit":o.personToEdit,onCancel:t[3]||(t[3]=p=>o.modals.edit=!1),onConfirm:s.confirmEditPeople},null,8,["is-error","is-loading","is-user-limit-error","person-to-edit","onConfirm"])):u("",!0),o.modals.newToken?(r(),c(P,{key:4,active:"",person:o.personToEdit,onCancel:t[4]||(t[4]=p=>o.modals.newToken=!1),onClose:t[5]||(t[5]=p=>o.modals.newToken=!1),onGenerateToken:s.confirmGenerateToken},null,8,["person","onGenerateToken"])):u("",!0),o.modals.del?(r(),c(E,{key:5,active:"","error-text":e.$t("people.delete_error"),"is-loading":o.loading.del,"is-error":o.errors.del,"lock-text":o.personToDelete?o.personToDelete.full_name:"",text:s.deleteText,onCancel:t[6]||(t[6]=p=>o.modals.del=!1),onConfirm:s.confirmDeletePeople},null,8,["error-text","is-loading","is-error","lock-text","text","onConfirm"])):u("",!0)])}const Ke=T(ue,[["render",ge],["__scopeId","data-v-c57ff41d"]]);export{Ke as default};
//# sourceMappingURL=Bots-DSxdXnwM.js.map
