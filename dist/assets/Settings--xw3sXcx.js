import{l as r,o as i,m as n,g as l,n as _}from"./index-LLRK0geY.js";import{C as m}from"./ChangeAvatarModal-mgMTMoJ4.js";const h={name:"settings",components:{ChangeAvatarModal:m,ComboboxBoolean:r,TextField:i},data(){return{organisationLogoPath:"",form:{chat_token_discord:"",chat_token_slack:"",chat_webhook_mattermost:"",has_avatar:!1,hd_by_default:"false",hours_by_day:0,name:"",timesheets_locked:"false",use_original_file_name:"false"},errors:{save:!1,saveAvatar:!1,webhook_error:!1},loading:{save:!1,saveAvatar:!1},modals:{avatar:!1}}},mounted(){this.organisationLogoPath=`/api/pictures/thumbnails/organisations/${this.organisation.id}.png`},computed:{...n(["organisation"])},methods:{...l(["changeAvatar","deleteOrganisationLogo","saveOrganisation","uploadOrganisationLogo"]),checkWebhook(){return!this.form.chat_webhook_mattermost||this.form.chat_webhook_mattermost.match("/hooks/[a-zA-Z0-9]+$")?(this.errors.webhook_error=!1,!0):(this.errors.webhook_error=!0,!1)},hideAvatarModal(){this.modals.avatar=!1},showAvatarModal(){this.modals.avatar=!0},saveSettings(){this.checkWebhook()&&(this.loading.save=!0,this.errors.save=!1,this.saveOrganisation(this.form).catch(s=>{console.error(s),this.errors.save=!0}).finally(()=>{this.loading.save=!1}))},uploadAvatarFile(s){this.loading.saveAvatar=!0,this.errors.saveAvatar=!1,this.uploadOrganisationLogo(s).then(()=>{setTimeout(()=>{this.modals.avatar=!1;const t=Date.now();this.organisationLogoPath=`/api/pictures/thumbnails/organisations/${this.organisation.id}.png?t=${t}`},500)}).catch(t=>{console.error(t),this.errors.saveAvatar=!0}).finally(()=>{this.loading.saveAvatar=!1})},removeAvatar(){this.loading.save=!0,this.errors.save=!1,this.deleteOrganisationLogo().catch(s=>{console.error(s),this.errors.save=!0}).finally(()=>{this.loading.save=!1})}},watch:{organisation:{immediate:!0,handler(){this.form={chat_token_discord:this.organisation.chat_token_discord,chat_token_slack:this.organisation.chat_token_slack,chat_webhook_mattermost:this.organisation.chat_webhook_mattermost,has_avatar:this.organisation.has_avatar,hd_by_default:this.organisation.hd_by_default?"true":"false",hours_by_day:this.organisation.hours_by_day,name:this.organisation.name,timesheets_locked:this.organisation.timesheets_locked?"true":"false",use_original_file_name:this.organisation.use_original_file_name?"true":"false"}}}},metaInfo(){return{title:`${this.$t("settings.title")} - Kitsu`}}};var c=function(){var o;var t=this,a=t._self._c;return a("div",{staticClass:"settings page"},[a("div",{staticClass:"settings-form"},[a("form",{staticClass:"settings-header",on:{submit:function(e){e.preventDefault()}}},[a("h2",[t._v(" "+t._s(t.$t("main.studio"))+" ")]),a("div",{staticClass:"field"},[a("label",{staticClass:"label"},[t._v(" "+t._s(t.$t("settings.logo"))+" ")]),t.form.has_avatar?a("div",{staticClass:"logo-wrapper"},[a("img",{attrs:{src:t.organisationLogoPath}})]):a("p",{staticClass:"no-logo"},[a("em",[t._v(t._s(t.$t("settings.no_logo")))])]),a("p",[a("button",{staticClass:"button set-logo-button",attrs:{type:"button"},on:{click:t.showAvatarModal}},[t._v(" "+t._s(t.$t("settings.set_logo"))+" ")])]),t.form.has_avatar?a("p",[a("button",{staticClass:"button is-link remove-logo-button",attrs:{type:"button"},on:{click:t.removeAvatar}},[t._v(" "+t._s(t.$t("settings.remove_logo"))+" ")])]):t._e()])]),a("form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.saveSettings.apply(null,arguments)}}},[a("h2",[t._v(" "+t._s(t.$t("settings.title"))+" ")]),a("text-field",{staticClass:"mt2",attrs:{label:t.$t("settings.fields.name"),required:!0},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",typeof e=="string"?e.trim():e)},expression:"form.name"}}),a("text-field",{attrs:{label:t.$t("settings.fields.hours_by_day"),min:1,max:24,required:!0,type:"number"},model:{value:t.form.hours_by_day,callback:function(e){t.$set(t.form,"hours_by_day",e)},expression:"form.hours_by_day"}}),a("combobox-boolean",{attrs:{label:t.$t("settings.fields.use_original_name")},model:{value:t.form.use_original_file_name,callback:function(e){t.$set(t.form,"use_original_file_name",e)},expression:"form.use_original_file_name"}}),a("combobox-boolean",{attrs:{label:t.$t("settings.fields.show_hd_default")},model:{value:t.form.hd_by_default,callback:function(e){t.$set(t.form,"hd_by_default",e)},expression:"form.hd_by_default"}}),a("combobox-boolean",{attrs:{label:t.$t("settings.fields.timesheets_locked")},model:{value:t.form.timesheets_locked,callback:function(e){t.$set(t.form,"timesheets_locked",e)},expression:"form.timesheets_locked"}}),a("h2",[t._v(" "+t._s(t.$t("settings.integrations"))+" ")]),a("text-field",{attrs:{label:t.$t("settings.fields.slack_token")},model:{value:t.form.chat_token_slack,callback:function(e){t.$set(t.form,"chat_token_slack",typeof e=="string"?e.trim():e)},expression:"form.chat_token_slack"}}),a("text-field",{attrs:{label:t.$t("settings.fields.discord_token")},model:{value:t.form.chat_token_discord,callback:function(e){t.$set(t.form,"chat_token_discord",typeof e=="string"?e.trim():e)},expression:"form.chat_token_discord"}}),a("div",{staticClass:"mattermost_integrations"},[a("text-field",{attrs:{label:t.$t("settings.fields.mattermost_webhook")},model:{value:t.form.chat_webhook_mattermost,callback:function(e){t.$set(t.form,"chat_webhook_mattermost",typeof e=="string"?e.trim():e)},expression:"form.chat_webhook_mattermost"}}),this.errors.webhook_error===!0?a("div",{staticClass:"error has-text-centered"},[a("em",[t._v(t._s(t.$t("settings.webhook_error")))])]):t._e()],1),a("button",{staticClass:"button save-button is-medium",class:{"is-loading":t.loading.save},attrs:{disabled:t.loading.save||!((o=this.$refs.form)!=null&&o.checkValidity())}},[t._v(" "+t._s(t.$t("settings.save.button"))+" ")]),t.errors.save?a("p",{staticClass:"error has-text-centered mt2"},[a("em",[t._v(t._s(t.$t("settings.save.error")))])]):t._e()],1)]),a("change-avatar-modal",{attrs:{active:t.modals.avatar,"is-loading":t.loading.saveAvatar,"is-error":t.errors.saveAvatar,title:t.$t("settings.change_logo")},on:{confirm:t.uploadAvatarFile,cancel:t.hideAvatarModal}})],1)},d=[],f=_(h,c,d,!1,null,"de83da2c",null,null);const v=f.exports;export{v as default};
//# sourceMappingURL=Settings--xw3sXcx.js.map
