import{_ as y,o as n,c as r,d as i,a8 as d,S as v,E as j,r as o,g as _,w as m,f as u,F as b,e as w,n as x,t as l,a as k,b as E}from"./index-C2m_IhNF.js";import{f as F}from"./format-CUjWrpVJ.js";import{E as L}from"./EntityChat-HdGpW8i5.js";import"./string-B0Tq569e.js";import"./dom-tO7tlkHV.js";import"./EmojiButton-B9I5hDFH.js";import"./FileUpload-C4E3YXqL.js";import"./ConfirmModal-CYuRpfjg.js";import"./render-Bqw3AFAH.js";import"./video-Yn96Kb74.js";const B={name:"page-left-side-layout"},S={ref:"page",class:"columns fixed-page"},q={class:"column left-side-column"},M={class:"column main-column"};function N(t,e,h,f,c,a){return n(),r("div",S,[i("div",q,[d(t.$slots,"side")]),i("div",M,[d(t.$slots,"main")])],512)}const P=y(B,[["render",N]]),Q={name:"entity-chats",mixins:[F],components:{EntityChat:L,EntityThumbnail:j,PageLeftSideLayout:P,Spinner:v},data(){return{chats:[],entity:null,loading:{list:!1}}},async mounted(){this.loading.list=!0,this.chats=await this.getEntityChats(),this.$route.query.entity_id?this.selectFromQuery():this.selectFirstChat(),this.loading.list=!1},computed:{...E(["productionMap","user"]),chatList(){return[...this.chats].sort((t,e)=>t.last_message?e.last_message?t.last_message===e.last_message?t.entity_name.localeCompare(e.entity_name):t.last_message<e.last_message:-1:1)}},methods:{...k(["getEntityChats"]),selectFirstChat(){if(this.chats.length>0){const t=this.chats[this.chats.length-1];this.entity={id:t.object_id}}},selectFromQuery(){const t=this.chats.find(e=>e.object_id===this.$route.query.entity_id);t?this.entity={id:t.object_id}:this.selectFirstChat()},selectChat(t){this.entity={id:t.object_id},this.$nextTick(()=>{this.$refs.entityChat.focusMessageBox()}),this.$router.push({query:{entity_id:t.object_id}})},chatClass(t){return{"chat-item":!0,selected:this.entity&&this.entity.id===t.object_id}},getChatProjectName(t){return this.productionMap.get(t.project_id).name},getChatDate(t){return t.last_message?this.formatDate(t.last_message):this.$t("chats.no_message_yet")}},watch:{"$route.query.entity_id"(){this.selectFromQuery()}},socket:{events:{async"chat:joined"(t){!this.chats.some(e=>e.id===t.chat_id)&&this.user.id===t.person_id&&(this.chats=await this.getEntityChats())},"chat:left"(t){this.chats.some(e=>e.id===t.chat_id)&&this.user.id===t.person_id&&(this.chats=this.chats.filter(e=>e.id!==t.chat_id))},"chat:new-message"(t){const e=this.chats.find(h=>h.id===t.chat_id);e&&(e.last_message=t.last_message)}}},head(){return{title:`${this.$t("chats.title")} - Kitsu`}}},T={class:"chat-column"},V={key:1,class:"chat-list"},z=["onClick"],A={class:"flexrow"},G={class:"flexcolumn flexrow-item ml1"},I={class:"chat-item-project-name"},K={class:"chat-item-title"},D={class:"chat-item-subtitle"},H={class:"selected-entity-chat"};function J(t,e,h,f,c,a){const p=o("spinner"),g=o("entity-thumbnail"),C=o("entity-chat"),$=o("page-left-side-layout");return n(),_($,null,{side:m(()=>[i("div",T,[c.loading.list?(n(),_(p,{key:0,class:"mt1"})):(n(),r("div",V,[(n(!0),r(b,null,w(a.chatList,s=>(n(),r("div",{key:s.id,class:x(a.chatClass(s)),onClick:O=>a.selectChat(s)},[i("div",A,[u(g,{class:"flexrow-item mr1",height:40,"empty-height":40,"empty-width":60,entity:{id:s.object_id,preview_file_id:s.preview_file_id}},null,8,["entity"]),i("div",G,[i("div",I,l(a.getChatProjectName(s)),1),i("div",K,l(s.entity_name),1),i("div",D,l(a.getChatDate(s)),1)])])],10,z))),128))]))])]),main:m(()=>[i("div",H,[u(C,{ref:"entityChat",entity:c.entity,name:a.chatList.find(s=>s.object_id===c.entity.id)?.entity_name},null,8,["entity","name"])])]),_:1})}const at=y(Q,[["render",J],["__scopeId","data-v-ba6568b7"]]);export{at as default};
//# sourceMappingURL=EntityChats-D9zA-Bk8.js.map
