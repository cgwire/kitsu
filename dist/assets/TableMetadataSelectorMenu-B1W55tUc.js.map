{"version":3,"file":"TableMetadataSelectorMenu-B1W55tUc.js","sources":["../../src/components/widgets/TableMetadataSelectorMenu.vue"],"sourcesContent":["<template>\n  <div\n    class=\"column-menu\"\n    :style=\"{\n      top: namespace === 'breakdown' ? '30px' : '40px'\n    }\"\n  >\n    <h2>{{ $t('main.column_visibility') }}</h2>\n    <ul>\n      <li\n        :key=\"descriptor.field_name\"\n        class=\"immutable-column\"\n        v-for=\"descriptor in filteredFixedColumns\"\n      >\n        <label class=\"checkbox\">\n          <input\n            type=\"checkbox\"\n            :checked=\"modelValue && modelValue[descriptor.field_name] !== false\"\n            @change=\"\n              setMetadataDisplayValue(\n                descriptor.field_name,\n                $event.target.checked\n              )\n            \"\n          />\n          {{ descriptor.name }}\n        </label>\n      </li>\n      <li\n        class=\"column-separator immutable-column\"\n        v-if=\"filteredMetadataDescriptors.length > 0\"\n      >\n        <hr />\n      </li>\n\n      <draggable\n        v-if=\"isCurrentUserManager\"\n        v-model=\"sortedMetadataDescriptors\"\n        item-key=\"field_name\"\n        handle=\".drag-handle\"\n        @end=\"onDragEnd\"\n      >\n        <template #item=\"{ element: descriptor }\">\n          <li>\n            <div class=\"flexrow\">\n              <span class=\"drag-handle\">\n                <grip-vertical-icon />\n              </span>\n              <label class=\"checkbox\">\n                <input\n                  type=\"checkbox\"\n                  :checked=\"\n                    modelValue && modelValue[descriptor.field_name] !== false\n                  \"\n                  @change=\"\n                    setMetadataDisplayValue(\n                      descriptor.field_name,\n                      $event.target.checked\n                    )\n                  \"\n                />\n                {{ descriptor.name }}\n              </label>\n            </div>\n          </li>\n        </template>\n      </draggable>\n      <template v-else>\n        <li\n          :key=\"descriptor.field_name\"\n          v-for=\"descriptor in filteredMetadataDescriptors\"\n        >\n          <label class=\"checkbox\">\n            <input\n              type=\"checkbox\"\n              :checked=\"\n                modelValue && modelValue[descriptor.field_name] !== false\n              \"\n              @change=\"\n                setMetadataDisplayValue(\n                  descriptor.field_name,\n                  $event.target.checked\n                )\n              \"\n            />\n            {{ descriptor.name }}\n          </label>\n        </li>\n      </template>\n    </ul>\n  </div>\n</template>\n\n<script>\nimport draggable from 'vuedraggable'\nimport { GripVerticalIcon } from 'lucide-vue-next'\nimport { mapGetters, mapActions } from 'vuex'\n\nexport default {\n  name: 'table-metadata-selector-menu',\n\n  components: {\n    draggable,\n    GripVerticalIcon\n  },\n\n  props: {\n    descriptors: {\n      type: Array,\n      required: true\n    },\n    exclude: {\n      type: Object,\n      default: () => {}\n    },\n    modelValue: {\n      type: Object,\n      required: true\n    },\n    namespace: {\n      type: String,\n      required: true\n    }\n  },\n\n  emits: ['update:modelValue'],\n\n  data() {\n    return {\n      fieldToName: {\n        estimation: this.$t('main.estimation'),\n        fps: this.$t('main.fps'),\n        frameIn: this.$t('main.frame_in'),\n        frameOut: this.$t('main.frame_out'),\n        frames: this.$t('main.frames'),\n        readyFor: this.$t('assets.fields.ready_for'),\n        timeSpent: this.$t('main.timeSpent'),\n        resolution: this.$t('shots.fields.resolution'),\n        stdby: this.$t('breakdown.fields.standby'),\n        maxRetakes: this.$t('shots.fields.max_retakes')\n      },\n      sortedMetadataDescriptors: []\n    }\n  },\n\n  created() {\n    const metadataDisplayHeadersString = localStorage.getItem(\n      this.localStorageKey\n    )\n    let localMetadataDisplayHeaders = { ...this.modelValue }\n    if (metadataDisplayHeadersString) {\n      localMetadataDisplayHeaders = {\n        ...localMetadataDisplayHeaders,\n        ...JSON.parse(metadataDisplayHeadersString)\n      }\n    }\n    for (const descriptor of this.descriptors) {\n      if (localMetadataDisplayHeaders[descriptor.field_name] === undefined) {\n        localMetadataDisplayHeaders[descriptor.field_name] = true\n      }\n    }\n    this.$emit('update:modelValue', localMetadataDisplayHeaders)\n    this.sortedMetadataDescriptors = [...this.filteredMetadataDescriptors]\n  },\n\n  watch: {\n    filteredMetadataDescriptors: {\n      handler(newValue) {\n        if (\n          this.sortedMetadataDescriptors.length === 0 ||\n          this.sortedMetadataDescriptors.length !== newValue.length\n        ) {\n          this.sortedMetadataDescriptors = [...newValue]\n        }\n      },\n      immediate: true\n    }\n  },\n\n  computed: {\n    ...mapGetters(['currentProduction', 'isCurrentUserManager']),\n\n    localStorageKey() {\n      return `metadataDisplayHeaders:${this.namespace}`\n    },\n\n    fixedColumns() {\n      const fixed = []\n      for (const headerName in this.modelValue) {\n        if (this.fieldToName[headerName]) {\n          fixed.push({\n            field_name: headerName,\n            name: this.fieldToName[headerName],\n            isFixed: true\n          })\n        }\n      }\n      return fixed\n    },\n\n    filteredFixedColumns() {\n      return this.fixedColumns.filter(descriptor => {\n        return !this.exclude[descriptor.field_name]\n      })\n    },\n\n    filteredMetadataDescriptors() {\n      const filtered = this.descriptors.filter(descriptor => {\n        return !this.exclude[descriptor.field_name]\n      })\n      return filtered.sort((a, b) => {\n        const positionA = a.position ?? 1000\n        const positionB = b.position ?? 1000\n        if (positionA !== positionB) {\n          return positionA - positionB\n        }\n        const nameA = a.name || ''\n        const nameB = b.name || ''\n        return nameA.localeCompare(nameB)\n      })\n    },\n\n    entityType() {\n      const descriptorWithEntityType = this.descriptors.find(d => d.entity_type)\n      return descriptorWithEntityType?.entity_type || null\n    }\n  },\n\n  methods: {\n    ...mapActions(['reorderMetadataDescriptors']),\n    setMetadataDisplayValue(metadataName, isSelected) {\n      const localMetadataDisplayHeaders = { ...this.modelValue }\n      localMetadataDisplayHeaders[metadataName] = isSelected\n      localStorage.setItem(\n        this.localStorageKey,\n        JSON.stringify(localMetadataDisplayHeaders)\n      )\n      this.$emit('update:modelValue', localMetadataDisplayHeaders)\n    },\n\n    onDragEnd() {\n      const descriptorIds = this.sortedMetadataDescriptors\n        .filter(d => d.id)\n        .map(d => d.id)\n\n      if (\n        this.currentProduction?.id &&\n        this.entityType &&\n        descriptorIds.length > 0\n      ) {\n        this.reorderMetadataDescriptors({\n          entityType: this.entityType,\n          descriptorIds\n        }).catch(err => {\n          console.error('Failed to reorder metadata descriptors:', err)\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark .column-menu {\n  background-color: $dark-grey-light;\n  box-shadow: 0 2px 6px $dark-grey;\n\n  .checkbox:hover {\n    color: $white;\n  }\n}\n\n.column-menu {\n  background: $white;\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n  box-shadow: 0 2px 6px $light-grey;\n  max-height: 400px;\n  overflow: auto;\n  position: absolute;\n  right: 0;\n  text-align: left;\n  top: 40px;\n  width: 200px;\n  z-index: 100;\n\n  h2 {\n    border-bottom: 0;\n    color: var(--text);\n    margin-bottom: 0;\n    margin-top: 0;\n    padding: 0.6em;\n    text-align: center;\n    text-transform: capitalize;\n  }\n\n  ul {\n    list-style-type: none;\n    margin: 0;\n  }\n\n  li {\n    padding: 0.8em;\n    transition: background-color 0.2s ease;\n\n    &.immutable-column {\n      cursor: default;\n\n      &:hover {\n        background-color: rgba(0, 0, 0, 0.05);\n      }\n    }\n\n    &.column-separator {\n      hr {\n        margin: 0;\n      }\n    }\n\n    &:not(.immutable-column) {\n      &:hover {\n        background-color: rgba(0, 0, 0, 0.05);\n      }\n    }\n\n    .drag-handle {\n      cursor: grab;\n      display: inline-flex;\n      align-items: center;\n      color: var(--text);\n      opacity: 0.5;\n      margin-right: 0.5em;\n      flex-shrink: 0;\n      user-select: none;\n      transition: opacity 0.2s ease;\n\n      &:hover {\n        opacity: 1;\n      }\n\n      &:active {\n        cursor: grabbing;\n      }\n\n      svg {\n        pointer-events: none;\n      }\n    }\n\n    .flexrow {\n      display: flex;\n      align-items: center;\n      width: 100%;\n    }\n  }\n\n  .checkbox {\n    width: 100%;\n    cursor: pointer;\n\n    input {\n      cursor: pointer;\n    }\n  }\n}\n\n.dark .column-menu {\n  li {\n    &:hover {\n      background-color: rgba(255, 255, 255, 0.1);\n    }\n  }\n}\n</style>\n"],"names":["_sfc_main","draggable","GripVerticalIcon","metadataDisplayHeadersString","localMetadataDisplayHeaders","descriptor","newValue","mapGetters","fixed","headerName","a","b","positionA","positionB","nameA","nameB","d","mapActions","metadataName","isSelected","descriptorIds","err","_hoisted_1","_hoisted_2","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_createElementBlock","_normalizeStyle","$props","_createElementVNode","_ctx","_openBlock","_Fragment","_renderList","$options","$event","_createTextVNode","_toDisplayString","_hoisted_3","_cache","_createCommentVNode","_createBlock","_component_draggable","$data","_withCtx","_createVNode","_component_grip_vertical_icon"],"mappings":"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"}