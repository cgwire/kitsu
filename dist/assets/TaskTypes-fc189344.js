import{c as d,bW as n,aG as c,M as p,d as m,m as r,b as l,n as o,bf as u,u as f,R as y,a as h,be as _,D as k,bh as g}from"./index-615d5dcf.js";import{B as T}from"./BooleanField-f283b099.js";import{C as b}from"./ColorField-e2ef5550.js";import{L as v}from"./ListPageHeader-1b5fc926.js";import{B as C}from"./BooleanRep-6e5abe4d.js";const $={name:"edit-task-type-modal",mixins:[d],components:{BooleanField:T,ComboboxSimple:n,ComboboxDepartment:c,ColorField:b,ModalFooter:p,TextField:m},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},taskTypes:{type:Array,default:()=>[]},taskTypeToEdit:{type:Object,default:()=>{}}},watch:{taskTypeToEdit(){this.taskTypeToEdit&&(this.form={name:this.taskTypeToEdit.name,color:this.taskTypeToEdit.color,for_entity:this.taskTypeToEdit.for_entity||"Asset",allow_timelog:String(this.taskTypeToEdit.allow_timelog===!0),department_id:this.taskTypeToEdit.department_id})}},data(){return{form:{name:"",color:"$grey",for_entity:"Asset",allow_timelog:"false",department_id:null},dedicatedToOptions:[{label:this.$t("assets.title"),value:"Asset"},{label:this.$t("shots.title"),value:"Shot"},{label:this.$t("edits.title"),value:"Edit"},{label:this.$t("sequences.title"),value:"Sequence"},{label:this.$t("episodes.title"),value:"Episode"}]}},computed:{...r(["taskTypes","taskTypeStatusOptions","departments"]),isEditing(){return this.taskTypeToEdit&&this.taskTypeToEdit.id}},methods:{...l([]),newPriority(a){return this.taskTypes.filter(t=>t.for_entity===a).length+1},confirmClicked(){this.isEditing||(this.form.priority=this.newPriority(this.form.for_entity)),this.$emit("confirm",this.form)}}};var w=function(){var t=this,e=t._self._c;return e("div",{class:{modal:!0,"is-active":t.active}},[e("div",{staticClass:"modal-background",on:{click:function(s){return t.$emit("cancel")}}}),e("div",{staticClass:"modal-content"},[e("div",{staticClass:"box"},[t.isEditing?e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("task_types.edit_title"))+" "+t._s(t.taskTypeToEdit.name)+" ")]):e("h1",{staticClass:"title"},[t._v(" "+t._s(t.$t("task_types.new_task_type"))+" ")]),e("form",{on:{submit:function(s){s.preventDefault()}}},[e("text-field",{directives:[{name:"focus",rawName:"v-focus"}],ref:"nameField",attrs:{label:t.$t("task_types.fields.name")},on:{enter:t.confirmClicked},model:{value:t.form.name,callback:function(s){t.$set(t.form,"name",s)},expression:"form.name"}}),e("boolean-field",{attrs:{label:t.$t("task_types.fields.allow_timelog")},on:{enter:t.confirmClicked},model:{value:t.form.allow_timelog,callback:function(s){t.$set(t.form,"allow_timelog",s)},expression:"form.allow_timelog"}}),t.isEditing?t._e():e("combobox-simple",{staticClass:"field",attrs:{label:t.$t("task_types.fields.dedicated_to"),options:t.dedicatedToOptions},on:{enter:t.confirmClicked},model:{value:t.form.for_entity,callback:function(s){t.$set(t.form,"for_entity",s)},expression:"form.for_entity"}}),e("combobox-department",{attrs:{label:t.$t("task_types.fields.department")},on:{enter:t.confirmClicked},model:{value:t.form.department_id,callback:function(s){t.$set(t.form,"department_id",s)},expression:"form.department_id"}}),e("color-field",{ref:"colorField",attrs:{label:t.$t("task_types.fields.color")},model:{value:t.form.color,callback:function(s){t.$set(t.form,"color",s)},expression:"form.color"}})],1),e("modal-footer",{attrs:{"error-text":t.$t("task_types.create_error"),"is-loading":t.isLoading,"is-error":t.isError},on:{confirm:t.confirmClicked,cancel:function(s){return t.$emit("cancel")}}})],1)])])},E=[],I=o($,w,E,!1,null,"a58b208e",null,null);const x=I.exports;const S={name:"task-type-list",props:{entries:{type:Array,default:()=>[]},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},data(){return{assetsItems:[],shotsItems:[],editsItems:[],sequencesItems:[],episodesItems:[]}},components:{draggable:u,BooleanRep:C,DepartmentName:f,RowActionsCell:y,TableInfo:h,TaskTypeCell:_},mounted(){},computed:{...r(["getDepartments"]),assetTaskTypes(){return this.getTaskTypesForEntity("Asset")},shotTaskTypes(){return this.getTaskTypesForEntity("Shot")},editTaskTypes(){return this.getTaskTypesForEntity("Edit")},sequenceTaskTypes(){return this.getTaskTypesForEntity("Sequence")},episodeTaskTypes(){return this.getTaskTypesForEntity("Episode")}},methods:{...l([]),getTaskTypesForEntity(a){return this.entries.filter(t=>t.for_entity===a)},updatePriority(a){const t=[];a.forEach((e,s)=>{s+=1;const i={id:e.id,name:e.name,priority:String(s)};e.priority=s,t.push(i)}),this.$emit("update-priorities",t)},updatePriorityAssets(){this.updatePriority(this.assetsItems)},updatePriorityShots(){this.updatePriority(this.shotsItems)},updatePriorityEdits(){this.updatePriority(this.editsItems)},updatePrioritySequences(){this.updatePriority(this.sequencesItems)},updatePriorityEpisodes(){this.updatePriority(this.episodesItems)},isEmpty(a){return a==null||a===""}},watch:{entries:{immediate:!0,handler(){setTimeout(()=>{this.assetsItems=JSON.parse(JSON.stringify(this.assetTaskTypes)),this.shotsItems=JSON.parse(JSON.stringify(this.shotTaskTypes)),this.editsItems=JSON.parse(JSON.stringify(this.editTaskTypes)),this.episodesItems=JSON.parse(JSON.stringify(this.episodeTaskTypes)),this.sequencesItems=JSON.parse(JSON.stringify(this.sequenceTaskTypes))},100)}}}};var P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"data-list"},[e("div",{staticClass:"datatable-wrapper"},[e("table",{staticClass:"datatable multi-section"},[e("thead",{staticClass:"datatable-head"},[e("tr",[e("th",{staticClass:"department",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("task_types.fields.department"))+" ")]),e("th",{staticClass:"name",attrs:{scope:"col"}},[t._v(t._s(t.$t("task_types.fields.name")))]),e("th",{staticClass:"allow-timelog",attrs:{scope:"col"}},[t._v(" "+t._s(t.$t("task_types.fields.allow_timelog"))+" ")]),e("th",{staticClass:"actions",attrs:{scope:"col"}})])]),e("draggable",{staticClass:"datatable-body",attrs:{draggable:".tasktype-item",tag:"tbody",sort:!0},on:{end:t.updatePriorityAssets},model:{value:t.assetsItems,callback:function(s){t.assetsItems=s},expression:"assetsItems"}},[e("tr",{staticClass:"datatable-type-header",attrs:{slot:"header"},slot:"header"},[e("th",{attrs:{scope:"rowgroup",colspan:"4"}},[e("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("assets.title"))+" ")])])]),t._l(t.assetsItems,function(s){return e("tr",{key:s.id,staticClass:"datatable-row tasktype-item"},[e("td",{staticClass:"department"},[t.isEmpty(s.department_id)?t._e():e("department-name",{attrs:{department:t.getDepartments(s.department_id)}})],1),e("task-type-cell",{staticClass:"name",attrs:{"task-type":s}}),e("td",{staticClass:"allow-timelog"},[e("boolean-rep",{attrs:{value:s.allow_timelog}})],1),e("row-actions-cell",{attrs:{"taskType-id":s.id},on:{"delete-clicked":function(i){return t.$emit("delete-clicked",s)},"edit-clicked":function(i){return t.$emit("edit-clicked",s)}}})],1)})],2),e("draggable",{staticClass:"datatable-body",attrs:{draggable:".tasktype-item",tag:"tbody",sort:!0},on:{end:t.updatePriorityShots},model:{value:t.shotsItems,callback:function(s){t.shotsItems=s},expression:"shotsItems"}},[e("tr",{staticClass:"datatable-type-header",attrs:{slot:"header"},slot:"header"},[e("th",{attrs:{scope:"rowgroup",colspan:"4"}},[e("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("shots.title"))+" ")])])]),t._l(t.shotsItems,function(s){return e("tr",{key:s.id,staticClass:"datatable-row tasktype-item"},[e("td",{staticClass:"department"},[t.isEmpty(s.department_id)?t._e():e("department-name",{attrs:{department:t.getDepartments(s.department_id)}})],1),e("task-type-cell",{staticClass:"name",attrs:{"task-type":s}}),e("td",{staticClass:"allow-timelog"},[e("boolean-rep",{attrs:{value:s.allow_timelog}})],1),e("row-actions-cell",{attrs:{"taskType-id":s.id},on:{"delete-clicked":function(i){return t.$emit("delete-clicked",s)},"edit-clicked":function(i){return t.$emit("edit-clicked",s)}}})],1)})],2),e("draggable",{staticClass:"datatable-body",attrs:{draggable:".tasktype-item",tag:"tbody",sort:!0},on:{end:t.updatePriorityEdits},model:{value:t.editsItems,callback:function(s){t.editsItems=s},expression:"editsItems"}},[e("tr",{staticClass:"datatable-type-header",attrs:{slot:"header"},slot:"header"},[e("th",{attrs:{scope:"rowgroup",colspan:"4"}},[e("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("edits.title"))+" ")])])]),t._l(t.editsItems,function(s){return e("tr",{key:s.id,staticClass:"datatable-row tasktype-item"},[e("td",{staticClass:"department"},[t.isEmpty(s.department_id)?t._e():e("department-name",{attrs:{department:t.getDepartments(s.department_id)}})],1),e("task-type-cell",{staticClass:"name",attrs:{"task-type":s}}),e("td",{staticClass:"allow-timelog"},[e("boolean-rep",{attrs:{value:s.allow_timelog}})],1),e("row-actions-cell",{attrs:{"taskType-id":s.id},on:{"delete-clicked":function(i){return t.$emit("delete-clicked",s)},"edit-clicked":function(i){return t.$emit("edit-clicked",s)}}})],1)})],2),e("draggable",{staticClass:"datatable-body",attrs:{draggable:".tasktype-item",tag:"tbody",sort:!0},on:{end:t.updatePrioritySequences},model:{value:t.sequencesItems,callback:function(s){t.sequencesItems=s},expression:"sequencesItems"}},[e("tr",{staticClass:"datatable-type-header",attrs:{slot:"header"},slot:"header"},[e("th",{attrs:{scope:"rowgroup",colspan:"4"}},[e("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("sequences.title"))+" ")])])]),t._l(t.sequencesItems,function(s){return e("tr",{key:s.id,staticClass:"datatable-row tasktype-item"},[e("td",{staticClass:"department"},[t.isEmpty(s.department_id)?t._e():e("department-name",{attrs:{department:t.getDepartments(s.department_id)}})],1),e("task-type-cell",{staticClass:"name",attrs:{"task-type":s}}),e("td",{staticClass:"allow-timelog"},[e("boolean-rep",{attrs:{value:s.allow_timelog}})],1),e("row-actions-cell",{attrs:{"taskType-id":s.id},on:{"delete-clicked":function(i){return t.$emit("delete-clicked",s)},"edit-clicked":function(i){return t.$emit("edit-clicked",s)}}})],1)})],2),e("draggable",{staticClass:"datatable-body",attrs:{draggable:".tasktype-item",tag:"tbody",sort:!0},on:{end:t.updatePriorityEpisodes},model:{value:t.episodesItems,callback:function(s){t.episodesItems=s},expression:"episodesItems"}},[e("tr",{staticClass:"datatable-type-header",attrs:{slot:"header"},slot:"header"},[e("th",{attrs:{scope:"rowgroup",colspan:"4"}},[e("span",{staticClass:"datatable-row-header"},[t._v(" "+t._s(t.$t("episodes.title"))+" ")])])]),t._l(t.episodesItems,function(s){return e("tr",{key:s.id,staticClass:"datatable-row tasktype-item"},[e("td",{staticClass:"department"},[t.isEmpty(s.department_id)?t._e():e("department-name",{attrs:{department:t.getDepartments(s.department_id)}})],1),e("task-type-cell",{staticClass:"name",attrs:{"task-type":s}}),e("td",{staticClass:"allow-timelog"},[e("boolean-rep",{attrs:{value:s.allow_timelog}})],1),e("row-actions-cell",{attrs:{"taskType-id":s.id},on:{"delete-clicked":function(i){return t.$emit("delete-clicked",s)},"edit-clicked":function(i){return t.$emit("edit-clicked",s)}}})],1)})],2)],1)]),e("table-info",{attrs:{"is-loading":t.isLoading,"is-error":t.isError}}),e("p",{staticClass:"has-text-centered nb-task-types"},[t._v(" "+t._s(t.entries.length)+" "+t._s(t.$tc("task_types.number",t.entries.length))+" ")])],1)},D=[],q=o(S,P,D,!1,null,"73525027",null,null);const F=q.exports;const N={name:"task-types",components:{DeleteModal:k,EditTaskTypeModal:x,ListPageHeader:v,TaskTypeList:F},data(){return{errors:{taskTypes:!1,departments:!1,edit:!1,del:!1},loading:{taskTypes:!1,departments:!1,edit:!1,del:!1},modals:{del:!1,edit:!1},taskTypeToDelete:{color:"#999999"},taskTypeToEdit:null}},computed:{...r(["getTaskType","taskTypes"])},mounted(){this.loading.taskTypes=!0,this.errors.taskTypes=!1,this.loading.departments=!0,this.errors.departments=!1,this.loadDepartments().then(()=>{this.loading.departments=!1}).catch(a=>{console.error(a),this.loading.departments=!1,this.errors.departments=!0}),this.loadTaskTypes().then(()=>{this.loading.taskTypes=!1}).catch(a=>{console.error(a),this.loading.taskTypes=!1,this.errors.taskTypes=!0})},methods:{...l(["editTaskType","deleteTaskType","loadTaskTypes","loadDepartments"]),confirmEditTaskType(a){let t="newTaskType";this.taskTypeToEdit&&this.taskTypeToEdit.id&&(t="editTaskType",a.id=this.taskTypeToEdit.id),this.loading.edit=!0,this.errors.edit=!1,this.$store.dispatch(t,a).then(()=>{this.loading.edit=!1,this.modals.edit=!1}).catch(e=>{console.error(e),this.loading.edit=!1,this.errors.edit=!0})},updatePriorities(a){a.forEach(t=>{this.$store.commit("EDIT_TASK_TYPE_END",t)}),this.savePriorities(a)},savePriorities(a){const t=new Date().getTime();this.lastCall=this.lastCall||0,t-this.lastCall>1e3&&!this.isSaving?(this.lastCall=t,this.isSaving=!0,g.runPromiseMapAsSeries(a,this.editTaskType).then(()=>{this.isSaving=!1,this.newSaveCall&&this.savePriorities(a)})):this.newSaveCall=!0},confirmDeleteTaskType(){this.loading.del=!0,this.errors.del=!1,this.deleteTaskType(this.taskTypeToDelete).then(()=>{this.loading.del=!1,this.modals.del=!1}).catch(a=>{console.error(a),this.loading.del=!1,this.errors.del=!0})},deleteText(){const a=this.taskTypeToDelete;return a?this.$t("task_types.delete_text",{name:a.name}):""},onDeleteClicked(a){this.taskTypeToDelete=a,this.modals.del=!0},onEditClicked(a){this.taskTypeToEdit=a,this.modals.edit=!0},onNewClicked(){this.taskTypeToEdit={color:"#999999"},this.modals.edit=!0}},watch:{},metaInfo(){return{title:`${this.$t("task_types.title")} - Kitsu`}}};var O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"task-types page fixed-page"},[e("list-page-header",{attrs:{title:t.$t("task_types.title"),"new-entry-label":t.$t("task_types.new_task_type")},on:{"new-clicked":t.onNewClicked}}),e("task-type-list",{attrs:{entries:t.taskTypes,"is-loading":t.loading.taskTypes||t.loading.departments,"is-error":t.errors.taskTypes||t.errors.departments},on:{"update-priorities":t.updatePriorities,"edit-clicked":t.onEditClicked,"delete-clicked":t.onDeleteClicked}}),e("edit-task-type-modal",{attrs:{active:t.modals.edit,"is-loading":t.loading.edit,"is-error":t.errors.edit,"task-types":t.taskTypes,"task-type-to-edit":t.taskTypeToEdit},on:{cancel:function(s){t.modals.edit=!1},confirm:t.confirmEditTaskType}}),e("delete-modal",{attrs:{active:t.modals.del,"is-loading":t.loading.del,"is-error":t.errors.del,text:t.deleteText(),"error-text":t.$t("task_types.delete_error")},on:{cancel:function(s){t.modals.del=!1},confirm:t.confirmDeleteTaskType}})],1)},A=[],J=o(N,O,A,!1,null,"d9ca0ef2",null,null);const K=J.exports;export{K as default};
//# sourceMappingURL=TaskTypes-fc189344.js.map
