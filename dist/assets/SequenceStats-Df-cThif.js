import{_ as b,a as k,T as M,ar as L,bv as P,bw as T,r as h,c as l,o,e as n,f as u,d as m,t as d,F as p,g,G as q,k as v,w as E,a7 as V,bj as C,m as D,av as O,S as B,b as F,B as U,s as Q,aB as x,aa as A,ab as N}from"./index-BcnNiyx_.js";import{S as j}from"./StatsCell-D6Mb_Euy.js";const R={name:"sequence-stats-list",mixins:[L],components:{StatsCell:j,TableInfo:M},props:{countMode:{type:String,default:"count"},displayMode:{type:String,default:"pie"},entries:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},sequenceStats:{type:Object,default:()=>{}},showAll:{type:Boolean,default:!1},validationColumns:{type:Array,default:()=>[]}},computed:{...k(["currentProduction","currentEpisode","displayedSequencesLength","isCurrentUserClient","isTVShow","sequenceSearchText","taskTypeMap"]),entryStats(){return this.entries.filter(e=>this.isEntryStats(e.id))},isEmptyList(){return this.entries&&this.entries.length===0&&!this.isLoading&&!this.isError&&(!this.sequenceSearchText||this.sequenceSearchText.length===0)}},methods:{chartColors(e,t){return T(this.sequenceStats,e,t)},chartData(e,t,i="count"){return P(this.sequenceStats,e,t,i)},isStats(e,t){return this.sequenceStats[e]&&this.sequenceStats[e][t]},isEntryStats(e){if(!this.sequenceStats[e]&&this.sequenceSearchText)return!1;if(!this.sequenceStats[e])return!0;let t=!1;return Object.keys(this.sequenceStats[e]).forEach(i=>{t=t||this.sequenceStats[e][i]}),t},editPath(e){return this.getPath("edit-sequence",e)},deletePath(e){return this.getPath("delete-sequence",e)},taskTypePath(e){const t={name:"task-type",params:{production_id:this.currentProduction.id,task_type_id:e,type:"shots"}};return this.isTVShow&&this.currentEpisode&&(t.name="episode-task-type",t.params.episode_id=this.currentEpisode.id),t},getPath(e,t){const i={name:e,params:{production_id:this.currentProduction.id}};return this.isTVShow&&this.currentEpisode&&(i.name=`episode-${e}`,i.params.episode_id=this.currentEpisode.id),t&&(i.params.sequence_id=t),i}}},Y={class:"data-list"},G={class:"datatable"},K={class:"datatable-head"},z={scope:"col",class:"validation"},H={key:1,class:"flexrow-item"},J={key:0,class:"datatable-body"},W={key:0,class:"all-line datatable-row"},X={scope:"row",class:"name datatable-row-header"},Z={scope:"row",class:"name datatable-row-header"},I={key:1},$={key:0,class:"has-text-centered"},ee={class:"info"},te={key:1,class:"has-text-centered"},se={class:"info"},ae={key:2,class:"has-text-centered nb-sequences"};function ie(e,t,i,f,c,s){const _=h("router-link"),S=h("stats-cell"),y=h("table-info");return o(),l("div",Y,[n("div",{class:"datatable-wrapper",ref:"body",onScrollPassive:t[0]||(t[0]=(...a)=>e.onBodyScroll&&e.onBodyScroll(...a))},[n("table",G,[n("thead",K,[n("tr",null,[n("th",{scope:"col",class:"name datatable-row-header",ref:"th-sequence"},d(e.$t("shots.fields.sequence")),513),n("th",z,d(e.$t("main.all")),1),i.isLoading?m("",!0):(o(!0),l(p,{key:0},g(i.validationColumns,a=>(o(),l("th",{scope:"col",class:"validation validation-cell",key:a},[n("div",{class:"flexrow validation-content",style:q(e.getValidationStyle(a))},[e.isCurrentUserClient?(o(),l("span",H,d(e.taskTypeMap.get(a).name),1)):(o(),v(_,{key:0,class:"flexrow-item",title:e.taskTypeMap.get(a).name,to:s.taskTypePath(a)},{default:E(()=>[V(d(e.taskTypeMap.get(a).name),1)]),_:2},1032,["title","to"]))],4)]))),128)),t[1]||(t[1]=n("th",{scope:"col",class:"actions"},null,-1))])]),i.isLoading?m("",!0):(o(),l("tbody",J,[i.showAll&&!s.isEmptyList?(o(),l("tr",W,[n("th",X,d(e.$t("sequences.all_sequences")),1),u(S,{class:"all-validation",colors:s.chartColors("all","all"),data:s.chartData("all","all"),"frames-data":s.chartData("all","all","frames"),"drawings-data":s.chartData("all","all","drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["colors","data","frames-data","drawings-data","count-mode","display-mode"]),(o(!0),l(p,null,g(i.validationColumns,a=>(o(),v(S,{style:q(e.getValidationStyle(a)),key:"all-"+a,colors:s.chartColors("all",a),data:s.chartData("all",a),"frames-data":s.chartData("all",a,"frames"),"drawings-data":s.chartData("all",a,"drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["style","colors","data","frames-data","drawings-data","count-mode","display-mode"]))),128)),t[2]||(t[2]=n("td",{class:"actions"},null,-1))])):m("",!0),(o(!0),l(p,null,g(s.entryStats,a=>(o(),l("tr",{class:"datatable-row",key:a.id},[n("td",Z,d(a.name),1),s.isStats(a.id,"all")?(o(),v(S,{key:0,colors:s.chartColors(a.id,"all"),data:s.chartData(a.id,"all"),"frames-data":s.chartData(a.id,"all","frames"),"drawings-data":s.chartData(a.id,"all","drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["colors","data","frames-data","drawings-data","count-mode","display-mode"])):(o(),l("td",I)),(o(!0),l(p,null,g(i.validationColumns,r=>(o(),l(p,{key:a.id+"-"+r},[s.isStats(a.id,r)?(o(),v(S,{key:a.id+r,style:q(e.getValidationStyle(r)),colors:s.chartColors(a.id,r),data:s.chartData(a.id,r),"frames-data":s.chartData(a.id,r,"frames"),"drawings-data":s.chartData(a.id,r,"drawings"),"count-mode":i.countMode,"display-mode":i.displayMode},null,8,["style","colors","data","frames-data","drawings-data","count-mode","display-mode"])):(o(),l("td",{key:1,style:q(e.getValidationStyle(r))},null,4))],64))),128)),t[3]||(t[3]=n("td",{class:"actions"},null,-1))]))),128))]))])],544),u(y,{"is-loading":i.isLoading,"is-error":i.isError},null,8,["is-loading","is-error"]),s.isEmptyList&&!e.isCurrentUserClient&&!i.isLoading?(o(),l("div",$,[t[4]||(t[4]=n("p",{class:"info"},[n("img",{src:C})],-1)),n("p",ee,d(e.$t("sequences.empty_list")),1)])):m("",!0),s.isEmptyList&&e.isCurrentUserClient&&!i.isLoading?(o(),l("div",te,[t[5]||(t[5]=n("p",{class:"info"},[n("img",{src:C})],-1)),n("p",se,d(e.$t("sequences.empty_list_client")),1)])):m("",!0),!s.isEmptyList&&!i.isLoading?(o(),l("p",ae,d(e.displayedSequencesLength)+" "+d(e.$tc("sequences.number",e.displayedSequencesLength)),1)):m("",!0)])}const oe=b(R,[["render",ie],["__scopeId","data-v-503762e6"]]),ne={name:"sequence-stats",mixins:[Q],components:{ButtonSimple:U,Combobox:F,SearchField:B,SearchQueryList:O,SequenceStatsList:oe},data(){return{countMode:"count",displayMode:"pie",initialLoading:!0,countModeOptions:[{label:"shots",value:"count"},{label:"frames",value:"frames"}],displayModeOptions:[{label:"pie",value:"pie"},{label:"count",value:"count"}],loading:{savingSearch:!1}}},mounted(){this.setCountOptions(),this.loadShots(()=>{this.initSequences().then(()=>{this.initialLoading=!1,setTimeout(()=>{this.setSearchFromUrl(),this.onSearchChange()},100)}).catch(e=>console.error(e))})},computed:{...k(["currentEpisode","currentProduction","displayedSequences","isCurrentUserManager","isPaperProduction","isShotsLoading","isShotsLoadingError","isTVShow","searchSequenceFilters","sequences","sequenceMap","sequencesPath","sequenceStats","sequenceSearchText","sequenceSearchQueries","sequenceListScrollPosition","shotValidationColumns","taskTypeMap","taskStatusMap"]),searchField(){return this.$refs["sequence-search-field"]}},methods:{...D(["computeSequenceStats","hideAssignations","initSequences","loadShots","removeSequenceSearch","saveSequenceSearch","setLastProductionScreen","setSequenceStatsSearch","setSequenceListScrollPosition","showAssignations"]),reloadData(){this.initialLoading=!0,this.loadShots(()=>{this.initialLoading=!1,this.computeSequenceStats()})},setDefaultListScrollPosition(){this.$refs["sequence-list"]&&this.$refs["sequence-list"].setScrollPosition(this.sequenceListScrollPosition)},navigateToList(){this.$router.push(this.sequencesPath)},onSearchChange(){const e=this.$refs["sequence-search-field"]?.getValue();this.setSearchInUrl(),this.setSequenceStatsSearch(e)},saveSearchQuery(e){this.loading.savingSearch||(this.loading.savingSearch=!0,this.saveSequenceSearch(e).catch(console.error).finally(()=>{this.loading.savingSearch=!1}))},removeSearchQuery(e){this.removeSequenceSearch(e).catch(console.error)},saveScrollPosition(e){this.setSequenceListScrollPosition(e)},exportStatisticsToCsv(){const e=[x().format("YYYYMMDD"),this.currentProduction.name,"sequences","statistics"];this.currentEpisode&&e.splice(2,0,this.currentEpisode.name);const t=A.slugify(e.join("_"));N.generateStatReports(t,this.sequenceStats,this.taskTypeMap,this.taskStatusMap,this.sequenceMap,this.countMode,this.currentProduction)},onFieldChanged({entry:e,fieldName:t,value:i}){const f={id:e.id};f[t]=i,this.editSequence(f)},setCountOptions(){this.isPaperProduction?this.countModeOptions=[{label:"shots",value:"count"},{label:"drawings",value:"drawings"}]:this.countModeOptions=[{label:"shots",value:"count"},{label:"frames",value:"frames"}],this.countMode=this.countModeOptions[0].value}},watch:{currentProduction(){this.$refs["sequence-search-field"].setValue(""),this.$store.commit("SET_SEQUENCE_LIST_SCROLL_POSITION",0),this.setCountOptions(),this.isTVShow||this.loadShots(()=>{this.initSequences().catch(e=>console.error(e))})},currentEpisode(){this.isTVShow&&this.currentEpisode&&this.loadShots(()=>{this.initSequences().then(()=>{this.initialLoading=!1}).catch(e=>console.error(e))})},searchSequenceFilters:{deep:!0,handler(){this.computeSequenceStats()}},"$route.query.search"(){this.setSearchFromUrl(),this.onSearchChange()}},head(){return this.isTVShow?{title:`${this.currentProduction?this.currentProduction.name:""} - ${this.currentEpisode?this.currentEpisode.name:""} | ${this.$t("sequences.title")} - Kitsu`}:{title:`${this.currentProduction?this.currentProduction.name:""} | ${this.$t("sequences.title")} - Kitsu`}}},le={class:"sequences page fixed-page"},re={class:"sequence-list-header page-header flexrow"},ce={class:"query-list mt1"};function de(e,t,i,f,c,s){const _=h("search-field"),S=h("combobox"),y=h("button-simple"),a=h("search-query-list"),r=h("sequence-stats-list");return o(),l("div",le,[n("div",re,[u(_,{class:"flexrow-item mt1",ref:"sequence-search-field","can-save":!0,onChange:s.onSearchChange,onSave:s.saveSearchQuery,placeholder:"ex: e01 s01 anim=wip"},null,8,["onChange","onSave"]),u(S,{class:"mb0 flexrow-item",label:e.$t("statistics.display_mode"),"locale-key-prefix":"statistics.",options:c.displayModeOptions,modelValue:c.displayMode,"onUpdate:modelValue":t[0]||(t[0]=w=>c.displayMode=w)},null,8,["label","options","modelValue"]),u(S,{class:"mb0 flexrow-item",label:e.$t("statistics.count_mode"),"locale-key-prefix":"statistics.",options:c.countModeOptions,modelValue:c.countMode,"onUpdate:modelValue":t[1]||(t[1]=w=>c.countMode=w)},null,8,["label","options","modelValue"]),t[2]||(t[2]=n("span",{class:"filler"},null,-1)),u(y,{class:"flexrow-item",icon:"refresh",title:e.$t("main.reload"),onClick:s.reloadData},null,8,["title","onClick"]),u(y,{class:"flexrow-item",icon:"download",title:e.$t("main.csv.export_file"),onClick:s.exportStatisticsToCsv},null,8,["title","onClick"])]),n("div",ce,[u(a,{queries:e.sequenceSearchQueries,type:"sequenceStat",onRemoveSearch:s.removeSearchQuery},null,8,["queries","onRemoveSearch"])]),u(r,{ref:"sequence-list","count-mode":c.countMode,"display-mode":c.displayMode,entries:e.displayedSequences,"is-loading":e.isShotsLoading||c.initialLoading,"is-error":e.isShotsLoadingError,"validation-columns":e.shotValidationColumns,"sequence-stats":e.sequenceStats,"show-all":e.sequenceSearchText.length===0,onFieldChanged:s.onFieldChanged,onScroll:s.saveScrollPosition},null,8,["count-mode","display-mode","entries","is-loading","is-error","validation-columns","sequence-stats","show-all","onFieldChanged","onScroll"])])}const Se=b(ne,[["render",de],["__scopeId","data-v-ece63650"]]);export{Se as default};
//# sourceMappingURL=SequenceStats-Df-cThif.js.map
