import{_ as b,M as A,p as I,aY as w,b as k,r as g,q as V,o as a,c,d,f as v,t as l,F as p,e as m,n as h,k as S,a4 as f,O as u,h as N}from"./index-Dw-uod2x.js";import{s as q}from"./string-B0Tq569e.js";import{C}from"./Combobox-Z_ENhFXj.js";import{P}from"./PageTitle-CBcleFeD.js";const T={name:"manage-shots-modal",mixins:[A],components:{Combobox:C,PageTitle:P},props:{active:{default:!0,type:Boolean}},emits:["add-episode","add-sequence","add-shot","cancel"],data(){return{names:{episode:"",sequence:"",shot:""},loading:{addEpisode:!1,addSequence:!1,addShot:!1},sequences:[],displayedShots:[],selectedEpisodeId:null,selectedSequenceId:null,shotPaddingOptions:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"10",value:"10"}],shotPadding:"1"}},computed:{...k(["currentProduction","displayedEpisodes","displayedSequences","isTVShow"]),isAddEpisodeAllowed(){const t=this.names.episode==="",e=this.displayedEpisodes.find(n=>this.names.episode===n.name);return!t&&!e},isAddSequenceAllowed(){const t=this.names.sequence==="",e=this.displayedSequences.find(n=>this.names.sequence===n.name);return!t&&!e&&(this.selectedEpisodeId||!this.isTVShow)},isAddShotAllowed(){const t=this.names.shot==="",e=this.displayedShots.find(n=>this.names.shot===n.name);return!t&&!e&&this.selectedSequenceId},shots(){return w.cache.shots}},methods:{focusAddSequence(){this.$refs.addSequenceInput.focus()},focusAddShot(){this.$refs.addShotInput.focus()},selectEpisode(t){this.isTVShow?(this.selectedEpisodeId=t,this.$router.push({name:"episode-shots",params:{production_id:this.currentProduction.id,episode_id:t}})):(this.selectedEpisodeId=t,this.displayedShots=[])},selectSequence(t){this.selectedSequenceId=t,this.displayedShots=I(this.shots.filter(e=>e.sequence_id===t))},addEpisode(){if(this.isAddEpisodeAllowed&&this.names.episode.length>0){this.loading.addEpisode=!0;const e={name:this.names.episode,project_id:this.currentProduction.id};this.$emit("add-episode",e,n=>{this.loading.addEpisode=!1,this.selectEpisode(n.id),this.names.episode=q.generateNextName(n.name)})}},addSequence(){if(this.isAddSequenceAllowed&&this.names.sequence.length>0&&(this.selectedEpisodeId||!this.isTVShow)){this.loading.addSequence=!0;const e={name:this.names.sequence,episode_id:this.selectedEpisodeId,project_id:this.currentProduction.id};this.$emit("add-sequence",e,n=>{this.loading.addSequence=!1,this.selectEpisode(this.selectedEpisodeId),this.selectSequence(n.id),this.names.sequence=q.generateNextName(n.name)})}},addShot(){if(this.isAddShotAllowed&&!this.loading.addShot){const t=this.names.shot;if(this.loading.addShot=!0,t.length>0&&this.selectedSequenceId){const e={name:this.names.shot,sequence_id:this.selectedSequenceId,project_id:this.currentProduction.id};this.$emit("add-shot",e,n=>{this.loading.addShot=!1,this.selectSequence(this.selectedSequenceId),this.names.shot=q.generateNextName(n.name,parseInt(this.shotPadding))})}}}},watch:{active(){this.active&&(this.shotPadding="1",this.sequences=this.displayedSequences,this.isTVShow?this.selectEpisode(this.displayedEpisodes[0].id):this.sequences.length>0&&this.selectSequence(this.sequences[0].id),setTimeout(()=>{this.isTVShow?this.$refs.addEpisodeInput.focus():this.$refs.addSequenceInput.focus()},100))},selectedEpisodeId(){this.sequences=this.displayedSequences,this.sequences.length>0&&this.selectSequence(this.sequences[0].id)}}},x={class:"modal-content"},M={class:"box"},B={class:"explanation"},K={class:"flexrow"},U={class:"shot-columns"},j={key:0,class:"shot-column"},D={class:"subtitle"},O={class:"list"},F=["onClick"],z={class:"field"},G=["placeholder"],H=["disabled"],L={class:"shot-column"},Y={class:"subtitle"},J={class:"list"},Q=["onClick"],R={class:"field"},W=["placeholder"],X=["disabled"],Z={class:"shot-column"},$={class:"subtitle"},ee={class:"list"},se={class:"field"},te=["placeholder"],de={class:"field"},ie=["disabled"],oe={class:"has-text-right modal-footer"};function ne(t,e,n,le,o,i){const E=g("page-title"),y=g("combobox"),_=V("focus");return a(),c("div",{class:h({modal:!0,"is-active":n.active})},[d("div",{class:"modal-background",onClick:e[0]||(e[0]=s=>t.$emit("cancel"))}),d("div",x,[d("div",M,[v(E,{class:"title",text:t.$t("shots.manage")},null,8,["text"]),d("div",B,l(t.$t("shots.creation_explanation")),1),d("div",null,[d("div",K,[v(y,{ref:"shot-padding",label:t.$t("shots.padding"),options:o.shotPaddingOptions,class:"shot-padding flexrow-item",modelValue:o.shotPadding,"onUpdate:modelValue":e[1]||(e[1]=s=>o.shotPadding=s)},null,8,["label","options","modelValue"])])]),d("div",U,[t.isTVShow?(a(),c("div",j,[d("h2",D,l(t.$t("shots.episodes")),1),d("div",O,[(a(!0),c(p,null,m(t.displayedEpisodes,s=>(a(),c("div",{class:h({"entity-line":!0,selected:s.id===o.selectedEpisodeId}),key:s.id,onClick:r=>i.selectEpisode(s.id)},l(s.name),11,F))),128))]),d("div",z,[S(d("input",{class:"input",ref:"addEpisodeInput",placeholder:t.$t("episodes.fields.placeholder"),type:"text",onKeyup:[e[2]||(e[2]=u((...s)=>i.focusAddSequence&&i.focusAddSequence(...s),["tab"])),e[3]||(e[3]=u((...s)=>i.addEpisode&&i.addEpisode(...s),["enter"]))],"onUpdate:modelValue":e[4]||(e[4]=s=>o.names.episode=s)},null,40,G),[[f,o.names.episode],[_]]),d("button",{class:h({button:!0,"is-success":!0,"is-loading":o.loading.addEpisode}),disabled:!i.isAddEpisodeAllowed,onClick:e[5]||(e[5]=(...s)=>i.addEpisode&&i.addEpisode(...s))},l(t.$t("main.add")),11,H)])])):N("",!0),d("div",L,[d("h2",Y,l(t.$t("shots.sequences")),1),d("div",J,[(a(!0),c(p,null,m(t.displayedSequences,s=>(a(),c("div",{class:h({"entity-line":!0,selected:s.id===o.selectedSequenceId}),key:s.id,onKeyup:e[6]||(e[6]=u((...r)=>i.focusAddShot&&i.focusAddShot(...r),["tab"])),onClick:r=>i.selectSequence(s.id)},l(s.name),43,Q))),128))]),d("div",R,[S(d("input",{class:"input",ref:"addSequenceInput",placeholder:t.$t("sequences.fields.placeholder"),type:"text",onKeyup:e[7]||(e[7]=u((...s)=>i.addSequence&&i.addSequence(...s),["enter"])),"onUpdate:modelValue":e[8]||(e[8]=s=>o.names.sequence=s)},null,40,W),[[f,o.names.sequence]]),d("button",{class:h({button:!0,"is-success":!0,"is-loading":o.loading.addSequence}),disabled:!i.isAddSequenceAllowed,onClick:e[9]||(e[9]=(...s)=>i.addSequence&&i.addSequence(...s))},l(t.$t("main.add")),11,X)])]),d("div",Z,[d("h2",$,l(t.$t("shots.title")),1),d("div",ee,[(a(!0),c(p,null,m(o.displayedShots,s=>(a(),c("div",{class:"entity-line",key:s.id},l(s.name),1))),128))]),d("div",se,[S(d("input",{class:"input",placeholder:t.$t("shots.fields.placeholder"),ref:"addShotInput",type:"text",onKeyup:e[10]||(e[10]=u((...s)=>i.addShot&&i.addShot(...s),["enter"])),"onUpdate:modelValue":e[11]||(e[11]=s=>o.names.shot=s)},null,40,te),[[f,o.names.shot]])]),d("div",de,[d("button",{class:h({button:!0,"is-success":!0,"is-loading":o.loading.addShot}),disabled:!i.isAddShotAllowed||o.loading.addShot,onClick:e[12]||(e[12]=(...s)=>i.addShot&&i.addShot(...s))},l(t.$t("main.add")),11,ie)])])]),d("p",oe,[d("button",{onClick:e[13]||(e[13]=s=>t.$emit("cancel")),class:"button is-link"},l(t.$t("main.close")),1)])])])],2)}const re=b(T,[["render",ne],["__scopeId","data-v-7d964502"]]);export{re as M};
//# sourceMappingURL=ManageShotsModal-BoSiVa0q.js.map
