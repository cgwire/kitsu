(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6add4672"],{"129d":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"columns fixed-page"},[a("div",{staticClass:"column main-column"},[a("div",{staticClass:"timesheets page"},[a("div",{staticClass:"page-header flexrow"},[a("page-title",{staticClass:"flexrow-item",attrs:{text:e.$t("timesheets.title")}}),a("combobox",{staticClass:"flexrow-item",attrs:{label:e.$t("timesheets.detail_level"),options:e.detailOptions},model:{value:e.detailLevelString,callback:function(t){e.detailLevelString=t},expression:"detailLevelString"}}),"year"!==e.detailLevelString?a("combobox",{staticClass:"flexrow-item",attrs:{label:e.$t("timesheets.year"),options:e.yearOptions},model:{value:e.yearString,callback:function(t){e.yearString=t},expression:"yearString"}}):e._e(),"day"===e.detailLevelString?a("combobox",{staticClass:"flexrow-item",attrs:{label:e.$t("timesheets.month"),options:e.monthOptions},model:{value:e.monthString,callback:function(t){e.monthString=t},expression:"monthString"}}):e._e(),a("div",{staticClass:"filler"}),a("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("timesheets.export_timesheet"),icon:"download"},on:{click:e.exportTimesheet}})],1),a("people-timesheet-list",{staticClass:"data-list",attrs:{people:e.filteredPeople,timesheet:e.timesheet,"detail-level":e.detailLevel,month:e.currentMonth,year:e.currentYear,"is-loading":e.isLoading,"is-error":e.isLoadingError}})],1)]),e.showInfo?a("div",{staticClass:"column side-column"},[a("people-timesheet-info",{attrs:{person:e.currentPerson,year:e.currentYear,month:e.currentMonth,week:e.currentWeek,day:e.currentDay,"is-loading":e.isInfoLoading,"is-loading-error":e.isInfoLoadingError,tasks:e.tasks},on:{close:e.hideSideInfo}})],1):e._e()])},n=[],r=(a("4de4"),a("c975"),a("a15b"),a("d81d"),a("a9e3"),a("b64b"),a("5530")),i=a("7f45"),o=a.n(i),c=a("2f62"),l=a("de40"),d=a("992f"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"data-list"},[a("div",{ref:"body",staticClass:"datatable-wrapper"},[a("table",{staticClass:"datatable"},[a("thead",{staticClass:"datatable-head"},[a("tr",[a("th",{staticClass:"name datatable-row-header",attrs:{scope:"col"}},[e._v(" "+e._s(e.$t("people.list.name"))+" ")]),e._l(e.yearRange,(function(t){return"year"===e.detailLevel?a("th",{key:"year-"+t,staticClass:"time year",attrs:{scope:"col"}},[e._v(" "+e._s(t)+" ")]):e._e()})),e._l(e.monthRange,(function(t){return"month"===e.detailLevel?a("th",{key:"month-"+t,staticClass:"time month",attrs:{scope:"col"}},[e._v(" "+e._s(e.monthToString(t))+" ")]):e._e()})),e._l(e.weekRange,(function(t){return"week"===e.detailLevel?a("th",{key:"week-"+t,staticClass:"daytime",attrs:{scope:"col",title:e.getWeekTitle(t)}},[e._v(" "+e._s(t)+" ")]):e._e()})),e._l(e.dayRange,(function(t){return"day"===e.detailLevel?a("th",{key:"day-"+t,staticClass:"daytime",attrs:{scope:"col"}},[e._v(" "+e._s(t)+" ")]):e._e()})),a("th",{staticClass:"actions",attrs:{scope:"col"}})],2)]),e.isLoading?e._e():a("tbody",{staticClass:"datatable-body"},e._l(e.people,(function(t){return a("tr",{key:t.id,staticClass:"datatable-row"},[a("people-name-cell",{staticClass:"name",attrs:{person:t}}),e._l(e.yearRange,(function(s){return"year"===e.detailLevel?a("td",{key:"year-"+s+"-"+t.id,class:{time:!0,year:!0,selected:e.isYearSelected(t.id,s)}},[e.yearDuration(s,t.id)>0?a("router-link",{staticClass:"duration",attrs:{to:{name:"timesheets-year-person",params:{person_id:t.id,year:s}}}},[e._v(" "+e._s(e.yearDuration(s,t.id))+" ")]):a("span",[e._v(" - ")])],1):e._e()})),e._l(e.monthRange,(function(s){return"month"===e.detailLevel?a("td",{key:"month-"+s+"-"+t.id,class:{time:!0,month:!0,selected:e.isMonthSelected(t.id,e.year,s)}},[e.monthDuration(s,t.id)>0?a("router-link",{staticClass:"duration",attrs:{to:{name:"timesheets-month-person",params:{person_id:t.id,year:e.year,month:s}}}},[e._v(" "+e._s(e.monthDuration(s,t.id))+" ")]):a("span",[e._v(" - ")])],1):e._e()})),e._l(e.weekRange,(function(s){return"week"===e.detailLevel?a("td",{key:"week-"+s+"-"+t.id,class:{daytime:!0,selected:e.isWeekSelected(t.id,e.year,s)}},[e.weekDuration(s,t.id)>0?a("router-link",{class:{duration:!0,warning:e.weekDuration(s,t.id)>5*e.organisation.hours_by_day},attrs:{to:{name:"timesheets-week-person",params:{person_id:t.id,year:e.year,week:s}}}},[e._v(" "+e._s(e.weekDuration(s,t.id))+" ")]):a("span",[e._v(" - ")])],1):e._e()})),e._l(e.dayRange,(function(s){return"day"===e.detailLevel?a("td",{key:"day-"+s+"-"+t.id,staticClass:"daytime",class:{daytime:!0,weekend:e.isWeekend(e.year,e.month,s),selected:e.isDaySelected(t.id,e.year,e.month,s)}},[e.dayDuration(s,t.id)>0?a("router-link",{staticClass:"duration",attrs:{to:{name:"timesheets-day-person",params:{person_id:t.id,year:e.year,month:e.month,day:s}}}},[e._v(" "+e._s(e.dayDuration(s,t.id))+" ")]):a("span",[e._v(" - ")])],1):e._e()})),a("td",{staticClass:"actions"})],2)})),0)])]),a("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isError}}),e.isLoading?e._e():a("p",{staticClass:"has-text-centered footer-info"},[e._v(" "+e._s(e.people.length)+" "+e._s(e.$tc("people.persons",e.people.length))+" ")])],1)},h=[],m=(a("99af"),a("caad"),a("3657")),p=a("7365"),f=a("e60b"),y={name:"people-timesheet-list",components:{PeopleNameCell:p["a"],TableInfo:f["a"]},data:function(){return{currentMonth:o()().month()+1,currentYear:o()().year(),currentWeek:o()().week()}},props:{timesheet:{type:Object,default:function(){}},people:{type:Array,default:function(){return[]}},detailLevel:{type:String,default:"day"},year:{type:Number,default:0},month:{type:Number,default:0},isLoading:{type:Boolean,default:!1},isError:{type:Boolean,default:!1}},computed:Object(r["a"])(Object(r["a"])({},Object(c["c"])(["isCurrentUserManager","organisation","route"])),{},{yearRange:function(){return Object(m["q"])(2018,o()().year())},monthRange:function(){return Object(m["k"])(this.year,this.currentYear,this.currentMonth)},dayRange:function(){return Object(m["g"])(this.year,this.month,this.currentYear,this.currentMonth)},weekRange:function(){return Object(m["m"])(this.year,this.currentYear,this.currentWeek)}}),methods:Object(r["a"])(Object(r["a"])({},Object(c["b"])([])),{},{monthToString:m["o"],yearDuration:function(e,t){var a="".concat(e);return this.getDuration(a,t)},monthDuration:function(e,t){var a="".concat(e);return this.getDuration(a,t)},weekDuration:function(e,t){return this.getDuration(e,t)},dayDuration:function(e,t){return this.getDuration(e,t)},getDuration:function(e,t){return this.timesheet&&this.timesheet[e]&&this.timesheet[e][t]?this.timesheet[e][t]/60:"-"},isWeekend:function(e,t,a){var s=o()("".concat(e,"-").concat(t,"-").concat(a));return a<10&&(s=o()("".concat(e,"-").concat(t,"-0").concat(a))),[0,6].includes(s.day())},isDaySelected:function(e,t,a,s){return this.$route.params.person_id&&this.$route.params.person_id===e&&this.$route.params.year===t&&this.$route.params.month===a&&this.$route.params.day===s},isWeekSelected:function(e,t,a){return this.$route.params.person_id&&this.$route.params.person_id===e&&this.$route.params.year===t&&this.$route.params.week===a},isMonthSelected:function(e,t,a){return this.$route.params.person_id&&this.$route.params.person_id===e&&this.$route.params.year===t&&this.$route.params.month===a},isYearSelected:function(e,t){return this.$route.params.person_id&&this.$route.params.person_id===e&&this.$route.params.year===t},getWeekTitle:function(e){var t=o()(this.currentYear+"-"+e,"YYYY-W"),a=t.clone().add(6,"days");return t.format("YYYY-MM-DD")+" - "+a.format("YYYY-MM-DD")}}),watch:{route:function(){var e=document.getElementsByClassName("selected");0===e.length&&(this.$refs.body.scrollLeft+=350)}}},b=y,g=(a("e232"),a("2877")),v=Object(g["a"])(b,u,h,!1,null,"7dd40480",null),_=v.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"people-timesheet-info"},[a("div",{staticClass:"close"},[a("router-link",{staticClass:"close-button",attrs:{to:e.closeRoute}},[a("x-icon")],1)],1),a("div",{staticClass:"flexrow"},[a("people-avatar",{staticClass:"flexrow-item",attrs:{person:e.person,"no-cache":!0}}),a("page-title",{staticClass:"flexrow-item",attrs:{text:e.person.full_name}})],1),e.isMonthInfo?a("div",{staticClass:"info-date"},[e._v(" "+e._s(e.monthString)+" "+e._s(e.year)+" ")]):e.isWeekInfo?a("div",{staticClass:"info-date"},[e._v(" week "+e._s(e.week)+", "+e._s(e.startDay)+" - "+e._s(e.endDay)+" "+e._s(e.weekMonth)+" "+e._s(e.year)+" ")]):e.isDayInfo?a("div",{staticClass:"info-date"},[e._v(" "+e._s(e.day)+" "+e._s(e.monthString)+" "+e._s(e.year)+" ")]):e._e(),a("time-spent-task-list",{staticClass:"time-spent-list",attrs:{tasks:e.tasks,"is-loading":e.isLoading,"is-error":e.isLoadingError}})],1)},w=[],L=a("0a35"),j=a("8d07"),C=a("eb8c"),O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"data-list"},[a("table-info",{attrs:{"is-loading":e.isLoading,"is-error":e.isLoadingError}}),a("div",{staticClass:"aggregated-time-spents"},e._l(Object.keys(e.projects),(function(t){return a("div",{key:t,staticClass:"by-project"},[e.projectNames[t]?a("production-name",{attrs:{project:{id:t,name:e.projectNames[t]}}}):e._e(),e._l(Object.keys(e.projects[t]),(function(s){return a("div",{key:s,staticClass:"by-task-type-id"},[a("task-type-name",{attrs:{"task-type":e.taskTypeMap[s]}}),a("div",{staticClass:"table-body"},[a("table",{staticClass:"datatable"},[a("tbody",{staticClass:"datatable-body"},e._l(e.projects[t][s],(function(t){return a("tr",{key:t.id,staticClass:"by-task-type-id datatable-row"},[a("td",{staticClass:"name"},[e._v(e._s(t.name))]),a("td",{staticClass:"duration"},[e._v(e._s(t.duration/60))])])})),0)])])],1)}))],2)})),0)],1)},S=[],$=(a("4160"),a("13d5"),a("159b"),a("4736")),M=a("274f"),x=a("2229"),D={name:"timespent-task-list",components:{TableInfo:f["a"],ProductionName:$["a"],TaskTypeName:M["a"]},data:function(){return{projectNames:{}}},props:{tasks:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1}},computed:Object(r["a"])(Object(r["a"])({},Object(c["c"])(["currentProduction","lastProductionScreen","taskTypeMap"])),{},{projects:function(){var e={};return this.tasks.forEach((function(t){e[t.project_id]||(e[t.project_id]={}),e[t.project_id][t.task_type_id]||(e[t.project_id][t.task_type_id]=[]);var a=t.entity_name;["Shot","Sequence"].includes(t.entity_type_name)?(a="".concat(t.sequence_name," / ").concat(a),t.episode_name&&(a="".concat(t.episode_name," / ").concat(a))):a="".concat(t.entity_type_name," / ").concat(a),e[t.project_id][t.task_type_id].push({id:t.id,name:a,duration:t.duration})})),Object.keys(e).forEach((function(t){Object.keys(e[t]).forEach((function(a){e[t][a]=Object(x["d"])(e[t][a])}))})),e}}),methods:Object(r["a"])(Object(r["a"])({},Object(c["b"])([])),{},{onBodyScroll:function(e,t){this.$refs.headerWrapper.style.left="-".concat(t.scrollLeft,"px")}}),watch:{tasks:function(){this.projectNames=this.tasks.reduce((function(e,t){return e[t.project_id]=t.project_name,e}),{})}}},Y=D,I=(a("47a3"),Object(g["a"])(Y,O,S,!1,null,"784edeaa",null)),T=I.exports,P={name:"people-timesheet-info",components:{XIcon:L["cb"],PageTitle:j["a"],PeopleAvatar:C["a"],TimeSpentTaskList:T},props:{person:{type:Object,default:function(){}},year:{type:Number,default:0},month:{type:Number,default:0},week:{type:Number,default:0},day:{type:Number,default:0},isLoading:{type:Boolean,default:!1},isLoadingError:{type:Boolean,default:!1},tasks:{type:Array,default:function(){return[]}}},computed:Object(r["a"])(Object(r["a"])({},Object(c["c"])([])),{},{startDay:function(){return o()().day("Monday").year(this.year).week(this.week).date()},endDay:function(){return o()().day("Monday").year(this.year).week(this.week).add("days",6).date()},weekMonth:function(){return o()().day("Monday").year(this.year).week(this.week).format("MMM")},monthString:function(){return Object(m["o"])(this.month)},isMonthInfo:function(){return this.$route.path.indexOf("month")>0},isWeekInfo:function(){return this.$route.path.indexOf("week")>0},isDayInfo:function(){return this.$route.path.indexOf("day")>0},closeRoute:function(){return this.isMonthInfo?{name:"timesheets-month",params:{year:this.year}}:this.isWeekInfo?{name:"timesheets-week",params:{year:this.year}}:this.isDayInfo?{name:"timesheets-day",params:{year:this.year,month:this.month}}:{name:"timesheets"}}}),methods:Object(r["a"])(Object(r["a"])({},Object(c["b"])([])),{},{onCloseClicked:function(){this.$emit("close")}})},N=P,E=(a("aaf8"),Object(g["a"])(N,k,w,!1,null,"1827c700",null)),R=E.exports,W=a("3455"),A=a("8c97"),B={name:"people",components:{ButtonSimple:l["a"],Combobox:d["a"],PageTitle:j["a"],PeopleTimesheetList:_,PeopleTimesheetInfo:R},data:function(){return{detailOptions:[{label:"Day",value:"day"},{label:"Week",value:"week"},{label:"Month",value:"month"},{label:"Year",value:"year"}],detailLevelString:"day",detailLevel:"day",yearString:"".concat(o()().year()),monthString:"".concat(o()().month()+1),currentYear:o()().year(),currentMonth:o()().month()+1,currentWeek:o()().week(),currentDay:o()().date(),currentPerson:this.getCurrentPerson(),isLoading:!1,isLoadingError:!1,showInfo:!0,isInfoLoading:!1,isInfoLoadingError:!1,tasks:[]}},created:function(){var e=this;this.isLoading=!0,0===this.people.length?this.loadPeople((function(){e.loadRoute()})):this.loadRoute()},computed:Object(r["a"])(Object(r["a"])({},Object(c["c"])(["isCurrentUserManager","people","personMap","timesheet"])),{},{filteredPeople:function(){var e=this;return this.people.filter((function(t){var a=Object.keys(e.timesheet),s=!1,n=0;do{e.timesheet[a[n]]&&(s=void 0!==e.timesheet[a[n]][t.id]),n++}while(!s&&n<a.length);return t.active&&s}))},yearOptions:function(){var e=2018,t=o()().year();return Object(m["q"])(e,t).map((function(e){return{label:e,value:"".concat(e)}}))},monthOptions:function(){var e="".concat(o()().year()),t=1,a=o()().month()+1,s=Object(m["q"])(t,12);return e===this.yearString&&(s=Object(m["q"])(t,a)),s.map((function(e){return{label:Object(m["o"])(e),value:"".concat(e)}}))}}),methods:Object(r["a"])(Object(r["a"])({},Object(c["b"])(["loadPeople","loadAggregatedPersonTimeSpents","loadTimesheets"])),{},{reloadTimesheet:function(){var e=this;this.isLoading=!0,this.loadTimesheets({detailLevel:this.detailLevel,year:this.currentYear,month:this.currentMonth}).then((function(t){e.isLoading=!1})).catch((function(){e.isLoading=!1,e.isLoadingError=!0}))},showSideInfo:function(){this.showInfo=!0},hideSideInfo:function(){this.showInfo=!1},loadRoute:function(){var e=this.$route.params,t=e.month,a=e.year,s=e.week,n=e.day,r="".concat(this.detailLevel),i="".concat(this.currentMonth),o="".concat(this.currentYear);this.$route.path.indexOf("week")>0&&(this.detailLevel="week"),this.$route.path.indexOf("month")>0&&(this.detailLevel="month"),this.$route.path.indexOf("day")>0&&(this.detailLevel="day"),this.$route.path.indexOf("year")>0&&(this.detailLevel="year"),this.currentPerson=this.getCurrentPerson(),this.detailLevelString=this.detailLevel,t&&(this.currentMonth=Number(t),this.monthString="".concat(t)),a&&(this.currentYear=Number(a),this.yearString="".concat(a)),s&&(this.currentWeek=Number(s),this.weekString="".concat(s)),n&&(this.currentDay=Number(n));var c=r!==this.detailLevel,l=0!==i.localeCompare("".concat(this.currentMonth)),d=0!==o.localeCompare("".concat(this.currentYear));this.$route.path.indexOf("person")>0?(this.showSideInfo(),this.loadAggregate(),this.isLoading&&this.reloadTimesheet()):(this.hideSideInfo(),(this.isLoading||l||d||c)&&this.reloadTimesheet())},loadAggregate:function(){var e=this;this.isInfoLoading=!0,this.isInfoLoadingError=!1,this.tasks=[],this.loadAggregatedPersonTimeSpents({personId:this.$route.params.person_id,detailLevel:this.detailLevel,year:this.$route.params.year,month:this.$route.params.month,week:this.$route.params.week,day:this.$route.params.day}).then((function(t){e.isInfoLoading=!1,e.tasks=t.filter((function(e){return e.duration>0}))})).catch((function(t){console.error(t),e.isInfoLoadingError=!0}))},getCurrentPerson:function(){var e=this.$route.params.person_id;return e&&this.personMap?this.personMap[e]:{}},exportTimesheet:function(){var e=["timesheet",this.detailLevel,this.currentYear];"day"===this.detailLevel&&e.push(this.currentMonth);var t=A["a"].slugify(e.join("_"));W["a"].generateTimesheet(t,this.timesheet,this.filteredPeople,this.detailLevel,this.currentYear,this.currentMonth,o()().month()+1,o()().year(),o()().week())}}),watch:{detailLevelString:function(){this.detailLevel!==this.detailLevelString&&("month"===this.detailLevelString?this.$router.push({name:"timesheets-month",params:{year:this.currentYear}}):"week"===this.detailLevelString?this.$router.push({name:"timesheets-week",params:{year:this.currentYear}}):"day"===this.detailLevelString?this.$router.push({name:"timesheets-day",params:{year:this.currentYear,month:this.currentMonth}}):"year"===this.detailLevelString&&this.$router.push({name:"timesheets-year",params:{year:this.currentYear}}))},yearString:function(){var e=Number(this.yearString),t=o()().month();this.currentYear!==e&&("month"===this.detailLevel?this.$router.push({name:"timesheets-month",params:{year:e}}):"week"===this.detailLevel?this.$router.push({name:"timesheets-week",params:{year:e}}):this.$router.push({name:"timesheets-day",params:{year:e,month:Math.min(Number(this.monthString),t)}}))},monthString:function(){this.currentMonth!==Number(this.monthString)&&this.$router.push({name:"timesheets-day",params:{year:this.currentYear,month:Number(this.monthString)}})},$route:function(){this.loadRoute()}},metaInfo:function(){return{title:"".concat(this.$t("timesheets.title")," - Kitsu")}}},q=B,J=(a("71fe"),Object(g["a"])(q,s,n,!1,null,"7170a309",null));t["default"]=J.exports},"47a3":function(e,t,a){"use strict";var s=a("e9b7"),n=a.n(s);n.a},"71fe":function(e,t,a){"use strict";var s=a("d5b5"),n=a.n(s);n.a},7365:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("th",{staticClass:"name datatable-row-header",attrs:{scope:"row"}},[a("div",{staticClass:"people-name"},[a("people-avatar",{staticClass:"avatar",attrs:{person:e.person}}),a("people-name",{staticClass:"people-name",attrs:{person:e.person}})],1)])},n=[],r=a("5530"),i=a("2f62"),o=a("eb8c"),c=a("0073"),l={name:"people-name-cell",components:{PeopleName:c["a"],PeopleAvatar:o["a"]},props:{person:{type:Object,required:!0}},computed:Object(r["a"])({},Object(i["c"])([])),methods:Object(r["a"])({},Object(i["b"])([]))},d=l,u=(a("bba7"),a("2877")),h=Object(u["a"])(d,s,n,!1,null,"564d8b18",null);t["a"]=h.exports},8666:function(e,t,a){},aaf8:function(e,t,a){"use strict";var s=a("f16f"),n=a.n(s);n.a},bba7:function(e,t,a){"use strict";var s=a("8666"),n=a.n(s);n.a},d5b5:function(e,t,a){},e232:function(e,t,a){"use strict";var s=a("fcaf"),n=a.n(s);n.a},e9b7:function(e,t,a){},f16f:function(e,t,a){},fcaf:function(e,t,a){}}]);
//# sourceMappingURL=chunk-6add4672.77a69cee.js.map