(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-875ed646"],{"24b2":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"columns fixed-page edit"},[i("div",{staticClass:"column main-column"},[i("div",{ref:"page-header-row",staticClass:"page-header flexrow flexrow-item"},[i("div",{staticClass:"flexrow block mb0 main-block"},[i("router-link",{staticClass:"flexrow-item has-text-centered back-link",attrs:{to:t.editsPath}},[i("corner-left-up-icon")],1),i("span",{staticClass:"flexrow-item"},[t.currentEntity?i("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:t.currentEntity,"empty-height":60,"empty-width":100,height:60,width:100}}):t._e()],1),i("div",{staticClass:"flexrow-item"},[i("page-title",{staticClass:"entity-title",attrs:{text:t.title}})],1),!t.isLoading&&t.currentEntity?i("div",{key:t.currentEntity.id,staticClass:"flexrow-item has-text-centered"},[i("previews-per-task-type",{ref:"previews-per-task-type",attrs:{entity:t.currentEntity,"entity-map":t.editMap},on:{"preview-changed":t.onPreviewChanged}})],1):t._e()],1),i("div",{staticClass:"filler"}),i("div",{staticClass:"flexrow-item block mt0"},[t.currentEdit&&t.isValidRoomId(t.currentEdit.id)&&t.currentPreview&&t.currentPreview.id?i("preview-room",{ref:t.previewRoomRef,attrs:{roomId:t.currentEdit&&t.isValidRoomId(t.currentEdit.id)?t.currentEdit.id:"",joinRoom:t.joinRoom,leaveRoom:t.leaveRoom}}):t._e()],1)]),i("div",{ref:"container",staticClass:"edit player block"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"flexrow filler"},[i("div",{ref:"video-container",staticClass:"flexrow filler video-container"},[i("raw-video-player",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentPreviewMovie&&!t.isLoading,expression:"isCurrentPreviewMovie && !isLoading"}],ref:"raw-player",staticClass:"raw-player",style:{position:"static",opacity:t.overlayOpacity},attrs:{entities:t.entityList,"full-screen":t.fullScreen,"is-hd":t.isHd,"is-repeating":t.isRepeating,"current-preview-index":t.currentPreviewIndex,muted:t.isMuted},on:{"max-duration-update":t.onMaxDurationUpdate,"metadata-loaded":t.onMetadataLoaded,repeat:t.onVideoRepeated,"frame-update":t.onFrameUpdate}}),t.isCurrentPreviewModel&&!t.isLoading?i("object-viewer",{ref:"object-player",staticClass:"object-player",style:{position:"static",opacity:t.overlayOpacity},attrs:{"preview-url":t.currentPreviewDlPath,"full-screen":t.fullScreen}}):t._e(),t.isCurrentPreviewSound&&!t.isLoading?i("sound-viewer",{ref:"sound-player",staticClass:"sound-player",attrs:{"preview-url":t.currentPreviewDlPath,"full-screen":t.fullScreen},on:{"play-ended":t.pause}}):t._e(),i("p",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentPreviewFile&&!t.isLoading,expression:"isCurrentPreviewFile && !isLoading"}],staticClass:"preview-standard-file has-text-centered",style:{width:"100%"}},[t.extension&&t.extension.length>0?i("a",{ref:"preview-file",staticClass:"button",attrs:{href:t.currentPreviewDlPath}},[i("download-icon",{staticClass:"icon"}),i("span",{staticClass:"text"},[t._v(" "+t._s(t.$t("tasks.download_pdf_file",{extension:t.extension}))+" ")])],1):t._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentPreviewPicture&&!t.isLoading,expression:"isCurrentPreviewPicture && !isLoading"}],ref:"picture-player-wrapper",staticClass:"picture-preview-wrapper flexrow",style:{position:"static",opacity:t.overlayOpacity,left:0,right:0}},[i("img",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentPreviewPicture,expression:"isCurrentPreviewPicture"}],ref:"picture-player",staticClass:"picture-preview",attrs:{id:"picture-player",src:t.isCurrentPreviewPicture?t.currentPreviewPath:null}})]),t.isLoading?i("div",{staticClass:"loading-wrapper"},[i("spinner")],1):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isCurrentPreviewFile,expression:"!isCurrentPreviewFile"}],ref:"canvas-wrapper",staticClass:"canvas-wrapper",attrs:{oncontextmenu:"return false;"}},[i("canvas",{ref:"annotation-canvas",staticClass:"canvas",attrs:{id:"edit-annotation-canvas"}})])],1),i("task-info",{ref:"task-info",class:{"flexrow-item":!0,"task-info-column":!0,hidden:t.isCommentsHidden},attrs:{task:t.task,"is-preview":!1,silent:t.isCommentsHidden,"current-time-raw":t.currentTimeRaw-t.frameDuration,"current-parent-preview":t.currentPreview},on:{"time-code-clicked":t.onTimeCodeClicked}})],1),i("video-progress",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentPreviewMovie&&t.currentPreview.id,expression:"isCurrentPreviewMovie && currentPreview.id"}],ref:"video-progress",staticClass:"video-progress pull-bottom",attrs:{annotations:t.annotations,"frame-duration":t.frameDuration,"nb-frames":t.nbFrames,"handle-in":-1,"handle-out":-1},on:{"start-scrub":t.onScrubStart,"end-scrub":t.onScrubEnd,"progress-changed":t.onProgressChanged}}),t.currentEntity&&t.currentEntity.id?i("div",{ref:"button-bar",staticClass:"player-footer flexrow"},[t.isCurrentPreviewMovie||t.isCurrentPreviewPicture||t.isCurrentPreviewSound?i("div",{staticClass:"flexrow flexrow-item mr0"},[t.isPlaying?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.pause"),icon:"pause"},on:{click:t.pauseClicked}}):i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.play"),icon:"play"},on:{click:t.playClicked}})],1):t._e(),i("div",{staticClass:"separator"}),t.isCurrentPreviewPicture?[t._v(" "+t._s(t.framesSeenOfPicture)+" / "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.framesPerImage[t.playingEntityIndex],expression:"framesPerImage[playingEntityIndex]"}],staticClass:"frame-per-image-input",attrs:{type:"number",min:"0",title:t.$t("playlists.actions.frames_per_picture")},domProps:{value:t.framesPerImage[t.playingEntityIndex]},on:{input:function(e){e.target.composing||t.$set(t.framesPerImage,t.playingEntityIndex,e.target.value)}}})]:t._e(),t.isCurrentPreviewPicture?i("div",{staticClass:"separator"}):t._e(),t.currentEntityPreviewLength>1?i("div",{staticClass:"flexrow flexrow-item"},[i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{icon:"left",title:t.$t("playlists.actions.files_previous"),disabled:t.isPlaying},on:{click:t.onPreviousPreviewClicked}}),i("span",{staticClass:"ml05 mr05",attrs:{title:t.$t("playlists.actions.files_position")}},[t._v(" "+t._s(t.currentPreviewIndex+1)+" / "+t._s(t.currentEntityPreviewLength)+" ")]),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{icon:"right",title:t.$t("playlists.actions.files_next"),disabled:t.isPlaying},on:{click:t.onNextPreviewClicked}}),i("a",{staticClass:"button player-button flexrow-item",attrs:{href:t.currentPreviewPath,title:t.$t("playlists.actions.see_original_file"),target:"blank"}},[i("arrow-up-right-icon",{staticClass:"icon is-small"})],1)],1):t._e(),t.isCurrentPreviewMovie?i("div",{staticClass:"flexrow flexrow-item"},[3===t.speed?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.speed"),text:"x1.00"},on:{click:t.onSpeedClicked}}):2===t.speed?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.speed"),text:"x0.50"},on:{click:t.onSpeedClicked}}):i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.speed"),text:"x0.25"},on:{click:t.onSpeedClicked}}),t.isMuted?i("button-simple",{staticClass:"flexrow-item player-button",attrs:{title:t.$t("playlists.actions.unmute"),icon:"soundoff"},on:{click:t.onToggleSoundClicked}}):i("button-simple",{staticClass:"flexrow-item player-button",attrs:{title:t.$t("playlists.actions.mute"),icon:"soundon"},on:{click:t.onToggleSoundClicked}}),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{active:t.isRepeating,title:t.$t("playlists.actions.looping"),icon:"repeat"},on:{click:t.onRepeatClicked}}),i("span",{staticClass:"flexrow-item time-indicator",attrs:{title:t.$t("playlists.actions.current_time")}},[t._v(" "+t._s(t.currentTime)+" ")]),i("span",{staticClass:"flexrow-item time-indicator"},[t._v(" / ")]),i("span",{staticClass:"flexrow-item time-indicator",attrs:{title:t.$t("playlists.actions.max_duration")}},[t._v(" "+t._s(t.maxDuration)+" ")]),i("span",{staticClass:"flexrow-item time-indicator mr1",attrs:{title:t.$t("playlists.actions.frame_number")}},[t._v(" ("+t._s(t.currentFrame)+" / "+t._s((t.nbFrames+"").padStart(3,"0"))+") ")]),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.previous_frame"),icon:"left"},on:{click:t.onPreviousFrameClicked}}),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.next_frame"),icon:"right"},on:{click:t.onNextFrameClicked}})],1):t._e(),i("span",{staticClass:"filler"}),t.isCurrentUserArtist||!t.isCurrentPreviewMovie&&!t.isCurrentPreviewPicture?t._e():i("div",{staticClass:"flexrow"},[i("button-simple",{staticClass:"player-button flexrow-item",attrs:{icon:"undo",title:t.$t("playlists.actions.annotation_undo")},on:{click:t.undoLastAction}}),i("button-simple",{staticClass:"player-button flexrow-item",attrs:{title:t.$t("playlists.actions.annotation_redo"),icon:"redo"},on:{click:t.redoLastAction}}),i("transition",{attrs:{name:"slide"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isTyping,expression:"isTyping"}],staticClass:"annotation-tools"},[i("color-picker",{attrs:{isOpen:t.isShowingPalette,color:this.textColor},on:{TogglePalette:t.onPickColor,change:t.onChangeTextColor}})],1)]),i("button-simple",{class:{"player-button":!0,"flexrow-item":!0,active:t.isTyping},attrs:{title:t.$t("playlists.actions.annotation_text"),icon:"type"},on:{click:t.onTypeClicked}}),i("transition",{attrs:{name:"slide"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isDrawing,expression:"isDrawing"}],staticClass:"annotation-tools"},[i("pencil-picker",{attrs:{isOpen:t.isShowingPencilPalette,pencil:t.pencil,sizes:this.pencilPalette},on:{"toggle-palette":t.onPickPencil,change:t.onChangePencil}}),i("color-picker",{attrs:{isOpen:t.isShowingPalette,color:this.color},on:{TogglePalette:t.onPickColor,change:t.onChangeColor}})],1)]),i("button-simple",{class:{"player-button":!0,"flexrow-item":!0,active:t.isDrawing},attrs:{title:t.$t("playlists.actions.annotation_draw"),icon:"pencil"},on:{click:t.onAnnotateClicked}}),i("button-simple",{staticClass:"player-button flexrow-item",attrs:{icon:"remove",title:t.$t("playlists.actions.annotation_delete")},on:{click:t.onDeleteClicked}})],1),i("div",{staticClass:"separator"}),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.comments"),icon:"comment"},on:{click:t.onCommentClicked}}),t.isCurrentPreviewMovie?i("button-simple",{staticClass:"player-button flexrow-item",attrs:{title:t.$t("playlists.actions."+(t.isHd?"switch_ld":"switch_hd")),text:t.isHd?"HD":"LD"},on:{click:function(e){t.isHd=!t.isHd}}}):t._e(),t.isFullScreenEnabled?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:t.$t("playlists.actions.fullscreen"),icon:"maximize"},on:{click:t.onFullscreenClicked}}):t._e()],2):t._e()],1),i("div",{staticClass:"edit-data block"},[i("div",{staticClass:"flexrow"},[i("combobox-styled",{staticClass:"section-combo flexrow-item",attrs:{options:t.entityNavOptions},model:{value:t.currentSection,callback:function(e){t.currentSection=e},expression:"currentSection"}}),i("div",{staticClass:"filler"}),i("span",{directives:[{name:"show",rawName:"v-show",value:"schedule"===t.currentSection,expression:"currentSection === 'schedule'"}],staticClass:"flexrow-item mt05"},[t._v(" "+t._s(t.$t("schedule.zoom_level"))+": ")]),i("combobox-number",{directives:[{name:"show",rawName:"v-show",value:"schedule"===t.currentSection,expression:"currentSection === 'schedule'"}],staticClass:"zoom-level flexrow-item ",attrs:{options:t.zoomOptions,"is-simple":""},model:{value:t.zoomLevel,callback:function(e){t.zoomLevel=e},expression:"zoomLevel"}})],1),"infos"===t.currentSection?i("div",{ref:"info-row",staticClass:"infos flexrow pa0"},[i("div",{staticClass:"flexrow-item"},[i("div",{staticClass:"flexrow"},[i("div",{staticClass:"flexcolumn flexrow-item"},[i("page-subtitle",{staticClass:"flerow-item",attrs:{text:t.$t("edits.tasks")}}),i("entity-task-list",{staticClass:"task-list flexrow-item",attrs:{entries:t.currentEdit?t.currentEdit.tasks:[],"is-loading":!t.currentEdit,"is-error":!1}})],1),i("div",{staticClass:"flexcolumn flexrow-item"},[i("div",{staticClass:"flexrow"},[i("page-subtitle",{staticClass:"flerow-item",attrs:{text:t.$t("main.info")}}),i("div",{staticClass:"flexrow-item has-text-right"},[t.isCurrentUserManager?i("button-simple",{attrs:{icon:"edit"},on:{click:function(e){t.modals.edit=!0}}}):t._e()],1)],1),i("div",{staticClass:"table-body edit-metadata flexrow-item"},[t.currentEdit?i("table",{staticClass:"datatable no-header"},[i("tbody",{staticClass:"datatable-body"},[i("tr",{staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[t._v(t._s(t.$t("edits.fields.description")))]),i("description-cell",{attrs:{entry:t.currentEdit,full:!0}})],1),t._l(t.editMetadataDescriptors,(function(e){return i("tr",{key:e.id,staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[t._v(t._s(e.name))]),i("td",[t._v(" "+t._s(t.currentEdit.data?t.currentEdit.data[e.field_name]:"")+" ")])])}))],2)]):t._e()])])])])]):t._e(),"schedule"===t.currentSection&&t.scheduleItems.length>0?i("div",{ref:"schedule-row",staticClass:"infos schedule"},[t.scheduleItems[0].children.length>0?i("div",{directives:[{name:"show",rawName:"v-show",value:"schedule"===t.currentSection,expression:"currentSection === 'schedule'"}],staticClass:"schedule mt1"},[i("div",{staticClass:"wrapper"},[i("schedule",{ref:"schedule-widget",attrs:{"start-date":t.tasksStartDate,"end-date":t.tasksEndDate,hierarchy:t.scheduleItems,"zoom-level":t.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1}})],1)]):t._e()]):t._e(),"preview-files"===t.currentSection?i("entity-preview-files",{attrs:{entity:t.currentEdit}}):t._e(),"activity"===t.currentSection?i("entity-news",{attrs:{entity:t.currentEdit}}):t._e(),"time-logs"===t.currentSection?i("entity-time-logs",{attrs:{entity:t.currentEdit}}):t._e()],1)]),i("edit-edit-modal",{ref:"edit-edit-modal",attrs:{active:t.modals.edit,"is-loading":t.isLoading,"is-error":t.errors.edit,"edit-to-edit":t.currentEdit},on:{cancel:function(e){t.modals.edit=!1},confirm:t.confirmEditEdit}})],1)},n=[],s=i("2f62"),a=i("0a35"),o=i("0774"),l=i("eb23"),c=i("f58f"),u=i("9d8b"),d=i("31f2"),p=i("7470"),f=i("1db5"),v=i("9a9b"),h=i("de40"),w=i("1e4c"),y=i("0fcb"),m=i("489a"),g=i("22a2"),b=i("b2f9"),C=i("0024"),x=i("4ee3"),P=i("bb21"),k=i("7096"),_=i("9751"),E=i("8751"),O=i("8d07"),F=i("7f06"),S=i("4136"),T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flexrow"},[t.taskTypeOptions.length>0?i("combobox-styled",{ref:"task-type-combobox",staticClass:"flexrow-item",attrs:{options:t.taskTypeOptions},model:{value:t.taskTypeId,callback:function(e){t.taskTypeId=e},expression:"taskTypeId"}}):t._e(),t.previewFileOptions.length?i("combobox-styled",{staticClass:"flexrow-item",attrs:{options:t.previewFileOptions},model:{value:t.previewFileId,callback:function(e){t.previewFileId=e},expression:"previewFileId"}}):i("span",{staticClass:"text flexrow-item"},[t._v("Selected task has no previews.")]),t.taskStatus?i("div",{staticClass:"flexrow-item"},[i("validation-tag",{staticClass:"flexrow-item",attrs:{task:{task_status_id:t.taskStatus.id},"is-static":!0,thin:!1}})],1):t._e()],1)},I=[],L=i("ceca"),$=i.n(L),j=i("fe13");function M(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function D(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?M(Object(i),!0).forEach((function(e){N(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):M(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function N(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var H={name:"previews-per-task-type",components:{ComboboxStyled:_["a"],ValidationTag:j["a"]},data:function(){return{taskTypeId:null,previewFileId:this.entity.preview_file_id}},props:{entityMap:{default:function(){},type:Map},index:{default:0,type:Number},entity:{default:function(){},type:Object}},mounted:function(){this.setCurrentParameters()},computed:D(D({},Object(s["c"])(["taskMap","taskTypeMap","taskStatusMap","isCurrentUserManager"])),{},{taskTypeOptions:function(){var t=this,e=this.entityMap.get(this.entity.id);return e.tasks.map((function(e){return t.taskMap.get(e)})).map((function(e){return t.taskTypeMap.get(e.task_type_id)})).sort($()("priority",1).thenBy("name")).map((function(t){return{label:t.name,value:t.id}}))},previewFileOptions:function(){var t=this.entity.preview_files[this.taskTypeId]||[];return t.map((function(t){return{label:"v".concat(t.revision),value:t.id}}))},taskStatus:function(){if(!this.entityMap)return"";var t=this.entityMap.get(this.entity.id);if(!t)return"";var e=t.validations.get(this.taskTypeId);if(e){var i=this.taskMap.get(e);if(!i)return"";var r=this.taskStatusMap.get(i.task_status_id);return r}return""}}),methods:{getTaskTypeIdForPreviewFile:function(t,e){var i=this;return t.find((function(t){var r=i.entity.preview_files[t];return r.some((function(t){return t.id===e}))}))},setCurrentParameters:function(){var t=Object.keys(this.entity.preview_files);t.length>0&&(this.entity.preview_file_id&&(this.taskTypeId=this.getTaskTypeIdForPreviewFile(t,this.entity.preview_file_id)),this.taskTypeId||(this.taskTypeId=t[0]))}},watch:{taskTypeId:function(){var t=this,e=this.entity.preview_files[this.taskTypeId];if(e&&e.length>0){var i=e.some((function(e){return e.id===t.entity.preview_file_id}));this.previewFileId=i?this.entity.preview_file_id:e[0].id}else this.previewFileId=null},previewFileId:function(){var t=this,e=null,i=this.entity.preview_files[this.taskTypeId];i&&i.length>0&&(e=i.find((function(e){return e.id===t.previewFileId}))),this.$emit("preview-changed",this.entity,e)},"entity.preview_files":function(){},"entity.preview_file_id":function(){this.previewFileId!==this.entity.preview_file_id&&(this.previewFileId=this.entity.preview_file_id)}}},R=H,A=(i("e351"),i("2877")),U=Object(A["a"])(R,T,I,!1,null,"6b6c8874",null),z=U.exports,V=i("dbe2"),G=i("d7c7"),B=i("be83"),J=i("9d94"),Y=i("5321");function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function q(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Q(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?q(Object(i),!0).forEach((function(e){W(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):q(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function W(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function X(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */X=function(){return t};var t={},e=Object.prototype,i=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function o(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(E){o=function(t,e,i){return t[e]=i}}function l(t,e,i,r){var n=e&&e.prototype instanceof d?e:d,s=Object.create(n.prototype),a=new P(r||[]);return s._invoke=function(t,e,i){var r="suspendedStart";return function(n,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw s;return _()}for(i.method=n,i.arg=s;;){var a=i.delegate;if(a){var o=b(a,i);if(o){if(o===u)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var l=c(t,e,i);if("normal"===l.type){if(r=i.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r="completed",i.method="throw",i.arg=l.arg)}}}(t,i,a),s}function c(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(E){return{type:"throw",arg:E}}}t.wrap=l;var u={};function d(){}function p(){}function f(){}var v={};o(v,n,(function(){return this}));var h=Object.getPrototypeOf,w=h&&h(h(k([])));w&&w!==e&&i.call(w,n)&&(v=w);var y=f.prototype=d.prototype=Object.create(v);function m(t){["next","throw","return"].forEach((function(e){o(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){function r(n,s,a,o){var l=c(t[n],t,s);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==K(d)&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,a,o)}),(function(t){r("throw",t,a,o)})):e.resolve(d).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,o)}))}o(l.arg)}var n;this._invoke=function(t,i){function s(){return new e((function(e,n){r(t,i,e,n)}))}return n=n?n.then(s,s):s()}}function b(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=c(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var n=r.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function k(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function e(){for(;++r<t.length;)if(i.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return s.next=s}}return{next:_}}function _(){return{value:void 0,done:!0}}return p.prototype=f,o(y,"constructor",f),o(f,"constructor",p),p.displayName=o(f,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},m(g.prototype),o(g.prototype,s,(function(){return this})),t.AsyncIterator=g,t.async=function(e,i,r,n,s){void 0===s&&(s=Promise);var a=new g(l(e,i,r,n),s);return t.isGeneratorFunction(i)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(y),o(y,a,"Generator"),o(y,n,(function(){return this})),o(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var r=e.pop();if(r in t)return i.value=r,i.done=!1,i}return i.done=!0,i}},t.values=k,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(i,r){return a.type="throw",a.arg=t,e.next=i,r&&(e.method="next",e.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var o=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(o&&l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),x(i),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var n=r.arg;x(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:k(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},t}function Z(t,e,i,r,n,s,a){try{var o=t[s](a),l=o.value}catch(c){return void i(c)}o.done?e(l):Promise.resolve(l).then(r,n)}function tt(t){return function(){var e=this,i=arguments;return new Promise((function(r,n){var s=t.apply(e,i);function a(t){Z(s,r,n,a,o,"next",t)}function o(t){Z(s,r,n,a,o,"throw",t)}a(void 0)}))}}var et={name:"edit",mixins:[o["a"],l["a"],c["a"],d["a"],p["a"],f["a"]],components:{ButtonSimple:h["a"],CornerLeftUpIcon:a["p"],ColorPicker:k["a"],ComboboxStyled:_["a"],ComboboxNumber:w["a"],DescriptionCell:y["a"],DownloadIcon:a["u"],EditEditModal:m["a"],EntityNews:g["a"],EntityPreviewFiles:b["a"],EntityTaskList:C["a"],EntityTimeLogs:x["a"],EntityThumbnail:P["a"],PageSubtitle:E["a"],PageTitle:O["a"],PencilPicker:F["a"],PreviewRoom:S["a"],PreviewsPerTaskType:z,RawVideoPlayer:V["a"],Schedule:G["a"],Spinner:B["a"],TaskInfo:J["default"],VideoProgress:Y["a"]},data:function(){return{currentEdit:null,currentSection:"infos",isLoading:!0,isError:!1,previewRoomRef:"edits-preview-room",previewFileMap:new Map,tempMode:!1,errors:{edit:!1},entityNavOptions:[{label:"Infos",value:"infos"},{label:"Schedule",value:"schedule"},{label:"Preview Files",value:"preview-files"},{label:"Activity",value:"activity"},{label:"Timelog",value:"time-logs"}],modals:{edit:!1}}},mounted:function(){var t=this;this.resetData(),this.$on("annotation-changed",this.onAnnotationChanged),this.$options.scrubbing=!1,this.isHd=!!this.organisation&&"true"===this.organisation.hd_by_default,this.picturePlayer&&this.picturePlayer.addEventListener("load",tt(X().mark((function e(){var i;return X().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.isPlaying,e.next=3,t.resetPictureCanvas();case 3:t.isPlaying=i;case 4:case"end":return e.stop()}}),e)})))),this.$nextTick((function(){t.configureEvents(),t.setupFabricCanvas(),t.setPlayerSpeed(1),t.onFrameUpdate(1)}))},beforeDestroy:function(){this.$off("annotation-changed",this.onAnnotationChanged)},computed:Q(Q({},Object(s["c"])(["currentEpisode","currentProduction","getTaskPreviews","getTaskTypePriority","isCurrentUserManager","isTVShow","route","editMap","editMetadataDescriptors","taskMap","taskTypeMap","user"])),{},{title:function(){return this.currentEdit?this.currentEdit.episode_name?"".concat(this.currentEdit.episode_name," / ")+"".concat(this.currentEdit.name):"".concat(this.currentEdit.name):"Loading..."},editsPath:function(){return Object(u["b"])(this.currentProduction.id,"edits",this.currentEpisode?this.currentEpisode.id:this.currentEpisode)}}),methods:Q(Q({},Object(s["b"])(["editEdit","loadEdits","loadTaskEntityPreviewFiles","updatePreviewAnnotation"])),{},{resetPreviewFileMap:function(){var t=this;this.previewFileMap.clear(),this.previewFiles&&Object.values(this.previewFiles).forEach((function(e){e.forEach((function(e){t.previewFileMap.set(e.id,e)}))}))},resetHeight:function(){var t=this;this.$nextTick((function(){var e=window.innerHeight;e-=t.$refs.header?t.$refs.header.offsetHeight:0,t.$refs["button-bar"]&&(e-=t.$refs["button-bar"].offsetHeight),t.$refs["video-progress"]&&(e-=t.$refs["video-progress"].$el.offsetHeight),t.$refs["info-row"]&&(e-=t.$refs["info-row"].offsetHeight),t.$refs["schedule-row"]&&(e-=t.$refs["schedule-row"].offsetHeight),t.$refs["page-header-row"]&&(e-=t.$refs["page-header-row"].offsetHeight),e=Math.min(.4*window.innerHeight,Math.max(480,e)),t.$refs["video-container"]&&(t.$refs["video-container"].style.height="".concat(e,"px")),!t.isCommentsHidden&&t.$refs["task-info"]&&(t.$refs["task-info"].$el.style.height="".concat(e,"px")),t.rawPlayer&&t.rawPlayer.resetHeight(e),t.$nextTick((function(){t.resetCanvas(),t.updateProgressBar()}))}))},initPlayer:function(){var t=this;this.currentEdit&&(this.currentPreviewIndex=0,this.playingEntityIndex=0,this.entityList=[Q(Q({},this.currentEdit),{},{preview_file_id:null,preview_files:this.previewFiles})],this.framesPerImage[0]=this.currentEdit.preview_nb_frames||v["a"],this.pause(),this.rawPlayer&&this.rawPlayer.setCurrentFrame(1),this.currentTimeRaw=0,this.updateProgressBar(),this.updateTaskPanel(),this.clearCanvas(),this.annotations=[],this.resetHeight(),this.resetCanvas().then((function(){t.isCurrentPreview&&(t.annotations=t.currentEntity.preview_file_annotations,t.loadAnnotation(t.getAnnotation(0)))})))},getCurrentEdit:function(){return this.editMap.get(this.route.params.edit_id)||null},confirmEditEdit:function(t){var e=this;t.id=this.currentEdit.id,this.isLoading=!0,this.errors.edit=!1,this.editEdit(t).then((function(){e.isLoading=!1,e.modals.edit=!1})).catch((function(t){console.error(t),e.isLoading=!1,e.errors.edit=!0}))},setPreviewFile:function(t){this.playingPreviewFileId=t.id,this.currentEntity.preview_file_id=t.id,this.currentEntity.preview_file_task_id=t.task_id,this.currentEntity.preview_file_extension=t.extension,this.currentEntity.preview_file_annotations=t.annotations||[],this.currentEntity.preview_file_previews=t.previews,this.annotations=this.currentEntity.preview_file_annotations,this.rawPlayer&&this.rawPlayer.reloadCurrentEntity(),this.clearCanvas(),this.updateTaskPanel(),this.updateProgressBar()},onPreviewChanged:function(t,e){this.pause();var i=this.playingPreviewFileId!==e.id;this.setPreviewFile(e),i&&this.sendUpdatePlayingStatus()},onAnnotationChanged:function(t){var e=t.preview,i=t.additions,r=t.deletions,n=t.updates,s=e.task_id;this.updatePreviewAnnotation({taskId:s,preview:e,additions:i,deletions:r,updates:n})},scrollToEntity:function(){},resetData:function(){var t=this;this.$nextTick((function(){t.loadEdits().then((function(){t.currentEdit=t.getCurrentEdit(),t.currentEdit&&t.loadTaskEntityPreviewFiles(t.currentEdit.id).then((function(e){t.previewFiles=e,t.resetPreviewFileMap(),t.initPlayer(),t.isLoading=!1}))}))}))},onPreviewFilesUpdate:function(){var t=this;this.loadTaskEntityPreviewFiles(this.currentEdit.id).then((function(e){t.previewFiles=e,t.currentEntity.preview_files=e,t.resetPreviewFileMap(),t.currentEntity&&t.currentEntity.preview_file_id&&t.previewFileMap.has(t.currentEntity.preview_file_id)}))}}),watch:{currentProduction:function(){this.isTVShow||this.resetData()},currentEpisode:function(){this.isTVShow&&0===this.editMap.size&&this.resetData()},playingPreviewFileId:function(){var t=this;if(this.currentEntity&&this.playingPreviewFileId){var e=this.$refs["previews-per-task-type"];if(e){var i=this.currentEntity.preview_files;for(var r in i){var n=i[r].find((function(e){return e.id===t.playingPreviewFileId}));if(n){this.setPreviewFile(n),e.taskTypeId===r&&e.previewFileId===this.playingPreviewFileId||(e.taskTypeId=r,e.previewFileId=this.playingPreviewFileId);break}}}}}},socket:{events:Q(Q(Q({},p["a"].socket.events),f["a"].socket.events),{},{"preview-file:add-file":function(t){if(t.project_id===this.task.project_id){var e=t.task_id,i=this.currentEntity.preview_files;for(var r in i){var n=i[r].find((function(t){return t.task_id===e}));if(n){this.onPreviewFilesUpdate();break}}}},"comment:delete":function(t){t.project_id===this.task.project_id&&this.onPreviewFilesUpdate()}})},metaInfo:function(){return{title:"".concat(this.title," - Kitsu")}}},it=et,rt=(i("2dc4"),Object(A["a"])(it,r,n,!1,null,"02279721",null));e["default"]=rt.exports},"2dc4":function(t,e,i){"use strict";i("3f9b")},"3f9b":function(t,e,i){},c1bb:function(t,e,i){},e351:function(t,e,i){"use strict";i("c1bb")}}]);
//# sourceMappingURL=chunk-875ed646.b100eeaf.js.map