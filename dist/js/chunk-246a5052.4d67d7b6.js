(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-246a5052"],{"24b2":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"columns fixed-page edit"},[i("div",{staticClass:"column main-column"},[i("div",{ref:"page-header-row",staticClass:"page-header flexrow flexrow-item"},[i("div",{staticClass:"flexrow block mb0 main-block"},[i("router-link",{staticClass:"flexrow-item has-text-centered back-link",attrs:{to:e.editsPath}},[i("corner-left-up-icon")],1),i("span",{staticClass:"flexrow-item"},[e.currentEntity?i("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:e.currentEntity,"empty-height":60,"empty-width":100,height:60,width:100}}):e._e()],1),i("div",{staticClass:"flexrow-item"},[i("page-title",{staticClass:"entity-title",attrs:{text:e.title}})],1),!e.isLoading&&e.currentEntity?i("div",{key:e.currentEntity.id,staticClass:"flexrow-item has-text-centered"},[i("previews-per-task-type",{ref:"previews-per-task-type",attrs:{entity:e.currentEntity,"entity-map":e.editMap},on:{"preview-changed":e.onPreviewChanged}})],1):e._e()],1),i("div",{staticClass:"filler"}),i("div",{staticClass:"flexrow-item block mt0"},[e.currentEdit&&e.isValidRoomId(e.currentEdit.id)&&e.currentPreview&&e.currentPreview.id?i("preview-room",{ref:e.previewRoomRef,attrs:{roomId:e.currentEdit&&e.isValidRoomId(e.currentEdit.id)?e.currentEdit.id:"",joinRoom:e.joinRoom,leaveRoom:e.leaveRoom}}):e._e()],1)]),i("div",{ref:"container",staticClass:"edit player block"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"flexrow filler"},[i("div",{ref:"video-container",staticClass:"flexrow filler video-container"},[i("raw-video-player",{directives:[{name:"show",rawName:"v-show",value:e.isCurrentPreviewMovie&&!e.isLoading,expression:"isCurrentPreviewMovie && !isLoading"}],ref:"raw-player",staticClass:"raw-player",style:{position:"static",opacity:e.overlayOpacity},attrs:{entities:e.entityList,"full-screen":e.fullScreen,"is-hd":e.isHd,"is-repeating":e.isRepeating,"current-preview-index":e.currentPreviewIndex,muted:e.isMuted},on:{"max-duration-update":e.onMaxDurationUpdate,"metadata-loaded":e.onMetadataLoaded,repeat:e.onVideoRepeated,"frame-update":e.onFrameUpdate}}),e.isCurrentPreviewModel&&!e.isLoading?i("object-viewer",{ref:"object-player",staticClass:"object-player",style:{position:"static",opacity:e.overlayOpacity},attrs:{"preview-url":e.currentPreviewDlPath,"full-screen":e.fullScreen}}):e._e(),e.isCurrentPreviewSound&&!e.isLoading?i("sound-viewer",{ref:"sound-player",staticClass:"sound-player",attrs:{"preview-url":e.currentPreviewDlPath,"full-screen":e.fullScreen},on:{"play-ended":e.pause}}):e._e(),i("p",{directives:[{name:"show",rawName:"v-show",value:e.isCurrentPreviewFile&&!e.isLoading,expression:"isCurrentPreviewFile && !isLoading"}],staticClass:"preview-standard-file has-text-centered",style:{width:"100%"}},[e.extension&&e.extension.length>0?i("a",{ref:"preview-file",staticClass:"button",attrs:{href:e.currentPreviewDlPath}},[i("download-icon",{staticClass:"icon"}),i("span",{staticClass:"text"},[e._v(" "+e._s(e.$t("tasks.download_pdf_file",{extension:e.extension}))+" ")])],1):e._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isCurrentPreviewPicture&&!e.isLoading,expression:"isCurrentPreviewPicture && !isLoading"}],ref:"picture-player-wrapper",staticClass:"picture-preview-wrapper flexrow",style:{position:"static",opacity:e.overlayOpacity,left:0,right:0}},[i("img",{directives:[{name:"show",rawName:"v-show",value:e.isCurrentPreviewPicture,expression:"isCurrentPreviewPicture"}],ref:"picture-player",staticClass:"picture-preview",attrs:{id:"picture-player",src:e.isCurrentPreviewPicture?e.currentPreviewPath:null}})]),e.isLoading?i("div",{staticClass:"loading-wrapper"},[i("spinner")],1):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isCurrentPreviewFile,expression:"!isCurrentPreviewFile"}],ref:"canvas-wrapper",staticClass:"canvas-wrapper",attrs:{oncontextmenu:"return false;"}},[i("canvas",{ref:"annotation-canvas",staticClass:"canvas",attrs:{id:"edit-annotation-canvas"}})])],1),i("task-info",{ref:"task-info",class:{"flexrow-item":!0,"task-info-column":!0,hidden:e.isCommentsHidden},attrs:{task:e.task,"is-preview":!1,silent:e.isCommentsHidden,"current-time-raw":e.currentTimeRaw-e.frameDuration,"current-parent-preview":e.currentPreview},on:{"time-code-clicked":e.onTimeCodeClicked}})],1),i("video-progress",{directives:[{name:"show",rawName:"v-show",value:e.isCurrentPreviewMovie&&e.currentPreview.id,expression:"isCurrentPreviewMovie && currentPreview.id"}],ref:"video-progress",staticClass:"video-progress pull-bottom",attrs:{annotations:e.annotations,"frame-duration":e.frameDuration,"nb-frames":e.nbFrames},on:{"start-scrub":e.onScrubStart,"end-scrub":e.onScrubEnd,"progress-changed":e.onProgressChanged}}),e.currentEntity&&e.currentEntity.id?i("div",{ref:"button-bar",staticClass:"player-footer flexrow"},[e.isCurrentPreviewMovie||e.isCurrentPreviewPicture||e.isCurrentPreviewSound?i("div",{staticClass:"flexrow flexrow-item mr0"},[e.isPlaying?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.pause"),icon:"pause"},on:{click:e.pauseClicked}}):i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.play"),icon:"play"},on:{click:e.playClicked}})],1):e._e(),i("div",{staticClass:"separator"}),e.isCurrentPreviewPicture?[e._v(" "+e._s(e.framesSeenOfPicture)+" / "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.framesPerImage[e.playingEntityIndex],expression:"framesPerImage[playingEntityIndex]"}],staticClass:"frame-per-image-input",attrs:{type:"number",min:"0",title:e.$t("playlists.actions.frames_per_picture")},domProps:{value:e.framesPerImage[e.playingEntityIndex]},on:{input:function(t){t.target.composing||e.$set(e.framesPerImage,e.playingEntityIndex,t.target.value)}}})]:e._e(),e.isCurrentPreviewPicture?i("div",{staticClass:"separator"}):e._e(),e.currentEntityPreviewLength>1?i("div",{staticClass:"flexrow flexrow-item"},[i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{icon:"left",title:e.$t("playlists.actions.files_previous"),disabled:e.isPlaying},on:{click:e.onPreviousPreviewClicked}}),i("span",{staticClass:"ml05 mr05",attrs:{title:e.$t("playlists.actions.files_position")}},[e._v(" "+e._s(e.currentPreviewIndex+1)+" / "+e._s(e.currentEntityPreviewLength)+" ")]),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{icon:"right",title:e.$t("playlists.actions.files_next"),disabled:e.isPlaying},on:{click:e.onNextPreviewClicked}}),i("a",{staticClass:"button player-button flexrow-item",attrs:{href:e.currentPreviewPath,title:e.$t("playlists.actions.see_original_file"),target:"blank"}},[i("arrow-up-right-icon",{staticClass:"icon is-small"})],1)],1):e._e(),e.isCurrentPreviewMovie?i("div",{staticClass:"flexrow flexrow-item"},[3===e.speed?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.speed"),text:"x1.00"},on:{click:e.onSpeedClicked}}):2===e.speed?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.speed"),text:"x0.50"},on:{click:e.onSpeedClicked}}):i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.speed"),text:"x0.25"},on:{click:e.onSpeedClicked}}),e.isMuted?i("button-simple",{staticClass:"flexrow-item player-button",attrs:{title:e.$t("playlists.actions.unmute"),icon:"soundoff"},on:{click:e.onToggleSoundClicked}}):i("button-simple",{staticClass:"flexrow-item player-button",attrs:{title:e.$t("playlists.actions.mute"),icon:"soundon"},on:{click:e.onToggleSoundClicked}}),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{active:e.isRepeating,title:e.$t("playlists.actions.looping"),icon:"repeat"},on:{click:e.onRepeatClicked}}),i("span",{staticClass:"flexrow-item time-indicator",attrs:{title:e.$t("playlists.actions.current_time")}},[e._v(" "+e._s(e.currentTime)+" ")]),i("span",{staticClass:"flexrow-item time-indicator"},[e._v(" / ")]),i("span",{staticClass:"flexrow-item time-indicator",attrs:{title:e.$t("playlists.actions.max_duration")}},[e._v(" "+e._s(e.maxDuration)+" ")]),i("span",{staticClass:"flexrow-item time-indicator mr1",attrs:{title:e.$t("playlists.actions.frame_number")}},[e._v(" ("+e._s(e.currentFrame)+" / "+e._s((e.nbFrames+"").padStart(3,"0"))+") ")]),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.previous_frame"),icon:"left"},on:{click:e.onPreviousFrameClicked}}),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.next_frame"),icon:"right"},on:{click:e.onNextFrameClicked}})],1):e._e(),i("span",{staticClass:"filler"}),e.isCurrentUserArtist||!e.isCurrentPreviewMovie&&!e.isCurrentPreviewPicture?e._e():i("div",{staticClass:"flexrow"},[i("button-simple",{staticClass:"player-button flexrow-item",attrs:{icon:"undo",title:e.$t("playlists.actions.annotation_undo")},on:{click:e.undoLastAction}}),i("button-simple",{staticClass:"player-button flexrow-item",attrs:{title:e.$t("playlists.actions.annotation_redo"),icon:"redo"},on:{click:e.redoLastAction}}),i("transition",{attrs:{name:"slide"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isTyping,expression:"isTyping"}],staticClass:"annotation-tools"},[i("color-picker",{attrs:{isOpen:e.isShowingPalette,color:this.textColor},on:{TogglePalette:e.onPickColor,change:e.onChangeTextColor}})],1)]),i("button-simple",{class:{"player-button":!0,"flexrow-item":!0,active:e.isTyping},attrs:{title:e.$t("playlists.actions.annotation_text"),icon:"type"},on:{click:e.onTypeClicked}}),i("transition",{attrs:{name:"slide"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isDrawing,expression:"isDrawing"}],staticClass:"annotation-tools"},[i("pencil-picker",{attrs:{isOpen:e.isShowingPencilPalette,pencil:e.pencil,sizes:this.pencilPalette},on:{"toggle-palette":e.onPickPencil,change:e.onChangePencil}}),i("color-picker",{attrs:{isOpen:e.isShowingPalette,color:this.color},on:{TogglePalette:e.onPickColor,change:e.onChangeColor}})],1)]),i("button-simple",{class:{"player-button":!0,"flexrow-item":!0,active:e.isDrawing},attrs:{title:e.$t("playlists.actions.annotation_draw"),icon:"pencil"},on:{click:e.onAnnotateClicked}}),i("button-simple",{staticClass:"player-button flexrow-item",attrs:{icon:"remove",title:e.$t("playlists.actions.annotation_delete")},on:{click:e.onDeleteClicked}})],1),i("div",{staticClass:"separator"}),i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.comments"),icon:"comment"},on:{click:e.onCommentClicked}}),e.isCurrentPreviewMovie?i("button-simple",{staticClass:"player-button flexrow-item",attrs:{title:e.$t("playlists.actions."+(e.isHd?"switch_ld":"switch_hd")),text:e.isHd?"HD":"LD"},on:{click:function(t){e.isHd=!e.isHd}}}):e._e(),e.isFullScreenEnabled?i("button-simple",{staticClass:"button player-button flexrow-item",attrs:{title:e.$t("playlists.actions.fullscreen"),icon:"maximize"},on:{click:e.onFullscreenClicked}}):e._e()],2):e._e()],1),i("div",{staticClass:"edit-data block"},[i("div",{staticClass:"flexrow"},[i("combobox-styled",{staticClass:"section-combo flexrow-item",attrs:{options:e.entityNavOptions},model:{value:e.currentSection,callback:function(t){e.currentSection=t},expression:"currentSection"}}),i("div",{staticClass:"filler"}),i("span",{directives:[{name:"show",rawName:"v-show",value:"schedule"===e.currentSection,expression:"currentSection === 'schedule'"}],staticClass:"flexrow-item mt05"},[e._v(" "+e._s(e.$t("schedule.zoom_level"))+": ")]),i("combobox-number",{directives:[{name:"show",rawName:"v-show",value:"schedule"===e.currentSection,expression:"currentSection === 'schedule'"}],staticClass:"zoom-level flexrow-item ",attrs:{options:e.zoomOptions,"is-simple":""},model:{value:e.zoomLevel,callback:function(t){e.zoomLevel=t},expression:"zoomLevel"}})],1),"infos"===e.currentSection?i("div",{ref:"info-row",staticClass:"infos flexrow pa0"},[i("div",{staticClass:"flexrow-item"},[i("div",{staticClass:"flexrow"},[i("div",{staticClass:"flexcolumn flexrow-item"},[i("page-subtitle",{staticClass:"flerow-item",attrs:{text:e.$t("edits.tasks")}}),i("entity-task-list",{staticClass:"task-list flexrow-item",attrs:{entries:e.currentEdit?e.currentEdit.tasks:[],"is-loading":!e.currentEdit,"is-error":!1}})],1),i("div",{staticClass:"flexcolumn flexrow-item"},[i("div",{staticClass:"flexrow"},[i("page-subtitle",{staticClass:"flerow-item",attrs:{text:e.$t("main.info")}}),i("div",{staticClass:"flexrow-item has-text-right"},[e.isCurrentUserManager?i("button-simple",{attrs:{icon:"edit"},on:{click:function(t){e.modals.edit=!0}}}):e._e()],1)],1),i("div",{staticClass:"table-body edit-metadata flexrow-item"},[e.currentEdit?i("table",{staticClass:"datatable"},[i("tbody",{staticClass:"datatable-body"},[i("tr",{staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[e._v(e._s(e.$t("edits.fields.description")))]),i("description-cell",{attrs:{entry:e.currentEdit,full:!0}})],1),e._l(e.editMetadataDescriptors,(function(t){return i("tr",{key:t.id,staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[e._v(e._s(t.name))]),i("td",[e._v(" "+e._s(e.currentEdit.data?e.currentEdit.data[t.field_name]:"")+" ")])])}))],2)]):e._e()])])])])]):e._e(),"schedule"===e.currentSection&&e.scheduleItems.length>0?i("div",{ref:"schedule-row",staticClass:"infos schedule"},[e.scheduleItems[0].children.length>0?i("div",{directives:[{name:"show",rawName:"v-show",value:"schedule"===e.currentSection,expression:"currentSection === 'schedule'"}],staticClass:"schedule mt1"},[i("div",{staticClass:"wrapper"},[i("schedule",{ref:"schedule-widget",attrs:{"start-date":e.tasksStartDate,"end-date":e.tasksEndDate,hierarchy:e.scheduleItems,"zoom-level":e.zoomLevel,"is-loading":!1,"is-estimation-linked":!0,"hide-root":!0,"with-milestones":!1}})],1)]):e._e()]):e._e(),"preview-files"===e.currentSection?i("entity-preview-files",{attrs:{entity:e.currentEdit}}):e._e(),"activity"===e.currentSection?i("entity-news",{attrs:{entity:e.currentEdit}}):e._e(),"time-logs"===e.currentSection?i("entity-time-logs",{attrs:{entity:e.currentEdit}}):e._e()],1)]),i("edit-edit-modal",{ref:"edit-edit-modal",attrs:{active:e.modals.edit,"is-loading":e.isLoading,"is-error":e.errors.edit,"edit-to-edit":e.currentEdit},on:{cancel:function(t){e.modals.edit=!1},confirm:e.confirmEditEdit}})],1)},r=[],n=i("a34a"),a=i.n(n),o=i("2f62"),l=i("0a35"),c=i("0774"),d=i("eb23"),u=i("f58f"),p=i("9d8b"),f=i("31f2"),v=i("7470"),w=i("1db5"),h=i("9a9b"),m=i("de40"),y=i("1e4c"),b=i("0fcb"),g=i("489a"),C=i("22a2"),P=i("b2f9"),k=i("0024"),x=i("4ee3"),_=i("bb21"),E=i("7096"),F=i("9751"),T=i("8751"),O=i("8d07"),$=i("7f06"),I=i("4136"),S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flexrow"},[e.taskTypeOptions.length>0?i("combobox-styled",{ref:"task-type-combobox",staticClass:"flexrow-item",attrs:{options:e.taskTypeOptions},model:{value:e.taskTypeId,callback:function(t){e.taskTypeId=t},expression:"taskTypeId"}}):e._e(),e.previewFileOptions.length?i("combobox-styled",{staticClass:"flexrow-item",attrs:{options:e.previewFileOptions},model:{value:e.previewFileId,callback:function(t){e.previewFileId=t},expression:"previewFileId"}}):i("span",{staticClass:"text flexrow-item"},[e._v("Selected task has no previews.")]),e.taskStatus?i("div",{staticClass:"flexrow-item"},[i("validation-tag",{staticClass:"flexrow-item",attrs:{task:{task_status_id:e.taskStatus.id},"is-static":!0,thin:!1}})],1):e._e()],1)},M=[],j=i("ceca"),L=i.n(j),D=i("fe13");function H(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function N(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?H(Object(i),!0).forEach((function(t){R(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):H(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function R(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var A={name:"previews-per-task-type",components:{ComboboxStyled:F["a"],ValidationTag:D["a"]},data:function(){return{taskTypeId:null,previewFileId:this.entity.preview_file_id}},props:{entityMap:{default:function(){},type:Map},index:{default:0,type:Number},entity:{default:function(){},type:Object}},mounted:function(){this.setCurrentParameters()},computed:N(N({},Object(o["c"])(["taskMap","taskTypeMap","taskStatusMap","isCurrentUserManager"])),{},{taskTypeOptions:function(){var e=this,t=this.entityMap.get(this.entity.id);return t.tasks.map((function(t){return e.taskMap.get(t)})).map((function(t){return e.taskTypeMap.get(t.task_type_id)})).sort(L()("priority",1).thenBy("name")).map((function(e){return{label:e.name,value:e.id}}))},previewFileOptions:function(){var e=this.entity.preview_files[this.taskTypeId]||[];return e.map((function(e){return{label:"v".concat(e.revision),value:e.id}}))},taskStatus:function(){if(!this.entityMap)return"";var e=this.entityMap.get(this.entity.id);if(!e)return"";var t=e.validations.get(this.taskTypeId);if(t){var i=this.taskMap.get(t);if(!i)return"";var s=this.taskStatusMap.get(i.task_status_id);return s}return""}}),methods:{getTaskTypeIdForPreviewFile:function(e,t){var i=this;return e.find((function(e){var s=i.entity.preview_files[e];return s.some((function(e){return e.id===t}))}))},setCurrentParameters:function(){var e=Object.keys(this.entity.preview_files);e.length>0&&(this.entity.preview_file_id&&(this.taskTypeId=this.getTaskTypeIdForPreviewFile(e,this.entity.preview_file_id)),this.taskTypeId||(this.taskTypeId=e[0]))}},watch:{taskTypeId:function(){var e=this,t=this.entity.preview_files[this.taskTypeId];if(t&&t.length>0){var i=t.some((function(t){return t.id===e.entity.preview_file_id}));this.previewFileId=i?this.entity.preview_file_id:t[0].id}else this.previewFileId=null},previewFileId:function(){var e=this,t=null,i=this.entity.preview_files[this.taskTypeId];i&&i.length>0&&(t=i.find((function(t){return t.id===e.previewFileId}))),this.$emit("preview-changed",this.entity,t)},"entity.preview_files":function(){},"entity.preview_file_id":function(){this.previewFileId!==this.entity.preview_file_id&&(this.previewFileId=this.entity.preview_file_id)}}},U=A,z=(i("b754"),i("0c7c")),V=Object(z["a"])(U,S,M,!1,null,"37e00bab",null),B=V.exports,J=i("dbe2"),K=i("d7c7"),q=i("be83"),G=i("9d94"),Q=i("5321");function W(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function X(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?W(Object(i),!0).forEach((function(t){Y(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):W(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Y(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Z(e,t,i,s,r,n,a){try{var o=e[n](a),l=o.value}catch(c){return void i(c)}o.done?t(l):Promise.resolve(l).then(s,r)}function ee(e){return function(){var t=this,i=arguments;return new Promise((function(s,r){var n=e.apply(t,i);function a(e){Z(n,s,r,a,o,"next",e)}function o(e){Z(n,s,r,a,o,"throw",e)}a(void 0)}))}}var te={name:"edit",mixins:[c["a"],d["a"],u["a"],f["a"],v["a"],w["a"]],components:{ButtonSimple:m["a"],CornerLeftUpIcon:l["p"],ColorPicker:E["a"],ComboboxStyled:F["a"],ComboboxNumber:y["a"],DescriptionCell:b["a"],DownloadIcon:l["t"],EditEditModal:g["a"],EntityNews:C["a"],EntityPreviewFiles:P["a"],EntityTaskList:k["a"],EntityTimeLogs:x["a"],EntityThumbnail:_["a"],PageSubtitle:T["a"],PageTitle:O["a"],PencilPicker:$["a"],PreviewRoom:I["a"],PreviewsPerTaskType:B,RawVideoPlayer:J["a"],Schedule:K["a"],Spinner:q["a"],TaskInfo:G["default"],VideoProgress:Q["a"]},data:function(){return{currentEdit:null,currentSection:"infos",isLoading:!0,isError:!1,previewRoomRef:"edits-preview-room",previewFileMap:new Map,tempMode:!1,errors:{edit:!1},entityNavOptions:[{label:"Infos",value:"infos"},{label:"Schedule",value:"schedule"},{label:"Preview Files",value:"preview-files"},{label:"Activity",value:"activity"},{label:"Timelog",value:"time-logs"}],modals:{edit:!1}}},mounted:function(){var e=this;this.resetData(),this.$on("annotation-changed",this.onAnnotationChanged),this.$options.scrubbing=!1,this.isHd=!!this.organisation&&"true"===this.organisation.hd_by_default,this.picturePlayer&&this.picturePlayer.addEventListener("load",ee(a.a.mark((function t(){var i;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.isPlaying,t.next=3,e.resetPictureCanvas();case 3:e.isPlaying=i;case 4:case"end":return t.stop()}}),t)})))),this.$nextTick((function(){e.configureEvents(),e.setupFabricCanvas(),e.setPlayerSpeed(1),e.onFrameUpdate(1)}))},beforeDestroy:function(){this.$off("annotation-changed",this.onAnnotationChanged)},computed:X(X({},Object(o["c"])(["currentEpisode","currentProduction","getTaskPreviews","getTaskTypePriority","isCurrentUserManager","isTVShow","route","editMap","editMetadataDescriptors","taskMap","taskTypeMap","user"])),{},{title:function(){return this.currentEdit?this.currentEdit.episode_name?"".concat(this.currentEdit.episode_name," / ")+"".concat(this.currentEdit.name):"".concat(this.currentEdit.name):"Loading..."},editsPath:function(){return Object(p["b"])(this.currentProduction.id,"edits",this.currentEpisode?this.currentEpisode.id:this.currentEpisode)}}),methods:X(X({},Object(o["b"])(["editEdit","loadEdits","loadTaskEntityPreviewFiles","updatePreviewAnnotation"])),{},{resetPreviewFileMap:function(){var e=this;this.previewFileMap.clear(),this.previewFiles&&Object.values(this.previewFiles).forEach((function(t){t.forEach((function(t){e.previewFileMap.set(t.id,t)}))}))},resetHeight:function(){var e=this;this.$nextTick((function(){var t=window.innerHeight;t-=e.$refs.header?e.$refs.header.offsetHeight:0,e.$refs["button-bar"]&&(t-=e.$refs["button-bar"].offsetHeight),e.$refs["video-progress"]&&(t-=e.$refs["video-progress"].$el.offsetHeight),e.$refs["info-row"]&&(t-=e.$refs["info-row"].offsetHeight),e.$refs["schedule-row"]&&(t-=e.$refs["schedule-row"].offsetHeight),e.$refs["page-header-row"]&&(t-=e.$refs["page-header-row"].offsetHeight),t=Math.min(.4*window.innerHeight,Math.max(480,t)),e.$refs["video-container"]&&(e.$refs["video-container"].style.height="".concat(t,"px")),!e.isCommentsHidden&&e.$refs["task-info"]&&(e.$refs["task-info"].$el.style.height="".concat(t,"px")),e.rawPlayer&&e.rawPlayer.resetHeight(t),e.$nextTick((function(){e.resetCanvas(),e.updateProgressBar()}))}))},initPlayer:function(){var e=this;this.currentEdit&&(this.currentPreviewIndex=0,this.playingEntityIndex=0,this.entityList=[X(X({},this.currentEdit),{},{preview_file_id:null,preview_files:this.previewFiles})],this.framesPerImage[0]=this.currentEdit.preview_nb_frames||h["a"],this.pause(),this.rawPlayer&&this.rawPlayer.setCurrentFrame(1),this.currentTimeRaw=0,this.updateProgressBar(),this.updateTaskPanel(),this.clearCanvas(),this.annotations=[],this.resetHeight(),this.resetCanvas().then((function(){e.isCurrentPreview&&(e.annotations=e.currentEntity.preview_file_annotations,e.loadAnnotation(e.getAnnotation(0)))})))},getCurrentEdit:function(){return this.editMap.get(this.route.params.edit_id)||null},confirmEditEdit:function(e){var t=this;e.id=this.currentEdit.id,this.isLoading=!0,this.errors.edit=!1,this.editEdit(e).then((function(){t.isLoading=!1,t.modals.edit=!1})).catch((function(e){console.error(e),t.isLoading=!1,t.errors.edit=!0}))},setPreviewFile:function(e){this.playingPreviewFileId=e.id,this.currentEntity.preview_file_id=e.id,this.currentEntity.preview_file_task_id=e.task_id,this.currentEntity.preview_file_extension=e.extension,this.currentEntity.preview_file_annotations=e.annotations||[],this.currentEntity.preview_file_previews=e.previews,this.annotations=this.currentEntity.preview_file_annotations,this.rawPlayer&&this.rawPlayer.reloadCurrentEntity(),this.clearCanvas(),this.updateTaskPanel(),this.updateProgressBar()},onPreviewChanged:function(e,t){this.pause();var i=this.playingPreviewFileId!==t.id;this.setPreviewFile(t),i&&this.sendUpdatePlayingStatus()},onAnnotationChanged:function(e){var t=e.preview,i=e.additions,s=e.deletions,r=e.updates,n=t.task_id;this.updatePreviewAnnotation({taskId:n,preview:t,additions:i,deletions:s,updates:r})},scrollToEntity:function(){},resetData:function(){var e=this;this.$nextTick((function(){e.loadEdits().then((function(){e.currentEdit=e.getCurrentEdit(),e.currentEdit&&e.loadTaskEntityPreviewFiles(e.currentEdit.id).then((function(t){e.previewFiles=t,e.resetPreviewFileMap(),e.initPlayer(),e.isLoading=!1}))}))}))},onPreviewFilesUpdate:function(){var e=this;this.loadTaskEntityPreviewFiles(this.currentEdit.id).then((function(t){e.previewFiles=t,e.currentEntity.preview_files=t,e.resetPreviewFileMap(),e.currentEntity&&e.currentEntity.preview_file_id&&e.previewFileMap.has(e.currentEntity.preview_file_id)}))}}),watch:{currentProduction:function(){this.isTVShow||this.resetData()},currentEpisode:function(){this.isTVShow&&0===this.editMap.size&&this.resetData()},playingPreviewFileId:function(){var e=this;if(this.currentEntity&&this.playingPreviewFileId){var t=this.$refs["previews-per-task-type"];if(t){var i=this.currentEntity.preview_files;for(var s in i){var r=i[s].find((function(t){return t.id===e.playingPreviewFileId}));if(r){this.setPreviewFile(r),t.taskTypeId===s&&t.previewFileId===this.playingPreviewFileId||(t.taskTypeId=s,t.previewFileId=this.playingPreviewFileId);break}}}}}},socket:{events:X(X(X({},v["a"].socket.events),w["a"].socket.events),{},{"preview-file:add-file":function(e){if(e.project_id===this.task.project_id){var t=e.task_id,i=this.currentEntity.preview_files;for(var s in i){var r=i[s].find((function(e){return e.task_id===t}));if(r){this.onPreviewFilesUpdate();break}}}},"comment:delete":function(e){e.project_id===this.task.project_id&&this.onPreviewFilesUpdate()}})},metaInfo:function(){return{title:"".concat(this.title," - Kitsu")}}},ie=te,se=(i("420e"),Object(z["a"])(ie,s,r,!1,null,"4e4d2a65",null));t["default"]=se.exports},"420e":function(e,t,i){"use strict";i("76ef")},"76ef":function(e,t,i){},"88a3":function(e,t,i){},b754:function(e,t,i){"use strict";i("88a3")}}]);
//# sourceMappingURL=chunk-246a5052.4d67d7b6.js.map