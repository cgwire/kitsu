(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8bd6c94e"],{1213:function(t,i,e){},9122:function(t,i,e){"use strict";e("1213")},d1e3:function(t,i,e){"use strict";e.r(i);var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"playlists page fixed-page dark"},[e("div",{staticClass:"columns"},[e("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onPlaylistListScroll,expression:"onPlaylistListScroll"}],ref:"playlistList",class:{"playlist-list-column":!0,column:!0,toggled:t.isListToggled}},[e("div",{staticClass:"flexrow top-section"},[t.isListToggled?t._e():e("combobox-task-type",{staticClass:"flexrow-item selector mb1",attrs:{"task-type-list":t.taskTypeList,label:t.$t("playlists.filter_task_type"),thin:!0},model:{value:t.taskTypeId,callback:function(i){t.taskTypeId=i},expression:"taskTypeId"}}),t.isListToggled?t._e():e("span",{staticClass:"filler"}),e("button-simple",{staticClass:"flexrow-item",staticStyle:{flex:"0"},attrs:{icon:t.isListToggled?"right":"left","is-small":""},on:{click:function(i){t.isListToggled=!t.isListToggled}}})],1),e("div",{staticClass:"flexrow"},[t.isListToggled?t._e():[e("combobox",{staticClass:"flexrow-item mb2",attrs:{label:t.$t("main.sorted_by"),options:t.sortOptions,"locale-key-prefix":"playlists.fields."},model:{value:t.currentSort,callback:function(i){t.currentSort=i},expression:"currentSort"}})]],2),!t.isCurrentUserManager&&!t.isCurrentUserSupervisor||t.isListToggled?t._e():e("button",{key:"new-playlist-button",class:{button:!0,"is-loading":t.loading.addPlaylist},on:{click:t.showAddModal}},[e("plus-icon",{staticClass:"icon is-small"}),t._v(" "+t._s(t.$t("playlists.new_playlist"))+" ")],1),t.loading.playlists?e("spinner",{staticClass:"mt2"}):e("div",{staticClass:"playlists"},t._l(t.playlists,(function(i){return e("router-link",{key:i.id,class:{"playlist-item":!0,"for-client":i.for_client||!1,selected:i.id===t.currentPlaylist.id},style:t.playlistElementStyle(i),attrs:{to:t.getPlaylistPath(i.id)}},[t.isListToggled?e("div",{staticClass:"has-text-centered"},[e("light-entity-thumbnail",{attrs:{"preview-file-id":i.first_preview_file_id,type:"previews",width:"38px",height:"30px","max-width":"38px","max-height":"30px","empty-width":"38px","empty-height":"30px",title:i.name}})],1):e("div",[e("span",[t._v(" "+t._s(i.name)+" ")]),e("span",{staticClass:"playlist-date",attrs:{title:"last modified"}},[t._v(" "+t._s(t.$t("playlists.updated_at"))+" "+t._s(t.formatDate(i.updated_at))+" ")])])])})),1),t.errors.playlistLoading?e("error-text",{attrs:{text:"$t('playlists.loading_error')"}}):t._e()],1),t.playlists.length>0&&!t.currentPlaylist.id&&!t.loading.playlist?e("div",{staticClass:"playlist-column no-selection"},[e("h2",[t._v(t._s(t.$t("playlists.last_creation")))]),t.loading.playlists||t.loading.playlistsInit?e("spinner",{staticClass:"mt2"}):e("div",{staticClass:"flexrow"},t._l(t.lastPlaylistsCreated,(function(i){return e("router-link",{key:"recent-playlist-"+i.id,staticClass:"recent-playlist flexrow-item",attrs:{to:t.getPlaylistPath(i.id)}},[e("div",{staticClass:"has-text-centered"},[e("light-entity-thumbnail",{attrs:{"preview-file-id":i.first_preview_file_id,type:"previews",width:"auto",height:"auto","max-width":"300px","max-height":"150px","empty-height":"150px"}})],1),e("h3",[t._v(t._s(i.name))]),e("span",[t._v(" "+t._s(t.$t("playlists.created_at"))+" "+t._s(t.formatDate(i.created_at))+" ")])])})),1),e("h2",[t._v(t._s(t.$t("playlists.last_modification")))]),t.loading.playlists?e("spinner",{staticClass:"mt2"}):e("div",{staticClass:"flexrow"},t._l(t.lastPlaylistsUpdated,(function(i){return e("router-link",{key:"recent-modified-playlist-"+i.id,staticClass:"recent-playlist flexrow-item",attrs:{to:t.getPlaylistPath(i.id)}},[e("div",{staticClass:"has-text-centered"},[e("light-entity-thumbnail",{attrs:{"preview-file-id":i.first_preview_file_id,type:"previews",width:"auto",height:"auto","max-width":"300px","max-height":"150px","empty-height":"150px"}})],1),e("h3",[t._v(t._s(i.name))]),e("span",[t._v(" "+t._s(t.$t("playlists.updated_at"))+" "+t._s(t.formatDate(i.updated_at))+" ")])])})),1)],1):0===t.playlists.length?e("div",{staticClass:"playlist-column no-selection has-text-centered"},[t.loading.playlists||t.loading.playlistsInit?e("spinner",{staticClass:"mt2"}):e("div",[e("p",{staticClass:"empty-explaination"},[t._v(" "+t._s(t.$t("playlists.no_playlist"))+" ")]),t.isCurrentUserManager||t.isCurrentUserSupervisor?e("button",{key:"new-playlist-button",class:{big:!0,button:!0,"is-loading":t.loading.addPlaylist},on:{click:t.showAddModal}},[t._v(" "+t._s(t.$t("playlists.new_playlist"))+" ")]):t._e()])],1):e("div",{staticClass:"playlist-column column"},[e("playlist-player",{ref:"playlist-player",attrs:{playlist:t.currentPlaylist,entities:t.currentEntities,"is-loading":t.loading.playlist,"is-adding-entity":t.isAddingEntity,"is-asset-playlist":t.isAssetPlaylist},on:{"edit-clicked":t.showEditModal,"show-add-entities":t.toggleAddEntities,"preview-changed":t.onPreviewChanged,"task-type-changed":t.onTaskTypeChanged,"playlist-deleted":function(i){return t.$router.push(t.playlistsPath)},"remove-entity":t.removeEntity,"order-change":t.onOrderChange,"annotation-changed":t.onAnnotationChanged,"for-client-changed":t.onForClientChanged,"annotations-refreshed":t.onAnnotationsRefreshed}}),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&t.isAddingEntity&&!t.loading.playlist?e("div",[e("div",{staticClass:"addition-header"},[e("div",{staticClass:"flexrow"},[e("page-subtitle",{staticClass:"flexrow-item",attrs:{text:t.addEntitiesText}}),e("span",{staticClass:"filler"}),e("a",{staticClass:"close-button",on:{click:t.toggleAddEntities}},[e("x-icon")],1)],1),e("div",{staticClass:"flexrow"},[e("search-field",{ref:"search-field",staticClass:"flexrow-item",attrs:{"can-save":!1,placeholder:t.isAssetPlaylist?"chars mode=wfa":"ex: seq01 anim=wfa"},on:{change:t.onSearchChange}}),e("button-simple",{staticClass:"flexrow-item",attrs:{title:t.$t("entities.build_filter.title"),icon:"funnel"},on:{click:function(i){t.modals.isBuildFilterDisplayed=!0}}}),t.isAddSearchVisible?e("button",{class:{button:!0,"flexrow-item":!0,"add-sequence":!0},attrs:{disabled:t.isAdditionLoading},on:{click:t.addCurrentSelection}},[t._v(" "+t._s(t.$t("playlists.add_selection"))+" ")]):t._e(),e("span",{staticClass:"filler"}),t.isAssetPlaylist?t._e():e("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addDaily},attrs:{disabled:t.isAdditionLoading},on:{click:t.addDailyPending}},[t._v(" "+t._s(t.$t("playlists.build_daily"))+" ")]),t.isTVShow&&!t.isAssetPlaylist?e("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addEpisode},attrs:{disabled:t.isAdditionLoading},on:{click:t.addEpisodePending}},[t._v(" "+t._s(t.$t("playlists.add_episode"))+" ")]):t.isAssetPlaylist?t._e():e("button",{class:{button:!0,"add-sequence":!0,"is-loading":this.loading.addMovie},attrs:{disabled:t.isAdditionLoading},on:{click:t.addMovie}},[t._v(" "+t._s(t.$t("playlists.add_movie"))+" ")])],1)])]):t._e(),(t.isCurrentUserManager||t.isCurrentUserSupervisor)&&t.isAddingEntity?e("div",{directives:[{name:"scroll",rawName:"v-scroll",value:t.onBodyScroll,expression:"onBodyScroll"}],staticClass:"addition-section"},[t.isShotsLoading||t.isAssetsLoading?e("spinner",{key:"entity-loader",staticClass:"mt2"}):e("div",{ref:"entityListContent"},[t.isAssetPlaylist?e("div",t._l(t.displayedAssetsByType,(function(i,s){return e("div",{key:"asset-type-"+s},[i.length>0?e("h2",{staticClass:"entity-group-title"},[t._v(" "+t._s(i[0].asset_type_name)+" ")]):t._e(),e("div",{staticClass:"addition-entities"},t._l(i.filter((function(t){return!t.canceled})),(function(i){return e("div",{key:i.id,class:{"addition-shot":!0,playlisted:void 0!==t.currentEntities[i.id]},on:{click:function(e){return e.preventDefault(),t.addEntityToPlaylist(i)}}},[e("light-entity-thumbnail",{attrs:{"preview-file-id":i.preview_file_id,width:"150px",height:"100px"}}),e("span",{staticClass:"playlisted-shot-name"},[t._v(t._s(i.name))])],1)})),0)])})),0):e("div",t._l(t.displayedShotsBySequence,(function(i,s){return e("div",{key:"sequence-"+s},[i.length>0?e("h2",{staticClass:"entity-group-title"},[t._v(" "+t._s(i[0].sequence_name)+" "),t.isCurrentUserManager||t.isCurrentUserSupervisor?e("button",{key:"add-sequence-button-"+i[0].sequence_id,staticClass:"button",on:{click:function(e){return t.addSequence(i)}}},[t._v(" "+t._s(t.$t("playlists.add_sequence"))+" ")]):t._e()]):t._e(),e("div",{staticClass:"addition-entities"},t._l(i.filter((function(t){return!t.canceled})),(function(i){return e("div",{key:i.id,class:{"addition-shot":!0,playlisted:void 0!==t.currentEntities[i.id]},on:{click:function(e){return e.preventDefault(),t.addEntityToPlaylist(i)}}},[e("light-entity-thumbnail",{attrs:{"preview-file-id":i.preview_file_id,width:"150px",height:"100px"}}),e("div",[t.currentPlaylist.task_type_id?e("span",{style:{color:t.getTaskStatus(i).color},attrs:{title:t.getTaskStatus(i).name}},[t._v(" â€¢ ")]):t._e(),e("span",{staticClass:"playlisted-shot-name"},[t._v(t._s(i.name))])])],1)})),0)])})),0)])],1):t._e()],1)]),e("edit-playlist-modal",{ref:"edit-playlist-modal",attrs:{active:t.modals.isEditDisplayed,"is-loading":t.loading.editPlaylist,"is-error":t.errors.editPlaylist,"playlist-to-edit":t.playlistToEdit,"task-type-id":t.taskTypeId},on:{cancel:t.hideEditModal,confirm:t.confirmEditPlaylist}}),e("build-filter-modal",{ref:"build-filter-modal",attrs:{active:t.modals.isBuildFilterDisplayed,"entity-type":t.isAssetPlaylist?"asset":"shot"},on:{confirm:t.confirmBuildFilter,cancel:function(i){t.modals.isBuildFilterDisplayed=!1}}})],1)},a=[],l=e("ba4c"),n=e.n(l),r=e("ceca"),o=e.n(r),d=e("7f45"),c=e.n(d),u=e("2f62"),p=e("0a35"),y=e("9a9b"),h=e("3657"),f=e("9d8b"),g=e("66e7"),_=e("2229"),v=e("de40"),P=e("c31e"),m=e("992f"),b=e("e4fd"),w=e("d49e"),E=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("p",{class:{error:!0,"has-text-right":t.alignRight,"is-hidden":t.hidden}},[t._v(" "+t._s(t.text)+" ")])},S=[],k={name:"error-text",props:{text:{default:"",type:String},hidden:{default:!1,type:Boolean},alignRight:{default:!1,type:Boolean}}},T=k,C=e("2877"),A=Object(C["a"])(T,E,S,!1,null,null,null),x=A.exports,M=e("d793"),$=e("8751"),D=e("1ea9"),L=e("4d04"),j=e("be83");function O(t){return q(t)||B(t)||I(t)||F()}function F(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(t,i){if(t){if("string"===typeof t)return U(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?U(t,i):void 0}}function B(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function q(t){if(Array.isArray(t))return U(t)}function U(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,s=new Array(i);e<i;e++)s[e]=t[e];return s}function Y(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}function H(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?Y(Object(e),!0).forEach((function(i){V(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Y(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}function V(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}var R={name:"productions",components:{BuildFilterModal:P["a"],ButtonSimple:v["a"],Combobox:m["a"],ComboboxTaskType:b["a"],ErrorText:x,EditPlaylistModal:w["a"],LightEntityThumbnail:M["a"],PageSubtitle:$["a"],PlaylistPlayer:D["a"],PlusIcon:p["S"],SearchField:L["a"],Spinner:j["a"],XIcon:p["ob"]},data:function(){return{currentPlaylist:{name:""},currentSort:"updated_at",currentEntities:{},isAddingEntity:!1,isListToggled:!1,page:1,taskTypeId:"",sortedPlaylists:[],sortOptions:["updated_at","created_at","name"].map((function(t){return{label:t,value:t}})),playlistToEdit:{name:"".concat(c()().format("YYYY-MM-DD HH:mm:ss")),for_client:!1},previewFileMap:new Map,previewFileEntityMap:new Map,modals:{isBuildFilterDisplayed:!1,isDeleteDisplayed:!1,isEditDisplayed:!1},loading:{addPlaylist:!1,addDaily:!1,addEpisode:!1,addMovie:!1,addSequence:!1,addWeekly:!1,deletePlaylist:!1,editPlaylist:!1,playlist:!1,playlists:!1,playlistsInit:!0},errors:{addPlaylist:!1,editPlaylist:!1,deletePlaylist:!1,playlistLoading:!1}}},computed:H(H({},Object(u["c"])(["assetMap","assetSearchText","currentEpisode","currentProduction","displayedAssets","displayedAssetsByType","displayedShots","displayedShotsBySequence","isAssetsLoading","isCurrentUserManager","isCurrentUserSupervisor","isShotsLoading","isTVShow","productionTaskTypes","playlistMap","playlists","playlistsPath","shotsByEpisode","shotSearchText","shotMap","taskMap","taskStatusMap","taskTypeMap"])),{},{isAdditionLoading:function(){return this.loading.addSequence||this.loading.addWeekly||this.loading.addDaily||this.loading.addEpisode},isAssetPlaylist:function(){return"asset"===this.currentPlaylist.for_entity},isAddSearchVisible:function(){return this.isAssetPlaylist&&this.assetSearchText||!this.isAssetPlaylist&&this.shotSearchText},lastPlaylistsUpdated:function(){return this.playlists.concat().sort(o()("updated_at")).reverse().slice(0,3)},lastPlaylistsCreated:function(){return this.playlists.slice(0,3)},playlistPlayer:function(){return this.$refs["playlist-player"]},addEntitiesText:function(){return this.isAssetPlaylist?this.$t("playlists.add_assets"):this.$t("playlists.add_shots")},tvShowPageTitle:function(){var t=this.currentProduction?this.currentProduction.name:"",i="";return this.currentEpisode&&(i=this.currentEpisode.name,"all"===this.currentEpisode.id&&(i=this.$t("main.all")),"main"===this.currentEpisode.id&&(i="Main Pack")),"".concat(t," - ").concat(i)+" | ".concat(this.$t("playlists.title")," - Kitsu")},shortPageTitle:function(){var t=this.currentProduction?this.currentProduction.name:"";return"".concat(t," ").concat(this.$t("playlists.title")," - Kitsu")},taskTypeList:function(){return[{id:"",color:"#999",name:this.$t("news.all")}].concat(O(this.productionTaskTypes))}}),methods:H(H({},Object(u["b"])(["addNewBuildJob","pushEntityToPlaylist","changePlaylistOrder","changePlaylistPreview","changePlaylistType","displayMoreAssets","displayMoreShots","editPlaylist","getPending","loadMorePlaylists","loadPlaylist","loadPlaylists","loadEntityPreviewFiles","loadShots","loadAssets","markBuildJobAsDone","newPlaylist","refreshPlaylist","removeEntityPreviewFromPlaylist","removeBuildJobFromList","setAssetSearch","setCurrentEpisode","setShotSearch","updatePreviewAnnotation"])),{},{formatDate:function(t){return Object(h["c"])(t)},getPlaylistPath:function(t,i){return Object(f["e"])(this.currentProduction.id,this.currentEpisode?this.currentEpisode.id:null,t,i)},playlistElementStyle:function(t){var i=this.taskTypeMap.get(t.task_type_id),e=i?i.color:"transparent";return{"border-left":"2px solid "+e}},getTaskStatus:function(t){if(t=this.shotMap.get(t.id),t||(t=this.assetMap.get(t.id)),!t)return{};var i=t.validations.get(this.currentPlaylist.task_type_id);if(i){var e=this.taskMap.get(i);if(!e)return{};var s=this.taskStatusMap.get(e.task_status_id);return s}return{}},loadShotsData:function(t){0===this.displayedShots.length||this.displayedShots[0].project_id!==this.currentProduction.id||this.currentEpisode&&this.displayedShots[0].episode_id!==this.currentEpisode.id?this.isTVShow&&this.currentEpisode&&("main"===this.currentEpisode.id||"all"===this.currentEpisode.id)?t():this.loadShots(t):t()},loadAssetsData:function(){return this.isTVShow||0===this.displayedAssets.length?this.loadAssets():Promise.resolve()},loadPlaylistsData:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=function(){t.setCurrentPlaylist((function(){return t.currentPlaylist&&t.currentPlaylist.id||t.goFirstPlaylist(),Promise.resolve()}))};return 0===this.playlists.length||i?this.loadPlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then((function(){return e()})).catch((function(i){return console.error(i),t.errors.loadPlaylists=!0,Promise.reject(i)})):e()},onPlaylistListScroll:function(t,i){var e=this;if(!this.$options.silentMore){var s=this.$refs.playlistList,a=s.scrollHeight-s.offsetHeight;a<i.scrollTop+20&&(this.$options.silentMore=!0,this.page++,this.loadMorePlaylists({sortBy:this.currentSort,page:this.page,taskTypeId:this.taskTypeId}).then((function(t){setTimeout((function(){e.$options.silentMore=!1}),1e3)})).catch((function(t){return console.error(t),e.$options.silentMore=!1,e.errors.loadPlaylists=!0,Promise.reject(t)})))}},rebuildCurrentEntities:function(){var t=this;this.currentEntities={};var i={};this.previewFileMap=new Map,this.previewFileEntityMap=new Map,this.currentPlaylist&&this.currentPlaylist.shots&&this.currentPlaylist.shots.forEach((function(e){var s=t.convertEntityToPlaylistFormat(e);if(s){i[s.id]=s,t.previewFileEntityMap.set(e.preview_file_id,s);var a=Object.values(s.preview_files);a.forEach((function(i){i.forEach((function(i){t.previewFileMap.set(i.id,i)}))}))}})),this.$nextTick((function(){t.currentEntities=i}))},onAnnotationsRefreshed:function(t){var i=this.previewFileEntityMap.get(t.id),e=this.previewFileMap.get(t.id);i&&(i.preview_file_annotations=t.annotations),e&&(e.annotations=t.annotations)},convertEntityToPlaylistFormat:function(t){var i,e=this;if(i=this.isAssetPlaylist?this.assetMap.get(t.id):this.shotMap.get(t.id),i){var s={id:t.id,name:i.name,parent_name:i.sequence_name||i.asset_type_name,preview_files:t.preview_files,preview_file_id:t.preview_file_id||i.preview_file_id,preview_file_extension:t.preview_file_extension||i.preview_file_extension,preview_file_task_id:t.task_id||t.preview_file_task_id||i.preview_file_task_id,preview_file_annotations:t.preview_file_annotations||i.preview_file_annotations,preview_file_previews:t.preview_file_previews||i.preview_file_previews,preview_nb_frames:t.nb_frames||i.nb_frames||y["a"]};this.previewFileEntityMap.set(s.preview_file_id,s);var a=s.preview_file_previews||[];return a.forEach((function(t){e.previewFileMap.set(t.id,t)})),s}return null},setCurrentPlaylist:function(t){var i=this,e=this.$route.params.playlist_id,s=this.playlistMap.get(e);s?(this.loading.playlist=!0,this.loadPlaylist({playlist:s,callback:function(e,s){e&&console.error(e),i.currentPlaylist=s,i.rebuildCurrentEntities(),i.loading.playlist=!1,t&&t()}})):(this.currentPlaylist={name:""},this.currentShots={})},addEntity:function(t){var i=this;return this.loadEntityPreviewFiles(t).then((function(e){return i.addToStorePlaylistAndSave(e,t)})).then(this.addToPlayerPlaylist).catch((function(t){return console.error(t)}))},addToStorePlaylistAndSave:function(t,i){return this.pushEntityToPlaylist({playlist:this.currentPlaylist,previewFiles:t,entity:H({},i)})},addToPlayerPlaylist:function(t){var i=this,e=this.convertEntityToPlaylistFormat(t);n.a.set(this.currentEntities,e.id,e),this.playlistPlayer.entityList.push(e),this.$nextTick((function(){i.playlistPlayer.scrollToRight()}))},addEntityToPlaylist:function(t){this.currentEntities[t.id]||this.addEntity(t).then(this.playlistPlayer.scrollToRight())},removeEntity:function(t){var i=this;this.removeEntityPreviewFromPlaylist({playlist:this.currentPlaylist,entity:t,callback:function(){delete i.currentEntities[t.id]}})},clearCurrentPlaylist:function(){this.currentPlaylist={},this.currentShots={}},resetPlaylist:function(){this.clearCurrentPlaylist(),this.setCurrentPlaylist()},addCurrentSelection:function(){var t=this;this.$options.silent=!0;var i=this.isAssetPlaylist?this.displayedAssets:this.displayedShots;this.addEntities(O(i).reverse(),(function(){t.$options.silent=!1}))},addSequence:function(t){var i=this;if(t.length>0){var e=t[0].sequence_id,s=Array.from(this.shotMap.values()).filter((function(t){return t.sequence_id===e})).sort(o()("name")).reverse();this.$options.silent=!0,this.addEntities(s,(function(){i.$options.silent=!1}))}},addAllPending:function(){var t=this;this.$options.silent=!0,this.loading.addWeekly=!0,this.getPending(!1).then((function(i){t.addEntities(i.reverse(),(function(){t.loading.addWeekly=!1,t.$options.silent=!1}))}))},addDailyPending:function(){var t=this;this.loading.addDaily=!0,this.$options.silent=!0,this.getPending(!0).then((function(i){t.addEntities(Object(_["m"])(i).reverse(),(function(){t.loading.addDaily=!1,t.$options.silent=!1}))}))},addEpisodePending:function(){var t,i=this;this.loading.addEpisode=!0,this.$options.silent=!0;var e=(t=[]).concat.apply(t,O(this.shotsByEpisode));e=Object(_["m"])(e).reverse(),this.addEntities(e,(function(){i.loading.addEpisode=!1,i.$options.silent=!1}))},addMovie:function(){var t=this;this.loading.addMovie=!0,this.$options.silent=!0;var i=Object(_["m"])(Array.from(this.shotMap.values()));this.addEntities(i.reverse(),(function(){t.loading.addMovie=!1,t.$options.silent=!1}))},addEntities:function(t,i){var e=this;if(t&&t.length>0){var s=t.pop();this.addEntity(s).then((function(){e.addEntities(t,i)}))}else i()},onPreviewChanged:function(t,i){this.changePlaylistPreview({playlist:this.currentPlaylist,entity:t,previewFileId:i})},onOrderChange:function(t){this.changePlaylistOrder({playlist:this.currentPlaylist,info:t})},onAnnotationChanged:function(t){var i=t.preview,e=t.additions,s=t.deletions,a=t.updates,l=i.task_id;this.updatePreviewAnnotation({taskId:l,preview:i,additions:e,deletions:s,updates:a})},confirmBuildFilter:function(t){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(t),this.onSearchChange(t)},onSearchChange:function(t){t.length>1?this.isAssetPlaylist?(this.setAssetSearch(t),this.displayMoreAssets()):(this.setShotSearch(t),this.displayMoreShots()):this.isAssetPlaylist?this.setAssetSearch(""):this.setShotSearch("")},onForClientChanged:function(t){this.editPlaylist({data:{id:this.currentPlaylist.id,for_client:t}})},runAddPlaylist:function(t){var i=this,e={name:t.name,production_id:this.currentProduction.id,for_client:t.for_client,for_entity:t.for_entity,is_for_all:t.is_for_all,task_type_id:t.task_type_id};this.isTVShow&&this.currentEpisode&&(e.episode_id=this.currentEpisode.id),this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.newPlaylist(e).then((function(t){i.$router.push(i.getPlaylistPath(t.id)),i.loading.editPlaylist=!1,i.modals.isEditDisplayed=!1})).catch((function(t){console.error(t),i.errors.editPlaylist=!0,i.loading.editPlaylist=!1}))},confirmEditPlaylist:function(t){this.playlistToEdit.id?(t.id=this.currentPlaylist.id,this.runEditPlaylist(t)):this.runAddPlaylist(t)},runEditPlaylist:function(t){var i=this;this.loading.editPlaylist=!0,this.errors.editPlaylist=!1,this.editPlaylist({data:{id:t.id,for_client:t.for_client,for_entity:t.for_entity,name:t.name,task_type_id:t.task_type_id},callback:function(t,e){t&&(i.errors.editPlaylist=!0),i.loading.editPlaylist=!1,i.modals.isEditDisplayed=!1,Object.assign(i.currentPlaylist,e)}})},goFirstPlaylist:function(){this.playlists.length>0?this.$router.push({name:"playlist",params:{production_id:this.currentProduction.id,playlist_id:this.playlists[0].id}}):this.$router.push(this.playlistsPath)},toggleAddEntities:function(){this.isAddingEntity&&this.resetPlaylist(),this.isAddingEntity=!this.isAddingEntity},onTaskTypeChanged:function(t){var i=this;this.changePlaylistType({playlist:this.currentPlaylist,taskTypeId:t,callback:function(){i.rebuildCurrentEntities()}})},onBodyScroll:function(t,i){var e=this.$refs.entityListContent.scrollHeight-this.$refs.entityListContent.offsetHeight;e<i.scrollTop&&(this.isAssetPlaylist?this.displayMoreAssets():this.displayMoreShots())},resetSorting:function(){var t=1;["created_at","updated_at"].includes(this.currentSort)&&(t=-1),this.sortedPlaylists=O(this.playlists).sort(o()(this.currentSort,t).thenBy("name"))},showAddModal:function(){this.playlistToEdit={name:"".concat(c()().format("YYYY-MM-DD HH:mm:ss")),for_client:!1},this.$refs["edit-playlist-modal"]=!0,this.modals.isEditDisplayed=!0},showEditModal:function(){this.playlistToEdit=this.currentPlaylist,this.modals.isEditDisplayed=!0},hideEditModal:function(){this.playlistToEdit={name:"".concat(c()().format("YYYY-MM-DD HH:mm:ss")),for_client:!1},this.modals.isEditDisplayed=!1},reloadAll:function(){var t=this;this.loading.playlists||(this.loading.playlists=!0,this.loadShotsData((function(){t.loadAssetsData().then((function(){return t.page=1,t.loadPlaylistsData()})).then((function(){t.loading.playlists=!1,t.resetPlaylist(),setTimeout((function(){t.loading.playlistsInit=!1}),300)}))})))}}),mounted:function(){var t=this;this.$nextTick((function(){t.reloadAll(),localStorage.getItem("playlist-sort")&&(t.currentSort=localStorage.getItem("playlist-sort")),t.resetSorting()}))},watch:{$route:function(){this.setCurrentPlaylist()},currentPlaylist:function(){this.currentPlaylist.shots?(this.$options.silentMore=!1,this.isAddingEntity=0===Object.keys(this.currentPlaylist.shots).length):this.isAddingEntity=!0},currentProduction:function(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.reloadAll()},currentEpisode:function(){this.$store.commit("LOAD_PLAYLISTS_END",[]),this.currentEpisode&&this.reloadAll()},playlists:function(){},currentSort:function(){var t=this;localStorage.setItem("playlist-sort",this.currentSort),this.loading.playlists=!0,this.page=1,this.loadPlaylistsData(!0).then((function(){t.loading.playlists=!1}))},isListToggled:function(){this.playlistPlayer.onWindowResize()},taskTypeId:function(){this.loadPlaylistsData(!0)}},socket:{events:{"playlist:new":function(t){this.playlistMap.get(t.playlist_id)||this.refreshPlaylist(t.playlist_id)},"playlist:update":function(t){},"playlist:delete":function(t){this.$store.commit("DELETE_PLAYLIST_END",{id:t.playlist_id})},"build-job:new":function(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=[{id:t.build_job_id,created_at:t.created_at,status:"running",playlist_id:this.currentPlaylist.id}].concat(this.currentPlaylist.build_jobs))},"build-job:update":function(t){t.playlist_id===this.currentPlaylist.id&&Object(g["i"])(this.currentPlaylist.build_jobs,{id:t.build_job_id,status:t.status})},"build-job:delete":function(t){t.playlist_id===this.currentPlaylist.id&&(this.currentPlaylist.build_jobs=Object(g["h"])(this.currentPlaylist.build_jobs,{id:t.build_job_id}))}}},metaInfo:function(){return this.isTVShow?{title:this.tvShowPageTitle}:{title:this.shortPageTitle}}},N=R,J=(e("9122"),Object(C["a"])(N,s,a,!1,null,"7f19d767",null));i["default"]=J.exports}}]);
//# sourceMappingURL=chunk-8bd6c94e.a2c2533d.js.map