(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14958caa"],{"1daa":function(e,t,s){"use strict";s("773a")},2110:function(e,t,s){},3923:function(e,t,s){"use strict";s("e8e6")},"544e":function(e,t,s){"use strict";s("bbd3")},"773a":function(e,t,s){},"79ed":function(e,t,s){},8475:function(e,t,s){"use strict";s("2110")},9355:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a",{staticClass:"button",attrs:{title:e.title,href:e.path,target:e.target}},["plus"===e.icon?s("plus-icon",{staticClass:"icon is-small"}):e._e(),"download"===e.icon?s("download-icon",{staticClass:"icon is-small"}):e._e(),"upload"===e.icon?s("upload-icon",{staticClass:"icon is-small"}):e._e(),"list"===e.icon?s("list-icon",{staticClass:"icon is-small"}):e._e(),e.text?s("span",{staticClass:"text is-hidden-touch"},[e._v(" "+e._s(e.text)+" ")]):e._e()],1)},n=[],o=s("0a35"),a={name:"button-href-link",components:{DownloadIcon:o["t"],ListIcon:o["G"],PlusIcon:o["R"],UploadIcon:o["hb"]},props:{text:{default:"",type:String},path:{default:"",type:String},icon:{default:"",type:String},title:{default:"",type:String},styleclass:{default:"",type:String},target:{default:"_self",type:String}}},r=a,c=(s("544e"),s("0c7c")),l=Object(c["a"])(r,i,n,!1,null,"ebbaf58c",null);t["a"]=l.exports},9751:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.label.length>0?s("label",{staticClass:"label"},[e._v(" "+e._s(e.label)+" ")]):e._e(),s("div",{class:{combo:!0,open:e.showList},on:{click:e.toggleList}},[s("div",{staticClass:"flexrow"},[s("div",{staticClass:"selected-line flexrow-item"},[e._v(" "+e._s(e.selectedOption?e.selectedOption.label:"")+" ")]),s("chevron-down-icon",{staticClass:"down-icon flexrow-item"})],1),e.showList?s("div",{ref:"select",staticClass:"select-input",on:{click:e.toggleList}},e._l(e.options,(function(t){return s("div",{key:t.id,staticClass:"option-line",on:{click:function(s){return e.selectOption(t)},mouseup:function(s){return"button"in s&&1!==s.button?null:e.openRoute(t)}}},[e._v(" "+e._s(t.label)+" ")])})),0):e._e()]),s("div",{class:{"c-mask":!0,"is-active":e.showList},on:{click:e.toggleList}})])},n=[],o=s("2f62"),a=s("0a35");function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){l(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var d={name:"combobox-styled",components:{ChevronDownIcon:a["j"]},data:function(){return{selectedOption:{label:"",value:""},showList:!1}},props:{label:{default:"",type:String},options:{default:function(){return[]},type:Array},value:{default:"",type:String}},mounted:function(){this.options.length>0&&(this.selectedOption=this.options[0])},computed:c({},Object(o["c"])(["isDarkTheme"])),methods:{selectOption:function(e){this.$emit("input",e.value),this.selectedOption=e,this.toggleList()},openRoute:function(e){var t=this.$router.resolve(e.route).href,s="".concat(window.location.protocol,"//").concat(window.location.host).concat(t);window.open(s,"_blank")},toggleList:function(){var e=this;this.showList&&(this.lastScrollPosition=this.$refs.select.scrollTop),this.showList=!this.showList,this.showList&&this.$nextTick((function(){e.$refs.select.scrollTo({top:e.lastScrollPosition,left:0})}))}},watch:{options:function(){var e=this;if(this.options.length>0){var t=this.options.find((function(t){return t.value===e.value}));this.selectedOption=t||this.options[0]}},value:function(){var e=this;this.selectedOption=this.options.find((function(t){return t.value===e.value}))}}},u=d,p=(s("ade1"),s("0c7c")),h=Object(p["a"])(u,i,n,!1,null,"404b6075",null);t["a"]=h.exports},ade1:function(e,t,s){"use strict";s("d8fd")},b275:function(e,t,s){},bbd3:function(e,t,s){},d8fd:function(e,t,s){},e8e6:function(e,t,s){},f2d7:function(e,t,s){"use strict";s("b275")},fd43:function(e,t,s){"use strict";s("79ed")},fd5f:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"breakdown page"},[s("div",{staticClass:"breakdown-columns"},[s("div",{staticClass:"breakdown-column casting-column"},[s("div",{staticClass:"flexrow mb1"},[e.isEpisodeCasting?s("div",{},[s("h2",{staticClass:"subtitle mt05"},[e._v("Episode Casting")])]):e._e(),e.isEpisodeCasting?e._e():s("combobox-styled",{staticClass:"mr1",attrs:{label:e.$t("main.for"),options:e.castingTypeOptions},model:{value:e.castingType,callback:function(t){e.castingType=t},expression:"castingType"}}),e.isShotCasting?s("combobox-styled",{attrs:{label:e.$t("shots.fields.sequence"),options:e.castingSequencesOptions},model:{value:e.sequenceId,callback:function(t){e.sequenceId=t},expression:"sequenceId"}}):e._e(),e.isAssetCasting?s("combobox-styled",{attrs:{label:e.$t("tasks.fields.asset_type"),options:e.castingAssetTypesOptions},model:{value:e.assetTypeId,callback:function(t){e.assetTypeId=t},expression:"assetTypeId"}}):e._e(),s("span",{staticClass:"filler"}),s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.isTextMode?e.$t("breakdown.picture_mode"):e.$t("breakdown.text_mode"),icon:"type","is-on":e.isTextMode,"is-responsive":!0},on:{click:e.toggleTextMode}}),e.isCurrentUserManager?s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("main.csv.import_file"),icon:"upload","is-responsive":!0},on:{click:e.showImportModal}}):e._e(),e.isCurrentUserManager?s("button-href-link",{staticClass:"flexrow-item",attrs:{title:e.$t("main.csv.export_file"),icon:"download","is-responsive":!0,path:e.exportUrlPath}}):e._e()],1),e.isLoading?s("spinner",{staticClass:"mt1"}):s("div",{staticClass:"mt1"},e._l(e.castingEntities,(function(t){return s("shot-line",{key:t.id,attrs:{"entity-id":t.id,"preview-file-id":t.preview_file_id,selected:e.selection[t.id],name:t.name,assets:e.castingByType[t.id]||[],"read-only":!e.isCurrentUserManager,"text-mode":e.isTextMode},on:{"edit-label":e.onEditLabelClicked,"remove-one":e.removeOneAsset,"remove-ten":e.removeTenAssets,click:e.selectEntity}})})),1)],1),e.isCurrentUserManager?s("div",{directives:[{name:"scroll",rawName:"v-scroll",value:e.onAssetListScroll,expression:"onAssetListScroll"}],ref:"asset-list",staticClass:"breakdown-column assets-column"},[s("h2",{staticClass:"subtitle flexrow"},[s("span",{staticClass:"flexrow-item"},[e._v(" "+e._s(e.$t("breakdown.all_assets"))+" ")]),s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("assets.new_asset"),icon:"plus"},on:{click:function(t){e.modals.isNewDisplayed=!0}}}),e.isTVShow?s("button-simple",{staticClass:"flexrow-item",attrs:{text:e.$t("assets.only_current_episode"),"is-on":e.isOnlyCurrentEpisode},on:{click:function(t){e.isOnlyCurrentEpisode=!e.isOnlyCurrentEpisode}}}):e._e()],1),s("div",{staticClass:"filters-area flexrow"},[s("search-field",{ref:"search-field",staticClass:"flexrow-item",on:{change:e.onSearchChange}}),s("button-simple",{staticClass:"flexrow-item",attrs:{title:e.$t("entities.build_filter.title"),icon:"funnel"},on:{click:function(t){e.modals.isBuildFilterDisplayed=!0}}})],1),e.isAssetsLoading?s("spinner"):e._l(e.availableAssetsByType,(function(t){return s("div",{key:t.length>0?t[0].asset_type_name:"",staticClass:"type-assets"},[s("div",{staticClass:"asset-type"},[e._v(" "+e._s(t.length>0?t[0].asset_type_name:"")+" ")]),s("div",{staticClass:"asset-list"},e._l(t,(function(t){return s("available-asset-block",{key:t.id,attrs:{asset:t,active:Object.keys(e.selection).length>0,"text-mode":e.isTextMode},on:{"add-one":e.addOneAsset,"add-ten":e.addTenAssets}})})),1)])}))],2):e._e()]),s("import-render-modal",{attrs:{active:e.modals.isImportRenderDisplayed,"is-loading":e.loading.importing,"is-error":e.errors.importing,"import-error":e.errors.importingError,"parsed-csv":e.parsedCSV,"form-data":e.importCsvFormData,columns:e.renderColumns,dataMatchers:e.dataMatchers,database:e.filteredCasting,"disable-update":!0},on:{reupload:e.resetImport,cancel:e.hideImportRenderModal,confirm:e.uploadImportFile}}),s("import-modal",{ref:"import-modal",attrs:{active:e.modals.importing,"is-loading":e.loading.importing,"is-error":e.errors.importing,"form-data":e.importCsvFormData,columns:e.csvColumns,"optional-columns":e.optionalCsvColumns},on:{cancel:e.hideImportModal,confirm:e.renderImport}}),s("edit-label-modal",{ref:"edit-label-modal",attrs:{active:e.modals.isEditLabelDisplayed,"is-loading":e.loading.editLabel,"is-error":e.loading.editError,asset:e.editedAsset,label:e.editedAssetLinkLabel},on:{cancel:function(t){e.modals.isEditLabelDisplayed=!1},confirm:e.confirmEditLabel}}),s("build-filter-modal",{ref:"build-filter-modal",attrs:{active:e.modals.isBuildFilterDisplayed},on:{confirm:e.confirmBuildFilter,cancel:function(t){e.modals.isBuildFilterDisplayed=!1}}}),s("edit-asset-modal",{ref:"edit-asset-modal",attrs:{active:e.modals.isNewDisplayed,"asset-to-edit":{},"is-error":e.errors.edit,"is-loading":e.loading.edit,"is-loading-stay":e.loading.stay,"is-success":e.success.edit},on:{confirm:e.confirmNewAsset,confirmAndStay:e.confirmNewAssetStay,cancel:function(t){e.modals.isNewDisplayed=!1}}}),s("delete-modal",{attrs:{active:e.modals.isRemoveConfirmationDisplayed,"delete-button-text":e.$t("breakdown.remove.confirm"),"error-text":e.$t("breakdown.remove.error"),"is-loading":e.loading.remove,"is-error":e.loading.error,text:e.$t("breakdown.remove.text")},on:{confirm:e.confirmAssetRemoval,cancel:function(t){e.modals.isRemoveConfirmationDisplayed=!1}}})],1)},n=[],o=s("2f62"),a=s("3657"),r=s("3455"),c=s("cf78"),l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.textMode?s("div",{staticClass:"asset-text flexrow-item flexrow"},[s("span",{staticClass:"asset-text-name flexrow-item"},[e._v(" "+e._s(e.asset.name)+" ")]),s("span",{staticClass:"modify-asset flexrow-item",on:{click:e.addOneAsset}},[e._v(" + 1 ")])]):s("div",{class:{asset:!0,active:e.active},attrs:{id:"casting-"+e.asset.id,title:e.asset.name}},[s("div",{staticClass:"asset-add",on:{click:e.addOneAsset}},[e._v(" + 1 ")]),s("div",{staticClass:"asset-add-10",on:{click:e.addTenAssets}},[e._v(" + 10 ")]),e.asset.preview_file_id.length>0?s("div",{staticClass:"asset-picture"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"/api/pictures/thumbnails-square/preview-files/"+e.asset.preview_file_id+".png",expression:"'/api/pictures/thumbnails-square/preview-files/' + asset.preview_file_id + '.png'"}],attrs:{alt:""}})]):s("div",{staticClass:"asset-picture"},[s("span",{staticClass:"empty-picture"},[e._v(" "+e._s(e.asset.name)+" ")])])])},d=[],u={name:"available-asset-block",props:{asset:{default:function(){return{id:"",name:""}},type:Object},active:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean}},computed:{},methods:{addOneAsset:function(e){this.active&&this.$emit("add-one",this.asset.id)},addTenAssets:function(e){this.active&&this.$emit("add-ten",this.asset.id)}}},p=u,h=(s("fd43"),s("0c7c")),f=Object(h["a"])(p,l,d,!1,null,"24a9275a",null),m=f.exports,y=s("c31e"),v=s("9355"),g=s("de40"),b=s("9751"),C=s("5f48"),w=s("813f"),_=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{modal:!0,"is-active":e.active}},[s("div",{staticClass:"modal-background",on:{click:function(t){return e.$emit("cancel")}}}),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"box content"},[s("h1",{staticClass:"title"},[e._v(" "+e._s(e.$t("breakdown.edit_label"))+" ")]),s("form",{on:{submit:function(e){e.preventDefault()}}},[s("combobox",{directives:[{name:"focus",rawName:"v-focus"}],ref:"typeField",attrs:{label:e.$t("breakdown.label"),options:e.typeOptions},on:{enter:e.confirm},model:{value:e.form.label,callback:function(t){e.$set(e.form,"label",t)},expression:"form.label"}}),s("modal-footer",{attrs:{"is-error":e.isError,"is-loading":e.isLoading},on:{confirm:e.confirm,cancel:function(t){return e.$emit("cancel")}}})],1)])])])},O=[],E=s("d065"),A=s("992f"),k=s("d5c9");function I(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function T(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?I(Object(s),!0).forEach((function(t){x(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):I(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function x(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var S={name:"edit-label-modal",mixins:[E["a"]],components:{Combobox:A["a"],ModalFooter:k["a"]},props:{active:{type:Boolean,default:!1},isError:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},label:{type:String}},mounted:function(){this.form.label=this.label},data:function(){return{asset:null,form:{label:"animate"},typeOptions:[{label:this.$t("breakdown.options.animate"),value:"animate"},{label:this.$t("breakdown.options.fixed"),value:"fixed"}]}},computed:T({},Object(o["c"])([])),methods:T(T({},Object(o["b"])([])),{},{confirm:function(){return this.$emit("confirm",this.form)}}),watch:{label:function(){this.form.label=this.label}}},L=S,$=(s("8475"),Object(h["a"])(L,_,O,!1,null,"f516136e",null)),j=$.exports,M=s("4918"),D=s("440f"),q=s("4d04"),P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{shot:!0,selected:e.selected,unselectable:!0,"text-mode":e.textMode},attrs:{id:e.entityId},on:{click:function(t){return e.onClicked(t)}}},[s("div",{staticClass:"flexrow"},[s("span",{staticClass:"flexrow flexrow-item"},[s("entity-thumbnail",{attrs:{entity:{},height:30,"empty-width":40,"empty-height":30,"preview-file-id":e.previewFileId}})],1),s("div",{staticClass:"shot-name flexrow-item"},[e._v(" "+e._s(e.name)+" ")]),s("div",{staticClass:"asset-list flexrow-item"},[e._l(e.assets,(function(t){return s("div",{key:t.length>0?t[0].asset_type_name:"",staticClass:"asset-type-line flexrow"},[s("span",{staticClass:"asset-type-name flexrow-item"},[e._v(" "+e._s(t.length>0?t[0].asset_type_name:"")+" ("+e._s(t.reduce((function(e,t){return e+t.nb_occurences}),0))+") ")]),s("div",{staticClass:"asset-type-items flexrow-item"},e._l(t,(function(t){return s("asset-block",{key:t.id,staticClass:"flexrow-item",attrs:{asset:t,"nb-occurences":t.nb_occurences,"read-only":e.readOnly,"text-mode":e.textMode},on:{"edit-label":e.onEditLabelClicked,"remove-one":e.removeOneAsset,"remove-ten":e.removeTenAssets}})})),1)])})),0===e.assets.length?s("div",{staticClass:"asset-type-line flexrow empty mt05 mb05"},[e._v(" "+e._s(e.$t("breakdown.empty"))+" ")]):e._e()],2)])])},B=[],F=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.textMode?s("div",{staticClass:"asset-text flexrow-item flexrow"},[s("span",{staticClass:"asset-text-name flexrow-item"},[e._v(" "+e._s(e.asset.name)+" ("+e._s(e.nbOccurences)+") ")]),e.readOnly?e._e():s("span",{staticClass:"modify-asset flexrow-item",on:{click:e.removeOneAsset}},[e._v(" - 1 ")])]):s("div",{class:{asset:!0,big:!0,casted:!0,active:e.active,labelled:!0},attrs:{title:e.asset.name+" ("+e.nbOccurences+")"}},[s("div",{staticClass:"asset-wrapper"},[e.readOnly?e._e():s("div",{staticClass:"asset-add",on:{click:e.removeOneAsset}},[e._v(" - 1 ")]),e.readOnly?e._e():s("div",{staticClass:"asset-add-10",on:{click:e.removeTenAssets}},[e._v(" - 10 ")]),e.asset.preview_file_id?s("div",{staticClass:"asset-picture"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"/api/pictures/thumbnails-square/preview-files/"+e.asset.preview_file_id+".png",expression:"'/api/pictures/thumbnails-square/preview-files/' + asset.preview_file_id + '.png'"}],attrs:{alt:""}}),e.nbOccurences>1?s("span",{staticClass:"nb-occurences"},[e._v(" "+e._s(e.nbOccurences)+" ")]):e._e()]):s("div",{staticClass:"asset-picture"},[s("span",{staticClass:"empty-picture"},[e._v(" "+e._s(e.shortenName(e.asset.name))+" ("+e._s(e.nbOccurences)+") ")])])]),s("div",{staticClass:"asset-label",attrs:{label:e.asset.label},on:{click:e.onEditLabelClicked}},[e._v(" "+e._s(e.asset.label||e.$t("breakdown.options.animate"))+" ")])])},R=[],N=s("8c97"),K={name:"asset-block",components:{},data:function(){return{initialLoading:!0,loading:{EditLabel:!1}}},props:{asset:{default:function(){return{id:"",name:""}},type:Object},nbOccurences:{default:1,type:Number},active:{default:!0,type:Boolean},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean}},computed:{},methods:{removeOneAsset:function(e){this.$emit("remove-one",this.asset.asset_id,this.nbOccurences)},removeTenAssets:function(e){this.$emit("remove-ten",this.asset.asset_id,this.nbOccurences)},shortenName:function(e){return N["a"].shortenText(e,13)},onEditLabelClicked:function(){this.readOnly||this.$emit("edit-label",this.asset,this.asset.label)}}},V=K,U=(s("3923"),Object(h["a"])(V,F,R,!1,null,"2b86ceed",null)),z=U.exports,H=s("bb21"),G={name:"shot-line",components:{AssetBlock:z,EntityThumbnail:H["a"]},props:{entityId:{default:"",type:String},previewFileId:{default:"",type:String},selected:{default:!1,type:Boolean},name:{default:"",type:String},assets:{default:function(){return[]},type:Array},readOnly:{default:!1,type:Boolean},textMode:{default:!1,type:Boolean}},methods:{onClicked:function(e){this.$emit("click",this.entityId,e)},onEditLabelClicked:function(e,t){this.$emit("edit-label",e,t,this.entityId)},removeOneAsset:function(e,t){this.$emit("remove-one",e,this.entityId,t)},removeTenAssets:function(e,t){this.$emit("remove-ten",e,this.entityId,t)}}},J=G,Q=(s("1daa"),Object(h["a"])(J,P,B,!1,null,"6f3a34b7",null)),X=Q.exports,W=s("be83");function Y(e){return se(e)||te(e)||ee(e)||Z()}function Z(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ee(e,t){if(e){if("string"===typeof e)return ie(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?ie(e,t):void 0}}function te(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function se(e){if(Array.isArray(e))return ie(e)}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}function ne(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function oe(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(s),!0).forEach((function(t){ae(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ne(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function ae(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var re={name:"breakdown",components:{AvailableAssetBlock:m,BuildFilterModal:y["a"],ButtonHrefLink:v["a"],ButtonSimple:g["a"],ComboboxStyled:b["a"],DeleteModal:C["a"],EditAssetModal:w["a"],EditLabelModal:j,ImportModal:D["a"],ImportRenderModal:M["a"],SearchField:q["a"],ShotLine:X,Spinner:W["a"]},data:function(){return{assetTypeId:"",castingType:"shot",editedAsset:null,editedEntityId:null,editedAssetLinkLabel:null,episodeId:"",importCsvFormData:{},isLocked:!1,isLoading:!1,isOnlyCurrentEpisode:!1,isTextMode:!1,removalData:{},selection:{},sequenceId:"",errors:{edit:!1,editLabel:!1,importing:!1,importingError:null,remove:!1,stay:!1},loading:{edit:!1,editLabel:!1,importing:!1,remove:!1,stay:!1},modals:{isBuildFilterDisplayed:!1,isEditLabelDisplayed:!1,isNewDisplayed:!1,isImportRenderDisplayed:!1,isRemoveConfirmationDisplayed:!1,importing:!1},success:{edit:!1},optionalCsvColumns:["Label"],parsedCSV:[]}},mounted:function(){this.isLoading||this.reset(),this.setLastProductionScreen("breakdown"),this.isTextMode="true"===localStorage.getItem("breakdown:text-mode"),window.addEventListener("keydown",this.onKeyDown,!1)},beforeDestroy:function(){window.removeEventListener("keydown",this.onKeyDown)},computed:oe(oe({},Object(o["c"])(["assetMap","assetsByType","casting","castingEpisodes","castingAssetTypeAssets","castingAssetTypesOptions","castingByType","castingCurrentShot","castingSequencesOptions","castingSequenceShots","currentEpisode","currentProduction","displayedShots","episodes","getEpisodeOptions","isCurrentUserManager","isAssetsLoading","isShotsLoading","isTVShow","episodeMap","sequences","sequenceMap","shotMap"])),{},{castingTypeOptions:function(){var e=[{label:this.$t("assets.title"),value:"asset"}];return(!this.isTVShow||this.currentEpisode&&"main"!==this.currentEpisode.id)&&e.unshift({label:this.$t("shots.title"),value:"shot"}),e},availableAssetsByType:function(){var e=this,t=[];return this.assetsByType.forEach((function(s){var i=s.filter((function(e){return!e.canceled}));e.isTVShow&&e.isOnlyCurrentEpisode&&(i=s.filter((function(t){return"main"!==e.currentEpisode.id?t.episode_id===e.currentEpisode.id:!t.episode_id}))),i.length>0&&t.push(i)})),t},exportUrlPath:function(){var e="/api/export/csv/projects/".concat(this.currentProduction.id,"/casting.csv");return this.currentEpisode&&(e+="?episode_id=".concat(this.currentEpisode.id)),e},isEpisodeCasting:function(){return this.currentEpisode&&"all"===this.currentEpisode.id},isAssetCasting:function(){return!this.isEpisodeCasting&&"asset"===this.castingType},isShotCasting:function(){return!this.isEpisodeCasting&&"shot"===this.castingType},castingEntities:function(){var e=this;return this.isEpisodeCasting?this.castingEpisodes:this.isShotCasting?this.castingSequenceShots:this.isTVShow&&"main"!==this.currentEpisode.id?this.castingAssetTypeAssets.filter((function(t){return t.episode_id===e.currentEpisode.id||t.casting_episode_ids.includes(e.currentEpisode.id)})):this.isTVShow&&"main"===this.currentEpisode.id?this.castingAssetTypeAssets.filter((function(e){return!e.episode_id})):this.castingAssetTypeAssets},editLabelModal:function(){return this.$refs["edit-label-modal"]},filteredCasting:function(){var e=this,t={};return this.castingEntities.forEach((function(s){e.castingByType[s.id]&&e.castingByType[s.id].forEach((function(e){e.forEach((function(e){var s="".concat(e.asset_name).concat(e.asset_type_name).concat(e.name);t[s]=!0}))}))})),t},csvColumns:function(){return this.isTVShow?["Episode","Parent","Name","Asset Type","Asset","Occurences"]:["Parent","Name","Asset Type","Asset","Occurences"]},renderColumns:function(){return[].concat(Y(this.csvColumns),Y(this.optionalCsvColumns))},dataMatchers:function(){return this.isTVShow?["Episode","Name","Asset Type","Asset"]:["Name","Asset Type","Asset"]}}),methods:oe(oe({},Object(o["b"])(["addAssetToCasting","displayMoreAssets","loadEpisodeCasting","loadEpisodes","loadAssetCasting","loadAssets","loadShotCasting","loadShots","newAsset","removeAssetFromCasting","saveCasting","setAssetLinkLabel","setAssetSearch","setCastingEpisodes","setCastingAssetType","setCastingAssetTypes","setCastingEpisode","setCastingForProductionEpisodes","setCastingSequence","setCurrentEpisode","setEntityCasting","setLastProductionScreen","uploadCastingFile"])),{},{reset:function(){var e=this;if(!this.isTVShow){var t=oe({},this.$route);t&&t.params&&t.params.episode_id&&(t.name="breakdown",t.params.episode_id=null,this.$router.push(t))}this.isLoading=!0,setTimeout((function(){e.reloadEntities()}),100)},reloadEntities:function(){var e=this;this.isLoading=!0,this.loadShots((function(){e.isTVShow?(e.currentEpisode&&(e.episodeId=e.currentEpisode.id),e.setCastingEpisode(e.episodeId),e.setCastingForProductionEpisodes()):e.setCastingEpisode(null),e.loadAssets(!0).then((function(){e.isLoading=!1,e.displayMoreAssets(),e.setCastingAssetTypes(),e.assetTypeId&&e.setCastingAssetType(e.assetTypeId),e.resetSelection(),e.currentEpisode&&"main"===e.currentEpisode.id&&(e.castingType="asset")}))}))},resetSelection:function(){var e={};this.isEpisodeCasting?this.castingEpisodes.forEach((function(t){e[t.id]=!1})):this.isShotCasting?this.castingSequenceShots.forEach((function(t){e[t.id]=!1})):this.castingAssetTypeAssets.forEach((function(t){e[t.id]=!1})),this.selection=e},confirmBuildFilter:function(e){this.modals.isBuildFilterDisplayed=!1,this.$refs["search-field"].setValue(e),this.onSearchChange(e)},onSearchChange:function(e){this.setAssetSearch(e),this.displayMoreAssets(),this.displayMoreAssets()},selectEntity:function(e,t){var s=oe({},this.selection);t.ctrlKey||t.metaKey||t.shitKey||this.clearSelection(),this.previousEntityId&&t.shiftKey&&this.selectRange(this.previousEntityId,e),this.previousEntityId&&t.shiftKey||(this.previousEntityId=e);var i=Object.keys(s).filter((function(e){return s[e]})).length;!s[e]||i>1&&!t.ctrlKey&&!t.metaKey?this.selection[e]=!0:s[e]&&(t.ctrlKey||t.metaKey)&&(this.selection[e]=!1)},clearSelection:function(){var e=this;Object.keys(this.selection).filter((function(t){return e.selection[t]})).forEach((function(t){e.selection[t]=!1}))},selectRange:function(e,t){var s=this,i=Object.keys(this.selection),n=i.findIndex((function(t){return t===e})),o=i.findIndex((function(e){return e===t})),r=[];r=n<o?Object(a["v"])(n,o):Object(a["v"])(o,n),r.forEach((function(e){e>=0&&(s.selection[i[e]]=!0)}))},setLock:function(){var e=this;this.$options.lockTimeout||(this.$options.lockTimeout=setTimeout((function(){e.isLocked=!1}),3e3))},addOneAsset:function(e){var t=this;this.isLocked=!0,Object.keys(this.selection).filter((function(e){return t.selection[e]})).forEach((function(s){t.addAssetToCasting({entityId:s,assetId:e,nbOccurences:1,label:"shot"===t.castingType?"animate":"fixed"}),t.saveCasting(s).then(t.setLock).catch(console.error)}))},addTenAssets:function(e){var t=this;this.isLocked=!0,Object.keys(this.selection).filter((function(e){return t.selection[e]})).forEach((function(s){t.addAssetToCasting({entityId:s,assetId:e,nbOccurences:10}),t.saveCasting(s).then(t.setLock).catch(console.error)}))},confirmAssetRemoval:function(){this.saveAssetRemoval(this.removalData.entityId,this.removalData.assetId,this.removalData.nbOccurences)},saveAssetRemoval:function(e,t,s){var i=this;this.loading.remove=!0,this.removeAssetFromCasting({entityId:e,assetId:t,nbOccurences:s}),this.saveCasting(e).then(this.setLock).then((function(){i.loading.remove=!1,i.modals.isRemoveConfirmationDisplayed=!1})).catch((function(e){i.errors.remove=!0,i.loading.remove=!1,console.error(e)}))},removeOneAsset:function(e,t,s){this.isLocked=!0,this.isEpisodeCasting&&1===s?(this.removalData={assetId:e,entityId:t,nbOccurences:s},this.modals.isRemoveConfirmationDisplayed=!0):this.saveAssetRemoval(t,e,1)},removeTenAssets:function(e,t,s){this.isLocked=!0,this.isEpisodeCasting&&s<10?(this.removalData={assetId:e,entityId:t,nbOccurences:s},this.modals.isRemoveConfirmationDisplayed=!0):this.saveAssetRemoval(t,e,10)},onAssetListScroll:function(e,t){var s=this.$refs["asset-list"],i=s.scrollHeight-s.offsetHeight;i<t.scrollTop+100&&this.displayMoreAssets()},showImportModal:function(){this.modals.importing=!0},hideImportModal:function(){this.modals.importing=!1},showImportRenderModal:function(){this.modals.isImportRenderDisplayed=!0},hideImportRenderModal:function(){this.modals.isImportRenderDisplayed=!1},renderImport:function(e,t){var s=this;this.loading.importing=!0,this.errors.importing=!1,"file"===t&&(e=e.get("file")),r["a"].processCSV(e).then((function(e){s.parsedCSV=e,s.hideImportModal(),s.loading.importing=!1,s.showImportRenderModal()}))},uploadImportFile:function(e){var t=this,s=new FormData,i="import.csv",n=new File([e.join("\n")],i,{type:"text/csv"});s.append("file",n),this.loading.importing=!0,this.errors.importing=!1,this.errors.importingError=null,this.importCsvFormData=s,this.uploadCastingFile(this.importCsvFormData).then((function(){t.loading.importing=!1,t.hideImportRenderModal(),t.sequenceId&&t.setCastingSequence(t.sequenceId)})).catch((function(e){t.loading.importing=!1,t.errors.importingError=e,t.errors.importing=!0}))},resetImport:function(){this.errors.importing=!1,this.errors.importingError=null,this.hideImportRenderModal(),this.importCsvFormData=void 0,this.$refs["import-modal"].reset(),this.showImportModal()},updateUrl:function(){var e=!1,t={};if(this.isEpisodeCasting){var s=this.$route.params.episode_id;s!==this.episodeId&&(e=!0,t={name:"breakdown-episode",params:{production_id:this.currentProduction.id,episode_id:this.episodeId}})}else if(this.isAssetCasting){var i=this.$route.params.asset_type_id;i!==this.assetTypeId&&(e=!0,t={name:"breakdown-asset-type",params:{production_id:this.currentProduction.id,asset_type_id:this.assetTypeId}})}else{var n=this.$route.params.sequence_id;n!==this.sequenceId&&(e=!0,t={name:"breakdown-sequence",params:{production_id:this.currentProduction.id,sequence_id:this.sequenceId}})}if(e){var o=this.$route.params.episode_id;!o&&this.currentEpisode&&(o=this.currentEpisode.id),o&&(t.name="episode-".concat(t.name),t.params.episode_id=o,"all"===o&&(t.params.sequence_id="all")),this.$router.push(t)}},onEditLabelClicked:function(e,t,s){this.editedAsset=e,this.editedEntityId=s,this.editedAssetLinkLabel=t,this.modals.isEditLabelDisplayed=!0},confirmEditLabel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=t.label;this.loading.editLabel=!0,this.setAssetLinkLabel({label:s,asset:this.editedAsset,targetEntityId:this.editedEntityId}).then((function(){e.modals.isEditLabelDisplayed=!1,e.loading.editLabel=!1})).catch((function(t){console.error(t),e.errors.editLabel=!0,e.loading.editLabel=!1}))},toggleTextMode:function(){this.isTextMode=!this.isTextMode,localStorage.setItem("breakdown:text-mode",this.isTextMode)},confirmNewAssetStay:function(e){var t=this;this.loading.stay=!0,this.success.edit=!1,this.newAsset(e).then((function(e){t.loading.stay=!1,t.loading.edit=!1,t.resetLightEditModal(e),t.$refs["edit-asset-modal"].focusName(),t.success.edit=!0})).catch((function(e){console.error(e),t.loading.stay=!1,t.loading.edit=!1,t.success.edit=!1,t.errors.edit=!0}))},confirmNewAsset:function(e){var t=this;this.loading.edit=!0,this.errors.edit=!1,this.newAsset(e).then((function(e){t.loading.edit=!1,t.modals.isNewDisplayed=!1})).catch((function(e){console.error(e),t.loading.edit=!1,t.errors.edit=!0}))},resetLightEditModal:function(e){var t={name:"",entity_type_id:e.entit_type_id,production_id:this.currentProduction.id};this.assetToEdit=t},onKeyDown:function(e){["INPUT","TEXTAREA"].includes(e.target.tagName)||(e.ctrlKey&&67===e.keyCode?this.copyCasting():e.ctrlKey&&86===e.keyCode&&this.pasteCasting())},copyCasting:function(){var e=this,t=Object.keys(this.selection).find((function(t){return e.selection[t]})),s=this.casting[t];c["a"].copyCasting(s)},pasteCasting:function(){var e=this,t=c["a"].pasteCasting(),s=Object.keys(this.selection).filter((function(t){return e.selection[t]}));return s.forEach((function(s){e.setEntityCasting({entityId:s,casting:t}),e.saveCasting(s).then(e.setLock).catch(console.error)})),t}}),watch:{$route:function(){},castingType:function(){if(this.isShotCasting&&this.sequences.length>0&&(this.sequenceId=this.sequences[0].id,this.assetTypeId=""),this.isAssetCasting&&this.castingAssetTypesOptions.length>0){var e=this.$route.params.asset_type_id;this.sequenceId="",this.castingType="asset",e?this.assetTypeId=e:this.castingAssetTypesOptions.length>0&&(this.assetTypeId=this.castingAssetTypesOptions[0].value)}},sequenceId:function(){this.sequenceId&&this.sequences&&this.sequences.length>0&&(this.setCastingSequence(this.sequenceId),this.updateUrl(),this.resetSelection())},assetTypeId:function(){this.assetTypeId&&this.castingAssetTypesOptions.length>0&&(this.setCastingAssetType(this.assetTypeId),this.updateUrl(),this.resetSelection())},episodeId:function(){this.episodeId&&this.episodes&&this.episodes.length>0&&("all"===this.episodeId&&this.setCastingForProductionEpisodes(this.episodeId),this.resetSelection())},castingSequencesOptions:function(){if(this.$route.path.indexOf("asset-type")<0){var e=this.$route.params.sequence_id;e&&this.sequenceMap.get(e)?this.sequenceId=e:this.castingSequencesOptions.length>0?this.sequenceId=this.castingSequencesOptions[0].value:this.sequenceId=""}},castingAssetTypesOptions:function(){if(this.$route.path.indexOf("asset-type")>0){var e=this.$route.params.asset_type_id;this.castingType="asset",e?this.assetTypeId=e:this.castingAssetTypesOptions.length>0?this.assetTypeId=this.castingAssetTypesOptions[0].value:this.assetTypeId=""}},currentProduction:function(){this.isLoading||this.reset()},currentEpisode:function(){this.currentEpisode&&this.episodeId!==this.currentEpisode.id&&!this.isLoading&&("all"===this.currentEpisode.id?this.episodeId="all":this.reset())},sequences:function(){this.$store.commit("CASTING_SET_SEQUENCES",this.sequences)}},socket:{events:{"episode:casting-update":function(e){var t=this.episodeMap.get(e.episode_id);t&&!this.isLocked&&this.loadEpisodeCasting(t)},"shot:casting-update":function(e){var t=this.shotMap.get(e.shot_id);t&&t.sequence_id===this.sequenceId&&!this.isLocked&&this.loadShotCasting(t)},"asset:casting-update":function(e){var t=this.assetMap.get(e.asset_id);t&&t.asset_type_id===this.assetTypeId&&!this.isLocked&&this.loadAssetCasting(t)}}},metaInfo:function(){var e=this.$t("breakdown.title");return{title:"".concat(this.currentProduction.name," ").concat(e," - Kitsu")}}},ce=re,le=(s("f2d7"),Object(h["a"])(ce,i,n,!1,null,"7ef645de",null));t["default"]=le.exports}}]);
//# sourceMappingURL=chunk-14958caa.ef0c7929.js.map